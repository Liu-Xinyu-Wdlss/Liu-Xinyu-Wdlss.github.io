import{g as t,b as e,s as n,w as r,r as i,u as s,d as o,e as a,f as l,h as c,n as h,i as u,j as d,m as f,t as p,k as m,l as g,p as v,q as y,v as b,x,y as w,z as E,A as _,B as S,C as T,D as k,E as A,F as C,G as R,H as M,T as I,o as D,c as O,I as P,J as L,K as F,L as N,M as B,a as U,N as V,O as j,P as z,Q as G,R as W,S as H,U as $,V as Y,W as X,X as q,Y as K,Z,_ as J,$ as Q}from"./_@vue-054a179e.js";var tt,et=Object.defineProperty,nt=Object.defineProperties,rt=Object.getOwnPropertyDescriptors,it=Object.getOwnPropertySymbols,st=Object.prototype.hasOwnProperty,ot=Object.prototype.propertyIsEnumerable,at=(t,e,n)=>e in t?et(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;function lt(t,e){var s;const o=n();var a,l;return r((()=>{o.value=t()}),(a=((t,e)=>{for(var n in e||(e={}))st.call(e,n)&&at(t,n,e[n]);if(it)for(var n of it(e))ot.call(e,n)&&at(t,n,e[n]);return t})({},e),l={flush:null!=(s=null==e?void 0:e.flush)?s:"sync"},nt(a,rt(l)))),i(o)}const ct="undefined"!=typeof window,ht=t=>"string"==typeof t,ut=()=>{},dt=ct&&(null==(tt=null==window?void 0:window.navigator)?void 0:tt.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent);function ft(t){return"function"==typeof t?t():s(t)}function pt(t,e){return function(...n){return new Promise(((r,i)=>{Promise.resolve(t((()=>e.apply(this,n)),{fn:e,thisArg:this,args:n})).then(r).catch(i)}))}}function mt(n){return!!t()&&(e(n),!0)}function gt(t,e=200,n={}){return pt(function(t,e={}){let n,r,i=ut;const s=t=>{clearTimeout(t),i(),i=ut};return o=>{const a=ft(t),l=ft(e.maxWait);return n&&s(n),a<=0||void 0!==l&&l<=0?(r&&(s(r),r=null),Promise.resolve(o())):new Promise(((t,c)=>{i=e.rejectOnCancel?c:t,l&&!r&&(r=setTimeout((()=>{n&&s(n),r=null,t(o())}),l)),n=setTimeout((()=>{r&&s(r),r=null,t(o())}),a)}))}}(e,n),t)}function vt(t,e=200,n={}){const r=o(t.value),i=gt((()=>{r.value=t.value}),e,n);return a(t,(()=>i())),r}function yt(t,e=200,n=!1,r=!0,i=!1){return pt(function(t,e=!0,n=!0,r=!1){let i,s,o=0,a=!0,l=ut;const c=()=>{i&&(clearTimeout(i),i=void 0,l(),l=ut)};return h=>{const u=ft(t),d=Date.now()-o,f=()=>s=h();return c(),u<=0?(o=Date.now(),f()):(d>u&&(n||!a)?(o=Date.now(),f()):e&&(s=new Promise(((t,e)=>{l=r?e:t,i=setTimeout((()=>{o=Date.now(),a=!0,t(f()),c()}),Math.max(0,u-d))}))),n||i||(i=setTimeout((()=>a=!0),u)),a=!1,s)}}(e,n,r,i),t)}function bt(t,e=!0){l()?c(t):e?t():h(t)}function xt(t,e,n={}){const{immediate:r=!0}=n,s=o(!1);let a=null;function l(){a&&(clearTimeout(a),a=null)}function c(){s.value=!1,l()}function h(...n){l(),s.value=!0,a=setTimeout((()=>{s.value=!1,a=null,t(...n)}),ft(e))}return r&&(s.value=!0,ct&&h()),mt(c),{isPending:i(s),start:h,stop:c}}function wt(t){var e;const n=ft(t);return null!=(e=null==n?void 0:n.$el)?e:n}const Et=ct?window:void 0,_t=ct?window.document:void 0;function St(...t){let e,n,r,i;if(ht(t[0])||Array.isArray(t[0])?([n,r,i]=t,e=Et):[e,n,r,i]=t,!e)return ut;Array.isArray(n)||(n=[n]),Array.isArray(r)||(r=[r]);const s=[],o=()=>{s.forEach((t=>t())),s.length=0},l=a((()=>[wt(e),ft(i)]),(([t,e])=>{o(),t&&s.push(...n.flatMap((n=>r.map((r=>((t,e,n,r)=>(t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)))(t,n,r,e))))))}),{immediate:!0,flush:"post"}),c=()=>{l(),o()};return mt(c),c}let Tt=!1;function kt(t,e,n={}){const{window:r=Et,ignore:i=[],capture:s=!0,detectIframe:o=!1}=n;if(!r)return;dt&&!Tt&&(Tt=!0,Array.from(r.document.body.children).forEach((t=>t.addEventListener("click",ut))));let a=!0;const l=t=>i.some((e=>{if("string"==typeof e)return Array.from(r.document.querySelectorAll(e)).some((e=>e===t.target||t.composedPath().includes(e)));{const n=wt(e);return n&&(t.target===n||t.composedPath().includes(n))}})),c=[St(r,"click",(n=>{const r=wt(t);r&&r!==n.target&&!n.composedPath().includes(r)&&(0===n.detail&&(a=!l(n)),a?e(n):a=!0)}),{passive:!0,capture:s}),St(r,"pointerdown",(e=>{const n=wt(t);n&&(a=!e.composedPath().includes(n)&&!l(e))}),{passive:!0}),o&&St(r,"blur",(n=>{var i;const s=wt(t);"IFRAME"!==(null==(i=r.document.activeElement)?void 0:i.tagName)||(null==s?void 0:s.contains(r.document.activeElement))||e(n)}))].filter(Boolean);return()=>c.forEach((t=>t()))}function At(t,e=!1){const n=o(),r=()=>n.value=Boolean(t());return r(),bt(r,e),n}const Ct="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Rt="__vueuse_ssr_handlers__";function Mt(t,e,{window:n=Et,initialValue:r=""}={}){const i=o(r),s=u((()=>{var t;return wt(e)||(null==(t=null==n?void 0:n.document)?void 0:t.documentElement)}));return a([s,()=>ft(t)],(([t,e])=>{var s;if(t&&n){const o=null==(s=n.getComputedStyle(t).getPropertyValue(e))?void 0:s.trim();i.value=o||r}}),{immediate:!0}),a(i,(e=>{var n;(null==(n=s.value)?void 0:n.style)&&s.value.style.setProperty(ft(t),e)})),i}function It({document:t=_t}={}){if(!t)return o("visible");const e=o(t.visibilityState);return St(t,"visibilitychange",(()=>{e.value=t.visibilityState})),e}Ct[Rt]=Ct[Rt]||{};var Dt=Object.getOwnPropertySymbols,Ot=Object.prototype.hasOwnProperty,Pt=Object.prototype.propertyIsEnumerable,Lt=(t,e)=>{var n={};for(var r in t)Ot.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&Dt)for(var r of Dt(t))e.indexOf(r)<0&&Pt.call(t,r)&&(n[r]=t[r]);return n};function Ft(t,e,n={}){const r=n,{window:i=Et}=r,s=Lt(r,["window"]);let o;const l=At((()=>i&&"ResizeObserver"in i)),c=()=>{o&&(o.disconnect(),o=void 0)},h=a((()=>wt(t)),(t=>{c(),l.value&&i&&t&&(o=new ResizeObserver(e),o.observe(t,s))}),{immediate:!0,flush:"post"}),u=()=>{c(),h()};return mt(u),{isSupported:l,stop:u}}function Nt(t,e={}){const{reset:n=!0,windowResize:r=!0,windowScroll:i=!0,immediate:s=!0}=e,l=o(0),c=o(0),h=o(0),u=o(0),d=o(0),f=o(0),p=o(0),m=o(0);function g(){const e=wt(t);if(!e)return void(n&&(l.value=0,c.value=0,h.value=0,u.value=0,d.value=0,f.value=0,p.value=0,m.value=0));const r=e.getBoundingClientRect();l.value=r.height,c.value=r.bottom,h.value=r.left,u.value=r.right,d.value=r.top,f.value=r.width,p.value=r.x,m.value=r.y}return Ft(t,g),a((()=>wt(t)),(t=>!t&&g())),i&&St("scroll",g,{capture:!0,passive:!0}),r&&St("resize",g,{passive:!0}),bt((()=>{s&&g()})),{height:l,bottom:c,left:h,right:u,top:d,width:f,x:p,y:m,update:g}}var Bt,Ut,Vt=Object.getOwnPropertySymbols,jt=Object.prototype.hasOwnProperty,zt=Object.prototype.propertyIsEnumerable;function Gt(t,e,n={}){const r=n,{window:i=Et}=r,s=((t,e)=>{var n={};for(var r in t)jt.call(t,r)&&e.indexOf(r)<0&&(n[r]=t[r]);if(null!=t&&Vt)for(var r of Vt(t))e.indexOf(r)<0&&zt.call(t,r)&&(n[r]=t[r]);return n})(r,["window"]);let o;const l=At((()=>i&&"MutationObserver"in i)),c=()=>{o&&(o.disconnect(),o=void 0)},h=a((()=>wt(t)),(t=>{c(),l.value&&i&&t&&(o=new MutationObserver(e),o.observe(t,s))}),{immediate:!0}),u=()=>{c(),h()};return mt(u),{isSupported:l,stop:u}}(Ut=Bt||(Bt={})).UP="UP",Ut.RIGHT="RIGHT",Ut.DOWN="DOWN",Ut.LEFT="LEFT",Ut.NONE="NONE";var Wt=Object.defineProperty,Ht=Object.getOwnPropertySymbols,$t=Object.prototype.hasOwnProperty,Yt=Object.prototype.propertyIsEnumerable,Xt=(t,e,n)=>e in t?Wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;function qt(t,e,n,r={}){var i,s,c;const{clone:h=!1,passive:d=!1,eventName:f,deep:p=!1,defaultValue:m}=r,g=l(),v=n||(null==g?void 0:g.emit)||(null==(i=null==g?void 0:g.$emit)?void 0:i.bind(g))||(null==(c=null==(s=null==g?void 0:g.proxy)?void 0:s.$emit)?void 0:c.bind(null==g?void 0:g.proxy));let y=f;e||(e="modelValue"),y=f||y||`update:${e.toString()}`;const b=t=>{return h?(t=>"function"==typeof t)(h)?h(t):(e=t,JSON.parse(JSON.stringify(e))):t;var e},x=()=>void 0!==t[e]?b(t[e]):m;if(d){const n=x(),r=o(n);return a((()=>t[e]),(t=>r.value=b(t))),a(r,(n=>{(n!==t[e]||p)&&v(y,n)}),{deep:p}),r}return u({get:()=>x(),set(t){v(y,t)}})}function Kt({window:t=Et}={}){if(!t)return o(!1);const e=o(t.document.hasFocus());return St(t,"blur",(()=>{e.value=!1})),St(t,"focus",(()=>{e.value=!0})),e}function Zt(t={}){const{window:e=Et,initialWidth:n=1/0,initialHeight:r=1/0,listenOrientation:i=!0,includeScrollbar:s=!0}=t,a=o(n),l=o(r),c=()=>{e&&(s?(a.value=e.innerWidth,l.value=e.innerHeight):(a.value=e.document.documentElement.clientWidth,l.value=e.document.documentElement.clientHeight))};return c(),bt(c),St("resize",c,{passive:!0}),i&&St("orientationchange",c,{passive:!0}),{width:a,height:l}}((t,e)=>{for(var n in e||(e={}))$t.call(e,n)&&Xt(t,n,e[n]);if(Ht)for(var n of Ht(e))Yt.call(e,n)&&Xt(t,n,e[n])})({linear:function(t){return t}},{easeInSine:[.12,0,.39,0],easeOutSine:[.61,1,.88,1],easeInOutSine:[.37,0,.63,1],easeInQuad:[.11,0,.5,0],easeOutQuad:[.5,1,.89,1],easeInOutQuad:[.45,0,.55,1],easeInCubic:[.32,0,.67,0],easeOutCubic:[.33,1,.68,1],easeInOutCubic:[.65,0,.35,1],easeInQuart:[.5,0,.75,0],easeOutQuart:[.25,1,.5,1],easeInOutQuart:[.76,0,.24,1],easeInQuint:[.64,0,.78,0],easeOutQuint:[.22,1,.36,1],easeInOutQuint:[.83,0,.17,1],easeInExpo:[.7,0,.84,0],easeOutExpo:[.16,1,.3,1],easeInOutExpo:[.87,0,.13,1],easeInCirc:[.55,0,1,.45],easeOutCirc:[0,.55,.45,1],easeInOutCirc:[.85,0,.15,1],easeInBack:[.36,0,.66,-.56],easeOutBack:[.34,1.56,.64,1],easeInOutBack:[.68,-.6,.32,1.6]});var Jt="top",Qt="bottom",te="right",ee="left",ne="auto",re=[Jt,Qt,te,ee],ie="start",se="end",oe="clippingParents",ae="viewport",le="popper",ce="reference",he=re.reduce((function(t,e){return t.concat([e+"-"+ie,e+"-"+se])}),[]),ue=[].concat(re,[ne]).reduce((function(t,e){return t.concat([e,e+"-"+ie,e+"-"+se])}),[]),de=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function fe(t){return t?(t.nodeName||"").toLowerCase():null}function pe(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function me(t){return t instanceof pe(t).Element||t instanceof Element}function ge(t){return t instanceof pe(t).HTMLElement||t instanceof HTMLElement}function ve(t){return"undefined"!=typeof ShadowRoot&&(t instanceof pe(t).ShadowRoot||t instanceof ShadowRoot)}var ye={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},i=e.elements[t];!ge(i)||!fe(i)||(Object.assign(i.style,n),Object.keys(r).forEach((function(t){var e=r[t];!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],i=e.attributes[t]||{},s=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce((function(t,e){return t[e]="",t}),{});!ge(r)||!fe(r)||(Object.assign(r.style,s),Object.keys(i).forEach((function(t){r.removeAttribute(t)})))}))}},requires:["computeStyles"]};function be(t){return t.split("-")[0]}var xe=Math.max,we=Math.min,Ee=Math.round;function _e(t,e){void 0===e&&(e=!1);var n=t.getBoundingClientRect(),r=1,i=1;if(ge(t)&&e){var s=t.offsetHeight,o=t.offsetWidth;o>0&&(r=Ee(n.width)/o||1),s>0&&(i=Ee(n.height)/s||1)}return{width:n.width/r,height:n.height/i,top:n.top/i,right:n.right/r,bottom:n.bottom/i,left:n.left/r,x:n.left/r,y:n.top/i}}function Se(t){var e=_e(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-r)<=1&&(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function Te(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&ve(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function ke(t){return pe(t).getComputedStyle(t)}function Ae(t){return["table","td","th"].indexOf(fe(t))>=0}function Ce(t){return((me(t)?t.ownerDocument:t.document)||window.document).documentElement}function Re(t){return"html"===fe(t)?t:t.assignedSlot||t.parentNode||(ve(t)?t.host:null)||Ce(t)}function Me(t){return ge(t)&&"fixed"!==ke(t).position?t.offsetParent:null}function Ie(t){for(var e=pe(t),n=Me(t);n&&Ae(n)&&"static"===ke(n).position;)n=Me(n);return n&&("html"===fe(n)||"body"===fe(n)&&"static"===ke(n).position)?e:n||function(t){var e=-1!==navigator.userAgent.toLowerCase().indexOf("firefox");if(-1!==navigator.userAgent.indexOf("Trident")&&ge(t)&&"fixed"===ke(t).position)return null;var n=Re(t);for(ve(n)&&(n=n.host);ge(n)&&["html","body"].indexOf(fe(n))<0;){var r=ke(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(t)||e}function De(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function Oe(t,e,n){return xe(t,we(e,n))}function Pe(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function Le(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}var Fe={name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,r=t.name,i=t.options,s=n.elements.arrow,o=n.modifiersData.popperOffsets,a=be(n.placement),l=De(a),c=[ee,te].indexOf(a)>=0?"height":"width";if(s&&o){var h=function(t,e){return Pe("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:Le(t,re))}(i.padding,n),u=Se(s),d="y"===l?Jt:ee,f="y"===l?Qt:te,p=n.rects.reference[c]+n.rects.reference[l]-o[l]-n.rects.popper[c],m=o[l]-n.rects.reference[l],g=Ie(s),v=g?"y"===l?g.clientHeight||0:g.clientWidth||0:0,y=p/2-m/2,b=h[d],x=v-u[c]-h[f],w=v/2-u[c]/2+y,E=Oe(b,w,x),_=l;n.modifiersData[r]=((e={})[_]=E,e.centerOffset=E-w,e)}},effect:function(t){var e=t.state,n=t.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"==typeof r&&!(r=e.elements.popper.querySelector(r))||!Te(e.elements.popper,r)||(e.elements.arrow=r))},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function Ne(t){return t.split("-")[1]}var Be={top:"auto",right:"auto",bottom:"auto",left:"auto"};function Ue(t){var e,n=t.popper,r=t.popperRect,i=t.placement,s=t.variation,o=t.offsets,a=t.position,l=t.gpuAcceleration,c=t.adaptive,h=t.roundOffsets,u=t.isFixed,d=o.x,f=void 0===d?0:d,p=o.y,m=void 0===p?0:p,g="function"==typeof h?h({x:f,y:m}):{x:f,y:m};f=g.x,m=g.y;var v=o.hasOwnProperty("x"),y=o.hasOwnProperty("y"),b=ee,x=Jt,w=window;if(c){var E=Ie(n),_="clientHeight",S="clientWidth";if(E===pe(n)&&("static"!==ke(E=Ce(n)).position&&"absolute"===a&&(_="scrollHeight",S="scrollWidth")),i===Jt||(i===ee||i===te)&&s===se)x=Qt,m-=(u&&E===w&&w.visualViewport?w.visualViewport.height:E[_])-r.height,m*=l?1:-1;if(i===ee||(i===Jt||i===Qt)&&s===se)b=te,f-=(u&&E===w&&w.visualViewport?w.visualViewport.width:E[S])-r.width,f*=l?1:-1}var T,k=Object.assign({position:a},c&&Be),A=!0===h?function(t){var e=t.x,n=t.y,r=window.devicePixelRatio||1;return{x:Ee(e*r)/r||0,y:Ee(n*r)/r||0}}({x:f,y:m}):{x:f,y:m};return f=A.x,m=A.y,l?Object.assign({},k,((T={})[x]=y?"0":"",T[b]=v?"0":"",T.transform=(w.devicePixelRatio||1)<=1?"translate("+f+"px, "+m+"px)":"translate3d("+f+"px, "+m+"px, 0)",T)):Object.assign({},k,((e={})[x]=y?m+"px":"",e[b]=v?f+"px":"",e.transform="",e))}var Ve={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=void 0===r||r,s=n.adaptive,o=void 0===s||s,a=n.roundOffsets,l=void 0===a||a,c={placement:be(e.placement),variation:Ne(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,Ue(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:l})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,Ue(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:l})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},je={passive:!0};var ze={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,s=void 0===i||i,o=r.resize,a=void 0===o||o,l=pe(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return s&&c.forEach((function(t){t.addEventListener("scroll",n.update,je)})),a&&l.addEventListener("resize",n.update,je),function(){s&&c.forEach((function(t){t.removeEventListener("scroll",n.update,je)})),a&&l.removeEventListener("resize",n.update,je)}},data:{}},Ge={left:"right",right:"left",bottom:"top",top:"bottom"};function We(t){return t.replace(/left|right|bottom|top/g,(function(t){return Ge[t]}))}var He={start:"end",end:"start"};function $e(t){return t.replace(/start|end/g,(function(t){return He[t]}))}function Ye(t){var e=pe(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function Xe(t){return _e(Ce(t)).left+Ye(t).scrollLeft}function qe(t){var e=ke(t),n=e.overflow,r=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+r)}function Ke(t){return["html","body","#document"].indexOf(fe(t))>=0?t.ownerDocument.body:ge(t)&&qe(t)?t:Ke(Re(t))}function Ze(t,e){var n;void 0===e&&(e=[]);var r=Ke(t),i=r===(null==(n=t.ownerDocument)?void 0:n.body),s=pe(r),o=i?[s].concat(s.visualViewport||[],qe(r)?r:[]):r,a=e.concat(o);return i?a:a.concat(Ze(Re(o)))}function Je(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Qe(t,e){return e===ae?Je(function(t){var e=pe(t),n=Ce(t),r=e.visualViewport,i=n.clientWidth,s=n.clientHeight,o=0,a=0;return r&&(i=r.width,s=r.height,/^((?!chrome|android).)*safari/i.test(navigator.userAgent)||(o=r.offsetLeft,a=r.offsetTop)),{width:i,height:s,x:o+Xe(t),y:a}}(t)):me(e)?function(t){var e=_e(t);return e.top=e.top+t.clientTop,e.left=e.left+t.clientLeft,e.bottom=e.top+t.clientHeight,e.right=e.left+t.clientWidth,e.width=t.clientWidth,e.height=t.clientHeight,e.x=e.left,e.y=e.top,e}(e):Je(function(t){var e,n=Ce(t),r=Ye(t),i=null==(e=t.ownerDocument)?void 0:e.body,s=xe(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=xe(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-r.scrollLeft+Xe(t),l=-r.scrollTop;return"rtl"===ke(i||n).direction&&(a+=xe(n.clientWidth,i?i.clientWidth:0)-s),{width:s,height:o,x:a,y:l}}(Ce(t)))}function tn(t,e,n){var r="clippingParents"===e?function(t){var e=Ze(Re(t)),n=["absolute","fixed"].indexOf(ke(t).position)>=0&&ge(t)?Ie(t):t;return me(n)?e.filter((function(t){return me(t)&&Te(t,n)&&"body"!==fe(t)})):[]}(t):[].concat(e),i=[].concat(r,[n]),s=i[0],o=i.reduce((function(e,n){var r=Qe(t,n);return e.top=xe(r.top,e.top),e.right=we(r.right,e.right),e.bottom=we(r.bottom,e.bottom),e.left=xe(r.left,e.left),e}),Qe(t,s));return o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}function en(t){var e,n=t.reference,r=t.element,i=t.placement,s=i?be(i):null,o=i?Ne(i):null,a=n.x+n.width/2-r.width/2,l=n.y+n.height/2-r.height/2;switch(s){case Jt:e={x:a,y:n.y-r.height};break;case Qt:e={x:a,y:n.y+n.height};break;case te:e={x:n.x+n.width,y:l};break;case ee:e={x:n.x-r.width,y:l};break;default:e={x:n.x,y:n.y}}var c=s?De(s):null;if(null!=c){var h="y"===c?"height":"width";switch(o){case ie:e[c]=e[c]-(n[h]/2-r[h]/2);break;case se:e[c]=e[c]+(n[h]/2-r[h]/2)}}return e}function nn(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=void 0===r?t.placement:r,s=n.boundary,o=void 0===s?oe:s,a=n.rootBoundary,l=void 0===a?ae:a,c=n.elementContext,h=void 0===c?le:c,u=n.altBoundary,d=void 0!==u&&u,f=n.padding,p=void 0===f?0:f,m=Pe("number"!=typeof p?p:Le(p,re)),g=h===le?ce:le,v=t.rects.popper,y=t.elements[d?g:h],b=tn(me(y)?y:y.contextElement||Ce(t.elements.popper),o,l),x=_e(t.elements.reference),w=en({reference:x,element:v,strategy:"absolute",placement:i}),E=Je(Object.assign({},v,w)),_=h===le?E:x,S={top:b.top-_.top+m.top,bottom:_.bottom-b.bottom+m.bottom,left:b.left-_.left+m.left,right:_.right-b.right+m.right},T=t.modifiersData.offset;if(h===le&&T){var k=T[i];Object.keys(S).forEach((function(t){var e=[te,Qt].indexOf(t)>=0?1:-1,n=[Jt,Qt].indexOf(t)>=0?"y":"x";S[t]+=k[n]*e}))}return S}var rn={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0===o||o,l=n.fallbackPlacements,c=n.padding,h=n.boundary,u=n.rootBoundary,d=n.altBoundary,f=n.flipVariations,p=void 0===f||f,m=n.allowedAutoPlacements,g=e.options.placement,v=be(g),y=l||(v===g||!p?[We(g)]:function(t){if(be(t)===ne)return[];var e=We(t);return[$e(t),e,$e(e)]}(g)),b=[g].concat(y).reduce((function(t,n){return t.concat(be(n)===ne?function(t,e){void 0===e&&(e={});var n=e,r=n.placement,i=n.boundary,s=n.rootBoundary,o=n.padding,a=n.flipVariations,l=n.allowedAutoPlacements,c=void 0===l?ue:l,h=Ne(r),u=h?a?he:he.filter((function(t){return Ne(t)===h})):re,d=u.filter((function(t){return c.indexOf(t)>=0}));0===d.length&&(d=u);var f=d.reduce((function(e,n){return e[n]=nn(t,{placement:n,boundary:i,rootBoundary:s,padding:o})[be(n)],e}),{});return Object.keys(f).sort((function(t,e){return f[t]-f[e]}))}(e,{placement:n,boundary:h,rootBoundary:u,padding:c,flipVariations:p,allowedAutoPlacements:m}):n)}),[]),x=e.rects.reference,w=e.rects.popper,E=new Map,_=!0,S=b[0],T=0;T<b.length;T++){var k=b[T],A=be(k),C=Ne(k)===ie,R=[Jt,Qt].indexOf(A)>=0,M=R?"width":"height",I=nn(e,{placement:k,boundary:h,rootBoundary:u,altBoundary:d,padding:c}),D=R?C?te:ee:C?Qt:Jt;x[M]>w[M]&&(D=We(D));var O=We(D),P=[];if(s&&P.push(I[A]<=0),a&&P.push(I[D]<=0,I[O]<=0),P.every((function(t){return t}))){S=k,_=!1;break}E.set(k,P)}if(_)for(var L=function(t){var e=b.find((function(e){var n=E.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return S=e,"break"},F=p?3:1;F>0;F--){if("break"===L(F))break}e.placement!==S&&(e.modifiersData[r]._skip=!0,e.placement=S,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function sn(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function on(t){return[Jt,te,Qt,ee].some((function(e){return t[e]>=0}))}var an={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,s=e.modifiersData.preventOverflow,o=nn(e,{elementContext:"reference"}),a=nn(e,{altBoundary:!0}),l=sn(o,r),c=sn(a,i,s),h=on(l),u=on(c);e.modifiersData[n]={referenceClippingOffsets:l,popperEscapeOffsets:c,isReferenceHidden:h,hasPopperEscaped:u},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":h,"data-popper-escaped":u})}};var ln={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.options,r=t.name,i=n.offset,s=void 0===i?[0,0]:i,o=ue.reduce((function(t,n){return t[n]=function(t,e,n){var r=be(t),i=[ee,Jt].indexOf(r)>=0?-1:1,s="function"==typeof n?n(Object.assign({},e,{placement:t})):n,o=s[0],a=s[1];return o=o||0,a=(a||0)*i,[ee,te].indexOf(r)>=0?{x:a,y:o}:{x:o,y:a}}(n,e.rects,s),t}),{}),a=o[e.placement],l=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=l,e.modifiersData.popperOffsets.y+=c),e.modifiersData[r]=o}};var cn={name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state,n=t.name;e.modifiersData[n]=en({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}};var hn={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,s=void 0===i||i,o=n.altAxis,a=void 0!==o&&o,l=n.boundary,c=n.rootBoundary,h=n.altBoundary,u=n.padding,d=n.tether,f=void 0===d||d,p=n.tetherOffset,m=void 0===p?0:p,g=nn(e,{boundary:l,rootBoundary:c,padding:u,altBoundary:h}),v=be(e.placement),y=Ne(e.placement),b=!y,x=De(v),w=function(t){return"x"===t?"y":"x"}(x),E=e.modifiersData.popperOffsets,_=e.rects.reference,S=e.rects.popper,T="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,k="number"==typeof T?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),A=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,C={x:0,y:0};if(E){if(s){var R,M="y"===x?Jt:ee,I="y"===x?Qt:te,D="y"===x?"height":"width",O=E[x],P=O+g[M],L=O-g[I],F=f?-S[D]/2:0,N=y===ie?_[D]:S[D],B=y===ie?-S[D]:-_[D],U=e.elements.arrow,V=f&&U?Se(U):{width:0,height:0},j=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},z=j[M],G=j[I],W=Oe(0,_[D],V[D]),H=b?_[D]/2-F-W-z-k.mainAxis:N-W-z-k.mainAxis,$=b?-_[D]/2+F+W+G+k.mainAxis:B+W+G+k.mainAxis,Y=e.elements.arrow&&Ie(e.elements.arrow),X=Y?"y"===x?Y.clientTop||0:Y.clientLeft||0:0,q=null!=(R=null==A?void 0:A[x])?R:0,K=O+$-q,Z=Oe(f?we(P,O+H-q-X):P,O,f?xe(L,K):L);E[x]=Z,C[x]=Z-O}if(a){var J,Q="x"===x?Jt:ee,tt="x"===x?Qt:te,et=E[w],nt="y"===w?"height":"width",rt=et+g[Q],it=et-g[tt],st=-1!==[Jt,ee].indexOf(v),ot=null!=(J=null==A?void 0:A[w])?J:0,at=st?rt:et-_[nt]-S[nt]-ot+k.altAxis,lt=st?et+_[nt]+S[nt]-ot-k.altAxis:it,ct=f&&st?function(t,e,n){var r=Oe(t,e,n);return r>n?n:r}(at,et,lt):Oe(f?at:rt,et,f?lt:it);E[w]=ct,C[w]=ct-et}e.modifiersData[r]=C}},requiresIfExists:["offset"]};function un(t,e,n){void 0===n&&(n=!1);var r=ge(e),i=ge(e)&&function(t){var e=t.getBoundingClientRect(),n=Ee(e.width)/t.offsetWidth||1,r=Ee(e.height)/t.offsetHeight||1;return 1!==n||1!==r}(e),s=Ce(e),o=_e(t,i),a={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(r||!r&&!n)&&(("body"!==fe(e)||qe(s))&&(a=function(t){return t!==pe(t)&&ge(t)?function(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}(t):Ye(t)}(e)),ge(e)?((l=_e(e,!0)).x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=Xe(s))),{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function dn(t){var e=new Map,n=new Set,r=[];function i(t){n.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!n.has(t)){var r=e.get(t);r&&i(r)}})),r.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||i(t)})),r}function fn(t){var e;return function(){return e||(e=new Promise((function(n){Promise.resolve().then((function(){e=void 0,n(t())}))}))),e}}var pn={placement:"bottom",modifiers:[],strategy:"absolute"};function mn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function gn(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,r=void 0===n?[]:n,i=e.defaultOptions,s=void 0===i?pn:i;return function(t,e,n){void 0===n&&(n=s);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},pn,s),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},o=[],a=!1,l={state:i,setOptions:function(n){var a="function"==typeof n?n(i.options):n;c(),i.options=Object.assign({},s,i.options,a),i.scrollParents={reference:me(t)?Ze(t):t.contextElement?Ze(t.contextElement):[],popper:Ze(e)};var h=function(t){var e=dn(t);return de.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}(function(t){var e=t.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}([].concat(r,i.options.modifiers)));return i.orderedModifiers=h.filter((function(t){return t.enabled})),i.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,r=void 0===n?{}:n,s=t.effect;if("function"==typeof s){var a=s({state:i,name:e,instance:l,options:r}),c=function(){};o.push(a||c)}})),l.update()},forceUpdate:function(){if(!a){var t=i.elements,e=t.reference,n=t.popper;if(mn(e,n)){i.rects={reference:un(e,Ie(n),"fixed"===i.options.strategy),popper:Se(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(t){return i.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0;r<i.orderedModifiers.length;r++)if(!0!==i.reset){var s=i.orderedModifiers[r],o=s.fn,c=s.options,h=void 0===c?{}:c,u=s.name;"function"==typeof o&&(i=o({state:i,options:h,name:u,instance:l})||i)}else i.reset=!1,r=-1}}},update:fn((function(){return new Promise((function(t){l.forceUpdate(),t(i)}))})),destroy:function(){c(),a=!0}};if(!mn(t,e))return l;function c(){o.forEach((function(t){return t()})),o=[]}return l.setOptions(n).then((function(t){!a&&n.onFirstUpdate&&n.onFirstUpdate(t)})),l}}gn(),gn({defaultModifiers:[ze,cn,Ve,ye]});var vn=gn({defaultModifiers:[ze,cn,Ve,ye,ln,rn,hn,Fe,an]});const yn=Math.min,bn=Math.max,xn=Math.round,wn=t=>({x:t,y:t});function En(t,e){return"function"==typeof t?t(e):t}function _n(t){return t.split("-")[0]}function Sn(t){return t.split("-")[1]}function Tn(t){return"y"===t?"height":"width"}function kn(t){return["top","bottom"].includes(_n(t))?"y":"x"}function An(t){return"x"===kn(t)?"y":"x"}function Cn(t){return{...t,top:t.y,left:t.x,right:t.x+t.width,bottom:t.y+t.height}}function Rn(t,e,n){let{reference:r,floating:i}=t;const s=kn(e),o=An(e),a=Tn(o),l=_n(e),c="y"===s,h=r.x+r.width/2-i.width/2,u=r.y+r.height/2-i.height/2,d=r[a]/2-i[a]/2;let f;switch(l){case"top":f={x:h,y:r.y-i.height};break;case"bottom":f={x:h,y:r.y+r.height};break;case"right":f={x:r.x+r.width,y:u};break;case"left":f={x:r.x-i.width,y:u};break;default:f={x:r.x,y:r.y}}switch(Sn(e)){case"start":f[o]-=d*(n&&c?-1:1);break;case"end":f[o]+=d*(n&&c?-1:1)}return f}const Mn=t=>({name:"arrow",options:t,async fn(e){const{x:n,y:r,placement:i,rects:s,platform:o,elements:a,middlewareData:l}=e,{element:c,padding:h=0}=En(t,e)||{};if(null==c)return{};const u=function(t){return"number"!=typeof t?function(t){return{top:0,right:0,bottom:0,left:0,...t}}(t):{top:t,right:t,bottom:t,left:t}}(h),d={x:n,y:r},f=An(i),p=Tn(f),m=await o.getDimensions(c),g="y"===f,v=g?"top":"left",y=g?"bottom":"right",b=g?"clientHeight":"clientWidth",x=s.reference[p]+s.reference[f]-d[f]-s.floating[p],w=d[f]-s.reference[f],E=await(null==o.getOffsetParent?void 0:o.getOffsetParent(c));let _=E?E[b]:0;_&&await(null==o.isElement?void 0:o.isElement(E))||(_=a.floating[b]||s.floating[p]);const S=x/2-w/2,T=_/2-m[p]/2-1,k=yn(u[v],T),A=yn(u[y],T),C=k,R=_-m[p]-A,M=_/2-m[p]/2+S,I=bn(C,yn(M,R));const D=!l.arrow&&null!=Sn(i)&&M!=I&&s.reference[p]/2-(M<C?k:A)-m[p]/2<0,O=D?M<C?M-C:M-R:0;return{[f]:d[f]+O,data:{[f]:I,centerOffset:M-I-O,...D&&{alignmentOffset:O}},reset:D}}});const In=function(t){return void 0===t&&(t=0),{name:"offset",options:t,async fn(e){const{x:n,y:r}=e,i=await async function(t,e){const{placement:n,platform:r,elements:i}=t,s=await(null==r.isRTL?void 0:r.isRTL(i.floating)),o=_n(n),a=Sn(n),l="y"===kn(n),c=["left","top"].includes(o)?-1:1,h=s&&l?-1:1,u=En(e,t);let{mainAxis:d,crossAxis:f,alignmentAxis:p}="number"==typeof u?{mainAxis:u,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...u};return a&&"number"==typeof p&&(f="end"===a?-1*p:p),l?{x:f*h,y:d*c}:{x:d*c,y:f*h}}(e,t);return{x:n+i.x,y:r+i.y,data:i}}}};function Dn(t){return Ln(t)?(t.nodeName||"").toLowerCase():"#document"}function On(t){var e;return(null==t||null==(e=t.ownerDocument)?void 0:e.defaultView)||window}function Pn(t){var e;return null==(e=(Ln(t)?t.ownerDocument:t.document)||window.document)?void 0:e.documentElement}function Ln(t){return t instanceof Node||t instanceof On(t).Node}function Fn(t){return t instanceof Element||t instanceof On(t).Element}function Nn(t){return t instanceof HTMLElement||t instanceof On(t).HTMLElement}function Bn(t){return"undefined"!=typeof ShadowRoot&&(t instanceof ShadowRoot||t instanceof On(t).ShadowRoot)}function Un(t){const{overflow:e,overflowX:n,overflowY:r,display:i}=Wn(t);return/auto|scroll|overlay|hidden|clip/.test(e+r+n)&&!["inline","contents"].includes(i)}function Vn(t){return["table","td","th"].includes(Dn(t))}function jn(t){const e=zn(),n=Wn(t);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!e&&!!n.backdropFilter&&"none"!==n.backdropFilter||!e&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some((t=>(n.willChange||"").includes(t)))||["paint","layout","strict","content"].some((t=>(n.contain||"").includes(t)))}function zn(){return!("undefined"==typeof CSS||!CSS.supports)&&CSS.supports("-webkit-backdrop-filter","none")}function Gn(t){return["html","body","#document"].includes(Dn(t))}function Wn(t){return On(t).getComputedStyle(t)}function Hn(t){return Fn(t)?{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}:{scrollLeft:t.pageXOffset,scrollTop:t.pageYOffset}}function $n(t){if("html"===Dn(t))return t;const e=t.assignedSlot||t.parentNode||Bn(t)&&t.host||Pn(t);return Bn(e)?e.host:e}function Yn(t){const e=$n(t);return Gn(e)?t.ownerDocument?t.ownerDocument.body:t.body:Nn(e)&&Un(e)?e:Yn(e)}function Xn(t,e,n){var r;void 0===e&&(e=[]),void 0===n&&(n=!0);const i=Yn(t),s=i===(null==(r=t.ownerDocument)?void 0:r.body),o=On(i);return s?e.concat(o,o.visualViewport||[],Un(i)?i:[],o.frameElement&&n?Xn(o.frameElement):[]):e.concat(i,Xn(i,[],n))}function qn(t){const e=Wn(t);let n=parseFloat(e.width)||0,r=parseFloat(e.height)||0;const i=Nn(t),s=i?t.offsetWidth:n,o=i?t.offsetHeight:r,a=xn(n)!==s||xn(r)!==o;return a&&(n=s,r=o),{width:n,height:r,$:a}}function Kn(t){return Fn(t)?t:t.contextElement}function Zn(t){const e=Kn(t);if(!Nn(e))return wn(1);const n=e.getBoundingClientRect(),{width:r,height:i,$:s}=qn(e);let o=(s?xn(n.width):n.width)/r,a=(s?xn(n.height):n.height)/i;return o&&Number.isFinite(o)||(o=1),a&&Number.isFinite(a)||(a=1),{x:o,y:a}}const Jn=wn(0);function Qn(t){const e=On(t);return zn()&&e.visualViewport?{x:e.visualViewport.offsetLeft,y:e.visualViewport.offsetTop}:Jn}function tr(t,e,n,r){void 0===e&&(e=!1),void 0===n&&(n=!1);const i=t.getBoundingClientRect(),s=Kn(t);let o=wn(1);e&&(r?Fn(r)&&(o=Zn(r)):o=Zn(t));const a=function(t,e,n){return void 0===e&&(e=!1),!(!n||e&&n!==On(t))&&e}(s,n,r)?Qn(s):wn(0);let l=(i.left+a.x)/o.x,c=(i.top+a.y)/o.y,h=i.width/o.x,u=i.height/o.y;if(s){const t=On(s),e=r&&Fn(r)?On(r):r;let n=t.frameElement;for(;n&&r&&e!==t;){const t=Zn(n),e=n.getBoundingClientRect(),r=Wn(n),i=e.left+(n.clientLeft+parseFloat(r.paddingLeft))*t.x,s=e.top+(n.clientTop+parseFloat(r.paddingTop))*t.y;l*=t.x,c*=t.y,h*=t.x,u*=t.y,l+=i,c+=s,n=On(n).frameElement}}return Cn({width:h,height:u,x:l,y:c})}function er(t){return tr(Pn(t)).left+Hn(t).scrollLeft}function nr(t,e,n){let r;if("viewport"===e)r=function(t,e){const n=On(t),r=Pn(t),i=n.visualViewport;let s=r.clientWidth,o=r.clientHeight,a=0,l=0;if(i){s=i.width,o=i.height;const t=zn();(!t||t&&"fixed"===e)&&(a=i.offsetLeft,l=i.offsetTop)}return{width:s,height:o,x:a,y:l}}(t,n);else if("document"===e)r=function(t){const e=Pn(t),n=Hn(t),r=t.ownerDocument.body,i=bn(e.scrollWidth,e.clientWidth,r.scrollWidth,r.clientWidth),s=bn(e.scrollHeight,e.clientHeight,r.scrollHeight,r.clientHeight);let o=-n.scrollLeft+er(t);const a=-n.scrollTop;return"rtl"===Wn(r).direction&&(o+=bn(e.clientWidth,r.clientWidth)-i),{width:i,height:s,x:o,y:a}}(Pn(t));else if(Fn(e))r=function(t,e){const n=tr(t,!0,"fixed"===e),r=n.top+t.clientTop,i=n.left+t.clientLeft,s=Nn(t)?Zn(t):wn(1);return{width:t.clientWidth*s.x,height:t.clientHeight*s.y,x:i*s.x,y:r*s.y}}(e,n);else{const n=Qn(t);r={...e,x:e.x-n.x,y:e.y-n.y}}return Cn(r)}function rr(t,e){const n=$n(t);return!(n===e||!Fn(n)||Gn(n))&&("fixed"===Wn(n).position||rr(n,e))}function ir(t,e,n){const r=Nn(e),i=Pn(e),s="fixed"===n,o=tr(t,!0,s,e);let a={scrollLeft:0,scrollTop:0};const l=wn(0);if(r||!r&&!s)if(("body"!==Dn(e)||Un(i))&&(a=Hn(e)),r){const t=tr(e,!0,s,e);l.x=t.x+e.clientLeft,l.y=t.y+e.clientTop}else i&&(l.x=er(i));return{x:o.left+a.scrollLeft-l.x,y:o.top+a.scrollTop-l.y,width:o.width,height:o.height}}function sr(t,e){return Nn(t)&&"fixed"!==Wn(t).position?e?e(t):t.offsetParent:null}function or(t,e){const n=On(t);if(!Nn(t))return n;let r=sr(t,e);for(;r&&Vn(r)&&"static"===Wn(r).position;)r=sr(r,e);return r&&("html"===Dn(r)||"body"===Dn(r)&&"static"===Wn(r).position&&!jn(r))?n:r||function(t){let e=$n(t);for(;Nn(e)&&!Gn(e);){if(jn(e))return e;e=$n(e)}return null}(t)||n}const ar={convertOffsetParentRelativeRectToViewportRelativeRect:function(t){let{rect:e,offsetParent:n,strategy:r}=t;const i=Nn(n),s=Pn(n);if(n===s)return e;let o={scrollLeft:0,scrollTop:0},a=wn(1);const l=wn(0);if((i||!i&&"fixed"!==r)&&(("body"!==Dn(n)||Un(s))&&(o=Hn(n)),Nn(n))){const t=tr(n);a=Zn(n),l.x=t.x+n.clientLeft,l.y=t.y+n.clientTop}return{width:e.width*a.x,height:e.height*a.y,x:e.x*a.x-o.scrollLeft*a.x+l.x,y:e.y*a.y-o.scrollTop*a.y+l.y}},getDocumentElement:Pn,getClippingRect:function(t){let{element:e,boundary:n,rootBoundary:r,strategy:i}=t;const s=[..."clippingAncestors"===n?function(t,e){const n=e.get(t);if(n)return n;let r=Xn(t,[],!1).filter((t=>Fn(t)&&"body"!==Dn(t))),i=null;const s="fixed"===Wn(t).position;let o=s?$n(t):t;for(;Fn(o)&&!Gn(o);){const e=Wn(o),n=jn(o);n||"fixed"!==e.position||(i=null),(s?!n&&!i:!n&&"static"===e.position&&i&&["absolute","fixed"].includes(i.position)||Un(o)&&!n&&rr(t,o))?r=r.filter((t=>t!==o)):i=e,o=$n(o)}return e.set(t,r),r}(e,this._c):[].concat(n),r],o=s[0],a=s.reduce(((t,n)=>{const r=nr(e,n,i);return t.top=bn(r.top,t.top),t.right=yn(r.right,t.right),t.bottom=yn(r.bottom,t.bottom),t.left=bn(r.left,t.left),t}),nr(e,o,i));return{width:a.right-a.left,height:a.bottom-a.top,x:a.left,y:a.top}},getOffsetParent:or,getElementRects:async function(t){let{reference:e,floating:n,strategy:r}=t;const i=this.getOffsetParent||or,s=this.getDimensions;return{reference:ir(e,await i(n),r),floating:{x:0,y:0,...await s(n)}}},getClientRects:function(t){return Array.from(t.getClientRects())},getDimensions:function(t){return qn(t)},getScale:Zn,isElement:Fn,isRTL:function(t){return"rtl"===Wn(t).direction}},lr=(t,e,n)=>{const r=new Map,i={platform:ar,...n},s={...i.platform,_c:r};return(async(t,e,n)=>{const{placement:r="bottom",strategy:i="absolute",middleware:s=[],platform:o}=n,a=s.filter(Boolean),l=await(null==o.isRTL?void 0:o.isRTL(e));let c=await o.getElementRects({reference:t,floating:e,strategy:i}),{x:h,y:u}=Rn(c,r,l),d=r,f={},p=0;for(let m=0;m<a.length;m++){const{name:n,fn:s}=a[m],{x:g,y:v,data:y,reset:b}=await s({x:h,y:u,initialPlacement:r,placement:d,strategy:i,middlewareData:f,rects:c,platform:o,elements:{reference:t,floating:e}});h=null!=g?g:h,u=null!=v?v:u,f={...f,[n]:{...f[n],...y}},b&&p<=50&&(p++,"object"==typeof b&&(b.placement&&(d=b.placement),b.rects&&(c=!0===b.rects?await o.getElementRects({reference:t,floating:e,strategy:i}):b.rects),({x:h,y:u}=Rn(c,d,l))),m=-1)}return{x:h,y:u,placement:d,strategy:i,middlewareData:f}})(t,e,{...i,platform:s})};function cr(){return cr=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t},cr.apply(this,arguments)}function hr(t){return(hr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ur(t,e){return(ur=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function dr(t,e,n){return(dr=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(Ni){return!1}}()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&ur(i,n.prototype),i}).apply(null,arguments)}function fr(t){var e="function"==typeof Map?new Map:void 0;return fr=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return dr(t,arguments,hr(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ur(r,t)},fr(t)}var pr=/%[sdj%]/g,mr=function(){};function gr(t){if(!t||!t.length)return null;var e={};return t.forEach((function(t){var n=t.field;e[n]=e[n]||[],e[n].push(t)})),e}function vr(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=0,s=n.length;return"function"==typeof t?t.apply(null,n):"string"==typeof t?t.replace(pr,(function(t){if("%%"===t)return"%";if(i>=s)return t;switch(t){case"%s":return String(n[i++]);case"%d":return Number(n[i++]);case"%j":try{return JSON.stringify(n[i++])}catch(e){return"[Circular]"}break;default:return t}})):t}function yr(t,e){return null==t||(!("array"!==e||!Array.isArray(t)||t.length)||!(!function(t){return"string"===t||"url"===t||"hex"===t||"email"===t||"date"===t||"pattern"===t}(e)||"string"!=typeof t||t))}function br(t,e,n){var r=0,i=t.length;!function s(o){if(o&&o.length)n(o);else{var a=r;r+=1,a<i?e(t[a],s):n([])}}([])}"undefined"!=typeof process&&process.env;var xr=function(t){var e,n;function r(e,n){var r;return(r=t.call(this,"Async Validation Error")||this).errors=e,r.fields=n,r}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,ur(e,n),r}(fr(Error));function wr(t,e,n,r,i){if(e.first){var s=new Promise((function(e,s){var o=function(t){var e=[];return Object.keys(t).forEach((function(n){e.push.apply(e,t[n]||[])})),e}(t);br(o,n,(function(t){return r(t),t.length?s(new xr(t,gr(t))):e(i)}))}));return s.catch((function(t){return t})),s}var o=!0===e.firstFields?Object.keys(t):e.firstFields||[],a=Object.keys(t),l=a.length,c=0,h=[],u=new Promise((function(e,s){var u=function(t){if(h.push.apply(h,t),++c===l)return r(h),h.length?s(new xr(h,gr(h))):e(i)};a.length||(r(h),e(i)),a.forEach((function(e){var r=t[e];-1!==o.indexOf(e)?br(r,n,u):function(t,e,n){var r=[],i=0,s=t.length;function o(t){r.push.apply(r,t||[]),++i===s&&n(r)}t.forEach((function(t){e(t,o)}))}(r,n,u)}))}));return u.catch((function(t){return t})),u}function Er(t,e){return function(n){var r,i;return r=t.fullFields?function(t,e){for(var n=t,r=0;r<e.length;r++){if(null==n)return n;n=n[e[r]]}return n}(e,t.fullFields):e[n.field||t.fullField],(i=n)&&void 0!==i.message?(n.field=n.field||t.fullField,n.fieldValue=r,n):{message:"function"==typeof n?n():n,fieldValue:r,field:n.field||t.fullField}}}function _r(t,e){if(e)for(var n in e)if(e.hasOwnProperty(n)){var r=e[n];"object"==typeof r&&"object"==typeof t[n]?t[n]=cr({},t[n],r):t[n]=r}return t}var Sr,Tr=function(t,e,n,r,i,s){!t.required||n.hasOwnProperty(t.field)&&!yr(e,s||t.type)||r.push(vr(i.messages.required,t.fullField))},kr=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+\.)+[a-zA-Z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{2,}))$/,Ar=/^#?([a-f0-9]{6}|[a-f0-9]{3})$/i,Cr={integer:function(t){return Cr.number(t)&&parseInt(t,10)===t},float:function(t){return Cr.number(t)&&!Cr.integer(t)},array:function(t){return Array.isArray(t)},regexp:function(t){if(t instanceof RegExp)return!0;try{return!!new RegExp(t)}catch(Ni){return!1}},date:function(t){return"function"==typeof t.getTime&&"function"==typeof t.getMonth&&"function"==typeof t.getYear&&!isNaN(t.getTime())},number:function(t){return!isNaN(t)&&"number"==typeof t},object:function(t){return"object"==typeof t&&!Cr.array(t)},method:function(t){return"function"==typeof t},email:function(t){return"string"==typeof t&&t.length<=320&&!!t.match(kr)},url:function(t){return"string"==typeof t&&t.length<=2048&&!!t.match(function(){if(Sr)return Sr;var t="[a-fA-F\\d:]",e=function(e){return e&&e.includeBoundaries?"(?:(?<=\\s|^)(?="+t+")|(?<="+t+")(?=\\s|$))":""},n="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",r="[a-fA-F\\d]{1,4}",i=("\n(?:\n(?:"+r+":){7}(?:"+r+"|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:"+r+":){6}(?:"+n+"|:"+r+"|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:"+r+":){5}(?::"+n+"|(?::"+r+"){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:"+r+":){4}(?:(?::"+r+"){0,1}:"+n+"|(?::"+r+"){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:"+r+":){3}(?:(?::"+r+"){0,2}:"+n+"|(?::"+r+"){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:"+r+":){2}(?:(?::"+r+"){0,3}:"+n+"|(?::"+r+"){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:"+r+":){1}(?:(?::"+r+"){0,4}:"+n+"|(?::"+r+"){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::"+r+"){0,5}:"+n+"|(?::"+r+"){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n").replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),s=new RegExp("(?:^"+n+"$)|(?:^"+i+"$)"),o=new RegExp("^"+n+"$"),a=new RegExp("^"+i+"$"),l=function(t){return t&&t.exact?s:new RegExp("(?:"+e(t)+n+e(t)+")|(?:"+e(t)+i+e(t)+")","g")};l.v4=function(t){return t&&t.exact?o:new RegExp(""+e(t)+n+e(t),"g")},l.v6=function(t){return t&&t.exact?a:new RegExp(""+e(t)+i+e(t),"g")};var c=l.v4().source,h=l.v6().source;return Sr=new RegExp("(?:^(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|"+c+"|"+h+'|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?$)',"i")}())},hex:function(t){return"string"==typeof t&&!!t.match(Ar)}},Rr="enum",Mr={required:Tr,whitespace:function(t,e,n,r,i){(/^\s+$/.test(e)||""===e)&&r.push(vr(i.messages.whitespace,t.fullField))},type:function(t,e,n,r,i){if(t.required&&void 0===e)Tr(t,e,n,r,i);else{var s=t.type;["integer","float","array","regexp","object","method","email","number","date","url","hex"].indexOf(s)>-1?Cr[s](e)||r.push(vr(i.messages.types[s],t.fullField,t.type)):s&&typeof e!==t.type&&r.push(vr(i.messages.types[s],t.fullField,t.type))}},range:function(t,e,n,r,i){var s="number"==typeof t.len,o="number"==typeof t.min,a="number"==typeof t.max,l=e,c=null,h="number"==typeof e,u="string"==typeof e,d=Array.isArray(e);if(h?c="number":u?c="string":d&&(c="array"),!c)return!1;d&&(l=e.length),u&&(l=e.replace(/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,"_").length),s?l!==t.len&&r.push(vr(i.messages[c].len,t.fullField,t.len)):o&&!a&&l<t.min?r.push(vr(i.messages[c].min,t.fullField,t.min)):a&&!o&&l>t.max?r.push(vr(i.messages[c].max,t.fullField,t.max)):o&&a&&(l<t.min||l>t.max)&&r.push(vr(i.messages[c].range,t.fullField,t.min,t.max))},enum:function(t,e,n,r,i){t[Rr]=Array.isArray(t[Rr])?t[Rr]:[],-1===t[Rr].indexOf(e)&&r.push(vr(i.messages[Rr],t.fullField,t[Rr].join(", ")))},pattern:function(t,e,n,r,i){if(t.pattern)if(t.pattern instanceof RegExp)t.pattern.lastIndex=0,t.pattern.test(e)||r.push(vr(i.messages.pattern.mismatch,t.fullField,e,t.pattern));else if("string"==typeof t.pattern){new RegExp(t.pattern).test(e)||r.push(vr(i.messages.pattern.mismatch,t.fullField,e,t.pattern))}}},Ir=function(t,e,n,r,i){var s=t.type,o=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e,s)&&!t.required)return n();Mr.required(t,e,r,o,i,s),yr(e,s)||Mr.type(t,e,r,o,i)}n(o)},Dr={string:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e,"string")&&!t.required)return n();Mr.required(t,e,r,s,i,"string"),yr(e,"string")||(Mr.type(t,e,r,s,i),Mr.range(t,e,r,s,i),Mr.pattern(t,e,r,s,i),!0===t.whitespace&&Mr.whitespace(t,e,r,s,i))}n(s)},method:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&Mr.type(t,e,r,s,i)}n(s)},number:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(""===e&&(e=void 0),yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&(Mr.type(t,e,r,s,i),Mr.range(t,e,r,s,i))}n(s)},boolean:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&Mr.type(t,e,r,s,i)}n(s)},regexp:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),yr(e)||Mr.type(t,e,r,s,i)}n(s)},integer:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&(Mr.type(t,e,r,s,i),Mr.range(t,e,r,s,i))}n(s)},float:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&(Mr.type(t,e,r,s,i),Mr.range(t,e,r,s,i))}n(s)},array:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(null==e&&!t.required)return n();Mr.required(t,e,r,s,i,"array"),null!=e&&(Mr.type(t,e,r,s,i),Mr.range(t,e,r,s,i))}n(s)},object:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&Mr.type(t,e,r,s,i)}n(s)},enum:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i),void 0!==e&&Mr.enum(t,e,r,s,i)}n(s)},pattern:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e,"string")&&!t.required)return n();Mr.required(t,e,r,s,i),yr(e,"string")||Mr.pattern(t,e,r,s,i)}n(s)},date:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e,"date")&&!t.required)return n();var o;if(Mr.required(t,e,r,s,i),!yr(e,"date"))o=e instanceof Date?e:new Date(e),Mr.type(t,o,r,s,i),o&&Mr.range(t,o.getTime(),r,s,i)}n(s)},url:Ir,hex:Ir,email:Ir,required:function(t,e,n,r,i){var s=[],o=Array.isArray(e)?"array":typeof e;Mr.required(t,e,r,s,i,o),n(s)},any:function(t,e,n,r,i){var s=[];if(t.required||!t.required&&r.hasOwnProperty(t.field)){if(yr(e)&&!t.required)return n();Mr.required(t,e,r,s,i)}n(s)}};function Or(){return{default:"Validation error on field %s",required:"%s is required",enum:"%s must be one of %s",whitespace:"%s cannot be empty",date:{format:"%s date %s is invalid for format %s",parse:"%s date could not be parsed, %s is invalid ",invalid:"%s date %s is invalid"},types:{string:"%s is not a %s",method:"%s is not a %s (function)",array:"%s is not an %s",object:"%s is not an %s",number:"%s is not a %s",date:"%s is not a %s",boolean:"%s is not a %s",integer:"%s is not an %s",float:"%s is not a %s",regexp:"%s is not a valid %s",email:"%s is not a valid %s",url:"%s is not a valid %s",hex:"%s is not a valid %s"},string:{len:"%s must be exactly %s characters",min:"%s must be at least %s characters",max:"%s cannot be longer than %s characters",range:"%s must be between %s and %s characters"},number:{len:"%s must equal %s",min:"%s cannot be less than %s",max:"%s cannot be greater than %s",range:"%s must be between %s and %s"},array:{len:"%s must be exactly %s in length",min:"%s cannot be less than %s in length",max:"%s cannot be greater than %s in length",range:"%s must be between %s and %s in length"},pattern:{mismatch:"%s value %s does not match pattern %s"},clone:function(){var t=JSON.parse(JSON.stringify(this));return t.clone=this.clone,t}}}var Pr=Or(),Lr=function(){function t(t){this.rules=null,this._messages=Pr,this.define(t)}var e=t.prototype;return e.define=function(t){var e=this;if(!t)throw new Error("Cannot configure a schema with no rules");if("object"!=typeof t||Array.isArray(t))throw new Error("Rules must be an object");this.rules={},Object.keys(t).forEach((function(n){var r=t[n];e.rules[n]=Array.isArray(r)?r:[r]}))},e.messages=function(t){return t&&(this._messages=_r(Or(),t)),this._messages},e.validate=function(e,n,r){var i=this;void 0===n&&(n={}),void 0===r&&(r=function(){});var s=e,o=n,a=r;if("function"==typeof o&&(a=o,o={}),!this.rules||0===Object.keys(this.rules).length)return a&&a(null,s),Promise.resolve(s);if(o.messages){var l=this.messages();l===Pr&&(l=Or()),_r(l,o.messages),o.messages=l}else o.messages=this.messages();var c={};(o.keys||Object.keys(this.rules)).forEach((function(t){var n=i.rules[t],r=s[t];n.forEach((function(n){var o=n;"function"==typeof o.transform&&(s===e&&(s=cr({},s)),r=s[t]=o.transform(r)),(o="function"==typeof o?{validator:o}:cr({},o)).validator=i.getValidationMethod(o),o.validator&&(o.field=t,o.fullField=o.fullField||t,o.type=i.getType(o),c[t]=c[t]||[],c[t].push({rule:o,value:r,source:s,field:t}))}))}));var h={};return wr(c,o,(function(e,n){var r,i=e.rule,a=!("object"!==i.type&&"array"!==i.type||"object"!=typeof i.fields&&"object"!=typeof i.defaultField);function l(t,e){return cr({},e,{fullField:i.fullField+"."+t,fullFields:i.fullFields?[].concat(i.fullFields,[t]):[t]})}function c(r){void 0===r&&(r=[]);var c=Array.isArray(r)?r:[r];!o.suppressWarning&&c.length&&t.warning("async-validator:",c),c.length&&void 0!==i.message&&(c=[].concat(i.message));var u=c.map(Er(i,s));if(o.first&&u.length)return h[i.field]=1,n(u);if(a){if(i.required&&!e.value)return void 0!==i.message?u=[].concat(i.message).map(Er(i,s)):o.error&&(u=[o.error(i,vr(o.messages.required,i.field))]),n(u);var d={};i.defaultField&&Object.keys(e.value).map((function(t){d[t]=i.defaultField})),d=cr({},d,e.rule.fields);var f={};Object.keys(d).forEach((function(t){var e=d[t],n=Array.isArray(e)?e:[e];f[t]=n.map(l.bind(null,t))}));var p=new t(f);p.messages(o.messages),e.rule.options&&(e.rule.options.messages=o.messages,e.rule.options.error=o.error),p.validate(e.value,e.rule.options||o,(function(t){var e=[];u&&u.length&&e.push.apply(e,u),t&&t.length&&e.push.apply(e,t),n(e.length?e:null)}))}else n(u)}if(a=a&&(i.required||!i.required&&e.value),i.field=e.field,i.asyncValidator)r=i.asyncValidator(i,e.value,c,e.source,o);else if(i.validator){try{r=i.validator(i,e.value,c,e.source,o)}catch(u){console.error,o.suppressValidatorError||setTimeout((function(){throw u}),0),c(u.message)}!0===r?c():!1===r?c("function"==typeof i.message?i.message(i.fullField||i.field):i.message||(i.fullField||i.field)+" fails"):r instanceof Array?c(r):r instanceof Error&&c(r.message)}r&&r.then&&r.then((function(){return c()}),(function(t){return c(t)}))}),(function(t){!function(t){for(var e,n,r=[],i={},o=0;o<t.length;o++)e=t[o],n=void 0,Array.isArray(e)?r=(n=r).concat.apply(n,e):r.push(e);r.length?(i=gr(r),a(r,i)):a(null,s)}(t)}),s)},e.getType=function(t){if(void 0===t.type&&t.pattern instanceof RegExp&&(t.type="pattern"),"function"!=typeof t.validator&&t.type&&!Dr.hasOwnProperty(t.type))throw new Error(vr("Unknown rule type %s",t.type));return t.type||"string"},e.getValidationMethod=function(t){if("function"==typeof t.validator)return t.validator;var e=Object.keys(t),n=e.indexOf("message");return-1!==n&&e.splice(n,1),1===e.length&&"required"===e[0]?Dr.required:Dr[this.getType(t)]||void 0},t}();function Fr(t,e){(function(t){return"string"==typeof t&&-1!==t.indexOf(".")&&1===parseFloat(t)})(t)&&(t="100%");var n=function(t){return"string"==typeof t&&-1!==t.indexOf("%")}(t);return t=360===e?t:Math.min(e,Math.max(0,parseFloat(t))),n&&(t=parseInt(String(t*e),10)/100),Math.abs(t-e)<1e-6?1:t=360===e?(t<0?t%e+e:t%e)/parseFloat(String(e)):t%e/parseFloat(String(e))}function Nr(t){return Math.min(1,Math.max(0,t))}function Br(t){return t=parseFloat(t),(isNaN(t)||t<0||t>1)&&(t=1),t}function Ur(t){return t<=1?"".concat(100*Number(t),"%"):t}function Vr(t){return 1===t.length?"0"+t:String(t)}function jr(t,e,n){t=Fr(t,255),e=Fr(e,255),n=Fr(n,255);var r=Math.max(t,e,n),i=Math.min(t,e,n),s=0,o=0,a=(r+i)/2;if(r===i)o=0,s=0;else{var l=r-i;switch(o=a>.5?l/(2-r-i):l/(r+i),r){case t:s=(e-n)/l+(e<n?6:0);break;case e:s=(n-t)/l+2;break;case n:s=(t-e)/l+4}s/=6}return{h:s,s:o,l:a}}function zr(t,e,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?t+6*n*(e-t):n<.5?e:n<2/3?t+(e-t)*(2/3-n)*6:t}function Gr(t,e,n){t=Fr(t,255),e=Fr(e,255),n=Fr(n,255);var r=Math.max(t,e,n),i=Math.min(t,e,n),s=0,o=r,a=r-i,l=0===r?0:a/r;if(r===i)s=0;else{switch(r){case t:s=(e-n)/a+(e<n?6:0);break;case e:s=(n-t)/a+2;break;case n:s=(t-e)/a+4}s/=6}return{h:s,s:l,v:o}}function Wr(t,e,n,r){var i=[Vr(Math.round(t).toString(16)),Vr(Math.round(e).toString(16)),Vr(Math.round(n).toString(16))];return r&&i[0].startsWith(i[0].charAt(1))&&i[1].startsWith(i[1].charAt(1))&&i[2].startsWith(i[2].charAt(1))?i[0].charAt(0)+i[1].charAt(0)+i[2].charAt(0):i.join("")}function Hr(t){return $r(t)/255}function $r(t){return parseInt(t,16)}Lr.register=function(t,e){if("function"!=typeof e)throw new Error("Cannot register a validator by type, validator is not a function");Dr[t]=e},Lr.warning=mr,Lr.messages=Pr,Lr.validators=Dr;var Yr={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function Xr(t){var e,n,r,i={r:0,g:0,b:0},s=1,o=null,a=null,l=null,c=!1,h=!1;return"string"==typeof t&&(t=function(t){if(t=t.trim().toLowerCase(),0===t.length)return!1;var e=!1;if(Yr[t])t=Yr[t],e=!0;else if("transparent"===t)return{r:0,g:0,b:0,a:0,format:"name"};var n=Jr.rgb.exec(t);if(n)return{r:n[1],g:n[2],b:n[3]};if(n=Jr.rgba.exec(t),n)return{r:n[1],g:n[2],b:n[3],a:n[4]};if(n=Jr.hsl.exec(t),n)return{h:n[1],s:n[2],l:n[3]};if(n=Jr.hsla.exec(t),n)return{h:n[1],s:n[2],l:n[3],a:n[4]};if(n=Jr.hsv.exec(t),n)return{h:n[1],s:n[2],v:n[3]};if(n=Jr.hsva.exec(t),n)return{h:n[1],s:n[2],v:n[3],a:n[4]};if(n=Jr.hex8.exec(t),n)return{r:$r(n[1]),g:$r(n[2]),b:$r(n[3]),a:Hr(n[4]),format:e?"name":"hex8"};if(n=Jr.hex6.exec(t),n)return{r:$r(n[1]),g:$r(n[2]),b:$r(n[3]),format:e?"name":"hex"};if(n=Jr.hex4.exec(t),n)return{r:$r(n[1]+n[1]),g:$r(n[2]+n[2]),b:$r(n[3]+n[3]),a:Hr(n[4]+n[4]),format:e?"name":"hex8"};if(n=Jr.hex3.exec(t),n)return{r:$r(n[1]+n[1]),g:$r(n[2]+n[2]),b:$r(n[3]+n[3]),format:e?"name":"hex"};return!1}(t)),"object"==typeof t&&(Qr(t.r)&&Qr(t.g)&&Qr(t.b)?(e=t.r,n=t.g,r=t.b,i={r:255*Fr(e,255),g:255*Fr(n,255),b:255*Fr(r,255)},c=!0,h="%"===String(t.r).substr(-1)?"prgb":"rgb"):Qr(t.h)&&Qr(t.s)&&Qr(t.v)?(o=Ur(t.s),a=Ur(t.v),i=function(t,e,n){t=6*Fr(t,360),e=Fr(e,100),n=Fr(n,100);var r=Math.floor(t),i=t-r,s=n*(1-e),o=n*(1-i*e),a=n*(1-(1-i)*e),l=r%6;return{r:255*[n,o,s,s,a,n][l],g:255*[a,n,n,o,s,s][l],b:255*[s,s,a,n,n,o][l]}}(t.h,o,a),c=!0,h="hsv"):Qr(t.h)&&Qr(t.s)&&Qr(t.l)&&(o=Ur(t.s),l=Ur(t.l),i=function(t,e,n){var r,i,s;if(t=Fr(t,360),e=Fr(e,100),n=Fr(n,100),0===e)i=n,s=n,r=n;else{var o=n<.5?n*(1+e):n+e-n*e,a=2*n-o;r=zr(a,o,t+1/3),i=zr(a,o,t),s=zr(a,o,t-1/3)}return{r:255*r,g:255*i,b:255*s}}(t.h,o,l),c=!0,h="hsl"),Object.prototype.hasOwnProperty.call(t,"a")&&(s=t.a)),s=Br(s),{ok:c,format:t.format||h,r:Math.min(255,Math.max(i.r,0)),g:Math.min(255,Math.max(i.g,0)),b:Math.min(255,Math.max(i.b,0)),a:s}}var qr="(?:".concat("[-\\+]?\\d*\\.\\d+%?",")|(?:").concat("[-\\+]?\\d+%?",")"),Kr="[\\s|\\(]+(".concat(qr,")[,|\\s]+(").concat(qr,")[,|\\s]+(").concat(qr,")\\s*\\)?"),Zr="[\\s|\\(]+(".concat(qr,")[,|\\s]+(").concat(qr,")[,|\\s]+(").concat(qr,")[,|\\s]+(").concat(qr,")\\s*\\)?"),Jr={CSS_UNIT:new RegExp(qr),rgb:new RegExp("rgb"+Kr),rgba:new RegExp("rgba"+Zr),hsl:new RegExp("hsl"+Kr),hsla:new RegExp("hsla"+Zr),hsv:new RegExp("hsv"+Kr),hsva:new RegExp("hsva"+Zr),hex3:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex6:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/,hex4:/^#?([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,hex8:/^#?([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})$/};function Qr(t){return Boolean(Jr.CSS_UNIT.exec(String(t)))}var ti=function(){function t(e,n){var r;if(void 0===e&&(e=""),void 0===n&&(n={}),e instanceof t)return e;"number"==typeof e&&(e=function(t){return{r:t>>16,g:(65280&t)>>8,b:255&t}}(e)),this.originalInput=e;var i=Xr(e);this.originalInput=e,this.r=i.r,this.g=i.g,this.b=i.b,this.a=i.a,this.roundA=Math.round(100*this.a)/100,this.format=null!==(r=n.format)&&void 0!==r?r:i.format,this.gradientType=n.gradientType,this.r<1&&(this.r=Math.round(this.r)),this.g<1&&(this.g=Math.round(this.g)),this.b<1&&(this.b=Math.round(this.b)),this.isValid=i.ok}return t.prototype.isDark=function(){return this.getBrightness()<128},t.prototype.isLight=function(){return!this.isDark()},t.prototype.getBrightness=function(){var t=this.toRgb();return(299*t.r+587*t.g+114*t.b)/1e3},t.prototype.getLuminance=function(){var t=this.toRgb(),e=t.r/255,n=t.g/255,r=t.b/255;return.2126*(e<=.03928?e/12.92:Math.pow((e+.055)/1.055,2.4))+.7152*(n<=.03928?n/12.92:Math.pow((n+.055)/1.055,2.4))+.0722*(r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4))},t.prototype.getAlpha=function(){return this.a},t.prototype.setAlpha=function(t){return this.a=Br(t),this.roundA=Math.round(100*this.a)/100,this},t.prototype.isMonochrome=function(){return 0===this.toHsl().s},t.prototype.toHsv=function(){var t=Gr(this.r,this.g,this.b);return{h:360*t.h,s:t.s,v:t.v,a:this.a}},t.prototype.toHsvString=function(){var t=Gr(this.r,this.g,this.b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.v);return 1===this.a?"hsv(".concat(e,", ").concat(n,"%, ").concat(r,"%)"):"hsva(".concat(e,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},t.prototype.toHsl=function(){var t=jr(this.r,this.g,this.b);return{h:360*t.h,s:t.s,l:t.l,a:this.a}},t.prototype.toHslString=function(){var t=jr(this.r,this.g,this.b),e=Math.round(360*t.h),n=Math.round(100*t.s),r=Math.round(100*t.l);return 1===this.a?"hsl(".concat(e,", ").concat(n,"%, ").concat(r,"%)"):"hsla(".concat(e,", ").concat(n,"%, ").concat(r,"%, ").concat(this.roundA,")")},t.prototype.toHex=function(t){return void 0===t&&(t=!1),Wr(this.r,this.g,this.b,t)},t.prototype.toHexString=function(t){return void 0===t&&(t=!1),"#"+this.toHex(t)},t.prototype.toHex8=function(t){return void 0===t&&(t=!1),function(t,e,n,r,i){var s,o=[Vr(Math.round(t).toString(16)),Vr(Math.round(e).toString(16)),Vr(Math.round(n).toString(16)),Vr((s=r,Math.round(255*parseFloat(s)).toString(16)))];return i&&o[0].startsWith(o[0].charAt(1))&&o[1].startsWith(o[1].charAt(1))&&o[2].startsWith(o[2].charAt(1))&&o[3].startsWith(o[3].charAt(1))?o[0].charAt(0)+o[1].charAt(0)+o[2].charAt(0)+o[3].charAt(0):o.join("")}(this.r,this.g,this.b,this.a,t)},t.prototype.toHex8String=function(t){return void 0===t&&(t=!1),"#"+this.toHex8(t)},t.prototype.toHexShortString=function(t){return void 0===t&&(t=!1),1===this.a?this.toHexString(t):this.toHex8String(t)},t.prototype.toRgb=function(){return{r:Math.round(this.r),g:Math.round(this.g),b:Math.round(this.b),a:this.a}},t.prototype.toRgbString=function(){var t=Math.round(this.r),e=Math.round(this.g),n=Math.round(this.b);return 1===this.a?"rgb(".concat(t,", ").concat(e,", ").concat(n,")"):"rgba(".concat(t,", ").concat(e,", ").concat(n,", ").concat(this.roundA,")")},t.prototype.toPercentageRgb=function(){var t=function(t){return"".concat(Math.round(100*Fr(t,255)),"%")};return{r:t(this.r),g:t(this.g),b:t(this.b),a:this.a}},t.prototype.toPercentageRgbString=function(){var t=function(t){return Math.round(100*Fr(t,255))};return 1===this.a?"rgb(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%)"):"rgba(".concat(t(this.r),"%, ").concat(t(this.g),"%, ").concat(t(this.b),"%, ").concat(this.roundA,")")},t.prototype.toName=function(){if(0===this.a)return"transparent";if(this.a<1)return!1;for(var t="#"+Wr(this.r,this.g,this.b,!1),e=0,n=Object.entries(Yr);e<n.length;e++){var r=n[e],i=r[0];if(t===r[1])return i}return!1},t.prototype.toString=function(t){var e=Boolean(t);t=null!=t?t:this.format;var n=!1,r=this.a<1&&this.a>=0;return e||!r||!t.startsWith("hex")&&"name"!==t?("rgb"===t&&(n=this.toRgbString()),"prgb"===t&&(n=this.toPercentageRgbString()),"hex"!==t&&"hex6"!==t||(n=this.toHexString()),"hex3"===t&&(n=this.toHexString(!0)),"hex4"===t&&(n=this.toHex8String(!0)),"hex8"===t&&(n=this.toHex8String()),"name"===t&&(n=this.toName()),"hsl"===t&&(n=this.toHslString()),"hsv"===t&&(n=this.toHsvString()),n||this.toHexString()):"name"===t&&0===this.a?this.toName():this.toRgbString()},t.prototype.toNumber=function(){return(Math.round(this.r)<<16)+(Math.round(this.g)<<8)+Math.round(this.b)},t.prototype.clone=function(){return new t(this.toString())},t.prototype.lighten=function(e){void 0===e&&(e=10);var n=this.toHsl();return n.l+=e/100,n.l=Nr(n.l),new t(n)},t.prototype.brighten=function(e){void 0===e&&(e=10);var n=this.toRgb();return n.r=Math.max(0,Math.min(255,n.r-Math.round(-e/100*255))),n.g=Math.max(0,Math.min(255,n.g-Math.round(-e/100*255))),n.b=Math.max(0,Math.min(255,n.b-Math.round(-e/100*255))),new t(n)},t.prototype.darken=function(e){void 0===e&&(e=10);var n=this.toHsl();return n.l-=e/100,n.l=Nr(n.l),new t(n)},t.prototype.tint=function(t){return void 0===t&&(t=10),this.mix("white",t)},t.prototype.shade=function(t){return void 0===t&&(t=10),this.mix("black",t)},t.prototype.desaturate=function(e){void 0===e&&(e=10);var n=this.toHsl();return n.s-=e/100,n.s=Nr(n.s),new t(n)},t.prototype.saturate=function(e){void 0===e&&(e=10);var n=this.toHsl();return n.s+=e/100,n.s=Nr(n.s),new t(n)},t.prototype.greyscale=function(){return this.desaturate(100)},t.prototype.spin=function(e){var n=this.toHsl(),r=(n.h+e)%360;return n.h=r<0?360+r:r,new t(n)},t.prototype.mix=function(e,n){void 0===n&&(n=50);var r=this.toRgb(),i=new t(e).toRgb(),s=n/100;return new t({r:(i.r-r.r)*s+r.r,g:(i.g-r.g)*s+r.g,b:(i.b-r.b)*s+r.b,a:(i.a-r.a)*s+r.a})},t.prototype.analogous=function(e,n){void 0===e&&(e=6),void 0===n&&(n=30);var r=this.toHsl(),i=360/n,s=[this];for(r.h=(r.h-(i*e>>1)+720)%360;--e;)r.h=(r.h+i)%360,s.push(new t(r));return s},t.prototype.complement=function(){var e=this.toHsl();return e.h=(e.h+180)%360,new t(e)},t.prototype.monochromatic=function(e){void 0===e&&(e=6);for(var n=this.toHsv(),r=n.h,i=n.s,s=n.v,o=[],a=1/e;e--;)o.push(new t({h:r,s:i,v:s})),s=(s+a)%1;return o},t.prototype.splitcomplement=function(){var e=this.toHsl(),n=e.h;return[this,new t({h:(n+72)%360,s:e.s,l:e.l}),new t({h:(n+216)%360,s:e.s,l:e.l})]},t.prototype.onBackground=function(e){var n=this.toRgb(),r=new t(e).toRgb(),i=n.a+r.a*(1-n.a);return new t({r:(n.r*n.a+r.r*r.a*(1-n.a))/i,g:(n.g*n.a+r.g*r.a*(1-n.a))/i,b:(n.b*n.a+r.b*r.a*(1-n.a))/i,a:i})},t.prototype.triad=function(){return this.polyad(3)},t.prototype.tetrad=function(){return this.polyad(4)},t.prototype.polyad=function(e){for(var n=this.toHsl(),r=n.h,i=[this],s=360/e,o=1;o<e;o++)i.push(new t({h:(r+o*s)%360,s:n.s,l:n.l}));return i},t.prototype.equals=function(e){return this.toRgbString()===new t(e).toRgbString()},t}(),ei="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function ni(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function ri(t){if(t.__esModule)return t;var e=t.default;if("function"==typeof e){var n=function t(){return this instanceof t?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var ii={exports:{}};ii.exports=function(){var t=1e3,e=6e4,n=36e5,r="millisecond",i="second",s="minute",o="hour",a="day",l="week",c="month",h="quarter",u="year",d="date",f="Invalid Date",p=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,m=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,g={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(t){var e=["th","st","nd","rd"],n=t%100;return"["+t+(e[(n-20)%10]||e[n]||e[0])+"]"}},v=function(t,e,n){var r=String(t);return!r||r.length>=e?t:""+Array(e+1-r.length).join(n)+t},y={s:v,z:function(t){var e=-t.utcOffset(),n=Math.abs(e),r=Math.floor(n/60),i=n%60;return(e<=0?"+":"-")+v(r,2,"0")+":"+v(i,2,"0")},m:function t(e,n){if(e.date()<n.date())return-t(n,e);var r=12*(n.year()-e.year())+(n.month()-e.month()),i=e.clone().add(r,c),s=n-i<0,o=e.clone().add(r+(s?-1:1),c);return+(-(r+(n-i)/(s?i-o:o-i))||0)},a:function(t){return t<0?Math.ceil(t)||0:Math.floor(t)},p:function(t){return{M:c,y:u,w:l,d:a,D:d,h:o,m:s,s:i,ms:r,Q:h}[t]||String(t||"").toLowerCase().replace(/s$/,"")},u:function(t){return void 0===t}},b="en",x={};x[b]=g;var w="$isDayjsObject",E=function(t){return t instanceof k||!(!t||!t[w])},_=function t(e,n,r){var i;if(!e)return b;if("string"==typeof e){var s=e.toLowerCase();x[s]&&(i=s),n&&(x[s]=n,i=s);var o=e.split("-");if(!i&&o.length>1)return t(o[0])}else{var a=e.name;x[a]=e,i=a}return!r&&i&&(b=i),i||!r&&b},S=function(t,e){if(E(t))return t.clone();var n="object"==typeof e?e:{};return n.date=t,n.args=arguments,new k(n)},T=y;T.l=_,T.i=E,T.w=function(t,e){return S(t,{locale:e.$L,utc:e.$u,x:e.$x,$offset:e.$offset})};var k=function(){function g(t){this.$L=_(t.locale,null,!0),this.parse(t),this.$x=this.$x||t.x||{},this[w]=!0}var v=g.prototype;return v.parse=function(t){this.$d=function(t){var e=t.date,n=t.utc;if(null===e)return new Date(NaN);if(T.u(e))return new Date;if(e instanceof Date)return new Date(e);if("string"==typeof e&&!/Z$/i.test(e)){var r=e.match(p);if(r){var i=r[2]-1||0,s=(r[7]||"0").substring(0,3);return n?new Date(Date.UTC(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)):new Date(r[1],i,r[3]||1,r[4]||0,r[5]||0,r[6]||0,s)}}return new Date(e)}(t),this.init()},v.init=function(){var t=this.$d;this.$y=t.getFullYear(),this.$M=t.getMonth(),this.$D=t.getDate(),this.$W=t.getDay(),this.$H=t.getHours(),this.$m=t.getMinutes(),this.$s=t.getSeconds(),this.$ms=t.getMilliseconds()},v.$utils=function(){return T},v.isValid=function(){return!(this.$d.toString()===f)},v.isSame=function(t,e){var n=S(t);return this.startOf(e)<=n&&n<=this.endOf(e)},v.isAfter=function(t,e){return S(t)<this.startOf(e)},v.isBefore=function(t,e){return this.endOf(e)<S(t)},v.$g=function(t,e,n){return T.u(t)?this[e]:this.set(n,t)},v.unix=function(){return Math.floor(this.valueOf()/1e3)},v.valueOf=function(){return this.$d.getTime()},v.startOf=function(t,e){var n=this,r=!!T.u(e)||e,h=T.p(t),f=function(t,e){var i=T.w(n.$u?Date.UTC(n.$y,e,t):new Date(n.$y,e,t),n);return r?i:i.endOf(a)},p=function(t,e){return T.w(n.toDate()[t].apply(n.toDate("s"),(r?[0,0,0,0]:[23,59,59,999]).slice(e)),n)},m=this.$W,g=this.$M,v=this.$D,y="set"+(this.$u?"UTC":"");switch(h){case u:return r?f(1,0):f(31,11);case c:return r?f(1,g):f(0,g+1);case l:var b=this.$locale().weekStart||0,x=(m<b?m+7:m)-b;return f(r?v-x:v+(6-x),g);case a:case d:return p(y+"Hours",0);case o:return p(y+"Minutes",1);case s:return p(y+"Seconds",2);case i:return p(y+"Milliseconds",3);default:return this.clone()}},v.endOf=function(t){return this.startOf(t,!1)},v.$set=function(t,e){var n,l=T.p(t),h="set"+(this.$u?"UTC":""),f=(n={},n[a]=h+"Date",n[d]=h+"Date",n[c]=h+"Month",n[u]=h+"FullYear",n[o]=h+"Hours",n[s]=h+"Minutes",n[i]=h+"Seconds",n[r]=h+"Milliseconds",n)[l],p=l===a?this.$D+(e-this.$W):e;if(l===c||l===u){var m=this.clone().set(d,1);m.$d[f](p),m.init(),this.$d=m.set(d,Math.min(this.$D,m.daysInMonth())).$d}else f&&this.$d[f](p);return this.init(),this},v.set=function(t,e){return this.clone().$set(t,e)},v.get=function(t){return this[T.p(t)]()},v.add=function(r,h){var d,f=this;r=Number(r);var p=T.p(h),m=function(t){var e=S(f);return T.w(e.date(e.date()+Math.round(t*r)),f)};if(p===c)return this.set(c,this.$M+r);if(p===u)return this.set(u,this.$y+r);if(p===a)return m(1);if(p===l)return m(7);var g=(d={},d[s]=e,d[o]=n,d[i]=t,d)[p]||1,v=this.$d.getTime()+r*g;return T.w(v,this)},v.subtract=function(t,e){return this.add(-1*t,e)},v.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return n.invalidDate||f;var r=t||"YYYY-MM-DDTHH:mm:ssZ",i=T.z(this),s=this.$H,o=this.$m,a=this.$M,l=n.weekdays,c=n.months,h=n.meridiem,u=function(t,n,i,s){return t&&(t[n]||t(e,r))||i[n].slice(0,s)},d=function(t){return T.s(s%12||12,t,"0")},p=h||function(t,e,n){var r=t<12?"AM":"PM";return n?r.toLowerCase():r};return r.replace(m,(function(t,r){return r||function(t){switch(t){case"YY":return String(e.$y).slice(-2);case"YYYY":return T.s(e.$y,4,"0");case"M":return a+1;case"MM":return T.s(a+1,2,"0");case"MMM":return u(n.monthsShort,a,c,3);case"MMMM":return u(c,a);case"D":return e.$D;case"DD":return T.s(e.$D,2,"0");case"d":return String(e.$W);case"dd":return u(n.weekdaysMin,e.$W,l,2);case"ddd":return u(n.weekdaysShort,e.$W,l,3);case"dddd":return l[e.$W];case"H":return String(s);case"HH":return T.s(s,2,"0");case"h":return d(1);case"hh":return d(2);case"a":return p(s,o,!0);case"A":return p(s,o,!1);case"m":return String(o);case"mm":return T.s(o,2,"0");case"s":return String(e.$s);case"ss":return T.s(e.$s,2,"0");case"SSS":return T.s(e.$ms,3,"0");case"Z":return i}return null}(t)||i.replace(":","")}))},v.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},v.diff=function(r,d,f){var p,m=this,g=T.p(d),v=S(r),y=(v.utcOffset()-this.utcOffset())*e,b=this-v,x=function(){return T.m(m,v)};switch(g){case u:p=x()/12;break;case c:p=x();break;case h:p=x()/3;break;case l:p=(b-y)/6048e5;break;case a:p=(b-y)/864e5;break;case o:p=b/n;break;case s:p=b/e;break;case i:p=b/t;break;default:p=b}return f?p:T.a(p)},v.daysInMonth=function(){return this.endOf(c).$D},v.$locale=function(){return x[this.$L]},v.locale=function(t,e){if(!t)return this.$L;var n=this.clone(),r=_(t,e,!0);return r&&(n.$L=r),n},v.clone=function(){return T.w(this.$d,this)},v.toDate=function(){return new Date(this.valueOf())},v.toJSON=function(){return this.isValid()?this.toISOString():null},v.toISOString=function(){return this.$d.toISOString()},v.toString=function(){return this.$d.toUTCString()},g}(),A=k.prototype;return S.prototype=A,[["$ms",r],["$s",i],["$m",s],["$H",o],["$W",a],["$M",c],["$y",u],["$D",d]].forEach((function(t){A[t[1]]=function(e){return this.$g(e,t[0],t[1])}})),S.extend=function(t,e){return t.$i||(t(e,k,S),t.$i=!0),S},S.locale=_,S.isDayjs=E,S.unix=function(t){return S(1e3*t)},S.en=x[b],S.Ls=x,S.p={},S}();const si=ni(ii.exports);var oi={exports:{}};oi.exports=function(){var t={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},e=/(\[[^[]*\])|([-_:/.,()\s]+)|(A|a|YYYY|YY?|MM?M?M?|Do|DD?|hh?|HH?|mm?|ss?|S{1,3}|z|ZZ?)/g,n=/\d\d/,r=/\d\d?/,i=/\d*[^-_:/,()\s\d]+/,s={},o=function(t){return(t=+t)+(t>68?1900:2e3)},a=function(t){return function(e){this[t]=+e}},l=[/[+-]\d\d:?(\d\d)?|Z/,function(t){(this.zone||(this.zone={})).offset=function(t){if(!t)return 0;if("Z"===t)return 0;var e=t.match(/([+-]|\d\d)/g),n=60*e[1]+(+e[2]||0);return 0===n?0:"+"===e[0]?-n:n}(t)}],c=function(t){var e=s[t];return e&&(e.indexOf?e:e.s.concat(e.f))},h=function(t,e){var n,r=s.meridiem;if(r){for(var i=1;i<=24;i+=1)if(t.indexOf(r(i,0,e))>-1){n=i>12;break}}else n=t===(e?"pm":"PM");return n},u={A:[i,function(t){this.afternoon=h(t,!1)}],a:[i,function(t){this.afternoon=h(t,!0)}],S:[/\d/,function(t){this.milliseconds=100*+t}],SS:[n,function(t){this.milliseconds=10*+t}],SSS:[/\d{3}/,function(t){this.milliseconds=+t}],s:[r,a("seconds")],ss:[r,a("seconds")],m:[r,a("minutes")],mm:[r,a("minutes")],H:[r,a("hours")],h:[r,a("hours")],HH:[r,a("hours")],hh:[r,a("hours")],D:[r,a("day")],DD:[n,a("day")],Do:[i,function(t){var e=s.ordinal,n=t.match(/\d+/);if(this.day=n[0],e)for(var r=1;r<=31;r+=1)e(r).replace(/\[|\]/g,"")===t&&(this.day=r)}],M:[r,a("month")],MM:[n,a("month")],MMM:[i,function(t){var e=c("months"),n=(c("monthsShort")||e.map((function(t){return t.slice(0,3)}))).indexOf(t)+1;if(n<1)throw new Error;this.month=n%12||n}],MMMM:[i,function(t){var e=c("months").indexOf(t)+1;if(e<1)throw new Error;this.month=e%12||e}],Y:[/[+-]?\d+/,a("year")],YY:[n,function(t){this.year=o(t)}],YYYY:[/\d{4}/,a("year")],Z:l,ZZ:l};function d(n){var r,i;r=n,i=s&&s.formats;for(var o=(n=r.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,(function(e,n,r){var s=r&&r.toUpperCase();return n||i[r]||t[r]||i[s].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(t,e,n){return e||n.slice(1)}))}))).match(e),a=o.length,l=0;l<a;l+=1){var c=o[l],h=u[c],d=h&&h[0],f=h&&h[1];o[l]=f?{regex:d,parser:f}:c.replace(/^\[|\]$/g,"")}return function(t){for(var e={},n=0,r=0;n<a;n+=1){var i=o[n];if("string"==typeof i)r+=i.length;else{var s=i.regex,l=i.parser,c=t.slice(r),h=s.exec(c)[0];l.call(e,h),t=t.replace(h,"")}}return function(t){var e=t.afternoon;if(void 0!==e){var n=t.hours;e?n<12&&(t.hours+=12):12===n&&(t.hours=0),delete t.afternoon}}(e),e}}return function(t,e,n){n.p.customParseFormat=!0,t&&t.parseTwoDigitYear&&(o=t.parseTwoDigitYear);var r=e.prototype,i=r.parse;r.parse=function(t){var e=t.date,r=t.utc,o=t.args;this.$u=r;var a=o[1];if("string"==typeof a){var l=!0===o[2],c=!0===o[3],h=l||c,u=o[2];c&&(u=o[2]),s=this.$locale(),!l&&u&&(s=n.Ls[u]),this.$d=function(t,e,n){try{if(["x","X"].indexOf(e)>-1)return new Date(("X"===e?1e3:1)*t);var r=d(e)(t),i=r.year,s=r.month,o=r.day,a=r.hours,l=r.minutes,c=r.seconds,h=r.milliseconds,u=r.zone,f=new Date,p=o||(i||s?1:f.getDate()),m=i||f.getFullYear(),g=0;i&&!s||(g=s>0?s-1:f.getMonth());var v=a||0,y=l||0,b=c||0,x=h||0;return u?new Date(Date.UTC(m,g,p,v,y,b,x+60*u.offset*1e3)):n?new Date(Date.UTC(m,g,p,v,y,b,x)):new Date(m,g,p,v,y,b,x)}catch(w){return new Date("")}}(e,a,r),this.init(),u&&!0!==u&&(this.$L=this.locale(u).$L),h&&e!=this.format(a)&&(this.$d=new Date("")),s={}}else if(a instanceof Array)for(var f=a.length,p=1;p<=f;p+=1){o[1]=a[p-1];var m=n.apply(this,o);if(m.isValid()){this.$d=m.$d,this.$L=m.$L,this.init();break}p===f&&(this.$d=new Date(""))}else i.call(this,t)}}}();const ai=ni(oi.exports);var li,ci,hi,ui,di,fi,pi,mi,gi,vi,yi,bi,xi,wi,Ei,_i=!1;function Si(){if(!_i){_i=!0;var t=navigator.userAgent,e=/(?:MSIE.(\d+\.\d+))|(?:(?:Firefox|GranParadiso|Iceweasel).(\d+\.\d+))|(?:Opera(?:.+Version.|.)(\d+\.\d+))|(?:AppleWebKit.(\d+(?:\.\d+)?))|(?:Trident\/\d+\.\d+.*rv:(\d+\.\d+))/.exec(t),n=/(Mac OS X)|(Windows)|(Linux)/.exec(t);if(bi=/\b(iPhone|iP[ao]d)/.exec(t),xi=/\b(iP[ao]d)/.exec(t),vi=/Android/i.exec(t),wi=/FBAN\/\w+;/i.exec(t),Ei=/Mobile/i.exec(t),yi=!!/Win64/.exec(t),e){(li=e[1]?parseFloat(e[1]):e[5]?parseFloat(e[5]):NaN)&&document&&document.documentMode&&(li=document.documentMode);var r=/(?:Trident\/(\d+.\d+))/.exec(t);fi=r?parseFloat(r[1])+4:li,ci=e[2]?parseFloat(e[2]):NaN,hi=e[3]?parseFloat(e[3]):NaN,(ui=e[4]?parseFloat(e[4]):NaN)?(e=/(?:Chrome\/(\d+\.\d+))/.exec(t),di=e&&e[1]?parseFloat(e[1]):NaN):di=NaN}else li=ci=hi=di=ui=NaN;if(n){if(n[1]){var i=/(?:Mac OS X (\d+(?:[._]\d+)?))/.exec(t);pi=!i||parseFloat(i[1].replace("_","."))}else pi=!1;mi=!!n[2],gi=!!n[3]}else pi=mi=gi=!1}}var Ti,ki={ie:function(){return Si()||li},ieCompatibilityMode:function(){return Si()||fi>li},ie64:function(){return ki.ie()&&yi},firefox:function(){return Si()||ci},opera:function(){return Si()||hi},webkit:function(){return Si()||ui},safari:function(){return ki.webkit()},chrome:function(){return Si()||di},windows:function(){return Si()||mi},osx:function(){return Si()||pi},linux:function(){return Si()||gi},iphone:function(){return Si()||bi},mobile:function(){return Si()||bi||xi||vi||Ei},nativeApp:function(){return Si()||wi},android:function(){return Si()||vi},ipad:function(){return Si()||xi}},Ai=ki,Ci=!!(typeof window<"u"&&window.document&&window.document.createElement),Ri={canUseDOM:Ci,canUseWorkers:typeof Worker<"u",canUseEventListeners:Ci&&!(!window.addEventListener&&!window.attachEvent),canUseViewport:Ci&&!!window.screen,isInWorker:!Ci};Ri.canUseDOM&&(Ti=document.implementation&&document.implementation.hasFeature&&!0!==document.implementation.hasFeature("",""));var Mi=function(t,e){if(!Ri.canUseDOM||e&&!("addEventListener"in document))return!1;var n="on"+t,r=n in document;if(!r){var i=document.createElement("div");i.setAttribute(n,"return;"),r="function"==typeof i[n]}return!r&&Ti&&"wheel"===t&&(r=document.implementation.hasFeature("Events.wheel","3.0")),r};function Ii(t){var e=0,n=0,r=0,i=0;return"detail"in t&&(n=t.detail),"wheelDelta"in t&&(n=-t.wheelDelta/120),"wheelDeltaY"in t&&(n=-t.wheelDeltaY/120),"wheelDeltaX"in t&&(e=-t.wheelDeltaX/120),"axis"in t&&t.axis===t.HORIZONTAL_AXIS&&(e=n,n=0),r=10*e,i=10*n,"deltaY"in t&&(i=t.deltaY),"deltaX"in t&&(r=t.deltaX),(r||i)&&t.deltaMode&&(1==t.deltaMode?(r*=40,i*=40):(r*=800,i*=800)),r&&!e&&(e=r<1?-1:1),i&&!n&&(n=i<1?-1:1),{spinX:e,spinY:n,pixelX:r,pixelY:i}}Ii.getEventType=function(){return Ai.firefox()?"DOMMouseScroll":Mi("wheel")?"wheel":"mousewheel"};var Di=Ii,Oi={exports:{}};
/**
* Checks if an event is supported in the current execution environment.
*
* NOTE: This will not work correctly for non-generic events such as `change`,
* `reset`, `load`, `error`, and `select`.
*
* Borrows from Modernizr.
*
* @param {string} eventNameSuffix Event name, e.g. "click".
* @param {?boolean} capture Check if the capture phase is supported.
* @return {boolean} True if the event is supported.
* @internal
* @license Modernizr 3.0.0pre (Custom Build) | MIT
*/Oi.exports=function(t,e,n){var r=e.prototype,i=function(t){return t&&(t.indexOf?t:t.s)},s=function(t,e,n,r,s){var o=t.name?t:t.$locale(),a=i(o[e]),l=i(o[n]),c=a||l.map((function(t){return t.slice(0,r)}));if(!s)return c;var h=o.weekStart;return c.map((function(t,e){return c[(e+(h||0))%7]}))},o=function(){return n.Ls[n.locale()]},a=function(t,e){return t.formats[e]||t.formats[e.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(t,e,n){return e||n.slice(1)}))},l=function(){var t=this;return{months:function(e){return e?e.format("MMMM"):s(t,"months")},monthsShort:function(e){return e?e.format("MMM"):s(t,"monthsShort","months",3)},firstDayOfWeek:function(){return t.$locale().weekStart||0},weekdays:function(e){return e?e.format("dddd"):s(t,"weekdays")},weekdaysMin:function(e){return e?e.format("dd"):s(t,"weekdaysMin","weekdays",2)},weekdaysShort:function(e){return e?e.format("ddd"):s(t,"weekdaysShort","weekdays",3)},longDateFormat:function(e){return a(t.$locale(),e)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};r.localeData=function(){return l.bind(this)()},n.localeData=function(){var t=o();return{firstDayOfWeek:function(){return t.weekStart||0},weekdays:function(){return n.weekdays()},weekdaysShort:function(){return n.weekdaysShort()},weekdaysMin:function(){return n.weekdaysMin()},months:function(){return n.months()},monthsShort:function(){return n.monthsShort()},longDateFormat:function(e){return a(t,e)},meridiem:t.meridiem,ordinal:t.ordinal}},n.months=function(){return s(o(),"months")},n.monthsShort=function(){return s(o(),"monthsShort","months",3)},n.weekdays=function(t){return s(o(),"weekdays",null,null,t)},n.weekdaysShort=function(t){return s(o(),"weekdaysShort","weekdays",3,t)},n.weekdaysMin=function(t){return s(o(),"weekdaysMin","weekdays",2,t)}};const Pi=ni(Oi.exports);var Li={exports:{}};Li.exports=function(t,e){var n=e.prototype,r=n.format;n.format=function(t){var e=this,n=this.$locale();if(!this.isValid())return r.bind(this)(t);var i=this.$utils(),s=(t||"YYYY-MM-DDTHH:mm:ssZ").replace(/\[([^\]]+)]|Q|wo|ww|w|WW|W|zzz|z|gggg|GGGG|Do|X|x|k{1,2}|S/g,(function(t){switch(t){case"Q":return Math.ceil((e.$M+1)/3);case"Do":return n.ordinal(e.$D);case"gggg":return e.weekYear();case"GGGG":return e.isoWeekYear();case"wo":return n.ordinal(e.week(),"W");case"w":case"ww":return i.s(e.week(),"w"===t?1:2,"0");case"W":case"WW":return i.s(e.isoWeek(),"W"===t?1:2,"0");case"k":case"kk":return i.s(String(0===e.$H?24:e.$H),"k"===t?1:2,"0");case"X":return Math.floor(e.$d.getTime()/1e3);case"x":return e.$d.getTime();case"z":return"["+e.offsetName()+"]";case"zzz":return"["+e.offsetName("long")+"]";default:return t}}));return r.bind(this)(s)}};const Fi=ni(Li.exports);var Ni,Bi,Ui={exports:{}};const Vi=ni(Ui.exports=(Ni="week",Bi="year",function(t,e,n){var r=e.prototype;r.week=function(t){if(void 0===t&&(t=null),null!==t)return this.add(7*(t-this.week()),"day");var e=this.$locale().yearStart||1;if(11===this.month()&&this.date()>25){var r=n(this).startOf(Bi).add(1,Bi).date(e),i=n(this).endOf(Ni);if(r.isBefore(i))return 1}var s=n(this).startOf(Bi).date(e).startOf(Ni).subtract(1,"millisecond"),o=this.diff(s,Ni,!0);return o<0?n(this).startOf("week").week():Math.ceil(o)},r.weeks=function(t){return void 0===t&&(t=null),this.week(t)}}));var ji={exports:{}};ji.exports=function(t,e){e.prototype.weekYear=function(){var t=this.month(),e=this.week(),n=this.year();return 1===e&&11===t?n+1:0===t&&e>=52?n-1:n}};const zi=ni(ji.exports);var Gi={exports:{}};Gi.exports=function(t,e,n){e.prototype.dayOfYear=function(t){var e=Math.round((n(this).startOf("day")-n(this).startOf("year"))/864e5)+1;return null==t?e:this.add(t-e,"day")}};const Wi=ni(Gi.exports);var Hi={exports:{}};Hi.exports=function(t,e){e.prototype.isSameOrAfter=function(t,e){return this.isSame(t,e)||this.isAfter(t,e)}};const $i=ni(Hi.exports);var Yi={exports:{}};const Xi=ni(Yi.exports=function(t,e){e.prototype.isSameOrBefore=function(t,e){return this.isSame(t,e)||this.isBefore(t,e)}});var qi=Number.isNaN||function(t){return"number"==typeof t&&t!=t};function Ki(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(r=t[n],i=e[n],!(r===i||qi(r)&&qi(i)))return!1;var r,i;return!0}function Zi(t,e){void 0===e&&(e=Ki);var n=null;function r(){for(var r=[],i=0;i<arguments.length;i++)r[i]=arguments[i];if(n&&n.lastThis===this&&e(r,n.lastArgs))return n.lastResult;var s=t.apply(this,r);return n={lastResult:s,lastArgs:r,lastThis:this},s}return r.clear=function(){n=null},r}
/*!
 * escape-html
 * Copyright(c) 2012-2013 TJ Holowaychuk
 * Copyright(c) 2015 Andreas Lubbe
 * Copyright(c) 2015 Tiancheng "Timothy" Gu
 * MIT Licensed
 */var Ji=/["'&<>]/;const Qi=ni((function(t){var e,n=""+t,r=Ji.exec(n);if(!r)return n;var i="",s=0,o=0;for(s=r.index;s<n.length;s++){switch(n.charCodeAt(s)){case 34:e="&quot;";break;case 38:e="&amp;";break;case 39:e="&#39;";break;case 60:e="&lt;";break;case 62:e="&gt;";break;default:continue}o!==s&&(i+=n.substring(o,s)),o=s+1,i+=e}return o!==s?i+n.substring(o,s):i}));var ts,es="undefined"!=typeof Symbol&&Symbol,ns=function(){if("function"!=typeof Symbol||"function"!=typeof Object.getOwnPropertySymbols)return!1;if("symbol"==typeof Symbol.iterator)return!0;var t={},e=Symbol("test"),n=Object(e);if("string"==typeof e)return!1;if("[object Symbol]"!==Object.prototype.toString.call(e))return!1;if("[object Symbol]"!==Object.prototype.toString.call(n))return!1;for(e in t[e]=42,t)return!1;if("function"==typeof Object.keys&&0!==Object.keys(t).length)return!1;if("function"==typeof Object.getOwnPropertyNames&&0!==Object.getOwnPropertyNames(t).length)return!1;var r=Object.getOwnPropertySymbols(t);if(1!==r.length||r[0]!==e)return!1;if(!Object.prototype.propertyIsEnumerable.call(t,e))return!1;if("function"==typeof Object.getOwnPropertyDescriptor){var i=Object.getOwnPropertyDescriptor(t,e);if(42!==i.value||!0!==i.enumerable)return!1}return!0},rs={foo:{}},is=Object,ss=Object.prototype.toString,as=Math.max,ls=function(t,e){for(var n=[],r=0;r<t.length;r+=1)n[r]=t[r];for(var i=0;i<e.length;i+=1)n[i+t.length]=e[i];return n},cs=function(t){var e=this;if("function"!=typeof e||"[object Function]"!==ss.apply(e))throw new TypeError("Function.prototype.bind called on incompatible "+e);for(var n,r=function(t,e){for(var n=[],r=e||0,i=0;r<t.length;r+=1,i+=1)n[i]=t[r];return n}(arguments,1),i=as(0,e.length-r.length),s=[],o=0;o<i;o++)s[o]="$"+o;if(n=Function("binder","return function ("+function(t,e){for(var n="",r=0;r<t.length;r+=1)n+=t[r],r+1<t.length&&(n+=e);return n}(s,",")+"){ return binder.apply(this,arguments); }")((function(){if(this instanceof n){var i=e.apply(this,ls(r,arguments));return Object(i)===i?i:this}return e.apply(t,ls(r,arguments))})),e.prototype){var a=function(){};a.prototype=e.prototype,n.prototype=new a,a.prototype=null}return n},hs=Function.prototype.bind||cs,us={}.hasOwnProperty,ds=Function.prototype.call,fs=ds.bind?ds.bind(us):function(t,e){return ds.call(us,t,e)},ps=SyntaxError,ms=Function,gs=TypeError,vs=function(t){try{return ms('"use strict"; return ('+t+").constructor;")()}catch(Ni){}},ys=Object.getOwnPropertyDescriptor;if(ys)try{ys({},"")}catch(Ni){ys=null}var bs=function(){throw new gs},xs=ys?function(){try{return bs}catch(t){try{return ys(arguments,"callee").get}catch(e){return bs}}}():bs,ws="function"==typeof es&&"function"==typeof Symbol&&"symbol"==typeof es("foo")&&"symbol"==typeof Symbol("bar")&&ns(),Es={__proto__:rs}.foo===rs.foo&&!({__proto__:null}instanceof is),_s=Object.getPrototypeOf||(Es?function(t){return t.__proto__}:null),Ss={},Ts="undefined"!=typeof Uint8Array&&_s?_s(Uint8Array):ts,ks={"%AggregateError%":"undefined"==typeof AggregateError?ts:AggregateError,"%Array%":Array,"%ArrayBuffer%":"undefined"==typeof ArrayBuffer?ts:ArrayBuffer,"%ArrayIteratorPrototype%":ws&&_s?_s([][Symbol.iterator]()):ts,"%AsyncFromSyncIteratorPrototype%":ts,"%AsyncFunction%":Ss,"%AsyncGenerator%":Ss,"%AsyncGeneratorFunction%":Ss,"%AsyncIteratorPrototype%":Ss,"%Atomics%":"undefined"==typeof Atomics?ts:Atomics,"%BigInt%":"undefined"==typeof BigInt?ts:BigInt,"%BigInt64Array%":"undefined"==typeof BigInt64Array?ts:BigInt64Array,"%BigUint64Array%":"undefined"==typeof BigUint64Array?ts:BigUint64Array,"%Boolean%":Boolean,"%DataView%":"undefined"==typeof DataView?ts:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":"undefined"==typeof Float32Array?ts:Float32Array,"%Float64Array%":"undefined"==typeof Float64Array?ts:Float64Array,"%FinalizationRegistry%":"undefined"==typeof FinalizationRegistry?ts:FinalizationRegistry,"%Function%":ms,"%GeneratorFunction%":Ss,"%Int8Array%":"undefined"==typeof Int8Array?ts:Int8Array,"%Int16Array%":"undefined"==typeof Int16Array?ts:Int16Array,"%Int32Array%":"undefined"==typeof Int32Array?ts:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":ws&&_s?_s(_s([][Symbol.iterator]())):ts,"%JSON%":"object"==typeof JSON?JSON:ts,"%Map%":"undefined"==typeof Map?ts:Map,"%MapIteratorPrototype%":"undefined"!=typeof Map&&ws&&_s?_s((new Map)[Symbol.iterator]()):ts,"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":"undefined"==typeof Promise?ts:Promise,"%Proxy%":"undefined"==typeof Proxy?ts:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":"undefined"==typeof Reflect?ts:Reflect,"%RegExp%":RegExp,"%Set%":"undefined"==typeof Set?ts:Set,"%SetIteratorPrototype%":"undefined"!=typeof Set&&ws&&_s?_s((new Set)[Symbol.iterator]()):ts,"%SharedArrayBuffer%":"undefined"==typeof SharedArrayBuffer?ts:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":ws&&_s?_s(""[Symbol.iterator]()):ts,"%Symbol%":ws?Symbol:ts,"%SyntaxError%":ps,"%ThrowTypeError%":xs,"%TypedArray%":Ts,"%TypeError%":gs,"%Uint8Array%":"undefined"==typeof Uint8Array?ts:Uint8Array,"%Uint8ClampedArray%":"undefined"==typeof Uint8ClampedArray?ts:Uint8ClampedArray,"%Uint16Array%":"undefined"==typeof Uint16Array?ts:Uint16Array,"%Uint32Array%":"undefined"==typeof Uint32Array?ts:Uint32Array,"%URIError%":URIError,"%WeakMap%":"undefined"==typeof WeakMap?ts:WeakMap,"%WeakRef%":"undefined"==typeof WeakRef?ts:WeakRef,"%WeakSet%":"undefined"==typeof WeakSet?ts:WeakSet};if(_s)try{null.error}catch(Ni){var As=_s(_s(Ni));ks["%Error.prototype%"]=As}var Cs=function t(e){var n;if("%AsyncFunction%"===e)n=vs("async function () {}");else if("%GeneratorFunction%"===e)n=vs("function* () {}");else if("%AsyncGeneratorFunction%"===e)n=vs("async function* () {}");else if("%AsyncGenerator%"===e){var r=t("%AsyncGeneratorFunction%");r&&(n=r.prototype)}else if("%AsyncIteratorPrototype%"===e){var i=t("%AsyncGenerator%");i&&_s&&(n=_s(i.prototype))}return ks[e]=n,n},Rs={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]},Ms=hs,Is=fs,Ds=Ms.call(Function.call,Array.prototype.concat),Os=Ms.call(Function.apply,Array.prototype.splice),Ps=Ms.call(Function.call,String.prototype.replace),Ls=Ms.call(Function.call,String.prototype.slice),Fs=Ms.call(Function.call,RegExp.prototype.exec),Ns=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g,Bs=/\\(\\)?/g,Us=function(t,e){var n,r=t;if(Is(Rs,r)&&(r="%"+(n=Rs[r])[0]+"%"),Is(ks,r)){var i=ks[r];if(i===Ss&&(i=Cs(r)),void 0===i&&!e)throw new gs("intrinsic "+t+" exists, but is not available. Please file an issue!");return{alias:n,name:r,value:i}}throw new ps("intrinsic "+t+" does not exist!")},Vs=function(t,e){if("string"!=typeof t||0===t.length)throw new gs("intrinsic name must be a non-empty string");if(arguments.length>1&&"boolean"!=typeof e)throw new gs('"allowMissing" argument must be a boolean');if(null===Fs(/^%?[^%]*%?$/,t))throw new ps("`%` may not be present anywhere but at the beginning and end of the intrinsic name");var n=function(t){var e=Ls(t,0,1),n=Ls(t,-1);if("%"===e&&"%"!==n)throw new ps("invalid intrinsic syntax, expected closing `%`");if("%"===n&&"%"!==e)throw new ps("invalid intrinsic syntax, expected opening `%`");var r=[];return Ps(t,Ns,(function(t,e,n,i){r[r.length]=n?Ps(i,Bs,"$1"):e||t})),r}(t),r=n.length>0?n[0]:"",i=Us("%"+r+"%",e),s=i.name,o=i.value,a=!1,l=i.alias;l&&(r=l[0],Os(n,Ds([0,1],l)));for(var c=1,h=!0;c<n.length;c+=1){var u=n[c],d=Ls(u,0,1),f=Ls(u,-1);if(('"'===d||"'"===d||"`"===d||'"'===f||"'"===f||"`"===f)&&d!==f)throw new ps("property names with quotes must have matching quotes");if("constructor"!==u&&h||(a=!0),Is(ks,s="%"+(r+="."+u)+"%"))o=ks[s];else if(null!=o){if(!(u in o)){if(!e)throw new gs("base intrinsic for "+t+" exists, but the property is not available.");return}if(ys&&c+1>=n.length){var p=ys(o,u);o=(h=!!p)&&"get"in p&&!("originalValue"in p.get)?p.get:o[u]}else h=Is(o,u),o=o[u];h&&!a&&(ks[s]=o)}}return o},js={exports:{}};!function(t){var e=hs,n=Vs,r=n("%Function.prototype.apply%"),i=n("%Function.prototype.call%"),s=n("%Reflect.apply%",!0)||e.call(i,r),o=n("%Object.getOwnPropertyDescriptor%",!0),a=n("%Object.defineProperty%",!0),l=n("%Math.max%");if(a)try{a({},"a",{value:1})}catch(Ni){a=null}t.exports=function(t){var n=s(e,i,arguments);o&&a&&(o(n,"length").configurable&&a(n,"length",{value:1+l(0,t.length-(arguments.length-1))}));return n};var c=function(){return s(e,r,arguments)};a?a(t.exports,"apply",{value:c}):t.exports.apply=c}(js);var zs=Vs,Gs=js.exports,Ws=Gs(zs("String.prototype.indexOf"));const Hs=ri(Object.freeze(Object.defineProperty({__proto__:null,default:{}},Symbol.toStringTag,{value:"Module"})));var $s="function"==typeof Map&&Map.prototype,Ys=Object.getOwnPropertyDescriptor&&$s?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null,Xs=$s&&Ys&&"function"==typeof Ys.get?Ys.get:null,qs=$s&&Map.prototype.forEach,Ks="function"==typeof Set&&Set.prototype,Zs=Object.getOwnPropertyDescriptor&&Ks?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null,Js=Ks&&Zs&&"function"==typeof Zs.get?Zs.get:null,Qs=Ks&&Set.prototype.forEach,to="function"==typeof WeakMap&&WeakMap.prototype?WeakMap.prototype.has:null,eo="function"==typeof WeakSet&&WeakSet.prototype?WeakSet.prototype.has:null,no="function"==typeof WeakRef&&WeakRef.prototype?WeakRef.prototype.deref:null,ro=Boolean.prototype.valueOf,io=Object.prototype.toString,so=Function.prototype.toString,oo=String.prototype.match,ao=String.prototype.slice,lo=String.prototype.replace,co=String.prototype.toUpperCase,ho=String.prototype.toLowerCase,uo=RegExp.prototype.test,fo=Array.prototype.concat,po=Array.prototype.join,mo=Array.prototype.slice,go=Math.floor,vo="function"==typeof BigInt?BigInt.prototype.valueOf:null,yo=Object.getOwnPropertySymbols,bo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?Symbol.prototype.toString:null,xo="function"==typeof Symbol&&"object"==typeof Symbol.iterator,wo="function"==typeof Symbol&&Symbol.toStringTag&&(typeof Symbol.toStringTag===xo||"symbol")?Symbol.toStringTag:null,Eo=Object.prototype.propertyIsEnumerable,_o=("function"==typeof Reflect?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(t){return t.__proto__}:null);function So(t,e){if(t===1/0||t===-1/0||t!=t||t&&t>-1e3&&t<1e3||uo.call(/e/,e))return e;var n=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if("number"==typeof t){var r=t<0?-go(-t):go(t);if(r!==t){var i=String(r),s=ao.call(e,i.length+1);return lo.call(i,n,"$&_")+"."+lo.call(lo.call(s,/([0-9]{3})/g,"$&_"),/_$/,"")}}return lo.call(e,n,"$&_")}var To=Hs,ko=To.custom,Ao=Do(ko)?ko:null;function Co(t,e,n){var r="double"===(n.quoteStyle||e)?'"':"'";return r+t+r}function Ro(t){return lo.call(String(t),/"/g,"&quot;")}function Mo(t){return!("[object Array]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}function Io(t){return!("[object RegExp]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}function Do(t){if(xo)return t&&"object"==typeof t&&t instanceof Symbol;if("symbol"==typeof t)return!0;if(!t||"object"!=typeof t||!bo)return!1;try{return bo.call(t),!0}catch(Ni){}return!1}var Oo=Object.prototype.hasOwnProperty||function(t){return t in this};function Po(t,e){return Oo.call(t,e)}function Lo(t){return io.call(t)}function Fo(t,e){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n;return-1}function No(t,e){if(t.length>e.maxStringLength){var n=t.length-e.maxStringLength,r="... "+n+" more character"+(n>1?"s":"");return No(ao.call(t,0,e.maxStringLength),e)+r}return Co(lo.call(lo.call(t,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,Bo),"single",e)}function Bo(t){var e=t.charCodeAt(0),n={8:"b",9:"t",10:"n",12:"f",13:"r"}[e];return n?"\\"+n:"\\x"+(e<16?"0":"")+co.call(e.toString(16))}function Uo(t){return"Object("+t+")"}function Vo(t){return t+" { ? }"}function jo(t,e,n,r){return t+" ("+e+") {"+(r?zo(n,r):po.call(n,", "))+"}"}function zo(t,e){if(0===t.length)return"";var n="\n"+e.prev+e.base;return n+po.call(t,","+n)+"\n"+e.prev}function Go(t,e){var n=Mo(t),r=[];if(n){r.length=t.length;for(var i=0;i<t.length;i++)r[i]=Po(t,i)?e(t[i],t):""}var s,o="function"==typeof yo?yo(t):[];if(xo){s={};for(var a=0;a<o.length;a++)s["$"+o[a]]=o[a]}for(var l in t)Po(t,l)&&(n&&String(Number(l))===l&&l<t.length||xo&&s["$"+l]instanceof Symbol||(uo.call(/[^\w$]/,l)?r.push(e(l,t)+": "+e(t[l],t)):r.push(l+": "+e(t[l],t))));if("function"==typeof yo)for(var c=0;c<o.length;c++)Eo.call(t,o[c])&&r.push("["+e(o[c])+"]: "+e(t[o[c]],t));return r}var Wo=Vs,Ho=function(t,e){var n=zs(t,!!e);return"function"==typeof n&&Ws(t,".prototype.")>-1?Gs(n):n},$o=function t(e,n,r,i){var s=n||{};if(Po(s,"quoteStyle")&&"single"!==s.quoteStyle&&"double"!==s.quoteStyle)throw new TypeError('option "quoteStyle" must be "single" or "double"');if(Po(s,"maxStringLength")&&("number"==typeof s.maxStringLength?s.maxStringLength<0&&s.maxStringLength!==1/0:null!==s.maxStringLength))throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`');var o=!Po(s,"customInspect")||s.customInspect;if("boolean"!=typeof o&&"symbol"!==o)throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`");if(Po(s,"indent")&&null!==s.indent&&"\t"!==s.indent&&!(parseInt(s.indent,10)===s.indent&&s.indent>0))throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`');if(Po(s,"numericSeparator")&&"boolean"!=typeof s.numericSeparator)throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`');var a=s.numericSeparator;if(void 0===e)return"undefined";if(null===e)return"null";if("boolean"==typeof e)return e?"true":"false";if("string"==typeof e)return No(e,s);if("number"==typeof e){if(0===e)return 1/0/e>0?"0":"-0";var l=String(e);return a?So(e,l):l}if("bigint"==typeof e){var c=String(e)+"n";return a?So(e,c):c}var h=void 0===s.depth?5:s.depth;if(void 0===r&&(r=0),r>=h&&h>0&&"object"==typeof e)return Mo(e)?"[Array]":"[Object]";var u=function(t,e){var n;if("\t"===t.indent)n="\t";else{if(!("number"==typeof t.indent&&t.indent>0))return null;n=po.call(Array(t.indent+1)," ")}return{base:n,prev:po.call(Array(e+1),n)}}(s,r);if(void 0===i)i=[];else if(Fo(i,e)>=0)return"[Circular]";function d(e,n,o){if(n&&(i=mo.call(i)).push(n),o){var a={depth:s.depth};return Po(s,"quoteStyle")&&(a.quoteStyle=s.quoteStyle),t(e,a,r+1,i)}return t(e,s,r+1,i)}if("function"==typeof e&&!Io(e)){var f=function(t){if(t.name)return t.name;var e=oo.call(so.call(t),/^function\s*([\w$]+)/);if(e)return e[1];return null}(e),p=Go(e,d);return"[Function"+(f?": "+f:" (anonymous)")+"]"+(p.length>0?" { "+po.call(p,", ")+" }":"")}if(Do(e)){var m=xo?lo.call(String(e),/^(Symbol\(.*\))_[^)]*$/,"$1"):bo.call(e);return"object"!=typeof e||xo?m:Uo(m)}if(function(t){if(!t||"object"!=typeof t)return!1;if("undefined"!=typeof HTMLElement&&t instanceof HTMLElement)return!0;return"string"==typeof t.nodeName&&"function"==typeof t.getAttribute}(e)){for(var g="<"+ho.call(String(e.nodeName)),v=e.attributes||[],y=0;y<v.length;y++)g+=" "+v[y].name+"="+Co(Ro(v[y].value),"double",s);return g+=">",e.childNodes&&e.childNodes.length&&(g+="..."),g+="</"+ho.call(String(e.nodeName))+">"}if(Mo(e)){if(0===e.length)return"[]";var b=Go(e,d);return u&&!function(t){for(var e=0;e<t.length;e++)if(Fo(t[e],"\n")>=0)return!1;return!0}(b)?"["+zo(b,u)+"]":"[ "+po.call(b,", ")+" ]"}if(function(t){return!("[object Error]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}(e)){var x=Go(e,d);return"cause"in Error.prototype||!("cause"in e)||Eo.call(e,"cause")?0===x.length?"["+String(e)+"]":"{ ["+String(e)+"] "+po.call(x,", ")+" }":"{ ["+String(e)+"] "+po.call(fo.call("[cause]: "+d(e.cause),x),", ")+" }"}if("object"==typeof e&&o){if(Ao&&"function"==typeof e[Ao]&&To)return To(e,{depth:h-r});if("symbol"!==o&&"function"==typeof e.inspect)return e.inspect()}if(function(t){if(!Xs||!t||"object"!=typeof t)return!1;try{Xs.call(t);try{Js.call(t)}catch(g){return!0}return t instanceof Map}catch(Ni){}return!1}(e)){var w=[];return qs&&qs.call(e,(function(t,n){w.push(d(n,e,!0)+" => "+d(t,e))})),jo("Map",Xs.call(e),w,u)}if(function(t){if(!Js||!t||"object"!=typeof t)return!1;try{Js.call(t);try{Xs.call(t)}catch(e){return!0}return t instanceof Set}catch(Ni){}return!1}(e)){var E=[];return Qs&&Qs.call(e,(function(t){E.push(d(t,e))})),jo("Set",Js.call(e),E,u)}if(function(t){if(!to||!t||"object"!=typeof t)return!1;try{to.call(t,to);try{eo.call(t,eo)}catch(g){return!0}return t instanceof WeakMap}catch(Ni){}return!1}(e))return Vo("WeakMap");if(function(t){if(!eo||!t||"object"!=typeof t)return!1;try{eo.call(t,eo);try{to.call(t,to)}catch(g){return!0}return t instanceof WeakSet}catch(Ni){}return!1}(e))return Vo("WeakSet");if(function(t){if(!no||!t||"object"!=typeof t)return!1;try{return no.call(t),!0}catch(Ni){}return!1}(e))return Vo("WeakRef");if(function(t){return!("[object Number]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}(e))return Uo(d(Number(e)));if(function(t){if(!t||"object"!=typeof t||!vo)return!1;try{return vo.call(t),!0}catch(Ni){}return!1}(e))return Uo(d(vo.call(e)));if(function(t){return!("[object Boolean]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}(e))return Uo(ro.call(e));if(function(t){return!("[object String]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}(e))return Uo(d(String(e)));if(e===ei)return"undefined"!=typeof window?"{ [object Window] }":"{ [object global] }";if(!function(t){return!("[object Date]"!==Lo(t)||wo&&"object"==typeof t&&wo in t)}(e)&&!Io(e)){var _=Go(e,d),S=_o?_o(e)===Object.prototype:e instanceof Object||e.constructor===Object,T=e instanceof Object?"":"null prototype",k=!S&&wo&&Object(e)===e&&wo in e?ao.call(Lo(e),8,-1):T?"Object":"",A=(S||"function"!=typeof e.constructor?"":e.constructor.name?e.constructor.name+" ":"")+(k||T?"["+po.call(fo.call([],k||[],T||[]),": ")+"] ":"");return 0===_.length?A+"{}":u?A+"{"+zo(_,u)+"}":A+"{ "+po.call(_,", ")+" }"}return String(e)},Yo=Wo("%TypeError%"),Xo=Wo("%WeakMap%",!0),qo=Wo("%Map%",!0),Ko=Ho("WeakMap.prototype.get",!0),Zo=Ho("WeakMap.prototype.set",!0),Jo=Ho("WeakMap.prototype.has",!0),Qo=Ho("Map.prototype.get",!0),ta=Ho("Map.prototype.set",!0),ea=Ho("Map.prototype.has",!0),na=function(t,e){for(var n,r=t;null!==(n=r.next);r=n)if(n.key===e)return r.next=n.next,n.next=t.next,t.next=n,n},ra=String.prototype.replace,ia=/%20/g,sa="RFC3986",oa={default:sa,formatters:{RFC1738:function(t){return ra.call(t,ia,"+")},RFC3986:function(t){return String(t)}},RFC1738:"RFC1738",RFC3986:sa},aa=oa,la=Object.prototype.hasOwnProperty,ca=Array.isArray,ha=function(){for(var t=[],e=0;e<256;++e)t.push("%"+((e<16?"0":"")+e.toString(16)).toUpperCase());return t}(),ua=function(t,e){for(var n=e&&e.plainObjects?Object.create(null):{},r=0;r<t.length;++r)void 0!==t[r]&&(n[r]=t[r]);return n},da={arrayToObject:ua,assign:function(t,e){return Object.keys(e).reduce((function(t,n){return t[n]=e[n],t}),t)},combine:function(t,e){return[].concat(t,e)},compact:function(t){for(var e=[{obj:{o:t},prop:"o"}],n=[],r=0;r<e.length;++r)for(var i=e[r],s=i.obj[i.prop],o=Object.keys(s),a=0;a<o.length;++a){var l=o[a],c=s[l];"object"==typeof c&&null!==c&&-1===n.indexOf(c)&&(e.push({obj:s,prop:l}),n.push(c))}return function(t){for(;t.length>1;){var e=t.pop(),n=e.obj[e.prop];if(ca(n)){for(var r=[],i=0;i<n.length;++i)void 0!==n[i]&&r.push(n[i]);e.obj[e.prop]=r}}}(e),t},decode:function(t,e,n){var r=t.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(Ni){return r}},encode:function(t,e,n,r,i){if(0===t.length)return t;var s=t;if("symbol"==typeof t?s=Symbol.prototype.toString.call(t):"string"!=typeof t&&(s=String(t)),"iso-8859-1"===n)return escape(s).replace(/%u[0-9a-f]{4}/gi,(function(t){return"%26%23"+parseInt(t.slice(2),16)+"%3B"}));for(var o="",a=0;a<s.length;++a){var l=s.charCodeAt(a);45===l||46===l||95===l||126===l||l>=48&&l<=57||l>=65&&l<=90||l>=97&&l<=122||i===aa.RFC1738&&(40===l||41===l)?o+=s.charAt(a):l<128?o+=ha[l]:l<2048?o+=ha[192|l>>6]+ha[128|63&l]:l<55296||l>=57344?o+=ha[224|l>>12]+ha[128|l>>6&63]+ha[128|63&l]:(a+=1,l=65536+((1023&l)<<10|1023&s.charCodeAt(a)),o+=ha[240|l>>18]+ha[128|l>>12&63]+ha[128|l>>6&63]+ha[128|63&l])}return o},isBuffer:function(t){return!(!t||"object"!=typeof t)&&!!(t.constructor&&t.constructor.isBuffer&&t.constructor.isBuffer(t))},isRegExp:function(t){return"[object RegExp]"===Object.prototype.toString.call(t)},maybeMap:function(t,e){if(ca(t)){for(var n=[],r=0;r<t.length;r+=1)n.push(e(t[r]));return n}return e(t)},merge:function t(e,n,r){if(!n)return e;if("object"!=typeof n){if(ca(e))e.push(n);else{if(!e||"object"!=typeof e)return[e,n];(r&&(r.plainObjects||r.allowPrototypes)||!la.call(Object.prototype,n))&&(e[n]=!0)}return e}if(!e||"object"!=typeof e)return[e].concat(n);var i=e;return ca(e)&&!ca(n)&&(i=ua(e,r)),ca(e)&&ca(n)?(n.forEach((function(n,i){if(la.call(e,i)){var s=e[i];s&&"object"==typeof s&&n&&"object"==typeof n?e[i]=t(s,n,r):e.push(n)}else e[i]=n})),e):Object.keys(n).reduce((function(e,i){var s=n[i];return la.call(e,i)?e[i]=t(e[i],s,r):e[i]=s,e}),i)}},fa=function(){var t,e,n,r={assert:function(t){if(!r.has(t))throw new Yo("Side channel does not contain "+$o(t))},get:function(r){if(Xo&&r&&("object"==typeof r||"function"==typeof r)){if(t)return Ko(t,r)}else if(qo){if(e)return Qo(e,r)}else if(n)return function(t,e){var n=na(t,e);return n&&n.value}(n,r)},has:function(r){if(Xo&&r&&("object"==typeof r||"function"==typeof r)){if(t)return Jo(t,r)}else if(qo){if(e)return ea(e,r)}else if(n)return function(t,e){return!!na(t,e)}(n,r);return!1},set:function(r,i){Xo&&r&&("object"==typeof r||"function"==typeof r)?(t||(t=new Xo),Zo(t,r,i)):qo?(e||(e=new qo),ta(e,r,i)):(n||(n={key:{},next:null}),function(t,e,n){var r=na(t,e);r?r.value=n:t.next={key:e,next:t.next,value:n}}(n,r,i))}};return r},pa=da,ma=oa,ga=Object.prototype.hasOwnProperty,va={brackets:function(t){return t+"[]"},comma:"comma",indices:function(t,e){return t+"["+e+"]"},repeat:function(t){return t}},ya=Array.isArray,ba=Array.prototype.push,xa=function(t,e){ba.apply(t,ya(e)?e:[e])},wa=Date.prototype.toISOString,Ea=ma.default,_a={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:pa.encode,encodeValuesOnly:!1,format:Ea,formatter:ma.formatters[Ea],indices:!1,serializeDate:function(t){return wa.call(t)},skipNulls:!1,strictNullHandling:!1},Sa={},Ta=function t(e,n,r,i,s,o,a,l,c,h,u,d,f,p,m,g){for(var v,y=e,b=g,x=0,w=!1;void 0!==(b=b.get(Sa))&&!w;){var E=b.get(e);if(x+=1,void 0!==E){if(E===x)throw new RangeError("Cyclic object value");w=!0}void 0===b.get(Sa)&&(x=0)}if("function"==typeof l?y=l(n,y):y instanceof Date?y=u(y):"comma"===r&&ya(y)&&(y=pa.maybeMap(y,(function(t){return t instanceof Date?u(t):t}))),null===y){if(s)return a&&!p?a(n,_a.encoder,m,"key",d):n;y=""}if("string"==typeof(v=y)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||pa.isBuffer(y))return a?[f(p?n:a(n,_a.encoder,m,"key",d))+"="+f(a(y,_a.encoder,m,"value",d))]:[f(n)+"="+f(String(y))];var _,S=[];if(void 0===y)return S;if("comma"===r&&ya(y))p&&a&&(y=pa.maybeMap(y,a)),_=[{value:y.length>0?y.join(",")||null:void 0}];else if(ya(l))_=l;else{var T=Object.keys(y);_=c?T.sort(c):T}for(var k=i&&ya(y)&&1===y.length?n+"[]":n,A=0;A<_.length;++A){var C=_[A],R="object"==typeof C&&void 0!==C.value?C.value:y[C];if(!o||null!==R){var M=ya(y)?"function"==typeof r?r(k,C):k:k+(h?"."+C:"["+C+"]");g.set(e,x);var I=fa();I.set(Sa,g),xa(S,t(R,M,r,i,s,o,"comma"===r&&p&&ya(y)?null:a,l,c,h,u,d,f,p,m,I))}}return S},ka=da,Aa=Object.prototype.hasOwnProperty,Ca=Array.isArray,Ra={allowDots:!1,allowPrototypes:!1,allowSparse:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:ka.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},Ma=function(t){return t.replace(/&#(\d+);/g,(function(t,e){return String.fromCharCode(parseInt(e,10))}))},Ia=function(t,e){return t&&"string"==typeof t&&e.comma&&t.indexOf(",")>-1?t.split(","):t},Da=function(t,e,n,r){if(t){var i=n.allowDots?t.replace(/\.([^.[]+)/g,"[$1]"):t,s=/(\[[^[\]]*])/g,o=n.depth>0&&/(\[[^[\]]*])/.exec(i),a=o?i.slice(0,o.index):i,l=[];if(a){if(!n.plainObjects&&Aa.call(Object.prototype,a)&&!n.allowPrototypes)return;l.push(a)}for(var c=0;n.depth>0&&null!==(o=s.exec(i))&&c<n.depth;){if(c+=1,!n.plainObjects&&Aa.call(Object.prototype,o[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(o[1])}return o&&l.push("["+i.slice(o.index)+"]"),function(t,e,n,r){for(var i=r?e:Ia(e,n),s=t.length-1;s>=0;--s){var o,a=t[s];if("[]"===a&&n.parseArrays)o=[].concat(i);else{o=n.plainObjects?Object.create(null):{};var l="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,c=parseInt(l,10);n.parseArrays||""!==l?!isNaN(c)&&a!==l&&String(c)===l&&c>=0&&n.parseArrays&&c<=n.arrayLimit?(o=[])[c]=i:"__proto__"!==l&&(o[l]=i):o={0:i}}i=o}return i}(l,e,n,r)}},Oa={formats:oa,parse:function(t,e){var n=function(t){if(!t)return Ra;if(null!==t.decoder&&void 0!==t.decoder&&"function"!=typeof t.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var e=void 0===t.charset?Ra.charset:t.charset;return{allowDots:void 0===t.allowDots?Ra.allowDots:!!t.allowDots,allowPrototypes:"boolean"==typeof t.allowPrototypes?t.allowPrototypes:Ra.allowPrototypes,allowSparse:"boolean"==typeof t.allowSparse?t.allowSparse:Ra.allowSparse,arrayLimit:"number"==typeof t.arrayLimit?t.arrayLimit:Ra.arrayLimit,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:Ra.charsetSentinel,comma:"boolean"==typeof t.comma?t.comma:Ra.comma,decoder:"function"==typeof t.decoder?t.decoder:Ra.decoder,delimiter:"string"==typeof t.delimiter||ka.isRegExp(t.delimiter)?t.delimiter:Ra.delimiter,depth:"number"==typeof t.depth||!1===t.depth?+t.depth:Ra.depth,ignoreQueryPrefix:!0===t.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof t.interpretNumericEntities?t.interpretNumericEntities:Ra.interpretNumericEntities,parameterLimit:"number"==typeof t.parameterLimit?t.parameterLimit:Ra.parameterLimit,parseArrays:!1!==t.parseArrays,plainObjects:"boolean"==typeof t.plainObjects?t.plainObjects:Ra.plainObjects,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:Ra.strictNullHandling}}(e);if(""===t||null==t)return n.plainObjects?Object.create(null):{};for(var r="string"==typeof t?function(t,e){var n,r={__proto__:null},i=e.ignoreQueryPrefix?t.replace(/^\?/,""):t,s=e.parameterLimit===1/0?void 0:e.parameterLimit,o=i.split(e.delimiter,s),a=-1,l=e.charset;if(e.charsetSentinel)for(n=0;n<o.length;++n)0===o[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===o[n]?l="utf-8":"utf8=%26%2310003%3B"===o[n]&&(l="iso-8859-1"),a=n,n=o.length);for(n=0;n<o.length;++n)if(n!==a){var c,h,u=o[n],d=u.indexOf("]="),f=-1===d?u.indexOf("="):d+1;-1===f?(c=e.decoder(u,Ra.decoder,l,"key"),h=e.strictNullHandling?null:""):(c=e.decoder(u.slice(0,f),Ra.decoder,l,"key"),h=ka.maybeMap(Ia(u.slice(f+1),e),(function(t){return e.decoder(t,Ra.decoder,l,"value")}))),h&&e.interpretNumericEntities&&"iso-8859-1"===l&&(h=Ma(h)),u.indexOf("[]=")>-1&&(h=Ca(h)?[h]:h),Aa.call(r,c)?r[c]=ka.combine(r[c],h):r[c]=h}return r}(t,n):t,i=n.plainObjects?Object.create(null):{},s=Object.keys(r),o=0;o<s.length;++o){var a=s[o],l=Da(a,r[a],n,"string"==typeof t);i=ka.merge(i,l,n)}return!0===n.allowSparse?i:ka.compact(i)},stringify:function(t,e){var n,r=t,i=function(t){if(!t)return _a;if(null!==t.encoder&&void 0!==t.encoder&&"function"!=typeof t.encoder)throw new TypeError("Encoder has to be a function.");var e=t.charset||_a.charset;if(void 0!==t.charset&&"utf-8"!==t.charset&&"iso-8859-1"!==t.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=ma.default;if(void 0!==t.format){if(!ga.call(ma.formatters,t.format))throw new TypeError("Unknown format option provided.");n=t.format}var r=ma.formatters[n],i=_a.filter;return("function"==typeof t.filter||ya(t.filter))&&(i=t.filter),{addQueryPrefix:"boolean"==typeof t.addQueryPrefix?t.addQueryPrefix:_a.addQueryPrefix,allowDots:void 0===t.allowDots?_a.allowDots:!!t.allowDots,charset:e,charsetSentinel:"boolean"==typeof t.charsetSentinel?t.charsetSentinel:_a.charsetSentinel,delimiter:void 0===t.delimiter?_a.delimiter:t.delimiter,encode:"boolean"==typeof t.encode?t.encode:_a.encode,encoder:"function"==typeof t.encoder?t.encoder:_a.encoder,encodeValuesOnly:"boolean"==typeof t.encodeValuesOnly?t.encodeValuesOnly:_a.encodeValuesOnly,filter:i,format:n,formatter:r,serializeDate:"function"==typeof t.serializeDate?t.serializeDate:_a.serializeDate,skipNulls:"boolean"==typeof t.skipNulls?t.skipNulls:_a.skipNulls,sort:"function"==typeof t.sort?t.sort:null,strictNullHandling:"boolean"==typeof t.strictNullHandling?t.strictNullHandling:_a.strictNullHandling}}(e);"function"==typeof i.filter?r=(0,i.filter)("",r):ya(i.filter)&&(n=i.filter);var s,o=[];if("object"!=typeof r||null===r)return"";s=e&&e.arrayFormat in va?e.arrayFormat:e&&"indices"in e?e.indices?"indices":"repeat":"indices";var a=va[s];if(e&&"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");var l="comma"===a&&e&&e.commaRoundTrip;n||(n=Object.keys(r)),i.sort&&n.sort(i.sort);for(var c=fa(),h=0;h<n.length;++h){var u=n[h];i.skipNulls&&null===r[u]||xa(o,Ta(r[u],u,a,l,i.strictNullHandling,i.skipNulls,i.encode?i.encoder:null,i.filter,i.sort,i.allowDots,i.serializeDate,i.format,i.formatter,i.encodeValuesOnly,i.charset,c))}var d=o.join(i.delimiter),f=!0===i.addQueryPrefix?"?":"";return i.charsetSentinel&&("iso-8859-1"===i.charset?f+="utf8=%26%2310003%3B&":f+="utf8=%E2%9C%93&"),d.length>0?f+d:""}};const Pa=ni(Oa);var La,Fa,Na={exports:{}},Ba={exports:{}};La="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Fa={rotl:function(t,e){return t<<e|t>>>32-e},rotr:function(t,e){return t<<32-e|t>>>e},endian:function(t){if(t.constructor==Number)return 16711935&Fa.rotl(t,8)|4278255360&Fa.rotl(t,24);for(var e=0;e<t.length;e++)t[e]=Fa.endian(t[e]);return t},randomBytes:function(t){for(var e=[];t>0;t--)e.push(Math.floor(256*Math.random()));return e},bytesToWords:function(t){for(var e=[],n=0,r=0;n<t.length;n++,r+=8)e[r>>>5]|=t[n]<<24-r%32;return e},wordsToBytes:function(t){for(var e=[],n=0;n<32*t.length;n+=8)e.push(t[n>>>5]>>>24-n%32&255);return e},bytesToHex:function(t){for(var e=[],n=0;n<t.length;n++)e.push((t[n]>>>4).toString(16)),e.push((15&t[n]).toString(16));return e.join("")},hexToBytes:function(t){for(var e=[],n=0;n<t.length;n+=2)e.push(parseInt(t.substr(n,2),16));return e},bytesToBase64:function(t){for(var e=[],n=0;n<t.length;n+=3)for(var r=t[n]<<16|t[n+1]<<8|t[n+2],i=0;i<4;i++)8*n+6*i<=8*t.length?e.push(La.charAt(r>>>6*(3-i)&63)):e.push("=");return e.join("")},base64ToBytes:function(t){t=t.replace(/[^A-Z0-9+\/]/gi,"");for(var e=[],n=0,r=0;n<t.length;r=++n%4)0!=r&&e.push((La.indexOf(t.charAt(n-1))&Math.pow(2,-2*r+8)-1)<<2*r|La.indexOf(t.charAt(n))>>>6-2*r);return e}},Ba.exports=Fa;var Ua,Va,ja,za,Ga,Wa=Ba.exports,Ha={utf8:{stringToBytes:function(t){return Ha.bin.stringToBytes(unescape(encodeURIComponent(t)))},bytesToString:function(t){return decodeURIComponent(escape(Ha.bin.bytesToString(t)))}},bin:{stringToBytes:function(t){for(var e=[],n=0;n<t.length;n++)e.push(255&t.charCodeAt(n));return e},bytesToString:function(t){for(var e=[],n=0;n<t.length;n++)e.push(String.fromCharCode(t[n]));return e.join("")}}},$a=Ha,Ya=function(t){return null!=t&&(Xa(t)||function(t){return"function"==typeof t.readFloatLE&&"function"==typeof t.slice&&Xa(t.slice(0,0))}(t)||!!t._isBuffer)};function Xa(t){return!!t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}Ua=Wa,Va=$a.utf8,ja=Ya,za=$a.bin,(Ga=function(t,e){t.constructor==String?t=e&&"binary"===e.encoding?za.stringToBytes(t):Va.stringToBytes(t):ja(t)?t=Array.prototype.slice.call(t,0):Array.isArray(t)||t.constructor===Uint8Array||(t=t.toString());for(var n=Ua.bytesToWords(t),r=8*t.length,i=1732584193,s=-271733879,o=-1732584194,a=271733878,l=0;l<n.length;l++)n[l]=16711935&(n[l]<<8|n[l]>>>24)|4278255360&(n[l]<<24|n[l]>>>8);n[r>>>5]|=128<<r%32,n[14+(r+64>>>9<<4)]=r;var c=Ga._ff,h=Ga._gg,u=Ga._hh,d=Ga._ii;for(l=0;l<n.length;l+=16){var f=i,p=s,m=o,g=a;i=c(i,s,o,a,n[l+0],7,-680876936),a=c(a,i,s,o,n[l+1],12,-389564586),o=c(o,a,i,s,n[l+2],17,606105819),s=c(s,o,a,i,n[l+3],22,-1044525330),i=c(i,s,o,a,n[l+4],7,-176418897),a=c(a,i,s,o,n[l+5],12,1200080426),o=c(o,a,i,s,n[l+6],17,-1473231341),s=c(s,o,a,i,n[l+7],22,-45705983),i=c(i,s,o,a,n[l+8],7,1770035416),a=c(a,i,s,o,n[l+9],12,-1958414417),o=c(o,a,i,s,n[l+10],17,-42063),s=c(s,o,a,i,n[l+11],22,-1990404162),i=c(i,s,o,a,n[l+12],7,1804603682),a=c(a,i,s,o,n[l+13],12,-40341101),o=c(o,a,i,s,n[l+14],17,-1502002290),i=h(i,s=c(s,o,a,i,n[l+15],22,1236535329),o,a,n[l+1],5,-165796510),a=h(a,i,s,o,n[l+6],9,-1069501632),o=h(o,a,i,s,n[l+11],14,643717713),s=h(s,o,a,i,n[l+0],20,-373897302),i=h(i,s,o,a,n[l+5],5,-701558691),a=h(a,i,s,o,n[l+10],9,38016083),o=h(o,a,i,s,n[l+15],14,-660478335),s=h(s,o,a,i,n[l+4],20,-405537848),i=h(i,s,o,a,n[l+9],5,568446438),a=h(a,i,s,o,n[l+14],9,-1019803690),o=h(o,a,i,s,n[l+3],14,-187363961),s=h(s,o,a,i,n[l+8],20,1163531501),i=h(i,s,o,a,n[l+13],5,-1444681467),a=h(a,i,s,o,n[l+2],9,-51403784),o=h(o,a,i,s,n[l+7],14,1735328473),i=u(i,s=h(s,o,a,i,n[l+12],20,-1926607734),o,a,n[l+5],4,-378558),a=u(a,i,s,o,n[l+8],11,-2022574463),o=u(o,a,i,s,n[l+11],16,1839030562),s=u(s,o,a,i,n[l+14],23,-35309556),i=u(i,s,o,a,n[l+1],4,-1530992060),a=u(a,i,s,o,n[l+4],11,1272893353),o=u(o,a,i,s,n[l+7],16,-155497632),s=u(s,o,a,i,n[l+10],23,-1094730640),i=u(i,s,o,a,n[l+13],4,681279174),a=u(a,i,s,o,n[l+0],11,-358537222),o=u(o,a,i,s,n[l+3],16,-722521979),s=u(s,o,a,i,n[l+6],23,76029189),i=u(i,s,o,a,n[l+9],4,-640364487),a=u(a,i,s,o,n[l+12],11,-421815835),o=u(o,a,i,s,n[l+15],16,530742520),i=d(i,s=u(s,o,a,i,n[l+2],23,-995338651),o,a,n[l+0],6,-198630844),a=d(a,i,s,o,n[l+7],10,1126891415),o=d(o,a,i,s,n[l+14],15,-1416354905),s=d(s,o,a,i,n[l+5],21,-57434055),i=d(i,s,o,a,n[l+12],6,1700485571),a=d(a,i,s,o,n[l+3],10,-1894986606),o=d(o,a,i,s,n[l+10],15,-1051523),s=d(s,o,a,i,n[l+1],21,-2054922799),i=d(i,s,o,a,n[l+8],6,1873313359),a=d(a,i,s,o,n[l+15],10,-30611744),o=d(o,a,i,s,n[l+6],15,-1560198380),s=d(s,o,a,i,n[l+13],21,1309151649),i=d(i,s,o,a,n[l+4],6,-145523070),a=d(a,i,s,o,n[l+11],10,-1120210379),o=d(o,a,i,s,n[l+2],15,718787259),s=d(s,o,a,i,n[l+9],21,-343485551),i=i+f>>>0,s=s+p>>>0,o=o+m>>>0,a=a+g>>>0}return Ua.endian([i,s,o,a])})._ff=function(t,e,n,r,i,s,o){var a=t+(e&n|~e&r)+(i>>>0)+o;return(a<<s|a>>>32-s)+e},Ga._gg=function(t,e,n,r,i,s,o){var a=t+(e&r|n&~r)+(i>>>0)+o;return(a<<s|a>>>32-s)+e},Ga._hh=function(t,e,n,r,i,s,o){var a=t+(e^n^r)+(i>>>0)+o;return(a<<s|a>>>32-s)+e},Ga._ii=function(t,e,n,r,i,s,o){var a=t+(n^(e|~r))+(i>>>0)+o;return(a<<s|a>>>32-s)+e},Ga._blocksize=16,Ga._digestsize=16,Na.exports=function(t,e){if(null==t)throw new Error("Illegal argument "+t);var n=Ua.wordsToBytes(Ga(t,e));return e&&e.asBytes?n:e&&e.asString?za.bytesToString(n):Ua.bytesToHex(n)};const qa=ni(Na.exports);var Ka,Za,Ja={exports:{}};
/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright OpenJS Foundation and other contributors <https://openjsf.org/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */Ka=Ja,Za=Ja.exports,function(){var t,e="Expected a function",n="__lodash_hash_undefined__",r="__lodash_placeholder__",i=16,s=32,o=64,a=128,l=256,c=1/0,h=9007199254740991,u=NaN,d=4294967295,f=[["ary",a],["bind",1],["bindKey",2],["curry",8],["curryRight",i],["flip",512],["partial",s],["partialRight",o],["rearg",l]],p="[object Arguments]",m="[object Array]",g="[object Boolean]",v="[object Date]",y="[object Error]",b="[object Function]",x="[object GeneratorFunction]",w="[object Map]",E="[object Number]",_="[object Object]",S="[object Promise]",T="[object RegExp]",k="[object Set]",A="[object String]",C="[object Symbol]",R="[object WeakMap]",M="[object ArrayBuffer]",I="[object DataView]",D="[object Float32Array]",O="[object Float64Array]",P="[object Int8Array]",L="[object Int16Array]",F="[object Int32Array]",N="[object Uint8Array]",B="[object Uint8ClampedArray]",U="[object Uint16Array]",V="[object Uint32Array]",j=/\b__p \+= '';/g,z=/\b(__p \+=) '' \+/g,G=/(__e\(.*?\)|\b__t\)) \+\n'';/g,W=/&(?:amp|lt|gt|quot|#39);/g,H=/[&<>"']/g,$=RegExp(W.source),Y=RegExp(H.source),X=/<%-([\s\S]+?)%>/g,q=/<%([\s\S]+?)%>/g,K=/<%=([\s\S]+?)%>/g,Z=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,J=/^\w*$/,Q=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,tt=/[\\^$.*+?()[\]{}|]/g,et=RegExp(tt.source),nt=/^\s+/,rt=/\s/,it=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,st=/\{\n\/\* \[wrapped with (.+)\] \*/,ot=/,? & /,at=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,lt=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,ht=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,ut=/\w*$/,dt=/^[-+]0x[0-9a-f]+$/i,ft=/^0b[01]+$/i,pt=/^\[object .+?Constructor\]$/,mt=/^0o[0-7]+$/i,gt=/^(?:0|[1-9]\d*)$/,vt=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,yt=/($^)/,bt=/['\n\r\u2028\u2029\\]/g,xt="\\ud800-\\udfff",wt="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",Et="\\u2700-\\u27bf",_t="a-z\\xdf-\\xf6\\xf8-\\xff",St="A-Z\\xc0-\\xd6\\xd8-\\xde",Tt="\\ufe0e\\ufe0f",kt="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",At="['’]",Ct="["+xt+"]",Rt="["+kt+"]",Mt="["+wt+"]",It="\\d+",Dt="["+Et+"]",Ot="["+_t+"]",Pt="[^"+xt+kt+It+Et+_t+St+"]",Lt="\\ud83c[\\udffb-\\udfff]",Ft="[^"+xt+"]",Nt="(?:\\ud83c[\\udde6-\\uddff]){2}",Bt="[\\ud800-\\udbff][\\udc00-\\udfff]",Ut="["+St+"]",Vt="\\u200d",jt="(?:"+Ot+"|"+Pt+")",zt="(?:"+Ut+"|"+Pt+")",Gt="(?:['’](?:d|ll|m|re|s|t|ve))?",Wt="(?:['’](?:D|LL|M|RE|S|T|VE))?",Ht="(?:"+Mt+"|"+Lt+")?",$t="["+Tt+"]?",Yt=$t+Ht+"(?:"+Vt+"(?:"+[Ft,Nt,Bt].join("|")+")"+$t+Ht+")*",Xt="(?:"+[Dt,Nt,Bt].join("|")+")"+Yt,qt="(?:"+[Ft+Mt+"?",Mt,Nt,Bt,Ct].join("|")+")",Kt=RegExp(At,"g"),Zt=RegExp(Mt,"g"),Jt=RegExp(Lt+"(?="+Lt+")|"+qt+Yt,"g"),Qt=RegExp([Ut+"?"+Ot+"+"+Gt+"(?="+[Rt,Ut,"$"].join("|")+")",zt+"+"+Wt+"(?="+[Rt,Ut+jt,"$"].join("|")+")",Ut+"?"+jt+"+"+Gt,Ut+"+"+Wt,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",It,Xt].join("|"),"g"),te=RegExp("["+Vt+xt+wt+Tt+"]"),ee=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,ne=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],re=-1,ie={};ie[D]=ie[O]=ie[P]=ie[L]=ie[F]=ie[N]=ie[B]=ie[U]=ie[V]=!0,ie[p]=ie[m]=ie[M]=ie[g]=ie[I]=ie[v]=ie[y]=ie[b]=ie[w]=ie[E]=ie[_]=ie[T]=ie[k]=ie[A]=ie[R]=!1;var se={};se[p]=se[m]=se[M]=se[I]=se[g]=se[v]=se[D]=se[O]=se[P]=se[L]=se[F]=se[w]=se[E]=se[_]=se[T]=se[k]=se[A]=se[C]=se[N]=se[B]=se[U]=se[V]=!0,se[y]=se[b]=se[R]=!1;var oe={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ae=parseFloat,le=parseInt,ce="object"==typeof ei&&ei&&ei.Object===Object&&ei,he="object"==typeof self&&self&&self.Object===Object&&self,ue=ce||he||Function("return this")(),de=Za&&!Za.nodeType&&Za,fe=de&&Ka&&!Ka.nodeType&&Ka,pe=fe&&fe.exports===de,me=pe&&ce.process,ge=function(){try{var t=fe&&fe.require&&fe.require("util").types;return t||me&&me.binding&&me.binding("util")}catch(Ni){}}(),ve=ge&&ge.isArrayBuffer,ye=ge&&ge.isDate,be=ge&&ge.isMap,xe=ge&&ge.isRegExp,we=ge&&ge.isSet,Ee=ge&&ge.isTypedArray;function _e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function Se(t,e,n,r){for(var i=-1,s=null==t?0:t.length;++i<s;){var o=t[i];e(r,o,n(o),t)}return r}function Te(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t}function ke(t,e){for(var n=null==t?0:t.length;n--&&!1!==e(t[n],n,t););return t}function Ae(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(!e(t[n],n,t))return!1;return!0}function Ce(t,e){for(var n=-1,r=null==t?0:t.length,i=0,s=[];++n<r;){var o=t[n];e(o,n,t)&&(s[i++]=o)}return s}function Re(t,e){return!(null==t||!t.length)&&Ue(t,e,0)>-1}function Me(t,e,n){for(var r=-1,i=null==t?0:t.length;++r<i;)if(n(e,t[r]))return!0;return!1}function Ie(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function De(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t}function Oe(t,e,n,r){var i=-1,s=null==t?0:t.length;for(r&&s&&(n=t[++i]);++i<s;)n=e(n,t[i],i,t);return n}function Pe(t,e,n,r){var i=null==t?0:t.length;for(r&&i&&(n=t[--i]);i--;)n=e(n,t[i],i,t);return n}function Le(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1}var Fe=Ge("length");function Ne(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function Be(t,e,n,r){for(var i=t.length,s=n+(r?1:-1);r?s--:++s<i;)if(e(t[s],s,t))return s;return-1}function Ue(t,e,n){return e==e?function(t,e,n){for(var r=n-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1}(t,e,n):Be(t,je,n)}function Ve(t,e,n,r){for(var i=n-1,s=t.length;++i<s;)if(r(t[i],e))return i;return-1}function je(t){return t!=t}function ze(t,e){var n=null==t?0:t.length;return n?$e(t,e)/n:u}function Ge(e){return function(n){return null==n?t:n[e]}}function We(e){return function(n){return null==e?t:e[n]}}function He(t,e,n,r,i){return i(t,(function(t,i,s){n=r?(r=!1,t):e(n,t,i,s)})),n}function $e(e,n){for(var r,i=-1,s=e.length;++i<s;){var o=n(e[i]);o!==t&&(r=r===t?o:r+o)}return r}function Ye(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function Xe(t){return t?t.slice(0,un(t)+1).replace(nt,""):t}function qe(t){return function(e){return t(e)}}function Ke(t,e){return Ie(e,(function(e){return t[e]}))}function Ze(t,e){return t.has(e)}function Je(t,e){for(var n=-1,r=t.length;++n<r&&Ue(e,t[n],0)>-1;);return n}function Qe(t,e){for(var n=t.length;n--&&Ue(e,t[n],0)>-1;);return n}var tn=We({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"}),en=We({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function nn(t){return"\\"+oe[t]}function rn(t){return te.test(t)}function sn(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function on(t,e){return function(n){return t(e(n))}}function an(t,e){for(var n=-1,i=t.length,s=0,o=[];++n<i;){var a=t[n];a!==e&&a!==r||(t[n]=r,o[s++]=n)}return o}function ln(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function cn(t){return rn(t)?function(t){for(var e=Jt.lastIndex=0;Jt.test(t);)++e;return e}(t):Fe(t)}function hn(t){return rn(t)?function(t){return t.match(Jt)||[]}(t):function(t){return t.split("")}(t)}function un(t){for(var e=t.length;e--&&rt.test(t.charAt(e)););return e}var dn=We({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),fn=function rt(xt){var wt,Et=(xt=null==xt?ue:fn.defaults(ue.Object(),xt,fn.pick(ue,ne))).Array,_t=xt.Date,St=xt.Error,Tt=xt.Function,kt=xt.Math,At=xt.Object,Ct=xt.RegExp,Rt=xt.String,Mt=xt.TypeError,It=Et.prototype,Dt=Tt.prototype,Ot=At.prototype,Pt=xt["__core-js_shared__"],Lt=Dt.toString,Ft=Ot.hasOwnProperty,Nt=0,Bt=(wt=/[^.]+$/.exec(Pt&&Pt.keys&&Pt.keys.IE_PROTO||""))?"Symbol(src)_1."+wt:"",Ut=Ot.toString,Vt=Lt.call(At),jt=ue._,zt=Ct("^"+Lt.call(Ft).replace(tt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Gt=pe?xt.Buffer:t,Wt=xt.Symbol,Ht=xt.Uint8Array,$t=Gt?Gt.allocUnsafe:t,Yt=on(At.getPrototypeOf,At),Xt=At.create,qt=Ot.propertyIsEnumerable,Jt=It.splice,te=Wt?Wt.isConcatSpreadable:t,oe=Wt?Wt.iterator:t,ce=Wt?Wt.toStringTag:t,he=function(){try{var t=ds(At,"defineProperty");return t({},"",{}),t}catch(Ni){}}(),de=xt.clearTimeout!==ue.clearTimeout&&xt.clearTimeout,fe=_t&&_t.now!==ue.Date.now&&_t.now,me=xt.setTimeout!==ue.setTimeout&&xt.setTimeout,ge=kt.ceil,Fe=kt.floor,We=At.getOwnPropertySymbols,pn=Gt?Gt.isBuffer:t,mn=xt.isFinite,gn=It.join,vn=on(At.keys,At),yn=kt.max,bn=kt.min,xn=_t.now,wn=xt.parseInt,En=kt.random,_n=It.reverse,Sn=ds(xt,"DataView"),Tn=ds(xt,"Map"),kn=ds(xt,"Promise"),An=ds(xt,"Set"),Cn=ds(xt,"WeakMap"),Rn=ds(At,"create"),Mn=Cn&&new Cn,In={},Dn=js(Sn),On=js(Tn),Pn=js(kn),Ln=js(An),Fn=js(Cn),Nn=Wt?Wt.prototype:t,Bn=Nn?Nn.valueOf:t,Un=Nn?Nn.toString:t;function Vn(t){if(sa(t)&&!Xo(t)&&!(t instanceof Wn)){if(t instanceof Gn)return t;if(Ft.call(t,"__wrapped__"))return zs(t)}return new Gn(t)}var jn=function(){function e(){}return function(n){if(!ia(n))return{};if(Xt)return Xt(n);e.prototype=n;var r=new e;return e.prototype=t,r}}();function zn(){}function Gn(e,n){this.__wrapped__=e,this.__actions__=[],this.__chain__=!!n,this.__index__=0,this.__values__=t}function Wn(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=d,this.__views__=[]}function Hn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function $n(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Yn(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function Xn(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Yn;++e<n;)this.add(t[e])}function qn(t){var e=this.__data__=new $n(t);this.size=e.size}function Kn(t,e){var n=Xo(t),r=!n&&Yo(t),i=!n&&!r&&Jo(t),s=!n&&!r&&!i&&fa(t),o=n||r||i||s,a=o?Ye(t.length,Rt):[],l=a.length;for(var c in t)!e&&!Ft.call(t,c)||o&&("length"==c||i&&("offset"==c||"parent"==c)||s&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||bs(c,l))||a.push(c);return a}function Zn(e){var n=e.length;return n?e[Xr(0,n-1)]:t}function Jn(t,e){return Ls(Ri(t),ar(e,0,t.length))}function Qn(t){return Ls(Ri(t))}function tr(e,n,r){(r!==t&&!Wo(e[n],r)||r===t&&!(n in e))&&sr(e,n,r)}function er(e,n,r){var i=e[n];Ft.call(e,n)&&Wo(i,r)&&(r!==t||n in e)||sr(e,n,r)}function nr(t,e){for(var n=t.length;n--;)if(Wo(t[n][0],e))return n;return-1}function rr(t,e,n,r){return dr(t,(function(t,i,s){e(r,t,n(t),s)})),r}function ir(t,e){return t&&Mi(e,La(e),t)}function sr(t,e,n){"__proto__"==e&&he?he(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function or(e,n){for(var r=-1,i=n.length,s=Et(i),o=null==e;++r<i;)s[r]=o?t:Ma(e,n[r]);return s}function ar(e,n,r){return e==e&&(r!==t&&(e=e<=r?e:r),n!==t&&(e=e>=n?e:n)),e}function lr(e,n,r,i,s,o){var a,l=1&n,c=2&n,h=4&n;if(r&&(a=s?r(e,i,s,o):r(e)),a!==t)return a;if(!ia(e))return e;var u=Xo(e);if(u){if(a=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&Ft.call(t,"index")&&(n.index=t.index,n.input=t.input),n}(e),!l)return Ri(e,a)}else{var d=ms(e),f=d==b||d==x;if(Jo(e))return _i(e,l);if(d==_||d==p||f&&!s){if(a=c||f?{}:vs(e),!l)return c?function(t,e){return Mi(t,ps(t),e)}(e,function(t,e){return t&&Mi(e,Fa(e),t)}(a,e)):function(t,e){return Mi(t,fs(t),e)}(e,ir(a,e))}else{if(!se[d])return s?e:{};a=function(t,e,n){var r,i=t.constructor;switch(e){case M:return Si(t);case g:case v:return new i(+t);case I:return function(t,e){var n=e?Si(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}(t,n);case D:case O:case P:case L:case F:case N:case B:case U:case V:return Ti(t,n);case w:return new i;case E:case A:return new i(t);case T:return function(t){var e=new t.constructor(t.source,ut.exec(t));return e.lastIndex=t.lastIndex,e}(t);case k:return new i;case C:return r=t,Bn?At(Bn.call(r)):{}}}(e,d,l)}}o||(o=new qn);var m=o.get(e);if(m)return m;o.set(e,a),ha(e)?e.forEach((function(t){a.add(lr(t,n,r,t,e,o))})):oa(e)&&e.forEach((function(t,i){a.set(i,lr(t,n,r,i,e,o))}));var y=u?t:(h?c?ss:is:c?Fa:La)(e);return Te(y||e,(function(t,i){y&&(t=e[i=t]),er(a,i,lr(t,n,r,i,e,o))})),a}function cr(e,n,r){var i=r.length;if(null==e)return!i;for(e=At(e);i--;){var s=r[i],o=n[s],a=e[s];if(a===t&&!(s in e)||!o(a))return!1}return!0}function hr(n,r,i){if("function"!=typeof n)throw new Mt(e);return Is((function(){n.apply(t,i)}),r)}function ur(t,e,n,r){var i=-1,s=Re,o=!0,a=t.length,l=[],c=e.length;if(!a)return l;n&&(e=Ie(e,qe(n))),r?(s=Me,o=!1):e.length>=200&&(s=Ze,o=!1,e=new Xn(e));t:for(;++i<a;){var h=t[i],u=null==n?h:n(h);if(h=r||0!==h?h:0,o&&u==u){for(var d=c;d--;)if(e[d]===u)continue t;l.push(h)}else s(e,u,r)||l.push(h)}return l}Vn.templateSettings={escape:X,evaluate:q,interpolate:K,variable:"",imports:{_:Vn}},Vn.prototype=zn.prototype,Vn.prototype.constructor=Vn,Gn.prototype=jn(zn.prototype),Gn.prototype.constructor=Gn,Wn.prototype=jn(zn.prototype),Wn.prototype.constructor=Wn,Hn.prototype.clear=function(){this.__data__=Rn?Rn(null):{},this.size=0},Hn.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},Hn.prototype.get=function(e){var r=this.__data__;if(Rn){var i=r[e];return i===n?t:i}return Ft.call(r,e)?r[e]:t},Hn.prototype.has=function(e){var n=this.__data__;return Rn?n[e]!==t:Ft.call(n,e)},Hn.prototype.set=function(e,r){var i=this.__data__;return this.size+=this.has(e)?0:1,i[e]=Rn&&r===t?n:r,this},$n.prototype.clear=function(){this.__data__=[],this.size=0},$n.prototype.delete=function(t){var e=this.__data__,n=nr(e,t);return!(n<0||(n==e.length-1?e.pop():Jt.call(e,n,1),--this.size,0))},$n.prototype.get=function(e){var n=this.__data__,r=nr(n,e);return r<0?t:n[r][1]},$n.prototype.has=function(t){return nr(this.__data__,t)>-1},$n.prototype.set=function(t,e){var n=this.__data__,r=nr(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this},Yn.prototype.clear=function(){this.size=0,this.__data__={hash:new Hn,map:new(Tn||$n),string:new Hn}},Yn.prototype.delete=function(t){var e=hs(this,t).delete(t);return this.size-=e?1:0,e},Yn.prototype.get=function(t){return hs(this,t).get(t)},Yn.prototype.has=function(t){return hs(this,t).has(t)},Yn.prototype.set=function(t,e){var n=hs(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this},Xn.prototype.add=Xn.prototype.push=function(t){return this.__data__.set(t,n),this},Xn.prototype.has=function(t){return this.__data__.has(t)},qn.prototype.clear=function(){this.__data__=new $n,this.size=0},qn.prototype.delete=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},qn.prototype.get=function(t){return this.__data__.get(t)},qn.prototype.has=function(t){return this.__data__.has(t)},qn.prototype.set=function(t,e){var n=this.__data__;if(n instanceof $n){var r=n.__data__;if(!Tn||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Yn(r)}return n.set(t,e),this.size=n.size,this};var dr=Oi(xr),fr=Oi(wr,!0);function pr(t,e){var n=!0;return dr(t,(function(t,r,i){return n=!!e(t,r,i)})),n}function mr(e,n,r){for(var i=-1,s=e.length;++i<s;){var o=e[i],a=n(o);if(null!=a&&(l===t?a==a&&!da(a):r(a,l)))var l=a,c=o}return c}function gr(t,e){var n=[];return dr(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function vr(t,e,n,r,i){var s=-1,o=t.length;for(n||(n=ys),i||(i=[]);++s<o;){var a=t[s];e>0&&n(a)?e>1?vr(a,e-1,n,r,i):De(i,a):r||(i[i.length]=a)}return i}var yr=Pi(),br=Pi(!0);function xr(t,e){return t&&yr(t,e,La)}function wr(t,e){return t&&br(t,e,La)}function Er(t,e){return Ce(e,(function(e){return ea(t[e])}))}function _r(e,n){for(var r=0,i=(n=bi(n,e)).length;null!=e&&r<i;)e=e[Vs(n[r++])];return r&&r==i?e:t}function Sr(t,e,n){var r=e(t);return Xo(t)?r:De(r,n(t))}function Tr(e){return null==e?e===t?"[object Undefined]":"[object Null]":ce&&ce in At(e)?function(e){var n=Ft.call(e,ce),r=e[ce];try{e[ce]=t;var i=!0}catch(Ni){}var s=Ut.call(e);return i&&(n?e[ce]=r:delete e[ce]),s}(e):function(t){return Ut.call(t)}(e)}function kr(t,e){return t>e}function Ar(t,e){return null!=t&&Ft.call(t,e)}function Cr(t,e){return null!=t&&e in At(t)}function Rr(e,n,r){for(var i=r?Me:Re,s=e[0].length,o=e.length,a=o,l=Et(o),c=1/0,h=[];a--;){var u=e[a];a&&n&&(u=Ie(u,qe(n))),c=bn(u.length,c),l[a]=!r&&(n||s>=120&&u.length>=120)?new Xn(a&&u):t}u=e[0];var d=-1,f=l[0];t:for(;++d<s&&h.length<c;){var p=u[d],m=n?n(p):p;if(p=r||0!==p?p:0,!(f?Ze(f,m):i(h,m,r))){for(a=o;--a;){var g=l[a];if(!(g?Ze(g,m):i(e[a],m,r)))continue t}f&&f.push(m),h.push(p)}}return h}function Mr(e,n,r){var i=null==(e=Cs(e,n=bi(n,e)))?e:e[Vs(Qs(n))];return null==i?t:_e(i,e,r)}function Ir(t){return sa(t)&&Tr(t)==p}function Dr(e,n,r,i,s){return e===n||(null==e||null==n||!sa(e)&&!sa(n)?e!=e&&n!=n:function(e,n,r,i,s,o){var a=Xo(e),l=Xo(n),c=a?m:ms(e),h=l?m:ms(n),u=(c=c==p?_:c)==_,d=(h=h==p?_:h)==_,f=c==h;if(f&&Jo(e)){if(!Jo(n))return!1;a=!0,u=!1}if(f&&!u)return o||(o=new qn),a||fa(e)?ns(e,n,r,i,s,o):function(t,e,n,r,i,s,o){switch(n){case I:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case M:return!(t.byteLength!=e.byteLength||!s(new Ht(t),new Ht(e)));case g:case v:case E:return Wo(+t,+e);case y:return t.name==e.name&&t.message==e.message;case T:case A:return t==e+"";case w:var a=sn;case k:var l=1&r;if(a||(a=ln),t.size!=e.size&&!l)return!1;var c=o.get(t);if(c)return c==e;r|=2,o.set(t,e);var h=ns(a(t),a(e),r,i,s,o);return o.delete(t),h;case C:if(Bn)return Bn.call(t)==Bn.call(e)}return!1}(e,n,c,r,i,s,o);if(!(1&r)){var b=u&&Ft.call(e,"__wrapped__"),x=d&&Ft.call(n,"__wrapped__");if(b||x){var S=b?e.value():e,R=x?n.value():n;return o||(o=new qn),s(S,R,r,i,o)}}return!!f&&(o||(o=new qn),function(e,n,r,i,s,o){var a=1&r,l=is(e),c=l.length,h=is(n),u=h.length;if(c!=u&&!a)return!1;for(var d=c;d--;){var f=l[d];if(!(a?f in n:Ft.call(n,f)))return!1}var p=o.get(e),m=o.get(n);if(p&&m)return p==n&&m==e;var g=!0;o.set(e,n),o.set(n,e);for(var v=a;++d<c;){var y=e[f=l[d]],b=n[f];if(i)var x=a?i(b,y,f,n,e,o):i(y,b,f,e,n,o);if(!(x===t?y===b||s(y,b,r,i,o):x)){g=!1;break}v||(v="constructor"==f)}if(g&&!v){var w=e.constructor,E=n.constructor;w==E||!("constructor"in e)||!("constructor"in n)||"function"==typeof w&&w instanceof w&&"function"==typeof E&&E instanceof E||(g=!1)}return o.delete(e),o.delete(n),g}(e,n,r,i,s,o))}(e,n,r,i,Dr,s))}function Or(e,n,r,i){var s=r.length,o=s,a=!i;if(null==e)return!o;for(e=At(e);s--;){var l=r[s];if(a&&l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++s<o;){var c=(l=r[s])[0],h=e[c],u=l[1];if(a&&l[2]){if(h===t&&!(c in e))return!1}else{var d=new qn;if(i)var f=i(h,u,c,e,n,d);if(!(f===t?Dr(u,h,3,i,d):f))return!1}}return!0}function Pr(t){return!(!ia(t)||(e=t,Bt&&Bt in e))&&(ea(t)?zt:pt).test(js(t));var e}function Lr(t){return"function"==typeof t?t:null==t?al:"object"==typeof t?Xo(t)?jr(t[0],t[1]):Vr(t):gl(t)}function Fr(t){if(!Ss(t))return vn(t);var e=[];for(var n in At(t))Ft.call(t,n)&&"constructor"!=n&&e.push(n);return e}function Nr(t){if(!ia(t))return function(t){var e=[];if(null!=t)for(var n in At(t))e.push(n);return e}(t);var e=Ss(t),n=[];for(var r in t)("constructor"!=r||!e&&Ft.call(t,r))&&n.push(r);return n}function Br(t,e){return t<e}function Ur(t,e){var n=-1,r=Ko(t)?Et(t.length):[];return dr(t,(function(t,i,s){r[++n]=e(t,i,s)})),r}function Vr(t){var e=us(t);return 1==e.length&&e[0][2]?ks(e[0][0],e[0][1]):function(n){return n===t||Or(n,t,e)}}function jr(e,n){return ws(e)&&Ts(n)?ks(Vs(e),n):function(r){var i=Ma(r,e);return i===t&&i===n?Ia(r,e):Dr(n,i,3)}}function zr(e,n,r,i,s){e!==n&&yr(n,(function(o,a){if(s||(s=new qn),ia(o))!function(e,n,r,i,s,o,a){var l=Rs(e,r),c=Rs(n,r),h=a.get(c);if(h)tr(e,r,h);else{var u=o?o(l,c,r+"",e,n,a):t,d=u===t;if(d){var f=Xo(c),p=!f&&Jo(c),m=!f&&!p&&fa(c);u=c,f||p||m?Xo(l)?u=l:Zo(l)?u=Ri(l):p?(d=!1,u=_i(c,!0)):m?(d=!1,u=Ti(c,!0)):u=[]:la(c)||Yo(c)?(u=l,Yo(l)?u=wa(l):ia(l)&&!ea(l)||(u=vs(c))):d=!1}d&&(a.set(c,u),s(u,c,i,o,a),a.delete(c)),tr(e,r,u)}}(e,n,a,r,zr,i,s);else{var l=i?i(Rs(e,a),o,a+"",e,n,s):t;l===t&&(l=o),tr(e,a,l)}}),Fa)}function Gr(e,n){var r=e.length;if(r)return bs(n+=n<0?r:0,r)?e[n]:t}function Wr(t,e,n){e=e.length?Ie(e,(function(t){return Xo(t)?function(e){return _r(e,1===t.length?t[0]:t)}:t})):[al];var r=-1;return e=Ie(e,qe(cs())),function(t,e){var n=t.length;for(t.sort(e);n--;)t[n]=t[n].value;return t}(Ur(t,(function(t,n,i){return{criteria:Ie(e,(function(e){return e(t)})),index:++r,value:t}})),(function(t,e){return function(t,e,n){for(var r=-1,i=t.criteria,s=e.criteria,o=i.length,a=n.length;++r<o;){var l=ki(i[r],s[r]);if(l)return r>=a?l:l*("desc"==n[r]?-1:1)}return t.index-e.index}(t,e,n)}))}function Hr(t,e,n){for(var r=-1,i=e.length,s={};++r<i;){var o=e[r],a=_r(t,o);n(a,o)&&Qr(s,bi(o,t),a)}return s}function $r(t,e,n,r){var i=r?Ve:Ue,s=-1,o=e.length,a=t;for(t===e&&(e=Ri(e)),n&&(a=Ie(t,qe(n)));++s<o;)for(var l=0,c=e[s],h=n?n(c):c;(l=i(a,h,l,r))>-1;)a!==t&&Jt.call(a,l,1),Jt.call(t,l,1);return t}function Yr(t,e){for(var n=t?e.length:0,r=n-1;n--;){var i=e[n];if(n==r||i!==s){var s=i;bs(i)?Jt.call(t,i,1):ui(t,i)}}return t}function Xr(t,e){return t+Fe(En()*(e-t+1))}function qr(t,e){var n="";if(!t||e<1||e>h)return n;do{e%2&&(n+=t),(e=Fe(e/2))&&(t+=t)}while(e);return n}function Kr(t,e){return Ds(As(t,e,al),t+"")}function Zr(t){return Zn(Wa(t))}function Jr(t,e){var n=Wa(t);return Ls(n,ar(e,0,n.length))}function Qr(e,n,r,i){if(!ia(e))return e;for(var s=-1,o=(n=bi(n,e)).length,a=o-1,l=e;null!=l&&++s<o;){var c=Vs(n[s]),h=r;if("__proto__"===c||"constructor"===c||"prototype"===c)return e;if(s!=a){var u=l[c];(h=i?i(u,c,l):t)===t&&(h=ia(u)?u:bs(n[s+1])?[]:{})}er(l,c,h),l=l[c]}return e}var ti=Mn?function(t,e){return Mn.set(t,e),t}:al,ei=he?function(t,e){return he(t,"toString",{configurable:!0,enumerable:!1,value:il(e),writable:!0})}:al;function ni(t){return Ls(Wa(t))}function ri(t,e,n){var r=-1,i=t.length;e<0&&(e=-e>i?0:i+e),(n=n>i?i:n)<0&&(n+=i),i=e>n?0:n-e>>>0,e>>>=0;for(var s=Et(i);++r<i;)s[r]=t[r+e];return s}function ii(t,e){var n;return dr(t,(function(t,r,i){return!(n=e(t,r,i))})),!!n}function si(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e==e&&i<=2147483647){for(;r<i;){var s=r+i>>>1,o=t[s];null!==o&&!da(o)&&(n?o<=e:o<e)?r=s+1:i=s}return i}return oi(t,e,al,n)}function oi(e,n,r,i){var s=0,o=null==e?0:e.length;if(0===o)return 0;for(var a=(n=r(n))!=n,l=null===n,c=da(n),h=n===t;s<o;){var u=Fe((s+o)/2),d=r(e[u]),f=d!==t,p=null===d,m=d==d,g=da(d);if(a)var v=i||m;else v=h?m&&(i||f):l?m&&f&&(i||!p):c?m&&f&&!p&&(i||!g):!p&&!g&&(i?d<=n:d<n);v?s=u+1:o=u}return bn(o,4294967294)}function ai(t,e){for(var n=-1,r=t.length,i=0,s=[];++n<r;){var o=t[n],a=e?e(o):o;if(!n||!Wo(a,l)){var l=a;s[i++]=0===o?0:o}}return s}function li(t){return"number"==typeof t?t:da(t)?u:+t}function ci(t){if("string"==typeof t)return t;if(Xo(t))return Ie(t,ci)+"";if(da(t))return Un?Un.call(t):"";var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function hi(t,e,n){var r=-1,i=Re,s=t.length,o=!0,a=[],l=a;if(n)o=!1,i=Me;else if(s>=200){var c=e?null:Ki(t);if(c)return ln(c);o=!1,i=Ze,l=new Xn}else l=e?[]:a;t:for(;++r<s;){var h=t[r],u=e?e(h):h;if(h=n||0!==h?h:0,o&&u==u){for(var d=l.length;d--;)if(l[d]===u)continue t;e&&l.push(u),a.push(h)}else i(l,u,n)||(l!==a&&l.push(u),a.push(h))}return a}function ui(t,e){return null==(t=Cs(t,e=bi(e,t)))||delete t[Vs(Qs(e))]}function di(t,e,n,r){return Qr(t,e,n(_r(t,e)),r)}function fi(t,e,n,r){for(var i=t.length,s=r?i:-1;(r?s--:++s<i)&&e(t[s],s,t););return n?ri(t,r?0:s,r?s+1:i):ri(t,r?s+1:0,r?i:s)}function pi(t,e){var n=t;return n instanceof Wn&&(n=n.value()),Oe(e,(function(t,e){return e.func.apply(e.thisArg,De([t],e.args))}),n)}function mi(t,e,n){var r=t.length;if(r<2)return r?hi(t[0]):[];for(var i=-1,s=Et(r);++i<r;)for(var o=t[i],a=-1;++a<r;)a!=i&&(s[i]=ur(s[i]||o,t[a],e,n));return hi(vr(s,1),e,n)}function gi(e,n,r){for(var i=-1,s=e.length,o=n.length,a={};++i<s;){var l=i<o?n[i]:t;r(a,e[i],l)}return a}function vi(t){return Zo(t)?t:[]}function yi(t){return"function"==typeof t?t:al}function bi(t,e){return Xo(t)?t:ws(t,e)?[t]:Us(Ea(t))}var xi=Kr;function wi(e,n,r){var i=e.length;return r=r===t?i:r,!n&&r>=i?e:ri(e,n,r)}var Ei=de||function(t){return ue.clearTimeout(t)};function _i(t,e){if(e)return t.slice();var n=t.length,r=$t?$t(n):new t.constructor(n);return t.copy(r),r}function Si(t){var e=new t.constructor(t.byteLength);return new Ht(e).set(new Ht(t)),e}function Ti(t,e){var n=e?Si(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ki(e,n){if(e!==n){var r=e!==t,i=null===e,s=e==e,o=da(e),a=n!==t,l=null===n,c=n==n,h=da(n);if(!l&&!h&&!o&&e>n||o&&a&&c&&!l&&!h||i&&a&&c||!r&&c||!s)return 1;if(!i&&!o&&!h&&e<n||h&&r&&s&&!i&&!o||l&&r&&s||!a&&s||!c)return-1}return 0}function Ai(t,e,n,r){for(var i=-1,s=t.length,o=n.length,a=-1,l=e.length,c=yn(s-o,0),h=Et(l+c),u=!r;++a<l;)h[a]=e[a];for(;++i<o;)(u||i<s)&&(h[n[i]]=t[i]);for(;c--;)h[a++]=t[i++];return h}function Ci(t,e,n,r){for(var i=-1,s=t.length,o=-1,a=n.length,l=-1,c=e.length,h=yn(s-a,0),u=Et(h+c),d=!r;++i<h;)u[i]=t[i];for(var f=i;++l<c;)u[f+l]=e[l];for(;++o<a;)(d||i<s)&&(u[f+n[o]]=t[i++]);return u}function Ri(t,e){var n=-1,r=t.length;for(e||(e=Et(r));++n<r;)e[n]=t[n];return e}function Mi(e,n,r,i){var s=!r;r||(r={});for(var o=-1,a=n.length;++o<a;){var l=n[o],c=i?i(r[l],e[l],l,r,e):t;c===t&&(c=e[l]),s?sr(r,l,c):er(r,l,c)}return r}function Ii(t,e){return function(n,r){var i=Xo(n)?Se:rr,s=e?e():{};return i(n,t,cs(r,2),s)}}function Di(e){return Kr((function(n,r){var i=-1,s=r.length,o=s>1?r[s-1]:t,a=s>2?r[2]:t;for(o=e.length>3&&"function"==typeof o?(s--,o):t,a&&xs(r[0],r[1],a)&&(o=s<3?t:o,s=1),n=At(n);++i<s;){var l=r[i];l&&e(n,l,i,o)}return n}))}function Oi(t,e){return function(n,r){if(null==n)return n;if(!Ko(n))return t(n,r);for(var i=n.length,s=e?i:-1,o=At(n);(e?s--:++s<i)&&!1!==r(o[s],s,o););return n}}function Pi(t){return function(e,n,r){for(var i=-1,s=At(e),o=r(e),a=o.length;a--;){var l=o[t?a:++i];if(!1===n(s[l],l,s))break}return e}}function Li(e){return function(n){var r=rn(n=Ea(n))?hn(n):t,i=r?r[0]:n.charAt(0),s=r?wi(r,1).join(""):n.slice(1);return i[e]()+s}}function Fi(t){return function(e){return Oe(el(Ya(e).replace(Kt,"")),t,"")}}function Bi(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=jn(t.prototype),r=t.apply(n,e);return ia(r)?r:n}}function Ui(e){return function(n,r,i){var s=At(n);if(!Ko(n)){var o=cs(r,3);n=La(n),r=function(t){return o(s[t],t,s)}}var a=e(n,r,i);return a>-1?s[o?n[a]:a]:t}}function Vi(n){return rs((function(r){var i=r.length,s=i,o=Gn.prototype.thru;for(n&&r.reverse();s--;){var a=r[s];if("function"!=typeof a)throw new Mt(e);if(o&&!l&&"wrapper"==as(a))var l=new Gn([],!0)}for(s=l?s:i;++s<i;){var c=as(a=r[s]),h="wrapper"==c?os(a):t;l=h&&Es(h[0])&&424==h[1]&&!h[4].length&&1==h[9]?l[as(h[0])].apply(l,h[3]):1==a.length&&Es(a)?l[c]():l.thru(a)}return function(){var t=arguments,e=t[0];if(l&&1==t.length&&Xo(e))return l.plant(e).value();for(var n=0,s=i?r[n].apply(this,t):e;++n<i;)s=r[n].call(this,s);return s}}))}function ji(e,n,r,i,s,o,l,c,h,u){var d=n&a,f=1&n,p=2&n,m=24&n,g=512&n,v=p?t:Bi(e);return function a(){for(var y=arguments.length,b=Et(y),x=y;x--;)b[x]=arguments[x];if(m)var w=ls(a),E=function(t,e){for(var n=t.length,r=0;n--;)t[n]===e&&++r;return r}(b,w);if(i&&(b=Ai(b,i,s,m)),o&&(b=Ci(b,o,l,m)),y-=E,m&&y<u){var _=an(b,w);return Xi(e,n,ji,a.placeholder,r,b,_,c,h,u-y)}var S=f?r:this,T=p?S[e]:e;return y=b.length,c?b=function(e,n){for(var r=e.length,i=bn(n.length,r),s=Ri(e);i--;){var o=n[i];e[i]=bs(o,r)?s[o]:t}return e}(b,c):g&&y>1&&b.reverse(),d&&h<y&&(b.length=h),this&&this!==ue&&this instanceof a&&(T=v||Bi(T)),T.apply(S,b)}}function zi(t,e){return function(n,r){return function(t,e,n,r){return xr(t,(function(t,i,s){e(r,n(t),i,s)})),r}(n,t,e(r),{})}}function Gi(e,n){return function(r,i){var s;if(r===t&&i===t)return n;if(r!==t&&(s=r),i!==t){if(s===t)return i;"string"==typeof r||"string"==typeof i?(r=ci(r),i=ci(i)):(r=li(r),i=li(i)),s=e(r,i)}return s}}function Wi(t){return rs((function(e){return e=Ie(e,qe(cs())),Kr((function(n){var r=this;return t(e,(function(t){return _e(t,r,n)}))}))}))}function Hi(e,n){var r=(n=n===t?" ":ci(n)).length;if(r<2)return r?qr(n,e):n;var i=qr(n,ge(e/cn(n)));return rn(n)?wi(hn(i),0,e).join(""):i.slice(0,e)}function $i(e){return function(n,r,i){return i&&"number"!=typeof i&&xs(n,r,i)&&(r=i=t),n=va(n),r===t?(r=n,n=0):r=va(r),function(t,e,n,r){for(var i=-1,s=yn(ge((e-t)/(n||1)),0),o=Et(s);s--;)o[r?s:++i]=t,t+=n;return o}(n,r,i=i===t?n<r?1:-1:va(i),e)}}function Yi(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=xa(e),n=xa(n)),t(e,n)}}function Xi(e,n,r,i,a,l,c,h,u,d){var f=8&n;n|=f?s:o,4&(n&=~(f?o:s))||(n&=-4);var p=[e,n,a,f?l:t,f?c:t,f?t:l,f?t:c,h,u,d],m=r.apply(t,p);return Es(e)&&Ms(m,p),m.placeholder=i,Os(m,e,n)}function qi(t){var e=kt[t];return function(t,n){if(t=xa(t),(n=null==n?0:bn(ya(n),292))&&mn(t)){var r=(Ea(t)+"e").split("e");return+((r=(Ea(e(r[0]+"e"+(+r[1]+n)))+"e").split("e"))[0]+"e"+(+r[1]-n))}return e(t)}}var Ki=An&&1/ln(new An([,-0]))[1]==c?function(t){return new An(t)}:dl;function Zi(t){return function(e){var n=ms(e);return n==w?sn(e):n==k?function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}(e):function(t,e){return Ie(e,(function(e){return[e,t[e]]}))}(e,t(e))}}function Ji(n,c,h,u,d,f,p,m){var g=2&c;if(!g&&"function"!=typeof n)throw new Mt(e);var v=u?u.length:0;if(v||(c&=-97,u=d=t),p=p===t?p:yn(ya(p),0),m=m===t?m:ya(m),v-=d?d.length:0,c&o){var y=u,b=d;u=d=t}var x=g?t:os(n),w=[n,c,h,u,d,y,b,f,p,m];if(x&&function(t,e){var n=t[1],i=e[1],s=n|i,o=s<131,c=i==a&&8==n||i==a&&n==l&&t[7].length<=e[8]||384==i&&e[7].length<=e[8]&&8==n;if(!o&&!c)return t;1&i&&(t[2]=e[2],s|=1&n?0:4);var h=e[3];if(h){var u=t[3];t[3]=u?Ai(u,h,e[4]):h,t[4]=u?an(t[3],r):e[4]}(h=e[5])&&(u=t[5],t[5]=u?Ci(u,h,e[6]):h,t[6]=u?an(t[5],r):e[6]),(h=e[7])&&(t[7]=h),i&a&&(t[8]=null==t[8]?e[8]:bn(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=s}(w,x),n=w[0],c=w[1],h=w[2],u=w[3],d=w[4],!(m=w[9]=w[9]===t?g?0:n.length:yn(w[9]-v,0))&&24&c&&(c&=-25),c&&1!=c)E=8==c||c==i?function(e,n,r){var i=Bi(e);return function s(){for(var o=arguments.length,a=Et(o),l=o,c=ls(s);l--;)a[l]=arguments[l];var h=o<3&&a[0]!==c&&a[o-1]!==c?[]:an(a,c);return(o-=h.length)<r?Xi(e,n,ji,s.placeholder,t,a,h,t,t,r-o):_e(this&&this!==ue&&this instanceof s?i:e,this,a)}}(n,c,m):c!=s&&33!=c||d.length?ji.apply(t,w):function(t,e,n,r){var i=1&e,s=Bi(t);return function e(){for(var o=-1,a=arguments.length,l=-1,c=r.length,h=Et(c+a),u=this&&this!==ue&&this instanceof e?s:t;++l<c;)h[l]=r[l];for(;a--;)h[l++]=arguments[++o];return _e(u,i?n:this,h)}}(n,c,h,u);else var E=function(t,e,n){var r=1&e,i=Bi(t);return function e(){return(this&&this!==ue&&this instanceof e?i:t).apply(r?n:this,arguments)}}(n,c,h);return Os((x?ti:Ms)(E,w),n,c)}function Qi(e,n,r,i){return e===t||Wo(e,Ot[r])&&!Ft.call(i,r)?n:e}function ts(e,n,r,i,s,o){return ia(e)&&ia(n)&&(o.set(n,e),zr(e,n,t,ts,o),o.delete(n)),e}function es(e){return la(e)?t:e}function ns(e,n,r,i,s,o){var a=1&r,l=e.length,c=n.length;if(l!=c&&!(a&&c>l))return!1;var h=o.get(e),u=o.get(n);if(h&&u)return h==n&&u==e;var d=-1,f=!0,p=2&r?new Xn:t;for(o.set(e,n),o.set(n,e);++d<l;){var m=e[d],g=n[d];if(i)var v=a?i(g,m,d,n,e,o):i(m,g,d,e,n,o);if(v!==t){if(v)continue;f=!1;break}if(p){if(!Le(n,(function(t,e){if(!Ze(p,e)&&(m===t||s(m,t,r,i,o)))return p.push(e)}))){f=!1;break}}else if(m!==g&&!s(m,g,r,i,o)){f=!1;break}}return o.delete(e),o.delete(n),f}function rs(e){return Ds(As(e,t,Xs),e+"")}function is(t){return Sr(t,La,fs)}function ss(t){return Sr(t,Fa,ps)}var os=Mn?function(t){return Mn.get(t)}:dl;function as(t){for(var e=t.name+"",n=In[e],r=Ft.call(In,e)?n.length:0;r--;){var i=n[r],s=i.func;if(null==s||s==t)return i.name}return e}function ls(t){return(Ft.call(Vn,"placeholder")?Vn:t).placeholder}function cs(){var t=Vn.iteratee||ll;return t=t===ll?Lr:t,arguments.length?t(arguments[0],arguments[1]):t}function hs(t,e){var n,r,i=t.__data__;return("string"==(r=typeof(n=e))||"number"==r||"symbol"==r||"boolean"==r?"__proto__"!==n:null===n)?i["string"==typeof e?"string":"hash"]:i.map}function us(t){for(var e=La(t),n=e.length;n--;){var r=e[n],i=t[r];e[n]=[r,i,Ts(i)]}return e}function ds(e,n){var r=function(e,n){return null==e?t:e[n]}(e,n);return Pr(r)?r:t}var fs=We?function(t){return null==t?[]:(t=At(t),Ce(We(t),(function(e){return qt.call(t,e)})))}:bl,ps=We?function(t){for(var e=[];t;)De(e,fs(t)),t=Yt(t);return e}:bl,ms=Tr;function gs(t,e,n){for(var r=-1,i=(e=bi(e,t)).length,s=!1;++r<i;){var o=Vs(e[r]);if(!(s=null!=t&&n(t,o)))break;t=t[o]}return s||++r!=i?s:!!(i=null==t?0:t.length)&&ra(i)&&bs(o,i)&&(Xo(t)||Yo(t))}function vs(t){return"function"!=typeof t.constructor||Ss(t)?{}:jn(Yt(t))}function ys(t){return Xo(t)||Yo(t)||!!(te&&t&&t[te])}function bs(t,e){var n=typeof t;return!!(e=null==e?h:e)&&("number"==n||"symbol"!=n&&gt.test(t))&&t>-1&&t%1==0&&t<e}function xs(t,e,n){if(!ia(n))return!1;var r=typeof e;return!!("number"==r?Ko(n)&&bs(e,n.length):"string"==r&&e in n)&&Wo(n[e],t)}function ws(t,e){if(Xo(t))return!1;var n=typeof t;return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!da(t))||J.test(t)||!Z.test(t)||null!=e&&t in At(e)}function Es(t){var e=as(t),n=Vn[e];if("function"!=typeof n||!(e in Wn.prototype))return!1;if(t===n)return!0;var r=os(n);return!!r&&t===r[0]}(Sn&&ms(new Sn(new ArrayBuffer(1)))!=I||Tn&&ms(new Tn)!=w||kn&&ms(kn.resolve())!=S||An&&ms(new An)!=k||Cn&&ms(new Cn)!=R)&&(ms=function(e){var n=Tr(e),r=n==_?e.constructor:t,i=r?js(r):"";if(i)switch(i){case Dn:return I;case On:return w;case Pn:return S;case Ln:return k;case Fn:return R}return n});var _s=Pt?ea:xl;function Ss(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Ot)}function Ts(t){return t==t&&!ia(t)}function ks(e,n){return function(r){return null!=r&&r[e]===n&&(n!==t||e in At(r))}}function As(e,n,r){return n=yn(n===t?e.length-1:n,0),function(){for(var t=arguments,i=-1,s=yn(t.length-n,0),o=Et(s);++i<s;)o[i]=t[n+i];i=-1;for(var a=Et(n+1);++i<n;)a[i]=t[i];return a[n]=r(o),_e(e,this,a)}}function Cs(t,e){return e.length<2?t:_r(t,ri(e,0,-1))}function Rs(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}var Ms=Ps(ti),Is=me||function(t,e){return ue.setTimeout(t,e)},Ds=Ps(ei);function Os(t,e,n){var r=e+"";return Ds(t,function(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(it,"{\n/* [wrapped with "+e+"] */\n")}(r,function(t,e){return Te(f,(function(n){var r="_."+n[0];e&n[1]&&!Re(t,r)&&t.push(r)})),t.sort()}(function(t){var e=t.match(st);return e?e[1].split(ot):[]}(r),n)))}function Ps(e){var n=0,r=0;return function(){var i=xn(),s=16-(i-r);if(r=i,s>0){if(++n>=800)return arguments[0]}else n=0;return e.apply(t,arguments)}}function Ls(e,n){var r=-1,i=e.length,s=i-1;for(n=n===t?i:n;++r<n;){var o=Xr(r,s),a=e[o];e[o]=e[r],e[r]=a}return e.length=n,e}var Fs,Ns,Bs,Us=(Fs=function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Q,(function(t,n,r,i){e.push(r?i.replace(ct,"$1"):n||t)})),e},Ns=Bo(Fs,(function(t){return 500===Bs.size&&Bs.clear(),t})),Bs=Ns.cache,Ns);function Vs(t){if("string"==typeof t||da(t))return t;var e=t+"";return"0"==e&&1/t==-1/0?"-0":e}function js(t){if(null!=t){try{return Lt.call(t)}catch(Ni){}try{return t+""}catch(Ni){}}return""}function zs(t){if(t instanceof Wn)return t.clone();var e=new Gn(t.__wrapped__,t.__chain__);return e.__actions__=Ri(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var Gs=Kr((function(t,e){return Zo(t)?ur(t,vr(e,1,Zo,!0)):[]})),Ws=Kr((function(e,n){var r=Qs(n);return Zo(r)&&(r=t),Zo(e)?ur(e,vr(n,1,Zo,!0),cs(r,2)):[]})),Hs=Kr((function(e,n){var r=Qs(n);return Zo(r)&&(r=t),Zo(e)?ur(e,vr(n,1,Zo,!0),t,r):[]}));function $s(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ya(n);return i<0&&(i=yn(r+i,0)),Be(t,cs(e,3),i)}function Ys(e,n,r){var i=null==e?0:e.length;if(!i)return-1;var s=i-1;return r!==t&&(s=ya(r),s=r<0?yn(i+s,0):bn(s,i-1)),Be(e,cs(n,3),s,!0)}function Xs(t){return null!=t&&t.length?vr(t,1):[]}function qs(e){return e&&e.length?e[0]:t}var Ks=Kr((function(t){var e=Ie(t,vi);return e.length&&e[0]===t[0]?Rr(e):[]})),Zs=Kr((function(e){var n=Qs(e),r=Ie(e,vi);return n===Qs(r)?n=t:r.pop(),r.length&&r[0]===e[0]?Rr(r,cs(n,2)):[]})),Js=Kr((function(e){var n=Qs(e),r=Ie(e,vi);return(n="function"==typeof n?n:t)&&r.pop(),r.length&&r[0]===e[0]?Rr(r,t,n):[]}));function Qs(e){var n=null==e?0:e.length;return n?e[n-1]:t}var to=Kr(eo);function eo(t,e){return t&&t.length&&e&&e.length?$r(t,e):t}var no=rs((function(t,e){var n=null==t?0:t.length,r=or(t,e);return Yr(t,Ie(e,(function(t){return bs(t,n)?+t:t})).sort(ki)),r}));function ro(t){return null==t?t:_n.call(t)}var io=Kr((function(t){return hi(vr(t,1,Zo,!0))})),so=Kr((function(e){var n=Qs(e);return Zo(n)&&(n=t),hi(vr(e,1,Zo,!0),cs(n,2))})),oo=Kr((function(e){var n=Qs(e);return n="function"==typeof n?n:t,hi(vr(e,1,Zo,!0),t,n)}));function ao(t){if(!t||!t.length)return[];var e=0;return t=Ce(t,(function(t){if(Zo(t))return e=yn(t.length,e),!0})),Ye(e,(function(e){return Ie(t,Ge(e))}))}function lo(e,n){if(!e||!e.length)return[];var r=ao(e);return null==n?r:Ie(r,(function(e){return _e(n,t,e)}))}var co=Kr((function(t,e){return Zo(t)?ur(t,e):[]})),ho=Kr((function(t){return mi(Ce(t,Zo))})),uo=Kr((function(e){var n=Qs(e);return Zo(n)&&(n=t),mi(Ce(e,Zo),cs(n,2))})),fo=Kr((function(e){var n=Qs(e);return n="function"==typeof n?n:t,mi(Ce(e,Zo),t,n)})),po=Kr(ao),mo=Kr((function(e){var n=e.length,r=n>1?e[n-1]:t;return r="function"==typeof r?(e.pop(),r):t,lo(e,r)}));function go(t){var e=Vn(t);return e.__chain__=!0,e}function vo(t,e){return e(t)}var yo=rs((function(e){var n=e.length,r=n?e[0]:0,i=this.__wrapped__,s=function(t){return or(t,e)};return!(n>1||this.__actions__.length)&&i instanceof Wn&&bs(r)?((i=i.slice(r,+r+(n?1:0))).__actions__.push({func:vo,args:[s],thisArg:t}),new Gn(i,this.__chain__).thru((function(e){return n&&!e.length&&e.push(t),e}))):this.thru(s)})),bo=Ii((function(t,e,n){Ft.call(t,n)?++t[n]:sr(t,n,1)})),xo=Ui($s),wo=Ui(Ys);function Eo(t,e){return(Xo(t)?Te:dr)(t,cs(e,3))}function _o(t,e){return(Xo(t)?ke:fr)(t,cs(e,3))}var So=Ii((function(t,e,n){Ft.call(t,n)?t[n].push(e):sr(t,n,[e])})),To=Kr((function(t,e,n){var r=-1,i="function"==typeof e,s=Ko(t)?Et(t.length):[];return dr(t,(function(t){s[++r]=i?_e(e,t,n):Mr(t,e,n)})),s})),ko=Ii((function(t,e,n){sr(t,n,e)}));function Ao(t,e){return(Xo(t)?Ie:Ur)(t,cs(e,3))}var Co=Ii((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]})),Ro=Kr((function(t,e){if(null==t)return[];var n=e.length;return n>1&&xs(t,e[0],e[1])?e=[]:n>2&&xs(e[0],e[1],e[2])&&(e=[e[0]]),Wr(t,vr(e,1),[])})),Mo=fe||function(){return ue.Date.now()};function Io(e,n,r){return n=r?t:n,n=e&&null==n?e.length:n,Ji(e,a,t,t,t,t,n)}function Do(n,r){var i;if("function"!=typeof r)throw new Mt(e);return n=ya(n),function(){return--n>0&&(i=r.apply(this,arguments)),n<=1&&(r=t),i}}var Oo=Kr((function(t,e,n){var r=1;if(n.length){var i=an(n,ls(Oo));r|=s}return Ji(t,r,e,n,i)})),Po=Kr((function(t,e,n){var r=3;if(n.length){var i=an(n,ls(Po));r|=s}return Ji(e,r,t,n,i)}));function Lo(n,r,i){var s,o,a,l,c,h,u=0,d=!1,f=!1,p=!0;if("function"!=typeof n)throw new Mt(e);function m(e){var r=s,i=o;return s=o=t,u=e,l=n.apply(i,r)}function g(e){var n=e-h;return h===t||n>=r||n<0||f&&e-u>=a}function v(){var t=Mo();if(g(t))return y(t);c=Is(v,function(t){var e=r-(t-h);return f?bn(e,a-(t-u)):e}(t))}function y(e){return c=t,p&&s?m(e):(s=o=t,l)}function b(){var e=Mo(),n=g(e);if(s=arguments,o=this,h=e,n){if(c===t)return function(t){return u=t,c=Is(v,r),d?m(t):l}(h);if(f)return Ei(c),c=Is(v,r),m(h)}return c===t&&(c=Is(v,r)),l}return r=xa(r)||0,ia(i)&&(d=!!i.leading,a=(f="maxWait"in i)?yn(xa(i.maxWait)||0,r):a,p="trailing"in i?!!i.trailing:p),b.cancel=function(){c!==t&&Ei(c),u=0,s=h=o=c=t},b.flush=function(){return c===t?l:y(Mo())},b}var Fo=Kr((function(t,e){return hr(t,1,e)})),No=Kr((function(t,e,n){return hr(t,xa(e)||0,n)}));function Bo(t,n){if("function"!=typeof t||null!=n&&"function"!=typeof n)throw new Mt(e);var r=function(){var e=arguments,i=n?n.apply(this,e):e[0],s=r.cache;if(s.has(i))return s.get(i);var o=t.apply(this,e);return r.cache=s.set(i,o)||s,o};return r.cache=new(Bo.Cache||Yn),r}function Uo(t){if("function"!=typeof t)throw new Mt(e);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}Bo.Cache=Yn;var Vo=xi((function(t,e){var n=(e=1==e.length&&Xo(e[0])?Ie(e[0],qe(cs())):Ie(vr(e,1),qe(cs()))).length;return Kr((function(r){for(var i=-1,s=bn(r.length,n);++i<s;)r[i]=e[i].call(this,r[i]);return _e(t,this,r)}))})),jo=Kr((function(e,n){var r=an(n,ls(jo));return Ji(e,s,t,n,r)})),zo=Kr((function(e,n){var r=an(n,ls(zo));return Ji(e,o,t,n,r)})),Go=rs((function(e,n){return Ji(e,l,t,t,t,n)}));function Wo(t,e){return t===e||t!=t&&e!=e}var Ho=Yi(kr),$o=Yi((function(t,e){return t>=e})),Yo=Ir(function(){return arguments}())?Ir:function(t){return sa(t)&&Ft.call(t,"callee")&&!qt.call(t,"callee")},Xo=Et.isArray,qo=ve?qe(ve):function(t){return sa(t)&&Tr(t)==M};function Ko(t){return null!=t&&ra(t.length)&&!ea(t)}function Zo(t){return sa(t)&&Ko(t)}var Jo=pn||xl,Qo=ye?qe(ye):function(t){return sa(t)&&Tr(t)==v};function ta(t){if(!sa(t))return!1;var e=Tr(t);return e==y||"[object DOMException]"==e||"string"==typeof t.message&&"string"==typeof t.name&&!la(t)}function ea(t){if(!ia(t))return!1;var e=Tr(t);return e==b||e==x||"[object AsyncFunction]"==e||"[object Proxy]"==e}function na(t){return"number"==typeof t&&t==ya(t)}function ra(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=h}function ia(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}function sa(t){return null!=t&&"object"==typeof t}var oa=be?qe(be):function(t){return sa(t)&&ms(t)==w};function aa(t){return"number"==typeof t||sa(t)&&Tr(t)==E}function la(t){if(!sa(t)||Tr(t)!=_)return!1;var e=Yt(t);if(null===e)return!0;var n=Ft.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&Lt.call(n)==Vt}var ca=xe?qe(xe):function(t){return sa(t)&&Tr(t)==T},ha=we?qe(we):function(t){return sa(t)&&ms(t)==k};function ua(t){return"string"==typeof t||!Xo(t)&&sa(t)&&Tr(t)==A}function da(t){return"symbol"==typeof t||sa(t)&&Tr(t)==C}var fa=Ee?qe(Ee):function(t){return sa(t)&&ra(t.length)&&!!ie[Tr(t)]},pa=Yi(Br),ma=Yi((function(t,e){return t<=e}));function ga(t){if(!t)return[];if(Ko(t))return ua(t)?hn(t):Ri(t);if(oe&&t[oe])return function(t){for(var e,n=[];!(e=t.next()).done;)n.push(e.value);return n}(t[oe]());var e=ms(t);return(e==w?sn:e==k?ln:Wa)(t)}function va(t){return t?(t=xa(t))===c||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0}function ya(t){var e=va(t),n=e%1;return e==e?n?e-n:e:0}function ba(t){return t?ar(ya(t),0,d):0}function xa(t){if("number"==typeof t)return t;if(da(t))return u;if(ia(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=ia(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Xe(t);var n=ft.test(t);return n||mt.test(t)?le(t.slice(2),n?2:8):dt.test(t)?u:+t}function wa(t){return Mi(t,Fa(t))}function Ea(t){return null==t?"":ci(t)}var _a=Di((function(t,e){if(Ss(e)||Ko(e))Mi(e,La(e),t);else for(var n in e)Ft.call(e,n)&&er(t,n,e[n])})),Sa=Di((function(t,e){Mi(e,Fa(e),t)})),Ta=Di((function(t,e,n,r){Mi(e,Fa(e),t,r)})),ka=Di((function(t,e,n,r){Mi(e,La(e),t,r)})),Aa=rs(or),Ca=Kr((function(e,n){e=At(e);var r=-1,i=n.length,s=i>2?n[2]:t;for(s&&xs(n[0],n[1],s)&&(i=1);++r<i;)for(var o=n[r],a=Fa(o),l=-1,c=a.length;++l<c;){var h=a[l],u=e[h];(u===t||Wo(u,Ot[h])&&!Ft.call(e,h))&&(e[h]=o[h])}return e})),Ra=Kr((function(e){return e.push(t,ts),_e(Ba,t,e)}));function Ma(e,n,r){var i=null==e?t:_r(e,n);return i===t?r:i}function Ia(t,e){return null!=t&&gs(t,e,Cr)}var Da=zi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ut.call(e)),t[e]=n}),il(al)),Oa=zi((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=Ut.call(e)),Ft.call(t,e)?t[e].push(n):t[e]=[n]}),cs),Pa=Kr(Mr);function La(t){return Ko(t)?Kn(t):Fr(t)}function Fa(t){return Ko(t)?Kn(t,!0):Nr(t)}var Na=Di((function(t,e,n){zr(t,e,n)})),Ba=Di((function(t,e,n,r){zr(t,e,n,r)})),Ua=rs((function(t,e){var n={};if(null==t)return n;var r=!1;e=Ie(e,(function(e){return e=bi(e,t),r||(r=e.length>1),e})),Mi(t,ss(t),n),r&&(n=lr(n,7,es));for(var i=e.length;i--;)ui(n,e[i]);return n})),Va=rs((function(t,e){return null==t?{}:function(t,e){return Hr(t,e,(function(e,n){return Ia(t,n)}))}(t,e)}));function ja(t,e){if(null==t)return{};var n=Ie(ss(t),(function(t){return[t]}));return e=cs(e),Hr(t,n,(function(t,n){return e(t,n[0])}))}var za=Zi(La),Ga=Zi(Fa);function Wa(t){return null==t?[]:Ke(t,La(t))}var Ha=Fi((function(t,e,n){return e=e.toLowerCase(),t+(n?$a(e):e)}));function $a(t){return tl(Ea(t).toLowerCase())}function Ya(t){return(t=Ea(t))&&t.replace(vt,tn).replace(Zt,"")}var Xa=Fi((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),qa=Fi((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),Ka=Li("toLowerCase"),Za=Fi((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()})),Ja=Fi((function(t,e,n){return t+(n?" ":"")+tl(e)})),Qa=Fi((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),tl=Li("toUpperCase");function el(e,n,r){return e=Ea(e),(n=r?t:n)===t?function(t){return ee.test(t)}(e)?function(t){return t.match(Qt)||[]}(e):function(t){return t.match(at)||[]}(e):e.match(n)||[]}var nl=Kr((function(e,n){try{return _e(e,t,n)}catch(Ni){return ta(Ni)?Ni:new St(Ni)}})),rl=rs((function(t,e){return Te(e,(function(e){e=Vs(e),sr(t,e,Oo(t[e],t))})),t}));function il(t){return function(){return t}}var sl=Vi(),ol=Vi(!0);function al(t){return t}function ll(t){return Lr("function"==typeof t?t:lr(t,1))}var cl=Kr((function(t,e){return function(n){return Mr(n,t,e)}})),hl=Kr((function(t,e){return function(n){return Mr(t,n,e)}}));function ul(t,e,n){var r=La(e),i=Er(e,r);null!=n||ia(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Er(e,La(e)));var s=!(ia(n)&&"chain"in n&&!n.chain),o=ea(t);return Te(i,(function(n){var r=e[n];t[n]=r,o&&(t.prototype[n]=function(){var e=this.__chain__;if(s||e){var n=t(this.__wrapped__);return(n.__actions__=Ri(this.__actions__)).push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,De([this.value()],arguments))})})),t}function dl(){}var fl=Wi(Ie),pl=Wi(Ae),ml=Wi(Le);function gl(t){return ws(t)?Ge(Vs(t)):function(t){return function(e){return _r(e,t)}}(t)}var vl=$i(),yl=$i(!0);function bl(){return[]}function xl(){return!1}var wl,El=Gi((function(t,e){return t+e}),0),_l=qi("ceil"),Sl=Gi((function(t,e){return t/e}),1),Tl=qi("floor"),kl=Gi((function(t,e){return t*e}),1),Al=qi("round"),Cl=Gi((function(t,e){return t-e}),0);return Vn.after=function(t,n){if("function"!=typeof n)throw new Mt(e);return t=ya(t),function(){if(--t<1)return n.apply(this,arguments)}},Vn.ary=Io,Vn.assign=_a,Vn.assignIn=Sa,Vn.assignInWith=Ta,Vn.assignWith=ka,Vn.at=Aa,Vn.before=Do,Vn.bind=Oo,Vn.bindAll=rl,Vn.bindKey=Po,Vn.castArray=function(){if(!arguments.length)return[];var t=arguments[0];return Xo(t)?t:[t]},Vn.chain=go,Vn.chunk=function(e,n,r){n=(r?xs(e,n,r):n===t)?1:yn(ya(n),0);var i=null==e?0:e.length;if(!i||n<1)return[];for(var s=0,o=0,a=Et(ge(i/n));s<i;)a[o++]=ri(e,s,s+=n);return a},Vn.compact=function(t){for(var e=-1,n=null==t?0:t.length,r=0,i=[];++e<n;){var s=t[e];s&&(i[r++]=s)}return i},Vn.concat=function(){var t=arguments.length;if(!t)return[];for(var e=Et(t-1),n=arguments[0],r=t;r--;)e[r-1]=arguments[r];return De(Xo(n)?Ri(n):[n],vr(e,1))},Vn.cond=function(t){var n=null==t?0:t.length,r=cs();return t=n?Ie(t,(function(t){if("function"!=typeof t[1])throw new Mt(e);return[r(t[0]),t[1]]})):[],Kr((function(e){for(var r=-1;++r<n;){var i=t[r];if(_e(i[0],this,e))return _e(i[1],this,e)}}))},Vn.conforms=function(t){return function(t){var e=La(t);return function(n){return cr(n,t,e)}}(lr(t,1))},Vn.constant=il,Vn.countBy=bo,Vn.create=function(t,e){var n=jn(t);return null==e?n:ir(n,e)},Vn.curry=function e(n,r,i){var s=Ji(n,8,t,t,t,t,t,r=i?t:r);return s.placeholder=e.placeholder,s},Vn.curryRight=function e(n,r,s){var o=Ji(n,i,t,t,t,t,t,r=s?t:r);return o.placeholder=e.placeholder,o},Vn.debounce=Lo,Vn.defaults=Ca,Vn.defaultsDeep=Ra,Vn.defer=Fo,Vn.delay=No,Vn.difference=Gs,Vn.differenceBy=Ws,Vn.differenceWith=Hs,Vn.drop=function(e,n,r){var i=null==e?0:e.length;return i?ri(e,(n=r||n===t?1:ya(n))<0?0:n,i):[]},Vn.dropRight=function(e,n,r){var i=null==e?0:e.length;return i?ri(e,0,(n=i-(n=r||n===t?1:ya(n)))<0?0:n):[]},Vn.dropRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0,!0):[]},Vn.dropWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!0):[]},Vn.fill=function(e,n,r,i){var s=null==e?0:e.length;return s?(r&&"number"!=typeof r&&xs(e,n,r)&&(r=0,i=s),function(e,n,r,i){var s=e.length;for((r=ya(r))<0&&(r=-r>s?0:s+r),(i=i===t||i>s?s:ya(i))<0&&(i+=s),i=r>i?0:ba(i);r<i;)e[r++]=n;return e}(e,n,r,i)):[]},Vn.filter=function(t,e){return(Xo(t)?Ce:gr)(t,cs(e,3))},Vn.flatMap=function(t,e){return vr(Ao(t,e),1)},Vn.flatMapDeep=function(t,e){return vr(Ao(t,e),c)},Vn.flatMapDepth=function(e,n,r){return r=r===t?1:ya(r),vr(Ao(e,n),r)},Vn.flatten=Xs,Vn.flattenDeep=function(t){return null!=t&&t.length?vr(t,c):[]},Vn.flattenDepth=function(e,n){return null!=e&&e.length?vr(e,n=n===t?1:ya(n)):[]},Vn.flip=function(t){return Ji(t,512)},Vn.flow=sl,Vn.flowRight=ol,Vn.fromPairs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},Vn.functions=function(t){return null==t?[]:Er(t,La(t))},Vn.functionsIn=function(t){return null==t?[]:Er(t,Fa(t))},Vn.groupBy=So,Vn.initial=function(t){return null!=t&&t.length?ri(t,0,-1):[]},Vn.intersection=Ks,Vn.intersectionBy=Zs,Vn.intersectionWith=Js,Vn.invert=Da,Vn.invertBy=Oa,Vn.invokeMap=To,Vn.iteratee=ll,Vn.keyBy=ko,Vn.keys=La,Vn.keysIn=Fa,Vn.map=Ao,Vn.mapKeys=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){sr(n,e(t,r,i),t)})),n},Vn.mapValues=function(t,e){var n={};return e=cs(e,3),xr(t,(function(t,r,i){sr(n,r,e(t,r,i))})),n},Vn.matches=function(t){return Vr(lr(t,1))},Vn.matchesProperty=function(t,e){return jr(t,lr(e,1))},Vn.memoize=Bo,Vn.merge=Na,Vn.mergeWith=Ba,Vn.method=cl,Vn.methodOf=hl,Vn.mixin=ul,Vn.negate=Uo,Vn.nthArg=function(t){return t=ya(t),Kr((function(e){return Gr(e,t)}))},Vn.omit=Ua,Vn.omitBy=function(t,e){return ja(t,Uo(cs(e)))},Vn.once=function(t){return Do(2,t)},Vn.orderBy=function(e,n,r,i){return null==e?[]:(Xo(n)||(n=null==n?[]:[n]),Xo(r=i?t:r)||(r=null==r?[]:[r]),Wr(e,n,r))},Vn.over=fl,Vn.overArgs=Vo,Vn.overEvery=pl,Vn.overSome=ml,Vn.partial=jo,Vn.partialRight=zo,Vn.partition=Co,Vn.pick=Va,Vn.pickBy=ja,Vn.property=gl,Vn.propertyOf=function(e){return function(n){return null==e?t:_r(e,n)}},Vn.pull=to,Vn.pullAll=eo,Vn.pullAllBy=function(t,e,n){return t&&t.length&&e&&e.length?$r(t,e,cs(n,2)):t},Vn.pullAllWith=function(e,n,r){return e&&e.length&&n&&n.length?$r(e,n,t,r):e},Vn.pullAt=no,Vn.range=vl,Vn.rangeRight=yl,Vn.rearg=Go,Vn.reject=function(t,e){return(Xo(t)?Ce:gr)(t,Uo(cs(e,3)))},Vn.remove=function(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],s=t.length;for(e=cs(e,3);++r<s;){var o=t[r];e(o,r,t)&&(n.push(o),i.push(r))}return Yr(t,i),n},Vn.rest=function(n,r){if("function"!=typeof n)throw new Mt(e);return Kr(n,r=r===t?r:ya(r))},Vn.reverse=ro,Vn.sampleSize=function(e,n,r){return n=(r?xs(e,n,r):n===t)?1:ya(n),(Xo(e)?Jn:Jr)(e,n)},Vn.set=function(t,e,n){return null==t?t:Qr(t,e,n)},Vn.setWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:Qr(e,n,r,i)},Vn.shuffle=function(t){return(Xo(t)?Qn:ni)(t)},Vn.slice=function(e,n,r){var i=null==e?0:e.length;return i?(r&&"number"!=typeof r&&xs(e,n,r)?(n=0,r=i):(n=null==n?0:ya(n),r=r===t?i:ya(r)),ri(e,n,r)):[]},Vn.sortBy=Ro,Vn.sortedUniq=function(t){return t&&t.length?ai(t):[]},Vn.sortedUniqBy=function(t,e){return t&&t.length?ai(t,cs(e,2)):[]},Vn.split=function(e,n,r){return r&&"number"!=typeof r&&xs(e,n,r)&&(n=r=t),(r=r===t?d:r>>>0)?(e=Ea(e))&&("string"==typeof n||null!=n&&!ca(n))&&!(n=ci(n))&&rn(e)?wi(hn(e),0,r):e.split(n,r):[]},Vn.spread=function(t,n){if("function"!=typeof t)throw new Mt(e);return n=null==n?0:yn(ya(n),0),Kr((function(e){var r=e[n],i=wi(e,0,n);return r&&De(i,r),_e(t,this,i)}))},Vn.tail=function(t){var e=null==t?0:t.length;return e?ri(t,1,e):[]},Vn.take=function(e,n,r){return e&&e.length?ri(e,0,(n=r||n===t?1:ya(n))<0?0:n):[]},Vn.takeRight=function(e,n,r){var i=null==e?0:e.length;return i?ri(e,(n=i-(n=r||n===t?1:ya(n)))<0?0:n,i):[]},Vn.takeRightWhile=function(t,e){return t&&t.length?fi(t,cs(e,3),!1,!0):[]},Vn.takeWhile=function(t,e){return t&&t.length?fi(t,cs(e,3)):[]},Vn.tap=function(t,e){return e(t),t},Vn.throttle=function(t,n,r){var i=!0,s=!0;if("function"!=typeof t)throw new Mt(e);return ia(r)&&(i="leading"in r?!!r.leading:i,s="trailing"in r?!!r.trailing:s),Lo(t,n,{leading:i,maxWait:n,trailing:s})},Vn.thru=vo,Vn.toArray=ga,Vn.toPairs=za,Vn.toPairsIn=Ga,Vn.toPath=function(t){return Xo(t)?Ie(t,Vs):da(t)?[t]:Ri(Us(Ea(t)))},Vn.toPlainObject=wa,Vn.transform=function(t,e,n){var r=Xo(t),i=r||Jo(t)||fa(t);if(e=cs(e,4),null==n){var s=t&&t.constructor;n=i?r?new s:[]:ia(t)&&ea(s)?jn(Yt(t)):{}}return(i?Te:xr)(t,(function(t,r,i){return e(n,t,r,i)})),n},Vn.unary=function(t){return Io(t,1)},Vn.union=io,Vn.unionBy=so,Vn.unionWith=oo,Vn.uniq=function(t){return t&&t.length?hi(t):[]},Vn.uniqBy=function(t,e){return t&&t.length?hi(t,cs(e,2)):[]},Vn.uniqWith=function(e,n){return n="function"==typeof n?n:t,e&&e.length?hi(e,t,n):[]},Vn.unset=function(t,e){return null==t||ui(t,e)},Vn.unzip=ao,Vn.unzipWith=lo,Vn.update=function(t,e,n){return null==t?t:di(t,e,yi(n))},Vn.updateWith=function(e,n,r,i){return i="function"==typeof i?i:t,null==e?e:di(e,n,yi(r),i)},Vn.values=Wa,Vn.valuesIn=function(t){return null==t?[]:Ke(t,Fa(t))},Vn.without=co,Vn.words=el,Vn.wrap=function(t,e){return jo(yi(e),t)},Vn.xor=ho,Vn.xorBy=uo,Vn.xorWith=fo,Vn.zip=po,Vn.zipObject=function(t,e){return gi(t||[],e||[],er)},Vn.zipObjectDeep=function(t,e){return gi(t||[],e||[],Qr)},Vn.zipWith=mo,Vn.entries=za,Vn.entriesIn=Ga,Vn.extend=Sa,Vn.extendWith=Ta,ul(Vn,Vn),Vn.add=El,Vn.attempt=nl,Vn.camelCase=Ha,Vn.capitalize=$a,Vn.ceil=_l,Vn.clamp=function(e,n,r){return r===t&&(r=n,n=t),r!==t&&(r=(r=xa(r))==r?r:0),n!==t&&(n=(n=xa(n))==n?n:0),ar(xa(e),n,r)},Vn.clone=function(t){return lr(t,4)},Vn.cloneDeep=function(t){return lr(t,5)},Vn.cloneDeepWith=function(e,n){return lr(e,5,n="function"==typeof n?n:t)},Vn.cloneWith=function(e,n){return lr(e,4,n="function"==typeof n?n:t)},Vn.conformsTo=function(t,e){return null==e||cr(t,e,La(e))},Vn.deburr=Ya,Vn.defaultTo=function(t,e){return null==t||t!=t?e:t},Vn.divide=Sl,Vn.endsWith=function(e,n,r){e=Ea(e),n=ci(n);var i=e.length,s=r=r===t?i:ar(ya(r),0,i);return(r-=n.length)>=0&&e.slice(r,s)==n},Vn.eq=Wo,Vn.escape=function(t){return(t=Ea(t))&&Y.test(t)?t.replace(H,en):t},Vn.escapeRegExp=function(t){return(t=Ea(t))&&et.test(t)?t.replace(tt,"\\$&"):t},Vn.every=function(e,n,r){var i=Xo(e)?Ae:pr;return r&&xs(e,n,r)&&(n=t),i(e,cs(n,3))},Vn.find=xo,Vn.findIndex=$s,Vn.findKey=function(t,e){return Ne(t,cs(e,3),xr)},Vn.findLast=wo,Vn.findLastIndex=Ys,Vn.findLastKey=function(t,e){return Ne(t,cs(e,3),wr)},Vn.floor=Tl,Vn.forEach=Eo,Vn.forEachRight=_o,Vn.forIn=function(t,e){return null==t?t:yr(t,cs(e,3),Fa)},Vn.forInRight=function(t,e){return null==t?t:br(t,cs(e,3),Fa)},Vn.forOwn=function(t,e){return t&&xr(t,cs(e,3))},Vn.forOwnRight=function(t,e){return t&&wr(t,cs(e,3))},Vn.get=Ma,Vn.gt=Ho,Vn.gte=$o,Vn.has=function(t,e){return null!=t&&gs(t,e,Ar)},Vn.hasIn=Ia,Vn.head=qs,Vn.identity=al,Vn.includes=function(t,e,n,r){t=Ko(t)?t:Wa(t),n=n&&!r?ya(n):0;var i=t.length;return n<0&&(n=yn(i+n,0)),ua(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Ue(t,e,n)>-1},Vn.indexOf=function(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:ya(n);return i<0&&(i=yn(r+i,0)),Ue(t,e,i)},Vn.inRange=function(e,n,r){return n=va(n),r===t?(r=n,n=0):r=va(r),function(t,e,n){return t>=bn(e,n)&&t<yn(e,n)}(e=xa(e),n,r)},Vn.invoke=Pa,Vn.isArguments=Yo,Vn.isArray=Xo,Vn.isArrayBuffer=qo,Vn.isArrayLike=Ko,Vn.isArrayLikeObject=Zo,Vn.isBoolean=function(t){return!0===t||!1===t||sa(t)&&Tr(t)==g},Vn.isBuffer=Jo,Vn.isDate=Qo,Vn.isElement=function(t){return sa(t)&&1===t.nodeType&&!la(t)},Vn.isEmpty=function(t){if(null==t)return!0;if(Ko(t)&&(Xo(t)||"string"==typeof t||"function"==typeof t.splice||Jo(t)||fa(t)||Yo(t)))return!t.length;var e=ms(t);if(e==w||e==k)return!t.size;if(Ss(t))return!Fr(t).length;for(var n in t)if(Ft.call(t,n))return!1;return!0},Vn.isEqual=function(t,e){return Dr(t,e)},Vn.isEqualWith=function(e,n,r){var i=(r="function"==typeof r?r:t)?r(e,n):t;return i===t?Dr(e,n,t,r):!!i},Vn.isError=ta,Vn.isFinite=function(t){return"number"==typeof t&&mn(t)},Vn.isFunction=ea,Vn.isInteger=na,Vn.isLength=ra,Vn.isMap=oa,Vn.isMatch=function(t,e){return t===e||Or(t,e,us(e))},Vn.isMatchWith=function(e,n,r){return r="function"==typeof r?r:t,Or(e,n,us(n),r)},Vn.isNaN=function(t){return aa(t)&&t!=+t},Vn.isNative=function(t){if(_s(t))throw new St("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Pr(t)},Vn.isNil=function(t){return null==t},Vn.isNull=function(t){return null===t},Vn.isNumber=aa,Vn.isObject=ia,Vn.isObjectLike=sa,Vn.isPlainObject=la,Vn.isRegExp=ca,Vn.isSafeInteger=function(t){return na(t)&&t>=-9007199254740991&&t<=h},Vn.isSet=ha,Vn.isString=ua,Vn.isSymbol=da,Vn.isTypedArray=fa,Vn.isUndefined=function(e){return e===t},Vn.isWeakMap=function(t){return sa(t)&&ms(t)==R},Vn.isWeakSet=function(t){return sa(t)&&"[object WeakSet]"==Tr(t)},Vn.join=function(t,e){return null==t?"":gn.call(t,e)},Vn.kebabCase=Xa,Vn.last=Qs,Vn.lastIndexOf=function(e,n,r){var i=null==e?0:e.length;if(!i)return-1;var s=i;return r!==t&&(s=(s=ya(r))<0?yn(i+s,0):bn(s,i-1)),n==n?function(t,e,n){for(var r=n+1;r--;)if(t[r]===e)return r;return r}(e,n,s):Be(e,je,s,!0)},Vn.lowerCase=qa,Vn.lowerFirst=Ka,Vn.lt=pa,Vn.lte=ma,Vn.max=function(e){return e&&e.length?mr(e,al,kr):t},Vn.maxBy=function(e,n){return e&&e.length?mr(e,cs(n,2),kr):t},Vn.mean=function(t){return ze(t,al)},Vn.meanBy=function(t,e){return ze(t,cs(e,2))},Vn.min=function(e){return e&&e.length?mr(e,al,Br):t},Vn.minBy=function(e,n){return e&&e.length?mr(e,cs(n,2),Br):t},Vn.stubArray=bl,Vn.stubFalse=xl,Vn.stubObject=function(){return{}},Vn.stubString=function(){return""},Vn.stubTrue=function(){return!0},Vn.multiply=kl,Vn.nth=function(e,n){return e&&e.length?Gr(e,ya(n)):t},Vn.noConflict=function(){return ue._===this&&(ue._=jt),this},Vn.noop=dl,Vn.now=Mo,Vn.pad=function(t,e,n){t=Ea(t);var r=(e=ya(e))?cn(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Hi(Fe(i),n)+t+Hi(ge(i),n)},Vn.padEnd=function(t,e,n){t=Ea(t);var r=(e=ya(e))?cn(t):0;return e&&r<e?t+Hi(e-r,n):t},Vn.padStart=function(t,e,n){t=Ea(t);var r=(e=ya(e))?cn(t):0;return e&&r<e?Hi(e-r,n)+t:t},Vn.parseInt=function(t,e,n){return n||null==e?e=0:e&&(e=+e),wn(Ea(t).replace(nt,""),e||0)},Vn.random=function(e,n,r){if(r&&"boolean"!=typeof r&&xs(e,n,r)&&(n=r=t),r===t&&("boolean"==typeof n?(r=n,n=t):"boolean"==typeof e&&(r=e,e=t)),e===t&&n===t?(e=0,n=1):(e=va(e),n===t?(n=e,e=0):n=va(n)),e>n){var i=e;e=n,n=i}if(r||e%1||n%1){var s=En();return bn(e+s*(n-e+ae("1e-"+((s+"").length-1))),n)}return Xr(e,n)},Vn.reduce=function(t,e,n){var r=Xo(t)?Oe:He,i=arguments.length<3;return r(t,cs(e,4),n,i,dr)},Vn.reduceRight=function(t,e,n){var r=Xo(t)?Pe:He,i=arguments.length<3;return r(t,cs(e,4),n,i,fr)},Vn.repeat=function(e,n,r){return n=(r?xs(e,n,r):n===t)?1:ya(n),qr(Ea(e),n)},Vn.replace=function(){var t=arguments,e=Ea(t[0]);return t.length<3?e:e.replace(t[1],t[2])},Vn.result=function(e,n,r){var i=-1,s=(n=bi(n,e)).length;for(s||(s=1,e=t);++i<s;){var o=null==e?t:e[Vs(n[i])];o===t&&(i=s,o=r),e=ea(o)?o.call(e):o}return e},Vn.round=Al,Vn.runInContext=rt,Vn.sample=function(t){return(Xo(t)?Zn:Zr)(t)},Vn.size=function(t){if(null==t)return 0;if(Ko(t))return ua(t)?cn(t):t.length;var e=ms(t);return e==w||e==k?t.size:Fr(t).length},Vn.snakeCase=Za,Vn.some=function(e,n,r){var i=Xo(e)?Le:ii;return r&&xs(e,n,r)&&(n=t),i(e,cs(n,3))},Vn.sortedIndex=function(t,e){return si(t,e)},Vn.sortedIndexBy=function(t,e,n){return oi(t,e,cs(n,2))},Vn.sortedIndexOf=function(t,e){var n=null==t?0:t.length;if(n){var r=si(t,e);if(r<n&&Wo(t[r],e))return r}return-1},Vn.sortedLastIndex=function(t,e){return si(t,e,!0)},Vn.sortedLastIndexBy=function(t,e,n){return oi(t,e,cs(n,2),!0)},Vn.sortedLastIndexOf=function(t,e){if(null!=t&&t.length){var n=si(t,e,!0)-1;if(Wo(t[n],e))return n}return-1},Vn.startCase=Ja,Vn.startsWith=function(t,e,n){return t=Ea(t),n=null==n?0:ar(ya(n),0,t.length),e=ci(e),t.slice(n,n+e.length)==e},Vn.subtract=Cl,Vn.sum=function(t){return t&&t.length?$e(t,al):0},Vn.sumBy=function(t,e){return t&&t.length?$e(t,cs(e,2)):0},Vn.template=function(e,n,r){var i=Vn.templateSettings;r&&xs(e,n,r)&&(n=t),e=Ea(e),n=Ta({},n,i,Qi);var s,o,a=Ta({},n.imports,i.imports,Qi),l=La(a),c=Ke(a,l),h=0,u=n.interpolate||yt,d="__p += '",f=Ct((n.escape||yt).source+"|"+u.source+"|"+(u===K?ht:yt).source+"|"+(n.evaluate||yt).source+"|$","g"),p="//# sourceURL="+(Ft.call(n,"sourceURL")?(n.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++re+"]")+"\n";e.replace(f,(function(t,n,r,i,a,l){return r||(r=i),d+=e.slice(h,l).replace(bt,nn),n&&(s=!0,d+="' +\n__e("+n+") +\n'"),a&&(o=!0,d+="';\n"+a+";\n__p += '"),r&&(d+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),h=l+t.length,t})),d+="';\n";var m=Ft.call(n,"variable")&&n.variable;if(m){if(lt.test(m))throw new St("Invalid `variable` option passed into `_.template`")}else d="with (obj) {\n"+d+"\n}\n";d=(o?d.replace(j,""):d).replace(z,"$1").replace(G,"$1;"),d="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(s?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var g=nl((function(){return Tt(l,p+"return "+d).apply(t,c)}));if(g.source=d,ta(g))throw g;return g},Vn.times=function(t,e){if((t=ya(t))<1||t>h)return[];var n=d,r=bn(t,d);e=cs(e),t-=d;for(var i=Ye(r,e);++n<t;)e(n);return i},Vn.toFinite=va,Vn.toInteger=ya,Vn.toLength=ba,Vn.toLower=function(t){return Ea(t).toLowerCase()},Vn.toNumber=xa,Vn.toSafeInteger=function(t){return t?ar(ya(t),-9007199254740991,h):0===t?t:0},Vn.toString=Ea,Vn.toUpper=function(t){return Ea(t).toUpperCase()},Vn.trim=function(e,n,r){if((e=Ea(e))&&(r||n===t))return Xe(e);if(!e||!(n=ci(n)))return e;var i=hn(e),s=hn(n);return wi(i,Je(i,s),Qe(i,s)+1).join("")},Vn.trimEnd=function(e,n,r){if((e=Ea(e))&&(r||n===t))return e.slice(0,un(e)+1);if(!e||!(n=ci(n)))return e;var i=hn(e);return wi(i,0,Qe(i,hn(n))+1).join("")},Vn.trimStart=function(e,n,r){if((e=Ea(e))&&(r||n===t))return e.replace(nt,"");if(!e||!(n=ci(n)))return e;var i=hn(e);return wi(i,Je(i,hn(n))).join("")},Vn.truncate=function(e,n){var r=30,i="...";if(ia(n)){var s="separator"in n?n.separator:s;r="length"in n?ya(n.length):r,i="omission"in n?ci(n.omission):i}var o=(e=Ea(e)).length;if(rn(e)){var a=hn(e);o=a.length}if(r>=o)return e;var l=r-cn(i);if(l<1)return i;var c=a?wi(a,0,l).join(""):e.slice(0,l);if(s===t)return c+i;if(a&&(l+=c.length-l),ca(s)){if(e.slice(l).search(s)){var h,u=c;for(s.global||(s=Ct(s.source,Ea(ut.exec(s))+"g")),s.lastIndex=0;h=s.exec(u);)var d=h.index;c=c.slice(0,d===t?l:d)}}else if(e.indexOf(ci(s),l)!=l){var f=c.lastIndexOf(s);f>-1&&(c=c.slice(0,f))}return c+i},Vn.unescape=function(t){return(t=Ea(t))&&$.test(t)?t.replace(W,dn):t},Vn.uniqueId=function(t){var e=++Nt;return Ea(t)+e},Vn.upperCase=Qa,Vn.upperFirst=tl,Vn.each=Eo,Vn.eachRight=_o,Vn.first=qs,ul(Vn,(wl={},xr(Vn,(function(t,e){Ft.call(Vn.prototype,e)||(wl[e]=t)})),wl),{chain:!1}),Vn.VERSION="4.17.21",Te(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Vn[t].placeholder=Vn})),Te(["drop","take"],(function(e,n){Wn.prototype[e]=function(r){r=r===t?1:yn(ya(r),0);var i=this.__filtered__&&!n?new Wn(this):this.clone();return i.__filtered__?i.__takeCount__=bn(r,i.__takeCount__):i.__views__.push({size:bn(r,d),type:e+(i.__dir__<0?"Right":"")}),i},Wn.prototype[e+"Right"]=function(t){return this.reverse()[e](t).reverse()}})),Te(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=1==n||3==n;Wn.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:cs(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),Te(["head","last"],(function(t,e){var n="take"+(e?"Right":"");Wn.prototype[t]=function(){return this[n](1).value()[0]}})),Te(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");Wn.prototype[t]=function(){return this.__filtered__?new Wn(this):this[n](1)}})),Wn.prototype.compact=function(){return this.filter(al)},Wn.prototype.find=function(t){return this.filter(t).head()},Wn.prototype.findLast=function(t){return this.reverse().find(t)},Wn.prototype.invokeMap=Kr((function(t,e){return"function"==typeof t?new Wn(this):this.map((function(n){return Mr(n,t,e)}))})),Wn.prototype.reject=function(t){return this.filter(Uo(cs(t)))},Wn.prototype.slice=function(e,n){e=ya(e);var r=this;return r.__filtered__&&(e>0||n<0)?new Wn(r):(e<0?r=r.takeRight(-e):e&&(r=r.drop(e)),n!==t&&(r=(n=ya(n))<0?r.dropRight(-n):r.take(n-e)),r)},Wn.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},Wn.prototype.toArray=function(){return this.take(d)},xr(Wn.prototype,(function(e,n){var r=/^(?:filter|find|map|reject)|While$/.test(n),i=/^(?:head|last)$/.test(n),s=Vn[i?"take"+("last"==n?"Right":""):n],o=i||/^find/.test(n);s&&(Vn.prototype[n]=function(){var n=this.__wrapped__,a=i?[1]:arguments,l=n instanceof Wn,c=a[0],h=l||Xo(n),u=function(t){var e=s.apply(Vn,De([t],a));return i&&d?e[0]:e};h&&r&&"function"==typeof c&&1!=c.length&&(l=h=!1);var d=this.__chain__,f=!!this.__actions__.length,p=o&&!d,m=l&&!f;if(!o&&h){n=m?n:new Wn(this);var g=e.apply(n,a);return g.__actions__.push({func:vo,args:[u],thisArg:t}),new Gn(g,d)}return p&&m?e.apply(this,a):(g=this.thru(u),p?i?g.value()[0]:g.value():g)})})),Te(["pop","push","shift","sort","splice","unshift"],(function(t){var e=It[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Vn.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(Xo(i)?i:[],t)}return this[n]((function(n){return e.apply(Xo(n)?n:[],t)}))}})),xr(Wn.prototype,(function(t,e){var n=Vn[e];if(n){var r=n.name+"";Ft.call(In,r)||(In[r]=[]),In[r].push({name:e,func:n})}})),In[ji(t,2).name]=[{name:"wrapper",func:t}],Wn.prototype.clone=function(){var t=new Wn(this.__wrapped__);return t.__actions__=Ri(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=Ri(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=Ri(this.__views__),t},Wn.prototype.reverse=function(){if(this.__filtered__){var t=new Wn(this);t.__dir__=-1,t.__filtered__=!0}else(t=this.clone()).__dir__*=-1;return t},Wn.prototype.value=function(){var t=this.__wrapped__.value(),e=this.__dir__,n=Xo(t),r=e<0,i=n?t.length:0,s=function(t,e,n){for(var r=-1,i=n.length;++r<i;){var s=n[r],o=s.size;switch(s.type){case"drop":t+=o;break;case"dropRight":e-=o;break;case"take":e=bn(e,t+o);break;case"takeRight":t=yn(t,e-o)}}return{start:t,end:e}}(0,i,this.__views__),o=s.start,a=s.end,l=a-o,c=r?a:o-1,h=this.__iteratees__,u=h.length,d=0,f=bn(l,this.__takeCount__);if(!n||!r&&i==l&&f==l)return pi(t,this.__actions__);var p=[];t:for(;l--&&d<f;){for(var m=-1,g=t[c+=e];++m<u;){var v=h[m],y=v.iteratee,b=v.type,x=y(g);if(2==b)g=x;else if(!x){if(1==b)continue t;break t}}p[d++]=g}return p},Vn.prototype.at=yo,Vn.prototype.chain=function(){return go(this)},Vn.prototype.commit=function(){return new Gn(this.value(),this.__chain__)},Vn.prototype.next=function(){this.__values__===t&&(this.__values__=ga(this.value()));var e=this.__index__>=this.__values__.length;return{done:e,value:e?t:this.__values__[this.__index__++]}},Vn.prototype.plant=function(e){for(var n,r=this;r instanceof zn;){var i=zs(r);i.__index__=0,i.__values__=t,n?s.__wrapped__=i:n=i;var s=i;r=r.__wrapped__}return s.__wrapped__=e,n},Vn.prototype.reverse=function(){var e=this.__wrapped__;if(e instanceof Wn){var n=e;return this.__actions__.length&&(n=new Wn(this)),(n=n.reverse()).__actions__.push({func:vo,args:[ro],thisArg:t}),new Gn(n,this.__chain__)}return this.thru(ro)},Vn.prototype.toJSON=Vn.prototype.valueOf=Vn.prototype.value=function(){return pi(this.__wrapped__,this.__actions__)},Vn.prototype.first=Vn.prototype.head,oe&&(Vn.prototype[oe]=function(){return this}),Vn}();fe?((fe.exports=fn)._=fn,de._=fn):ue._=fn}.call(ei);const Qa=ni(Ja.exports);
/*!
 * pinia v2.1.7
 * (c) 2023 Eduardo San Martin Morote
 * @license MIT
 */let tl;const el=t=>tl=t,nl=Symbol();function rl(t){return t&&"object"==typeof t&&"[object Object]"===Object.prototype.toString.call(t)&&"function"!=typeof t.toJSON}var il,sl;function ol(){const t=d(!0),e=t.run((()=>o({})));let n=[],r=[];const i=f({install(t){el(i),i._a=t,t.provide(nl,i),t.config.globalProperties.$pinia=i,r.forEach((t=>n.push(t))),r=[]},use(t){return this._a?n.push(t):r.push(t),this},_p:n,_a:null,_e:t,_s:new Map,state:e});return i}(sl=il||(il={})).direct="direct",sl.patchObject="patch object",sl.patchFunction="patch function";const al=()=>{};function ll(n,r,i,s=al){n.push(r);const o=()=>{const t=n.indexOf(r);t>-1&&(n.splice(t,1),s())};return!i&&t()&&e(o),o}function cl(t,...e){t.slice().forEach((t=>{t(...e)}))}const hl=t=>t();function ul(t,e){t instanceof Map&&e instanceof Map&&e.forEach(((e,n)=>t.set(n,e))),t instanceof Set&&e instanceof Set&&e.forEach(t.add,t);for(const n in e){if(!e.hasOwnProperty(n))continue;const r=e[n],i=t[n];rl(i)&&rl(r)&&t.hasOwnProperty(n)&&!m(r)&&!g(r)?t[n]=ul(i,r):t[n]=r}return t}const dl=Symbol();const{assign:fl}=Object;function pl(t,e,n={},r,i,s){let l;const c=fl({actions:{}},n),u={deep:!0};let f,v,y,b=[],w=[];const E=r.state.value[t];let _;function S(e){let n;f=v=!1,"function"==typeof e?(e(r.state.value[t]),n={type:il.patchFunction,storeId:t,events:y}):(ul(r.state.value[t],e),n={type:il.patchObject,payload:e,storeId:t,events:y});const i=_=Symbol();h().then((()=>{_===i&&(f=!0)})),v=!0,cl(b,n,r.state.value[t])}s||E||(r.state.value[t]={}),o({});const T=s?function(){const{state:t}=n,e=t?t():{};this.$patch((t=>{fl(t,e)}))}:al;function k(e,n){return function(){el(r);const i=Array.from(arguments),s=[],o=[];let a;cl(w,{args:i,name:e,store:C,after:function(t){s.push(t)},onError:function(t){o.push(t)}});try{a=n.apply(this&&this.$id===t?this:C,i)}catch(l){throw cl(o,l),l}return a instanceof Promise?a.then((t=>(cl(s,t),t))).catch((t=>(cl(o,t),Promise.reject(t)))):(cl(s,a),a)}}const A={_p:r,$id:t,$onAction:ll.bind(null,w),$patch:S,$reset:T,$subscribe(e,n={}){const i=ll(b,e,n.detached,(()=>s())),s=l.run((()=>a((()=>r.state.value[t]),(r=>{("sync"===n.flush?v:f)&&e({storeId:t,type:il.direct,events:y},r)}),fl({},u,n))));return i},$dispose:function(){l.stop(),b=[],w=[],r._s.delete(t)}},C=x(A);r._s.set(t,C);const R=(r._a&&r._a.runWithContext||hl)((()=>r._e.run((()=>(l=d()).run(e)))));for(const o in R){const e=R[o];if(m(e)&&(!m(I=e)||!I.effect)||g(e))s||(!E||rl(M=e)&&M.hasOwnProperty(dl)||(m(e)?e.value=E[o]:ul(e,E[o])),r.state.value[t][o]=e);else if("function"==typeof e){const t=k(o,e);R[o]=t,c.actions[o]=e}}var M,I;return fl(C,R),fl(p(C),R),Object.defineProperty(C,"$state",{get:()=>r.state.value[t],set:t=>{S((e=>{fl(e,t)}))}}),r._p.forEach((t=>{fl(C,l.run((()=>t({store:C,app:r._a,pinia:r,options:c}))))})),E&&s&&n.hydrate&&n.hydrate(C.$state,E),f=!0,v=!0,C}function ml(t,e,n){let r,i;const s="function"==typeof e;function o(t,n){const o=y();(t=t||(o?b(nl,null):null))&&el(t),(t=tl)._s.has(r)||(s?pl(r,e,i,t):function(t,e,n,r){const{state:i,actions:s,getters:o}=e,a=n.state.value[t];let l;l=pl(t,(function(){a||(n.state.value[t]=i?i():{});const e=w(n.state.value[t]);return fl(e,s,Object.keys(o||{}).reduce(((e,r)=>(e[r]=f(u((()=>{el(n);const e=n._s.get(t);return o[r].call(e,e)}))),e)),{}))}),e,n,0,!0)}(r,i,t));return t._s.get(r)}return"string"==typeof t?(r=t,i=s?n:e):(i=t,r=t.id),o.$id=r,o}function gl(t){{t=p(t);const e={};for(const n in t){const r=t[n];(m(r)||g(r))&&(e[n]=v(t,n))}return e}}let vl=(t=21)=>crypto.getRandomValues(new Uint8Array(t)).reduce(((t,e)=>t+=(e&=63)<36?e.toString(36):e<62?(e-26).toString(36).toUpperCase():e>62?"-":"_"),"");function yl(t){this.message=t}yl.prototype=new Error,yl.prototype.name="InvalidCharacterError";var bl="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(t){var e=String(t).replace(/=+$/,"");if(e.length%4==1)throw new yl("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i=0,s=0,o="";r=e.charAt(s++);~r&&(n=i%4?64*n+r:r,i++%4)?o+=String.fromCharCode(255&n>>(-2*i&6)):0)r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(r);return o};function xl(t){this.message=t}function wl(t,e){if("string"!=typeof t)throw new xl("Invalid token specified");var n=!0===(e=e||{}).header?0:1;try{return JSON.parse(function(t){var e=t.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw"Illegal base64url string!"}try{return decodeURIComponent(bl(e).replace(/(.)/g,(function(t,e){var n=e.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}catch(n){return bl(e)}}(t.split(".")[n]))}catch(r){throw new xl("Invalid token specified: "+r.message)}}xl.prototype=new Error,xl.prototype.name="InvalidTokenError";var El={exports:{}};!function(t,e){!function(n,r){var i="function",s="undefined",o="object",a="string",l="major",c="model",h="name",u="type",d="vendor",f="version",p="architecture",m="console",g="mobile",v="tablet",y="smarttv",b="wearable",x="embedded",w="Amazon",E="Apple",_="ASUS",S="BlackBerry",T="Browser",k="Chrome",A="Firefox",C="Google",R="Huawei",M="LG",I="Microsoft",D="Motorola",O="Opera",P="Samsung",L="Sharp",F="Sony",N="Xiaomi",B="Zebra",U="Facebook",V="Chromium OS",j="Mac OS",z=function(t){for(var e={},n=0;n<t.length;n++)e[t[n].toUpperCase()]=t[n];return e},G=function(t,e){return typeof t===a&&-1!==W(e).indexOf(W(t))},W=function(t){return t.toLowerCase()},H=function(t,e){if(typeof t===a)return t=t.replace(/^\s\s*/,""),typeof e===s?t:t.substring(0,500)},$=function(t,e){for(var n,s,a,l,c,h,u=0;u<e.length&&!c;){var d=e[u],f=e[u+1];for(n=s=0;n<d.length&&!c&&d[n];)if(c=d[n++].exec(t))for(a=0;a<f.length;a++)h=c[++s],typeof(l=f[a])===o&&l.length>0?2===l.length?typeof l[1]==i?this[l[0]]=l[1].call(this,h):this[l[0]]=l[1]:3===l.length?typeof l[1]!==i||l[1].exec&&l[1].test?this[l[0]]=h?h.replace(l[1],l[2]):r:this[l[0]]=h?l[1].call(this,h,l[2]):r:4===l.length&&(this[l[0]]=h?l[3].call(this,h.replace(l[1],l[2])):r):this[l]=h||r;u+=2}},Y=function(t,e){for(var n in e)if(typeof e[n]===o&&e[n].length>0){for(var i=0;i<e[n].length;i++)if(G(e[n][i],t))return"?"===n?r:n}else if(G(e[n],t))return"?"===n?r:n;return t},X={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},q={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[f,[h,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[f,[h,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[h,f],[/opios[\/ ]+([\w\.]+)/i],[f,[h,O+" Mini"]],[/\bopr\/([\w\.]+)/i],[f,[h,O]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[f,[h,"Baidu"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim)\s?(?:browser)?[\/ ]?([\w\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[h,f],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[f,[h,"UC"+T]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[f,[h,"WeChat"]],[/konqueror\/([\w\.]+)/i],[f,[h,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[f,[h,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[f,[h,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[f,[h,"Smart Lenovo "+T]],[/(avast|avg)\/([\w\.]+)/i],[[h,/(.+)/,"$1 Secure "+T],f],[/\bfocus\/([\w\.]+)/i],[f,[h,A+" Focus"]],[/\bopt\/([\w\.]+)/i],[f,[h,O+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[f,[h,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[f,[h,"Dolphin"]],[/coast\/([\w\.]+)/i],[f,[h,O+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[f,[h,"MIUI "+T]],[/fxios\/([-\w\.]+)/i],[f,[h,A]],[/\bqihu|(qi?ho?o?|360)browser/i],[[h,"360 "+T]],[/(oculus|sailfish|huawei|vivo)browser\/([\w\.]+)/i],[[h,/(.+)/,"$1 "+T],f],[/samsungbrowser\/([\w\.]+)/i],[f,[h,P+" Internet"]],[/(comodo_dragon)\/([\w\.]+)/i],[[h,/_/g," "],f],[/metasr[\/ ]?([\d\.]+)/i],[f,[h,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[h,"Sogou Mobile"],f],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345Explorer)[\/ ]?([\w\.]+)/i],[h,f],[/(lbbrowser)/i,/\[(linkedin)app\]/i],[h],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[h,U],f],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[h,f],[/\bgsa\/([\w\.]+) .*safari\//i],[f,[h,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[f,[h,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[f,[h,k+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[h,k+" WebView"],f],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[f,[h,"Android "+T]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[h,f],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[f,[h,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[f,h],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[h,[f,Y,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[h,f],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[h,"Netscape"],f],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[f,[h,A+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[h,f],[/(cobalt)\/([\w\.]+)/i],[h,[f,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[p,"amd64"]],[/(ia32(?=;))/i],[[p,W]],[/((?:i[346]|x)86)[;\)]/i],[[p,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[p,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[p,"armhf"]],[/windows (ce|mobile); ppc;/i],[[p,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[p,/ower/,"",W]],[/(sun4\w)[;\)]/i],[[p,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[p,W]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[c,[d,P],[u,v]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[c,[d,P],[u,g]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[c,[d,E],[u,g]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[c,[d,E],[u,v]],[/(macintosh);/i],[c,[d,E]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[c,[d,L],[u,g]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[c,[d,R],[u,v]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[c,[d,R],[u,g]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[c,/_/g," "],[d,N],[u,g]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[c,/_/g," "],[d,N],[u,v]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[c,[d,"OPPO"],[u,g]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[c,[d,"Vivo"],[u,g]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[c,[d,"Realme"],[u,g]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[c,[d,D],[u,g]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[c,[d,D],[u,v]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[c,[d,M],[u,v]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[c,[d,M],[u,g]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[c,[d,"Lenovo"],[u,v]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[c,/_/g," "],[d,"Nokia"],[u,g]],[/(pixel c)\b/i],[c,[d,C],[u,v]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[c,[d,C],[u,g]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[c,[d,F],[u,g]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[c,"Xperia Tablet"],[d,F],[u,v]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[c,[d,"OnePlus"],[u,g]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[c,[d,w],[u,v]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[c,/(.+)/g,"Fire Phone $1"],[d,w],[u,g]],[/(playbook);[-\w\),; ]+(rim)/i],[c,d,[u,v]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[c,[d,S],[u,g]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[c,[d,_],[u,v]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[c,[d,_],[u,g]],[/(nexus 9)/i],[c,[d,"HTC"],[u,v]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[d,[c,/_/g," "],[u,g]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[c,[d,"Acer"],[u,v]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[c,[d,"Meizu"],[u,g]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[c,[d,"Ulefone"],[u,g]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[d,c,[u,g]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[d,c,[u,v]],[/(surface duo)/i],[c,[d,I],[u,v]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[c,[d,"Fairphone"],[u,g]],[/(u304aa)/i],[c,[d,"AT&T"],[u,g]],[/\bsie-(\w*)/i],[c,[d,"Siemens"],[u,g]],[/\b(rct\w+) b/i],[c,[d,"RCA"],[u,v]],[/\b(venue[\d ]{2,7}) b/i],[c,[d,"Dell"],[u,v]],[/\b(q(?:mv|ta)\w+) b/i],[c,[d,"Verizon"],[u,v]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[c,[d,"Barnes & Noble"],[u,v]],[/\b(tm\d{3}\w+) b/i],[c,[d,"NuVision"],[u,v]],[/\b(k88) b/i],[c,[d,"ZTE"],[u,v]],[/\b(nx\d{3}j) b/i],[c,[d,"ZTE"],[u,g]],[/\b(gen\d{3}) b.+49h/i],[c,[d,"Swiss"],[u,g]],[/\b(zur\d{3}) b/i],[c,[d,"Swiss"],[u,v]],[/\b((zeki)?tb.*\b) b/i],[c,[d,"Zeki"],[u,v]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[d,"Dragon Touch"],c,[u,v]],[/\b(ns-?\w{0,9}) b/i],[c,[d,"Insignia"],[u,v]],[/\b((nxa|next)-?\w{0,9}) b/i],[c,[d,"NextBook"],[u,v]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[d,"Voice"],c,[u,g]],[/\b(lvtel\-)?(v1[12]) b/i],[[d,"LvTel"],c,[u,g]],[/\b(ph-1) /i],[c,[d,"Essential"],[u,g]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[c,[d,"Envizen"],[u,v]],[/\b(trio[-\w\. ]+) b/i],[c,[d,"MachSpeed"],[u,v]],[/\btu_(1491) b/i],[c,[d,"Rotor"],[u,v]],[/(shield[\w ]+) b/i],[c,[d,"Nvidia"],[u,v]],[/(sprint) (\w+)/i],[d,c,[u,g]],[/(kin\.[onetw]{3})/i],[[c,/\./g," "],[d,I],[u,g]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[c,[d,B],[u,v]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[c,[d,B],[u,g]],[/smart-tv.+(samsung)/i],[d,[u,y]],[/hbbtv.+maple;(\d+)/i],[[c,/^/,"SmartTV"],[d,P],[u,y]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[d,M],[u,y]],[/(apple) ?tv/i],[d,[c,E+" TV"],[u,y]],[/crkey/i],[[c,k+"cast"],[d,C],[u,y]],[/droid.+aft(\w+)( bui|\))/i],[c,[d,w],[u,y]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[c,[d,L],[u,y]],[/(bravia[\w ]+)( bui|\))/i],[c,[d,F],[u,y]],[/(mitv-\w{5}) bui/i],[c,[d,N],[u,y]],[/Hbbtv.*(technisat) (.*);/i],[d,c,[u,y]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[d,H],[c,H],[u,y]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[u,y]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[d,c,[u,m]],[/droid.+; (shield) bui/i],[c,[d,"Nvidia"],[u,m]],[/(playstation [345portablevi]+)/i],[c,[d,F],[u,m]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[c,[d,I],[u,m]],[/((pebble))app/i],[d,c,[u,b]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[c,[d,E],[u,b]],[/droid.+; (glass) \d/i],[c,[d,C],[u,b]],[/droid.+; (wt63?0{2,3})\)/i],[c,[d,B],[u,b]],[/(quest( 2| pro)?)/i],[c,[d,U],[u,b]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[d,[u,x]],[/(aeobc)\b/i],[c,[d,w],[u,x]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[c,[u,g]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[c,[u,v]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[u,v]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[u,g]],[/(android[-\w\. ]{0,9});.+buil/i],[c,[d,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[f,[h,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[f,[h,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[h,f],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[f,h]],os:[[/microsoft (windows) (vista|xp)/i],[h,f],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[h,[f,Y,X]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,Y,X],[h,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[f,/_/g,"."],[h,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[h,j],[f,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[f,h],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[h,f],[/\(bb(10);/i],[f,[h,S]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[f,[h,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[f,[h,A+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[f,[h,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[f,[h,"watchOS"]],[/crkey\/([\d\.]+)/i],[f,[h,k+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[h,V],f],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[h,f],[/(sunos) ?([\w\.\d]*)/i],[[h,"Solaris"],f],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[h,f]]},K=function(t,e){if(typeof t===o&&(e=t,t=r),!(this instanceof K))return new K(t,e).getResult();var m=typeof n!==s&&n.navigator?n.navigator:r,y=t||(m&&m.userAgent?m.userAgent:""),b=m&&m.userAgentData?m.userAgentData:r,x=e?function(t,e){var n={};for(var r in t)e[r]&&e[r].length%2==0?n[r]=e[r].concat(t[r]):n[r]=t[r];return n}(q,e):q,w=m&&m.userAgent==y;return this.getBrowser=function(){var t,e={};return e[h]=r,e[f]=r,$.call(e,y,x.browser),e[l]=typeof(t=e[f])===a?t.replace(/[^\d\.]/g,"").split(".")[0]:r,w&&m&&m.brave&&typeof m.brave.isBrave==i&&(e[h]="Brave"),e},this.getCPU=function(){var t={};return t[p]=r,$.call(t,y,x.cpu),t},this.getDevice=function(){var t={};return t[d]=r,t[c]=r,t[u]=r,$.call(t,y,x.device),w&&!t[u]&&b&&b.mobile&&(t[u]=g),w&&"Macintosh"==t[c]&&m&&typeof m.standalone!==s&&m.maxTouchPoints&&m.maxTouchPoints>2&&(t[c]="iPad",t[u]=v),t},this.getEngine=function(){var t={};return t[h]=r,t[f]=r,$.call(t,y,x.engine),t},this.getOS=function(){var t={};return t[h]=r,t[f]=r,$.call(t,y,x.os),w&&!t[h]&&b&&"Unknown"!=b.platform&&(t[h]=b.platform.replace(/chrome os/i,V).replace(/macos/i,j)),t},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return y},this.setUA=function(t){return y=typeof t===a&&t.length>500?H(t,500):t,this},this.setUA(y),this};K.VERSION="1.0.37",K.BROWSER=z([h,f,l]),K.CPU=z([p]),K.DEVICE=z([c,d,u,m,g,y,v,b,x]),K.ENGINE=K.OS=z([h,f]),t.exports&&(e=t.exports=K),e.UAParser=K;var Z=typeof n!==s&&(n.jQuery||n.Zepto);if(Z&&!Z.ua){var J=new K;Z.ua=J.getResult(),Z.ua.get=function(){return J.getUA()},Z.ua.set=function(t){J.setUA(t);var e=J.getResult();for(var n in e)Z.ua[n]=e[n]}}}("object"==typeof window?window:ei)}(El,El.exports);const _l=ni(El.exports);var Sl={base64ToBit:function(t){const e=[];for(let n=0;n<t.length;n++){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/".indexOf(t[n]);e.push(r.toString(2).padStart(6,"0"))}return e.join("")},checkDate:function(t,e,n){if(t<1901||t>2100)throw new Error("Invalid Year");if(e<1||e>12)throw new Error("Invalid Month");if(n<1||n>31)throw new Error("Invalid Date");if(-1!=[4,6,9,11].indexOf(e)&&n>30)throw new Error("Invalid Date");if(2==e){if(n>29)throw new Error("Invalid Date");{let e=!1;if((t%400==0||t%4==0&&t%100!=0)&&(e=!0),!e&&n>28)throw new Error("Invalid Date")}}}};const{base64ToBit:Tl,checkDate:kl}=Sl,Al=["小寒","大寒","立春","雨水","惊蛰","春分","清明","谷雨","立夏","小满","芒种","夏至","小暑","大暑","立秋","处暑","白露","秋分","寒露","霜降","立冬","小雪","大雪","冬至"],Cl=[4,19,3,18,4,19,4,19,4,20,4,20,6,22,6,22,6,22,7,22,6,21,6,21],Rl=[];!function(){const t="ABCDAECDAECDFGHIJKHILKMILABNOABNOAENOAENOAEPQRGSTUGSTLAVTOAWXOAWXOAYXOAYZOabcdebcQUfgThijkOilXOimXOimXOimcOnocdpqcQrsgktujkvumXvumXvumcvumcvwocxyqcz0sj10s213u243um43um53wm56wq567q589s+/0s~/3u~!3u@#3um",e="paaqmqqpqaquqqqqqvruruqq6qWaWZqlqaqqqqqqlaaqmqqppaaqqqqqqrququqqqqWaWZaVlaaampqlpaaqqqqplaWampqlqaququqqqqWZWZVVlaWaWZqlqqVZWZVVlaWaWZaVlaaqmpqpqmVZVZVVVaWaWZaVlaWampqpqlVZVZVVqVVZVVVVVaWZWZVVqVVVVVVVVaVZWZVVpaaqmpqpqVFVVVVVVaVZVZVVlaWaWZalpaaampqppVFVRVVVVWVZVZVVlaWaWpqlpVFVRVVUVVVZVVVVVaWZWZaVVFVZVVVVVFVVVVVVpVFVRUVUVFFVVVVVpVFFRUVUVFFVRVVVlVBFRUVUUFFVRVVVlVBFBEVUUFFVRVVUlVBFBEVQUFFFRUVUlVBFBEFQUFBFRUVUlVBEBEFAQFBFBEVUVVBEBEFAVVVVVVVVQFBFBEVQVVBEBEAAVVAEAEAAQFBFBEFQUFBFBUVUQFBEBEFAUFBFBEVUVQAEAAAAAFBEBEFAVQAAAAAAAFBEBEAAVAAAAAAAAFBEAEAA",n=[];for(let r=0;r<544;r+=8){const t=Tl(e.substr(r,8)),i=[];for(let e=0;e<t.length;e+=2)i.push(+`0b${t.substr(e,2)}`);n.push(i)}for(let r=0;r<200;r++)Rl.push(n["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/~!@#".indexOf(t[r])])}();var Ml={getSolarTerm:function(t,e,n){t=Math.floor(+t),e=Math.floor(+e),n=Math.floor(+n),kl(t,e,n);const r=2*(e-1)+(n<15?0:1);return n==Cl[r]+Rl[t-1901][r]?Al[r]:null}};const{base64ToBit:Il,checkDate:Dl}=Sl,{getSolarTerm:Ol}=Ml,Pl=[],Ll="正二三四五六七八九十冬腊",Fl="一二三四五六七八九十";function Nl(t,e,n){const r=`${n?"闰":""}${Ll[t-1]}月`;return e<=10?`${r}初${Fl[e-1]}`:e<20?`${r}十${Fl[e-11]}`:20==e?`${r}廿十`:e>20?`${r}廿${Fl[e-21]}`:`${r}三十`}!function(){const t=Il("hLaCVwUrqpNDSYNlUaqgrUE1pJXQSuak2FJoaSrqlC1QNailtBK26TcElwpLWyWDUoNqJW1ArYJVySXgkuzJYNSg6lVtSC1oFbHJuCS58loZKhqU20oLVQVqSq2BLoSWlkrCpV7SoNlBaqqrUE2gpbNSuClcVKg6VBqpq1QVaglslK4KVwUmPpMGyrrVQVqCW1UroJWhSamk0NJY1ShaoFtTS2glbBJtKS4Ul1ZLBqUG1GraBVsEq6pLwSXBks2pQdSw1lBawKtlk2hJcGSyalQ1KDaUlqoK1PVbAl0JLVyVhUqFpSWqgrVlVqCXQUtspXBSsKk0dKg1UFapJtQS2alcFJwaTL0mDVMFqja1BLbaV0ErQpNbSWGkoapLtUC1oFbSStgk29JcKSwqlW1KDaQVtGq2CTeEl4JLgyWzUoOpQaqSrYFVwSXHkuDJZ9SoalBtKq1UFagptRS6ClsVKwqVC0prVQVqgq0lLoKWwUrOpODSbuUwaqCtVU2oJbBSuik4NFo6TBqkG1TNagVtBK5KToUWhoqWyUNUg");let e={y:1900,m:1,d:31,obj:new Date(1900,0,31,0,0,0,0)},n=6,r=0;for(let i=0;i<t.length&&!(i+16>=t.length);){const s=t.substr(i,4);i+=4;const o=+`0b${s}`,a=o>0?13:12,l=t.substr(i,a).split("").map((t=>+t));i+=a,Pl.push({solarDate:e,leapMonth:o,months:l,heavenlyStem:n,earthlyBranch:r});const c=29*a+l.filter((t=>1==t)).length,h=new Date(e.y,e.m-1,e.d+c,0,0,0,0);e={y:h.getFullYear(),m:h.getMonth()+1,d:h.getDate(),obj:h},n=(n+1)%10,r=(r+1)%12}}();var Bl={getLunar:function(t,e,n){t=Math.floor(+t),e=Math.floor(+e),n=Math.floor(+n),Dl(t,e,n);let r=t-1900,i=Pl[r];var s,o;if(s=i.solarDate,o={y:t,m:e,d:n},(s.y!=o.y?s.y>o.y:s.m!=o.m?s.m>o.m:s.d!=o.d&&s.d>o.d)&&(r-=1,i=Pl[r]),!i)throw new Error("Invalid Date");const a=new Date(t,e-1,n,0,0,0,0);let l=Math.round((a.getTime()-i.solarDate.obj.getTime())/864e5),c=!1;for(let h=0;h<i.months.length;h++){const r=i.leapMonth>0&&h==i.leapMonth;r&&(c=!0);const s=29+i.months[h];if(l<s){let s=c?h:h+1;return{lunarMonth:s,lunarDate:l+1,isLeap:r,solarTerm:Ol(t,e,n),lunarYear:`${"甲乙丙丁戊己庚辛壬癸"[i.heavenlyStem]}${"子丑寅卯辰巳午未申酉戌亥"[i.earthlyBranch]}年`,zodiac:`${"鼠牛虎兔龙蛇马羊猴鸡狗猪"[i.earthlyBranch]}`,dateStr:Nl(s,l+1,r)}}l-=s}throw new Error("There's something wrong!")}},Ul=function(){this.firefox=!1,this.ie=!1,this.edge=!1,this.newEdge=!1,this.weChat=!1},Vl=new function(){this.browser=new Ul,this.node=!1,this.wxa=!1,this.worker=!1,this.svgSupported=!1,this.touchEventsSupported=!1,this.pointerEventsSupported=!1,this.domSupported=!1,this.transformSupported=!1,this.transform3dSupported=!1,this.hasGlobalWindow="undefined"!=typeof window};"object"==typeof wx&&"function"==typeof wx.getSystemInfoSync?(Vl.wxa=!0,Vl.touchEventsSupported=!0):"undefined"==typeof document&&"undefined"!=typeof self?Vl.worker=!0:"undefined"==typeof navigator?(Vl.node=!0,Vl.svgSupported=!0):function(t,e){var n=e.browser,r=t.match(/Firefox\/([\d.]+)/),i=t.match(/MSIE\s([\d.]+)/)||t.match(/Trident\/.+?rv:(([\d.]+))/),s=t.match(/Edge?\/([\d.]+)/),o=/micromessenger/i.test(t);r&&(n.firefox=!0,n.version=r[1]);i&&(n.ie=!0,n.version=i[1]);s&&(n.edge=!0,n.version=s[1],n.newEdge=+s[1].split(".")[0]>18);o&&(n.weChat=!0);e.svgSupported="undefined"!=typeof SVGRect,e.touchEventsSupported="ontouchstart"in window&&!n.ie&&!n.edge,e.pointerEventsSupported="onpointerdown"in window&&(n.edge||n.ie&&+n.version>=11),e.domSupported="undefined"!=typeof document;var a=document.documentElement.style;e.transform3dSupported=(n.ie&&"transition"in a||n.edge||"WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix||"MozPerspective"in a)&&!("OTransition"in a),e.transformSupported=e.transform3dSupported||n.ie&&+n.version>=9}(navigator.userAgent,Vl);const jl=Vl;var zl=12,Gl="sans-serif",Wl=zl+"px "+Gl;var Hl,$l,Yl=function(t){var e={};if("undefined"==typeof JSON)return e;for(var n=0;n<t.length;n++){var r=String.fromCharCode(n+32),i=(t.charCodeAt(n)-20)/100;e[r]=i}return e}("007LLmW'55;N0500LLLLLLLLLL00NNNLzWW\\\\WQb\\0FWLg\\bWb\\WQ\\WrWWQ000CL5LLFLL0LL**F*gLLLL5F0LF\\FFF5.5N"),Xl={createCanvas:function(){return"undefined"!=typeof document&&document.createElement("canvas")},measureText:function(t,e){if(!Hl){var n=Xl.createCanvas();Hl=n&&n.getContext("2d")}if(Hl)return $l!==e&&($l=Hl.font=e||Wl),Hl.measureText(t);t=t||"";var r=/(\d+)px/.exec(e=e||Wl),i=r&&+r[1]||zl,s=0;if(e.indexOf("mono")>=0)s=i*t.length;else for(var o=0;o<t.length;o++){var a=Yl[t[o]];s+=null==a?i:a*i}return{width:s}},loadImage:function(t,e,n){var r=new Image;return r.onload=e,r.onerror=n,r.src=t,r}},ql=xc(["Function","RegExp","Date","Error","CanvasGradient","CanvasPattern","Image","Canvas"],(function(t,e){return t["[object "+e+"]"]=!0,t}),{}),Kl=xc(["Int8","Uint8","Uint8Clamped","Int16","Uint16","Int32","Uint32","Float32","Float64"],(function(t,e){return t["[object "+e+"Array]"]=!0,t}),{}),Zl=Object.prototype.toString,Jl=Array.prototype,Ql=Jl.forEach,tc=Jl.filter,ec=Jl.slice,nc=Jl.map,rc=function(){}.constructor,ic=rc?rc.prototype:null,sc="__proto__",oc=2311;function ac(){return oc++}function lc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e]}function cc(t){if(null==t||"object"!=typeof t)return t;var e=t,n=Zl.call(t);if("[object Array]"===n){if(!Yc(t)){e=[];for(var r=0,i=t.length;r<i;r++)e[r]=cc(t[r])}}else if(Kl[n]){if(!Yc(t)){var s=t.constructor;if(s.from)e=s.from(t);else{e=new s(t.length);for(r=0,i=t.length;r<i;r++)e[r]=t[r]}}}else if(!ql[n]&&!Yc(t)&&!Pc(t))for(var o in e={},t)t.hasOwnProperty(o)&&o!==sc&&(e[o]=cc(t[o]));return e}function hc(t,e,n){if(!Ic(e)||!Ic(t))return n?cc(e):t;for(var r in e)if(e.hasOwnProperty(r)&&r!==sc){var i=t[r],s=e[r];!Ic(s)||!Ic(i)||kc(s)||kc(i)||Pc(s)||Pc(i)||Dc(s)||Dc(i)||Yc(s)||Yc(i)?!n&&r in t||(t[r]=cc(e[r])):hc(i,s,n)}return t}function uc(t,e){for(var n=t[0],r=1,i=t.length;r<i;r++)n=hc(n,t[r],e);return n}function dc(t,e){if(Object.assign)Object.assign(t,e);else for(var n in e)e.hasOwnProperty(n)&&n!==sc&&(t[n]=e[n]);return t}function fc(t,e,n){for(var r=_c(e),i=0;i<r.length;i++){var s=r[i];(n?null!=e[s]:null==t[s])&&(t[s]=e[s])}return t}function pc(t,e){if(t){if(t.indexOf)return t.indexOf(e);for(var n=0,r=t.length;n<r;n++)if(t[n]===e)return n}return-1}function mc(t,e){var n=t.prototype;function r(){}for(var i in r.prototype=e.prototype,t.prototype=new r,n)n.hasOwnProperty(i)&&(t.prototype[i]=n[i]);t.prototype.constructor=t,t.superClass=e}function gc(t,e,n){if(t="prototype"in t?t.prototype:t,e="prototype"in e?e.prototype:e,Object.getOwnPropertyNames)for(var r=Object.getOwnPropertyNames(e),i=0;i<r.length;i++){var s=r[i];"constructor"!==s&&(n?null!=e[s]:null==t[s])&&(t[s]=e[s])}else fc(t,e,n)}function vc(t){return!!t&&("string"!=typeof t&&"number"==typeof t.length)}function yc(t,e,n){if(t&&e)if(t.forEach&&t.forEach===Ql)t.forEach(e,n);else if(t.length===+t.length)for(var r=0,i=t.length;r<i;r++)e.call(n,t[r],r,t);else for(var s in t)t.hasOwnProperty(s)&&e.call(n,t[s],s,t)}function bc(t,e,n){if(!t)return[];if(!e)return jc(t);if(t.map&&t.map===nc)return t.map(e,n);for(var r=[],i=0,s=t.length;i<s;i++)r.push(e.call(n,t[i],i,t));return r}function xc(t,e,n,r){if(t&&e){for(var i=0,s=t.length;i<s;i++)n=e.call(r,n,t[i],i,t);return n}}function wc(t,e,n){if(!t)return[];if(!e)return jc(t);if(t.filter&&t.filter===tc)return t.filter(e,n);for(var r=[],i=0,s=t.length;i<s;i++)e.call(n,t[i],i,t)&&r.push(t[i]);return r}function Ec(t,e,n){if(t&&e)for(var r=0,i=t.length;r<i;r++)if(e.call(n,t[r],r,t))return t[r]}function _c(t){if(!t)return[];if(Object.keys)return Object.keys(t);var e=[];for(var n in t)t.hasOwnProperty(n)&&e.push(n);return e}var Sc=ic&&Ac(ic.bind)?ic.call.bind(ic.bind):function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];return function(){return t.apply(e,n.concat(ec.call(arguments)))}};function Tc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return function(){return t.apply(this,e.concat(ec.call(arguments)))}}function kc(t){return Array.isArray?Array.isArray(t):"[object Array]"===Zl.call(t)}function Ac(t){return"function"==typeof t}function Cc(t){return"string"==typeof t}function Rc(t){return"[object String]"===Zl.call(t)}function Mc(t){return"number"==typeof t}function Ic(t){var e=typeof t;return"function"===e||!!t&&"object"===e}function Dc(t){return!!ql[Zl.call(t)]}function Oc(t){return!!Kl[Zl.call(t)]}function Pc(t){return"object"==typeof t&&"number"==typeof t.nodeType&&"object"==typeof t.ownerDocument}function Lc(t){return null!=t.colorStops}function Fc(t){return"[object RegExp]"===Zl.call(t)}function Nc(t){return t!=t}function Bc(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0,r=t.length;n<r;n++)if(null!=t[n])return t[n]}function Uc(t,e){return null!=t?t:e}function Vc(t,e,n){return null!=t?t:null!=e?e:n}function jc(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];return ec.apply(t,e)}function zc(t){if("number"==typeof t)return[t,t,t,t];var e=t.length;return 2===e?[t[0],t[1],t[0],t[1]]:3===e?[t[0],t[1],t[2],t[1]]:t}function Gc(t,e){if(!t)throw new Error(e)}function Wc(t){return null==t?null:"function"==typeof t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}var Hc="__ec_primitive__";function $c(t){t[Hc]=!0}function Yc(t){return t[Hc]}var Xc=function(){function t(){this.data={}}return t.prototype.delete=function(t){var e=this.has(t);return e&&delete this.data[t],e},t.prototype.has=function(t){return this.data.hasOwnProperty(t)},t.prototype.get=function(t){return this.data[t]},t.prototype.set=function(t,e){return this.data[t]=e,this},t.prototype.keys=function(){return _c(this.data)},t.prototype.forEach=function(t){var e=this.data;for(var n in e)e.hasOwnProperty(n)&&t(e[n],n)},t}(),qc="function"==typeof Map;var Kc=function(){function t(e){var n=kc(e);this.data=qc?new Map:new Xc;var r=this;function i(t,e){n?r.set(t,e):r.set(e,t)}e instanceof t?e.each(i):e&&yc(e,i)}return t.prototype.hasKey=function(t){return this.data.has(t)},t.prototype.get=function(t){return this.data.get(t)},t.prototype.set=function(t,e){return this.data.set(t,e),e},t.prototype.each=function(t,e){this.data.forEach((function(n,r){t.call(e,n,r)}))},t.prototype.keys=function(){var t=this.data.keys();return qc?Array.from(t):t},t.prototype.removeKey=function(t){this.data.delete(t)},t}();function Zc(t){return new Kc(t)}function Jc(t,e){for(var n=new t.constructor(t.length+e.length),r=0;r<t.length;r++)n[r]=t[r];var i=t.length;for(r=0;r<e.length;r++)n[r+i]=e[r];return n}function Qc(t,e){var n;if(Object.create)n=Object.create(t);else{var r=function(){};r.prototype=t,n=new r}return e&&dc(n,e),n}function th(t){var e=t.style;e.webkitUserSelect="none",e.userSelect="none",e.webkitTapHighlightColor="rgba(0,0,0,0)",e["-webkit-touch-callout"]="none"}function eh(t,e){return t.hasOwnProperty(e)}function nh(){}var rh=180/Math.PI,ih=function(t,e){return(ih=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function sh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}ih(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function oh(t,e){return null==t&&(t=0),null==e&&(e=0),[t,e]}function ah(t,e){return t[0]=e[0],t[1]=e[1],t}function lh(t){return[t[0],t[1]]}function ch(t,e,n){return t[0]=e,t[1]=n,t}function hh(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function uh(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t}function dh(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function fh(t){return Math.sqrt(function(t){return t[0]*t[0]+t[1]*t[1]}(t))}function ph(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t}function mh(t,e){var n=fh(e);return 0===n?(t[0]=0,t[1]=0):(t[0]=e[0]/n,t[1]=e[1]/n),t}function gh(t,e){return Math.sqrt((t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1]))}var vh=gh;var yh=function(t,e){return(t[0]-e[0])*(t[0]-e[0])+(t[1]-e[1])*(t[1]-e[1])};function bh(t,e,n,r){return t[0]=e[0]+r*(n[0]-e[0]),t[1]=e[1]+r*(n[1]-e[1]),t}function xh(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[2]*i+n[4],t[1]=n[1]*r+n[3]*i+n[5],t}function wh(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t}function Eh(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t}var _h=function(t,e){this.target=t,this.topTarget=e&&e.topTarget},Sh=function(){function t(t){this.handler=t,t.on("mousedown",this._dragStart,this),t.on("mousemove",this._drag,this),t.on("mouseup",this._dragEnd,this)}return t.prototype._dragStart=function(t){for(var e=t.target;e&&!e.draggable;)e=e.parent||e.__hostTarget;e&&(this._draggingTarget=e,e.dragging=!0,this._x=t.offsetX,this._y=t.offsetY,this.handler.dispatchToElement(new _h(e,t),"dragstart",t.event))},t.prototype._drag=function(t){var e=this._draggingTarget;if(e){var n=t.offsetX,r=t.offsetY,i=n-this._x,s=r-this._y;this._x=n,this._y=r,e.drift(i,s,t),this.handler.dispatchToElement(new _h(e,t),"drag",t.event);var o=this.handler.findHover(n,r,e).target,a=this._dropTarget;this._dropTarget=o,e!==o&&(a&&o!==a&&this.handler.dispatchToElement(new _h(a,t),"dragleave",t.event),o&&o!==a&&this.handler.dispatchToElement(new _h(o,t),"dragenter",t.event))}},t.prototype._dragEnd=function(t){var e=this._draggingTarget;e&&(e.dragging=!1),this.handler.dispatchToElement(new _h(e,t),"dragend",t.event),this._dropTarget&&this.handler.dispatchToElement(new _h(this._dropTarget,t),"drop",t.event),this._draggingTarget=null,this._dropTarget=null},t}();const Th=Sh;const kh=function(){function t(t){t&&(this._$eventProcessor=t)}return t.prototype.on=function(t,e,n,r){this._$handlers||(this._$handlers={});var i=this._$handlers;if("function"==typeof e&&(r=n,n=e,e=null),!n||!t)return this;var s=this._$eventProcessor;null!=e&&s&&s.normalizeQuery&&(e=s.normalizeQuery(e)),i[t]||(i[t]=[]);for(var o=0;o<i[t].length;o++)if(i[t][o].h===n)return this;var a={h:n,query:e,ctx:r||this,callAtLast:n.zrEventfulCallAtLast},l=i[t].length-1,c=i[t][l];return c&&c.callAtLast?i[t].splice(l,0,a):i[t].push(a),this},t.prototype.isSilent=function(t){var e=this._$handlers;return!e||!e[t]||!e[t].length},t.prototype.off=function(t,e){var n=this._$handlers;if(!n)return this;if(!t)return this._$handlers={},this;if(e){if(n[t]){for(var r=[],i=0,s=n[t].length;i<s;i++)n[t][i].h!==e&&r.push(n[t][i]);n[t]=r}n[t]&&0===n[t].length&&delete n[t]}else delete n[t];return this},t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!this._$handlers)return this;var r=this._$handlers[t],i=this._$eventProcessor;if(r)for(var s=e.length,o=r.length,a=0;a<o;a++){var l=r[a];if(!i||!i.filter||null==l.query||i.filter(t,l.query))switch(s){case 0:l.h.call(l.ctx);break;case 1:l.h.call(l.ctx,e[0]);break;case 2:l.h.call(l.ctx,e[0],e[1]);break;default:l.h.apply(l.ctx,e)}}return i&&i.afterTrigger&&i.afterTrigger(t),this},t.prototype.triggerWithContext=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!this._$handlers)return this;var r=this._$handlers[t],i=this._$eventProcessor;if(r)for(var s=e.length,o=e[s-1],a=r.length,l=0;l<a;l++){var c=r[l];if(!i||!i.filter||null==c.query||i.filter(t,c.query))switch(s){case 0:c.h.call(o);break;case 1:c.h.call(o,e[0]);break;case 2:c.h.call(o,e[0],e[1]);break;default:c.h.apply(o,e.slice(1,s-1))}}return i&&i.afterTrigger&&i.afterTrigger(t),this},t}();var Ah=Math.log(2);function Ch(t,e,n,r,i,s){var o=r+"-"+i,a=t.length;if(s.hasOwnProperty(o))return s[o];if(1===e){var l=Math.round(Math.log((1<<a)-1&~i)/Ah);return t[n][l]}for(var c=r|1<<n,h=n+1;r&1<<h;)h++;for(var u=0,d=0,f=0;d<a;d++){var p=1<<d;p&i||(u+=(f%2?-1:1)*t[n][d]*Ch(t,e-1,h,c,i|p,s),f++)}return s[o]=u,u}function Rh(t,e){var n=[[t[0],t[1],1,0,0,0,-e[0]*t[0],-e[0]*t[1]],[0,0,0,t[0],t[1],1,-e[1]*t[0],-e[1]*t[1]],[t[2],t[3],1,0,0,0,-e[2]*t[2],-e[2]*t[3]],[0,0,0,t[2],t[3],1,-e[3]*t[2],-e[3]*t[3]],[t[4],t[5],1,0,0,0,-e[4]*t[4],-e[4]*t[5]],[0,0,0,t[4],t[5],1,-e[5]*t[4],-e[5]*t[5]],[t[6],t[7],1,0,0,0,-e[6]*t[6],-e[6]*t[7]],[0,0,0,t[6],t[7],1,-e[7]*t[6],-e[7]*t[7]]],r={},i=Ch(n,8,0,0,0,r);if(0!==i){for(var s=[],o=0;o<8;o++)for(var a=0;a<8;a++)null==s[a]&&(s[a]=0),s[a]+=((o+a)%2?-1:1)*Ch(n,7,0===o?1:0,1<<o,1<<a,r)/i*e[o];return function(t,e,n){var r=e*s[6]+n*s[7]+1;t[0]=(e*s[0]+n*s[1]+s[2])/r,t[1]=(e*s[3]+n*s[4]+s[5])/r}}}var Mh="___zrEVENTSAVED",Ih=[];function Dh(t,e,n,r,i){return Oh(Ih,e,r,i,!0)&&Oh(t,n,Ih[0],Ih[1])}function Oh(t,e,n,r,i){if(e.getBoundingClientRect&&jl.domSupported&&!Ph(e)){var s=e[Mh]||(e[Mh]={}),o=function(t,e){var n=e.markers;if(n)return n;n=e.markers=[];for(var r=["left","right"],i=["top","bottom"],s=0;s<4;s++){var o=document.createElement("div"),a=s%2,l=(s>>1)%2;o.style.cssText=["position: absolute","visibility: hidden","padding: 0","margin: 0","border-width: 0","user-select: none","width:0","height:0",r[a]+":0",i[l]+":0",r[1-a]+":auto",i[1-l]+":auto",""].join("!important;"),t.appendChild(o),n.push(o)}return n}(e,s),a=function(t,e,n){for(var r=n?"invTrans":"trans",i=e[r],s=e.srcCoords,o=[],a=[],l=!0,c=0;c<4;c++){var h=t[c].getBoundingClientRect(),u=2*c,d=h.left,f=h.top;o.push(d,f),l=l&&s&&d===s[u]&&f===s[u+1],a.push(t[c].offsetLeft,t[c].offsetTop)}return l&&i?i:(e.srcCoords=o,e[r]=n?Rh(a,o):Rh(o,a))}(o,s,i);if(a)return a(t,n,r),!0}return!1}function Ph(t){return"CANVAS"===t.nodeName.toUpperCase()}var Lh=/([&<>"'])/g,Fh={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function Nh(t){return null==t?"":(t+"").replace(Lh,(function(t,e){return Fh[e]}))}var Bh=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,Uh=[],Vh=jl.browser.firefox&&+jl.browser.version.split(".")[0]<39;function jh(t,e,n,r){return n=n||{},r?zh(t,e,n):Vh&&null!=e.layerX&&e.layerX!==e.offsetX?(n.zrX=e.layerX,n.zrY=e.layerY):null!=e.offsetX?(n.zrX=e.offsetX,n.zrY=e.offsetY):zh(t,e,n),n}function zh(t,e,n){if(jl.domSupported&&t.getBoundingClientRect){var r=e.clientX,i=e.clientY;if(Ph(t)){var s=t.getBoundingClientRect();return n.zrX=r-s.left,void(n.zrY=i-s.top)}if(Oh(Uh,t,r,i))return n.zrX=Uh[0],void(n.zrY=Uh[1])}n.zrX=n.zrY=0}function Gh(t){return t||window.event}function Wh(t,e,n){if(null!=(e=Gh(e)).zrX)return e;var r=e.type;if(r&&r.indexOf("touch")>=0){var i="touchend"!==r?e.targetTouches[0]:e.changedTouches[0];i&&jh(t,i,e,n)}else{jh(t,e,e,n);var s=function(t){var e=t.wheelDelta;if(e)return e;var n=t.deltaX,r=t.deltaY;if(null==n||null==r)return e;return 3*(0!==r?Math.abs(r):Math.abs(n))*(r>0?-1:r<0?1:n>0?-1:1)}(e);e.zrDelta=s?s/120:-(e.detail||0)/3}var o=e.button;return null==e.which&&void 0!==o&&Bh.test(e.type)&&(e.which=1&o?1:2&o?3:4&o?2:0),e}function Hh(t,e,n,r){t.addEventListener(e,n,r)}var $h=function(t){t.preventDefault(),t.stopPropagation(),t.cancelBubble=!0};function Yh(t){return 2===t.which||3===t.which}var Xh=function(){function t(){this._track=[]}return t.prototype.recognize=function(t,e,n){return this._doTrack(t,e,n),this._recognize(t)},t.prototype.clear=function(){return this._track.length=0,this},t.prototype._doTrack=function(t,e,n){var r=t.touches;if(r){for(var i={points:[],touches:[],target:e,event:t},s=0,o=r.length;s<o;s++){var a=r[s],l=jh(n,a,{});i.points.push([l.zrX,l.zrY]),i.touches.push(a)}this._track.push(i)}},t.prototype._recognize=function(t){for(var e in Kh)if(Kh.hasOwnProperty(e)){var n=Kh[e](this._track,t);if(n)return n}},t}();function qh(t){var e=t[1][0]-t[0][0],n=t[1][1]-t[0][1];return Math.sqrt(e*e+n*n)}var Kh={pinch:function(t,e){var n=t.length;if(n){var r,i=(t[n-1]||{}).points,s=(t[n-2]||{}).points||i;if(s&&s.length>1&&i&&i.length>1){var o=qh(i)/qh(s);!isFinite(o)&&(o=1),e.pinchScale=o;var a=[((r=i)[0][0]+r[1][0])/2,(r[0][1]+r[1][1])/2];return e.pinchX=a[0],e.pinchY=a[1],{type:"pinch",target:t[0].target,event:e}}}}};function Zh(){return[1,0,0,1,0,0]}function Jh(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t}function Qh(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t}function tu(t,e,n){var r=e[0]*n[0]+e[2]*n[1],i=e[1]*n[0]+e[3]*n[1],s=e[0]*n[2]+e[2]*n[3],o=e[1]*n[2]+e[3]*n[3],a=e[0]*n[4]+e[2]*n[5]+e[4],l=e[1]*n[4]+e[3]*n[5]+e[5];return t[0]=r,t[1]=i,t[2]=s,t[3]=o,t[4]=a,t[5]=l,t}function eu(t,e,n){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4]+n[0],t[5]=e[5]+n[1],t}function nu(t,e,n){var r=e[0],i=e[2],s=e[4],o=e[1],a=e[3],l=e[5],c=Math.sin(n),h=Math.cos(n);return t[0]=r*h+o*c,t[1]=-r*c+o*h,t[2]=i*h+a*c,t[3]=-i*c+h*a,t[4]=h*s+c*l,t[5]=h*l-c*s,t}function ru(t,e,n){var r=n[0],i=n[1];return t[0]=e[0]*r,t[1]=e[1]*i,t[2]=e[2]*r,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*i,t}function iu(t,e){var n=e[0],r=e[2],i=e[4],s=e[1],o=e[3],a=e[5],l=n*o-s*r;return l?(l=1/l,t[0]=o*l,t[1]=-s*l,t[2]=-r*l,t[3]=n*l,t[4]=(r*a-o*i)*l,t[5]=(s*i-n*a)*l,t):null}function su(t){var e=[1,0,0,1,0,0];return Qh(e,t),e}var ou=function(){function t(t,e){this.x=t||0,this.y=e||0}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this},t.prototype.clone=function(){return new t(this.x,this.y)},t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.equal=function(t){return t.x===this.x&&t.y===this.y},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this},t.prototype.scale=function(t){this.x*=t,this.y*=t},t.prototype.scaleAndAdd=function(t,e){this.x+=t.x*e,this.y+=t.y*e},t.prototype.sub=function(t){return this.x-=t.x,this.y-=t.y,this},t.prototype.dot=function(t){return this.x*t.x+this.y*t.y},t.prototype.len=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},t.prototype.lenSquare=function(){return this.x*this.x+this.y*this.y},t.prototype.normalize=function(){var t=this.len();return this.x/=t,this.y/=t,this},t.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)},t.prototype.distanceSquare=function(t){var e=this.x-t.x,n=this.y-t.y;return e*e+n*n},t.prototype.negate=function(){return this.x=-this.x,this.y=-this.y,this},t.prototype.transform=function(t){if(t){var e=this.x,n=this.y;return this.x=t[0]*e+t[2]*n+t[4],this.y=t[1]*e+t[3]*n+t[5],this}},t.prototype.toArray=function(t){return t[0]=this.x,t[1]=this.y,t},t.prototype.fromArray=function(t){this.x=t[0],this.y=t[1]},t.set=function(t,e,n){t.x=e,t.y=n},t.copy=function(t,e){t.x=e.x,t.y=e.y},t.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y)},t.lenSquare=function(t){return t.x*t.x+t.y*t.y},t.dot=function(t,e){return t.x*e.x+t.y*e.y},t.add=function(t,e,n){t.x=e.x+n.x,t.y=e.y+n.y},t.sub=function(t,e,n){t.x=e.x-n.x,t.y=e.y-n.y},t.scale=function(t,e,n){t.x=e.x*n,t.y=e.y*n},t.scaleAndAdd=function(t,e,n,r){t.x=e.x+n.x*r,t.y=e.y+n.y*r},t.lerp=function(t,e,n,r){var i=1-r;t.x=i*e.x+r*n.x,t.y=i*e.y+r*n.y},t}();const au=ou;var lu=Math.min,cu=Math.max,hu=new au,uu=new au,du=new au,fu=new au,pu=new au,mu=new au;const gu=function(){function t(t,e,n,r){n<0&&(t+=n,n=-n),r<0&&(e+=r,r=-r),this.x=t,this.y=e,this.width=n,this.height=r}return t.prototype.union=function(t){var e=lu(t.x,this.x),n=lu(t.y,this.y);isFinite(this.x)&&isFinite(this.width)?this.width=cu(t.x+t.width,this.x+this.width)-e:this.width=t.width,isFinite(this.y)&&isFinite(this.height)?this.height=cu(t.y+t.height,this.y+this.height)-n:this.height=t.height,this.x=e,this.y=n},t.prototype.applyTransform=function(e){t.applyTransform(this,this,e)},t.prototype.calculateTransform=function(t){var e=this,n=t.width/e.width,r=t.height/e.height,i=[1,0,0,1,0,0];return eu(i,i,[-e.x,-e.y]),ru(i,i,[n,r]),eu(i,i,[t.x,t.y]),i},t.prototype.intersect=function(e,n){if(!e)return!1;e instanceof t||(e=t.create(e));var r=this,i=r.x,s=r.x+r.width,o=r.y,a=r.y+r.height,l=e.x,c=e.x+e.width,h=e.y,u=e.y+e.height,d=!(s<l||c<i||a<h||u<o);if(n){var f=1/0,p=0,m=Math.abs(s-l),g=Math.abs(c-i),v=Math.abs(a-h),y=Math.abs(u-o),b=Math.min(m,g),x=Math.min(v,y);s<l||c<i?b>p&&(p=b,m<g?au.set(mu,-m,0):au.set(mu,g,0)):b<f&&(f=b,m<g?au.set(pu,m,0):au.set(pu,-g,0)),a<h||u<o?x>p&&(p=x,v<y?au.set(mu,0,-v):au.set(mu,0,y)):b<f&&(f=b,v<y?au.set(pu,0,v):au.set(pu,0,-y))}return n&&au.copy(n,d?pu:mu),d},t.prototype.contain=function(t,e){var n=this;return t>=n.x&&t<=n.x+n.width&&e>=n.y&&e<=n.y+n.height},t.prototype.clone=function(){return new t(this.x,this.y,this.width,this.height)},t.prototype.copy=function(e){t.copy(this,e)},t.prototype.plain=function(){return{x:this.x,y:this.y,width:this.width,height:this.height}},t.prototype.isFinite=function(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)},t.prototype.isZero=function(){return 0===this.width||0===this.height},t.create=function(e){return new t(e.x,e.y,e.width,e.height)},t.copy=function(t,e){t.x=e.x,t.y=e.y,t.width=e.width,t.height=e.height},t.applyTransform=function(e,n,r){if(r){if(r[1]<1e-5&&r[1]>-1e-5&&r[2]<1e-5&&r[2]>-1e-5){var i=r[0],s=r[3],o=r[4],a=r[5];return e.x=n.x*i+o,e.y=n.y*s+a,e.width=n.width*i,e.height=n.height*s,e.width<0&&(e.x+=e.width,e.width=-e.width),void(e.height<0&&(e.y+=e.height,e.height=-e.height))}hu.x=du.x=n.x,hu.y=fu.y=n.y,uu.x=fu.x=n.x+n.width,uu.y=du.y=n.y+n.height,hu.transform(r),fu.transform(r),uu.transform(r),du.transform(r),e.x=lu(hu.x,uu.x,du.x,fu.x),e.y=lu(hu.y,uu.y,du.y,fu.y);var l=cu(hu.x,uu.x,du.x,fu.x),c=cu(hu.y,uu.y,du.y,fu.y);e.width=l-e.x,e.height=c-e.y}else e!==n&&t.copy(e,n)},t}();var vu="silent";function yu(){$h(this.event)}var bu=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.handler=null,e}return sh(e,t),e.prototype.dispose=function(){},e.prototype.setCursor=function(){},e}(kh),xu=function(t,e){this.x=t,this.y=e},wu=["click","dblclick","mousewheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],Eu=new gu(0,0,0,0),_u=function(t){function e(e,n,r,i,s){var o=t.call(this)||this;return o._hovered=new xu(0,0),o.storage=e,o.painter=n,o.painterRoot=i,o._pointerSize=s,r=r||new bu,o.proxy=null,o.setHandlerProxy(r),o._draggingMgr=new Th(o),o}return sh(e,t),e.prototype.setHandlerProxy=function(t){this.proxy&&this.proxy.dispose(),t&&(yc(wu,(function(e){t.on&&t.on(e,this[e],this)}),this),t.handler=this),this.proxy=t},e.prototype.mousemove=function(t){var e=t.zrX,n=t.zrY,r=ku(this,e,n),i=this._hovered,s=i.target;s&&!s.__zr&&(s=(i=this.findHover(i.x,i.y)).target);var o=this._hovered=r?new xu(e,n):this.findHover(e,n),a=o.target,l=this.proxy;l.setCursor&&l.setCursor(a?a.cursor:"default"),s&&a!==s&&this.dispatchToElement(i,"mouseout",t),this.dispatchToElement(o,"mousemove",t),a&&a!==s&&this.dispatchToElement(o,"mouseover",t)},e.prototype.mouseout=function(t){var e=t.zrEventControl;"only_globalout"!==e&&this.dispatchToElement(this._hovered,"mouseout",t),"no_globalout"!==e&&this.trigger("globalout",{type:"globalout",event:t})},e.prototype.resize=function(){this._hovered=new xu(0,0)},e.prototype.dispatch=function(t,e){var n=this[t];n&&n.call(this,e)},e.prototype.dispose=function(){this.proxy.dispose(),this.storage=null,this.proxy=null,this.painter=null},e.prototype.setCursorStyle=function(t){var e=this.proxy;e.setCursor&&e.setCursor(t)},e.prototype.dispatchToElement=function(t,e,n){var r=(t=t||{}).target;if(!r||!r.silent){for(var i="on"+e,s=function(t,e,n){return{type:t,event:n,target:e.target,topTarget:e.topTarget,cancelBubble:!1,offsetX:n.zrX,offsetY:n.zrY,gestureEvent:n.gestureEvent,pinchX:n.pinchX,pinchY:n.pinchY,pinchScale:n.pinchScale,wheelDelta:n.zrDelta,zrByTouch:n.zrByTouch,which:n.which,stop:yu}}(e,t,n);r&&(r[i]&&(s.cancelBubble=!!r[i].call(r,s)),r.trigger(e,s),r=r.__hostTarget?r.__hostTarget:r.parent,!s.cancelBubble););s.cancelBubble||(this.trigger(e,s),this.painter&&this.painter.eachOtherLayer&&this.painter.eachOtherLayer((function(t){"function"==typeof t[i]&&t[i].call(t,s),t.trigger&&t.trigger(e,s)})))}},e.prototype.findHover=function(t,e,n){var r=this.storage.getDisplayList(),i=new xu(t,e);if(Tu(r,i,t,e,n),this._pointerSize&&!i.target){for(var s=[],o=this._pointerSize,a=o/2,l=new gu(t-a,e-a,o,o),c=r.length-1;c>=0;c--){var h=r[c];h===n||h.ignore||h.ignoreCoarsePointer||h.parent&&h.parent.ignoreCoarsePointer||(Eu.copy(h.getBoundingRect()),h.transform&&Eu.applyTransform(h.transform),Eu.intersect(l)&&s.push(h))}if(s.length)for(var u=Math.PI/12,d=2*Math.PI,f=0;f<a;f+=4)for(var p=0;p<d;p+=u){if(Tu(s,i,t+f*Math.cos(p),e+f*Math.sin(p),n),i.target)return i}}return i},e.prototype.processGesture=function(t,e){this._gestureMgr||(this._gestureMgr=new Xh);var n=this._gestureMgr;"start"===e&&n.clear();var r=n.recognize(t,this.findHover(t.zrX,t.zrY,null).target,this.proxy.dom);if("end"===e&&n.clear(),r){var i=r.type;t.gestureEvent=i;var s=new xu;s.target=r.target,this.dispatchToElement(s,i,r.event)}},e}(kh);function Su(t,e,n){if(t[t.rectHover?"rectContain":"contain"](e,n)){for(var r=t,i=void 0,s=!1;r;){if(r.ignoreClip&&(s=!0),!s){var o=r.getClipPath();if(o&&!o.contain(e,n))return!1;r.silent&&(i=!0)}var a=r.__hostTarget;r=a||r.parent}return!i||vu}return!1}function Tu(t,e,n,r,i){for(var s=t.length-1;s>=0;s--){var o=t[s],a=void 0;if(o!==i&&!o.ignore&&(a=Su(o,n,r))&&(!e.topTarget&&(e.topTarget=o),a!==vu)){e.target=o;break}}}function ku(t,e,n){var r=t.painter;return e<0||e>r.getWidth()||n<0||n>r.getHeight()}yc(["click","mousedown","mouseup","mousewheel","dblclick","contextmenu"],(function(t){_u.prototype[t]=function(e){var n,r,i=e.zrX,s=e.zrY,o=ku(this,i,s);if("mouseup"===t&&o||(r=(n=this.findHover(i,s)).target),"mousedown"===t)this._downEl=r,this._downPoint=[e.zrX,e.zrY],this._upEl=r;else if("mouseup"===t)this._upEl=r;else if("click"===t){if(this._downEl!==this._upEl||!this._downPoint||vh(this._downPoint,[e.zrX,e.zrY])>4)return;this._downPoint=null}this.dispatchToElement(n,t,e)}}));const Au=_u;var Cu=32,Ru=7;function Mu(t,e,n,r){var i=e+1;if(i===n)return 1;if(r(t[i++],t[e])<0){for(;i<n&&r(t[i],t[i-1])<0;)i++;!function(t,e,n){n--;for(;e<n;){var r=t[e];t[e++]=t[n],t[n--]=r}}(t,e,i)}else for(;i<n&&r(t[i],t[i-1])>=0;)i++;return i-e}function Iu(t,e,n,r,i){for(r===e&&r++;r<n;r++){for(var s,o=t[r],a=e,l=r;a<l;)i(o,t[s=a+l>>>1])<0?l=s:a=s+1;var c=r-a;switch(c){case 3:t[a+3]=t[a+2];case 2:t[a+2]=t[a+1];case 1:t[a+1]=t[a];break;default:for(;c>0;)t[a+c]=t[a+c-1],c--}t[a]=o}}function Du(t,e,n,r,i,s){var o=0,a=0,l=1;if(s(t,e[n+i])>0){for(a=r-i;l<a&&s(t,e[n+i+l])>0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=i,l+=i}else{for(a=i+1;l<a&&s(t,e[n+i-l])<=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=i-l,l=i-c}for(o++;o<l;){var h=o+(l-o>>>1);s(t,e[n+h])>0?o=h+1:l=h}return l}function Ou(t,e,n,r,i,s){var o=0,a=0,l=1;if(s(t,e[n+i])<0){for(a=i+1;l<a&&s(t,e[n+i-l])<0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a);var c=o;o=i-l,l=i-c}else{for(a=r-i;l<a&&s(t,e[n+i+l])>=0;)o=l,(l=1+(l<<1))<=0&&(l=a);l>a&&(l=a),o+=i,l+=i}for(o++;o<l;){var h=o+(l-o>>>1);s(t,e[n+h])<0?l=h:o=h+1}return l}function Pu(t,e){var n,r,i=Ru,s=0;t.length;var o=[];function a(a){var l=n[a],c=r[a],h=n[a+1],u=r[a+1];r[a]=c+u,a===s-3&&(n[a+1]=n[a+2],r[a+1]=r[a+2]),s--;var d=Ou(t[h],t,l,c,0,e);l+=d,0!==(c-=d)&&0!==(u=Du(t[l+c-1],t,h,u,u-1,e))&&(c<=u?function(n,r,s,a){var l=0;for(l=0;l<r;l++)o[l]=t[n+l];var c=0,h=s,u=n;if(t[u++]=t[h++],0==--a){for(l=0;l<r;l++)t[u+l]=o[c+l];return}if(1===r){for(l=0;l<a;l++)t[u+l]=t[h+l];return void(t[u+a]=o[c])}var d,f,p,m=i;for(;;){d=0,f=0,p=!1;do{if(e(t[h],o[c])<0){if(t[u++]=t[h++],f++,d=0,0==--a){p=!0;break}}else if(t[u++]=o[c++],d++,f=0,1==--r){p=!0;break}}while((d|f)<m);if(p)break;do{if(0!==(d=Ou(t[h],o,c,r,0,e))){for(l=0;l<d;l++)t[u+l]=o[c+l];if(u+=d,c+=d,(r-=d)<=1){p=!0;break}}if(t[u++]=t[h++],0==--a){p=!0;break}if(0!==(f=Du(o[c],t,h,a,0,e))){for(l=0;l<f;l++)t[u+l]=t[h+l];if(u+=f,h+=f,0===(a-=f)){p=!0;break}}if(t[u++]=o[c++],1==--r){p=!0;break}m--}while(d>=Ru||f>=Ru);if(p)break;m<0&&(m=0),m+=2}if((i=m)<1&&(i=1),1===r){for(l=0;l<a;l++)t[u+l]=t[h+l];t[u+a]=o[c]}else{if(0===r)throw new Error;for(l=0;l<r;l++)t[u+l]=o[c+l]}}(l,c,h,u):function(n,r,s,a){var l=0;for(l=0;l<a;l++)o[l]=t[s+l];var c=n+r-1,h=a-1,u=s+a-1,d=0,f=0;if(t[u--]=t[c--],0==--r){for(d=u-(a-1),l=0;l<a;l++)t[d+l]=o[l];return}if(1===a){for(f=(u-=r)+1,d=(c-=r)+1,l=r-1;l>=0;l--)t[f+l]=t[d+l];return void(t[u]=o[h])}var p=i;for(;;){var m=0,g=0,v=!1;do{if(e(o[h],t[c])<0){if(t[u--]=t[c--],m++,g=0,0==--r){v=!0;break}}else if(t[u--]=o[h--],g++,m=0,1==--a){v=!0;break}}while((m|g)<p);if(v)break;do{if(0!==(m=r-Ou(o[h],t,n,r,r-1,e))){for(r-=m,f=(u-=m)+1,d=(c-=m)+1,l=m-1;l>=0;l--)t[f+l]=t[d+l];if(0===r){v=!0;break}}if(t[u--]=o[h--],1==--a){v=!0;break}if(0!==(g=a-Du(t[c],o,0,a,a-1,e))){for(a-=g,f=(u-=g)+1,d=(h-=g)+1,l=0;l<g;l++)t[f+l]=o[d+l];if(a<=1){v=!0;break}}if(t[u--]=t[c--],0==--r){v=!0;break}p--}while(m>=Ru||g>=Ru);if(v)break;p<0&&(p=0),p+=2}(i=p)<1&&(i=1);if(1===a){for(f=(u-=r)+1,d=(c-=r)+1,l=r-1;l>=0;l--)t[f+l]=t[d+l];t[u]=o[h]}else{if(0===a)throw new Error;for(d=u-(a-1),l=0;l<a;l++)t[d+l]=o[l]}}(l,c,h,u))}return n=[],r=[],{mergeRuns:function(){for(;s>1;){var t=s-2;if(t>=1&&r[t-1]<=r[t]+r[t+1]||t>=2&&r[t-2]<=r[t]+r[t-1])r[t-1]<r[t+1]&&t--;else if(r[t]>r[t+1])break;a(t)}},forceMergeRuns:function(){for(;s>1;){var t=s-2;t>0&&r[t-1]<r[t+1]&&t--,a(t)}},pushRun:function(t,e){n[s]=t,r[s]=e,s+=1}}}function Lu(t,e,n,r){n||(n=0),r||(r=t.length);var i=r-n;if(!(i<2)){var s=0;if(i<Cu)Iu(t,n,r,n+(s=Mu(t,n,r,e)),e);else{var o=Pu(t,e),a=function(t){for(var e=0;t>=Cu;)e|=1&t,t>>=1;return t+e}(i);do{if((s=Mu(t,n,r,e))<a){var l=i;l>a&&(l=a),Iu(t,n,n+l,n+s,e),s=l}o.pushRun(n,s),o.mergeRuns(),i-=s,n+=s}while(0!==i);o.forceMergeRuns()}}}var Fu=1,Nu=4,Bu=!1;function Uu(){Bu||(Bu=!0)}function Vu(t,e){return t.zlevel===e.zlevel?t.z===e.z?t.z2-e.z2:t.z-e.z:t.zlevel-e.zlevel}const ju=function(){function t(){this._roots=[],this._displayList=[],this._displayListLen=0,this.displayableSortFunc=Vu}return t.prototype.traverse=function(t,e){for(var n=0;n<this._roots.length;n++)this._roots[n].traverse(t,e)},t.prototype.getDisplayList=function(t,e){e=e||!1;var n=this._displayList;return!t&&n.length||this.updateDisplayList(e),n},t.prototype.updateDisplayList=function(t){this._displayListLen=0;for(var e=this._roots,n=this._displayList,r=0,i=e.length;r<i;r++)this._updateAndAddDisplayable(e[r],null,t);n.length=this._displayListLen,Lu(n,Vu)},t.prototype._updateAndAddDisplayable=function(t,e,n){if(!t.ignore||n){t.beforeUpdate(),t.update(),t.afterUpdate();var r=t.getClipPath();if(t.ignoreClip)e=null;else if(r){e=e?e.slice():[];for(var i=r,s=t;i;)i.parent=s,i.updateTransform(),e.push(i),s=i,i=i.getClipPath()}if(t.childrenRef){for(var o=t.childrenRef(),a=0;a<o.length;a++){var l=o[a];t.__dirty&&(l.__dirty|=Fu),this._updateAndAddDisplayable(l,e,n)}t.__dirty=0}else{var c=t;e&&e.length?c.__clipPaths=e:c.__clipPaths&&c.__clipPaths.length>0&&(c.__clipPaths=[]),isNaN(c.z)&&(Uu(),c.z=0),isNaN(c.z2)&&(Uu(),c.z2=0),isNaN(c.zlevel)&&(Uu(),c.zlevel=0),this._displayList[this._displayListLen++]=c}var h=t.getDecalElement&&t.getDecalElement();h&&this._updateAndAddDisplayable(h,e,n);var u=t.getTextGuideLine();u&&this._updateAndAddDisplayable(u,e,n);var d=t.getTextContent();d&&this._updateAndAddDisplayable(d,e,n)}},t.prototype.addRoot=function(t){t.__zr&&t.__zr.storage===this||this._roots.push(t)},t.prototype.delRoot=function(t){if(t instanceof Array)for(var e=0,n=t.length;e<n;e++)this.delRoot(t[e]);else{var r=pc(this._roots,t);r>=0&&this._roots.splice(r,1)}},t.prototype.delAllRoots=function(){this._roots=[],this._displayList=[],this._displayListLen=0},t.prototype.getRoots=function(){return this._roots},t.prototype.dispose=function(){this._displayList=null,this._roots=null},t}();const zu=jl.hasGlobalWindow&&(window.requestAnimationFrame&&window.requestAnimationFrame.bind(window)||window.msRequestAnimationFrame&&window.msRequestAnimationFrame.bind(window)||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame)||function(t){return setTimeout(t,16)};var Gu={linear:function(t){return t},quadraticIn:function(t){return t*t},quadraticOut:function(t){return t*(2-t)},quadraticInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)},cubicIn:function(t){return t*t*t},cubicOut:function(t){return--t*t*t+1},cubicInOut:function(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)},quarticIn:function(t){return t*t*t*t},quarticOut:function(t){return 1- --t*t*t*t},quarticInOut:function(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)},quinticIn:function(t){return t*t*t*t*t},quinticOut:function(t){return--t*t*t*t*t+1},quinticInOut:function(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)},sinusoidalIn:function(t){return 1-Math.cos(t*Math.PI/2)},sinusoidalOut:function(t){return Math.sin(t*Math.PI/2)},sinusoidalInOut:function(t){return.5*(1-Math.cos(Math.PI*t))},exponentialIn:function(t){return 0===t?0:Math.pow(1024,t-1)},exponentialOut:function(t){return 1===t?1:1-Math.pow(2,-10*t)},exponentialInOut:function(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))},circularIn:function(t){return 1-Math.sqrt(1-t*t)},circularOut:function(t){return Math.sqrt(1- --t*t)},circularInOut:function(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)},elasticIn:function(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/.4))},elasticOut:function(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin((t-e)*(2*Math.PI)/.4)+1)},elasticInOut:function(t){var e,n=.1,r=.4;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=r*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin((t-e)*(2*Math.PI)/r)*.5+1)},backIn:function(t){var e=1.70158;return t*t*((e+1)*t-e)},backOut:function(t){var e=1.70158;return--t*t*((e+1)*t+e)+1},backInOut:function(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)},bounceIn:function(t){return 1-Gu.bounceOut(1-t)},bounceOut:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},bounceInOut:function(t){return t<.5?.5*Gu.bounceIn(2*t):.5*Gu.bounceOut(2*t-1)+.5}};const Wu=Gu;var Hu=Math.pow,$u=Math.sqrt,Yu=1e-8,Xu=1e-4,qu=$u(3),Ku=1/3,Zu=oh(),Ju=oh(),Qu=oh();function td(t){return t>-Yu&&t<Yu}function ed(t){return t>Yu||t<-Yu}function nd(t,e,n,r,i){var s=1-i;return s*s*(s*t+3*i*e)+i*i*(i*r+3*s*n)}function rd(t,e,n,r,i){var s=1-i;return 3*(((e-t)*s+2*(n-e)*i)*s+(r-n)*i*i)}function id(t,e,n,r,i,s){var o=r+3*(e-n)-t,a=3*(n-2*e+t),l=3*(e-t),c=t-i,h=a*a-3*o*l,u=a*l-9*o*c,d=l*l-3*a*c,f=0;if(td(h)&&td(u)){if(td(a))s[0]=0;else(S=-l/a)>=0&&S<=1&&(s[f++]=S)}else{var p=u*u-4*h*d;if(td(p)){var m=u/h,g=-m/2;(S=-a/o+m)>=0&&S<=1&&(s[f++]=S),g>=0&&g<=1&&(s[f++]=g)}else if(p>0){var v=$u(p),y=h*a+1.5*o*(-u+v),b=h*a+1.5*o*(-u-v);(S=(-a-((y=y<0?-Hu(-y,Ku):Hu(y,Ku))+(b=b<0?-Hu(-b,Ku):Hu(b,Ku))))/(3*o))>=0&&S<=1&&(s[f++]=S)}else{var x=(2*h*a-3*o*u)/(2*$u(h*h*h)),w=Math.acos(x)/3,E=$u(h),_=Math.cos(w),S=(-a-2*E*_)/(3*o),T=(g=(-a+E*(_+qu*Math.sin(w)))/(3*o),(-a+E*(_-qu*Math.sin(w)))/(3*o));S>=0&&S<=1&&(s[f++]=S),g>=0&&g<=1&&(s[f++]=g),T>=0&&T<=1&&(s[f++]=T)}}return f}function sd(t,e,n,r,i){var s=6*n-12*e+6*t,o=9*e+3*r-3*t-9*n,a=3*e-3*t,l=0;if(td(o)){if(ed(s))(h=-a/s)>=0&&h<=1&&(i[l++]=h)}else{var c=s*s-4*o*a;if(td(c))i[0]=-s/(2*o);else if(c>0){var h,u=$u(c),d=(-s-u)/(2*o);(h=(-s+u)/(2*o))>=0&&h<=1&&(i[l++]=h),d>=0&&d<=1&&(i[l++]=d)}}return l}function od(t,e,n,r,i,s){var o=(e-t)*i+t,a=(n-e)*i+e,l=(r-n)*i+n,c=(a-o)*i+o,h=(l-a)*i+a,u=(h-c)*i+c;s[0]=t,s[1]=o,s[2]=c,s[3]=u,s[4]=u,s[5]=h,s[6]=l,s[7]=r}function ad(t,e,n,r,i,s,o,a,l,c,h){var u,d,f,p,m,g=.005,v=1/0;Zu[0]=l,Zu[1]=c;for(var y=0;y<1;y+=.05)Ju[0]=nd(t,n,i,o,y),Ju[1]=nd(e,r,s,a,y),(p=yh(Zu,Ju))<v&&(u=y,v=p);v=1/0;for(var b=0;b<32&&!(g<Xu);b++)d=u-g,f=u+g,Ju[0]=nd(t,n,i,o,d),Ju[1]=nd(e,r,s,a,d),p=yh(Ju,Zu),d>=0&&p<v?(u=d,v=p):(Qu[0]=nd(t,n,i,o,f),Qu[1]=nd(e,r,s,a,f),m=yh(Qu,Zu),f<=1&&m<v?(u=f,v=m):g*=.5);return h&&(h[0]=nd(t,n,i,o,u),h[1]=nd(e,r,s,a,u)),$u(v)}function ld(t,e,n,r,i,s,o,a,l){for(var c=t,h=e,u=0,d=1/l,f=1;f<=l;f++){var p=f*d,m=nd(t,n,i,o,p),g=nd(e,r,s,a,p),v=m-c,y=g-h;u+=Math.sqrt(v*v+y*y),c=m,h=g}return u}function cd(t,e,n,r){var i=1-r;return i*(i*t+2*r*e)+r*r*n}function hd(t,e,n,r){return 2*((1-r)*(e-t)+r*(n-e))}function ud(t,e,n){var r=t+n-2*e;return 0===r?.5:(t-e)/r}function dd(t,e,n,r,i){var s=(e-t)*r+t,o=(n-e)*r+e,a=(o-s)*r+s;i[0]=t,i[1]=s,i[2]=a,i[3]=a,i[4]=o,i[5]=n}function fd(t,e,n,r,i,s,o,a,l){var c,h=.005,u=1/0;Zu[0]=o,Zu[1]=a;for(var d=0;d<1;d+=.05){Ju[0]=cd(t,n,i,d),Ju[1]=cd(e,r,s,d),(g=yh(Zu,Ju))<u&&(c=d,u=g)}u=1/0;for(var f=0;f<32&&!(h<Xu);f++){var p=c-h,m=c+h;Ju[0]=cd(t,n,i,p),Ju[1]=cd(e,r,s,p);var g=yh(Ju,Zu);if(p>=0&&g<u)c=p,u=g;else{Qu[0]=cd(t,n,i,m),Qu[1]=cd(e,r,s,m);var v=yh(Qu,Zu);m<=1&&v<u?(c=m,u=v):h*=.5}}return l&&(l[0]=cd(t,n,i,c),l[1]=cd(e,r,s,c)),$u(u)}function pd(t,e,n,r,i,s,o){for(var a=t,l=e,c=0,h=1/o,u=1;u<=o;u++){var d=u*h,f=cd(t,n,i,d),p=cd(e,r,s,d),m=f-a,g=p-l;c+=Math.sqrt(m*m+g*g),a=f,l=p}return c}var md=/cubic-bezier\(([0-9,\.e ]+)\)/;function gd(t){var e=t&&md.exec(t);if(e){var n=e[1].split(","),r=+Wc(n[0]),i=+Wc(n[1]),s=+Wc(n[2]),o=+Wc(n[3]);if(isNaN(r+i+s+o))return;var a=[];return function(t){return t<=0?0:t>=1?1:id(0,r,s,1,t,a)&&nd(0,i,o,1,a[0])}}}const vd=function(){function t(t){this._inited=!1,this._startTime=0,this._pausedTime=0,this._paused=!1,this._life=t.life||1e3,this._delay=t.delay||0,this.loop=t.loop||!1,this.onframe=t.onframe||nh,this.ondestroy=t.ondestroy||nh,this.onrestart=t.onrestart||nh,t.easing&&this.setEasing(t.easing)}return t.prototype.step=function(t,e){if(this._inited||(this._startTime=t+this._delay,this._inited=!0),!this._paused){var n=this._life,r=t-this._startTime-this._pausedTime,i=r/n;i<0&&(i=0),i=Math.min(i,1);var s=this.easingFunc,o=s?s(i):i;if(this.onframe(o),1===i){if(!this.loop)return!0;var a=r%n;this._startTime=t-a,this._pausedTime=0,this.onrestart()}return!1}this._pausedTime+=e},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1},t.prototype.setEasing=function(t){this.easing=t,this.easingFunc=Ac(t)?t:Wu[t]||gd(t)},t}();var yd=function(t){this.value=t},bd=function(){function t(){this._len=0}return t.prototype.insert=function(t){var e=new yd(t);return this.insertEntry(e),e},t.prototype.insertEntry=function(t){this.head?(this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t):this.head=this.tail=t,this._len++},t.prototype.remove=function(t){var e=t.prev,n=t.next;e?e.next=n:this.head=n,n?n.prev=e:this.tail=e,t.next=t.prev=null,this._len--},t.prototype.len=function(){return this._len},t.prototype.clear=function(){this.head=this.tail=null,this._len=0},t}();const xd=function(){function t(t){this._list=new bd,this._maxSize=10,this._map={},this._maxSize=t}return t.prototype.put=function(t,e){var n=this._list,r=this._map,i=null;if(null==r[t]){var s=n.len(),o=this._lastRemovedEntry;if(s>=this._maxSize&&s>0){var a=n.head;n.remove(a),delete r[a.key],i=a.value,this._lastRemovedEntry=a}o?o.value=e:o=new yd(e),o.key=t,n.insertEntry(o),r[t]=o}return i},t.prototype.get=function(t){var e=this._map[t],n=this._list;if(null!=e)return e!==n.tail&&(n.remove(e),n.insertEntry(e)),e.value},t.prototype.clear=function(){this._list.clear(),this._map={}},t.prototype.len=function(){return this._list.len()},t}();var wd={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ed(t){return(t=Math.round(t))<0?0:t>255?255:t}function _d(t){return t<0?0:t>1?1:t}function Sd(t){var e=t;return e.length&&"%"===e.charAt(e.length-1)?Ed(parseFloat(e)/100*255):Ed(parseInt(e,10))}function Td(t){var e=t;return e.length&&"%"===e.charAt(e.length-1)?_d(parseFloat(e)/100):_d(parseFloat(e))}function kd(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}function Ad(t,e,n){return t+(e-t)*n}function Cd(t,e,n,r,i){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t}function Rd(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}var Md=new xd(20),Id=null;function Dd(t,e){Id&&Rd(Id,e),Id=Md.put(t,Id||e.slice())}function Od(t,e){if(t){e=e||[];var n=Md.get(t);if(n)return Rd(e,n);var r=(t+="").replace(/ /g,"").toLowerCase();if(r in wd)return Rd(e,wd[r]),Dd(t,e),e;var i,s=r.length;if("#"===r.charAt(0))return 4===s||5===s?(i=parseInt(r.slice(1,4),16))>=0&&i<=4095?(Cd(e,(3840&i)>>4|(3840&i)>>8,240&i|(240&i)>>4,15&i|(15&i)<<4,5===s?parseInt(r.slice(4),16)/15:1),Dd(t,e),e):void Cd(e,0,0,0,1):7===s||9===s?(i=parseInt(r.slice(1,7),16))>=0&&i<=16777215?(Cd(e,(16711680&i)>>16,(65280&i)>>8,255&i,9===s?parseInt(r.slice(7),16)/255:1),Dd(t,e),e):void Cd(e,0,0,0,1):void 0;var o=r.indexOf("("),a=r.indexOf(")");if(-1!==o&&a+1===s){var l=r.substr(0,o),c=r.substr(o+1,a-(o+1)).split(","),h=1;switch(l){case"rgba":if(4!==c.length)return 3===c.length?Cd(e,+c[0],+c[1],+c[2],1):Cd(e,0,0,0,1);h=Td(c.pop());case"rgb":return c.length>=3?(Cd(e,Sd(c[0]),Sd(c[1]),Sd(c[2]),3===c.length?h:Td(c[3])),Dd(t,e),e):void Cd(e,0,0,0,1);case"hsla":return 4!==c.length?void Cd(e,0,0,0,1):(c[3]=Td(c[3]),Pd(c,e),Dd(t,e),e);case"hsl":return 3!==c.length?void Cd(e,0,0,0,1):(Pd(c,e),Dd(t,e),e);default:return}}Cd(e,0,0,0,1)}}function Pd(t,e){var n=(parseFloat(t[0])%360+360)%360/360,r=Td(t[1]),i=Td(t[2]),s=i<=.5?i*(r+1):i+r-i*r,o=2*i-s;return Cd(e=e||[],Ed(255*kd(o,s,n+1/3)),Ed(255*kd(o,s,n)),Ed(255*kd(o,s,n-1/3)),1),4===t.length&&(e[3]=t[3]),e}function Ld(t,e){var n=Od(t);if(n){for(var r=0;r<3;r++)n[r]=e<0?n[r]*(1-e)|0:(255-n[r])*e+n[r]|0,n[r]>255?n[r]=255:n[r]<0&&(n[r]=0);return Vd(n,4===n.length?"rgba":"rgb")}}function Fd(t,e,n){if(e&&e.length&&t>=0&&t<=1){n=n||[];var r=t*(e.length-1),i=Math.floor(r),s=Math.ceil(r),o=e[i],a=e[s],l=r-i;return n[0]=Ed(Ad(o[0],a[0],l)),n[1]=Ed(Ad(o[1],a[1],l)),n[2]=Ed(Ad(o[2],a[2],l)),n[3]=_d(Ad(o[3],a[3],l)),n}}function Nd(t,e,n){if(e&&e.length&&t>=0&&t<=1){var r=t*(e.length-1),i=Math.floor(r),s=Math.ceil(r),o=Od(e[i]),a=Od(e[s]),l=r-i,c=Vd([Ed(Ad(o[0],a[0],l)),Ed(Ad(o[1],a[1],l)),Ed(Ad(o[2],a[2],l)),_d(Ad(o[3],a[3],l))],"rgba");return n?{color:c,leftIndex:i,rightIndex:s,value:r}:c}}function Bd(t,e,n,r){var i,s=Od(t);if(t)return s=function(t){if(t){var e,n,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),l=a-o,c=(a+o)/2;if(0===l)e=0,n=0;else{n=c<.5?l/(a+o):l/(2-a-o);var h=((a-r)/6+l/2)/l,u=((a-i)/6+l/2)/l,d=((a-s)/6+l/2)/l;r===a?e=d-u:i===a?e=1/3+h-d:s===a&&(e=2/3+u-h),e<0&&(e+=1),e>1&&(e-=1)}var f=[360*e,n,c];return null!=t[3]&&f.push(t[3]),f}}(s),null!=e&&(s[0]=(i=e,(i=Math.round(i))<0?0:i>360?360:i)),null!=n&&(s[1]=Td(n)),null!=r&&(s[2]=Td(r)),Vd(Pd(s),"rgba")}function Ud(t,e){var n=Od(t);if(n&&null!=e)return n[3]=_d(e),Vd(n,"rgba")}function Vd(t,e){if(t&&t.length){var n=t[0]+","+t[1]+","+t[2];return"rgba"!==e&&"hsva"!==e&&"hsla"!==e||(n+=","+t[3]),e+"("+n+")"}}function jd(t,e){var n=Od(t);return n?(.299*n[0]+.587*n[1]+.114*n[2])*n[3]/255+(1-n[3])*e:0}var zd=Math.round;function Gd(t){var e;if(t&&"transparent"!==t){if("string"==typeof t&&t.indexOf("rgba")>-1){var n=Od(t);n&&(t="rgb("+n[0]+","+n[1]+","+n[2]+")",e=n[3])}}else t="none";return{color:t,opacity:null==e?1:e}}var Wd=1e-4;function Hd(t){return t<Wd&&t>-Wd}function $d(t){return zd(1e3*t)/1e3}function Yd(t){return zd(1e4*t)/1e4}var Xd={left:"start",right:"end",center:"middle",middle:"middle"};function qd(t){return t&&!!t.image}function Kd(t){return qd(t)||function(t){return t&&!!t.svgElement}(t)}function Zd(t){return"linear"===t.type}function Jd(t){return"radial"===t.type}function Qd(t){return t&&("linear"===t.type||"radial"===t.type)}function tf(t){return"url(#"+t+")"}function ef(t){var e=t.getGlobalScale(),n=Math.max(e[0],e[1]);return Math.max(Math.ceil(Math.log(n)/Math.log(10)),1)}function nf(t){var e=t.x||0,n=t.y||0,r=(t.rotation||0)*rh,i=Uc(t.scaleX,1),s=Uc(t.scaleY,1),o=t.skewX||0,a=t.skewY||0,l=[];return(e||n)&&l.push("translate("+e+"px,"+n+"px)"),r&&l.push("rotate("+r+")"),1===i&&1===s||l.push("scale("+i+","+s+")"),(o||a)&&l.push("skew("+zd(o*rh)+"deg, "+zd(a*rh)+"deg)"),l.join(" ")}var rf=jl.hasGlobalWindow&&Ac(window.btoa)?function(t){return window.btoa(unescape(encodeURIComponent(t)))}:"undefined"!=typeof Buffer?function(t){return Buffer.from(t).toString("base64")}:function(t){return null},sf=Array.prototype.slice;function of(t,e,n){return(e-t)*n+t}function af(t,e,n,r){for(var i=e.length,s=0;s<i;s++)t[s]=of(e[s],n[s],r);return t}function lf(t,e,n,r){for(var i=e.length,s=0;s<i;s++)t[s]=e[s]+n[s]*r;return t}function cf(t,e,n,r){for(var i=e.length,s=i&&e[0].length,o=0;o<i;o++){t[o]||(t[o]=[]);for(var a=0;a<s;a++)t[o][a]=e[o][a]+n[o][a]*r}return t}function hf(t,e){for(var n=t.length,r=e.length,i=n>r?e:t,s=Math.min(n,r),o=i[s-1]||{color:[0,0,0,0],offset:0},a=s;a<Math.max(n,r);a++)i.push({offset:o.offset,color:o.color.slice()})}function uf(t,e,n){var r=t,i=e;if(r.push&&i.push){var s=r.length,o=i.length;if(s!==o)if(s>o)r.length=o;else for(var a=s;a<o;a++)r.push(1===n?i[a]:sf.call(i[a]));var l=r[0]&&r[0].length;for(a=0;a<r.length;a++)if(1===n)isNaN(r[a])&&(r[a]=i[a]);else for(var c=0;c<l;c++)isNaN(r[a][c])&&(r[a][c]=i[a][c])}}function df(t){if(vc(t)){var e=t.length;if(vc(t[0])){for(var n=[],r=0;r<e;r++)n.push(sf.call(t[r]));return n}return sf.call(t)}return t}function ff(t){return t[0]=Math.floor(t[0])||0,t[1]=Math.floor(t[1])||0,t[2]=Math.floor(t[2])||0,t[3]=null==t[3]?1:t[3],"rgba("+t.join(",")+")"}function pf(t){return 4===t||5===t}function mf(t){return 1===t||2===t}var gf=[0,0,0,0],vf=function(){function t(t){this.keyframes=[],this.discrete=!1,this._invalid=!1,this._needsSort=!1,this._lastFr=0,this._lastFrP=0,this.propName=t}return t.prototype.isFinished=function(){return this._finished},t.prototype.setFinished=function(){this._finished=!0,this._additiveTrack&&this._additiveTrack.setFinished()},t.prototype.needsAnimate=function(){return this.keyframes.length>=1},t.prototype.getAdditiveTrack=function(){return this._additiveTrack},t.prototype.addKeyframe=function(t,e,n){this._needsSort=!0;var r=this.keyframes,i=r.length,s=!1,o=6,a=e;if(vc(e)){var l=function(t){return vc(t&&t[0])?2:1}(e);o=l,(1===l&&!Mc(e[0])||2===l&&!Mc(e[0][0]))&&(s=!0)}else if(Mc(e)&&!Nc(e))o=0;else if(Cc(e))if(isNaN(+e)){var c=Od(e);c&&(a=c,o=3)}else o=0;else if(Lc(e)){var h=dc({},a);h.colorStops=bc(e.colorStops,(function(t){return{offset:t.offset,color:Od(t.color)}})),Zd(e)?o=4:Jd(e)&&(o=5),a=h}0===i?this.valType=o:o===this.valType&&6!==o||(s=!0),this.discrete=this.discrete||s;var u={time:t,value:a,rawValue:e,percent:0};return n&&(u.easing=n,u.easingFunc=Ac(n)?n:Wu[n]||gd(n)),r.push(u),u},t.prototype.prepare=function(t,e){var n=this.keyframes;this._needsSort&&n.sort((function(t,e){return t.time-e.time}));for(var r=this.valType,i=n.length,s=n[i-1],o=this.discrete,a=mf(r),l=pf(r),c=0;c<i;c++){var h=n[c],u=h.value,d=s.value;h.percent=h.time/t,o||(a&&c!==i-1?uf(u,d,r):l&&hf(u.colorStops,d.colorStops))}if(!o&&5!==r&&e&&this.needsAnimate()&&e.needsAnimate()&&r===e.valType&&!e._finished){this._additiveTrack=e;var f=n[0].value;for(c=0;c<i;c++)0===r?n[c].additiveValue=n[c].value-f:3===r?n[c].additiveValue=lf([],n[c].value,f,-1):mf(r)&&(n[c].additiveValue=1===r?lf([],n[c].value,f,-1):cf([],n[c].value,f,-1))}},t.prototype.step=function(t,e){if(!this._finished){this._additiveTrack&&this._additiveTrack._finished&&(this._additiveTrack=null);var n,r,i,s=null!=this._additiveTrack,o=s?"additiveValue":"value",a=this.valType,l=this.keyframes,c=l.length,h=this.propName,u=3===a,d=this._lastFr,f=Math.min;if(1===c)r=i=l[0];else{if(e<0)n=0;else if(e<this._lastFrP){for(n=f(d+1,c-1);n>=0&&!(l[n].percent<=e);n--);n=f(n,c-2)}else{for(n=d;n<c&&!(l[n].percent>e);n++);n=f(n-1,c-2)}i=l[n+1],r=l[n]}if(r&&i){this._lastFr=n,this._lastFrP=e;var p=i.percent-r.percent,m=0===p?1:f((e-r.percent)/p,1);i.easingFunc&&(m=i.easingFunc(m));var g=s?this._additiveValue:u?gf:t[h];if(!mf(a)&&!u||g||(g=this._additiveValue=[]),this.discrete)t[h]=m<1?r.rawValue:i.rawValue;else if(mf(a))1===a?af(g,r[o],i[o],m):function(t,e,n,r){for(var i=e.length,s=i&&e[0].length,o=0;o<i;o++){t[o]||(t[o]=[]);for(var a=0;a<s;a++)t[o][a]=of(e[o][a],n[o][a],r)}}(g,r[o],i[o],m);else if(pf(a)){var v=r[o],y=i[o],b=4===a;t[h]={type:b?"linear":"radial",x:of(v.x,y.x,m),y:of(v.y,y.y,m),colorStops:bc(v.colorStops,(function(t,e){var n=y.colorStops[e];return{offset:of(t.offset,n.offset,m),color:ff(af([],t.color,n.color,m))}})),global:y.global},b?(t[h].x2=of(v.x2,y.x2,m),t[h].y2=of(v.y2,y.y2,m)):t[h].r=of(v.r,y.r,m)}else if(u)af(g,r[o],i[o],m),s||(t[h]=ff(g));else{var x=of(r[o],i[o],m);s?this._additiveValue=x:t[h]=x}s&&this._addToTarget(t)}}},t.prototype._addToTarget=function(t){var e=this.valType,n=this.propName,r=this._additiveValue;0===e?t[n]=t[n]+r:3===e?(Od(t[n],gf),lf(gf,gf,r,1),t[n]=ff(gf)):1===e?lf(t[n],t[n],r,1):2===e&&cf(t[n],t[n],r,1)},t}(),yf=function(){function t(t,e,n,r){this._tracks={},this._trackKeys=[],this._maxTime=0,this._started=0,this._clip=null,this._target=t,this._loop=e,e&&r?lc("Can' use additive animation on looped animation."):(this._additiveAnimators=r,this._allowDiscrete=n)}return t.prototype.getMaxTime=function(){return this._maxTime},t.prototype.getDelay=function(){return this._delay},t.prototype.getLoop=function(){return this._loop},t.prototype.getTarget=function(){return this._target},t.prototype.changeTarget=function(t){this._target=t},t.prototype.when=function(t,e,n){return this.whenWithKeys(t,e,_c(e),n)},t.prototype.whenWithKeys=function(t,e,n,r){for(var i=this._tracks,s=0;s<n.length;s++){var o=n[s],a=i[o];if(!a){a=i[o]=new vf(o);var l=void 0,c=this._getAdditiveTrack(o);if(c){var h=c.keyframes,u=h[h.length-1];l=u&&u.value,3===c.valType&&l&&(l=ff(l))}else l=this._target[o];if(null==l)continue;t>0&&a.addKeyframe(0,df(l),r),this._trackKeys.push(o)}a.addKeyframe(t,df(e[o]),r)}return this._maxTime=Math.max(this._maxTime,t),this},t.prototype.pause=function(){this._clip.pause(),this._paused=!0},t.prototype.resume=function(){this._clip.resume(),this._paused=!1},t.prototype.isPaused=function(){return!!this._paused},t.prototype.duration=function(t){return this._maxTime=t,this._force=!0,this},t.prototype._doneCallback=function(){this._setTracksFinished(),this._clip=null;var t=this._doneCbs;if(t)for(var e=t.length,n=0;n<e;n++)t[n].call(this)},t.prototype._abortedCallback=function(){this._setTracksFinished();var t=this.animation,e=this._abortedCbs;if(t&&t.removeClip(this._clip),this._clip=null,e)for(var n=0;n<e.length;n++)e[n].call(this)},t.prototype._setTracksFinished=function(){for(var t=this._tracks,e=this._trackKeys,n=0;n<e.length;n++)t[e[n]].setFinished()},t.prototype._getAdditiveTrack=function(t){var e,n=this._additiveAnimators;if(n)for(var r=0;r<n.length;r++){var i=n[r].getTrack(t);i&&(e=i)}return e},t.prototype.start=function(t){if(!(this._started>0)){this._started=1;for(var e=this,n=[],r=this._maxTime||0,i=0;i<this._trackKeys.length;i++){var s=this._trackKeys[i],o=this._tracks[s],a=this._getAdditiveTrack(s),l=o.keyframes,c=l.length;if(o.prepare(r,a),o.needsAnimate())if(!this._allowDiscrete&&o.discrete){var h=l[c-1];h&&(e._target[o.propName]=h.rawValue),o.setFinished()}else n.push(o)}if(n.length||this._force){var u=new vd({life:r,loop:this._loop,delay:this._delay||0,onframe:function(t){e._started=2;var r=e._additiveAnimators;if(r){for(var i=!1,s=0;s<r.length;s++)if(r[s]._clip){i=!0;break}i||(e._additiveAnimators=null)}for(s=0;s<n.length;s++)n[s].step(e._target,t);var o=e._onframeCbs;if(o)for(s=0;s<o.length;s++)o[s](e._target,t)},ondestroy:function(){e._doneCallback()}});this._clip=u,this.animation&&this.animation.addClip(u),t&&u.setEasing(t)}else this._doneCallback();return this}},t.prototype.stop=function(t){if(this._clip){var e=this._clip;t&&e.onframe(1),this._abortedCallback()}},t.prototype.delay=function(t){return this._delay=t,this},t.prototype.during=function(t){return t&&(this._onframeCbs||(this._onframeCbs=[]),this._onframeCbs.push(t)),this},t.prototype.done=function(t){return t&&(this._doneCbs||(this._doneCbs=[]),this._doneCbs.push(t)),this},t.prototype.aborted=function(t){return t&&(this._abortedCbs||(this._abortedCbs=[]),this._abortedCbs.push(t)),this},t.prototype.getClip=function(){return this._clip},t.prototype.getTrack=function(t){return this._tracks[t]},t.prototype.getTracks=function(){var t=this;return bc(this._trackKeys,(function(e){return t._tracks[e]}))},t.prototype.stopTracks=function(t,e){if(!t.length||!this._clip)return!0;for(var n=this._tracks,r=this._trackKeys,i=0;i<t.length;i++){var s=n[t[i]];s&&!s.isFinished()&&(e?s.step(this._target,1):1===this._started&&s.step(this._target,0),s.setFinished())}var o=!0;for(i=0;i<r.length;i++)if(!n[r[i]].isFinished()){o=!1;break}return o&&this._abortedCallback(),o},t.prototype.saveTo=function(t,e,n){if(t){e=e||this._trackKeys;for(var r=0;r<e.length;r++){var i=e[r],s=this._tracks[i];if(s&&!s.isFinished()){var o=s.keyframes,a=o[n?0:o.length-1];a&&(t[i]=df(a.rawValue))}}}},t.prototype.__changeFinalValue=function(t,e){e=e||_c(t);for(var n=0;n<e.length;n++){var r=e[n],i=this._tracks[r];if(i){var s=i.keyframes;if(s.length>1){var o=s.pop();i.addKeyframe(o.time,t[r]),i.prepare(this._maxTime,i.getAdditiveTrack())}}}},t}();function bf(){return(new Date).getTime()}const xf=function(t){function e(e){var n=t.call(this)||this;return n._running=!1,n._time=0,n._pausedTime=0,n._pauseStart=0,n._paused=!1,e=e||{},n.stage=e.stage||{},n}return sh(e,t),e.prototype.addClip=function(t){t.animation&&this.removeClip(t),this._head?(this._tail.next=t,t.prev=this._tail,t.next=null,this._tail=t):this._head=this._tail=t,t.animation=this},e.prototype.addAnimator=function(t){t.animation=this;var e=t.getClip();e&&this.addClip(e)},e.prototype.removeClip=function(t){if(t.animation){var e=t.prev,n=t.next;e?e.next=n:this._head=n,n?n.prev=e:this._tail=e,t.next=t.prev=t.animation=null}},e.prototype.removeAnimator=function(t){var e=t.getClip();e&&this.removeClip(e),t.animation=null},e.prototype.update=function(t){for(var e=bf()-this._pausedTime,n=e-this._time,r=this._head;r;){var i=r.next;r.step(e,n)?(r.ondestroy(),this.removeClip(r),r=i):r=i}this._time=e,t||(this.trigger("frame",n),this.stage.update&&this.stage.update())},e.prototype._startLoop=function(){var t=this;this._running=!0,zu((function e(){t._running&&(zu(e),!t._paused&&t.update())}))},e.prototype.start=function(){this._running||(this._time=bf(),this._pausedTime=0,this._startLoop())},e.prototype.stop=function(){this._running=!1},e.prototype.pause=function(){this._paused||(this._pauseStart=bf(),this._paused=!0)},e.prototype.resume=function(){this._paused&&(this._pausedTime+=bf()-this._pauseStart,this._paused=!1)},e.prototype.clear=function(){for(var t=this._head;t;){var e=t.next;t.prev=t.next=t.animation=null,t=e}this._head=this._tail=null},e.prototype.isFinished=function(){return null==this._head},e.prototype.animate=function(t,e){e=e||{},this.start();var n=new yf(t,e.loop);return this.addAnimator(n),n},e}(kh);var wf,Ef,_f=jl.domSupported,Sf=(Ef={pointerdown:1,pointerup:1,pointermove:1,pointerout:1},{mouse:wf=["click","dblclick","mousewheel","wheel","mouseout","mouseup","mousedown","mousemove","contextmenu"],touch:["touchstart","touchend","touchmove"],pointer:bc(wf,(function(t){var e=t.replace("mouse","pointer");return Ef.hasOwnProperty(e)?e:t}))}),Tf=["mousemove","mouseup"],kf=["pointermove","pointerup"],Af=!1;function Cf(t){var e=t.pointerType;return"pen"===e||"touch"===e}function Rf(t){t&&(t.zrByTouch=!0)}function Mf(t,e){for(var n=e,r=!1;n&&9!==n.nodeType&&!(r=n.domBelongToZr||n!==e&&n===t.painterRoot);)n=n.parentNode;return r}var If=function(t,e){this.stopPropagation=nh,this.stopImmediatePropagation=nh,this.preventDefault=nh,this.type=e.type,this.target=this.currentTarget=t.dom,this.pointerType=e.pointerType,this.clientX=e.clientX,this.clientY=e.clientY},Df={mousedown:function(t){t=Wh(this.dom,t),this.__mayPointerCapture=[t.zrX,t.zrY],this.trigger("mousedown",t)},mousemove:function(t){t=Wh(this.dom,t);var e=this.__mayPointerCapture;!e||t.zrX===e[0]&&t.zrY===e[1]||this.__togglePointerCapture(!0),this.trigger("mousemove",t)},mouseup:function(t){t=Wh(this.dom,t),this.__togglePointerCapture(!1),this.trigger("mouseup",t)},mouseout:function(t){Mf(this,(t=Wh(this.dom,t)).toElement||t.relatedTarget)||(this.__pointerCapturing&&(t.zrEventControl="no_globalout"),this.trigger("mouseout",t))},wheel:function(t){Af=!0,t=Wh(this.dom,t),this.trigger("mousewheel",t)},mousewheel:function(t){Af||(t=Wh(this.dom,t),this.trigger("mousewheel",t))},touchstart:function(t){Rf(t=Wh(this.dom,t)),this.__lastTouchMoment=new Date,this.handler.processGesture(t,"start"),Df.mousemove.call(this,t),Df.mousedown.call(this,t)},touchmove:function(t){Rf(t=Wh(this.dom,t)),this.handler.processGesture(t,"change"),Df.mousemove.call(this,t)},touchend:function(t){Rf(t=Wh(this.dom,t)),this.handler.processGesture(t,"end"),Df.mouseup.call(this,t),+new Date-+this.__lastTouchMoment<300&&Df.click.call(this,t)},pointerdown:function(t){Df.mousedown.call(this,t)},pointermove:function(t){Cf(t)||Df.mousemove.call(this,t)},pointerup:function(t){Df.mouseup.call(this,t)},pointerout:function(t){Cf(t)||Df.mouseout.call(this,t)}};yc(["click","dblclick","contextmenu"],(function(t){Df[t]=function(e){e=Wh(this.dom,e),this.trigger(t,e)}}));var Of={pointermove:function(t){Cf(t)||Of.mousemove.call(this,t)},pointerup:function(t){Of.mouseup.call(this,t)},mousemove:function(t){this.trigger("mousemove",t)},mouseup:function(t){var e=this.__pointerCapturing;this.__togglePointerCapture(!1),this.trigger("mouseup",t),e&&(t.zrEventControl="only_globalout",this.trigger("mouseout",t))}};function Pf(t,e){var n=e.domHandlers;jl.pointerEventsSupported?yc(Sf.pointer,(function(r){Ff(e,r,(function(e){n[r].call(t,e)}))})):(jl.touchEventsSupported&&yc(Sf.touch,(function(r){Ff(e,r,(function(i){n[r].call(t,i),function(t){t.touching=!0,null!=t.touchTimer&&(clearTimeout(t.touchTimer),t.touchTimer=null),t.touchTimer=setTimeout((function(){t.touching=!1,t.touchTimer=null}),700)}(e)}))})),yc(Sf.mouse,(function(r){Ff(e,r,(function(i){i=Gh(i),e.touching||n[r].call(t,i)}))})))}function Lf(t,e){function n(n){Ff(e,n,(function(r){r=Gh(r),Mf(t,r.target)||(r=function(t,e){return Wh(t.dom,new If(t,e),!0)}(t,r),e.domHandlers[n].call(t,r))}),{capture:!0})}jl.pointerEventsSupported?yc(kf,n):jl.touchEventsSupported||yc(Tf,n)}function Ff(t,e,n,r){t.mounted[e]=n,t.listenerOpts[e]=r,Hh(t.domTarget,e,n,r)}function Nf(t){var e,n,r,i,s=t.mounted;for(var o in s)s.hasOwnProperty(o)&&(e=t.domTarget,n=o,r=s[o],i=t.listenerOpts[o],e.removeEventListener(n,r,i));t.mounted={}}var Bf=function(t,e){this.mounted={},this.listenerOpts={},this.touching=!1,this.domTarget=t,this.domHandlers=e};const Uf=function(t){function e(e,n){var r=t.call(this)||this;return r.__pointerCapturing=!1,r.dom=e,r.painterRoot=n,r._localHandlerScope=new Bf(e,Df),_f&&(r._globalHandlerScope=new Bf(document,Of)),Pf(r,r._localHandlerScope),r}return sh(e,t),e.prototype.dispose=function(){Nf(this._localHandlerScope),_f&&Nf(this._globalHandlerScope)},e.prototype.setCursor=function(t){this.dom.style&&(this.dom.style.cursor=t||"default")},e.prototype.__togglePointerCapture=function(t){if(this.__mayPointerCapture=null,_f&&+this.__pointerCapturing^+t){this.__pointerCapturing=t;var e=this._globalHandlerScope;t?Lf(this,e):Nf(e)}},e}(kh);var Vf=1;jl.hasGlobalWindow&&(Vf=Math.max(window.devicePixelRatio||window.screen&&window.screen.deviceXDPI/window.screen.logicalXDPI||1,1));var jf=Vf,zf="#333",Gf="#ccc",Wf=Jh,Hf=5e-5;function $f(t){return t>Hf||t<-5e-5}var Yf=[],Xf=[],qf=[1,0,0,1,0,0],Kf=Math.abs,Zf=function(){function t(){}var e;return t.prototype.getLocalTransform=function(e){return t.getLocalTransform(this,e)},t.prototype.setPosition=function(t){this.x=t[0],this.y=t[1]},t.prototype.setScale=function(t){this.scaleX=t[0],this.scaleY=t[1]},t.prototype.setSkew=function(t){this.skewX=t[0],this.skewY=t[1]},t.prototype.setOrigin=function(t){this.originX=t[0],this.originY=t[1]},t.prototype.needLocalTransform=function(){return $f(this.rotation)||$f(this.x)||$f(this.y)||$f(this.scaleX-1)||$f(this.scaleY-1)||$f(this.skewX)||$f(this.skewY)},t.prototype.updateTransform=function(){var t=this.parent&&this.parent.transform,e=this.needLocalTransform(),n=this.transform;e||t?(n=n||[1,0,0,1,0,0],e?this.getLocalTransform(n):Wf(n),t&&(e?tu(n,t,n):Qh(n,t)),this.transform=n,this._resolveGlobalScaleRatio(n)):n&&(Wf(n),this.invTransform=null)},t.prototype._resolveGlobalScaleRatio=function(t){var e=this.globalScaleRatio;if(null!=e&&1!==e){this.getGlobalScale(Yf);var n=Yf[0]<0?-1:1,r=Yf[1]<0?-1:1,i=((Yf[0]-n)*e+n)/Yf[0]||0,s=((Yf[1]-r)*e+r)/Yf[1]||0;t[0]*=i,t[1]*=i,t[2]*=s,t[3]*=s}this.invTransform=this.invTransform||[1,0,0,1,0,0],iu(this.invTransform,t)},t.prototype.getComputedTransform=function(){for(var t=this,e=[];t;)e.push(t),t=t.parent;for(;t=e.pop();)t.updateTransform();return this.transform},t.prototype.setLocalTransform=function(t){if(t){var e=t[0]*t[0]+t[1]*t[1],n=t[2]*t[2]+t[3]*t[3],r=Math.atan2(t[1],t[0]),i=Math.PI/2+r-Math.atan2(t[3],t[2]);n=Math.sqrt(n)*Math.cos(i),e=Math.sqrt(e),this.skewX=i,this.skewY=0,this.rotation=-r,this.x=+t[4],this.y=+t[5],this.scaleX=e,this.scaleY=n,this.originX=0,this.originY=0}},t.prototype.decomposeTransform=function(){if(this.transform){var t=this.parent,e=this.transform;t&&t.transform&&(tu(Xf,t.invTransform,e),e=Xf);var n=this.originX,r=this.originY;(n||r)&&(qf[4]=n,qf[5]=r,tu(Xf,e,qf),Xf[4]-=n,Xf[5]-=r,e=Xf),this.setLocalTransform(e)}},t.prototype.getGlobalScale=function(t){var e=this.transform;return t=t||[],e?(t[0]=Math.sqrt(e[0]*e[0]+e[1]*e[1]),t[1]=Math.sqrt(e[2]*e[2]+e[3]*e[3]),e[0]<0&&(t[0]=-t[0]),e[3]<0&&(t[1]=-t[1]),t):(t[0]=1,t[1]=1,t)},t.prototype.transformCoordToLocal=function(t,e){var n=[t,e],r=this.invTransform;return r&&xh(n,n,r),n},t.prototype.transformCoordToGlobal=function(t,e){var n=[t,e],r=this.transform;return r&&xh(n,n,r),n},t.prototype.getLineScale=function(){var t=this.transform;return t&&Kf(t[0]-1)>1e-10&&Kf(t[3]-1)>1e-10?Math.sqrt(Kf(t[0]*t[3]-t[2]*t[1])):1},t.prototype.copyTransform=function(t){Qf(this,t)},t.getLocalTransform=function(t,e){e=e||[];var n=t.originX||0,r=t.originY||0,i=t.scaleX,s=t.scaleY,o=t.anchorX,a=t.anchorY,l=t.rotation||0,c=t.x,h=t.y,u=t.skewX?Math.tan(t.skewX):0,d=t.skewY?Math.tan(-t.skewY):0;if(n||r||o||a){var f=n+o,p=r+a;e[4]=-f*i-u*p*s,e[5]=-p*s-d*f*i}else e[4]=e[5]=0;return e[0]=i,e[3]=s,e[1]=d*i,e[2]=u*s,l&&nu(e,e,l),e[4]+=n+c,e[5]+=r+h,e},t.initDefaultProps=((e=t.prototype).scaleX=e.scaleY=e.globalScaleRatio=1,void(e.x=e.y=e.originX=e.originY=e.skewX=e.skewY=e.rotation=e.anchorX=e.anchorY=0)),t}(),Jf=["x","y","originX","originY","anchorX","anchorY","rotation","scaleX","scaleY","skewX","skewY"];function Qf(t,e){for(var n=0;n<Jf.length;n++){var r=Jf[n];t[r]=e[r]}}const tp=Zf;var ep={};function np(t,e){var n=ep[e=e||Wl];n||(n=ep[e]=new xd(500));var r=n.get(t);return null==r&&(r=Xl.measureText(t,e).width,n.put(t,r)),r}function rp(t,e,n,r){var i=np(t,e),s=ap(e),o=sp(0,i,n),a=op(0,s,r);return new gu(o,a,i,s)}function ip(t,e,n,r){var i=((t||"")+"").split("\n");if(1===i.length)return rp(i[0],e,n,r);for(var s=new gu(0,0,0,0),o=0;o<i.length;o++){var a=rp(i[o],e,n,r);0===o?s.copy(a):s.union(a)}return s}function sp(t,e,n){return"right"===n?t-=e:"center"===n&&(t-=e/2),t}function op(t,e,n){return"middle"===n?t-=e/2:"bottom"===n&&(t-=e),t}function ap(t){return np("国",t)}function lp(t,e){return"string"==typeof t?t.lastIndexOf("%")>=0?parseFloat(t)/100*e:parseFloat(t):t}function cp(t,e,n){var r=e.position||"inside",i=null!=e.distance?e.distance:5,s=n.height,o=n.width,a=s/2,l=n.x,c=n.y,h="left",u="top";if(r instanceof Array)l+=lp(r[0],n.width),c+=lp(r[1],n.height),h=null,u=null;else switch(r){case"left":l-=i,c+=a,h="right",u="middle";break;case"right":l+=i+o,c+=a,u="middle";break;case"top":l+=o/2,c-=i,h="center",u="bottom";break;case"bottom":l+=o/2,c+=s+i,h="center";break;case"inside":l+=o/2,c+=a,h="center",u="middle";break;case"insideLeft":l+=i,c+=a,u="middle";break;case"insideRight":l+=o-i,c+=a,h="right",u="middle";break;case"insideTop":l+=o/2,c+=i,h="center";break;case"insideBottom":l+=o/2,c+=s-i,h="center",u="bottom";break;case"insideTopLeft":l+=i,c+=i;break;case"insideTopRight":l+=o-i,c+=i,h="right";break;case"insideBottomLeft":l+=i,c+=s-i,u="bottom";break;case"insideBottomRight":l+=o-i,c+=s-i,h="right",u="bottom"}return(t=t||{}).x=l,t.y=c,t.align=h,t.verticalAlign=u,t}var hp="__zr_normal__",up=Jf.concat(["ignore"]),dp=xc(Jf,(function(t,e){return t[e]=!0,t}),{ignore:!1}),fp={},pp=new gu(0,0,0,0),mp=function(){function t(t){this.id=ac(),this.animators=[],this.currentStates=[],this.states={},this._init(t)}return t.prototype._init=function(t){this.attr(t)},t.prototype.drift=function(t,e,n){switch(this.draggable){case"horizontal":e=0;break;case"vertical":t=0}var r=this.transform;r||(r=this.transform=[1,0,0,1,0,0]),r[4]+=t,r[5]+=e,this.decomposeTransform(),this.markRedraw()},t.prototype.beforeUpdate=function(){},t.prototype.afterUpdate=function(){},t.prototype.update=function(){this.updateTransform(),this.__dirty&&this.updateInnerText()},t.prototype.updateInnerText=function(t){var e=this._textContent;if(e&&(!e.ignore||t)){this.textConfig||(this.textConfig={});var n=this.textConfig,r=n.local,i=e.innerTransformable,s=void 0,o=void 0,a=!1;i.parent=r?this:null;var l=!1;if(i.copyTransform(e),null!=n.position){var c=pp;n.layoutRect?c.copy(n.layoutRect):c.copy(this.getBoundingRect()),r||c.applyTransform(this.transform),this.calculateTextPosition?this.calculateTextPosition(fp,n,c):cp(fp,n,c),i.x=fp.x,i.y=fp.y,s=fp.align,o=fp.verticalAlign;var h=n.origin;if(h&&null!=n.rotation){var u=void 0,d=void 0;"center"===h?(u=.5*c.width,d=.5*c.height):(u=lp(h[0],c.width),d=lp(h[1],c.height)),l=!0,i.originX=-i.x+u+(r?0:c.x),i.originY=-i.y+d+(r?0:c.y)}}null!=n.rotation&&(i.rotation=n.rotation);var f=n.offset;f&&(i.x+=f[0],i.y+=f[1],l||(i.originX=-f[0],i.originY=-f[1]));var p=null==n.inside?"string"==typeof n.position&&n.position.indexOf("inside")>=0:n.inside,m=this._innerTextDefaultStyle||(this._innerTextDefaultStyle={}),g=void 0,v=void 0,y=void 0;p&&this.canBeInsideText()?(g=n.insideFill,v=n.insideStroke,null!=g&&"auto"!==g||(g=this.getInsideTextFill()),null!=v&&"auto"!==v||(v=this.getInsideTextStroke(g),y=!0)):(g=n.outsideFill,v=n.outsideStroke,null!=g&&"auto"!==g||(g=this.getOutsideFill()),null!=v&&"auto"!==v||(v=this.getOutsideStroke(g),y=!0)),(g=g||"#000")===m.fill&&v===m.stroke&&y===m.autoStroke&&s===m.align&&o===m.verticalAlign||(a=!0,m.fill=g,m.stroke=v,m.autoStroke=y,m.align=s,m.verticalAlign=o,e.setDefaultTextStyle(m)),e.__dirty|=Fu,a&&e.dirtyStyle(!0)}},t.prototype.canBeInsideText=function(){return!0},t.prototype.getInsideTextFill=function(){return"#fff"},t.prototype.getInsideTextStroke=function(t){return"#000"},t.prototype.getOutsideFill=function(){return this.__zr&&this.__zr.isDarkMode()?Gf:zf},t.prototype.getOutsideStroke=function(t){var e=this.__zr&&this.__zr.getBackgroundColor(),n="string"==typeof e&&Od(e);n||(n=[255,255,255,1]);for(var r=n[3],i=this.__zr.isDarkMode(),s=0;s<3;s++)n[s]=n[s]*r+(i?0:255)*(1-r);return n[3]=1,Vd(n,"rgba")},t.prototype.traverse=function(t,e){},t.prototype.attrKV=function(t,e){"textConfig"===t?this.setTextConfig(e):"textContent"===t?this.setTextContent(e):"clipPath"===t?this.setClipPath(e):"extra"===t?(this.extra=this.extra||{},dc(this.extra,e)):this[t]=e},t.prototype.hide=function(){this.ignore=!0,this.markRedraw()},t.prototype.show=function(){this.ignore=!1,this.markRedraw()},t.prototype.attr=function(t,e){if("string"==typeof t)this.attrKV(t,e);else if(Ic(t))for(var n=_c(t),r=0;r<n.length;r++){var i=n[r];this.attrKV(i,t[i])}return this.markRedraw(),this},t.prototype.saveCurrentToNormalState=function(t){this._innerSaveToNormal(t);for(var e=this._normalState,n=0;n<this.animators.length;n++){var r=this.animators[n],i=r.__fromStateTransition;if(!(r.getLoop()||i&&i!==hp)){var s=r.targetName,o=s?e[s]:e;r.saveTo(o)}}},t.prototype._innerSaveToNormal=function(t){var e=this._normalState;e||(e=this._normalState={}),t.textConfig&&!e.textConfig&&(e.textConfig=this.textConfig),this._savePrimaryToNormal(t,e,up)},t.prototype._savePrimaryToNormal=function(t,e,n){for(var r=0;r<n.length;r++){var i=n[r];null==t[i]||i in e||(e[i]=this[i])}},t.prototype.hasState=function(){return this.currentStates.length>0},t.prototype.getState=function(t){return this.states[t]},t.prototype.ensureState=function(t){var e=this.states;return e[t]||(e[t]={}),e[t]},t.prototype.clearStates=function(t){this.useState(hp,!1,t)},t.prototype.useState=function(t,e,n,r){var i=t===hp;if(this.hasState()||!i){var s=this.currentStates,o=this.stateTransition;if(!(pc(s,t)>=0)||!e&&1!==s.length){var a;if(this.stateProxy&&!i&&(a=this.stateProxy(t)),a||(a=this.states&&this.states[t]),a||i){i||this.saveCurrentToNormalState(a);var l=!!(a&&a.hoverLayer||r);l&&this._toggleHoverLayerFlag(!0),this._applyStateObj(t,a,this._normalState,e,!n&&!this.__inHover&&o&&o.duration>0,o);var c=this._textContent,h=this._textGuide;return c&&c.useState(t,e,n,l),h&&h.useState(t,e,n,l),i?(this.currentStates=[],this._normalState={}):e?this.currentStates.push(t):this.currentStates=[t],this._updateAnimationTargets(),this.markRedraw(),!l&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Fu),a}lc("State "+t+" not exists.")}}},t.prototype.useStates=function(t,e,n){if(t.length){var r=[],i=this.currentStates,s=t.length,o=s===i.length;if(o)for(var a=0;a<s;a++)if(t[a]!==i[a]){o=!1;break}if(o)return;for(a=0;a<s;a++){var l=t[a],c=void 0;this.stateProxy&&(c=this.stateProxy(l,t)),c||(c=this.states[l]),c&&r.push(c)}var h=r[s-1],u=!!(h&&h.hoverLayer||n);u&&this._toggleHoverLayerFlag(!0);var d=this._mergeStates(r),f=this.stateTransition;this.saveCurrentToNormalState(d),this._applyStateObj(t.join(","),d,this._normalState,!1,!e&&!this.__inHover&&f&&f.duration>0,f);var p=this._textContent,m=this._textGuide;p&&p.useStates(t,e,u),m&&m.useStates(t,e,u),this._updateAnimationTargets(),this.currentStates=t.slice(),this.markRedraw(),!u&&this.__inHover&&(this._toggleHoverLayerFlag(!1),this.__dirty&=~Fu)}else this.clearStates()},t.prototype._updateAnimationTargets=function(){for(var t=0;t<this.animators.length;t++){var e=this.animators[t];e.targetName&&e.changeTarget(this[e.targetName])}},t.prototype.removeState=function(t){var e=pc(this.currentStates,t);if(e>=0){var n=this.currentStates.slice();n.splice(e,1),this.useStates(n)}},t.prototype.replaceState=function(t,e,n){var r=this.currentStates.slice(),i=pc(r,t),s=pc(r,e)>=0;i>=0?s?r.splice(i,1):r[i]=e:n&&!s&&r.push(e),this.useStates(r)},t.prototype.toggleState=function(t,e){e?this.useState(t,!0):this.removeState(t)},t.prototype._mergeStates=function(t){for(var e,n={},r=0;r<t.length;r++){var i=t[r];dc(n,i),i.textConfig&&dc(e=e||{},i.textConfig)}return e&&(n.textConfig=e),n},t.prototype._applyStateObj=function(t,e,n,r,i,s){var o=!(e&&r);e&&e.textConfig?(this.textConfig=dc({},r?this.textConfig:n.textConfig),dc(this.textConfig,e.textConfig)):o&&n.textConfig&&(this.textConfig=n.textConfig);for(var a={},l=!1,c=0;c<up.length;c++){var h=up[c],u=i&&dp[h];e&&null!=e[h]?u?(l=!0,a[h]=e[h]):this[h]=e[h]:o&&null!=n[h]&&(u?(l=!0,a[h]=n[h]):this[h]=n[h])}if(!i)for(c=0;c<this.animators.length;c++){var d=this.animators[c],f=d.targetName;d.getLoop()||d.__changeFinalValue(f?(e||n)[f]:e||n)}l&&this._transitionState(t,a,s)},t.prototype._attachComponent=function(t){if((!t.__zr||t.__hostTarget)&&t!==this){var e=this.__zr;e&&t.addSelfToZr(e),t.__zr=e,t.__hostTarget=this}},t.prototype._detachComponent=function(t){t.__zr&&t.removeSelfFromZr(t.__zr),t.__zr=null,t.__hostTarget=null},t.prototype.getClipPath=function(){return this._clipPath},t.prototype.setClipPath=function(t){this._clipPath&&this._clipPath!==t&&this.removeClipPath(),this._attachComponent(t),this._clipPath=t,this.markRedraw()},t.prototype.removeClipPath=function(){var t=this._clipPath;t&&(this._detachComponent(t),this._clipPath=null,this.markRedraw())},t.prototype.getTextContent=function(){return this._textContent},t.prototype.setTextContent=function(t){var e=this._textContent;e!==t&&(e&&e!==t&&this.removeTextContent(),t.innerTransformable=new tp,this._attachComponent(t),this._textContent=t,this.markRedraw())},t.prototype.setTextConfig=function(t){this.textConfig||(this.textConfig={}),dc(this.textConfig,t),this.markRedraw()},t.prototype.removeTextConfig=function(){this.textConfig=null,this.markRedraw()},t.prototype.removeTextContent=function(){var t=this._textContent;t&&(t.innerTransformable=null,this._detachComponent(t),this._textContent=null,this._innerTextDefaultStyle=null,this.markRedraw())},t.prototype.getTextGuideLine=function(){return this._textGuide},t.prototype.setTextGuideLine=function(t){this._textGuide&&this._textGuide!==t&&this.removeTextGuideLine(),this._attachComponent(t),this._textGuide=t,this.markRedraw()},t.prototype.removeTextGuideLine=function(){var t=this._textGuide;t&&(this._detachComponent(t),this._textGuide=null,this.markRedraw())},t.prototype.markRedraw=function(){this.__dirty|=Fu;var t=this.__zr;t&&(this.__inHover?t.refreshHover():t.refresh()),this.__hostTarget&&this.__hostTarget.markRedraw()},t.prototype.dirty=function(){this.markRedraw()},t.prototype._toggleHoverLayerFlag=function(t){this.__inHover=t;var e=this._textContent,n=this._textGuide;e&&(e.__inHover=t),n&&(n.__inHover=t)},t.prototype.addSelfToZr=function(t){if(this.__zr!==t){this.__zr=t;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.addAnimator(e[n]);this._clipPath&&this._clipPath.addSelfToZr(t),this._textContent&&this._textContent.addSelfToZr(t),this._textGuide&&this._textGuide.addSelfToZr(t)}},t.prototype.removeSelfFromZr=function(t){if(this.__zr){this.__zr=null;var e=this.animators;if(e)for(var n=0;n<e.length;n++)t.animation.removeAnimator(e[n]);this._clipPath&&this._clipPath.removeSelfFromZr(t),this._textContent&&this._textContent.removeSelfFromZr(t),this._textGuide&&this._textGuide.removeSelfFromZr(t)}},t.prototype.animate=function(t,e,n){var r=t?this[t]:this,i=new yf(r,e,n);return t&&(i.targetName=t),this.addAnimator(i,t),i},t.prototype.addAnimator=function(t,e){var n=this.__zr,r=this;t.during((function(){r.updateDuringAnimation(e)})).done((function(){var e=r.animators,n=pc(e,t);n>=0&&e.splice(n,1)})),this.animators.push(t),n&&n.animation.addAnimator(t),n&&n.wakeUp()},t.prototype.updateDuringAnimation=function(t){this.markRedraw()},t.prototype.stopAnimation=function(t,e){for(var n=this.animators,r=n.length,i=[],s=0;s<r;s++){var o=n[s];t&&t!==o.scope?i.push(o):o.stop(e)}return this.animators=i,this},t.prototype.animateTo=function(t,e,n){gp(this,t,e,n)},t.prototype.animateFrom=function(t,e,n){gp(this,t,e,n,!0)},t.prototype._transitionState=function(t,e,n,r){for(var i=gp(this,e,n,r),s=0;s<i.length;s++)i[s].__fromStateTransition=t},t.prototype.getBoundingRect=function(){return null},t.prototype.getPaintRect=function(){return null},t.initDefaultProps=function(){var e=t.prototype;function n(t,n,r,i){function s(t,e){Object.defineProperty(e,0,{get:function(){return t[r]},set:function(e){t[r]=e}}),Object.defineProperty(e,1,{get:function(){return t[i]},set:function(e){t[i]=e}})}Object.defineProperty(e,t,{get:function(){this[n]||s(this,this[n]=[]);return this[n]},set:function(t){this[r]=t[0],this[i]=t[1],this[n]=t,s(this,t)}})}e.type="element",e.name="",e.ignore=e.silent=e.isGroup=e.draggable=e.dragging=e.ignoreClip=e.__inHover=!1,e.__dirty=Fu,Object.defineProperty&&(n("position","_legacyPos","x","y"),n("scale","_legacyScale","scaleX","scaleY"),n("origin","_legacyOrigin","originX","originY"))}(),t}();function gp(t,e,n,r,i){var s=[];bp(t,"",t,e,n=n||{},r,s,i);var o=s.length,a=!1,l=n.done,c=n.aborted,h=function(){a=!0,--o<=0&&(a?l&&l():c&&c())},u=function(){--o<=0&&(a?l&&l():c&&c())};o||l&&l(),s.length>0&&n.during&&s[0].during((function(t,e){n.during(e)}));for(var d=0;d<s.length;d++){var f=s[d];h&&f.done(h),u&&f.aborted(u),n.force&&f.duration(n.duration),f.start(n.easing)}return s}function vp(t,e,n){for(var r=0;r<n;r++)t[r]=e[r]}function yp(t,e,n){if(vc(e[n]))if(vc(t[n])||(t[n]=[]),Oc(e[n])){var r=e[n].length;t[n].length!==r&&(t[n]=new e[n].constructor(r),vp(t[n],e[n],r))}else{var i=e[n],s=t[n],o=i.length;if(vc(i[0]))for(var a=i[0].length,l=0;l<o;l++)s[l]?vp(s[l],i[l],a):s[l]=Array.prototype.slice.call(i[l]);else vp(s,i,o);s.length=i.length}else t[n]=e[n]}function bp(t,e,n,r,i,s,o,a){for(var l=_c(r),c=i.duration,h=i.delay,u=i.additive,d=i.setToFinal,f=!Ic(s),p=t.animators,m=[],g=0;g<l.length;g++){var v=l[g],y=r[v];if(null!=y&&null!=n[v]&&(f||s[v]))if(!Ic(y)||vc(y)||Lc(y))m.push(v);else{if(e){a||(n[v]=y,t.updateDuringAnimation(e));continue}bp(t,v,n[v],y,i,s&&s[v],o,a)}else a||(n[v]=y,t.updateDuringAnimation(e),m.push(v))}var b=m.length;if(!u&&b)for(var x=0;x<p.length;x++){if((E=p[x]).targetName===e)if(E.stopTracks(m)){var w=pc(p,E);p.splice(w,1)}}if(i.force||(m=wc(m,(function(t){return e=r[t],i=n[t],!(e===i||vc(e)&&vc(i)&&function(t,e){var n=t.length;if(n!==e.length)return!1;for(var r=0;r<n;r++)if(t[r]!==e[r])return!1;return!0}(e,i));var e,i})),b=m.length),b>0||i.force&&!o.length){var E,_=void 0,S=void 0,T=void 0;if(a){S={},d&&(_={});for(x=0;x<b;x++){S[v=m[x]]=n[v],d?_[v]=r[v]:n[v]=r[v]}}else if(d){T={};for(x=0;x<b;x++){T[v=m[x]]=df(n[v]),yp(n,r,v)}}(E=new yf(n,!1,!1,u?wc(p,(function(t){return t.targetName===e})):null)).targetName=e,i.scope&&(E.scope=i.scope),d&&_&&E.whenWithKeys(0,_,m),T&&E.whenWithKeys(0,T,m),E.whenWithKeys(null==c?500:c,a?S:r,m).delay(h||0),t.addAnimator(E,e),o.push(E)}}gc(mp,kh),gc(mp,tp);const xp=mp;var wp=function(t){function e(e){var n=t.call(this)||this;return n.isGroup=!0,n._children=[],n.attr(e),n}return sh(e,t),e.prototype.childrenRef=function(){return this._children},e.prototype.children=function(){return this._children.slice()},e.prototype.childAt=function(t){return this._children[t]},e.prototype.childOfName=function(t){for(var e=this._children,n=0;n<e.length;n++)if(e[n].name===t)return e[n]},e.prototype.childCount=function(){return this._children.length},e.prototype.add=function(t){return t&&t!==this&&t.parent!==this&&(this._children.push(t),this._doAdd(t)),this},e.prototype.addBefore=function(t,e){if(t&&t!==this&&t.parent!==this&&e&&e.parent===this){var n=this._children,r=n.indexOf(e);r>=0&&(n.splice(r,0,t),this._doAdd(t))}return this},e.prototype.replace=function(t,e){var n=pc(this._children,t);return n>=0&&this.replaceAt(e,n),this},e.prototype.replaceAt=function(t,e){var n=this._children,r=n[e];if(t&&t!==this&&t.parent!==this&&t!==r){n[e]=t,r.parent=null;var i=this.__zr;i&&r.removeSelfFromZr(i),this._doAdd(t)}return this},e.prototype._doAdd=function(t){t.parent&&t.parent.remove(t),t.parent=this;var e=this.__zr;e&&e!==t.__zr&&t.addSelfToZr(e),e&&e.refresh()},e.prototype.remove=function(t){var e=this.__zr,n=this._children,r=pc(n,t);return r<0||(n.splice(r,1),t.parent=null,e&&t.removeSelfFromZr(e),e&&e.refresh()),this},e.prototype.removeAll=function(){for(var t=this._children,e=this.__zr,n=0;n<t.length;n++){var r=t[n];e&&r.removeSelfFromZr(e),r.parent=null}return t.length=0,this},e.prototype.eachChild=function(t,e){for(var n=this._children,r=0;r<n.length;r++){var i=n[r];t.call(e,i,r)}return this},e.prototype.traverse=function(t,e){for(var n=0;n<this._children.length;n++){var r=this._children[n],i=t.call(e,r);r.isGroup&&!i&&r.traverse(t,e)}return this},e.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var n=0;n<this._children.length;n++){this._children[n].addSelfToZr(e)}},e.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var n=0;n<this._children.length;n++){this._children[n].removeSelfFromZr(e)}},e.prototype.getBoundingRect=function(t){for(var e=new gu(0,0,0,0),n=t||this._children,r=[],i=null,s=0;s<n.length;s++){var o=n[s];if(!o.ignore&&!o.invisible){var a=o.getBoundingRect(),l=o.getLocalTransform(r);l?(gu.applyTransform(e,a,l),(i=i||e.clone()).union(e)):(i=i||a.clone()).union(a)}}return i||e},e}(xp);wp.prototype.type="group";const Ep=wp;
/*!
* ZRender, a high performance 2d drawing library.
*
* Copyright (c) 2013, Baidu Inc.
* All rights reserved.
*
* LICENSE
* https://github.com/ecomfe/zrender/blob/master/LICENSE.txt
*/var _p={},Sp={};var Tp=function(){function t(t,e,n){var r=this;this._sleepAfterStill=10,this._stillFrameAccum=0,this._needsRefresh=!0,this._needsRefreshHover=!0,this._darkMode=!1,n=n||{},this.dom=e,this.id=t;var i=new ju,s=n.renderer||"canvas";_p[s]||(s=_c(_p)[0]),n.useDirtyRect=null!=n.useDirtyRect&&n.useDirtyRect;var o=new _p[s](e,i,n,t),a=n.ssr||o.ssrOnly;this.storage=i,this.painter=o;var l,c=jl.node||jl.worker||a?null:new Uf(o.getViewportRoot(),o.root),h=n.useCoarsePointer;(null==h||"auto"===h?jl.touchEventsSupported:!!h)&&(l=Uc(n.pointerSize,44)),this.handler=new Au(i,o,c,o.root,l),this.animation=new xf({stage:{update:a?null:function(){return r._flush(!0)}}}),a||this.animation.start()}return t.prototype.add=function(t){t&&(this.storage.addRoot(t),t.addSelfToZr(this),this.refresh())},t.prototype.remove=function(t){t&&(this.storage.delRoot(t),t.removeSelfFromZr(this),this.refresh())},t.prototype.configLayer=function(t,e){this.painter.configLayer&&this.painter.configLayer(t,e),this.refresh()},t.prototype.setBackgroundColor=function(t){this.painter.setBackgroundColor&&this.painter.setBackgroundColor(t),this.refresh(),this._backgroundColor=t,this._darkMode=function(t){if(!t)return!1;if("string"==typeof t)return jd(t,1)<.4;if(t.colorStops){for(var e=t.colorStops,n=0,r=e.length,i=0;i<r;i++)n+=jd(e[i].color,1);return(n/=r)<.4}return!1}(t)},t.prototype.getBackgroundColor=function(){return this._backgroundColor},t.prototype.setDarkMode=function(t){this._darkMode=t},t.prototype.isDarkMode=function(){return this._darkMode},t.prototype.refreshImmediately=function(t){t||this.animation.update(!0),this._needsRefresh=!1,this.painter.refresh(),this._needsRefresh=!1},t.prototype.refresh=function(){this._needsRefresh=!0,this.animation.start()},t.prototype.flush=function(){this._flush(!1)},t.prototype._flush=function(t){var e,n=bf();this._needsRefresh&&(e=!0,this.refreshImmediately(t)),this._needsRefreshHover&&(e=!0,this.refreshHoverImmediately());var r=bf();e?(this._stillFrameAccum=0,this.trigger("rendered",{elapsedTime:r-n})):this._sleepAfterStill>0&&(this._stillFrameAccum++,this._stillFrameAccum>this._sleepAfterStill&&this.animation.stop())},t.prototype.setSleepAfterStill=function(t){this._sleepAfterStill=t},t.prototype.wakeUp=function(){this.animation.start(),this._stillFrameAccum=0},t.prototype.refreshHover=function(){this._needsRefreshHover=!0},t.prototype.refreshHoverImmediately=function(){this._needsRefreshHover=!1,this.painter.refreshHover&&"canvas"===this.painter.getType()&&this.painter.refreshHover()},t.prototype.resize=function(t){t=t||{},this.painter.resize(t.width,t.height),this.handler.resize()},t.prototype.clearAnimation=function(){this.animation.clear()},t.prototype.getWidth=function(){return this.painter.getWidth()},t.prototype.getHeight=function(){return this.painter.getHeight()},t.prototype.setCursorStyle=function(t){this.handler.setCursorStyle(t)},t.prototype.findHover=function(t,e){return this.handler.findHover(t,e)},t.prototype.on=function(t,e,n){return this.handler.on(t,e,n),this},t.prototype.off=function(t,e){this.handler.off(t,e)},t.prototype.trigger=function(t,e){this.handler.trigger(t,e)},t.prototype.clear=function(){for(var t=this.storage.getRoots(),e=0;e<t.length;e++)t[e]instanceof Ep&&t[e].removeSelfFromZr(this);this.storage.delAllRoots(),this.painter.clear()},t.prototype.dispose=function(){var t;this.animation.stop(),this.clear(),this.storage.dispose(),this.painter.dispose(),this.handler.dispose(),this.animation=this.storage=this.painter=this.handler=null,t=this.id,delete Sp[t]},t}();function kp(t,e){var n=new Tp(ac(),t,e);return Sp[n.id]=n,n}function Ap(t,e){_p[t]=e}var Cp=new xd(50);function Rp(t){if("string"==typeof t){var e=Cp.get(t);return e&&e.image}return t}function Mp(t,e,n,r,i){if(t){if("string"==typeof t){if(e&&e.__zrImageSrc===t||!n)return e;var s=Cp.get(t),o={hostEl:n,cb:r,cbPayload:i};return s?!Dp(e=s.image)&&s.pending.push(o):((e=Xl.loadImage(t,Ip,Ip)).__zrImageSrc=t,Cp.put(t,e.__cachedImgObj={image:e,pending:[o]})),e}return t}return e}function Ip(){var t=this.__cachedImgObj;this.onload=this.onerror=this.__cachedImgObj=null;for(var e=0;e<t.pending.length;e++){var n=t.pending[e],r=n.cb;r&&r(this,n.cbPayload),n.hostEl.dirty()}t.pending.length=0}function Dp(t){return t&&t.width&&t.height}var Op=/\{([a-zA-Z0-9_]+)\|([^}]*)\}/g;function Pp(t,e,n,r,i){if(!e)return"";var s=(t+"").split("\n");i=Lp(e,n,r,i);for(var o=0,a=s.length;o<a;o++)s[o]=Fp(s[o],i);return s.join("\n")}function Lp(t,e,n,r){var i=dc({},r=r||{});i.font=e,n=Uc(n,"..."),i.maxIterations=Uc(r.maxIterations,2);var s=i.minChar=Uc(r.minChar,0);i.cnCharWidth=np("国",e);var o=i.ascCharWidth=np("a",e);i.placeholder=Uc(r.placeholder,"");for(var a=t=Math.max(0,t-1),l=0;l<s&&a>=o;l++)a-=o;var c=np(n,e);return c>a&&(n="",c=0),a=t-c,i.ellipsis=n,i.ellipsisWidth=c,i.contentWidth=a,i.containerWidth=t,i}function Fp(t,e){var n=e.containerWidth,r=e.font,i=e.contentWidth;if(!n)return"";var s=np(t,r);if(s<=n)return t;for(var o=0;;o++){if(s<=i||o>=e.maxIterations){t+=e.ellipsis;break}var a=0===o?Np(t,i,e.ascCharWidth,e.cnCharWidth):s>0?Math.floor(t.length*i/s):0;s=np(t=t.substr(0,a),r)}return""===t&&(t=e.placeholder),t}function Np(t,e,n,r){for(var i=0,s=0,o=t.length;s<o&&i<e;s++){var a=t.charCodeAt(s);i+=0<=a&&a<=127?n:r}return s}var Bp=function(){},Up=function(t){this.tokens=[],t&&(this.tokens=t)},Vp=function(){this.width=0,this.height=0,this.contentWidth=0,this.contentHeight=0,this.outerWidth=0,this.outerHeight=0,this.lines=[]};function jp(t,e,n,r,i){var s,o,a=""===e,l=i&&n.rich[i]||{},c=t.lines,h=l.font||n.font,u=!1;if(r){var d=l.padding,f=d?d[1]+d[3]:0;if(null!=l.width&&"auto"!==l.width){var p=lp(l.width,r.width)+f;c.length>0&&p+r.accumWidth>r.width&&(s=e.split("\n"),u=!0),r.accumWidth=p}else{var m=Wp(e,h,r.width,r.breakAll,r.accumWidth);r.accumWidth=m.accumWidth+f,o=m.linesWidths,s=m.lines}}else s=e.split("\n");for(var g=0;g<s.length;g++){var v=s[g],y=new Bp;if(y.styleName=i,y.text=v,y.isLineHolder=!v&&!a,"number"==typeof l.width?y.width=l.width:y.width=o?o[g]:np(v,h),g||u)c.push(new Up([y]));else{var b=(c[c.length-1]||(c[0]=new Up)).tokens,x=b.length;1===x&&b[0].isLineHolder?b[0]=y:(v||!x||a)&&b.push(y)}}}var zp=xc(",&?/;] ".split(""),(function(t,e){return t[e]=!0,t}),{});function Gp(t){return!function(t){var e=t.charCodeAt(0);return e>=32&&e<=591||e>=880&&e<=4351||e>=4608&&e<=5119||e>=7680&&e<=8303}(t)||!!zp[t]}function Wp(t,e,n,r,i){for(var s=[],o=[],a="",l="",c=0,h=0,u=0;u<t.length;u++){var d=t.charAt(u);if("\n"!==d){var f=np(d,e),p=!r&&!Gp(d);(s.length?h+f>n:i+h+f>n)?h?(a||l)&&(p?(a||(a=l,l="",h=c=0),s.push(a),o.push(h-c),l+=d,a="",h=c+=f):(l&&(a+=l,l="",c=0),s.push(a),o.push(h),a=d,h=f)):p?(s.push(l),o.push(c),l=d,c=f):(s.push(d),o.push(f)):(h+=f,p?(l+=d,c+=f):(l&&(a+=l,l="",c=0),a+=d))}else l&&(a+=l,h+=c),s.push(a),o.push(h),a="",l="",c=0,h=0}return s.length||a||(a=t,l="",c=0),l&&(a+=l),a&&(s.push(a),o.push(h)),1===s.length&&(h+=i),{accumWidth:h,lines:s,linesWidths:o}}var Hp="__zr_style_"+Math.round(10*Math.random()),$p={shadowBlur:0,shadowOffsetX:0,shadowOffsetY:0,shadowColor:"#000",opacity:1,blend:"source-over"},Yp={style:{shadowBlur:!0,shadowOffsetX:!0,shadowOffsetY:!0,shadowColor:!0,opacity:!0}};$p[Hp]=!0;var Xp=["z","z2","invisible"],qp=["invisible"],Kp=function(t){function e(e){return t.call(this,e)||this}var n;return sh(e,t),e.prototype._init=function(e){for(var n=_c(e),r=0;r<n.length;r++){var i=n[r];"style"===i?this.useStyle(e[i]):t.prototype.attrKV.call(this,i,e[i])}this.style||this.useStyle({})},e.prototype.beforeBrush=function(){},e.prototype.afterBrush=function(){},e.prototype.innerBeforeBrush=function(){},e.prototype.innerAfterBrush=function(){},e.prototype.shouldBePainted=function(t,e,n,r){var i=this.transform;if(this.ignore||this.invisible||0===this.style.opacity||this.culling&&function(t,e,n){Zp.copy(t.getBoundingRect()),t.transform&&Zp.applyTransform(t.transform);return Jp.width=e,Jp.height=n,!Zp.intersect(Jp)}(this,t,e)||i&&!i[0]&&!i[3])return!1;if(n&&this.__clipPaths)for(var s=0;s<this.__clipPaths.length;++s)if(this.__clipPaths[s].isZeroArea())return!1;if(r&&this.parent)for(var o=this.parent;o;){if(o.ignore)return!1;o=o.parent}return!0},e.prototype.contain=function(t,e){return this.rectContain(t,e)},e.prototype.traverse=function(t,e){t.call(e,this)},e.prototype.rectContain=function(t,e){var n=this.transformCoordToLocal(t,e);return this.getBoundingRect().contain(n[0],n[1])},e.prototype.getPaintRect=function(){var t=this._paintRect;if(!this._paintRect||this.__dirty){var e=this.transform,n=this.getBoundingRect(),r=this.style,i=r.shadowBlur||0,s=r.shadowOffsetX||0,o=r.shadowOffsetY||0;t=this._paintRect||(this._paintRect=new gu(0,0,0,0)),e?gu.applyTransform(t,n,e):t.copy(n),(i||s||o)&&(t.width+=2*i+Math.abs(s),t.height+=2*i+Math.abs(o),t.x=Math.min(t.x,t.x+s-i),t.y=Math.min(t.y,t.y+o-i));var a=this.dirtyRectTolerance;t.isZero()||(t.x=Math.floor(t.x-a),t.y=Math.floor(t.y-a),t.width=Math.ceil(t.width+1+2*a),t.height=Math.ceil(t.height+1+2*a))}return t},e.prototype.setPrevPaintRect=function(t){t?(this._prevPaintRect=this._prevPaintRect||new gu(0,0,0,0),this._prevPaintRect.copy(t)):this._prevPaintRect=null},e.prototype.getPrevPaintRect=function(){return this._prevPaintRect},e.prototype.animateStyle=function(t){return this.animate("style",t)},e.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():this.markRedraw()},e.prototype.attrKV=function(e,n){"style"!==e?t.prototype.attrKV.call(this,e,n):this.style?this.setStyle(n):this.useStyle(n)},e.prototype.setStyle=function(t,e){return"string"==typeof t?this.style[t]=e:dc(this.style,t),this.dirtyStyle(),this},e.prototype.dirtyStyle=function(t){t||this.markRedraw(),this.__dirty|=2,this._rect&&(this._rect=null)},e.prototype.dirty=function(){this.dirtyStyle()},e.prototype.styleChanged=function(){return!!(2&this.__dirty)},e.prototype.styleUpdated=function(){this.__dirty&=-3},e.prototype.createStyle=function(t){return Qc($p,t)},e.prototype.useStyle=function(t){t[Hp]||(t=this.createStyle(t)),this.__inHover?this.__hoverStyle=t:this.style=t,this.dirtyStyle()},e.prototype.isStyleObject=function(t){return t[Hp]},e.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var n=this._normalState;e.style&&!n.style&&(n.style=this._mergeStyle(this.createStyle(),this.style)),this._savePrimaryToNormal(e,n,Xp)},e.prototype._applyStateObj=function(e,n,r,i,s,o){t.prototype._applyStateObj.call(this,e,n,r,i,s,o);var a,l=!(n&&i);if(n&&n.style?s?i?a=n.style:(a=this._mergeStyle(this.createStyle(),r.style),this._mergeStyle(a,n.style)):(a=this._mergeStyle(this.createStyle(),i?this.style:r.style),this._mergeStyle(a,n.style)):l&&(a=r.style),a)if(s){var c=this.style;if(this.style=this.createStyle(l?{}:c),l)for(var h=_c(c),u=0;u<h.length;u++){(f=h[u])in a&&(a[f]=a[f],this.style[f]=c[f])}var d=_c(a);for(u=0;u<d.length;u++){var f=d[u];this.style[f]=this.style[f]}this._transitionState(e,{style:a},o,this.getAnimationStyleProps())}else this.useStyle(a);var p=this.__inHover?qp:Xp;for(u=0;u<p.length;u++){f=p[u];n&&null!=n[f]?this[f]=n[f]:l&&null!=r[f]&&(this[f]=r[f])}},e.prototype._mergeStates=function(e){for(var n,r=t.prototype._mergeStates.call(this,e),i=0;i<e.length;i++){var s=e[i];s.style&&(n=n||{},this._mergeStyle(n,s.style))}return n&&(r.style=n),r},e.prototype._mergeStyle=function(t,e){return dc(t,e),t},e.prototype.getAnimationStyleProps=function(){return Yp},e.initDefaultProps=((n=e.prototype).type="displayable",n.invisible=!1,n.z=0,n.z2=0,n.zlevel=0,n.culling=!1,n.cursor="pointer",n.rectHover=!1,n.incremental=!1,n._rect=null,n.dirtyRectTolerance=0,void(n.__dirty=2|Fu)),e}(xp),Zp=new gu(0,0,0,0),Jp=new gu(0,0,0,0);const Qp=Kp;var tm=Math.min,em=Math.max,nm=Math.sin,rm=Math.cos,im=2*Math.PI,sm=oh(),om=oh(),am=oh();function lm(t,e,n){if(0!==t.length){for(var r=t[0],i=r[0],s=r[0],o=r[1],a=r[1],l=1;l<t.length;l++)r=t[l],i=tm(i,r[0]),s=em(s,r[0]),o=tm(o,r[1]),a=em(a,r[1]);e[0]=i,e[1]=o,n[0]=s,n[1]=a}}function cm(t,e,n,r,i,s){i[0]=tm(t,n),i[1]=tm(e,r),s[0]=em(t,n),s[1]=em(e,r)}var hm=[],um=[];function dm(t,e,n,r,i,s,o,a,l,c){var h=sd,u=nd,d=h(t,n,i,o,hm);l[0]=1/0,l[1]=1/0,c[0]=-1/0,c[1]=-1/0;for(var f=0;f<d;f++){var p=u(t,n,i,o,hm[f]);l[0]=tm(p,l[0]),c[0]=em(p,c[0])}d=h(e,r,s,a,um);for(f=0;f<d;f++){var m=u(e,r,s,a,um[f]);l[1]=tm(m,l[1]),c[1]=em(m,c[1])}l[0]=tm(t,l[0]),c[0]=em(t,c[0]),l[0]=tm(o,l[0]),c[0]=em(o,c[0]),l[1]=tm(e,l[1]),c[1]=em(e,c[1]),l[1]=tm(a,l[1]),c[1]=em(a,c[1])}function fm(t,e,n,r,i,s,o,a){var l=ud,c=cd,h=em(tm(l(t,n,i),1),0),u=em(tm(l(e,r,s),1),0),d=c(t,n,i,h),f=c(e,r,s,u);o[0]=tm(t,i,d),o[1]=tm(e,s,f),a[0]=em(t,i,d),a[1]=em(e,s,f)}function pm(t,e,n,r,i,s,o,a,l){var c=wh,h=Eh,u=Math.abs(i-s);if(u%im<1e-4&&u>1e-4)return a[0]=t-n,a[1]=e-r,l[0]=t+n,void(l[1]=e+r);if(sm[0]=rm(i)*n+t,sm[1]=nm(i)*r+e,om[0]=rm(s)*n+t,om[1]=nm(s)*r+e,c(a,sm,om),h(l,sm,om),(i%=im)<0&&(i+=im),(s%=im)<0&&(s+=im),i>s&&!o?s+=im:i<s&&o&&(i+=im),o){var d=s;s=i,i=d}for(var f=0;f<s;f+=Math.PI/2)f>i&&(am[0]=rm(f)*n+t,am[1]=nm(f)*r+e,c(a,am,a),h(l,am,l))}var mm={M:1,L:2,C:3,Q:4,A:5,Z:6,R:7},gm=[],vm=[],ym=[],bm=[],xm=[],wm=[],Em=Math.min,_m=Math.max,Sm=Math.cos,Tm=Math.sin,km=Math.abs,Am=Math.PI,Cm=2*Am,Rm="undefined"!=typeof Float32Array,Mm=[];function Im(t){return Math.round(t/Am*1e8)/1e8%2*Am}function Dm(t,e){var n=Im(t[0]);n<0&&(n+=Cm);var r=n-t[0],i=t[1];i+=r,!e&&i-n>=Cm?i=n+Cm:e&&n-i>=Cm?i=n-Cm:!e&&n>i?i=n+(Cm-Im(n-i)):e&&n<i&&(i=n-(Cm-Im(i-n))),t[0]=n,t[1]=i}var Om=function(){function t(t){this.dpr=1,this._xi=0,this._yi=0,this._x0=0,this._y0=0,this._len=0,t&&(this._saveData=!1),this._saveData&&(this.data=[])}var e;return t.prototype.increaseVersion=function(){this._version++},t.prototype.getVersion=function(){return this._version},t.prototype.setScale=function(t,e,n){(n=n||0)>0&&(this._ux=km(n/jf/t)||0,this._uy=km(n/jf/e)||0)},t.prototype.setDPR=function(t){this.dpr=t},t.prototype.setContext=function(t){this._ctx=t},t.prototype.getContext=function(){return this._ctx},t.prototype.beginPath=function(){return this._ctx&&this._ctx.beginPath(),this.reset(),this},t.prototype.reset=function(){this._saveData&&(this._len=0),this._pathSegLen&&(this._pathSegLen=null,this._pathLen=0),this._version++},t.prototype.moveTo=function(t,e){return this._drawPendingPt(),this.addData(mm.M,t,e),this._ctx&&this._ctx.moveTo(t,e),this._x0=t,this._y0=e,this._xi=t,this._yi=e,this},t.prototype.lineTo=function(t,e){var n=km(t-this._xi),r=km(e-this._yi),i=n>this._ux||r>this._uy;if(this.addData(mm.L,t,e),this._ctx&&i&&this._ctx.lineTo(t,e),i)this._xi=t,this._yi=e,this._pendingPtDist=0;else{var s=n*n+r*r;s>this._pendingPtDist&&(this._pendingPtX=t,this._pendingPtY=e,this._pendingPtDist=s)}return this},t.prototype.bezierCurveTo=function(t,e,n,r,i,s){return this._drawPendingPt(),this.addData(mm.C,t,e,n,r,i,s),this._ctx&&this._ctx.bezierCurveTo(t,e,n,r,i,s),this._xi=i,this._yi=s,this},t.prototype.quadraticCurveTo=function(t,e,n,r){return this._drawPendingPt(),this.addData(mm.Q,t,e,n,r),this._ctx&&this._ctx.quadraticCurveTo(t,e,n,r),this._xi=n,this._yi=r,this},t.prototype.arc=function(t,e,n,r,i,s){this._drawPendingPt(),Mm[0]=r,Mm[1]=i,Dm(Mm,s),r=Mm[0];var o=(i=Mm[1])-r;return this.addData(mm.A,t,e,n,n,r,o,0,s?0:1),this._ctx&&this._ctx.arc(t,e,n,r,i,s),this._xi=Sm(i)*n+t,this._yi=Tm(i)*n+e,this},t.prototype.arcTo=function(t,e,n,r,i){return this._drawPendingPt(),this._ctx&&this._ctx.arcTo(t,e,n,r,i),this},t.prototype.rect=function(t,e,n,r){return this._drawPendingPt(),this._ctx&&this._ctx.rect(t,e,n,r),this.addData(mm.R,t,e,n,r),this},t.prototype.closePath=function(){this._drawPendingPt(),this.addData(mm.Z);var t=this._ctx,e=this._x0,n=this._y0;return t&&t.closePath(),this._xi=e,this._yi=n,this},t.prototype.fill=function(t){t&&t.fill(),this.toStatic()},t.prototype.stroke=function(t){t&&t.stroke(),this.toStatic()},t.prototype.len=function(){return this._len},t.prototype.setData=function(t){var e=t.length;this.data&&this.data.length===e||!Rm||(this.data=new Float32Array(e));for(var n=0;n<e;n++)this.data[n]=t[n];this._len=e},t.prototype.appendPath=function(t){t instanceof Array||(t=[t]);for(var e=t.length,n=0,r=this._len,i=0;i<e;i++)n+=t[i].len();Rm&&this.data instanceof Float32Array&&(this.data=new Float32Array(r+n));for(i=0;i<e;i++)for(var s=t[i].data,o=0;o<s.length;o++)this.data[r++]=s[o];this._len=r},t.prototype.addData=function(t,e,n,r,i,s,o,a,l){if(this._saveData){var c=this.data;this._len+arguments.length>c.length&&(this._expandData(),c=this.data);for(var h=0;h<arguments.length;h++)c[this._len++]=arguments[h]}},t.prototype._drawPendingPt=function(){this._pendingPtDist>0&&(this._ctx&&this._ctx.lineTo(this._pendingPtX,this._pendingPtY),this._pendingPtDist=0)},t.prototype._expandData=function(){if(!(this.data instanceof Array)){for(var t=[],e=0;e<this._len;e++)t[e]=this.data[e];this.data=t}},t.prototype.toStatic=function(){if(this._saveData){this._drawPendingPt();var t=this.data;t instanceof Array&&(t.length=this._len,Rm&&this._len>11&&(this.data=new Float32Array(t)))}},t.prototype.getBoundingRect=function(){ym[0]=ym[1]=xm[0]=xm[1]=Number.MAX_VALUE,bm[0]=bm[1]=wm[0]=wm[1]=-Number.MAX_VALUE;var t,e=this.data,n=0,r=0,i=0,s=0;for(t=0;t<this._len;){var o=e[t++],a=1===t;switch(a&&(i=n=e[t],s=r=e[t+1]),o){case mm.M:n=i=e[t++],r=s=e[t++],xm[0]=i,xm[1]=s,wm[0]=i,wm[1]=s;break;case mm.L:cm(n,r,e[t],e[t+1],xm,wm),n=e[t++],r=e[t++];break;case mm.C:dm(n,r,e[t++],e[t++],e[t++],e[t++],e[t],e[t+1],xm,wm),n=e[t++],r=e[t++];break;case mm.Q:fm(n,r,e[t++],e[t++],e[t],e[t+1],xm,wm),n=e[t++],r=e[t++];break;case mm.A:var l=e[t++],c=e[t++],h=e[t++],u=e[t++],d=e[t++],f=e[t++]+d;t+=1;var p=!e[t++];a&&(i=Sm(d)*h+l,s=Tm(d)*u+c),pm(l,c,h,u,d,f,p,xm,wm),n=Sm(f)*h+l,r=Tm(f)*u+c;break;case mm.R:cm(i=n=e[t++],s=r=e[t++],i+e[t++],s+e[t++],xm,wm);break;case mm.Z:n=i,r=s}wh(ym,ym,xm),Eh(bm,bm,wm)}return 0===t&&(ym[0]=ym[1]=bm[0]=bm[1]=0),new gu(ym[0],ym[1],bm[0]-ym[0],bm[1]-ym[1])},t.prototype._calculateLength=function(){var t=this.data,e=this._len,n=this._ux,r=this._uy,i=0,s=0,o=0,a=0;this._pathSegLen||(this._pathSegLen=[]);for(var l=this._pathSegLen,c=0,h=0,u=0;u<e;){var d=t[u++],f=1===u;f&&(o=i=t[u],a=s=t[u+1]);var p=-1;switch(d){case mm.M:i=o=t[u++],s=a=t[u++];break;case mm.L:var m=t[u++],g=(b=t[u++])-s;(km(R=m-i)>n||km(g)>r||u===e-1)&&(p=Math.sqrt(R*R+g*g),i=m,s=b);break;case mm.C:var v=t[u++],y=t[u++],b=(m=t[u++],t[u++]),x=t[u++],w=t[u++];p=ld(i,s,v,y,m,b,x,w,10),i=x,s=w;break;case mm.Q:p=pd(i,s,v=t[u++],y=t[u++],m=t[u++],b=t[u++],10),i=m,s=b;break;case mm.A:var E=t[u++],_=t[u++],S=t[u++],T=t[u++],k=t[u++],A=t[u++],C=A+k;u+=1,t[u++],f&&(o=Sm(k)*S+E,a=Tm(k)*T+_),p=_m(S,T)*Em(Cm,Math.abs(A)),i=Sm(C)*S+E,s=Tm(C)*T+_;break;case mm.R:o=i=t[u++],a=s=t[u++],p=2*t[u++]+2*t[u++];break;case mm.Z:var R=o-i;g=a-s;p=Math.sqrt(R*R+g*g),i=o,s=a}p>=0&&(l[h++]=p,c+=p)}return this._pathLen=c,c},t.prototype.rebuildPath=function(t,e){var n,r,i,s,o,a,l,c,h,u,d=this.data,f=this._ux,p=this._uy,m=this._len,g=e<1,v=0,y=0,b=0;if(!g||(this._pathSegLen||this._calculateLength(),l=this._pathSegLen,c=e*this._pathLen))t:for(var x=0;x<m;){var w=d[x++],E=1===x;switch(E&&(n=i=d[x],r=s=d[x+1]),w!==mm.L&&b>0&&(t.lineTo(h,u),b=0),w){case mm.M:n=i=d[x++],r=s=d[x++],t.moveTo(i,s);break;case mm.L:o=d[x++],a=d[x++];var _=km(o-i),S=km(a-s);if(_>f||S>p){if(g){if(v+(X=l[y++])>c){var T=(c-v)/X;t.lineTo(i*(1-T)+o*T,s*(1-T)+a*T);break t}v+=X}t.lineTo(o,a),i=o,s=a,b=0}else{var k=_*_+S*S;k>b&&(h=o,u=a,b=k)}break;case mm.C:var A=d[x++],C=d[x++],R=d[x++],M=d[x++],I=d[x++],D=d[x++];if(g){if(v+(X=l[y++])>c){od(i,A,R,I,T=(c-v)/X,gm),od(s,C,M,D,T,vm),t.bezierCurveTo(gm[1],vm[1],gm[2],vm[2],gm[3],vm[3]);break t}v+=X}t.bezierCurveTo(A,C,R,M,I,D),i=I,s=D;break;case mm.Q:A=d[x++],C=d[x++],R=d[x++],M=d[x++];if(g){if(v+(X=l[y++])>c){dd(i,A,R,T=(c-v)/X,gm),dd(s,C,M,T,vm),t.quadraticCurveTo(gm[1],vm[1],gm[2],vm[2]);break t}v+=X}t.quadraticCurveTo(A,C,R,M),i=R,s=M;break;case mm.A:var O=d[x++],P=d[x++],L=d[x++],F=d[x++],N=d[x++],B=d[x++],U=d[x++],V=!d[x++],j=L>F?L:F,z=km(L-F)>.001,G=N+B,W=!1;if(g)v+(X=l[y++])>c&&(G=N+B*(c-v)/X,W=!0),v+=X;if(z&&t.ellipse?t.ellipse(O,P,L,F,U,N,G,V):t.arc(O,P,j,N,G,V),W)break t;E&&(n=Sm(N)*L+O,r=Tm(N)*F+P),i=Sm(G)*L+O,s=Tm(G)*F+P;break;case mm.R:n=i=d[x],r=s=d[x+1],o=d[x++],a=d[x++];var H=d[x++],$=d[x++];if(g){if(v+(X=l[y++])>c){var Y=c-v;t.moveTo(o,a),t.lineTo(o+Em(Y,H),a),(Y-=H)>0&&t.lineTo(o+H,a+Em(Y,$)),(Y-=$)>0&&t.lineTo(o+_m(H-Y,0),a+$),(Y-=H)>0&&t.lineTo(o,a+_m($-Y,0));break t}v+=X}t.rect(o,a,H,$);break;case mm.Z:if(g){var X;if(v+(X=l[y++])>c){T=(c-v)/X;t.lineTo(i*(1-T)+n*T,s*(1-T)+r*T);break t}v+=X}t.closePath(),i=n,s=r}}},t.prototype.clone=function(){var e=new t,n=this.data;return e.data=n.slice?n.slice():Array.prototype.slice.call(n),e._len=this._len,e},t.CMD=mm,t.initDefaultProps=((e=t.prototype)._saveData=!0,e._ux=0,e._uy=0,e._pendingPtDist=0,void(e._version=0)),t}();function Pm(t,e,n,r,i,s,o){if(0===i)return!1;var a=i,l=0;if(o>e+a&&o>r+a||o<e-a&&o<r-a||s>t+a&&s>n+a||s<t-a&&s<n-a)return!1;if(t===n)return Math.abs(s-t)<=a/2;var c=(l=(e-r)/(t-n))*s-o+(t*r-n*e)/(t-n);return c*c/(l*l+1)<=a/2*a/2}function Lm(t,e,n,r,i,s,o,a,l,c,h){if(0===l)return!1;var u=l;return!(h>e+u&&h>r+u&&h>s+u&&h>a+u||h<e-u&&h<r-u&&h<s-u&&h<a-u||c>t+u&&c>n+u&&c>i+u&&c>o+u||c<t-u&&c<n-u&&c<i-u&&c<o-u)&&ad(t,e,n,r,i,s,o,a,c,h,null)<=u/2}function Fm(t,e,n,r,i,s,o,a,l){if(0===o)return!1;var c=o;return!(l>e+c&&l>r+c&&l>s+c||l<e-c&&l<r-c&&l<s-c||a>t+c&&a>n+c&&a>i+c||a<t-c&&a<n-c&&a<i-c)&&fd(t,e,n,r,i,s,a,l,null)<=c/2}var Nm=2*Math.PI;function Bm(t){return(t%=Nm)<0&&(t+=Nm),t}var Um=2*Math.PI;function Vm(t,e,n,r,i,s,o,a,l){if(0===o)return!1;var c=o;a-=t,l-=e;var h=Math.sqrt(a*a+l*l);if(h-c>n||h+c<n)return!1;if(Math.abs(r-i)%Um<1e-4)return!0;if(s){var u=r;r=Bm(i),i=Bm(u)}else r=Bm(r),i=Bm(i);r>i&&(i+=Um);var d=Math.atan2(l,a);return d<0&&(d+=Um),d>=r&&d<=i||d+Um>=r&&d+Um<=i}function jm(t,e,n,r,i,s){if(s>e&&s>r||s<e&&s<r)return 0;if(r===e)return 0;var o=(s-e)/(r-e),a=r<e?1:-1;1!==o&&0!==o||(a=r<e?.5:-.5);var l=o*(n-t)+t;return l===i?1/0:l>i?a:0}var zm=Om.CMD,Gm=2*Math.PI,Wm=1e-4;var Hm=[-1,-1,-1],$m=[-1,-1];function Ym(t,e,n,r,i,s,o,a,l,c){if(c>e&&c>r&&c>s&&c>a||c<e&&c<r&&c<s&&c<a)return 0;var h,u=id(e,r,s,a,c,Hm);if(0===u)return 0;for(var d=0,f=-1,p=void 0,m=void 0,g=0;g<u;g++){var v=Hm[g],y=0===v||1===v?.5:1;nd(t,n,i,o,v)<l||(f<0&&(f=sd(e,r,s,a,$m),$m[1]<$m[0]&&f>1&&(h=void 0,h=$m[0],$m[0]=$m[1],$m[1]=h),p=nd(e,r,s,a,$m[0]),f>1&&(m=nd(e,r,s,a,$m[1]))),2===f?v<$m[0]?d+=p<e?y:-y:v<$m[1]?d+=m<p?y:-y:d+=a<m?y:-y:v<$m[0]?d+=p<e?y:-y:d+=a<p?y:-y)}return d}function Xm(t,e,n,r,i,s,o,a){if(a>e&&a>r&&a>s||a<e&&a<r&&a<s)return 0;var l=function(t,e,n,r,i){var s=t-2*e+n,o=2*(e-t),a=t-r,l=0;if(td(s))ed(o)&&(h=-a/o)>=0&&h<=1&&(i[l++]=h);else{var c=o*o-4*s*a;if(td(c))(h=-o/(2*s))>=0&&h<=1&&(i[l++]=h);else if(c>0){var h,u=$u(c),d=(-o-u)/(2*s);(h=(-o+u)/(2*s))>=0&&h<=1&&(i[l++]=h),d>=0&&d<=1&&(i[l++]=d)}}return l}(e,r,s,a,Hm);if(0===l)return 0;var c=ud(e,r,s);if(c>=0&&c<=1){for(var h=0,u=cd(e,r,s,c),d=0;d<l;d++){var f=0===Hm[d]||1===Hm[d]?.5:1;cd(t,n,i,Hm[d])<o||(Hm[d]<c?h+=u<e?f:-f:h+=s<u?f:-f)}return h}f=0===Hm[0]||1===Hm[0]?.5:1;return cd(t,n,i,Hm[0])<o?0:s<e?f:-f}function qm(t,e,n,r,i,s,o,a){if((a-=e)>n||a<-n)return 0;var l=Math.sqrt(n*n-a*a);Hm[0]=-l,Hm[1]=l;var c=Math.abs(r-i);if(c<1e-4)return 0;if(c>=Gm-1e-4){r=0,i=Gm;var h=s?1:-1;return o>=Hm[0]+t&&o<=Hm[1]+t?h:0}if(r>i){var u=r;r=i,i=u}r<0&&(r+=Gm,i+=Gm);for(var d=0,f=0;f<2;f++){var p=Hm[f];if(p+t>o){var m=Math.atan2(a,p);h=s?1:-1;m<0&&(m=Gm+m),(m>=r&&m<=i||m+Gm>=r&&m+Gm<=i)&&(m>Math.PI/2&&m<1.5*Math.PI&&(h=-h),d+=h)}}return d}function Km(t,e,n,r,i){for(var s,o,a,l,c=t.data,h=t.len(),u=0,d=0,f=0,p=0,m=0,g=0;g<h;){var v=c[g++],y=1===g;switch(v===zm.M&&g>1&&(n||(u+=jm(d,f,p,m,r,i))),y&&(p=d=c[g],m=f=c[g+1]),v){case zm.M:d=p=c[g++],f=m=c[g++];break;case zm.L:if(n){if(Pm(d,f,c[g],c[g+1],e,r,i))return!0}else u+=jm(d,f,c[g],c[g+1],r,i)||0;d=c[g++],f=c[g++];break;case zm.C:if(n){if(Lm(d,f,c[g++],c[g++],c[g++],c[g++],c[g],c[g+1],e,r,i))return!0}else u+=Ym(d,f,c[g++],c[g++],c[g++],c[g++],c[g],c[g+1],r,i)||0;d=c[g++],f=c[g++];break;case zm.Q:if(n){if(Fm(d,f,c[g++],c[g++],c[g],c[g+1],e,r,i))return!0}else u+=Xm(d,f,c[g++],c[g++],c[g],c[g+1],r,i)||0;d=c[g++],f=c[g++];break;case zm.A:var b=c[g++],x=c[g++],w=c[g++],E=c[g++],_=c[g++],S=c[g++];g+=1;var T=!!(1-c[g++]);s=Math.cos(_)*w+b,o=Math.sin(_)*E+x,y?(p=s,m=o):u+=jm(d,f,s,o,r,i);var k=(r-b)*E/w+b;if(n){if(Vm(b,x,E,_,_+S,T,e,k,i))return!0}else u+=qm(b,x,E,_,_+S,T,k,i);d=Math.cos(_+S)*w+b,f=Math.sin(_+S)*E+x;break;case zm.R:if(p=d=c[g++],m=f=c[g++],s=p+c[g++],o=m+c[g++],n){if(Pm(p,m,s,m,e,r,i)||Pm(s,m,s,o,e,r,i)||Pm(s,o,p,o,e,r,i)||Pm(p,o,p,m,e,r,i))return!0}else u+=jm(s,m,s,o,r,i),u+=jm(p,o,p,m,r,i);break;case zm.Z:if(n){if(Pm(d,f,p,m,e,r,i))return!0}else u+=jm(d,f,p,m,r,i);d=p,f=m}}return n||(a=f,l=m,Math.abs(a-l)<Wm)||(u+=jm(d,f,p,m,r,i)||0),0!==u}var Zm=fc({fill:"#000",stroke:null,strokePercent:1,fillOpacity:1,strokeOpacity:1,lineDashOffset:0,lineWidth:1,lineCap:"butt",miterLimit:10,strokeNoScale:!1,strokeFirst:!1},$p),Jm={style:fc({fill:!0,stroke:!0,strokePercent:!0,fillOpacity:!0,strokeOpacity:!0,lineDashOffset:!0,lineWidth:!0,miterLimit:!0},Yp.style)},Qm=Jf.concat(["invisible","culling","z","z2","zlevel","parent"]);const tg=function(t){function e(e){return t.call(this,e)||this}var n;return sh(e,t),e.prototype.update=function(){var n=this;t.prototype.update.call(this);var r=this.style;if(r.decal){var i=this._decalEl=this._decalEl||new e;i.buildPath===e.prototype.buildPath&&(i.buildPath=function(t){n.buildPath(t,n.shape)}),i.silent=!0;var s=i.style;for(var o in r)s[o]!==r[o]&&(s[o]=r[o]);s.fill=r.fill?r.decal:null,s.decal=null,s.shadowColor=null,r.strokeFirst&&(s.stroke=null);for(var a=0;a<Qm.length;++a)i[Qm[a]]=this[Qm[a]];i.__dirty|=Fu}else this._decalEl&&(this._decalEl=null)},e.prototype.getDecalElement=function(){return this._decalEl},e.prototype._init=function(e){var n=_c(e);this.shape=this.getDefaultShape();var r=this.getDefaultStyle();r&&this.useStyle(r);for(var i=0;i<n.length;i++){var s=n[i],o=e[s];"style"===s?this.style?dc(this.style,o):this.useStyle(o):"shape"===s?dc(this.shape,o):t.prototype.attrKV.call(this,s,o)}this.style||this.useStyle({})},e.prototype.getDefaultStyle=function(){return null},e.prototype.getDefaultShape=function(){return{}},e.prototype.canBeInsideText=function(){return this.hasFill()},e.prototype.getInsideTextFill=function(){var t=this.style.fill;if("none"!==t){if(Cc(t)){var e=jd(t,0);return e>.5?zf:e>.2?"#eee":Gf}if(t)return Gf}return zf},e.prototype.getInsideTextStroke=function(t){var e=this.style.fill;if(Cc(e)){var n=this.__zr;if(!(!n||!n.isDarkMode())===jd(t,0)<.4)return e}},e.prototype.buildPath=function(t,e,n){},e.prototype.pathUpdated=function(){this.__dirty&=~Nu},e.prototype.getUpdatedPathProxy=function(t){return!this.path&&this.createPathProxy(),this.path.beginPath(),this.buildPath(this.path,this.shape,t),this.path},e.prototype.createPathProxy=function(){this.path=new Om(!1)},e.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return!(null==e||"none"===e||!(t.lineWidth>0))},e.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},e.prototype.getBoundingRect=function(){var t=this._rect,e=this.style,n=!t;if(n){var r=!1;this.path||(r=!0,this.createPathProxy());var i=this.path;(r||this.__dirty&Nu)&&(i.beginPath(),this.buildPath(i,this.shape,!1),this.pathUpdated()),t=i.getBoundingRect()}if(this._rect=t,this.hasStroke()&&this.path&&this.path.len()>0){var s=this._rectStroke||(this._rectStroke=t.clone());if(this.__dirty||n){s.copy(t);var o=e.strokeNoScale?this.getLineScale():1,a=e.lineWidth;if(!this.hasFill()){var l=this.strokeContainThreshold;a=Math.max(a,null==l?4:l)}o>1e-10&&(s.width+=a/o,s.height+=a/o,s.x-=a/o/2,s.y-=a/o/2)}return s}return t},e.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e),r=this.getBoundingRect(),i=this.style;if(t=n[0],e=n[1],r.contain(t,e)){var s=this.path;if(this.hasStroke()){var o=i.lineWidth,a=i.strokeNoScale?this.getLineScale():1;if(a>1e-10&&(this.hasFill()||(o=Math.max(o,this.strokeContainThreshold)),function(t,e,n,r){return Km(t,e,!0,n,r)}(s,o/a,t,e)))return!0}if(this.hasFill())return function(t,e,n){return Km(t,0,!1,e,n)}(s,t,e)}return!1},e.prototype.dirtyShape=function(){this.__dirty|=Nu,this._rect&&(this._rect=null),this._decalEl&&this._decalEl.dirtyShape(),this.markRedraw()},e.prototype.dirty=function(){this.dirtyStyle(),this.dirtyShape()},e.prototype.animateShape=function(t){return this.animate("shape",t)},e.prototype.updateDuringAnimation=function(t){"style"===t?this.dirtyStyle():"shape"===t?this.dirtyShape():this.markRedraw()},e.prototype.attrKV=function(e,n){"shape"===e?this.setShape(n):t.prototype.attrKV.call(this,e,n)},e.prototype.setShape=function(t,e){var n=this.shape;return n||(n=this.shape={}),"string"==typeof t?n[t]=e:dc(n,t),this.dirtyShape(),this},e.prototype.shapeChanged=function(){return!!(this.__dirty&Nu)},e.prototype.createStyle=function(t){return Qc(Zm,t)},e.prototype._innerSaveToNormal=function(e){t.prototype._innerSaveToNormal.call(this,e);var n=this._normalState;e.shape&&!n.shape&&(n.shape=dc({},this.shape))},e.prototype._applyStateObj=function(e,n,r,i,s,o){t.prototype._applyStateObj.call(this,e,n,r,i,s,o);var a,l=!(n&&i);if(n&&n.shape?s?i?a=n.shape:(a=dc({},r.shape),dc(a,n.shape)):(a=dc({},i?this.shape:r.shape),dc(a,n.shape)):l&&(a=r.shape),a)if(s){this.shape=dc({},this.shape);for(var c={},h=_c(a),u=0;u<h.length;u++){var d=h[u];"object"==typeof a[d]?this.shape[d]=a[d]:c[d]=a[d]}this._transitionState(e,{shape:c},o)}else this.shape=a,this.dirtyShape()},e.prototype._mergeStates=function(e){for(var n,r=t.prototype._mergeStates.call(this,e),i=0;i<e.length;i++){var s=e[i];s.shape&&(n=n||{},this._mergeStyle(n,s.shape))}return n&&(r.shape=n),r},e.prototype.getAnimationStyleProps=function(){return Jm},e.prototype.isZeroArea=function(){return!1},e.extend=function(t){var n=function(e){function n(n){var r=e.call(this,n)||this;return t.init&&t.init.call(r,n),r}return sh(n,e),n.prototype.getDefaultStyle=function(){return cc(t.style)},n.prototype.getDefaultShape=function(){return cc(t.shape)},n}(e);for(var r in t)"function"==typeof t[r]&&(n.prototype[r]=t[r]);return n},e.initDefaultProps=((n=e.prototype).type="path",n.strokeContainThreshold=5,n.segmentIgnoreThreshold=0,n.subPixelOptimize=!1,n.autoBatch=!1,void(n.__dirty=2|Fu|Nu)),e}(Qp);var eg=fc({strokeFirst:!0,font:Wl,x:0,y:0,textAlign:"left",textBaseline:"top",miterLimit:2},Zm),ng=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return sh(e,t),e.prototype.hasStroke=function(){var t=this.style,e=t.stroke;return null!=e&&"none"!==e&&t.lineWidth>0},e.prototype.hasFill=function(){var t=this.style.fill;return null!=t&&"none"!==t},e.prototype.createStyle=function(t){return Qc(eg,t)},e.prototype.setBoundingRect=function(t){this._rect=t},e.prototype.getBoundingRect=function(){var t=this.style;if(!this._rect){var e=t.text;null!=e?e+="":e="";var n=ip(e,t.font,t.textAlign,t.textBaseline);if(n.x+=t.x||0,n.y+=t.y||0,this.hasStroke()){var r=t.lineWidth;n.x-=r/2,n.y-=r/2,n.width+=r,n.height+=r}this._rect=n}return this._rect},e.initDefaultProps=void(e.prototype.dirtyRectTolerance=10),e}(Qp);ng.prototype.type="tspan";const rg=ng;var ig=fc({x:0,y:0},$p),sg={style:fc({x:!0,y:!0,width:!0,height:!0,sx:!0,sy:!0,sWidth:!0,sHeight:!0},Yp.style)};var og=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return sh(e,t),e.prototype.createStyle=function(t){return Qc(ig,t)},e.prototype._getSize=function(t){var e=this.style,n=e[t];if(null!=n)return n;var r,i=(r=e.image)&&"string"!=typeof r&&r.width&&r.height?e.image:this.__image;if(!i)return 0;var s="width"===t?"height":"width",o=e[s];return null==o?i[t]:i[t]/i[s]*o},e.prototype.getWidth=function(){return this._getSize("width")},e.prototype.getHeight=function(){return this._getSize("height")},e.prototype.getAnimationStyleProps=function(){return sg},e.prototype.getBoundingRect=function(){var t=this.style;return this._rect||(this._rect=new gu(t.x||0,t.y||0,this.getWidth(),this.getHeight())),this._rect},e}(Qp);og.prototype.type="image";const ag=og;var lg=Math.round;function cg(t,e,n){if(e){var r=e.x1,i=e.x2,s=e.y1,o=e.y2;t.x1=r,t.x2=i,t.y1=s,t.y2=o;var a=n&&n.lineWidth;return a?(lg(2*r)===lg(2*i)&&(t.x1=t.x2=ug(r,a,!0)),lg(2*s)===lg(2*o)&&(t.y1=t.y2=ug(s,a,!0)),t):t}}function hg(t,e,n){if(e){var r=e.x,i=e.y,s=e.width,o=e.height;t.x=r,t.y=i,t.width=s,t.height=o;var a=n&&n.lineWidth;return a?(t.x=ug(r,a,!0),t.y=ug(i,a,!0),t.width=Math.max(ug(r+s,a,!1)-t.x,0===s?0:1),t.height=Math.max(ug(i+o,a,!1)-t.y,0===o?0:1),t):t}}function ug(t,e,n){if(!e)return t;var r=lg(2*t);return(r+lg(e))%2==0?r/2:(r+(n?1:-1))/2}var dg=function(){this.x=0,this.y=0,this.width=0,this.height=0},fg={},pg=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new dg},e.prototype.buildPath=function(t,e){var n,r,i,s;if(this.subPixelOptimize){var o=hg(fg,e,this.style);n=o.x,r=o.y,i=o.width,s=o.height,o.r=e.r,e=o}else n=e.x,r=e.y,i=e.width,s=e.height;e.r?function(t,e){var n,r,i,s,o,a=e.x,l=e.y,c=e.width,h=e.height,u=e.r;c<0&&(a+=c,c=-c),h<0&&(l+=h,h=-h),"number"==typeof u?n=r=i=s=u:u instanceof Array?1===u.length?n=r=i=s=u[0]:2===u.length?(n=i=u[0],r=s=u[1]):3===u.length?(n=u[0],r=s=u[1],i=u[2]):(n=u[0],r=u[1],i=u[2],s=u[3]):n=r=i=s=0,n+r>c&&(n*=c/(o=n+r),r*=c/o),i+s>c&&(i*=c/(o=i+s),s*=c/o),r+i>h&&(r*=h/(o=r+i),i*=h/o),n+s>h&&(n*=h/(o=n+s),s*=h/o),t.moveTo(a+n,l),t.lineTo(a+c-r,l),0!==r&&t.arc(a+c-r,l+r,r,-Math.PI/2,0),t.lineTo(a+c,l+h-i),0!==i&&t.arc(a+c-i,l+h-i,i,0,Math.PI/2),t.lineTo(a+s,l+h),0!==s&&t.arc(a+s,l+h-s,s,Math.PI/2,Math.PI),t.lineTo(a,l+n),0!==n&&t.arc(a+n,l+n,n,Math.PI,1.5*Math.PI)}(t,e):t.rect(n,r,i,s)},e.prototype.isZeroArea=function(){return!this.shape.width||!this.shape.height},e}(tg);pg.prototype.type="rect";const mg=pg;var gg={fill:"#000"},vg={style:fc({fill:!0,stroke:!0,fillOpacity:!0,strokeOpacity:!0,lineWidth:!0,fontSize:!0,lineHeight:!0,width:!0,height:!0,textShadowColor:!0,textShadowBlur:!0,textShadowOffsetX:!0,textShadowOffsetY:!0,backgroundColor:!0,padding:!0,borderColor:!0,borderWidth:!0,borderRadius:!0},Yp.style)},yg=function(t){function e(e){var n=t.call(this)||this;return n.type="text",n._children=[],n._defaultStyle=gg,n.attr(e),n}return sh(e,t),e.prototype.childrenRef=function(){return this._children},e.prototype.update=function(){t.prototype.update.call(this),this.styleChanged()&&this._updateSubTexts();for(var e=0;e<this._children.length;e++){var n=this._children[e];n.zlevel=this.zlevel,n.z=this.z,n.z2=this.z2,n.culling=this.culling,n.cursor=this.cursor,n.invisible=this.invisible}},e.prototype.updateTransform=function(){var e=this.innerTransformable;e?(e.updateTransform(),e.transform&&(this.transform=e.transform)):t.prototype.updateTransform.call(this)},e.prototype.getLocalTransform=function(e){var n=this.innerTransformable;return n?n.getLocalTransform(e):t.prototype.getLocalTransform.call(this,e)},e.prototype.getComputedTransform=function(){return this.__hostTarget&&(this.__hostTarget.getComputedTransform(),this.__hostTarget.updateInnerText(!0)),t.prototype.getComputedTransform.call(this)},e.prototype._updateSubTexts=function(){var t;this._childCursor=0,Tg(t=this.style),yc(t.rich,Tg),this.style.rich?this._updateRichTexts():this._updatePlainTexts(),this._children.length=this._childCursor,this.styleUpdated()},e.prototype.addSelfToZr=function(e){t.prototype.addSelfToZr.call(this,e);for(var n=0;n<this._children.length;n++)this._children[n].__zr=e},e.prototype.removeSelfFromZr=function(e){t.prototype.removeSelfFromZr.call(this,e);for(var n=0;n<this._children.length;n++)this._children[n].__zr=null},e.prototype.getBoundingRect=function(){if(this.styleChanged()&&this._updateSubTexts(),!this._rect){for(var t=new gu(0,0,0,0),e=this._children,n=[],r=null,i=0;i<e.length;i++){var s=e[i],o=s.getBoundingRect(),a=s.getLocalTransform(n);a?(t.copy(o),t.applyTransform(a),(r=r||t.clone()).union(t)):(r=r||o.clone()).union(o)}this._rect=r||t}return this._rect},e.prototype.setDefaultTextStyle=function(t){this._defaultStyle=t||gg},e.prototype.setTextContent=function(t){},e.prototype._mergeStyle=function(t,e){if(!e)return t;var n=e.rich,r=t.rich||n&&{};return dc(t,e),n&&r?(this._mergeRich(r,n),t.rich=r):r&&(t.rich=r),t},e.prototype._mergeRich=function(t,e){for(var n=_c(e),r=0;r<n.length;r++){var i=n[r];t[i]=t[i]||{},dc(t[i],e[i])}},e.prototype.getAnimationStyleProps=function(){return vg},e.prototype._getOrCreateChild=function(t){var e=this._children[this._childCursor];return e&&e instanceof t||(e=new t),this._children[this._childCursor++]=e,e.__zr=this.__zr,e.parent=this,e},e.prototype._updatePlainTexts=function(){var t=this.style,e=t.font||Wl,n=t.padding,r=function(t,e){null!=t&&(t+="");var n,r=e.overflow,i=e.padding,s=e.font,o="truncate"===r,a=ap(s),l=Uc(e.lineHeight,a),c=!!e.backgroundColor,h="truncate"===e.lineOverflow,u=e.width,d=(n=null==u||"break"!==r&&"breakAll"!==r?t?t.split("\n"):[]:t?Wp(t,e.font,u,"breakAll"===r,0).lines:[]).length*l,f=Uc(e.height,d);if(d>f&&h){var p=Math.floor(f/l);n=n.slice(0,p)}if(t&&o&&null!=u)for(var m=Lp(u,s,e.ellipsis,{minChar:e.truncateMinChar,placeholder:e.placeholder}),g=0;g<n.length;g++)n[g]=Fp(n[g],m);var v=f,y=0;for(g=0;g<n.length;g++)y=Math.max(np(n[g],s),y);null==u&&(u=y);var b=y;return i&&(v+=i[0]+i[2],b+=i[1]+i[3],u+=i[1]+i[3]),c&&(b=u),{lines:n,height:f,outerWidth:b,outerHeight:v,lineHeight:l,calculatedLineHeight:a,contentWidth:y,contentHeight:d,width:u}}(Rg(t),t),i=Mg(t),s=!!t.backgroundColor,o=r.outerHeight,a=r.outerWidth,l=r.contentWidth,c=r.lines,h=r.lineHeight,u=this._defaultStyle,d=t.x||0,f=t.y||0,p=t.align||u.align||"left",m=t.verticalAlign||u.verticalAlign||"top",g=d,v=op(f,r.contentHeight,m);if(i||n){var y=sp(d,a,p),b=op(f,o,m);i&&this._renderBackground(t,t,y,b,a,o)}v+=h/2,n&&(g=Cg(d,p,n),"top"===m?v+=n[0]:"bottom"===m&&(v-=n[2]));for(var x=0,w=!1,E=(Ag("fill"in t?t.fill:(w=!0,u.fill))),_=(kg("stroke"in t?t.stroke:s||u.autoStroke&&!w?null:(x=2,u.stroke))),S=t.textShadowBlur>0,T=null!=t.width&&("truncate"===t.overflow||"break"===t.overflow||"breakAll"===t.overflow),k=r.calculatedLineHeight,A=0;A<c.length;A++){var C=this._getOrCreateChild(rg),R=C.createStyle();C.useStyle(R),R.text=c[A],R.x=g,R.y=v,p&&(R.textAlign=p),R.textBaseline="middle",R.opacity=t.opacity,R.strokeFirst=!0,S&&(R.shadowBlur=t.textShadowBlur||0,R.shadowColor=t.textShadowColor||"transparent",R.shadowOffsetX=t.textShadowOffsetX||0,R.shadowOffsetY=t.textShadowOffsetY||0),R.stroke=_,R.fill=E,_&&(R.lineWidth=t.lineWidth||x,R.lineDash=t.lineDash,R.lineDashOffset=t.lineDashOffset||0),R.font=e,_g(R,t),v+=h,T&&C.setBoundingRect(new gu(sp(R.x,t.width,R.textAlign),op(R.y,k,R.textBaseline),l,k))}},e.prototype._updateRichTexts=function(){var t=this.style,e=function(t,e){var n=new Vp;if(null!=t&&(t+=""),!t)return n;for(var r,i=e.width,s=e.height,o=e.overflow,a="break"!==o&&"breakAll"!==o||null==i?null:{width:i,accumWidth:0,breakAll:"breakAll"===o},l=Op.lastIndex=0;null!=(r=Op.exec(t));){var c=r.index;c>l&&jp(n,t.substring(l,c),e,a),jp(n,r[2],e,a,r[1]),l=Op.lastIndex}l<t.length&&jp(n,t.substring(l,t.length),e,a);var h=[],u=0,d=0,f=e.padding,p="truncate"===o,m="truncate"===e.lineOverflow;function g(t,e,n){t.width=e,t.lineHeight=n,u+=n,d=Math.max(d,e)}t:for(var v=0;v<n.lines.length;v++){for(var y=n.lines[v],b=0,x=0,w=0;w<y.tokens.length;w++){var E=(D=y.tokens[w]).styleName&&e.rich[D.styleName]||{},_=D.textPadding=E.padding,S=_?_[1]+_[3]:0,T=D.font=E.font||e.font;D.contentHeight=ap(T);var k=Uc(E.height,D.contentHeight);if(D.innerHeight=k,_&&(k+=_[0]+_[2]),D.height=k,D.lineHeight=Vc(E.lineHeight,e.lineHeight,k),D.align=E&&E.align||e.align,D.verticalAlign=E&&E.verticalAlign||"middle",m&&null!=s&&u+D.lineHeight>s){w>0?(y.tokens=y.tokens.slice(0,w),g(y,x,b),n.lines=n.lines.slice(0,v+1)):n.lines=n.lines.slice(0,v);break t}var A=E.width,C=null==A||"auto"===A;if("string"==typeof A&&"%"===A.charAt(A.length-1))D.percentWidth=A,h.push(D),D.contentWidth=np(D.text,T);else{if(C){var R=E.backgroundColor,M=R&&R.image;M&&Dp(M=Rp(M))&&(D.width=Math.max(D.width,M.width*k/M.height))}var I=p&&null!=i?i-x:null;null!=I&&I<D.width?!C||I<S?(D.text="",D.width=D.contentWidth=0):(D.text=Pp(D.text,I-S,T,e.ellipsis,{minChar:e.truncateMinChar}),D.width=D.contentWidth=np(D.text,T)):D.contentWidth=np(D.text,T)}D.width+=S,x+=D.width,E&&(b=Math.max(b,D.lineHeight))}g(y,x,b)}for(n.outerWidth=n.width=Uc(i,d),n.outerHeight=n.height=Uc(s,u),n.contentHeight=u,n.contentWidth=d,f&&(n.outerWidth+=f[1]+f[3],n.outerHeight+=f[0]+f[2]),v=0;v<h.length;v++){var D,O=(D=h[v]).percentWidth;D.width=parseInt(O,10)/100*n.width}return n}(Rg(t),t),n=e.width,r=e.outerWidth,i=e.outerHeight,s=t.padding,o=t.x||0,a=t.y||0,l=this._defaultStyle,c=t.align||l.align,h=t.verticalAlign||l.verticalAlign,u=sp(o,r,c),d=op(a,i,h),f=u,p=d;s&&(f+=s[3],p+=s[0]);var m=f+n;Mg(t)&&this._renderBackground(t,t,u,d,r,i);for(var g=!!t.backgroundColor,v=0;v<e.lines.length;v++){for(var y=e.lines[v],b=y.tokens,x=b.length,w=y.lineHeight,E=y.width,_=0,S=f,T=m,k=x-1,A=void 0;_<x&&(!(A=b[_]).align||"left"===A.align);)this._placeToken(A,t,w,p,S,"left",g),E-=A.width,S+=A.width,_++;for(;k>=0&&"right"===(A=b[k]).align;)this._placeToken(A,t,w,p,T,"right",g),E-=A.width,T-=A.width,k--;for(S+=(n-(S-f)-(m-T)-E)/2;_<=k;)A=b[_],this._placeToken(A,t,w,p,S+A.width/2,"center",g),S+=A.width,_++;p+=w}},e.prototype._placeToken=function(t,e,n,r,i,s,o){var a=e.rich[t.styleName]||{};a.text=t.text;var l=t.verticalAlign,c=r+n/2;"top"===l?c=r+t.height/2:"bottom"===l&&(c=r+n-t.height/2),!t.isLineHolder&&Mg(a)&&this._renderBackground(a,e,"right"===s?i-t.width:"center"===s?i-t.width/2:i,c-t.height/2,t.width,t.height);var h=!!a.backgroundColor,u=t.textPadding;u&&(i=Cg(i,s,u),c-=t.height/2-u[0]-t.innerHeight/2);var d=this._getOrCreateChild(rg),f=d.createStyle();d.useStyle(f);var p=this._defaultStyle,m=!1,g=0,v=Ag("fill"in a?a.fill:"fill"in e?e.fill:(m=!0,p.fill)),y=kg("stroke"in a?a.stroke:"stroke"in e?e.stroke:h||o||p.autoStroke&&!m?null:(g=2,p.stroke)),b=a.textShadowBlur>0||e.textShadowBlur>0;f.text=t.text,f.x=i,f.y=c,b&&(f.shadowBlur=a.textShadowBlur||e.textShadowBlur||0,f.shadowColor=a.textShadowColor||e.textShadowColor||"transparent",f.shadowOffsetX=a.textShadowOffsetX||e.textShadowOffsetX||0,f.shadowOffsetY=a.textShadowOffsetY||e.textShadowOffsetY||0),f.textAlign=s,f.textBaseline="middle",f.font=t.font||Wl,f.opacity=Vc(a.opacity,e.opacity,1),_g(f,a),y&&(f.lineWidth=Vc(a.lineWidth,e.lineWidth,g),f.lineDash=Uc(a.lineDash,e.lineDash),f.lineDashOffset=e.lineDashOffset||0,f.stroke=y),v&&(f.fill=v);var x=t.contentWidth,w=t.contentHeight;d.setBoundingRect(new gu(sp(f.x,x,f.textAlign),op(f.y,w,f.textBaseline),x,w))},e.prototype._renderBackground=function(t,e,n,r,i,s){var o,a,l,c=t.backgroundColor,h=t.borderWidth,u=t.borderColor,d=c&&c.image,f=c&&!d,p=t.borderRadius,m=this;if(f||t.lineHeight||h&&u){(o=this._getOrCreateChild(mg)).useStyle(o.createStyle()),o.style.fill=null;var g=o.shape;g.x=n,g.y=r,g.width=i,g.height=s,g.r=p,o.dirtyShape()}if(f)(l=o.style).fill=c||null,l.fillOpacity=Uc(t.fillOpacity,1);else if(d){(a=this._getOrCreateChild(ag)).onload=function(){m.dirtyStyle()};var v=a.style;v.image=c.image,v.x=n,v.y=r,v.width=i,v.height=s}h&&u&&((l=o.style).lineWidth=h,l.stroke=u,l.strokeOpacity=Uc(t.strokeOpacity,1),l.lineDash=t.borderDash,l.lineDashOffset=t.borderDashOffset||0,o.strokeContainThreshold=0,o.hasFill()&&o.hasStroke()&&(l.strokeFirst=!0,l.lineWidth*=2));var y=(o||a).style;y.shadowBlur=t.shadowBlur||0,y.shadowColor=t.shadowColor||"transparent",y.shadowOffsetX=t.shadowOffsetX||0,y.shadowOffsetY=t.shadowOffsetY||0,y.opacity=Vc(t.opacity,e.opacity,1)},e.makeFont=function(t){var e="";return Sg(t)&&(e=[t.fontStyle,t.fontWeight,Eg(t.fontSize),t.fontFamily||"sans-serif"].join(" ")),e&&Wc(e)||t.textFont||t.font},e}(Qp),bg={left:!0,right:1,center:1},xg={top:1,bottom:1,middle:1},wg=["fontStyle","fontWeight","fontSize","fontFamily"];function Eg(t){return"string"!=typeof t||-1===t.indexOf("px")&&-1===t.indexOf("rem")&&-1===t.indexOf("em")?isNaN(+t)?zl+"px":t+"px":t}function _g(t,e){for(var n=0;n<wg.length;n++){var r=wg[n],i=e[r];null!=i&&(t[r]=i)}}function Sg(t){return null!=t.fontSize||t.fontFamily||t.fontWeight}function Tg(t){if(t){t.font=yg.makeFont(t);var e=t.align;"middle"===e&&(e="center"),t.align=null==e||bg[e]?e:"left";var n=t.verticalAlign;"center"===n&&(n="middle"),t.verticalAlign=null==n||xg[n]?n:"top",t.padding&&(t.padding=zc(t.padding))}}function kg(t,e){return null==t||e<=0||"transparent"===t||"none"===t?null:t.image||t.colorStops?"#000":t}function Ag(t){return null==t||"none"===t?null:t.image||t.colorStops?"#000":t}function Cg(t,e,n){return"right"===e?t-n[1]:"center"===e?t+n[3]/2-n[1]/2:t+n[3]}function Rg(t){var e=t.text;return null!=e&&(e+=""),e}function Mg(t){return!!(t.backgroundColor||t.lineHeight||t.borderWidth&&t.borderColor)}const Ig=yg;var Dg=Om.CMD,Og=[[],[],[]],Pg=Math.sqrt,Lg=Math.atan2;function Fg(t,e){if(e){var n,r,i,s,o,a,l=t.data,c=t.len(),h=Dg.M,u=Dg.C,d=Dg.L,f=Dg.R,p=Dg.A,m=Dg.Q;for(i=0,s=0;i<c;){switch(n=l[i++],s=i,r=0,n){case h:case d:r=1;break;case u:r=3;break;case m:r=2;break;case p:var g=e[4],v=e[5],y=Pg(e[0]*e[0]+e[1]*e[1]),b=Pg(e[2]*e[2]+e[3]*e[3]),x=Lg(-e[1]/b,e[0]/y);l[i]*=y,l[i++]+=g,l[i]*=b,l[i++]+=v,l[i++]*=y,l[i++]*=b,l[i++]+=x,l[i++]+=x,s=i+=2;break;case f:a[0]=l[i++],a[1]=l[i++],xh(a,a,e),l[s++]=a[0],l[s++]=a[1],a[0]+=l[i++],a[1]+=l[i++],xh(a,a,e),l[s++]=a[0],l[s++]=a[1]}for(o=0;o<r;o++){var w=Og[o];w[0]=l[i++],w[1]=l[i++],xh(w,w,e),l[s++]=w[0],l[s++]=w[1]}}t.increaseVersion()}}var Ng=Math.sqrt,Bg=Math.sin,Ug=Math.cos,Vg=Math.PI;function jg(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function zg(t,e){return(t[0]*e[0]+t[1]*e[1])/(jg(t)*jg(e))}function Gg(t,e){return(t[0]*e[1]<t[1]*e[0]?-1:1)*Math.acos(zg(t,e))}function Wg(t,e,n,r,i,s,o,a,l,c,h){var u=l*(Vg/180),d=Ug(u)*(t-n)/2+Bg(u)*(e-r)/2,f=-1*Bg(u)*(t-n)/2+Ug(u)*(e-r)/2,p=d*d/(o*o)+f*f/(a*a);p>1&&(o*=Ng(p),a*=Ng(p));var m=(i===s?-1:1)*Ng((o*o*(a*a)-o*o*(f*f)-a*a*(d*d))/(o*o*(f*f)+a*a*(d*d)))||0,g=m*o*f/a,v=m*-a*d/o,y=(t+n)/2+Ug(u)*g-Bg(u)*v,b=(e+r)/2+Bg(u)*g+Ug(u)*v,x=Gg([1,0],[(d-g)/o,(f-v)/a]),w=[(d-g)/o,(f-v)/a],E=[(-1*d-g)/o,(-1*f-v)/a],_=Gg(w,E);if(zg(w,E)<=-1&&(_=Vg),zg(w,E)>=1&&(_=0),_<0){var S=Math.round(_/Vg*1e6)/1e6;_=2*Vg+S%2*Vg}h.addData(c,y,b,o,a,x,_,u,s)}var Hg=/([mlvhzcqtsa])([^mlvhzcqtsa]*)/gi,$g=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;var Yg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return sh(e,t),e.prototype.applyTransform=function(t){},e}(tg);function Xg(t){return null!=t.setData}function qg(t,e){var n=function(t){var e=new Om;if(!t)return e;var n,r=0,i=0,s=r,o=i,a=Om.CMD,l=t.match(Hg);if(!l)return e;for(var c=0;c<l.length;c++){for(var h=l[c],u=h.charAt(0),d=void 0,f=h.match($g)||[],p=f.length,m=0;m<p;m++)f[m]=parseFloat(f[m]);for(var g=0;g<p;){var v=void 0,y=void 0,b=void 0,x=void 0,w=void 0,E=void 0,_=void 0,S=r,T=i,k=void 0,A=void 0;switch(u){case"l":r+=f[g++],i+=f[g++],d=a.L,e.addData(d,r,i);break;case"L":r=f[g++],i=f[g++],d=a.L,e.addData(d,r,i);break;case"m":r+=f[g++],i+=f[g++],d=a.M,e.addData(d,r,i),s=r,o=i,u="l";break;case"M":r=f[g++],i=f[g++],d=a.M,e.addData(d,r,i),s=r,o=i,u="L";break;case"h":r+=f[g++],d=a.L,e.addData(d,r,i);break;case"H":r=f[g++],d=a.L,e.addData(d,r,i);break;case"v":i+=f[g++],d=a.L,e.addData(d,r,i);break;case"V":i=f[g++],d=a.L,e.addData(d,r,i);break;case"C":d=a.C,e.addData(d,f[g++],f[g++],f[g++],f[g++],f[g++],f[g++]),r=f[g-2],i=f[g-1];break;case"c":d=a.C,e.addData(d,f[g++]+r,f[g++]+i,f[g++]+r,f[g++]+i,f[g++]+r,f[g++]+i),r+=f[g-2],i+=f[g-1];break;case"S":v=r,y=i,k=e.len(),A=e.data,n===a.C&&(v+=r-A[k-4],y+=i-A[k-3]),d=a.C,S=f[g++],T=f[g++],r=f[g++],i=f[g++],e.addData(d,v,y,S,T,r,i);break;case"s":v=r,y=i,k=e.len(),A=e.data,n===a.C&&(v+=r-A[k-4],y+=i-A[k-3]),d=a.C,S=r+f[g++],T=i+f[g++],r+=f[g++],i+=f[g++],e.addData(d,v,y,S,T,r,i);break;case"Q":S=f[g++],T=f[g++],r=f[g++],i=f[g++],d=a.Q,e.addData(d,S,T,r,i);break;case"q":S=f[g++]+r,T=f[g++]+i,r+=f[g++],i+=f[g++],d=a.Q,e.addData(d,S,T,r,i);break;case"T":v=r,y=i,k=e.len(),A=e.data,n===a.Q&&(v+=r-A[k-4],y+=i-A[k-3]),r=f[g++],i=f[g++],d=a.Q,e.addData(d,v,y,r,i);break;case"t":v=r,y=i,k=e.len(),A=e.data,n===a.Q&&(v+=r-A[k-4],y+=i-A[k-3]),r+=f[g++],i+=f[g++],d=a.Q,e.addData(d,v,y,r,i);break;case"A":b=f[g++],x=f[g++],w=f[g++],E=f[g++],_=f[g++],Wg(S=r,T=i,r=f[g++],i=f[g++],E,_,b,x,w,d=a.A,e);break;case"a":b=f[g++],x=f[g++],w=f[g++],E=f[g++],_=f[g++],Wg(S=r,T=i,r+=f[g++],i+=f[g++],E,_,b,x,w,d=a.A,e)}}"z"!==u&&"Z"!==u||(d=a.Z,e.addData(d),r=s,i=o),n=d}return e.toStatic(),e}(t),r=dc({},e);return r.buildPath=function(t){if(Xg(t)){t.setData(n.data),(e=t.getContext())&&t.rebuildPath(e,1)}else{var e=t;n.rebuildPath(e,1)}},r.applyTransform=function(t){Fg(n,t),this.dirtyShape()},r}function Kg(t,e){return new Yg(qg(t,e))}function Zg(t,e){var n=qg(t,e);return function(t){function e(e){var r=t.call(this,e)||this;return r.applyTransform=n.applyTransform,r.buildPath=n.buildPath,r}return sh(e,t),e}(Yg)}function Jg(t,e){for(var n=[],r=t.length,i=0;i<r;i++){var s=t[i];n.push(s.getUpdatedPathProxy(!0))}var o=new tg(e);return o.createPathProxy(),o.buildPath=function(t){if(Xg(t)){t.appendPath(n);var e=t.getContext();e&&t.rebuildPath(e,1)}},o}function Qg(t,e){e=e||{};var n=new tg;return t.shape&&n.setShape(t.shape),n.setStyle(t.style),e.bakeTransform?Fg(n.path,t.getComputedTransform()):e.toLocal?n.setLocalTransform(t.getComputedTransform()):n.copyTransform(t),n.buildPath=t.buildPath,n.applyTransform=n.applyTransform,n.z=t.z,n.z2=t.z2,n.zlevel=t.zlevel,n}var tv=function(){this.cx=0,this.cy=0,this.r=0},ev=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new tv},e.prototype.buildPath=function(t,e){t.moveTo(e.cx+e.r,e.cy),t.arc(e.cx,e.cy,e.r,0,2*Math.PI)},e}(tg);ev.prototype.type="circle";const nv=ev;var rv=function(){this.cx=0,this.cy=0,this.rx=0,this.ry=0},iv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new rv},e.prototype.buildPath=function(t,e){var n=.5522848,r=e.cx,i=e.cy,s=e.rx,o=e.ry,a=s*n,l=o*n;t.moveTo(r-s,i),t.bezierCurveTo(r-s,i-l,r-a,i-o,r,i-o),t.bezierCurveTo(r+a,i-o,r+s,i-l,r+s,i),t.bezierCurveTo(r+s,i+l,r+a,i+o,r,i+o),t.bezierCurveTo(r-a,i+o,r-s,i+l,r-s,i),t.closePath()},e}(tg);iv.prototype.type="ellipse";const sv=iv;var ov=Math.PI,av=2*ov,lv=Math.sin,cv=Math.cos,hv=Math.acos,uv=Math.atan2,dv=Math.abs,fv=Math.sqrt,pv=Math.max,mv=Math.min,gv=1e-4;function vv(t,e,n,r,i,s,o){var a=t-n,l=e-r,c=(o?s:-s)/fv(a*a+l*l),h=c*l,u=-c*a,d=t+h,f=e+u,p=n+h,m=r+u,g=(d+p)/2,v=(f+m)/2,y=p-d,b=m-f,x=y*y+b*b,w=i-s,E=d*m-p*f,_=(b<0?-1:1)*fv(pv(0,w*w*x-E*E)),S=(E*b-y*_)/x,T=(-E*y-b*_)/x,k=(E*b+y*_)/x,A=(-E*y+b*_)/x,C=S-g,R=T-v,M=k-g,I=A-v;return C*C+R*R>M*M+I*I&&(S=k,T=A),{cx:S,cy:T,x0:-h,y0:-u,x1:S*(i/w-1),y1:T*(i/w-1)}}function yv(t,e){var n,r=pv(e.r,0),i=pv(e.r0||0,0),s=r>0;if(s||i>0){if(s||(r=i,i=0),i>r){var o=r;r=i,i=o}var a=e.startAngle,l=e.endAngle;if(!isNaN(a)&&!isNaN(l)){var c=e.cx,h=e.cy,u=!!e.clockwise,d=dv(l-a),f=d>av&&d%av;if(f>gv&&(d=f),r>gv)if(d>av-gv)t.moveTo(c+r*cv(a),h+r*lv(a)),t.arc(c,h,r,a,l,!u),i>gv&&(t.moveTo(c+i*cv(l),h+i*lv(l)),t.arc(c,h,i,l,a,u));else{var p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,x=void 0,w=void 0,E=void 0,_=void 0,S=void 0,T=void 0,k=void 0,A=void 0,C=void 0,R=void 0,M=r*cv(a),I=r*lv(a),D=i*cv(l),O=i*lv(l),P=d>gv;if(P){var L=e.cornerRadius;L&&(p=(n=function(t){var e;if(kc(t)){var n=t.length;if(!n)return t;e=1===n?[t[0],t[0],0,0]:2===n?[t[0],t[0],t[1],t[1]]:3===n?t.concat(t[2]):t}else e=[t,t,t,t];return e}(L))[0],m=n[1],g=n[2],v=n[3]);var F=dv(r-i)/2;if(y=mv(F,g),b=mv(F,v),x=mv(F,p),w=mv(F,m),S=E=pv(y,b),T=_=pv(x,w),(E>gv||_>gv)&&(k=r*cv(l),A=r*lv(l),C=i*cv(a),R=i*lv(a),d<ov)){var N=function(t,e,n,r,i,s,o,a){var l=n-t,c=r-e,h=o-i,u=a-s,d=u*l-h*c;if(!(d*d<gv))return[t+(d=(h*(e-s)-u*(t-i))/d)*l,e+d*c]}(M,I,C,R,k,A,D,O);if(N){var B=M-N[0],U=I-N[1],V=k-N[0],j=A-N[1],z=1/lv(hv((B*V+U*j)/(fv(B*B+U*U)*fv(V*V+j*j)))/2),G=fv(N[0]*N[0]+N[1]*N[1]);S=mv(E,(r-G)/(z+1)),T=mv(_,(i-G)/(z-1))}}}if(P)if(S>gv){var W=mv(g,S),H=mv(v,S),$=vv(C,R,M,I,r,W,u),Y=vv(k,A,D,O,r,H,u);t.moveTo(c+$.cx+$.x0,h+$.cy+$.y0),S<E&&W===H?t.arc(c+$.cx,h+$.cy,S,uv($.y0,$.x0),uv(Y.y0,Y.x0),!u):(W>0&&t.arc(c+$.cx,h+$.cy,W,uv($.y0,$.x0),uv($.y1,$.x1),!u),t.arc(c,h,r,uv($.cy+$.y1,$.cx+$.x1),uv(Y.cy+Y.y1,Y.cx+Y.x1),!u),H>0&&t.arc(c+Y.cx,h+Y.cy,H,uv(Y.y1,Y.x1),uv(Y.y0,Y.x0),!u))}else t.moveTo(c+M,h+I),t.arc(c,h,r,a,l,!u);else t.moveTo(c+M,h+I);if(i>gv&&P)if(T>gv){W=mv(p,T),$=vv(D,O,k,A,i,-(H=mv(m,T)),u),Y=vv(M,I,C,R,i,-W,u);t.lineTo(c+$.cx+$.x0,h+$.cy+$.y0),T<_&&W===H?t.arc(c+$.cx,h+$.cy,T,uv($.y0,$.x0),uv(Y.y0,Y.x0),!u):(H>0&&t.arc(c+$.cx,h+$.cy,H,uv($.y0,$.x0),uv($.y1,$.x1),!u),t.arc(c,h,i,uv($.cy+$.y1,$.cx+$.x1),uv(Y.cy+Y.y1,Y.cx+Y.x1),u),W>0&&t.arc(c+Y.cx,h+Y.cy,W,uv(Y.y1,Y.x1),uv(Y.y0,Y.x0),!u))}else t.lineTo(c+D,h+O),t.arc(c,h,i,l,a,u);else t.lineTo(c+D,h+O)}else t.moveTo(c,h);t.closePath()}}}var bv=function(){this.cx=0,this.cy=0,this.r0=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0,this.cornerRadius=0},xv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new bv},e.prototype.buildPath=function(t,e){yv(t,e)},e.prototype.isZeroArea=function(){return this.shape.startAngle===this.shape.endAngle||this.shape.r===this.shape.r0},e}(tg);xv.prototype.type="sector";const wv=xv;var Ev=function(){this.cx=0,this.cy=0,this.r=0,this.r0=0},_v=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new Ev},e.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=2*Math.PI;t.moveTo(n+e.r,r),t.arc(n,r,e.r,0,i,!1),t.moveTo(n+e.r0,r),t.arc(n,r,e.r0,0,i,!0)},e}(tg);_v.prototype.type="ring";const Sv=_v;function Tv(t,e,n){var r=e.smooth,i=e.points;if(i&&i.length>=2){if(r){var s=function(t,e,n,r){var i,s,o,a,l=[],c=[],h=[],u=[];if(r){o=[1/0,1/0],a=[-1/0,-1/0];for(var d=0,f=t.length;d<f;d++)wh(o,o,t[d]),Eh(a,a,t[d]);wh(o,o,r[0]),Eh(a,a,r[1])}for(d=0,f=t.length;d<f;d++){var p=t[d];if(n)i=t[d?d-1:f-1],s=t[(d+1)%f];else{if(0===d||d===f-1){l.push(lh(t[d]));continue}i=t[d-1],s=t[d+1]}dh(c,s,i),ph(c,c,e);var m=gh(p,i),g=gh(p,s),v=m+g;0!==v&&(m/=v,g/=v),ph(h,c,-m),ph(u,c,g);var y=hh([],p,h),b=hh([],p,u);r&&(Eh(y,y,o),wh(y,y,a),Eh(b,b,o),wh(b,b,a)),l.push(y),l.push(b)}return n&&l.push(l.shift()),l}(i,r,n,e.smoothConstraint);t.moveTo(i[0][0],i[0][1]);for(var o=i.length,a=0;a<(n?o:o-1);a++){var l=s[2*a],c=s[2*a+1],h=i[(a+1)%o];t.bezierCurveTo(l[0],l[1],c[0],c[1],h[0],h[1])}}else{t.moveTo(i[0][0],i[0][1]);a=1;for(var u=i.length;a<u;a++)t.lineTo(i[a][0],i[a][1])}n&&t.closePath()}}var kv=function(){this.points=null,this.smooth=0,this.smoothConstraint=null},Av=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultShape=function(){return new kv},e.prototype.buildPath=function(t,e){Tv(t,e,!0)},e}(tg);Av.prototype.type="polygon";const Cv=Av;var Rv=function(){this.points=null,this.percent=1,this.smooth=0,this.smoothConstraint=null},Mv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Rv},e.prototype.buildPath=function(t,e){Tv(t,e,!1)},e}(tg);Mv.prototype.type="polyline";const Iv=Mv;var Dv={},Ov=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.percent=1},Pv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Ov},e.prototype.buildPath=function(t,e){var n,r,i,s;if(this.subPixelOptimize){var o=cg(Dv,e,this.style);n=o.x1,r=o.y1,i=o.x2,s=o.y2}else n=e.x1,r=e.y1,i=e.x2,s=e.y2;var a=e.percent;0!==a&&(t.moveTo(n,r),a<1&&(i=n*(1-a)+i*a,s=r*(1-a)+s*a),t.lineTo(i,s))},e.prototype.pointAt=function(t){var e=this.shape;return[e.x1*(1-t)+e.x2*t,e.y1*(1-t)+e.y2*t]},e}(tg);Pv.prototype.type="line";const Lv=Pv;var Fv=[],Nv=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0,this.cpx1=0,this.cpy1=0,this.percent=1};function Bv(t,e,n){var r=t.cpx2,i=t.cpy2;return null!=r||null!=i?[(n?rd:nd)(t.x1,t.cpx1,t.cpx2,t.x2,e),(n?rd:nd)(t.y1,t.cpy1,t.cpy2,t.y2,e)]:[(n?hd:cd)(t.x1,t.cpx1,t.x2,e),(n?hd:cd)(t.y1,t.cpy1,t.y2,e)]}var Uv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new Nv},e.prototype.buildPath=function(t,e){var n=e.x1,r=e.y1,i=e.x2,s=e.y2,o=e.cpx1,a=e.cpy1,l=e.cpx2,c=e.cpy2,h=e.percent;0!==h&&(t.moveTo(n,r),null==l||null==c?(h<1&&(dd(n,o,i,h,Fv),o=Fv[1],i=Fv[2],dd(r,a,s,h,Fv),a=Fv[1],s=Fv[2]),t.quadraticCurveTo(o,a,i,s)):(h<1&&(od(n,o,l,i,h,Fv),o=Fv[1],l=Fv[2],i=Fv[3],od(r,a,c,s,h,Fv),a=Fv[1],c=Fv[2],s=Fv[3]),t.bezierCurveTo(o,a,l,c,i,s)))},e.prototype.pointAt=function(t){return Bv(this.shape,t,!1)},e.prototype.tangentAt=function(t){var e=Bv(this.shape,t,!0);return mh(e,e)},e}(tg);Uv.prototype.type="bezier-curve";const Vv=Uv;var jv=function(){this.cx=0,this.cy=0,this.r=0,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!0},zv=function(t){function e(e){return t.call(this,e)||this}return sh(e,t),e.prototype.getDefaultStyle=function(){return{stroke:"#000",fill:null}},e.prototype.getDefaultShape=function(){return new jv},e.prototype.buildPath=function(t,e){var n=e.cx,r=e.cy,i=Math.max(e.r,0),s=e.startAngle,o=e.endAngle,a=e.clockwise,l=Math.cos(s),c=Math.sin(s);t.moveTo(l*i+n,c*i+r),t.arc(n,r,i,s,o,!a)},e}(tg);zv.prototype.type="arc";const Gv=zv;const Wv=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.type="compound",e}return sh(e,t),e.prototype._updatePathDirty=function(){for(var t=this.shape.paths,e=this.shapeChanged(),n=0;n<t.length;n++)e=e||t[n].shapeChanged();e&&this.dirtyShape()},e.prototype.beforeBrush=function(){this._updatePathDirty();for(var t=this.shape.paths||[],e=this.getGlobalScale(),n=0;n<t.length;n++)t[n].path||t[n].createPathProxy(),t[n].path.setScale(e[0],e[1],t[n].segmentIgnoreThreshold)},e.prototype.buildPath=function(t,e){for(var n=e.paths||[],r=0;r<n.length;r++)n[r].buildPath(t,n[r].shape,!0)},e.prototype.afterBrush=function(){for(var t=this.shape.paths||[],e=0;e<t.length;e++)t[e].pathUpdated()},e.prototype.getBoundingRect=function(){return this._updatePathDirty.call(this),tg.prototype.getBoundingRect.call(this)},e}(tg);const Hv=function(){function t(t){this.colorStops=t||[]}return t.prototype.addColorStop=function(t,e){this.colorStops.push({offset:t,color:e})},t}();const $v=function(t){function e(e,n,r,i,s,o){var a=t.call(this,s)||this;return a.x=null==e?0:e,a.y=null==n?0:n,a.x2=null==r?1:r,a.y2=null==i?0:i,a.type="linear",a.global=o||!1,a}return sh(e,t),e}(Hv);const Yv=function(t){function e(e,n,r,i,s){var o=t.call(this,i)||this;return o.x=null==e?.5:e,o.y=null==n?.5:n,o.r=null==r?.5:r,o.type="radial",o.global=s||!1,o}return sh(e,t),e}(Hv);var Xv=[0,0],qv=[0,0],Kv=new au,Zv=new au;const Jv=function(){function t(t,e){this._corners=[],this._axes=[],this._origin=[0,0];for(var n=0;n<4;n++)this._corners[n]=new au;for(n=0;n<2;n++)this._axes[n]=new au;t&&this.fromBoundingRect(t,e)}return t.prototype.fromBoundingRect=function(t,e){var n=this._corners,r=this._axes,i=t.x,s=t.y,o=i+t.width,a=s+t.height;if(n[0].set(i,s),n[1].set(o,s),n[2].set(o,a),n[3].set(i,a),e)for(var l=0;l<4;l++)n[l].transform(e);au.sub(r[0],n[1],n[0]),au.sub(r[1],n[3],n[0]),r[0].normalize(),r[1].normalize();for(l=0;l<2;l++)this._origin[l]=r[l].dot(n[0])},t.prototype.intersect=function(t,e){var n=!0,r=!e;return Kv.set(1/0,1/0),Zv.set(0,0),!this._intersectCheckOneSide(this,t,Kv,Zv,r,1)&&(n=!1,r)||!this._intersectCheckOneSide(t,this,Kv,Zv,r,-1)&&(n=!1,r)||r||au.copy(e,n?Kv:Zv),n},t.prototype._intersectCheckOneSide=function(t,e,n,r,i,s){for(var o=!0,a=0;a<2;a++){var l=this._axes[a];if(this._getProjMinMaxOnAxis(a,t._corners,Xv),this._getProjMinMaxOnAxis(a,e._corners,qv),Xv[1]<qv[0]||Xv[0]>qv[1]){if(o=!1,i)return o;var c=Math.abs(qv[0]-Xv[1]),h=Math.abs(Xv[0]-qv[1]);Math.min(c,h)>r.len()&&(c<h?au.scale(r,l,-c*s):au.scale(r,l,h*s))}else if(n){c=Math.abs(qv[0]-Xv[1]),h=Math.abs(Xv[0]-qv[1]);Math.min(c,h)<n.len()&&(c<h?au.scale(n,l,c*s):au.scale(n,l,-h*s))}}return o},t.prototype._getProjMinMaxOnAxis=function(t,e,n){for(var r=this._axes[t],i=this._origin,s=e[0].dot(r)+i[t],o=s,a=s,l=1;l<e.length;l++){var c=e[l].dot(r)+i[t];o=Math.min(c,o),a=Math.max(c,a)}n[0]=o,n[1]=a},t}();var Qv=[];const ty=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.notClear=!0,e.incremental=!0,e._displayables=[],e._temporaryDisplayables=[],e._cursor=0,e}return sh(e,t),e.prototype.traverse=function(t,e){t.call(e,this)},e.prototype.useStyle=function(){this.style={}},e.prototype.getCursor=function(){return this._cursor},e.prototype.innerAfterBrush=function(){this._cursor=this._displayables.length},e.prototype.clearDisplaybles=function(){this._displayables=[],this._temporaryDisplayables=[],this._cursor=0,this.markRedraw(),this.notClear=!1},e.prototype.clearTemporalDisplayables=function(){this._temporaryDisplayables=[]},e.prototype.addDisplayable=function(t,e){e?this._temporaryDisplayables.push(t):this._displayables.push(t),this.markRedraw()},e.prototype.addDisplayables=function(t,e){e=e||!1;for(var n=0;n<t.length;n++)this.addDisplayable(t[n],e)},e.prototype.getDisplayables=function(){return this._displayables},e.prototype.getTemporalDisplayables=function(){return this._temporaryDisplayables},e.prototype.eachPendingDisplayable=function(t){for(var e=this._cursor;e<this._displayables.length;e++)t&&t(this._displayables[e]);for(e=0;e<this._temporaryDisplayables.length;e++)t&&t(this._temporaryDisplayables[e])},e.prototype.update=function(){this.updateTransform();for(var t=this._cursor;t<this._displayables.length;t++){(e=this._displayables[t]).parent=this,e.update(),e.parent=null}for(t=0;t<this._temporaryDisplayables.length;t++){var e;(e=this._temporaryDisplayables[t]).parent=this,e.update(),e.parent=null}},e.prototype.getBoundingRect=function(){if(!this._rect){for(var t=new gu(1/0,1/0,-1/0,-1/0),e=0;e<this._displayables.length;e++){var n=this._displayables[e],r=n.getBoundingRect().clone();n.needLocalTransform()&&r.applyTransform(n.getLocalTransform(Qv)),t.union(r)}this._rect=t}return this._rect},e.prototype.contain=function(t,e){var n=this.transformCoordToLocal(t,e);if(this.getBoundingRect().contain(n[0],n[1]))for(var r=0;r<this._displayables.length;r++){if(this._displayables[r].contain(t,e))return!0}return!1},e}(Qp);var ey=Math.round(9*Math.random()),ny="function"==typeof Object.defineProperty;const ry=function(){function t(){this._id="__ec_inner_"+ey++}return t.prototype.get=function(t){return this._guard(t)[this._id]},t.prototype.set=function(t,e){var n=this._guard(t);return ny?Object.defineProperty(n,this._id,{value:e,enumerable:!1,configurable:!0}):n[this._id]=e,this},t.prototype.delete=function(t){return!!this.has(t)&&(delete this._guard(t)[this._id],!0)},t.prototype.has=function(t){return!!this._guard(t)[this._id]},t.prototype._guard=function(t){if(t!==Object(t))throw TypeError("Value of WeakMap is not a non-null object.");return t},t}();function iy(t){return isFinite(t)}function sy(t,e,n){for(var r="radial"===e.type?function(t,e,n){var r=n.width,i=n.height,s=Math.min(r,i),o=null==e.x?.5:e.x,a=null==e.y?.5:e.y,l=null==e.r?.5:e.r;return e.global||(o=o*r+n.x,a=a*i+n.y,l*=s),o=iy(o)?o:.5,a=iy(a)?a:.5,l=l>=0&&iy(l)?l:.5,t.createRadialGradient(o,a,0,o,a,l)}(t,e,n):function(t,e,n){var r=null==e.x?0:e.x,i=null==e.x2?1:e.x2,s=null==e.y?0:e.y,o=null==e.y2?0:e.y2;return e.global||(r=r*n.width+n.x,i=i*n.width+n.x,s=s*n.height+n.y,o=o*n.height+n.y),r=iy(r)?r:0,i=iy(i)?i:1,s=iy(s)?s:0,o=iy(o)?o:0,t.createLinearGradient(r,s,i,o)}(t,e,n),i=e.colorStops,s=0;s<i.length;s++)r.addColorStop(i[s].offset,i[s].color);return r}function oy(t){return parseInt(t,10)}function ay(t,e,n){var r=["width","height"][e],i=["clientWidth","clientHeight"][e],s=["paddingLeft","paddingTop"][e],o=["paddingRight","paddingBottom"][e];if(null!=n[r]&&"auto"!==n[r])return parseFloat(n[r]);var a=document.defaultView.getComputedStyle(t);return(t[i]||oy(a[r])||oy(t.style[r]))-(oy(a[s])||0)-(oy(a[o])||0)|0}function ly(t){var e,n,r=t.style,i=r.lineDash&&r.lineWidth>0&&(e=r.lineDash,n=r.lineWidth,e&&"solid"!==e&&n>0?"dashed"===e?[4*n,2*n]:"dotted"===e?[n]:Mc(e)?[e]:kc(e)?e:null:null),s=r.lineDashOffset;if(i){var o=r.strokeNoScale&&t.getLineScale?t.getLineScale():1;o&&1!==o&&(i=bc(i,(function(t){return t/o})),s/=o)}return[i,s]}var cy=new Om(!0);function hy(t){var e=t.stroke;return!(null==e||"none"===e||!(t.lineWidth>0))}function uy(t){return"string"==typeof t&&"none"!==t}function dy(t){var e=t.fill;return null!=e&&"none"!==e}function fy(t,e){if(null!=e.fillOpacity&&1!==e.fillOpacity){var n=t.globalAlpha;t.globalAlpha=e.fillOpacity*e.opacity,t.fill(),t.globalAlpha=n}else t.fill()}function py(t,e){if(null!=e.strokeOpacity&&1!==e.strokeOpacity){var n=t.globalAlpha;t.globalAlpha=e.strokeOpacity*e.opacity,t.stroke(),t.globalAlpha=n}else t.stroke()}function my(t,e,n){var r=Mp(e.image,e.__image,n);if(Dp(r)){var i=t.createPattern(r,e.repeat||"repeat");if("function"==typeof DOMMatrix&&i&&i.setTransform){var s=new DOMMatrix;s.translateSelf(e.x||0,e.y||0),s.rotateSelf(0,0,(e.rotation||0)*rh),s.scaleSelf(e.scaleX||1,e.scaleY||1),i.setTransform(s)}return i}}var gy=["shadowBlur","shadowOffsetX","shadowOffsetY"],vy=[["lineCap","butt"],["lineJoin","miter"],["miterLimit",10]];function yy(t,e,n,r,i){var s=!1;if(!r&&e===(n=n||{}))return!1;if(r||e.opacity!==n.opacity){Ty(t,i),s=!0;var o=Math.max(Math.min(e.opacity,1),0);t.globalAlpha=isNaN(o)?$p.opacity:o}(r||e.blend!==n.blend)&&(s||(Ty(t,i),s=!0),t.globalCompositeOperation=e.blend||$p.blend);for(var a=0;a<gy.length;a++){var l=gy[a];(r||e[l]!==n[l])&&(s||(Ty(t,i),s=!0),t[l]=t.dpr*(e[l]||0))}return(r||e.shadowColor!==n.shadowColor)&&(s||(Ty(t,i),s=!0),t.shadowColor=e.shadowColor||$p.shadowColor),s}function by(t,e,n,r,i){var s=ky(e,i.inHover),o=r?null:n&&ky(n,i.inHover)||{};if(s===o)return!1;var a=yy(t,s,o,r,i);if((r||s.fill!==o.fill)&&(a||(Ty(t,i),a=!0),uy(s.fill)&&(t.fillStyle=s.fill)),(r||s.stroke!==o.stroke)&&(a||(Ty(t,i),a=!0),uy(s.stroke)&&(t.strokeStyle=s.stroke)),(r||s.opacity!==o.opacity)&&(a||(Ty(t,i),a=!0),t.globalAlpha=null==s.opacity?1:s.opacity),e.hasStroke()){var l=s.lineWidth/(s.strokeNoScale&&e.getLineScale?e.getLineScale():1);t.lineWidth!==l&&(a||(Ty(t,i),a=!0),t.lineWidth=l)}for(var c=0;c<vy.length;c++){var h=vy[c],u=h[0];(r||s[u]!==o[u])&&(a||(Ty(t,i),a=!0),t[u]=s[u]||h[1])}return a}function xy(t,e){var n=e.transform,r=t.dpr||1;n?t.setTransform(r*n[0],r*n[1],r*n[2],r*n[3],r*n[4],r*n[5]):t.setTransform(r,0,0,r,0,0)}var wy=1,Ey=2,_y=3,Sy=4;function Ty(t,e){e.batchFill&&t.fill(),e.batchStroke&&t.stroke(),e.batchFill="",e.batchStroke=""}function ky(t,e){return e&&t.__hoverStyle||t.style}function Ay(t,e){Cy(t,e,{inHover:!1,viewWidth:0,viewHeight:0},!0)}function Cy(t,e,n,r){var i=e.transform;if(!e.shouldBePainted(n.viewWidth,n.viewHeight,!1,!1))return e.__dirty&=~Fu,void(e.__isRendered=!1);var s=e.__clipPaths,o=n.prevElClipPaths,a=!1,l=!1;if(o&&!function(t,e){if(t===e||!t&&!e)return!1;if(!t||!e||t.length!==e.length)return!0;for(var n=0;n<t.length;n++)if(t[n]!==e[n])return!0;return!1}(s,o)||(o&&o.length&&(Ty(t,n),t.restore(),l=a=!0,n.prevElClipPaths=null,n.allClipped=!1,n.prevEl=null),s&&s.length&&(Ty(t,n),t.save(),function(t,e,n){for(var r=!1,i=0;i<t.length;i++){var s=t[i];r=r||s.isZeroArea(),xy(e,s),e.beginPath(),s.buildPath(e,s.shape),e.clip()}n.allClipped=r}(s,t,n),a=!0),n.prevElClipPaths=s),n.allClipped)e.__isRendered=!1;else{e.beforeBrush&&e.beforeBrush(),e.innerBeforeBrush();var c=n.prevEl;c||(l=a=!0);var h,u,d=e instanceof tg&&e.autoBatch&&function(t){var e=dy(t),n=hy(t);return!(t.lineDash||!(+e^+n)||e&&"string"!=typeof t.fill||n&&"string"!=typeof t.stroke||t.strokePercent<1||t.strokeOpacity<1||t.fillOpacity<1)}(e.style);a||(h=i,u=c.transform,h&&u?h[0]!==u[0]||h[1]!==u[1]||h[2]!==u[2]||h[3]!==u[3]||h[4]!==u[4]||h[5]!==u[5]:h||u)?(Ty(t,n),xy(t,e)):d||Ty(t,n);var f=ky(e,n.inHover);e instanceof tg?(n.lastDrawType!==wy&&(l=!0,n.lastDrawType=wy),by(t,e,c,l,n),d&&(n.batchFill||n.batchStroke)||t.beginPath(),function(t,e,n,r){var i,s=hy(n),o=dy(n),a=n.strokePercent,l=a<1,c=!e.path;e.silent&&!l||!c||e.createPathProxy();var h=e.path||cy,u=e.__dirty;if(!r){var d=n.fill,f=n.stroke,p=o&&!!d.colorStops,m=s&&!!f.colorStops,g=o&&!!d.image,v=s&&!!f.image,y=void 0,b=void 0,x=void 0,w=void 0,E=void 0;(p||m)&&(E=e.getBoundingRect()),p&&(y=u?sy(t,d,E):e.__canvasFillGradient,e.__canvasFillGradient=y),m&&(b=u?sy(t,f,E):e.__canvasStrokeGradient,e.__canvasStrokeGradient=b),g&&(x=u||!e.__canvasFillPattern?my(t,d,e):e.__canvasFillPattern,e.__canvasFillPattern=x),v&&(w=u||!e.__canvasStrokePattern?my(t,f,e):e.__canvasStrokePattern,e.__canvasStrokePattern=x),p?t.fillStyle=y:g&&(x?t.fillStyle=x:o=!1),m?t.strokeStyle=b:v&&(w?t.strokeStyle=w:s=!1)}var _,S,T=e.getGlobalScale();h.setScale(T[0],T[1],e.segmentIgnoreThreshold),t.setLineDash&&n.lineDash&&(_=(i=ly(e))[0],S=i[1]);var k=!0;(c||u&Nu)&&(h.setDPR(t.dpr),l?h.setContext(null):(h.setContext(t),k=!1),h.reset(),e.buildPath(h,e.shape,r),h.toStatic(),e.pathUpdated()),k&&h.rebuildPath(t,l?a:1),_&&(t.setLineDash(_),t.lineDashOffset=S),r||(n.strokeFirst?(s&&py(t,n),o&&fy(t,n)):(o&&fy(t,n),s&&py(t,n))),_&&t.setLineDash([])}(t,e,f,d),d&&(n.batchFill=f.fill||"",n.batchStroke=f.stroke||"")):e instanceof rg?(n.lastDrawType!==_y&&(l=!0,n.lastDrawType=_y),by(t,e,c,l,n),function(t,e,n){var r,i=n.text;if(null!=i&&(i+=""),i){t.font=n.font||Wl,t.textAlign=n.textAlign,t.textBaseline=n.textBaseline;var s=void 0,o=void 0;t.setLineDash&&n.lineDash&&(s=(r=ly(e))[0],o=r[1]),s&&(t.setLineDash(s),t.lineDashOffset=o),n.strokeFirst?(hy(n)&&t.strokeText(i,n.x,n.y),dy(n)&&t.fillText(i,n.x,n.y)):(dy(n)&&t.fillText(i,n.x,n.y),hy(n)&&t.strokeText(i,n.x,n.y)),s&&t.setLineDash([])}}(t,e,f)):e instanceof ag?(n.lastDrawType!==Ey&&(l=!0,n.lastDrawType=Ey),function(t,e,n,r,i){yy(t,ky(e,i.inHover),n&&ky(n,i.inHover),r,i)}(t,e,c,l,n),function(t,e,n){var r=e.__image=Mp(n.image,e.__image,e,e.onload);if(r&&Dp(r)){var i=n.x||0,s=n.y||0,o=e.getWidth(),a=e.getHeight(),l=r.width/r.height;if(null==o&&null!=a?o=a*l:null==a&&null!=o?a=o/l:null==o&&null==a&&(o=r.width,a=r.height),n.sWidth&&n.sHeight){var c=n.sx||0,h=n.sy||0;t.drawImage(r,c,h,n.sWidth,n.sHeight,i,s,o,a)}else if(n.sx&&n.sy){var u=o-(c=n.sx),d=a-(h=n.sy);t.drawImage(r,c,h,u,d,i,s,o,a)}else t.drawImage(r,i,s,o,a)}}(t,e,f)):e.getTemporalDisplayables&&(n.lastDrawType!==Sy&&(l=!0,n.lastDrawType=Sy),function(t,e,n){var r=e.getDisplayables(),i=e.getTemporalDisplayables();t.save();var s,o,a={prevElClipPaths:null,prevEl:null,allClipped:!1,viewWidth:n.viewWidth,viewHeight:n.viewHeight,inHover:n.inHover};for(s=e.getCursor(),o=r.length;s<o;s++){(h=r[s]).beforeBrush&&h.beforeBrush(),h.innerBeforeBrush(),Cy(t,h,a,s===o-1),h.innerAfterBrush(),h.afterBrush&&h.afterBrush(),a.prevEl=h}for(var l=0,c=i.length;l<c;l++){var h;(h=i[l]).beforeBrush&&h.beforeBrush(),h.innerBeforeBrush(),Cy(t,h,a,l===c-1),h.innerAfterBrush(),h.afterBrush&&h.afterBrush(),a.prevEl=h}e.clearTemporalDisplayables(),e.notClear=!0,t.restore()}(t,e,n)),d&&r&&Ty(t,n),e.innerAfterBrush(),e.afterBrush&&e.afterBrush(),n.prevEl=e,e.__dirty=0,e.__isRendered=!0}}var Ry=1e-8;function My(t,e){return Math.abs(t-e)<Ry}function Iy(t,e,n){var r=0,i=t[0];if(!i)return!1;for(var s=1;s<t.length;s++){var o=t[s];r+=jm(i[0],i[1],o[0],o[1],e,n),i=o}var a=t[0];return My(i[0],a[0])&&My(i[1],a[1])||(r+=jm(i[0],i[1],a[0],a[1],e,n)),0!==r}var Dy=Math.sin,Oy=Math.cos,Py=Math.PI,Ly=2*Math.PI,Fy=180/Py;const Ny=function(){function t(){}return t.prototype.reset=function(t){this._start=!0,this._d=[],this._str="",this._p=Math.pow(10,t||4)},t.prototype.moveTo=function(t,e){this._add("M",t,e)},t.prototype.lineTo=function(t,e){this._add("L",t,e)},t.prototype.bezierCurveTo=function(t,e,n,r,i,s){this._add("C",t,e,n,r,i,s)},t.prototype.quadraticCurveTo=function(t,e,n,r){this._add("Q",t,e,n,r)},t.prototype.arc=function(t,e,n,r,i,s){this.ellipse(t,e,n,n,0,r,i,s)},t.prototype.ellipse=function(t,e,n,r,i,s,o,a){var l=o-s,c=!a,h=Math.abs(l),u=Hd(h-Ly)||(c?l>=Ly:-l>=Ly),d=l>0?l%Ly:l%Ly+Ly,f=!1;f=!!u||!Hd(h)&&d>=Py==!!c;var p=t+n*Oy(s),m=e+r*Dy(s);this._start&&this._add("M",p,m);var g=Math.round(i*Fy);if(u){var v=1/this._p,y=(c?1:-1)*(Ly-v);this._add("A",n,r,g,1,+c,t+n*Oy(s+y),e+r*Dy(s+y)),v>.01&&this._add("A",n,r,g,0,+c,p,m)}else{var b=t+n*Oy(o),x=e+r*Dy(o);this._add("A",n,r,g,+f,+c,b,x)}},t.prototype.rect=function(t,e,n,r){this._add("M",t,e),this._add("l",n,0),this._add("l",0,r),this._add("l",-n,0),this._add("Z")},t.prototype.closePath=function(){this._d.length>0&&this._add("Z")},t.prototype._add=function(t,e,n,r,i,s,o,a,l){for(var c=[],h=this._p,u=1;u<arguments.length;u++){var d=arguments[u];if(isNaN(d))return void(this._invalid=!0);c.push(Math.round(d*h)/h)}this._d.push(t+c.join(" ")),this._start="Z"===t},t.prototype.generateStr=function(){this._str=this._invalid?"":this._d.join(""),this._d=[]},t.prototype.getStr=function(){return this._str},t}();var By="none",Uy=Math.round;var Vy=["lineCap","miterLimit","lineJoin"],jy=bc(Vy,(function(t){return"stroke-"+t.toLowerCase()}));function zy(t,e,n,r){var i=null==e.opacity?1:e.opacity;if(n instanceof ag)t("opacity",i);else{if(function(t){var e=t.fill;return null!=e&&e!==By}(e)){var s=Gd(e.fill);t("fill",s.color);var o=null!=e.fillOpacity?e.fillOpacity*s.opacity*i:s.opacity*i;(r||o<1)&&t("fill-opacity",o)}else t("fill",By);if(function(t){var e=t.stroke;return null!=e&&e!==By}(e)){var a=Gd(e.stroke);t("stroke",a.color);var l=e.strokeNoScale?n.getLineScale():1,c=l?(e.lineWidth||0)/l:0,h=null!=e.strokeOpacity?e.strokeOpacity*a.opacity*i:a.opacity*i,u=e.strokeFirst;if((r||1!==c)&&t("stroke-width",c),(r||u)&&t("paint-order",u?"stroke":"fill"),(r||h<1)&&t("stroke-opacity",h),e.lineDash){var d=ly(n),f=d[0],p=d[1];f&&(p=Uy(p||0),t("stroke-dasharray",f.join(",")),(p||r)&&t("stroke-dashoffset",p))}else r&&t("stroke-dasharray",By);for(var m=0;m<Vy.length;m++){var g=Vy[m];if(r||e[g]!==Zm[g]){var v=e[g]||Zm[g];v&&t(jy[m],v)}}}else r&&t("stroke",By)}}var Gy="http://www.w3.org/2000/svg",Wy="http://www.w3.org/1999/xlink",Hy="http://www.w3.org/2000/xmlns/",$y="http://www.w3.org/XML/1998/namespace";function Yy(t){return document.createElementNS(Gy,t)}function Xy(t,e,n,r,i){return{tag:t,attrs:n||{},children:r,text:i,key:e}}function qy(t,e){var n=(e=e||{}).newline?"\n":"";return function t(e){var r=e.children,i=e.tag,s=e.attrs,o=e.text;return function(t,e){var n=[];if(e)for(var r in e){var i=e[r],s=r;!1!==i&&(!0!==i&&null!=i&&(s+='="'+i+'"'),n.push(s))}return"<"+t+" "+n.join(" ")+">"}(i,s)+("style"!==i?Nh(o):o||"")+(r?""+n+bc(r,(function(e){return t(e)})).join(n)+n:"")+("</"+i+">")}(t)}function Ky(t){return{zrId:t,shadowCache:{},patternCache:{},gradientCache:{},clipPathCache:{},defs:{},cssNodes:{},cssAnims:{},cssClassIdx:0,cssAnimIdx:0,shadowIdx:0,gradientIdx:0,patternIdx:0,clipPathIdx:0}}function Zy(t,e,n,r){return Xy("svg","root",{width:t,height:e,xmlns:Gy,"xmlns:xlink":Wy,version:"1.1",baseProfile:"full",viewBox:!!r&&"0 0 "+t+" "+e},n)}var Jy={cubicIn:"0.32,0,0.67,0",cubicOut:"0.33,1,0.68,1",cubicInOut:"0.65,0,0.35,1",quadraticIn:"0.11,0,0.5,0",quadraticOut:"0.5,1,0.89,1",quadraticInOut:"0.45,0,0.55,1",quarticIn:"0.5,0,0.75,0",quarticOut:"0.25,1,0.5,1",quarticInOut:"0.76,0,0.24,1",quinticIn:"0.64,0,0.78,0",quinticOut:"0.22,1,0.36,1",quinticInOut:"0.83,0,0.17,1",sinusoidalIn:"0.12,0,0.39,0",sinusoidalOut:"0.61,1,0.88,1",sinusoidalInOut:"0.37,0,0.63,1",exponentialIn:"0.7,0,0.84,0",exponentialOut:"0.16,1,0.3,1",exponentialInOut:"0.87,0,0.13,1",circularIn:"0.55,0,1,0.45",circularOut:"0,0.55,0.45,1",circularInOut:"0.85,0,0.15,1"},Qy="transform-origin";function tb(t,e,n){var r=dc({},t.shape);dc(r,e),t.buildPath(n,r);var i=new Ny;return i.reset(ef(t)),n.rebuildPath(i,1),i.generateStr(),i.getStr()}function eb(t,e){var n=e.originX,r=e.originY;(n||r)&&(t[Qy]=n+"px "+r+"px")}var nb={fill:"fill",opacity:"opacity",lineWidth:"stroke-width",lineDashOffset:"stroke-dashoffset"};function rb(t,e){var n=e.zrId+"-ani-"+e.cssAnimIdx++;return e.cssAnims[n]=t,n}function ib(t){return Cc(t)?Jy[t]?"cubic-bezier("+Jy[t]+")":gd(t)?t:"":""}function sb(t,e,n,r){var i=t.animators,s=i.length,o=[];if(t instanceof Wv){var a=function(t,e,n){var r,i,s=t.shape.paths,o={};if(yc(s,(function(t){var e=Ky(n.zrId);e.animation=!0,sb(t,{},e,!0);var s=e.cssAnims,a=e.cssNodes,l=_c(s),c=l.length;if(c){var h=s[i=l[c-1]];for(var u in h){var d=h[u];o[u]=o[u]||{d:""},o[u].d+=d.d||""}for(var f in a){var p=a[f].animation;p.indexOf(i)>=0&&(r=p)}}})),r){e.d=!1;var a=rb(o,n);return r.replace(i,a)}}(t,e,n);if(a)o.push(a);else if(!s)return}else if(!s)return;for(var l={},c=0;c<s;c++){var h=i[c],u=[h.getMaxTime()/1e3+"s"],d=ib(h.getClip().easing),f=h.getDelay();d?u.push(d):u.push("linear"),f&&u.push(f/1e3+"s"),h.getLoop()&&u.push("infinite");var p=u.join(" ");l[p]=l[p]||[p,[]],l[p][1].push(h)}function m(i){var s,o=i[1],a=o.length,l={},c={},h={},u="animation-timing-function";function d(t,e,n){for(var r=t.getTracks(),i=t.getMaxTime(),s=0;s<r.length;s++){var o=r[s];if(o.needsAnimate()){var a=o.keyframes,l=o.propName;if(n&&(l=n(l)),l)for(var c=0;c<a.length;c++){var h=a[c],d=Math.round(h.time/i*100)+"%",f=ib(h.easing),p=h.rawValue;(Cc(p)||Mc(p))&&(e[d]=e[d]||{},e[d][l]=h.rawValue,f&&(e[d][u]=f))}}}}for(var f=0;f<a;f++){(_=(E=o[f]).targetName)?"shape"===_&&d(E,c):!r&&d(E,l)}for(var p in l){var m={};Qf(m,t),dc(m,l[p]);var g=nf(m),v=l[p][u];h[p]=g?{transform:g}:{},eb(h[p],m),v&&(h[p][u]=v)}var y=!0;for(var p in c){h[p]=h[p]||{};var b=!s;v=c[p][u];b&&(s=new Om);var x=s.len();s.reset(),h[p].d=tb(t,c[p],s);var w=s.len();if(!b&&x!==w){y=!1;break}v&&(h[p][u]=v)}if(!y)for(var p in h)delete h[p].d;if(!r)for(f=0;f<a;f++){var E,_;"style"===(_=(E=o[f]).targetName)&&d(E,h,(function(t){return nb[t]}))}var S,T=_c(h),k=!0;for(f=1;f<T.length;f++){var A=T[f-1],C=T[f];if(h[A][Qy]!==h[C][Qy]){k=!1;break}S=h[A][Qy]}if(k&&S){for(var p in h)h[p][Qy]&&delete h[p][Qy];e[Qy]=S}if(wc(T,(function(t){return _c(h[t]).length>0})).length)return rb(h,n)+" "+i[0]+" both"}for(var g in l){(a=m(l[g]))&&o.push(a)}if(o.length){var v=n.zrId+"-cls-"+n.cssClassIdx++;n.cssNodes["."+v]={animation:o.join(",")},e.class=v}}var ob=Math.round;function ab(t){return t&&Cc(t.src)}function lb(t){return t&&Ac(t.toDataURL)}function cb(t,e,n,r){zy((function(i,s){var o="fill"===i||"stroke"===i;o&&Qd(s)?bb(e,t,i,r):o&&Kd(s)?xb(n,t,i,r):t[i]=s}),e,n,!1),function(t,e,n){var r=t.style;if(function(t){return t&&(t.shadowBlur||t.shadowOffsetX||t.shadowOffsetY)}(r)){var i=function(t){var e=t.style,n=t.getGlobalScale();return[e.shadowColor,(e.shadowBlur||0).toFixed(2),(e.shadowOffsetX||0).toFixed(2),(e.shadowOffsetY||0).toFixed(2),n[0],n[1]].join(",")}(t),s=n.shadowCache,o=s[i];if(!o){var a=t.getGlobalScale(),l=a[0],c=a[1];if(!l||!c)return;var h=r.shadowOffsetX||0,u=r.shadowOffsetY||0,d=r.shadowBlur,f=Gd(r.shadowColor),p=f.opacity,m=f.color,g=d/2/l+" "+d/2/c;o=n.zrId+"-s"+n.shadowIdx++,n.defs[o]=Xy("filter",o,{id:o,x:"-100%",y:"-100%",width:"300%",height:"300%"},[Xy("feDropShadow","",{dx:h/l,dy:u/c,stdDeviation:g,"flood-color":m,"flood-opacity":p})]),s[i]=o}e.filter=tf(o)}}(n,t,r)}function hb(t){return Hd(t[0]-1)&&Hd(t[1])&&Hd(t[2])&&Hd(t[3]-1)}function ub(t,e,n){if(e&&(!function(t){return Hd(t[4])&&Hd(t[5])}(e)||!hb(e))){var r=n?10:1e4;t.transform=hb(e)?"translate("+ob(e[4]*r)/r+" "+ob(e[5]*r)/r+")":function(t){return"matrix("+$d(t[0])+","+$d(t[1])+","+$d(t[2])+","+$d(t[3])+","+Yd(t[4])+","+Yd(t[5])+")"}(e)}}function db(t,e,n){for(var r=t.points,i=[],s=0;s<r.length;s++)i.push(ob(r[s][0]*n)/n),i.push(ob(r[s][1]*n)/n);e.points=i.join(" ")}function fb(t){return!t.smooth}var pb,mb,gb={circle:[(pb=["cx","cy","r"],mb=bc(pb,(function(t){return"string"==typeof t?[t,t]:t})),function(t,e,n){for(var r=0;r<mb.length;r++){var i=mb[r],s=t[i[0]];null!=s&&(e[i[1]]=ob(s*n)/n)}})],polyline:[db,fb],polygon:[db,fb]};function vb(t,e){var n=t.style,r=t.shape,i=gb[t.type],s={},o=e.animation,a="path",l=t.style.strokePercent,c=e.compress&&ef(t)||4;if(!i||e.willUpdate||i[1]&&!i[1](r)||o&&function(t){for(var e=t.animators,n=0;n<e.length;n++)if("shape"===e[n].targetName)return!0;return!1}(t)||l<1){var h=!t.path||t.shapeChanged();t.path||t.createPathProxy();var u=t.path;h&&(u.beginPath(),t.buildPath(u,t.shape),t.pathUpdated());var d=u.getVersion(),f=t,p=f.__svgPathBuilder;f.__svgPathVersion===d&&p&&l===f.__svgPathStrokePercent||(p||(p=f.__svgPathBuilder=new Ny),p.reset(c),u.rebuildPath(p,l),p.generateStr(),f.__svgPathVersion=d,f.__svgPathStrokePercent=l),s.d=p.getStr()}else{a=t.type;var m=Math.pow(10,c);i[0](r,s,m)}return ub(s,t.transform),cb(s,n,t,e),e.animation&&sb(t,s,e),Xy(a,t.id+"",s)}function yb(t,e){return t instanceof tg?vb(t,e):t instanceof ag?function(t,e){var n=t.style,r=n.image;if(r&&!Cc(r)&&(ab(r)?r=r.src:lb(r)&&(r=r.toDataURL())),r){var i=n.x||0,s=n.y||0,o={href:r,width:n.width,height:n.height};return i&&(o.x=i),s&&(o.y=s),ub(o,t.transform),cb(o,n,t,e),e.animation&&sb(t,o,e),Xy("image",t.id+"",o)}}(t,e):t instanceof rg?function(t,e){var n=t.style,r=n.text;if(null!=r&&(r+=""),r&&!isNaN(n.x)&&!isNaN(n.y)){var i=n.font||Wl,s=n.x||0,o=function(t,e,n){return"top"===n?t+=e/2:"bottom"===n&&(t-=e/2),t}(n.y||0,ap(i),n.textBaseline),a={"dominant-baseline":"central","text-anchor":Xd[n.textAlign]||n.textAlign};if(Sg(n)){var l="",c=n.fontStyle,h=Eg(n.fontSize);if(!parseFloat(h))return;var u=n.fontFamily||Gl,d=n.fontWeight;l+="font-size:"+h+";font-family:"+u+";",c&&"normal"!==c&&(l+="font-style:"+c+";"),d&&"normal"!==d&&(l+="font-weight:"+d+";"),a.style=l}else a.style="font: "+i;return r.match(/\s/)&&(a["xml:space"]="preserve"),s&&(a.x=s),o&&(a.y=o),ub(a,t.transform),cb(a,n,t,e),e.animation&&sb(t,a,e),Xy("text",t.id+"",a,void 0,r)}}(t,e):void 0}function bb(t,e,n,r){var i,s=t[n],o={gradientUnits:s.global?"userSpaceOnUse":"objectBoundingBox"};if(Zd(s))i="linearGradient",o.x1=s.x,o.y1=s.y,o.x2=s.x2,o.y2=s.y2;else{if(!Jd(s))return;i="radialGradient",o.cx=Uc(s.x,.5),o.cy=Uc(s.y,.5),o.r=Uc(s.r,.5)}for(var a=s.colorStops,l=[],c=0,h=a.length;c<h;++c){var u=100*Yd(a[c].offset)+"%",d=Gd(a[c].color),f=d.color,p=d.opacity,m={offset:u};m["stop-color"]=f,p<1&&(m["stop-opacity"]=p),l.push(Xy("stop",c+"",m))}var g=qy(Xy(i,"",o,l)),v=r.gradientCache,y=v[g];y||(y=r.zrId+"-g"+r.gradientIdx++,v[g]=y,o.id=y,r.defs[y]=Xy(i,y,o,l)),e[n]=tf(y)}function xb(t,e,n,r){var i,s=t.style[n],o=t.getBoundingRect(),a={},l=s.repeat,c="no-repeat"===l,h="repeat-x"===l,u="repeat-y"===l;if(qd(s)){var d=s.imageWidth,f=s.imageHeight,p=void 0,m=s.image;if(Cc(m)?p=m:ab(m)?p=m.src:lb(m)&&(p=m.toDataURL()),"undefined"==typeof Image){var g="Image width/height must been given explictly in svg-ssr renderer.";Gc(d,g),Gc(f,g)}else if(null==d||null==f){var v=function(t,e){if(t){var n=t.elm,r=d||e.width,i=f||e.height;"pattern"===t.tag&&(h?(i=1,r/=o.width):u&&(r=1,i/=o.height)),t.attrs.width=r,t.attrs.height=i,n&&(n.setAttribute("width",r),n.setAttribute("height",i))}},y=Mp(p,null,t,(function(t){c||v(E,t),v(i,t)}));y&&y.width&&y.height&&(d=d||y.width,f=f||y.height)}i=Xy("image","img",{href:p,width:d,height:f}),a.width=d,a.height=f}else s.svgElement&&(i=cc(s.svgElement),a.width=s.svgWidth,a.height=s.svgHeight);if(i){var b,x;c?b=x=1:h?(x=1,b=a.width/o.width):u?(b=1,x=a.height/o.height):a.patternUnits="userSpaceOnUse",null==b||isNaN(b)||(a.width=b),null==x||isNaN(x)||(a.height=x);var w=nf(s);w&&(a.patternTransform=w);var E=Xy("pattern","",a,[i]),_=qy(E),S=r.patternCache,T=S[_];T||(T=r.zrId+"-p"+r.patternIdx++,S[_]=T,a.id=T,E=r.defs[T]=Xy("pattern",T,a,[i])),e[n]=tf(T)}}function wb(t,e,n){var r=n.clipPathCache,i=n.defs,s=r[t.id];if(!s){var o={id:s=n.zrId+"-c"+n.clipPathIdx++};r[t.id]=s,i[s]=Xy("clipPath",s,o,[vb(t,n)])}e["clip-path"]=tf(s)}function Eb(t){return document.createTextNode(t)}function _b(t,e,n){t.insertBefore(e,n)}function Sb(t,e){t.removeChild(e)}function Tb(t,e){t.appendChild(e)}function kb(t){return t.parentNode}function Ab(t){return t.nextSibling}function Cb(t,e){t.textContent=e}var Rb=58,Mb=120,Ib=Xy("","");function Db(t){return void 0===t}function Ob(t){return void 0!==t}function Pb(t,e,n){for(var r={},i=e;i<=n;++i){var s=t[i].key;void 0!==s&&(r[s]=i)}return r}function Lb(t,e){var n=t.key===e.key;return t.tag===e.tag&&n}function Fb(t){var e,n=t.children,r=t.tag;if(Ob(r)){var i=t.elm=Yy(r);if(Ub(Ib,t),kc(n))for(e=0;e<n.length;++e){var s=n[e];null!=s&&Tb(i,Fb(s))}else Ob(t.text)&&!Ic(t.text)&&Tb(i,Eb(t.text))}else t.elm=Eb(t.text);return t.elm}function Nb(t,e,n,r,i){for(;r<=i;++r){var s=n[r];null!=s&&_b(t,Fb(s),e)}}function Bb(t,e,n,r){for(;n<=r;++n){var i=e[n];if(null!=i)if(Ob(i.tag))Sb(kb(i.elm),i.elm);else Sb(t,i.elm)}}function Ub(t,e){var n,r=e.elm,i=t&&t.attrs||{},s=e.attrs||{};if(i!==s){for(n in s){var o=s[n];i[n]!==o&&(!0===o?r.setAttribute(n,""):!1===o?r.removeAttribute(n):n.charCodeAt(0)!==Mb?r.setAttribute(n,o):"xmlns:xlink"===n||"xmlns"===n?r.setAttributeNS(Hy,n,o):n.charCodeAt(3)===Rb?r.setAttributeNS($y,n,o):n.charCodeAt(5)===Rb?r.setAttributeNS(Wy,n,o):r.setAttribute(n,o))}for(n in i)n in s||r.removeAttribute(n)}}function Vb(t,e){var n=e.elm=t.elm,r=t.children,i=e.children;t!==e&&(Ub(t,e),Db(e.text)?Ob(r)&&Ob(i)?r!==i&&function(t,e,n){for(var r,i,s,o=0,a=0,l=e.length-1,c=e[0],h=e[l],u=n.length-1,d=n[0],f=n[u];o<=l&&a<=u;)null==c?c=e[++o]:null==h?h=e[--l]:null==d?d=n[++a]:null==f?f=n[--u]:Lb(c,d)?(Vb(c,d),c=e[++o],d=n[++a]):Lb(h,f)?(Vb(h,f),h=e[--l],f=n[--u]):Lb(c,f)?(Vb(c,f),_b(t,c.elm,Ab(h.elm)),c=e[++o],f=n[--u]):Lb(h,d)?(Vb(h,d),_b(t,h.elm,c.elm),h=e[--l],d=n[++a]):(Db(r)&&(r=Pb(e,o,l)),Db(i=r[d.key])||(s=e[i]).tag!==d.tag?_b(t,Fb(d),c.elm):(Vb(s,d),e[i]=void 0,_b(t,s.elm,c.elm)),d=n[++a]);(o<=l||a<=u)&&(o>l?Nb(t,null==n[u+1]?null:n[u+1].elm,n,a,u):Bb(t,e,o,l))}(n,r,i):Ob(i)?(Ob(t.text)&&Cb(n,""),Nb(n,null,i,0,i.length-1)):Ob(r)?Bb(n,r,0,r.length-1):Ob(t.text)&&Cb(n,""):t.text!==e.text&&(Ob(r)&&Bb(n,r,0,r.length-1),Cb(n,e.text)))}var jb=0;const zb=function(){function t(t,e,n){if(this.type="svg",this.refreshHover=function(){},this.configLayer=function(){},this.storage=e,this._opts=n=dc({},n),this.root=t,this._id="zr"+jb++,this._oldVNode=Zy(n.width,n.height),t&&!n.ssr){var r=this._viewport=document.createElement("div");r.style.cssText="position:relative;overflow:hidden";var i=this._svgDom=this._oldVNode.elm=Yy("svg");Ub(null,this._oldVNode),r.appendChild(i),t.appendChild(r)}this.resize(n.width,n.height)}return t.prototype.getType=function(){return this.type},t.prototype.getViewportRoot=function(){return this._viewport},t.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},t.prototype.getSvgDom=function(){return this._svgDom},t.prototype.refresh=function(){if(this.root){var t=this.renderToVNode({willUpdate:!0});t.attrs.style="position:absolute;left:0;top:0;user-select:none",function(t,e){if(Lb(t,e))Vb(t,e);else{var n=t.elm,r=kb(n);Fb(e),null!==r&&(_b(r,e.elm,Ab(n)),Bb(r,[t],0,0))}}(this._oldVNode,t),this._oldVNode=t}},t.prototype.renderOneToVNode=function(t){return yb(t,Ky(this._id))},t.prototype.renderToVNode=function(t){t=t||{};var e=this.storage.getDisplayList(!0),n=this._width,r=this._height,i=Ky(this._id);i.animation=t.animation,i.willUpdate=t.willUpdate,i.compress=t.compress;var s=[],o=this._bgVNode=function(t,e,n,r){var i;if(n&&"none"!==n)if(i=Xy("rect","bg",{width:t,height:e,x:"0",y:"0",id:"0"}),Qd(n))bb({fill:n},i.attrs,"fill",r);else if(Kd(n))xb({style:{fill:n},dirty:nh,getBoundingRect:function(){return{width:t,height:e}}},i.attrs,"fill",r);else{var s=Gd(n),o=s.color,a=s.opacity;i.attrs.fill=o,a<1&&(i.attrs["fill-opacity"]=a)}return i}(n,r,this._backgroundColor,i);o&&s.push(o);var a=t.compress?null:this._mainVNode=Xy("g","main",{},[]);this._paintList(e,i,a?a.children:s),a&&s.push(a);var l=bc(_c(i.defs),(function(t){return i.defs[t]}));if(l.length&&s.push(Xy("defs","defs",{},l)),t.animation){var c=function(t,e,n){var r=(n=n||{}).newline?"\n":"",i=" {"+r,s=r+"}",o=bc(_c(t),(function(e){return e+i+bc(_c(t[e]),(function(n){return n+":"+t[e][n]+";"})).join(r)+s})).join(r),a=bc(_c(e),(function(t){return"@keyframes "+t+i+bc(_c(e[t]),(function(n){return n+i+bc(_c(e[t][n]),(function(r){var i=e[t][n][r];return"d"===r&&(i='path("'+i+'")'),r+":"+i+";"})).join(r)+s})).join(r)+s})).join(r);return o||a?["<![CDATA[",o,a,"]]>"].join(r):""}(i.cssNodes,i.cssAnims,{newline:!0});if(c){var h=Xy("style","stl",{},[],c);s.push(h)}}return Zy(n,r,s,t.useViewBox)},t.prototype.renderToString=function(t){return t=t||{},qy(this.renderToVNode({animation:Uc(t.cssAnimation,!0),willUpdate:!1,compress:!0,useViewBox:Uc(t.useViewBox,!0)}),{newline:!0})},t.prototype.setBackgroundColor=function(t){this._backgroundColor=t},t.prototype.getSvgRoot=function(){return this._mainVNode&&this._mainVNode.elm},t.prototype._paintList=function(t,e,n){for(var r,i,s=t.length,o=[],a=0,l=0,c=0;c<s;c++){var h=t[c];if(!h.invisible){var u=h.__clipPaths,d=u&&u.length||0,f=i&&i.length||0,p=void 0;for(p=Math.max(d-1,f-1);p>=0&&(!u||!i||u[p]!==i[p]);p--);for(var m=f-1;m>p;m--)r=o[--a-1];for(var g=p+1;g<d;g++){var v={};wb(u[g],v,e);var y=Xy("g","clip-g-"+l++,v,[]);(r?r.children:n).push(y),o[a++]=y,r=y}i=u;var b=yb(h,e);b&&(r?r.children:n).push(b)}}},t.prototype.resize=function(t,e){var n=this._opts,r=this.root,i=this._viewport;if(null!=t&&(n.width=t),null!=e&&(n.height=e),r&&i&&(i.style.display="none",t=ay(r,0,n),e=ay(r,1,n),i.style.display=""),this._width!==t||this._height!==e){if(this._width=t,this._height=e,i){var s=i.style;s.width=t+"px",s.height=e+"px"}if(Kd(this._backgroundColor))this.refresh();else{var o=this._svgDom;o&&(o.setAttribute("width",t),o.setAttribute("height",e));var a=this._bgVNode&&this._bgVNode.elm;a&&(a.setAttribute("width",t),a.setAttribute("height",e))}}},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t.prototype.dispose=function(){this.root&&(this.root.innerHTML=""),this._svgDom=this._viewport=this.storage=this._oldVNode=this._bgVNode=this._mainVNode=null},t.prototype.clear=function(){this._svgDom&&(this._svgDom.innerHTML=null),this._oldVNode=null},t.prototype.toDataURL=function(t){var e=this.renderToString(),n="data:image/svg+xml;";return t?(e=rf(e))&&n+"base64,"+e:n+"charset=UTF-8,"+encodeURIComponent(e)},t}();function Gb(t,e,n){var r=Xl.createCanvas(),i=e.getWidth(),s=e.getHeight(),o=r.style;return o&&(o.position="absolute",o.left="0",o.top="0",o.width=i+"px",o.height=s+"px",r.setAttribute("data-zr-dom-id",t)),r.width=i*n,r.height=s*n,r}const Wb=function(t){function e(e,n,r){var i,s=t.call(this)||this;s.motionBlur=!1,s.lastFrameAlpha=.7,s.dpr=1,s.virtual=!1,s.config={},s.incremental=!1,s.zlevel=0,s.maxRepaintRectCount=5,s.__dirty=!0,s.__firstTimePaint=!0,s.__used=!1,s.__drawIndex=0,s.__startIndex=0,s.__endIndex=0,s.__prevStartIndex=null,s.__prevEndIndex=null,r=r||jf,"string"==typeof e?i=Gb(e,n,r):Ic(e)&&(e=(i=e).id),s.id=e,s.dom=i;var o=i.style;return o&&(th(i),i.onselectstart=function(){return!1},o.padding="0",o.margin="0",o.borderWidth="0"),s.painter=n,s.dpr=r,s}return sh(e,t),e.prototype.getElementCount=function(){return this.__endIndex-this.__startIndex},e.prototype.afterBrush=function(){this.__prevStartIndex=this.__startIndex,this.__prevEndIndex=this.__endIndex},e.prototype.initContext=function(){this.ctx=this.dom.getContext("2d"),this.ctx.dpr=this.dpr},e.prototype.setUnpainted=function(){this.__firstTimePaint=!0},e.prototype.createBackBuffer=function(){var t=this.dpr;this.domBack=Gb("back-"+this.id,this.painter,t),this.ctxBack=this.domBack.getContext("2d"),1!==t&&this.ctxBack.scale(t,t)},e.prototype.createRepaintRects=function(t,e,n,r){if(this.__firstTimePaint)return this.__firstTimePaint=!1,null;var i,s=[],o=this.maxRepaintRectCount,a=!1,l=new gu(0,0,0,0);function c(t){if(t.isFinite()&&!t.isZero())if(0===s.length){(e=new gu(0,0,0,0)).copy(t),s.push(e)}else{for(var e,n=!1,r=1/0,i=0,c=0;c<s.length;++c){var h=s[c];if(h.intersect(t)){var u=new gu(0,0,0,0);u.copy(h),u.union(t),s[c]=u,n=!0;break}if(a){l.copy(t),l.union(h);var d=t.width*t.height,f=h.width*h.height,p=l.width*l.height-d-f;p<r&&(r=p,i=c)}}if(a&&(s[i].union(t),n=!0),!n)(e=new gu(0,0,0,0)).copy(t),s.push(e);a||(a=s.length>=o)}}for(var h=this.__startIndex;h<this.__endIndex;++h){if(f=t[h]){var u=f.shouldBePainted(n,r,!0,!0);(p=f.__isRendered&&(f.__dirty&Fu||!u)?f.getPrevPaintRect():null)&&c(p);var d=u&&(f.__dirty&Fu||!f.__isRendered)?f.getPaintRect():null;d&&c(d)}}for(h=this.__prevStartIndex;h<this.__prevEndIndex;++h){var f,p;u=(f=e[h]).shouldBePainted(n,r,!0,!0);if(f&&(!u||!f.__zr)&&f.__isRendered)(p=f.getPrevPaintRect())&&c(p)}do{i=!1;for(h=0;h<s.length;)if(s[h].isZero())s.splice(h,1);else{for(var m=h+1;m<s.length;)s[h].intersect(s[m])?(i=!0,s[h].union(s[m]),s.splice(m,1)):m++;h++}}while(i);return this._paintRects=s,s},e.prototype.debugGetPaintRects=function(){return(this._paintRects||[]).slice()},e.prototype.resize=function(t,e){var n=this.dpr,r=this.dom,i=r.style,s=this.domBack;i&&(i.width=t+"px",i.height=e+"px"),r.width=t*n,r.height=e*n,s&&(s.width=t*n,s.height=e*n,1!==n&&this.ctxBack.scale(n,n))},e.prototype.clear=function(t,e,n){var r=this.dom,i=this.ctx,s=r.width,o=r.height;e=e||this.clearColor;var a=this.motionBlur&&!t,l=this.lastFrameAlpha,c=this.dpr,h=this;a&&(this.domBack||this.createBackBuffer(),this.ctxBack.globalCompositeOperation="copy",this.ctxBack.drawImage(r,0,0,s/c,o/c));var u=this.domBack;function d(t,n,r,s){if(i.clearRect(t,n,r,s),e&&"transparent"!==e){var o=void 0;if(Lc(e))o=(e.global||e.__width===r&&e.__height===s)&&e.__canvasGradient||sy(i,e,{x:0,y:0,width:r,height:s}),e.__canvasGradient=o,e.__width=r,e.__height=s;else null!=e.image&&(e.scaleX=e.scaleX||c,e.scaleY=e.scaleY||c,o=my(i,e,{dirty:function(){h.setUnpainted(),h.__painter.refresh()}}));i.save(),i.fillStyle=o||e,i.fillRect(t,n,r,s),i.restore()}a&&(i.save(),i.globalAlpha=l,i.drawImage(u,t,n,r,s),i.restore())}!n||a?d(0,0,s,o):n.length&&yc(n,(function(t){d(t.x*c,t.y*c,t.width*c,t.height*c)}))},e}(kh);var Hb=1e5,$b=314159,Yb=.01;const Xb=function(){function t(t,e,n,r){this.type="canvas",this._zlevelList=[],this._prevDisplayList=[],this._layers={},this._layerConfig={},this._needsManuallyCompositing=!1,this.type="canvas";var i=!t.nodeName||"CANVAS"===t.nodeName.toUpperCase();this._opts=n=dc({},n||{}),this.dpr=n.devicePixelRatio||jf,this._singleCanvas=i,this.root=t,t.style&&(th(t),t.innerHTML=""),this.storage=e;var s=this._zlevelList;this._prevDisplayList=[];var o=this._layers;if(i){var a=t,l=a.width,c=a.height;null!=n.width&&(l=n.width),null!=n.height&&(c=n.height),this.dpr=n.devicePixelRatio||1,a.width=l*this.dpr,a.height=c*this.dpr,this._width=l,this._height=c;var h=new Wb(a,this,this.dpr);h.__builtin__=!0,h.initContext(),o[314159]=h,h.zlevel=$b,s.push($b),this._domRoot=t}else{this._width=ay(t,0,n),this._height=ay(t,1,n);var u=this._domRoot=function(t,e){var n=document.createElement("div");return n.style.cssText=["position:relative","width:"+t+"px","height:"+e+"px","padding:0","margin:0","border-width:0"].join(";")+";",n}(this._width,this._height);t.appendChild(u)}}return t.prototype.getType=function(){return"canvas"},t.prototype.isSingleCanvas=function(){return this._singleCanvas},t.prototype.getViewportRoot=function(){return this._domRoot},t.prototype.getViewportRootOffset=function(){var t=this.getViewportRoot();if(t)return{offsetLeft:t.offsetLeft||0,offsetTop:t.offsetTop||0}},t.prototype.refresh=function(t){var e=this.storage.getDisplayList(!0),n=this._prevDisplayList,r=this._zlevelList;this._redrawId=Math.random(),this._paintList(e,n,t,this._redrawId);for(var i=0;i<r.length;i++){var s=r[i],o=this._layers[s];if(!o.__builtin__&&o.refresh){var a=0===i?this._backgroundColor:null;o.refresh(a)}}return this._opts.useDirtyRect&&(this._prevDisplayList=e.slice()),this},t.prototype.refreshHover=function(){this._paintHoverList(this.storage.getDisplayList(!1))},t.prototype._paintHoverList=function(t){var e=t.length,n=this._hoverlayer;if(n&&n.clear(),e){for(var r,i={inHover:!0,viewWidth:this._width,viewHeight:this._height},s=0;s<e;s++){var o=t[s];o.__inHover&&(n||(n=this._hoverlayer=this.getLayer(Hb)),r||(r=n.ctx).save(),Cy(r,o,i,s===e-1))}r&&r.restore()}},t.prototype.getHoverLayer=function(){return this.getLayer(Hb)},t.prototype.paintOne=function(t,e){Ay(t,e)},t.prototype._paintList=function(t,e,n,r){if(this._redrawId===r){n=n||!1,this._updateLayerStatus(t);var i=this._doPaintList(t,e,n),s=i.finished,o=i.needsRefreshHover;if(this._needsManuallyCompositing&&this._compositeManually(),o&&this._paintHoverList(t),s)this.eachLayer((function(t){t.afterBrush&&t.afterBrush()}));else{var a=this;zu((function(){a._paintList(t,e,n,r)}))}}},t.prototype._compositeManually=function(){var t=this.getLayer($b).ctx,e=this._domRoot.width,n=this._domRoot.height;t.clearRect(0,0,e,n),this.eachBuiltinLayer((function(r){r.virtual&&t.drawImage(r.dom,0,0,e,n)}))},t.prototype._doPaintList=function(t,e,n){for(var r=this,i=[],s=this._opts.useDirtyRect,o=0;o<this._zlevelList.length;o++){var a=this._zlevelList[o],l=this._layers[a];l.__builtin__&&l!==this._hoverlayer&&(l.__dirty||n)&&i.push(l)}for(var c=!0,h=!1,u=function(o){var a,l=i[o],u=l.ctx,f=s&&l.createRepaintRects(t,e,d._width,d._height),p=n?l.__startIndex:l.__drawIndex,m=!n&&l.incremental&&Date.now,g=m&&Date.now(),v=l.zlevel===d._zlevelList[0]?d._backgroundColor:null;if(l.__startIndex===l.__endIndex)l.clear(!1,v,f);else if(p===l.__startIndex){var y=t[p];y.incremental&&y.notClear&&!n||l.clear(!1,v,f)}-1===p&&(p=l.__startIndex);var b=function(e){var n={inHover:!1,allClipped:!1,prevEl:null,viewWidth:r._width,viewHeight:r._height};for(a=p;a<l.__endIndex;a++){var i=t[a];if(i.__inHover&&(h=!0),r._doPaintEl(i,l,s,e,n,a===l.__endIndex-1),m)if(Date.now()-g>15)break}n.prevElClipPaths&&u.restore()};if(f)if(0===f.length)a=l.__endIndex;else for(var x=d.dpr,w=0;w<f.length;++w){var E=f[w];u.save(),u.beginPath(),u.rect(E.x*x,E.y*x,E.width*x,E.height*x),u.clip(),b(E),u.restore()}else u.save(),b(),u.restore();l.__drawIndex=a,l.__drawIndex<l.__endIndex&&(c=!1)},d=this,f=0;f<i.length;f++)u(f);return jl.wxa&&yc(this._layers,(function(t){t&&t.ctx&&t.ctx.draw&&t.ctx.draw()})),{finished:c,needsRefreshHover:h}},t.prototype._doPaintEl=function(t,e,n,r,i,s){var o=e.ctx;if(n){var a=t.getPaintRect();(!r||a&&a.intersect(r))&&(Cy(o,t,i,s),t.setPrevPaintRect(a))}else Cy(o,t,i,s)},t.prototype.getLayer=function(t,e){this._singleCanvas&&!this._needsManuallyCompositing&&(t=$b);var n=this._layers[t];return n||((n=new Wb("zr_"+t,this,this.dpr)).zlevel=t,n.__builtin__=!0,this._layerConfig[t]?hc(n,this._layerConfig[t],!0):this._layerConfig[t-Yb]&&hc(n,this._layerConfig[t-Yb],!0),e&&(n.virtual=e),this.insertLayer(t,n),n.initContext()),n},t.prototype.insertLayer=function(t,e){var n=this._layers,r=this._zlevelList,i=r.length,s=this._domRoot,o=null,a=-1;if(!n[t]&&function(t){return!!t&&(!!t.__builtin__||"function"==typeof t.resize&&"function"==typeof t.refresh)}(e)){if(i>0&&t>r[0]){for(a=0;a<i-1&&!(r[a]<t&&r[a+1]>t);a++);o=n[r[a]]}if(r.splice(a+1,0,t),n[t]=e,!e.virtual)if(o){var l=o.dom;l.nextSibling?s.insertBefore(e.dom,l.nextSibling):s.appendChild(e.dom)}else s.firstChild?s.insertBefore(e.dom,s.firstChild):s.appendChild(e.dom);e.__painter=this}},t.prototype.eachLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r];t.call(e,this._layers[i],i)}},t.prototype.eachBuiltinLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r],s=this._layers[i];s.__builtin__&&t.call(e,s,i)}},t.prototype.eachOtherLayer=function(t,e){for(var n=this._zlevelList,r=0;r<n.length;r++){var i=n[r],s=this._layers[i];s.__builtin__||t.call(e,s,i)}},t.prototype.getLayers=function(){return this._layers},t.prototype._updateLayerStatus=function(t){function e(t){s&&(s.__endIndex!==t&&(s.__dirty=!0),s.__endIndex=t)}if(this.eachBuiltinLayer((function(t,e){t.__dirty=t.__used=!1})),this._singleCanvas)for(var n=1;n<t.length;n++){if((a=t[n]).zlevel!==t[n-1].zlevel||a.incremental){this._needsManuallyCompositing=!0;break}}var r,i,s=null,o=0;for(i=0;i<t.length;i++){var a,l=(a=t[i]).zlevel,c=void 0;r!==l&&(r=l,o=0),a.incremental?((c=this.getLayer(l+.001,this._needsManuallyCompositing)).incremental=!0,o=1):c=this.getLayer(l+(o>0?Yb:0),this._needsManuallyCompositing),c.__builtin__||lc("ZLevel "+l+" has been used by unkown layer "+c.id),c!==s&&(c.__used=!0,c.__startIndex!==i&&(c.__dirty=!0),c.__startIndex=i,c.incremental?c.__drawIndex=-1:c.__drawIndex=i,e(i),s=c),a.__dirty&Fu&&!a.__inHover&&(c.__dirty=!0,c.incremental&&c.__drawIndex<0&&(c.__drawIndex=i))}e(i),this.eachBuiltinLayer((function(t,e){!t.__used&&t.getElementCount()>0&&(t.__dirty=!0,t.__startIndex=t.__endIndex=t.__drawIndex=0),t.__dirty&&t.__drawIndex<0&&(t.__drawIndex=t.__startIndex)}))},t.prototype.clear=function(){return this.eachBuiltinLayer(this._clearLayer),this},t.prototype._clearLayer=function(t){t.clear()},t.prototype.setBackgroundColor=function(t){this._backgroundColor=t,yc(this._layers,(function(t){t.setUnpainted()}))},t.prototype.configLayer=function(t,e){if(e){var n=this._layerConfig;n[t]?hc(n[t],e,!0):n[t]=e;for(var r=0;r<this._zlevelList.length;r++){var i=this._zlevelList[r];if(i===t||i===t+Yb)hc(this._layers[i],n[t],!0)}}},t.prototype.delLayer=function(t){var e=this._layers,n=this._zlevelList,r=e[t];r&&(r.dom.parentNode.removeChild(r.dom),delete e[t],n.splice(pc(n,t),1))},t.prototype.resize=function(t,e){if(this._domRoot.style){var n=this._domRoot;n.style.display="none";var r=this._opts,i=this.root;if(null!=t&&(r.width=t),null!=e&&(r.height=e),t=ay(i,0,r),e=ay(i,1,r),n.style.display="",this._width!==t||e!==this._height){for(var s in n.style.width=t+"px",n.style.height=e+"px",this._layers)this._layers.hasOwnProperty(s)&&this._layers[s].resize(t,e);this.refresh(!0)}this._width=t,this._height=e}else{if(null==t||null==e)return;this._width=t,this._height=e,this.getLayer($b).resize(t,e)}return this},t.prototype.clearLayer=function(t){var e=this._layers[t];e&&e.clear()},t.prototype.dispose=function(){this.root.innerHTML="",this.root=this.storage=this._domRoot=this._layers=null},t.prototype.getRenderedCanvas=function(t){if(t=t||{},this._singleCanvas&&!this._compositeManually)return this._layers[314159].dom;var e=new Wb("image",this,t.pixelRatio||this.dpr);e.initContext(),e.clear(!1,t.backgroundColor||this._backgroundColor);var n=e.ctx;if(t.pixelRatio<=this.dpr){this.refresh();var r=e.dom.width,i=e.dom.height;this.eachLayer((function(t){t.__builtin__?n.drawImage(t.dom,0,0,r,i):t.renderToCanvas&&(n.save(),t.renderToCanvas(n),n.restore())}))}else for(var s={inHover:!1,viewWidth:this._width,viewHeight:this._height},o=this.storage.getDisplayList(!0),a=0,l=o.length;a<l;a++){var c=o[a];Cy(n,c,s,a===l-1)}return e.dom},t.prototype.getWidth=function(){return this._width},t.prototype.getHeight=function(){return this._height},t}();function qb(t){Cc(t)&&(t=(new DOMParser).parseFromString(t,"text/xml"));var e=t;for(9===e.nodeType&&(e=e.firstChild);"svg"!==e.nodeName.toLowerCase()||1!==e.nodeType;)e=e.nextSibling;return e}var Kb,Zb={fill:"fill",stroke:"stroke","stroke-width":"lineWidth",opacity:"opacity","fill-opacity":"fillOpacity","stroke-opacity":"strokeOpacity","stroke-dasharray":"lineDash","stroke-dashoffset":"lineDashOffset","stroke-linecap":"lineCap","stroke-linejoin":"lineJoin","stroke-miterlimit":"miterLimit","font-family":"fontFamily","font-size":"fontSize","font-style":"fontStyle","font-weight":"fontWeight","text-anchor":"textAlign",visibility:"visibility",display:"display"},Jb=_c(Zb),Qb={"alignment-baseline":"textBaseline","stop-color":"stopColor"},tx=_c(Qb),ex=function(){function t(){this._defs={},this._root=null}return t.prototype.parse=function(t,e){e=e||{};var n=qb(t);this._defsUsePending=[];var r=new Ep;this._root=r;var i=[],s=n.getAttribute("viewBox")||"",o=parseFloat(n.getAttribute("width")||e.width),a=parseFloat(n.getAttribute("height")||e.height);isNaN(o)&&(o=null),isNaN(a)&&(a=null),ax(n,r,null,!0,!1);for(var l,c,h=n.firstChild;h;)this._parseNode(h,r,i,null,!1,!1),h=h.nextSibling;if(function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r[0].style[r[1]]=t[r[2]]}}(this._defs,this._defsUsePending),this._defsUsePending=[],s){var u=ux(s);u.length>=4&&(l={x:parseFloat(u[0]||0),y:parseFloat(u[1]||0),width:parseFloat(u[2]),height:parseFloat(u[3])})}if(l&&null!=o&&null!=a&&(c=gx(l,{x:0,y:0,width:o,height:a}),!e.ignoreViewBox)){var d=r;(r=new Ep).add(d),d.scaleX=d.scaleY=c.scale,d.x=c.x,d.y=c.y}return e.ignoreRootClip||null==o||null==a||r.setClipPath(new mg({shape:{x:0,y:0,width:o,height:a}})),{root:r,width:o,height:a,viewBoxRect:l,viewBoxTransform:c,named:i}},t.prototype._parseNode=function(t,e,n,r,i,s){var o,a=t.nodeName.toLowerCase(),l=r;if("defs"===a&&(i=!0),"text"===a&&(s=!0),"defs"===a||"switch"===a)o=e;else{if(!i){var c=Kb[a];if(c&&eh(Kb,a)){o=c.call(this,t,e);var h=t.getAttribute("name");if(h){var u={name:h,namedFrom:null,svgNodeTagLower:a,el:o};n.push(u),"g"===a&&(l=u)}else r&&n.push({name:r.name,namedFrom:r,svgNodeTagLower:a,el:o});e.add(o)}}var d=nx[a];if(d&&eh(nx,a)){var f=d.call(this,t),p=t.getAttribute("id");p&&(this._defs[p]=f)}}if(o&&o.isGroup)for(var m=t.firstChild;m;)1===m.nodeType?this._parseNode(m,o,n,l,i,s):3===m.nodeType&&s&&this._parseText(m,o),m=m.nextSibling},t.prototype._parseText=function(t,e){var n=new rg({style:{text:t.textContent},silent:!0,x:this._textX||0,y:this._textY||0});sx(e,n),ax(t,n,this._defsUsePending,!1,!1),function(t,e){var n=e.__selfStyle;if(n){var r=n.textBaseline,i=r;r&&"auto"!==r?"baseline"===r?i="alphabetic":"before-edge"===r||"text-before-edge"===r?i="top":"after-edge"===r||"text-after-edge"===r?i="bottom":"central"!==r&&"mathematical"!==r||(i="middle"):i="alphabetic",t.style.textBaseline=i}var s=e.__inheritedStyle;if(s){var o=s.textAlign,a=o;o&&("middle"===o&&(a="center"),t.style.textAlign=a)}}(n,e);var r=n.style,i=r.fontSize;i&&i<9&&(r.fontSize=9,n.scaleX*=i/9,n.scaleY*=i/9);var s=(r.fontSize||r.fontFamily)&&[r.fontStyle,r.fontWeight,(r.fontSize||12)+"px",r.fontFamily||"sans-serif"].join(" ");r.font=s;var o=n.getBoundingRect();return this._textX+=o.width,e.add(n),n},t.internalField=void(Kb={g:function(t,e){var n=new Ep;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n},rect:function(t,e){var n=new mg;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.setShape({x:parseFloat(t.getAttribute("x")||"0"),y:parseFloat(t.getAttribute("y")||"0"),width:parseFloat(t.getAttribute("width")||"0"),height:parseFloat(t.getAttribute("height")||"0")}),n.silent=!0,n},circle:function(t,e){var n=new nv;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),r:parseFloat(t.getAttribute("r")||"0")}),n.silent=!0,n},line:function(t,e){var n=new Lv;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.setShape({x1:parseFloat(t.getAttribute("x1")||"0"),y1:parseFloat(t.getAttribute("y1")||"0"),x2:parseFloat(t.getAttribute("x2")||"0"),y2:parseFloat(t.getAttribute("y2")||"0")}),n.silent=!0,n},ellipse:function(t,e){var n=new sv;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.setShape({cx:parseFloat(t.getAttribute("cx")||"0"),cy:parseFloat(t.getAttribute("cy")||"0"),rx:parseFloat(t.getAttribute("rx")||"0"),ry:parseFloat(t.getAttribute("ry")||"0")}),n.silent=!0,n},polygon:function(t,e){var n,r=t.getAttribute("points");r&&(n=ox(r));var i=new Cv({shape:{points:n||[]},silent:!0});return sx(e,i),ax(t,i,this._defsUsePending,!1,!1),i},polyline:function(t,e){var n,r=t.getAttribute("points");r&&(n=ox(r));var i=new Iv({shape:{points:n||[]},silent:!0});return sx(e,i),ax(t,i,this._defsUsePending,!1,!1),i},image:function(t,e){var n=new ag;return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.setStyle({image:t.getAttribute("xlink:href")||t.getAttribute("href"),x:+t.getAttribute("x"),y:+t.getAttribute("y"),width:+t.getAttribute("width"),height:+t.getAttribute("height")}),n.silent=!0,n},text:function(t,e){var n=t.getAttribute("x")||"0",r=t.getAttribute("y")||"0",i=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0";this._textX=parseFloat(n)+parseFloat(i),this._textY=parseFloat(r)+parseFloat(s);var o=new Ep;return sx(e,o),ax(t,o,this._defsUsePending,!1,!0),o},tspan:function(t,e){var n=t.getAttribute("x"),r=t.getAttribute("y");null!=n&&(this._textX=parseFloat(n)),null!=r&&(this._textY=parseFloat(r));var i=t.getAttribute("dx")||"0",s=t.getAttribute("dy")||"0",o=new Ep;return sx(e,o),ax(t,o,this._defsUsePending,!1,!0),this._textX+=parseFloat(i),this._textY+=parseFloat(s),o},path:function(t,e){var n=Kg(t.getAttribute("d")||"");return sx(e,n),ax(t,n,this._defsUsePending,!1,!1),n.silent=!0,n}}),t}(),nx={lineargradient:function(t){var e=parseInt(t.getAttribute("x1")||"0",10),n=parseInt(t.getAttribute("y1")||"0",10),r=parseInt(t.getAttribute("x2")||"10",10),i=parseInt(t.getAttribute("y2")||"0",10),s=new $v(e,n,r,i);return rx(t,s),ix(t,s),s},radialgradient:function(t){var e=parseInt(t.getAttribute("cx")||"0",10),n=parseInt(t.getAttribute("cy")||"0",10),r=parseInt(t.getAttribute("r")||"0",10),i=new Yv(e,n,r);return rx(t,i),ix(t,i),i}};function rx(t,e){"userSpaceOnUse"===t.getAttribute("gradientUnits")&&(e.global=!0)}function ix(t,e){for(var n=t.firstChild;n;){if(1===n.nodeType&&"stop"===n.nodeName.toLocaleLowerCase()){var r=n.getAttribute("offset"),i=void 0;i=r&&r.indexOf("%")>0?parseInt(r,10)/100:r?parseFloat(r):0;var s={};mx(n,s,s);var o=s.stopColor||n.getAttribute("stop-color")||"#000000";e.colorStops.push({offset:i,color:o})}n=n.nextSibling}}function sx(t,e){t&&t.__inheritedStyle&&(e.__inheritedStyle||(e.__inheritedStyle={}),fc(e.__inheritedStyle,t.__inheritedStyle))}function ox(t){for(var e=ux(t),n=[],r=0;r<e.length;r+=2){var i=parseFloat(e[r]),s=parseFloat(e[r+1]);n.push([i,s])}return n}function ax(t,e,n,r,i){var s=e,o=s.__inheritedStyle=s.__inheritedStyle||{},a={};1===t.nodeType&&(function(t,e){var n=t.getAttribute("transform");if(n){n=n.replace(/,/g," ");var r=[],i=null;n.replace(dx,(function(t,e,n){return r.push(e,n),""}));for(var s=r.length-1;s>0;s-=2){var o=r[s],a=r[s-1],l=ux(o);switch(i=i||[1,0,0,1,0,0],a){case"translate":eu(i,i,[parseFloat(l[0]),parseFloat(l[1]||"0")]);break;case"scale":ru(i,i,[parseFloat(l[0]),parseFloat(l[1]||l[0])]);break;case"rotate":nu(i,i,-parseFloat(l[0])*fx);break;case"skewX":tu(i,[1,0,Math.tan(parseFloat(l[0])*fx),1,0,0],i);break;case"skewY":tu(i,[1,Math.tan(parseFloat(l[0])*fx),0,1,0,0],i);break;case"matrix":i[0]=parseFloat(l[0]),i[1]=parseFloat(l[1]),i[2]=parseFloat(l[2]),i[3]=parseFloat(l[3]),i[4]=parseFloat(l[4]),i[5]=parseFloat(l[5])}}e.setLocalTransform(i)}}(t,e),mx(t,o,a),r||function(t,e,n){for(var r=0;r<Jb.length;r++){var i=Jb[r];null!=(s=t.getAttribute(i))&&(e[Zb[i]]=s)}for(r=0;r<tx.length;r++){var s;i=tx[r];null!=(s=t.getAttribute(i))&&(n[Qb[i]]=s)}}(t,o,a)),s.style=s.style||{},null!=o.fill&&(s.style.fill=cx(s,"fill",o.fill,n)),null!=o.stroke&&(s.style.stroke=cx(s,"stroke",o.stroke,n)),yc(["lineWidth","opacity","fillOpacity","strokeOpacity","miterLimit","fontSize"],(function(t){null!=o[t]&&(s.style[t]=parseFloat(o[t]))})),yc(["lineDashOffset","lineCap","lineJoin","fontWeight","fontFamily","fontStyle","textAlign"],(function(t){null!=o[t]&&(s.style[t]=o[t])})),i&&(s.__selfStyle=a),o.lineDash&&(s.style.lineDash=bc(ux(o.lineDash),(function(t){return parseFloat(t)}))),"hidden"!==o.visibility&&"collapse"!==o.visibility||(s.invisible=!0),"none"===o.display&&(s.ignore=!0)}var lx=/^url\(\s*#(.*?)\)/;function cx(t,e,n,r){var i=n&&n.match(lx);if(!i)return"none"===n&&(n=null),n;var s=Wc(i[1]);r.push([t,e,s])}var hx=/-?([0-9]*\.)?[0-9]+([eE]-?[0-9]+)?/g;function ux(t){return t.match(hx)||[]}var dx=/(translate|scale|rotate|skewX|skewY|matrix)\(([\-\s0-9\.eE,]*)\)/g,fx=Math.PI/180;var px=/([^\s:;]+)\s*:\s*([^:;]+)/g;function mx(t,e,n){var r,i=t.getAttribute("style");if(i)for(px.lastIndex=0;null!=(r=px.exec(i));){var s=r[1],o=eh(Zb,s)?Zb[s]:null;o&&(e[o]=r[2]);var a=eh(Qb,s)?Qb[s]:null;a&&(n[a]=r[2])}}function gx(t,e){var n=e.width/t.width,r=e.height/t.height,i=Math.min(n,r);return{scale:i,x:-(t.x+t.width/2)*i+(e.x+e.width/2),y:-(t.y+t.height/2)*i+(e.y+e.height/2)}}function vx(t,e){return(new ex).parse(t,e)}var yx=Om.CMD;function bx(t,e){return Math.abs(t-e)<1e-5}function xx(t){var e,n,r,i,s,o,a,l,c,h,u,d,f,p,m,g,v,y,b,x,w,E,_,S,T=t.data,k=t.len(),A=[],C=0,R=0,M=0,I=0;function D(t,n){e&&e.length>2&&A.push(e),e=[t,n]}function O(t,n,r,i){bx(t,r)&&bx(n,i)||e.push(t,n,r,i,r,i)}for(var P=0;P<k;){var L=T[P++],F=1===P;switch(F&&(M=C=T[P],I=R=T[P+1],L!==yx.L&&L!==yx.C&&L!==yx.Q||(e=[M,I])),L){case yx.M:C=M=T[P++],R=I=T[P++],D(M,I);break;case yx.L:O(C,R,n=T[P++],r=T[P++]),C=n,R=r;break;case yx.C:e.push(T[P++],T[P++],T[P++],T[P++],C=T[P++],R=T[P++]);break;case yx.Q:n=T[P++],r=T[P++],i=T[P++],s=T[P++],e.push(C+2/3*(n-C),R+2/3*(r-R),i+2/3*(n-i),s+2/3*(r-s),i,s),C=i,R=s;break;case yx.A:var N=T[P++],B=T[P++],U=T[P++],V=T[P++],j=T[P++],z=T[P++]+j;P+=1;var G=!T[P++];n=Math.cos(j)*U+N,r=Math.sin(j)*V+B,F?D(M=n,I=r):O(C,R,n,r),C=Math.cos(z)*U+N,R=Math.sin(z)*V+B;for(var W=(G?-1:1)*Math.PI/2,H=j;G?H>z:H<z;H+=W){var $=G?Math.max(H+W,z):Math.min(H+W,z);o=H,a=$,l=N,c=B,h=U,u=V,d=void 0,f=void 0,p=void 0,m=void 0,g=void 0,v=void 0,y=void 0,b=void 0,x=void 0,w=void 0,E=void 0,_=void 0,S=void 0,d=Math.abs(a-o),f=4*Math.tan(d/4)/3,p=a<o?-1:1,m=Math.cos(o),g=Math.sin(o),v=Math.cos(a),y=Math.sin(a),b=m*h+l,x=g*u+c,w=v*h+l,E=y*u+c,_=h*f*p,S=u*f*p,e.push(b-_*g,x+S*m,w+_*y,E-S*v,w,E)}break;case yx.R:M=C=T[P++],I=R=T[P++],n=M+T[P++],r=I+T[P++],D(n,I),O(n,I,n,r),O(n,r,M,r),O(M,r,M,I),O(M,I,n,I);break;case yx.Z:e&&O(C,R,M,I),C=M,R=I}}return e&&e.length>2&&A.push(e),A}function Ex(t,e,n,r,i,s,o,a,l,c){if(bx(t,n)&&bx(e,r)&&bx(i,o)&&bx(s,a))l.push(o,a);else{var h=2/c,u=h*h,d=o-t,f=a-e,p=Math.sqrt(d*d+f*f);d/=p,f/=p;var m=n-t,g=r-e,v=i-o,y=s-a,b=m*m+g*g,x=v*v+y*y;if(b<u&&x<u)l.push(o,a);else{var w=d*m+f*g,E=-d*v-f*y;if(b-w*w<u&&w>=0&&x-E*E<u&&E>=0)l.push(o,a);else{var _=[],S=[];od(t,n,i,o,.5,_),od(e,r,s,a,.5,S),Ex(_[0],S[0],_[1],S[1],_[2],S[2],_[3],S[3],l,c),Ex(_[4],S[4],_[5],S[5],_[6],S[6],_[7],S[7],l,c)}}}}function _x(t,e,n){var r=t[e],i=t[1-e],s=Math.abs(r/i),o=Math.ceil(Math.sqrt(s*n)),a=Math.floor(n/o);0===a&&(a=1,o=n);for(var l=[],c=0;c<o;c++)l.push(a);var h=n-o*a;if(h>0)for(c=0;c<h;c++)l[c%o]+=1;return l}function Sx(t,e,n){for(var r=t.r0,i=t.r,s=t.startAngle,o=t.endAngle,a=Math.abs(o-s),l=a*i,c=i-r,h=l>Math.abs(c),u=_x([l,c],h?0:1,e),d=(h?a:c)/u.length,f=0;f<u.length;f++)for(var p=(h?c:a)/u[f],m=0;m<u[f];m++){var g={};h?(g.startAngle=s+d*f,g.endAngle=s+d*(f+1),g.r0=r+p*m,g.r=r+p*(m+1)):(g.startAngle=s+p*m,g.endAngle=s+p*(m+1),g.r0=r+d*f,g.r=r+d*(f+1)),g.clockwise=t.clockwise,g.cx=t.cx,g.cy=t.cy,n.push(g)}}function Tx(t,e,n,r){return t*r-n*e}function kx(t,e,n,r,i,s,o,a){var l=n-t,c=r-e,h=o-i,u=a-s,d=Tx(h,u,l,c);if(Math.abs(d)<1e-6)return null;var f=Tx(t-i,e-s,h,u)/d;return f<0||f>1?null:new au(f*l+t,f*c+e)}function Ax(t,e,n){var r=new au;au.sub(r,n,e),r.normalize();var i=new au;return au.sub(i,t,e),i.dot(r)}function Cx(t,e){var n=t[t.length-1];n&&n[0]===e[0]&&n[1]===e[1]||t.push(e)}function Rx(t){var e=t.points,n=[],r=[];lm(e,n,r);var i=new gu(n[0],n[1],r[0]-n[0],r[1]-n[1]),s=i.width,o=i.height,a=i.x,l=i.y,c=new au,h=new au;return s>o?(c.x=h.x=a+s/2,c.y=l,h.y=l+o):(c.y=h.y=l+o/2,c.x=a,h.x=a+s),function(t,e,n){for(var r=t.length,i=[],s=0;s<r;s++){var o=t[s],a=t[(s+1)%r],l=kx(o[0],o[1],a[0],a[1],e.x,e.y,n.x,n.y);l&&i.push({projPt:Ax(l,e,n),pt:l,idx:s})}if(i.length<2)return[{points:t},{points:t}];i.sort((function(t,e){return t.projPt-e.projPt}));var c=i[0],h=i[i.length-1];if(h.idx<c.idx){var u=c;c=h,h=u}var d=[c.pt.x,c.pt.y],f=[h.pt.x,h.pt.y],p=[d],m=[f];for(s=c.idx+1;s<=h.idx;s++)Cx(p,t[s].slice());for(Cx(p,f),Cx(p,d),s=h.idx+1;s<=c.idx+r;s++)Cx(m,t[s%r].slice());return Cx(m,d),Cx(m,f),[{points:p},{points:m}]}(e,c,h)}function Mx(t,e,n,r){if(1===n)r.push(e);else{var i=Math.floor(n/2),s=t(e);Mx(t,s[0],i,r),Mx(t,s[1],n-i,r)}return r}function Ix(t,e){var n,r=[],i=t.shape;switch(t.type){case"rect":!function(t,e,n){for(var r=t.width,i=t.height,s=r>i,o=_x([r,i],s?0:1,e),a=s?"width":"height",l=s?"height":"width",c=s?"x":"y",h=s?"y":"x",u=t[a]/o.length,d=0;d<o.length;d++)for(var f=t[l]/o[d],p=0;p<o[d];p++){var m={};m[c]=d*u,m[h]=p*f,m[a]=u,m[l]=f,m.x+=t.x,m.y+=t.y,n.push(m)}}(i,e,r),n=mg;break;case"sector":Sx(i,e,r),n=wv;break;case"circle":Sx({r0:0,r:i.r,startAngle:0,endAngle:2*Math.PI,cx:i.cx,cy:i.cy},e,r),n=wv;break;default:var s=t.getComputedTransform(),o=s?Math.sqrt(Math.max(s[0]*s[0]+s[1]*s[1],s[2]*s[2]+s[3]*s[3])):1,a=bc(function(t,e){var n=xx(t),r=[];e=e||1;for(var i=0;i<n.length;i++){var s=n[i],o=[],a=s[0],l=s[1];o.push(a,l);for(var c=2;c<s.length;){var h=s[c++],u=s[c++],d=s[c++],f=s[c++],p=s[c++],m=s[c++];Ex(a,l,h,u,d,f,p,m,o,e),a=p,l=m}r.push(o)}return r}(t.getUpdatedPathProxy(),o),(function(t){return function(t){for(var e=[],n=0;n<t.length;)e.push([t[n++],t[n++]]);return e}(t)})),l=a.length;if(0===l)Mx(Rx,{points:a[0]},e,r);else if(l===e)for(var c=0;c<l;c++)r.push({points:a[c]});else{var h=0,u=bc(a,(function(t){var e=[],n=[];lm(t,e,n);var r=(n[1]-e[1])*(n[0]-e[0]);return h+=r,{poly:t,area:r}}));u.sort((function(t,e){return e.area-t.area}));var d=e;for(c=0;c<l;c++){var f=u[c];if(d<=0)break;var p=c===l-1?d:Math.ceil(f.area/h*e);p<0||(Mx(Rx,{points:f.poly},p,r),d-=p)}}n=Cv}if(!n)return function(t,e){for(var n=[],r=0;r<e;r++)n.push(Qg(t));return n}(t,e);var m,g,v=[];for(c=0;c<r.length;c++){var y=new n;y.setShape(r[c]),m=t,(g=y).setStyle(m.style),g.z=m.z,g.z2=m.z2,g.zlevel=m.zlevel,v.push(y)}return v}function Dx(t,e){var n=t.length,r=e.length;if(n===r)return[t,e];for(var i=[],s=[],o=n<r?t:e,a=Math.min(n,r),l=Math.abs(r-n)/6,c=(a-2)/6,h=Math.ceil(l/c)+1,u=[o[0],o[1]],d=l,f=2;f<a;){var p=o[f-2],m=o[f-1],g=o[f++],v=o[f++],y=o[f++],b=o[f++],x=o[f++],w=o[f++];if(d<=0)u.push(g,v,y,b,x,w);else{for(var E=Math.min(d,h-1)+1,_=1;_<=E;_++){var S=_/E;od(p,g,y,x,S,i),od(m,v,b,w,S,s),p=i[3],m=s[3],u.push(i[1],s[1],i[2],s[2],p,m),g=i[5],v=s[5],y=i[6],b=s[6]}d-=E-1}}return o===t?[u,e]:[t,u]}function Ox(t,e){for(var n=t.length,r=t[n-2],i=t[n-1],s=[],o=0;o<e.length;)s[o++]=r,s[o++]=i;return s}function Px(t){for(var e=0,n=0,r=0,i=t.length,s=0,o=i-2;s<i;o=s,s+=2){var a=t[o],l=t[o+1],c=t[s],h=t[s+1],u=a*h-c*l;e+=u,n+=(a+c)*u,r+=(l+h)*u}return 0===e?[t[0]||0,t[1]||0]:[n/e/3,r/e/3,e]}function Lx(t,e,n,r){for(var i=(t.length-2)/6,s=1/0,o=0,a=t.length,l=a-2,c=0;c<i;c++){for(var h=6*c,u=0,d=0;d<a;d+=2){var f=0===d?h:(h+d-2)%l+2,p=t[f]-n[0],m=t[f+1]-n[1],g=e[d]-r[0]-p,v=e[d+1]-r[1]-m;u+=g*g+v*v}u<s&&(s=u,o=c)}return o}function Fx(t){for(var e=[],n=t.length,r=0;r<n;r+=2)e[r]=t[n-r-2],e[r+1]=t[n-r-1];return e}function Nx(t){return t.__isCombineMorphing}var Bx="__mOriginal_";function Ux(t,e,n){var r=Bx+e,i=t[r]||t[e];t[r]||(t[r]=t[e]);var s=n.replace,o=n.after,a=n.before;t[e]=function(){var t,e=arguments;return a&&a.apply(this,e),t=s?s.apply(this,e):i.apply(this,e),o&&o.apply(this,e),t}}function Vx(t,e){var n=Bx+e;t[n]&&(t[e]=t[n],t[n]=null)}function jx(t,e){for(var n=0;n<t.length;n++)for(var r=t[n],i=0;i<r.length;){var s=r[i],o=r[i+1];r[i++]=e[0]*s+e[2]*o+e[4],r[i++]=e[1]*s+e[3]*o+e[5]}}function zx(t,e){var n=t.getUpdatedPathProxy(),r=e.getUpdatedPathProxy(),i=function(t,e){for(var n,r,i,s=[],o=[],a=0;a<Math.max(t.length,e.length);a++){var l=t[a],c=e[a],h=void 0,u=void 0;l?c?(r=h=(n=Dx(l,c))[0],i=u=n[1]):(u=Ox(i||l,l),h=l):(h=Ox(r||c,c),u=c),s.push(h),o.push(u)}return[s,o]}(xx(n),xx(r)),s=i[0],o=i[1],a=t.getComputedTransform(),l=e.getComputedTransform();a&&jx(s,a),l&&jx(o,l),Ux(e,"updateTransform",{replace:function(){this.transform=null}}),e.transform=null;var c=function(t,e,n,r){for(var i,s=[],o=0;o<t.length;o++){var a=t[o],l=e[o],c=Px(a),h=Px(l);null==i&&(i=c[2]<0!=h[2]<0);var u=[],d=[],f=0,p=1/0,m=[],g=a.length;i&&(a=Fx(a));for(var v=6*Lx(a,l,c,h),y=g-2,b=0;b<y;b+=2){var x=(v+b)%y+2;u[b+2]=a[x]-c[0],u[b+3]=a[x+1]-c[1]}if(u[0]=a[v]-c[0],u[1]=a[v+1]-c[1],n>0)for(var w=r/n,E=-r/2;E<=r/2;E+=w){var _=Math.sin(E),S=Math.cos(E),T=0;for(b=0;b<a.length;b+=2){var k=u[b],A=u[b+1],C=l[b]-h[0],R=l[b+1]-h[1],M=C*S-R*_,I=C*_+R*S;m[b]=M,m[b+1]=I;var D=M-k,O=I-A;T+=D*D+O*O}if(T<p){p=T,f=E;for(var P=0;P<m.length;P++)d[P]=m[P]}}else for(var L=0;L<g;L+=2)d[L]=l[L]-h[0],d[L+1]=l[L+1]-h[1];s.push({from:u,to:d,fromCp:c,toCp:h,rotation:-f})}return s}(s,o,10,Math.PI),h=[];Ux(e,"buildPath",{replace:function(t){for(var n=e.__morphT,r=1-n,i=[],s=0;s<c.length;s++){var o=c[s],a=o.from,l=o.to,u=o.rotation*n,d=o.fromCp,f=o.toCp,p=Math.sin(u),m=Math.cos(u);bh(i,d,f,n);for(var g=0;g<a.length;g+=2){var v=a[g],y=a[g+1],b=v*r+(_=l[g])*n,x=y*r+(S=l[g+1])*n;h[g]=b*m-x*p+i[0],h[g+1]=b*p+x*m+i[1]}var w=h[0],E=h[1];t.moveTo(w,E);for(g=2;g<a.length;){var _=h[g++],S=h[g++],T=h[g++],k=h[g++],A=h[g++],C=h[g++];w===_&&E===S&&T===A&&k===C?t.lineTo(A,C):t.bezierCurveTo(_,S,T,k,A,C),w=A,E=C}}}})}function Gx(t,e,n){if(!t||!e)return e;var r=n.done,i=n.during;return zx(t,e),e.__morphT=0,e.animateTo({__morphT:1},fc({during:function(t){e.dirtyShape(),i&&i(t)},done:function(){Vx(e,"buildPath"),Vx(e,"updateTransform"),e.__morphT=-1,e.createPathProxy(),e.dirtyShape(),r&&r()}},n)),e}function Wx(t,e,n,r,i,s){t=i===n?0:Math.round(32767*(t-n)/(i-n)),e=s===r?0:Math.round(32767*(e-r)/(s-r));for(var o,a=0,l=32768;l>0;l/=2){var c=0,h=0;(t&l)>0&&(c=1),(e&l)>0&&(h=1),a+=l*l*(3*c^h),0===h&&(1===c&&(t=l-1-t,e=l-1-e),o=t,t=e,e=o)}return a}function Hx(t){var e=1/0,n=1/0,r=-1/0,i=-1/0,s=bc(t,(function(t){var s=t.getBoundingRect(),o=t.getComputedTransform(),a=s.x+s.width/2+(o?o[4]:0),l=s.y+s.height/2+(o?o[5]:0);return e=Math.min(a,e),n=Math.min(l,n),r=Math.max(a,r),i=Math.max(l,i),[a,l]}));return bc(s,(function(s,o){return{cp:s,z:Wx(s[0],s[1],e,n,r,i),path:t[o]}})).sort((function(t,e){return t.z-e.z})).map((function(t){return t.path}))}function $x(t){return Ix(t.path,t.count)}function Yx(t,e,n){var r=[];!function t(e){for(var n=0;n<e.length;n++){var i=e[n];Nx(i)?t(i.childrenRef()):i instanceof tg&&r.push(i)}}(t);var i=r.length;if(!i)return{fromIndividuals:[],toIndividuals:[],count:0};var s=(n.dividePath||$x)({path:e,count:i});if(s.length!==i)return{fromIndividuals:[],toIndividuals:[],count:0};r=Hx(r),s=Hx(s);for(var o=n.done,a=n.during,l=n.individualDelay,c=new tp,h=0;h<i;h++){var u=r[h],d=s[h];d.parent=e,d.copyTransform(c),l||zx(u,d)}function f(t){for(var e=0;e<s.length;e++)s[e].addSelfToZr(t)}function p(){e.__isCombineMorphing=!1,e.__morphT=-1,e.childrenRef=null,Vx(e,"addSelfToZr"),Vx(e,"removeSelfFromZr")}e.__isCombineMorphing=!0,e.childrenRef=function(){return s},Ux(e,"addSelfToZr",{after:function(t){f(t)}}),Ux(e,"removeSelfFromZr",{after:function(t){for(var e=0;e<s.length;e++)s[e].removeSelfFromZr(t)}});var m=s.length;if(l){var g=m,v=function(){0===--g&&(p(),o&&o())};for(h=0;h<m;h++){var y=l?fc({delay:(n.delay||0)+l(h,m,r[h],s[h]),done:v},n):n;Gx(r[h],s[h],y)}}else e.__morphT=0,e.animateTo({__morphT:1},fc({during:function(t){for(var n=0;n<m;n++){var r=s[n];r.__morphT=e.__morphT,r.dirtyShape()}a&&a(t)},done:function(){p();for(var e=0;e<t.length;e++)Vx(t[e],"updateTransform");o&&o()}},n));return e.__zr&&f(e.__zr),{fromIndividuals:r,toIndividuals:s,count:m}}function Xx(t,e,n){var r=e.length,i=[],s=n.dividePath||$x;if(Nx(t)){!function t(e){for(var n=0;n<e.length;n++){var r=e[n];Nx(r)?t(r.childrenRef()):r instanceof tg&&i.push(r)}}(t.childrenRef());var o=i.length;if(o<r)for(var a=0,l=o;l<r;l++)i.push(Qg(i[a++%o]));i.length=r}else{i=s({path:t,count:r});var c=t.getComputedTransform();for(l=0;l<i.length;l++)i[l].setLocalTransform(c);if(i.length!==r)return{fromIndividuals:[],toIndividuals:[],count:0}}i=Hx(i),e=Hx(e);var h=n.individualDelay;for(l=0;l<r;l++){var u=h?fc({delay:(n.delay||0)+h(l,r,i[l],e[l])},n):n;Gx(i[l],e[l],u)}return{fromIndividuals:i,toIndividuals:e,count:e.length}}var qx=Object.defineProperty,Kx=(t,e,n)=>(((t,e,n)=>{e in t?qx(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),Zx=(t=>(t.docTypeError="docTypeError",t.contextNotFound="contextNotFound",t.timerNotFound="timerNotFound",t.ctxCallOutOfScope="ctxCallOutOfScope",t.createNodeInParserFail="createNodeInParserFail",t.stackOverFlow="stackOverFlow",t.parserMatchError="parserMatchError",t.serializerMatchError="serializerMatchError",t.getAtomFromSchemaFail="getAtomFromSchemaFail",t.expectDomTypeError="expectDomTypeError",t.callCommandBeforeEditorView="callCommandBeforeEditorView",t.themeMustInstalled="themeMustInstalled",t.missingRootElement="missingRootElement",t.missingNodeInSchema="missingNodeInSchema",t.missingMarkInSchema="missingMarkInSchema",t.missingIcon="missingIcon",t.vueRendererCallOutOfScope="vueRendererCallOutOfScope",t.ctxNotBind="ctxNotBind",t.missingYjsDoc="missingYjsDoc",t.repeatCallsToMenuWrapperInit="repeatCallsToMenuWrapperInit",t.missingMenuWrapper="missingMenuWrapper",t))(Zx||{});let Jx=class extends Error{constructor(t,e){super(e),Kx(this,"code"),this.name="MilkdownError",this.code=t}};const Qx=(t,e)=>"function"==typeof e?"[Function]":e,tw=t=>JSON.stringify(t,Qx),ew=()=>new Jx(Zx.stackOverFlow,"Stack over flow, cannot pop on an empty stack."),nw=t=>new Jx(Zx.expectDomTypeError,`Expect to be a dom, but get: ${tw(t)}.`),rw=()=>new Jx(Zx.themeMustInstalled,"It seems that no theme found in editor, please make sure you have use theme in front of all plugins.\nIf you prefer to use an empty theme, you can use `themeFactory({})`."),iw=()=>new Jx(Zx.missingRootElement,"Missing root element, milkdown cannot find root element of the editor."),sw=t=>new Jx(Zx.missingIcon,`Missing icon in theme, milkdown cannot find icon "${t}" in theme.`),ow=()=>new Jx(Zx.missingMenuWrapper,"Missing menu wrapper, should init menu wrapper first.");var aw=Object.defineProperty,lw=(t,e,n)=>(((t,e,n)=>{e in t?aw(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),cw=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},hw=(t,e,n)=>(cw(t,e,"read from private field"),n?n.call(t):e.get(t)),uw=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},dw=(t,e,n,r)=>(cw(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);const fw=()=>{const t=new Map;return{sliceMap:t,getSlice:e=>{const n="string"==typeof e?[...t.values()].find((t=>t.name===e)):t.get(e.id);if(!n){throw(t=>new Jx(Zx.contextNotFound,`Context "${t}" not found, do you forget to inject it?`))("string"==typeof e?e:e.sliceName)}return n},removeSlice:e=>{const n="string"==typeof e?[...t.values()].find((t=>t.name===e)):t.get(e.id);!n||t.delete(n.id)}}},pw=(t,e)=>{const n=Symbol(`Context-${e}`),r=(r,i=(t=>Array.isArray(t)?[...t]:"object"==typeof t?{...t}:t)(t))=>{let s=i;const o={name:e,id:n,set:t=>{s=t},get:()=>s,update:t=>{s=t(s)}};return r.set(n,o),o};return r.sliceName=e,r.id=n,r._typeInfo=()=>{throw new Jx(Zx.ctxCallOutOfScope,"Should not call a context out of the plugin.")},r};var mw,gw;let vw=class{constructor(t,e){uw(this,mw,void 0),uw(this,gw,void 0),lw(this,"use",(t=>hw(this,mw).getSlice(t))),lw(this,"get",(t=>this.use(t).get())),lw(this,"set",((t,e)=>this.use(t).set(e))),lw(this,"update",((t,e)=>this.use(t).update(e))),lw(this,"timing",(t=>hw(this,gw).get(t))),lw(this,"done",(t=>this.timing(t).done())),lw(this,"wait",(t=>this.timing(t)())),lw(this,"waitTimers",(async t=>{await Promise.all(this.get(t).map((t=>this.wait(t))))})),dw(this,mw,t),dw(this,gw,e)}};var yw,bw;mw=new WeakMap,gw=new WeakMap;let xw=class{constructor(t,e){uw(this,yw,void 0),uw(this,bw,void 0),lw(this,"inject",((t,e)=>(t(hw(this,yw).sliceMap,e),this))),lw(this,"remove",(t=>(hw(this,yw).removeSlice(t),this))),lw(this,"record",(t=>(t(hw(this,bw).store),this))),lw(this,"clearTimer",(t=>(hw(this,bw).remove(t),this))),lw(this,"use",(t=>hw(this,yw).getSlice(t))),lw(this,"get",(t=>this.use(t).get())),lw(this,"set",((t,e)=>this.use(t).set(e))),lw(this,"update",((t,e)=>this.use(t).update(e))),lw(this,"timing",(t=>hw(this,bw).get(t))),lw(this,"wait",(t=>this.timing(t)())),lw(this,"done",(t=>this.timing(t).done())),lw(this,"waitTimers",(async t=>{await Promise.all(this.get(t).map((t=>this.wait(t))))})),dw(this,yw,t),dw(this,bw,e)}};var ww,Ew;yw=new WeakMap,bw=new WeakMap;let _w=class{constructor(t,e){uw(this,ww,void 0),uw(this,Ew,void 0),lw(this,"clearTimer",(t=>(hw(this,Ew).remove(t),this))),lw(this,"remove",(t=>(hw(this,ww).removeSlice(t),this))),dw(this,ww,t),dw(this,Ew,e)}};var Sw,Tw;ww=new WeakMap,Ew=new WeakMap;let kw=class{constructor(t,e){uw(this,Sw,void 0),uw(this,Tw,void 0),lw(this,"inject",((t,e)=>(t(hw(this,Sw).sliceMap,e),this))),lw(this,"record",(t=>(t(hw(this,Tw).store),this))),dw(this,Sw,t),dw(this,Tw,e)}};Sw=new WeakMap,Tw=new WeakMap;const Aw=()=>{const t=new Map;return{store:t,get:e=>{const n=t.get(e.id);if(!n)throw(t=>new Jx(Zx.timerNotFound,`Timer "${t}" not found, do you forget to record it?`))(e.timerName);return n},remove:e=>{t.delete(e.id)}}},Cw=(t,e=3e3)=>{const n=Symbol("Timer"),r=r=>{let i,s=null;const o=Symbol(t),a=()=>null!=s?s:s=new Promise(((n,r)=>{i=e=>{e instanceof CustomEvent&&e.detail.id===o&&(removeEventListener(t,i),e.stopImmediatePropagation(),n())},setTimeout((()=>{r(new Error(`Timing ${t} timeout.`)),removeEventListener(t,i)}),e),addEventListener(t,i)}));return a.done=()=>{const e=new CustomEvent(t,{detail:{id:o}});dispatchEvent(e)},r.set(n,a),a};return r.id=n,r.timerName=t,r};var Rw=function(){function t(t){var e=this;this._insertTag=function(t){var n;n=0===e.tags.length?e.insertionPoint?e.insertionPoint.nextSibling:e.prepend?e.container.firstChild:e.before:e.tags[e.tags.length-1].nextSibling,e.container.insertBefore(t,n),e.tags.push(t)},this.isSpeedy=void 0===t.speedy||t.speedy,this.tags=[],this.ctr=0,this.nonce=t.nonce,this.key=t.key,this.container=t.container,this.prepend=t.prepend,this.insertionPoint=t.insertionPoint,this.before=null}var e=t.prototype;return e.hydrate=function(t){t.forEach(this._insertTag)},e.insert=function(t){this.ctr%(this.isSpeedy?65e3:1)==0&&this._insertTag(function(t){var e=document.createElement("style");return e.setAttribute("data-emotion",t.key),void 0!==t.nonce&&e.setAttribute("nonce",t.nonce),e.appendChild(document.createTextNode("")),e.setAttribute("data-s",""),e}(this));var e=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(t){if(t.sheet)return t.sheet;for(var e=0;e<document.styleSheets.length;e++)if(document.styleSheets[e].ownerNode===t)return document.styleSheets[e]}(e);try{n.insertRule(t,n.cssRules.length)}catch(Ni){}}else e.appendChild(document.createTextNode(t));this.ctr++},e.flush=function(){this.tags.forEach((function(t){return t.parentNode&&t.parentNode.removeChild(t)})),this.tags=[],this.ctr=0},t}(),Mw="-ms-",Iw="-moz-",Dw="-webkit-",Ow="comm",Pw="rule",Lw="decl",Fw="@keyframes",Nw=Math.abs,Bw=String.fromCharCode,Uw=Object.assign;function Vw(t){return t.trim()}function jw(t,e,n){return t.replace(e,n)}function zw(t,e){return t.indexOf(e)}function Gw(t,e){return 0|t.charCodeAt(e)}function Ww(t,e,n){return t.slice(e,n)}function Hw(t){return t.length}function $w(t){return t.length}function Yw(t,e){return e.push(t),t}var Xw=1,qw=1,Kw=0,Zw=0,Jw=0,Qw="";function tE(t,e,n,r,i,s,o){return{value:t,root:e,parent:n,type:r,props:i,children:s,line:Xw,column:qw,length:o,return:""}}function eE(t,e){return Uw(tE("",null,null,"",null,null,0),t,{length:-t.length},e)}function nE(){return Jw=Zw<Kw?Gw(Qw,Zw++):0,qw++,10===Jw&&(qw=1,Xw++),Jw}function rE(){return Gw(Qw,Zw)}function iE(){return Zw}function sE(t,e){return Ww(Qw,t,e)}function oE(t){switch(t){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function aE(t){return Xw=qw=1,Kw=Hw(Qw=t),Zw=0,[]}function lE(t){return Qw="",t}function cE(t){return Vw(sE(Zw-1,dE(91===t?t+2:40===t?t+1:t)))}function hE(t){for(;(Jw=rE())&&Jw<33;)nE();return oE(t)>2||oE(Jw)>3?"":" "}function uE(t,e){for(;--e&&nE()&&!(Jw<48||Jw>102||Jw>57&&Jw<65||Jw>70&&Jw<97););return sE(t,iE()+(e<6&&32==rE()&&32==nE()))}function dE(t){for(;nE();)switch(Jw){case t:return Zw;case 34:case 39:34!==t&&39!==t&&dE(Jw);break;case 40:41===t&&dE(t);break;case 92:nE()}return Zw}function fE(t,e){for(;nE()&&t+Jw!==57&&(t+Jw!==84||47!==rE()););return"/*"+sE(e,Zw-1)+"*"+Bw(47===t?t:nE())}function pE(t){for(;!oE(rE());)nE();return sE(t,Zw)}function mE(t){return lE(gE("",null,null,null,[""],t=aE(t),0,[0],t))}function gE(t,e,n,r,i,s,o,a,l){for(var c=0,h=0,u=o,d=0,f=0,p=0,m=1,g=1,v=1,y=0,b="",x=i,w=s,E=r,_=b;g;)switch(p=y,y=nE()){case 40:if(108!=p&&58==Gw(_,u-1)){-1!=zw(_+=jw(cE(y),"&","&\f"),"&\f")&&(v=-1);break}case 34:case 39:case 91:_+=cE(y);break;case 9:case 10:case 13:case 32:_+=hE(p);break;case 92:_+=uE(iE()-1,7);continue;case 47:switch(rE()){case 42:case 47:Yw(yE(fE(nE(),iE()),e,n),l);break;default:_+="/"}break;case 123*m:a[c++]=Hw(_)*v;case 125*m:case 59:case 0:switch(y){case 0:case 125:g=0;case 59+h:-1==v&&(_=jw(_,/\f/g,"")),f>0&&Hw(_)-u&&Yw(f>32?bE(_+";",r,n,u-1):bE(jw(_," ","")+";",r,n,u-2),l);break;case 59:_+=";";default:if(Yw(E=vE(_,e,n,c,h,i,a,b,x=[],w=[],u),s),123===y)if(0===h)gE(_,e,E,E,x,s,u,a,w);else switch(99===d&&110===Gw(_,3)?100:d){case 100:case 108:case 109:case 115:gE(t,E,E,r&&Yw(vE(t,E,E,0,0,i,a,b,i,x=[],u),w),i,w,u,a,r?x:w);break;default:gE(_,E,E,E,[""],w,0,a,w)}}c=h=f=0,m=v=1,b=_="",u=o;break;case 58:u=1+Hw(_),f=p;default:if(m<1)if(123==y)--m;else if(125==y&&0==m++&&125==(Jw=Zw>0?Gw(Qw,--Zw):0,qw--,10===Jw&&(qw=1,Xw--),Jw))continue;switch(_+=Bw(y),y*m){case 38:v=h>0?1:(_+="\f",-1);break;case 44:a[c++]=(Hw(_)-1)*v,v=1;break;case 64:45===rE()&&(_+=cE(nE())),d=rE(),h=u=Hw(b=_+=pE(iE())),y++;break;case 45:45===p&&2==Hw(_)&&(m=0)}}return s}function vE(t,e,n,r,i,s,o,a,l,c,h){for(var u=i-1,d=0===i?s:[""],f=$w(d),p=0,m=0,g=0;p<r;++p)for(var v=0,y=Ww(t,u+1,u=Nw(m=o[p])),b=t;v<f;++v)(b=Vw(m>0?d[v]+" "+y:jw(y,/&\f/g,d[v])))&&(l[g++]=b);return tE(t,e,n,0===i?Pw:a,l,c,h)}function yE(t,e,n){return tE(t,e,n,Ow,Bw(Jw),Ww(t,2,-2),0)}function bE(t,e,n,r){return tE(t,e,n,Lw,Ww(t,0,r),Ww(t,r+1,-1),r)}function xE(t,e){for(var n="",r=$w(t),i=0;i<r;i++)n+=e(t[i],i,t,e)||"";return n}function wE(t,e,n,r){switch(t.type){case"@layer":if(t.children.length)break;case"@import":case Lw:return t.return=t.return||t.value;case Ow:return"";case Fw:return t.return=t.value+"{"+xE(t.children,r)+"}";case Pw:t.value=t.props.join(",")}return Hw(n=xE(t.children,r))?t.return=t.value+"{"+n+"}":""}var EE=function(t,e,n){for(var r=0,i=0;r=i,i=rE(),38===r&&12===i&&(e[n]=1),!oE(i);)nE();return sE(t,Zw)},_E=function(t,e){return lE(function(t,e){var n=-1,r=44;do{switch(oE(r)){case 0:38===r&&12===rE()&&(e[n]=1),t[n]+=EE(Zw-1,e,n);break;case 2:t[n]+=cE(r);break;case 4:if(44===r){t[++n]=58===rE()?"&\f":"",e[n]=t[n].length;break}default:t[n]+=Bw(r)}}while(r=nE());return t}(aE(t),e))},SE=new WeakMap,TE=function(t){if("rule"===t.type&&t.parent&&!(t.length<1)){for(var e=t.value,n=t.parent,r=t.column===n.column&&t.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==t.props.length||58===e.charCodeAt(0)||SE.get(n))&&!r){SE.set(t,!0);for(var i=[],s=_E(e,i),o=n.props,a=0,l=0;a<s.length;a++)for(var c=0;c<o.length;c++,l++)t.props[l]=i[a]?s[a].replace(/&\f/g,o[c]):o[c]+" "+s[a]}}},kE=function(t){if("decl"===t.type){var e=t.value;108===e.charCodeAt(0)&&98===e.charCodeAt(2)&&(t.return="",t.value="")}};function AE(t,e){switch(function(t,e){return 45^Gw(t,0)?(((e<<2^Gw(t,0))<<2^Gw(t,1))<<2^Gw(t,2))<<2^Gw(t,3):0}(t,e)){case 5103:return Dw+"print-"+t+t;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Dw+t+t;case 5349:case 4246:case 4810:case 6968:case 2756:return Dw+t+Iw+t+Mw+t+t;case 6828:case 4268:return Dw+t+Mw+t+t;case 6165:return Dw+t+Mw+"flex-"+t+t;case 5187:return Dw+t+jw(t,/(\w+).+(:[^]+)/,Dw+"box-$1$2"+Mw+"flex-$1$2")+t;case 5443:return Dw+t+Mw+"flex-item-"+jw(t,/flex-|-self/,"")+t;case 4675:return Dw+t+Mw+"flex-line-pack"+jw(t,/align-content|flex-|-self/,"")+t;case 5548:return Dw+t+Mw+jw(t,"shrink","negative")+t;case 5292:return Dw+t+Mw+jw(t,"basis","preferred-size")+t;case 6060:return Dw+"box-"+jw(t,"-grow","")+Dw+t+Mw+jw(t,"grow","positive")+t;case 4554:return Dw+jw(t,/([^-])(transform)/g,"$1"+Dw+"$2")+t;case 6187:return jw(jw(jw(t,/(zoom-|grab)/,Dw+"$1"),/(image-set)/,Dw+"$1"),t,"")+t;case 5495:case 3959:return jw(t,/(image-set\([^]*)/,Dw+"$1$`$1");case 4968:return jw(jw(t,/(.+:)(flex-)?(.*)/,Dw+"box-pack:$3"+Mw+"flex-pack:$3"),/s.+-b[^;]+/,"justify")+Dw+t+t;case 4095:case 3583:case 4068:case 2532:return jw(t,/(.+)-inline(.+)/,Dw+"$1$2")+t;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Hw(t)-1-e>6)switch(Gw(t,e+1)){case 109:if(45!==Gw(t,e+4))break;case 102:return jw(t,/(.+:)(.+)-([^]+)/,"$1"+Dw+"$2-$3$1"+Iw+(108==Gw(t,e+3)?"$3":"$2-$3"))+t;case 115:return~zw(t,"stretch")?AE(jw(t,"stretch","fill-available"),e)+t:t}break;case 4949:if(115!==Gw(t,e+1))break;case 6444:switch(Gw(t,Hw(t)-3-(~zw(t,"!important")&&10))){case 107:return jw(t,":",":"+Dw)+t;case 101:return jw(t,/(.+:)([^;!]+)(;|!.+)?/,"$1"+Dw+(45===Gw(t,14)?"inline-":"")+"box$3$1"+Dw+"$2$3$1"+Mw+"$2box$3")+t}break;case 5936:switch(Gw(t,e+11)){case 114:return Dw+t+Mw+jw(t,/[svh]\w+-[tblr]{2}/,"tb")+t;case 108:return Dw+t+Mw+jw(t,/[svh]\w+-[tblr]{2}/,"tb-rl")+t;case 45:return Dw+t+Mw+jw(t,/[svh]\w+-[tblr]{2}/,"lr")+t}return Dw+t+Mw+t+t}return t}var CE=[function(t,e,n,r){if(t.length>-1&&!t.return)switch(t.type){case Lw:t.return=AE(t.value,t.length);break;case Fw:return xE([eE(t,{value:jw(t.value,"@","@"+Dw)})],r);case Pw:if(t.length)return function(t,e){return t.map(e).join("")}(t.props,(function(e){switch(function(t,e){return(t=e.exec(t))?t[0]:t}(e,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return xE([eE(t,{props:[jw(e,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return xE([eE(t,{props:[jw(e,/:(plac\w+)/,":"+Dw+"input-$1")]}),eE(t,{props:[jw(e,/:(plac\w+)/,":-moz-$1")]}),eE(t,{props:[jw(e,/:(plac\w+)/,Mw+"input-$1")]})],r)}return""}))}}],RE=function(t){var e=t.key;if("css"===e){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(t){-1!==t.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(t),t.setAttribute("data-s",""))}))}var r,i,s=t.stylisPlugins||CE,o={},a=[];r=t.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+e+' "]'),(function(t){for(var e=t.getAttribute("data-emotion").split(" "),n=1;n<e.length;n++)o[e[n]]=!0;a.push(t)}));var l,c,h,u,d=[wE,(u=function(t){l.insert(t)},function(t){t.root||(t=t.return)&&u(t)})],f=(c=[TE,kE].concat(s,d),h=$w(c),function(t,e,n,r){for(var i="",s=0;s<h;s++)i+=c[s](t,e,n,r)||"";return i});i=function(t,e,n,r){l=n,xE(mE(t?t+"{"+e.styles+"}":e.styles),f),r&&(p.inserted[e.name]=!0)};var p={key:e,sheet:new Rw({key:e,container:r,nonce:t.nonce,speedy:t.speedy,prepend:t.prepend,insertionPoint:t.insertionPoint}),nonce:t.nonce,inserted:o,registered:{},insert:i};return p.sheet.hydrate(a),p},ME=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},IE=(t,e,n)=>(ME(t,e,"read from private field"),n?n.call(t):e.get(t)),DE=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)};var OE={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};function PE(t){var e=Object.create(null);return function(n){return void 0===e[n]&&(e[n]=t(n)),e[n]}}var LE=/[A-Z]|^ms/g,FE=/_EMO_([^_]+?)_([^]*?)_EMO_/g,NE=function(t){return 45===t.charCodeAt(1)},BE=function(t){return null!=t&&"boolean"!=typeof t},UE=PE((function(t){return NE(t)?t:t.replace(LE,"-$&").toLowerCase()})),VE=function(t,e){switch(t){case"animation":case"animationName":if("string"==typeof e)return e.replace(FE,(function(t,e,n){return zE={name:e,styles:n,next:zE},e}))}return 1===OE[t]||NE(t)||"number"!=typeof e||0===e?e:e+"px"};function jE(t,e,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return zE={name:n.name,styles:n.styles,next:zE},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)zE={name:r.name,styles:r.styles,next:zE},r=r.next;return n.styles+";"}return function(t,e,n){var r="";if(Array.isArray(n))for(var i=0;i<n.length;i++)r+=jE(t,e,n[i])+";";else for(var s in n){var o=n[s];if("object"!=typeof o)null!=e&&void 0!==e[o]?r+=s+"{"+e[o]+"}":BE(o)&&(r+=UE(s)+":"+VE(s,o)+";");else if(!Array.isArray(o)||"string"!=typeof o[0]||null!=e&&void 0!==e[o[0]]){var a=jE(t,e,o);switch(s){case"animation":case"animationName":r+=UE(s)+":"+a+";";break;default:r+=s+"{"+a+"}"}}else for(var l=0;l<o.length;l++)BE(o[l])&&(r+=UE(s)+":"+VE(s,o[l])+";")}return r}(t,e,n);case"function":if(void 0!==t){var i=zE,s=n(t);return zE=i,jE(t,e,s)}}if(null==e)return n;var o=e[n];return void 0!==o?o:n}var zE,GE=/label:\s*([^\s;\n{]+)\s*(;|$)/g,WE=function(t,e,n){if(1===t.length&&"object"==typeof t[0]&&null!==t[0]&&void 0!==t[0].styles)return t[0];var r=!0,i="";zE=void 0;var s=t[0];null==s||void 0===s.raw?(r=!1,i+=jE(n,e,s)):i+=s[0];for(var o=1;o<t.length;o++)i+=jE(n,e,t[o]),r&&(i+=s[o]);GE.lastIndex=0;for(var a,l="";null!==(a=GE.exec(i));)l+="-"+a[1];var c=function(t){for(var e,n=0,r=0,i=t.length;i>=4;++r,i-=4)e=1540483477*(65535&(e=255&t.charCodeAt(r)|(255&t.charCodeAt(++r))<<8|(255&t.charCodeAt(++r))<<16|(255&t.charCodeAt(++r))<<24))+(59797*(e>>>16)<<16),n=1540483477*(65535&(e^=e>>>24))+(59797*(e>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(i){case 3:n^=(255&t.charCodeAt(r+2))<<16;case 2:n^=(255&t.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&t.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)}(i)+l;return{name:c,styles:i,next:zE}};function HE(t,e,n){var r="";return n.split(" ").forEach((function(n){void 0!==t[n]?e.push(t[n]+";"):r+=n+" "})),r}function $E(t,e){if(void 0===t.inserted[e.name])return t.insert("",e,t.sheet,!0)}function YE(t,e,n){var r=[],i=HE(t,r,n);return r.length<2?n:i+e(r)}var XE=function t(e){for(var n="",r=0;r<e.length;r++){var i=e[r];if(null!=i){var s=void 0;switch(typeof i){case"boolean":break;case"object":if(Array.isArray(i))s=t(i);else for(var o in s="",i)i[o]&&o&&(s&&(s+=" "),s+=o);break;default:s=i}s&&(n&&(n+=" "),n+=s)}}return n};const qE=function(t){var e=RE(t);e.sheet.speedy=function(t){this.isSpeedy=t},e.compat=!0;var n=function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=WE(n,e.registered,void 0);return function(t,e,n){!function(t,e,n){var r=t.key+"-"+e.name;!1===n&&void 0===t.registered[r]&&(t.registered[r]=e.styles)}(t,e,n);var r=t.key+"-"+e.name;if(void 0===t.inserted[e.name]){var i=e;do{t.insert(e===i?"."+r:"",i,t.sheet,!0),i=i.next}while(void 0!==i)}}(e,i,!1),e.key+"-"+i.name};return{css:n,cx:function(){for(var t=arguments.length,r=new Array(t),i=0;i<t;i++)r[i]=arguments[i];return YE(e.registered,n,XE(r))},injectGlobal:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=WE(n,e.registered);$E(e,i)},keyframes:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=WE(n,e.registered),s="animation-"+i.name;return $E(e,{name:i.name,styles:"@keyframes "+s+"{"+i.styles+"}"}),s},hydrate:function(t){t.forEach((function(t){e.inserted[t]=!0}))},flush:function(){e.registered={},e.inserted={},e.sheet.flush()},sheet:e.sheet,cache:e,getRegisteredStyles:HE.bind(null,e.registered),merge:YE.bind(null,e.registered,n)}},KE=pw({key:"milkdown"},"EmotionConfig"),ZE=pw({},"Emotion"),JE=t=>pw((()=>null),t);var QE,t_,e_,n_;let r_=class{constructor(){DE(this,QE,fw()),DE(this,t_,new Map),DE(this,e_,new Set),DE(this,n_,(()=>{}))}inject(t){t(IE(this,QE).sliceMap)}has(t){const e="string"==typeof t?t:t.sliceName;return!!IE(this,t_).has(e)||null!=IE(this,QE).getSlice(t).get()(null)}set(t,e){const n="string"==typeof t?t:t.sliceName;IE(this,t_).set(n,e)}get(t,e){const n="string"==typeof t?t:t.sliceName,r=IE(this,t_).get(n);return r&&(IE(this,QE).getSlice(t).set(r),IE(this,t_).delete(t)),IE(this,QE).getSlice(t).get()(e)}getSlice(t){const e="string"==typeof t?t:t.sliceName,n=IE(this,t_).get(e);return n&&(IE(this,QE).getSlice(t).set(n),IE(this,t_).delete(t)),IE(this,QE).getSlice(t).get()}onFlush(t,e=!0){IE(this,e_).has(t)||IE(this,e_).add(t),e&&t()}async switch(t,e){t.get(ZE).flush(),await e(t)(t),this.runExecutor(),IE(this,e_).forEach((t=>t()))}flush(t){t.get(ZE).flush(),this.runExecutor(),IE(this,e_).forEach((t=>t()))}setExecutor(t){t(),((t,e,n,r)=>{ME(t,e,"write to private field"),r?r.call(t,n):e.set(t,n)})(this,n_,t)}runExecutor(){IE(this,n_).call(this)}};QE=new WeakMap,t_=new WeakMap,e_=new WeakMap,n_=new WeakMap;const i_=pw(new r_,"themeManager"),s_=JE("border"),o_=JE("color"),a_=JE("font"),l_=JE("global"),c_=JE("icon"),h_=JE("code-fence"),u_=JE("image"),d_=JE("inner-editor"),f_=JE("input-chip"),p_=JE("task-list-item"),m_=JE("scrollbar"),g_=JE("shadow"),v_=JE("size"),y_=[o_,v_,a_,m_,g_,s_,c_,l_,h_,u_,d_,p_,f_],b_=t=>{const e=t.slice(1).replace(/^([a-f\d])([a-f\d])([a-f\d])$/i,((t,e,n,r)=>e+e+n+n+r+r)),[n,r="0",i="0",s="0"]=e.match(/^([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i)||[];return n?[r,i,s].map((t=>parseInt(t,16))):null},x_=t=>(e,n=1)=>t.get(o_,[e,n]);function w_(t){this.content=t}function E_(t,e,n){for(let r=0;;r++){if(r==t.childCount||r==e.childCount)return t.childCount==e.childCount?null:n;let i=t.child(r),s=e.child(r);if(i!=s){if(!i.sameMarkup(s))return n;if(i.isText&&i.text!=s.text){for(let t=0;i.text[t]==s.text[t];t++)n++;return n}if(i.content.size||s.content.size){let t=E_(i.content,s.content,n+1);if(null!=t)return t}n+=i.nodeSize}else n+=i.nodeSize}}function __(t,e,n,r){for(let i=t.childCount,s=e.childCount;;){if(0==i||0==s)return i==s?null:{a:n,b:r};let o=t.child(--i),a=e.child(--s),l=o.nodeSize;if(o!=a){if(!o.sameMarkup(a))return{a:n,b:r};if(o.isText&&o.text!=a.text){let t=0,e=Math.min(o.text.length,a.text.length);for(;t<e&&o.text[o.text.length-t-1]==a.text[a.text.length-t-1];)t++,n--,r--;return{a:n,b:r}}if(o.content.size||a.content.size){let t=__(o.content,a.content,n-1,r-1);if(t)return t}n-=l,r-=l}else n-=l,r-=l}}w_.prototype={constructor:w_,find:function(t){for(var e=0;e<this.content.length;e+=2)if(this.content[e]===t)return e;return-1},get:function(t){var e=this.find(t);return-1==e?void 0:this.content[e+1]},update:function(t,e,n){var r=n&&n!=t?this.remove(n):this,i=r.find(t),s=r.content.slice();return-1==i?s.push(n||t,e):(s[i+1]=e,n&&(s[i]=n)),new w_(s)},remove:function(t){var e=this.find(t);if(-1==e)return this;var n=this.content.slice();return n.splice(e,2),new w_(n)},addToStart:function(t,e){return new w_([t,e].concat(this.remove(t).content))},addToEnd:function(t,e){var n=this.remove(t).content.slice();return n.push(t,e),new w_(n)},addBefore:function(t,e,n){var r=this.remove(e),i=r.content.slice(),s=r.find(t);return i.splice(-1==s?i.length:s,0,e,n),new w_(i)},forEach:function(t){for(var e=0;e<this.content.length;e+=2)t(this.content[e],this.content[e+1])},prepend:function(t){return(t=w_.from(t)).size?new w_(t.content.concat(this.subtract(t).content)):this},append:function(t){return(t=w_.from(t)).size?new w_(this.subtract(t).content.concat(t.content)):this},subtract:function(t){var e=this;t=w_.from(t);for(var n=0;n<t.content.length;n+=2)e=e.remove(t.content[n]);return e},toObject:function(){var t={};return this.forEach((function(e,n){t[e]=n})),t},get size(){return this.content.length>>1}},w_.from=function(t){if(t instanceof w_)return t;var e=[];if(t)for(var n in t)e.push(n,t[n]);return new w_(e)};class S_{constructor(t,e){if(this.content=t,this.size=e||0,null==e)for(let n=0;n<t.length;n++)this.size+=t[n].nodeSize}nodesBetween(t,e,n,r=0,i){for(let s=0,o=0;o<e;s++){let a=this.content[s],l=o+a.nodeSize;if(l>t&&!1!==n(a,r+o,i||null,s)&&a.content.size){let i=o+1;a.nodesBetween(Math.max(0,t-i),Math.min(a.content.size,e-i),n,r+i)}o=l}}descendants(t){this.nodesBetween(0,this.size,t)}textBetween(t,e,n,r){let i="",s=!0;return this.nodesBetween(t,e,((o,a)=>{o.isText?(i+=o.text.slice(Math.max(t,a)-a,e-a),s=!n):o.isLeaf?(r?i+="function"==typeof r?r(o):r:o.type.spec.leafText&&(i+=o.type.spec.leafText(o)),s=!n):!s&&o.isBlock&&(i+=n,s=!0)}),0),i}append(t){if(!t.size)return this;if(!this.size)return t;let e=this.lastChild,n=t.firstChild,r=this.content.slice(),i=0;for(e.isText&&e.sameMarkup(n)&&(r[r.length-1]=e.withText(e.text+n.text),i=1);i<t.content.length;i++)r.push(t.content[i]);return new S_(r,this.size+t.size)}cut(t,e=this.size){if(0==t&&e==this.size)return this;let n=[],r=0;if(e>t)for(let i=0,s=0;s<e;i++){let o=this.content[i],a=s+o.nodeSize;a>t&&((s<t||a>e)&&(o=o.isText?o.cut(Math.max(0,t-s),Math.min(o.text.length,e-s)):o.cut(Math.max(0,t-s-1),Math.min(o.content.size,e-s-1))),n.push(o),r+=o.nodeSize),s=a}return new S_(n,r)}cutByIndex(t,e){return t==e?S_.empty:0==t&&e==this.content.length?this:new S_(this.content.slice(t,e))}replaceChild(t,e){let n=this.content[t];if(n==e)return this;let r=this.content.slice(),i=this.size+e.nodeSize-n.nodeSize;return r[t]=e,new S_(r,i)}addToStart(t){return new S_([t].concat(this.content),this.size+t.nodeSize)}addToEnd(t){return new S_(this.content.concat(t),this.size+t.nodeSize)}eq(t){if(this.content.length!=t.content.length)return!1;for(let e=0;e<this.content.length;e++)if(!this.content[e].eq(t.content[e]))return!1;return!0}get firstChild(){return this.content.length?this.content[0]:null}get lastChild(){return this.content.length?this.content[this.content.length-1]:null}get childCount(){return this.content.length}child(t){let e=this.content[t];if(!e)throw new RangeError("Index "+t+" out of range for "+this);return e}maybeChild(t){return this.content[t]||null}forEach(t){for(let e=0,n=0;e<this.content.length;e++){let r=this.content[e];t(r,n,e),n+=r.nodeSize}}findDiffStart(t,e=0){return E_(this,t,e)}findDiffEnd(t,e=this.size,n=t.size){return __(this,t,e,n)}findIndex(t,e=-1){if(0==t)return k_(0,t);if(t==this.size)return k_(this.content.length,t);if(t>this.size||t<0)throw new RangeError(`Position ${t} outside of fragment (${this})`);for(let n=0,r=0;;n++){let i=r+this.child(n).nodeSize;if(i>=t)return i==t||e>0?k_(n+1,i):k_(n,r);r=i}}toString(){return"<"+this.toStringInner()+">"}toStringInner(){return this.content.join(", ")}toJSON(){return this.content.length?this.content.map((t=>t.toJSON())):null}static fromJSON(t,e){if(!e)return S_.empty;if(!Array.isArray(e))throw new RangeError("Invalid input for Fragment.fromJSON");return new S_(e.map(t.nodeFromJSON))}static fromArray(t){if(!t.length)return S_.empty;let e,n=0;for(let r=0;r<t.length;r++){let i=t[r];n+=i.nodeSize,r&&i.isText&&t[r-1].sameMarkup(i)?(e||(e=t.slice(0,r)),e[e.length-1]=i.withText(e[e.length-1].text+i.text)):e&&e.push(i)}return new S_(e||t,n)}static from(t){if(!t)return S_.empty;if(t instanceof S_)return t;if(Array.isArray(t))return this.fromArray(t);if(t.attrs)return new S_([t],t.nodeSize);throw new RangeError("Can not convert "+t+" to a Fragment"+(t.nodesBetween?" (looks like multiple versions of prosemirror-model were loaded)":""))}}S_.empty=new S_([],0);const T_={index:0,offset:0};function k_(t,e){return T_.index=t,T_.offset=e,T_}function A_(t,e){if(t===e)return!0;if(!t||"object"!=typeof t||!e||"object"!=typeof e)return!1;let n=Array.isArray(t);if(Array.isArray(e)!=n)return!1;if(n){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!A_(t[n],e[n]))return!1}else{for(let n in t)if(!(n in e)||!A_(t[n],e[n]))return!1;for(let n in e)if(!(n in t))return!1}return!0}class C_{constructor(t,e){this.type=t,this.attrs=e}addToSet(t){let e,n=!1;for(let r=0;r<t.length;r++){let i=t[r];if(this.eq(i))return t;if(this.type.excludes(i.type))e||(e=t.slice(0,r));else{if(i.type.excludes(this.type))return t;!n&&i.type.rank>this.type.rank&&(e||(e=t.slice(0,r)),e.push(this),n=!0),e&&e.push(i)}}return e||(e=t.slice()),n||e.push(this),e}removeFromSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return t.slice(0,e).concat(t.slice(e+1));return t}isInSet(t){for(let e=0;e<t.length;e++)if(this.eq(t[e]))return!0;return!1}eq(t){return this==t||this.type==t.type&&A_(this.attrs,t.attrs)}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Mark.fromJSON");let n=t.marks[e.type];if(!n)throw new RangeError(`There is no mark type ${e.type} in this schema`);return n.create(e.attrs)}static sameSet(t,e){if(t==e)return!0;if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].eq(e[n]))return!1;return!0}static setFrom(t){if(!t||Array.isArray(t)&&0==t.length)return C_.none;if(t instanceof C_)return[t];let e=t.slice();return e.sort(((t,e)=>t.type.rank-e.type.rank)),e}}C_.none=[];class R_ extends Error{}class M_{constructor(t,e,n){this.content=t,this.openStart=e,this.openEnd=n}get size(){return this.content.size-this.openStart-this.openEnd}insertAt(t,e){let n=D_(this.content,t+this.openStart,e);return n&&new M_(n,this.openStart,this.openEnd)}removeBetween(t,e){return new M_(I_(this.content,t+this.openStart,e+this.openStart),this.openStart,this.openEnd)}eq(t){return this.content.eq(t.content)&&this.openStart==t.openStart&&this.openEnd==t.openEnd}toString(){return this.content+"("+this.openStart+","+this.openEnd+")"}toJSON(){if(!this.content.size)return null;let t={content:this.content.toJSON()};return this.openStart>0&&(t.openStart=this.openStart),this.openEnd>0&&(t.openEnd=this.openEnd),t}static fromJSON(t,e){if(!e)return M_.empty;let n=e.openStart||0,r=e.openEnd||0;if("number"!=typeof n||"number"!=typeof r)throw new RangeError("Invalid input for Slice.fromJSON");return new M_(S_.fromJSON(t,e.content),n,r)}static maxOpen(t,e=!0){let n=0,r=0;for(let i=t.firstChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.firstChild)n++;for(let i=t.lastChild;i&&!i.isLeaf&&(e||!i.type.spec.isolating);i=i.lastChild)r++;return new M_(t,n,r)}}function I_(t,e,n){let{index:r,offset:i}=t.findIndex(e),s=t.maybeChild(r),{index:o,offset:a}=t.findIndex(n);if(i==e||s.isText){if(a!=n&&!t.child(o).isText)throw new RangeError("Removing non-flat range");return t.cut(0,e).append(t.cut(n))}if(r!=o)throw new RangeError("Removing non-flat range");return t.replaceChild(r,s.copy(I_(s.content,e-i-1,n-i-1)))}function D_(t,e,n,r){let{index:i,offset:s}=t.findIndex(e),o=t.maybeChild(i);if(s==e||o.isText)return r&&!r.canReplace(i,i,n)?null:t.cut(0,e).append(n).append(t.cut(e));let a=D_(o.content,e-s-1,n);return a&&t.replaceChild(i,o.copy(a))}function O_(t,e,n){if(n.openStart>t.depth)throw new R_("Inserted content deeper than insertion position");if(t.depth-n.openStart!=e.depth-n.openEnd)throw new R_("Inconsistent open depths");return P_(t,e,n,0)}function P_(t,e,n,r){let i=t.index(r),s=t.node(r);if(i==e.index(r)&&r<t.depth-n.openStart){let o=P_(t,e,n,r+1);return s.copy(s.content.replaceChild(i,o))}if(n.content.size){if(n.openStart||n.openEnd||t.depth!=r||e.depth!=r){let{start:i,end:o}=function(t,e){let n=e.depth-t.openStart,r=e.node(n).copy(t.content);for(let i=n-1;i>=0;i--)r=e.node(i).copy(S_.from(r));return{start:r.resolveNoCache(t.openStart+n),end:r.resolveNoCache(r.content.size-t.openEnd-n)}}(n,t);return U_(s,V_(t,i,o,e,r))}{let r=t.parent,i=r.content;return U_(r,i.cut(0,t.parentOffset).append(n.content).append(i.cut(e.parentOffset)))}}return U_(s,j_(t,e,r))}function L_(t,e){if(!e.type.compatibleContent(t.type))throw new R_("Cannot join "+e.type.name+" onto "+t.type.name)}function F_(t,e,n){let r=t.node(n);return L_(r,e.node(n)),r}function N_(t,e){let n=e.length-1;n>=0&&t.isText&&t.sameMarkup(e[n])?e[n]=t.withText(e[n].text+t.text):e.push(t)}function B_(t,e,n,r){let i=(e||t).node(n),s=0,o=e?e.index(n):i.childCount;t&&(s=t.index(n),t.depth>n?s++:t.textOffset&&(N_(t.nodeAfter,r),s++));for(let a=s;a<o;a++)N_(i.child(a),r);e&&e.depth==n&&e.textOffset&&N_(e.nodeBefore,r)}function U_(t,e){return t.type.checkContent(e),t.copy(e)}function V_(t,e,n,r,i){let s=t.depth>i&&F_(t,e,i+1),o=r.depth>i&&F_(n,r,i+1),a=[];return B_(null,t,i,a),s&&o&&e.index(i)==n.index(i)?(L_(s,o),N_(U_(s,V_(t,e,n,r,i+1)),a)):(s&&N_(U_(s,j_(t,e,i+1)),a),B_(e,n,i,a),o&&N_(U_(o,j_(n,r,i+1)),a)),B_(r,null,i,a),new S_(a)}function j_(t,e,n){let r=[];if(B_(null,t,n,r),t.depth>n){N_(U_(F_(t,e,n+1),j_(t,e,n+1)),r)}return B_(e,null,n,r),new S_(r)}M_.empty=new M_(S_.empty,0,0);class z_{constructor(t,e,n){this.pos=t,this.path=e,this.parentOffset=n,this.depth=e.length/3-1}resolveDepth(t){return null==t?this.depth:t<0?this.depth+t:t}get parent(){return this.node(this.depth)}get doc(){return this.node(0)}node(t){return this.path[3*this.resolveDepth(t)]}index(t){return this.path[3*this.resolveDepth(t)+1]}indexAfter(t){return t=this.resolveDepth(t),this.index(t)+(t!=this.depth||this.textOffset?1:0)}start(t){return 0==(t=this.resolveDepth(t))?0:this.path[3*t-1]+1}end(t){return t=this.resolveDepth(t),this.start(t)+this.node(t).content.size}before(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position before the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]}after(t){if(!(t=this.resolveDepth(t)))throw new RangeError("There is no position after the top-level node");return t==this.depth+1?this.pos:this.path[3*t-1]+this.path[3*t].nodeSize}get textOffset(){return this.pos-this.path[this.path.length-1]}get nodeAfter(){let t=this.parent,e=this.index(this.depth);if(e==t.childCount)return null;let n=this.pos-this.path[this.path.length-1],r=t.child(e);return n?t.child(e).cut(n):r}get nodeBefore(){let t=this.index(this.depth),e=this.pos-this.path[this.path.length-1];return e?this.parent.child(t).cut(0,e):0==t?null:this.parent.child(t-1)}posAtIndex(t,e){e=this.resolveDepth(e);let n=this.path[3*e],r=0==e?0:this.path[3*e-1]+1;for(let i=0;i<t;i++)r+=n.child(i).nodeSize;return r}marks(){let t=this.parent,e=this.index();if(0==t.content.size)return C_.none;if(this.textOffset)return t.child(e).marks;let n=t.maybeChild(e-1),r=t.maybeChild(e);if(!n){let t=n;n=r,r=t}let i=n.marks;for(var s=0;s<i.length;s++)!1!==i[s].type.spec.inclusive||r&&i[s].isInSet(r.marks)||(i=i[s--].removeFromSet(i));return i}marksAcross(t){let e=this.parent.maybeChild(this.index());if(!e||!e.isInline)return null;let n=e.marks,r=t.parent.maybeChild(t.index());for(var i=0;i<n.length;i++)!1!==n[i].type.spec.inclusive||r&&n[i].isInSet(r.marks)||(n=n[i--].removeFromSet(n));return n}sharedDepth(t){for(let e=this.depth;e>0;e--)if(this.start(e)<=t&&this.end(e)>=t)return e;return 0}blockRange(t=this,e){if(t.pos<this.pos)return t.blockRange(this);for(let n=this.depth-(this.parent.inlineContent||this.pos==t.pos?1:0);n>=0;n--)if(t.pos<=this.end(n)&&(!e||e(this.node(n))))return new $_(this,t,n);return null}sameParent(t){return this.pos-this.parentOffset==t.pos-t.parentOffset}max(t){return t.pos>this.pos?t:this}min(t){return t.pos<this.pos?t:this}toString(){let t="";for(let e=1;e<=this.depth;e++)t+=(t?"/":"")+this.node(e).type.name+"_"+this.index(e-1);return t+":"+this.parentOffset}static resolve(t,e){if(!(e>=0&&e<=t.content.size))throw new RangeError("Position "+e+" out of range");let n=[],r=0,i=e;for(let s=t;;){let{index:t,offset:e}=s.content.findIndex(i),o=i-e;if(n.push(s,t,r+e),!o)break;if(s=s.child(t),s.isText)break;i=o-1,r+=e+1}return new z_(e,n,i)}static resolveCached(t,e){for(let r=0;r<G_.length;r++){let n=G_[r];if(n.pos==e&&n.doc==t)return n}let n=G_[W_]=z_.resolve(t,e);return W_=(W_+1)%H_,n}}let G_=[],W_=0,H_=12;class $_{constructor(t,e,n){this.$from=t,this.$to=e,this.depth=n}get start(){return this.$from.before(this.depth+1)}get end(){return this.$to.after(this.depth+1)}get parent(){return this.$from.node(this.depth)}get startIndex(){return this.$from.index(this.depth)}get endIndex(){return this.$to.indexAfter(this.depth)}}const Y_=Object.create(null);let X_=class t{constructor(t,e,n,r=C_.none){this.type=t,this.attrs=e,this.marks=r,this.content=n||S_.empty}get nodeSize(){return this.isLeaf?1:2+this.content.size}get childCount(){return this.content.childCount}child(t){return this.content.child(t)}maybeChild(t){return this.content.maybeChild(t)}forEach(t){this.content.forEach(t)}nodesBetween(t,e,n,r=0){this.content.nodesBetween(t,e,n,r,this)}descendants(t){this.nodesBetween(0,this.content.size,t)}get textContent(){return this.isLeaf&&this.type.spec.leafText?this.type.spec.leafText(this):this.textBetween(0,this.content.size,"")}textBetween(t,e,n,r){return this.content.textBetween(t,e,n,r)}get firstChild(){return this.content.firstChild}get lastChild(){return this.content.lastChild}eq(t){return this==t||this.sameMarkup(t)&&this.content.eq(t.content)}sameMarkup(t){return this.hasMarkup(t.type,t.attrs,t.marks)}hasMarkup(t,e,n){return this.type==t&&A_(this.attrs,e||t.defaultAttrs||Y_)&&C_.sameSet(this.marks,n||C_.none)}copy(e=null){return e==this.content?this:new t(this.type,this.attrs,e,this.marks)}mark(e){return e==this.marks?this:new t(this.type,this.attrs,this.content,e)}cut(t,e=this.content.size){return 0==t&&e==this.content.size?this:this.copy(this.content.cut(t,e))}slice(t,e=this.content.size,n=!1){if(t==e)return M_.empty;let r=this.resolve(t),i=this.resolve(e),s=n?0:r.sharedDepth(e),o=r.start(s),a=r.node(s).content.cut(r.pos-o,i.pos-o);return new M_(a,r.depth-s,i.depth-s)}replace(t,e,n){return O_(this.resolve(t),this.resolve(e),n)}nodeAt(t){for(let e=this;;){let{index:n,offset:r}=e.content.findIndex(t);if(e=e.maybeChild(n),!e)return null;if(r==t||e.isText)return e;t-=r+1}}childAfter(t){let{index:e,offset:n}=this.content.findIndex(t);return{node:this.content.maybeChild(e),index:e,offset:n}}childBefore(t){if(0==t)return{node:null,index:0,offset:0};let{index:e,offset:n}=this.content.findIndex(t);if(n<t)return{node:this.content.child(e),index:e,offset:n};let r=this.content.child(e-1);return{node:r,index:e-1,offset:n-r.nodeSize}}resolve(t){return z_.resolveCached(this,t)}resolveNoCache(t){return z_.resolve(this,t)}rangeHasMark(t,e,n){let r=!1;return e>t&&this.nodesBetween(t,e,(t=>(n.isInSet(t.marks)&&(r=!0),!r))),r}get isBlock(){return this.type.isBlock}get isTextblock(){return this.type.isTextblock}get inlineContent(){return this.type.inlineContent}get isInline(){return this.type.isInline}get isText(){return this.type.isText}get isLeaf(){return this.type.isLeaf}get isAtom(){return this.type.isAtom}toString(){if(this.type.spec.toDebugString)return this.type.spec.toDebugString(this);let t=this.type.name;return this.content.size&&(t+="("+this.content.toStringInner()+")"),K_(this.marks,t)}contentMatchAt(t){let e=this.type.contentMatch.matchFragment(this.content,0,t);if(!e)throw new Error("Called contentMatchAt on a node with invalid content");return e}canReplace(t,e,n=S_.empty,r=0,i=n.childCount){let s=this.contentMatchAt(t).matchFragment(n,r,i),o=s&&s.matchFragment(this.content,e);if(!o||!o.validEnd)return!1;for(let a=r;a<i;a++)if(!this.type.allowsMarks(n.child(a).marks))return!1;return!0}canReplaceWith(t,e,n,r){if(r&&!this.type.allowsMarks(r))return!1;let i=this.contentMatchAt(t).matchType(n),s=i&&i.matchFragment(this.content,e);return!!s&&s.validEnd}canAppend(t){return t.content.size?this.canReplace(this.childCount,this.childCount,t.content):this.type.compatibleContent(t.type)}check(){this.type.checkContent(this.content);let t=C_.none;for(let e=0;e<this.marks.length;e++)t=this.marks[e].addToSet(t);if(!C_.sameSet(t,this.marks))throw new RangeError(`Invalid collection of marks for node ${this.type.name}: ${this.marks.map((t=>t.type.name))}`);this.content.forEach((t=>t.check()))}toJSON(){let t={type:this.type.name};for(let e in this.attrs){t.attrs=this.attrs;break}return this.content.size&&(t.content=this.content.toJSON()),this.marks.length&&(t.marks=this.marks.map((t=>t.toJSON()))),t}static fromJSON(t,e){if(!e)throw new RangeError("Invalid input for Node.fromJSON");let n=null;if(e.marks){if(!Array.isArray(e.marks))throw new RangeError("Invalid mark data for Node.fromJSON");n=e.marks.map(t.markFromJSON)}if("text"==e.type){if("string"!=typeof e.text)throw new RangeError("Invalid text node in JSON");return t.text(e.text,n)}let r=S_.fromJSON(t,e.content);return t.nodeType(e.type).create(e.attrs,r,n)}};X_.prototype.text=void 0;class q_ extends X_{constructor(t,e,n,r){if(super(t,e,null,r),!n)throw new RangeError("Empty text nodes are not allowed");this.text=n}toString(){return this.type.spec.toDebugString?this.type.spec.toDebugString(this):K_(this.marks,JSON.stringify(this.text))}get textContent(){return this.text}textBetween(t,e){return this.text.slice(t,e)}get nodeSize(){return this.text.length}mark(t){return t==this.marks?this:new q_(this.type,this.attrs,this.text,t)}withText(t){return t==this.text?this:new q_(this.type,this.attrs,t,this.marks)}cut(t=0,e=this.text.length){return 0==t&&e==this.text.length?this:this.withText(this.text.slice(t,e))}eq(t){return this.sameMarkup(t)&&this.text==t.text}toJSON(){let t=super.toJSON();return t.text=this.text,t}}function K_(t,e){for(let n=t.length-1;n>=0;n--)e=t[n].type.name+"("+e+")";return e}class Z_{constructor(t){this.validEnd=t,this.next=[],this.wrapCache=[]}static parse(t,e){let n=new J_(t,e);if(null==n.next)return Z_.empty;let r=Q_(n);n.next&&n.err("Unexpected trailing text");let i=function(t){let e=Object.create(null);return n(sS(t,0));function n(r){let i=[];r.forEach((e=>{t[e].forEach((({term:e,to:n})=>{if(!e)return;let r;for(let t=0;t<i.length;t++)i[t][0]==e&&(r=i[t][1]);sS(t,n).forEach((t=>{r||i.push([e,r=[]]),-1==r.indexOf(t)&&r.push(t)}))}))}));let s=e[r.join(",")]=new Z_(r.indexOf(t.length-1)>-1);for(let t=0;t<i.length;t++){let r=i[t][1].sort(iS);s.next.push({type:i[t][0],next:e[r.join(",")]||n(r)})}return s}}(function(t){let e=[[]];return i(s(t,0),n()),e;function n(){return e.push([])-1}function r(t,n,r){let i={term:r,to:n};return e[t].push(i),i}function i(t,e){t.forEach((t=>t.to=e))}function s(t,e){if("choice"==t.type)return t.exprs.reduce(((t,n)=>t.concat(s(n,e))),[]);if("seq"!=t.type){if("star"==t.type){let o=n();return r(e,o),i(s(t.expr,o),o),[r(o)]}if("plus"==t.type){let o=n();return i(s(t.expr,e),o),i(s(t.expr,o),o),[r(o)]}if("opt"==t.type)return[r(e)].concat(s(t.expr,e));if("range"==t.type){let o=e;for(let e=0;e<t.min;e++){let e=n();i(s(t.expr,o),e),o=e}if(-1==t.max)i(s(t.expr,o),o);else for(let e=t.min;e<t.max;e++){let e=n();r(o,e),i(s(t.expr,o),e),o=e}return[r(o)]}if("name"==t.type)return[r(e,void 0,t.value)];throw new Error("Unknown expr type")}for(let r=0;;r++){let o=s(t.exprs[r],e);if(r==t.exprs.length-1)return o;i(o,e=n())}}}(r));return function(t,e){for(let n=0,r=[t];n<r.length;n++){let t=r[n],i=!t.validEnd,s=[];for(let e=0;e<t.next.length;e++){let{type:n,next:o}=t.next[e];s.push(n.name),!i||n.isText||n.hasRequiredAttrs()||(i=!1),-1==r.indexOf(o)&&r.push(o)}i&&e.err("Only non-generatable nodes ("+s.join(", ")+") in a required position (see https://prosemirror.net/docs/guide/#generatable)")}}(i,n),i}matchType(t){for(let e=0;e<this.next.length;e++)if(this.next[e].type==t)return this.next[e].next;return null}matchFragment(t,e=0,n=t.childCount){let r=this;for(let i=e;r&&i<n;i++)r=r.matchType(t.child(i).type);return r}get inlineContent(){return 0!=this.next.length&&this.next[0].type.isInline}get defaultType(){for(let t=0;t<this.next.length;t++){let{type:e}=this.next[t];if(!e.isText&&!e.hasRequiredAttrs())return e}return null}compatible(t){for(let e=0;e<this.next.length;e++)for(let n=0;n<t.next.length;n++)if(this.next[e].type==t.next[n].type)return!0;return!1}fillBefore(t,e=!1,n=0){let r=[this];return function i(s,o){let a=s.matchFragment(t,n);if(a&&(!e||a.validEnd))return S_.from(o.map((t=>t.createAndFill())));for(let t=0;t<s.next.length;t++){let{type:e,next:n}=s.next[t];if(!e.isText&&!e.hasRequiredAttrs()&&-1==r.indexOf(n)){r.push(n);let t=i(n,o.concat(e));if(t)return t}}return null}(this,[])}findWrapping(t){for(let n=0;n<this.wrapCache.length;n+=2)if(this.wrapCache[n]==t)return this.wrapCache[n+1];let e=this.computeWrapping(t);return this.wrapCache.push(t,e),e}computeWrapping(t){let e=Object.create(null),n=[{match:this,type:null,via:null}];for(;n.length;){let r=n.shift(),i=r.match;if(i.matchType(t)){let t=[];for(let e=r;e.type;e=e.via)t.push(e.type);return t.reverse()}for(let t=0;t<i.next.length;t++){let{type:s,next:o}=i.next[t];s.isLeaf||s.hasRequiredAttrs()||s.name in e||r.type&&!o.validEnd||(n.push({match:s.contentMatch,type:s,via:r}),e[s.name]=!0)}}return null}get edgeCount(){return this.next.length}edge(t){if(t>=this.next.length)throw new RangeError(`There's no ${t}th edge in this content match`);return this.next[t]}toString(){let t=[];return function e(n){t.push(n);for(let r=0;r<n.next.length;r++)-1==t.indexOf(n.next[r].next)&&e(n.next[r].next)}(this),t.map(((e,n)=>{let r=n+(e.validEnd?"*":" ")+" ";for(let i=0;i<e.next.length;i++)r+=(i?", ":"")+e.next[i].type.name+"->"+t.indexOf(e.next[i].next);return r})).join("\n")}}Z_.empty=new Z_(!0);class J_{constructor(t,e){this.string=t,this.nodeTypes=e,this.inline=null,this.pos=0,this.tokens=t.split(/\s*(?=\b|\W|$)/),""==this.tokens[this.tokens.length-1]&&this.tokens.pop(),""==this.tokens[0]&&this.tokens.shift()}get next(){return this.tokens[this.pos]}eat(t){return this.next==t&&(this.pos++||!0)}err(t){throw new SyntaxError(t+" (in content expression '"+this.string+"')")}}function Q_(t){let e=[];do{e.push(tS(t))}while(t.eat("|"));return 1==e.length?e[0]:{type:"choice",exprs:e}}function tS(t){let e=[];do{e.push(eS(t))}while(t.next&&")"!=t.next&&"|"!=t.next);return 1==e.length?e[0]:{type:"seq",exprs:e}}function eS(t){let e=function(t){if(t.eat("(")){let e=Q_(t);return t.eat(")")||t.err("Missing closing paren"),e}if(!/\W/.test(t.next)){let e=function(t,e){let n=t.nodeTypes,r=n[e];if(r)return[r];let i=[];for(let s in n){let t=n[s];t.groups.indexOf(e)>-1&&i.push(t)}0==i.length&&t.err("No node type or group '"+e+"' found");return i}(t,t.next).map((e=>(null==t.inline?t.inline=e.isInline:t.inline!=e.isInline&&t.err("Mixing inline and block content"),{type:"name",value:e})));return t.pos++,1==e.length?e[0]:{type:"choice",exprs:e}}t.err("Unexpected token '"+t.next+"'")}(t);for(;;)if(t.eat("+"))e={type:"plus",expr:e};else if(t.eat("*"))e={type:"star",expr:e};else if(t.eat("?"))e={type:"opt",expr:e};else{if(!t.eat("{"))break;e=rS(t,e)}return e}function nS(t){/\D/.test(t.next)&&t.err("Expected number, got '"+t.next+"'");let e=Number(t.next);return t.pos++,e}function rS(t,e){let n=nS(t),r=n;return t.eat(",")&&(r="}"!=t.next?nS(t):-1),t.eat("}")||t.err("Unclosed braced range"),{type:"range",min:n,max:r,expr:e}}function iS(t,e){return e-t}function sS(t,e){let n=[];return function e(r){let i=t[r];if(1==i.length&&!i[0].term)return e(i[0].to);n.push(r);for(let t=0;t<i.length;t++){let{term:r,to:s}=i[t];r||-1!=n.indexOf(s)||e(s)}}(e),n.sort(iS)}function oS(t){let e=Object.create(null);for(let n in t){let r=t[n];if(!r.hasDefault)return null;e[n]=r.default}return e}function aS(t,e){let n=Object.create(null);for(let r in t){let i=e&&e[r];if(void 0===i){let e=t[r];if(!e.hasDefault)throw new RangeError("No value supplied for attribute "+r);i=e.default}n[r]=i}return n}function lS(t){let e=Object.create(null);if(t)for(let n in t)e[n]=new hS(t[n]);return e}let cS=class t{constructor(t,e,n){this.name=t,this.schema=e,this.spec=n,this.markSet=null,this.groups=n.group?n.group.split(" "):[],this.attrs=lS(n.attrs),this.defaultAttrs=oS(this.attrs),this.contentMatch=null,this.inlineContent=null,this.isBlock=!(n.inline||"text"==t),this.isText="text"==t}get isInline(){return!this.isBlock}get isTextblock(){return this.isBlock&&this.inlineContent}get isLeaf(){return this.contentMatch==Z_.empty}get isAtom(){return this.isLeaf||!!this.spec.atom}get whitespace(){return this.spec.whitespace||(this.spec.code?"pre":"normal")}hasRequiredAttrs(){for(let t in this.attrs)if(this.attrs[t].isRequired)return!0;return!1}compatibleContent(t){return this==t||this.contentMatch.compatible(t.contentMatch)}computeAttrs(t){return!t&&this.defaultAttrs?this.defaultAttrs:aS(this.attrs,t)}create(t=null,e,n){if(this.isText)throw new Error("NodeType.create can't construct text nodes");return new X_(this,this.computeAttrs(t),S_.from(e),C_.setFrom(n))}createChecked(t=null,e,n){return e=S_.from(e),this.checkContent(e),new X_(this,this.computeAttrs(t),e,C_.setFrom(n))}createAndFill(t=null,e,n){if(t=this.computeAttrs(t),(e=S_.from(e)).size){let t=this.contentMatch.fillBefore(e);if(!t)return null;e=t.append(e)}let r=this.contentMatch.matchFragment(e),i=r&&r.fillBefore(S_.empty,!0);return i?new X_(this,t,e.append(i),C_.setFrom(n)):null}validContent(t){let e=this.contentMatch.matchFragment(t);if(!e||!e.validEnd)return!1;for(let n=0;n<t.childCount;n++)if(!this.allowsMarks(t.child(n).marks))return!1;return!0}checkContent(t){if(!this.validContent(t))throw new RangeError(`Invalid content for node ${this.name}: ${t.toString().slice(0,50)}`)}allowsMarkType(t){return null==this.markSet||this.markSet.indexOf(t)>-1}allowsMarks(t){if(null==this.markSet)return!0;for(let e=0;e<t.length;e++)if(!this.allowsMarkType(t[e].type))return!1;return!0}allowedMarks(t){if(null==this.markSet)return t;let e;for(let n=0;n<t.length;n++)this.allowsMarkType(t[n].type)?e&&e.push(t[n]):e||(e=t.slice(0,n));return e?e.length?e:C_.none:t}static compile(e,n){let r=Object.create(null);e.forEach(((e,i)=>r[e]=new t(e,n,i)));let i=n.spec.topNode||"doc";if(!r[i])throw new RangeError("Schema is missing its top node type ('"+i+"')");if(!r.text)throw new RangeError("Every schema needs a 'text' type");for(let t in r.text.attrs)throw new RangeError("The text node type should not have attributes");return r}},hS=class{constructor(t){this.hasDefault=Object.prototype.hasOwnProperty.call(t,"default"),this.default=t.default}get isRequired(){return!this.hasDefault}};class uS{constructor(t,e,n,r){this.name=t,this.rank=e,this.schema=n,this.spec=r,this.attrs=lS(r.attrs),this.excluded=null;let i=oS(this.attrs);this.instance=i?new C_(this,i):null}create(t=null){return!t&&this.instance?this.instance:new C_(this,aS(this.attrs,t))}static compile(t,e){let n=Object.create(null),r=0;return t.forEach(((t,i)=>n[t]=new uS(t,r++,e,i))),n}removeFromSet(t){for(var e=0;e<t.length;e++)t[e].type==this&&(t=t.slice(0,e).concat(t.slice(e+1)),e--);return t}isInSet(t){for(let e=0;e<t.length;e++)if(t[e].type==this)return t[e]}excludes(t){return this.excluded.indexOf(t)>-1}}let dS=class{constructor(t){this.cached=Object.create(null);let e=this.spec={};for(let r in t)e[r]=t[r];e.nodes=w_.from(t.nodes),e.marks=w_.from(t.marks||{}),this.nodes=cS.compile(this.spec.nodes,this),this.marks=uS.compile(this.spec.marks,this);let n=Object.create(null);for(let r in this.nodes){if(r in this.marks)throw new RangeError(r+" can not be both a node and a mark");let t=this.nodes[r],e=t.spec.content||"",i=t.spec.marks;t.contentMatch=n[e]||(n[e]=Z_.parse(e,this.nodes)),t.inlineContent=t.contentMatch.inlineContent,t.markSet="_"==i?null:i?fS(this,i.split(" ")):""!=i&&t.inlineContent?null:[]}for(let r in this.marks){let t=this.marks[r],e=t.spec.excludes;t.excluded=null==e?[t]:""==e?[]:fS(this,e.split(" "))}this.nodeFromJSON=this.nodeFromJSON.bind(this),this.markFromJSON=this.markFromJSON.bind(this),this.topNodeType=this.nodes[this.spec.topNode||"doc"],this.cached.wrappings=Object.create(null)}node(t,e=null,n,r){if("string"==typeof t)t=this.nodeType(t);else{if(!(t instanceof cS))throw new RangeError("Invalid node type: "+t);if(t.schema!=this)throw new RangeError("Node type from different schema used ("+t.name+")")}return t.createChecked(e,n,r)}text(t,e){let n=this.nodes.text;return new q_(n,n.defaultAttrs,t,C_.setFrom(e))}mark(t,e){return"string"==typeof t&&(t=this.marks[t]),t.create(e)}nodeFromJSON(t){return X_.fromJSON(this,t)}markFromJSON(t){return C_.fromJSON(this,t)}nodeType(t){let e=this.nodes[t];if(!e)throw new RangeError("Unknown node type: "+t);return e}};function fS(t,e){let n=[];for(let r=0;r<e.length;r++){let i=e[r],s=t.marks[i],o=s;if(s)n.push(s);else for(let e in t.marks){let r=t.marks[e];("_"==i||r.spec.group&&r.spec.group.split(" ").indexOf(i)>-1)&&n.push(o=r)}if(!o)throw new SyntaxError("Unknown mark type: '"+e[r]+"'")}return n}let pS=class t{constructor(t,e){this.schema=t,this.rules=e,this.tags=[],this.styles=[],e.forEach((t=>{t.tag?this.tags.push(t):t.style&&this.styles.push(t)})),this.normalizeLists=!this.tags.some((e=>{if(!/^(ul|ol)\b/.test(e.tag)||!e.node)return!1;let n=t.nodes[e.node];return n.contentMatch.matchType(n)}))}parse(t,e={}){let n=new xS(this,e,!1);return n.addAll(t,e.from,e.to),n.finish()}parseSlice(t,e={}){let n=new xS(this,e,!0);return n.addAll(t,e.from,e.to),M_.maxOpen(n.finish())}matchTag(t,e,n){for(let r=n?this.tags.indexOf(n)+1:0;r<this.tags.length;r++){let n=this.tags[r];if(wS(t,n.tag)&&(void 0===n.namespace||t.namespaceURI==n.namespace)&&(!n.context||e.matchesContext(n.context))){if(n.getAttrs){let e=n.getAttrs(t);if(!1===e)continue;n.attrs=e||void 0}return n}}}matchStyle(t,e,n,r){for(let i=r?this.styles.indexOf(r)+1:0;i<this.styles.length;i++){let r=this.styles[i],s=r.style;if(!(0!=s.indexOf(t)||r.context&&!n.matchesContext(r.context)||s.length>t.length&&(61!=s.charCodeAt(t.length)||s.slice(t.length+1)!=e))){if(r.getAttrs){let t=r.getAttrs(e);if(!1===t)continue;r.attrs=t||void 0}return r}}}static schemaRules(t){let e=[];function n(t){let n=null==t.priority?50:t.priority,r=0;for(;r<e.length;r++){let t=e[r];if((null==t.priority?50:t.priority)<n)break}e.splice(r,0,t)}for(let r in t.marks){let e=t.marks[r].spec.parseDOM;e&&e.forEach((t=>{n(t=ES(t)),t.mark||t.ignore||t.clearMark||(t.mark=r)}))}for(let r in t.nodes){let e=t.nodes[r].spec.parseDOM;e&&e.forEach((t=>{n(t=ES(t)),t.node||t.ignore||t.mark||(t.node=r)}))}return e}static fromSchema(e){return e.cached.domParser||(e.cached.domParser=new t(e,t.schemaRules(e)))}};const mS={address:!0,article:!0,aside:!0,blockquote:!0,canvas:!0,dd:!0,div:!0,dl:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,header:!0,hgroup:!0,hr:!0,li:!0,noscript:!0,ol:!0,output:!0,p:!0,pre:!0,section:!0,table:!0,tfoot:!0,ul:!0},gS={head:!0,noscript:!0,object:!0,script:!0,style:!0,title:!0},vS={ol:!0,ul:!0};function yS(t,e,n){return null!=e?(e?1:0)|("full"===e?2:0):t&&"pre"==t.whitespace?3:-5&n}class bS{constructor(t,e,n,r,i,s,o){this.type=t,this.attrs=e,this.marks=n,this.pendingMarks=r,this.solid=i,this.options=o,this.content=[],this.activeMarks=C_.none,this.stashMarks=[],this.match=s||(4&o?null:t.contentMatch)}findWrapping(t){if(!this.match){if(!this.type)return[];let e=this.type.contentMatch.fillBefore(S_.from(t));if(!e){let e,n=this.type.contentMatch;return(e=n.findWrapping(t.type))?(this.match=n,e):null}this.match=this.type.contentMatch.matchFragment(e)}return this.match.findWrapping(t.type)}finish(t){if(!(1&this.options)){let t,e=this.content[this.content.length-1];if(e&&e.isText&&(t=/[ \t\r\n\u000c]+$/.exec(e.text))){let n=e;e.text.length==t[0].length?this.content.pop():this.content[this.content.length-1]=n.withText(n.text.slice(0,n.text.length-t[0].length))}}let e=S_.from(this.content);return!t&&this.match&&(e=e.append(this.match.fillBefore(S_.empty,!0))),this.type?this.type.create(this.attrs,e,this.marks):e}popFromStashMark(t){for(let e=this.stashMarks.length-1;e>=0;e--)if(t.eq(this.stashMarks[e]))return this.stashMarks.splice(e,1)[0]}applyPending(t){for(let e=0,n=this.pendingMarks;e<n.length;e++){let r=n[e];(this.type?this.type.allowsMarkType(r.type):_S(r.type,t))&&!r.isInSet(this.activeMarks)&&(this.activeMarks=r.addToSet(this.activeMarks),this.pendingMarks=r.removeFromSet(this.pendingMarks))}}inlineContext(t){return this.type?this.type.inlineContent:this.content.length?this.content[0].isInline:t.parentNode&&!mS.hasOwnProperty(t.parentNode.nodeName.toLowerCase())}}class xS{constructor(t,e,n){this.parser=t,this.options=e,this.isOpen=n,this.open=0;let r,i=e.topNode,s=yS(null,e.preserveWhitespace,0)|(n?4:0);r=i?new bS(i.type,i.attrs,C_.none,C_.none,!0,e.topMatch||i.type.contentMatch,s):new bS(n?null:t.schema.topNodeType,null,C_.none,C_.none,!0,null,s),this.nodes=[r],this.find=e.findPositions,this.needsBlock=!1}get top(){return this.nodes[this.open]}addDOM(t){3==t.nodeType?this.addTextNode(t):1==t.nodeType&&this.addElement(t)}withStyleRules(t,e){let n=t.getAttribute("style");if(!n)return e();let r=this.readStyles(function(t){let e,n=/\s*([\w-]+)\s*:\s*([^;]+)/g,r=[];for(;e=n.exec(t);)r.push(e[1],e[2].trim());return r}(n));if(!r)return;let[i,s]=r,o=this.top;for(let a=0;a<s.length;a++)this.removePendingMark(s[a],o);for(let a=0;a<i.length;a++)this.addPendingMark(i[a]);e();for(let a=0;a<i.length;a++)this.removePendingMark(i[a],o);for(let a=0;a<s.length;a++)this.addPendingMark(s[a])}addTextNode(t){let e=t.nodeValue,n=this.top;if(2&n.options||n.inlineContext(t)||/[^ \t\r\n\u000c]/.test(e)){if(1&n.options)e=2&n.options?e.replace(/\r\n?/g,"\n"):e.replace(/\r?\n|\r/g," ");else if(e=e.replace(/[ \t\r\n\u000c]+/g," "),/^[ \t\r\n\u000c]/.test(e)&&this.open==this.nodes.length-1){let r=n.content[n.content.length-1],i=t.previousSibling;(!r||i&&"BR"==i.nodeName||r.isText&&/[ \t\r\n\u000c]$/.test(r.text))&&(e=e.slice(1))}e&&this.insertNode(this.parser.schema.text(e)),this.findInText(t)}else this.findInside(t)}addElement(t,e){let n,r=t.nodeName.toLowerCase();vS.hasOwnProperty(r)&&this.parser.normalizeLists&&function(t){for(let e=t.firstChild,n=null;e;e=e.nextSibling){let t=1==e.nodeType?e.nodeName.toLowerCase():null;t&&vS.hasOwnProperty(t)&&n?(n.appendChild(e),e=n):"li"==t?n=e:t&&(n=null)}}(t);let i=this.options.ruleFromNode&&this.options.ruleFromNode(t)||(n=this.parser.matchTag(t,this,e));if(i?i.ignore:gS.hasOwnProperty(r))this.findInside(t),this.ignoreFallback(t);else if(!i||i.skip||i.closeParent){i&&i.closeParent?this.open=Math.max(0,this.open-1):i&&i.skip.nodeType&&(t=i.skip);let e,n=this.top,s=this.needsBlock;if(mS.hasOwnProperty(r))n.content.length&&n.content[0].isInline&&this.open&&(this.open--,n=this.top),e=!0,n.type||(this.needsBlock=!0);else if(!t.firstChild)return void this.leafFallback(t);i&&i.skip?this.addAll(t):this.withStyleRules(t,(()=>this.addAll(t))),e&&this.sync(n),this.needsBlock=s}else this.withStyleRules(t,(()=>{this.addElementByRule(t,i,!1===i.consuming?n:void 0)}))}leafFallback(t){"BR"==t.nodeName&&this.top.type&&this.top.type.inlineContent&&this.addTextNode(t.ownerDocument.createTextNode("\n"))}ignoreFallback(t){"BR"!=t.nodeName||this.top.type&&this.top.type.inlineContent||this.findPlace(this.parser.schema.text("-"))}readStyles(t){let e=C_.none,n=C_.none;for(let r=0;r<t.length;r+=2)for(let i;;){let s=this.parser.matchStyle(t[r],t[r+1],this,i);if(!s)break;if(s.ignore)return null;if(s.clearMark?this.top.pendingMarks.concat(this.top.activeMarks).forEach((t=>{s.clearMark(t)&&(n=t.addToSet(n))})):e=this.parser.schema.marks[s.mark].create(s.attrs).addToSet(e),!1!==s.consuming)break;i=s}return[e,n]}addElementByRule(t,e,n){let r,i,s;if(e.node)i=this.parser.schema.nodes[e.node],i.isLeaf?this.insertNode(i.create(e.attrs))||this.leafFallback(t):r=this.enter(i,e.attrs||null,e.preserveWhitespace);else{s=this.parser.schema.marks[e.mark].create(e.attrs),this.addPendingMark(s)}let o=this.top;if(i&&i.isLeaf)this.findInside(t);else if(n)this.addElement(t,n);else if(e.getContent)this.findInside(t),e.getContent(t,this.parser.schema).forEach((t=>this.insertNode(t)));else{let n=t;"string"==typeof e.contentElement?n=t.querySelector(e.contentElement):"function"==typeof e.contentElement?n=e.contentElement(t):e.contentElement&&(n=e.contentElement),this.findAround(t,n,!0),this.addAll(n)}r&&this.sync(o)&&this.open--,s&&this.removePendingMark(s,o)}addAll(t,e,n){let r=e||0;for(let i=e?t.childNodes[e]:t.firstChild,s=null==n?null:t.childNodes[n];i!=s;i=i.nextSibling,++r)this.findAtPoint(t,r),this.addDOM(i);this.findAtPoint(t,r)}findPlace(t){let e,n;for(let r=this.open;r>=0;r--){let i=this.nodes[r],s=i.findWrapping(t);if(s&&(!e||e.length>s.length)&&(e=s,n=i,!s.length))break;if(i.solid)break}if(!e)return!1;this.sync(n);for(let r=0;r<e.length;r++)this.enterInner(e[r],null,!1);return!0}insertNode(t){if(t.isInline&&this.needsBlock&&!this.top.type){let t=this.textblockFromContext();t&&this.enterInner(t)}if(this.findPlace(t)){this.closeExtra();let e=this.top;e.applyPending(t.type),e.match&&(e.match=e.match.matchType(t.type));let n=e.activeMarks;for(let r=0;r<t.marks.length;r++)e.type&&!e.type.allowsMarkType(t.marks[r].type)||(n=t.marks[r].addToSet(n));return e.content.push(t.mark(n)),!0}return!1}enter(t,e,n){let r=this.findPlace(t.create(e));return r&&this.enterInner(t,e,!0,n),r}enterInner(t,e=null,n=!1,r){this.closeExtra();let i=this.top;i.applyPending(t),i.match=i.match&&i.match.matchType(t);let s=yS(t,r,i.options);4&i.options&&0==i.content.length&&(s|=4),this.nodes.push(new bS(t,e,i.activeMarks,i.pendingMarks,n,null,s)),this.open++}closeExtra(t=!1){let e=this.nodes.length-1;if(e>this.open){for(;e>this.open;e--)this.nodes[e-1].content.push(this.nodes[e].finish(t));this.nodes.length=this.open+1}}finish(){return this.open=0,this.closeExtra(this.isOpen),this.nodes[0].finish(this.isOpen||this.options.topOpen)}sync(t){for(let e=this.open;e>=0;e--)if(this.nodes[e]==t)return this.open=e,!0;return!1}get currentPos(){this.closeExtra();let t=0;for(let e=this.open;e>=0;e--){let n=this.nodes[e].content;for(let e=n.length-1;e>=0;e--)t+=n[e].nodeSize;e&&t++}return t}findAtPoint(t,e){if(this.find)for(let n=0;n<this.find.length;n++)this.find[n].node==t&&this.find[n].offset==e&&(this.find[n].pos=this.currentPos)}findInside(t){if(this.find)for(let e=0;e<this.find.length;e++)null==this.find[e].pos&&1==t.nodeType&&t.contains(this.find[e].node)&&(this.find[e].pos=this.currentPos)}findAround(t,e,n){if(t!=e&&this.find)for(let r=0;r<this.find.length;r++)if(null==this.find[r].pos&&1==t.nodeType&&t.contains(this.find[r].node)){e.compareDocumentPosition(this.find[r].node)&(n?2:4)&&(this.find[r].pos=this.currentPos)}}findInText(t){if(this.find)for(let e=0;e<this.find.length;e++)this.find[e].node==t&&(this.find[e].pos=this.currentPos-(t.nodeValue.length-this.find[e].offset))}matchesContext(t){if(t.indexOf("|")>-1)return t.split(/\s*\|\s*/).some(this.matchesContext,this);let e=t.split("/"),n=this.options.context,r=!(this.isOpen||n&&n.parent.type!=this.nodes[0].type),i=-(n?n.depth+1:0)+(r?0:1),s=(t,o)=>{for(;t>=0;t--){let a=e[t];if(""==a){if(t==e.length-1||0==t)continue;for(;o>=i;o--)if(s(t-1,o))return!0;return!1}{let t=o>0||0==o&&r?this.nodes[o].type:n&&o>=i?n.node(o-i).type:null;if(!t||t.name!=a&&-1==t.groups.indexOf(a))return!1;o--}}return!0};return s(e.length-1,this.open)}textblockFromContext(){let t=this.options.context;if(t)for(let e=t.depth;e>=0;e--){let n=t.node(e).contentMatchAt(t.indexAfter(e)).defaultType;if(n&&n.isTextblock&&n.defaultAttrs)return n}for(let e in this.parser.schema.nodes){let t=this.parser.schema.nodes[e];if(t.isTextblock&&t.defaultAttrs)return t}}addPendingMark(t){let e=function(t,e){for(let n=0;n<e.length;n++)if(t.eq(e[n]))return e[n]}(t,this.top.pendingMarks);e&&this.top.stashMarks.push(e),this.top.pendingMarks=t.addToSet(this.top.pendingMarks)}removePendingMark(t,e){for(let n=this.open;n>=0;n--){let r=this.nodes[n];if(r.pendingMarks.lastIndexOf(t)>-1)r.pendingMarks=t.removeFromSet(r.pendingMarks);else{r.activeMarks=t.removeFromSet(r.activeMarks);let e=r.popFromStashMark(t);e&&r.type&&r.type.allowsMarkType(e.type)&&(r.activeMarks=e.addToSet(r.activeMarks))}if(r==e)break}}}function wS(t,e){return(t.matches||t.msMatchesSelector||t.webkitMatchesSelector||t.mozMatchesSelector).call(t,e)}function ES(t){let e={};for(let n in t)e[n]=t[n];return e}function _S(t,e){let n=e.schema.nodes;for(let r in n){let i=n[r];if(!i.allowsMarkType(t))continue;let s=[],o=t=>{s.push(t);for(let n=0;n<t.edgeCount;n++){let{type:r,next:i}=t.edge(n);if(r==e)return!0;if(s.indexOf(i)<0&&o(i))return!0}};if(o(i.contentMatch))return!0}}class SS{constructor(t,e){this.nodes=t,this.marks=e}serializeFragment(t,e={},n){n||(n=kS(e).createDocumentFragment());let r=n,i=[];return t.forEach((t=>{if(i.length||t.marks.length){let n=0,s=0;for(;n<i.length&&s<t.marks.length;){let e=t.marks[s];if(this.marks[e.type.name]){if(!e.eq(i[n][0])||!1===e.type.spec.spanning)break;n++,s++}else s++}for(;n<i.length;)r=i.pop()[1];for(;s<t.marks.length;){let n=t.marks[s++],o=this.serializeMark(n,t.isInline,e);o&&(i.push([n,r]),r.appendChild(o.dom),r=o.contentDOM||o.dom)}}r.appendChild(this.serializeNodeInner(t,e))})),n}serializeNodeInner(t,e){let{dom:n,contentDOM:r}=SS.renderSpec(kS(e),this.nodes[t.type.name](t));if(r){if(t.isLeaf)throw new RangeError("Content hole not allowed in a leaf node spec");this.serializeFragment(t.content,e,r)}return n}serializeNode(t,e={}){let n=this.serializeNodeInner(t,e);for(let r=t.marks.length-1;r>=0;r--){let i=this.serializeMark(t.marks[r],t.isInline,e);i&&((i.contentDOM||i.dom).appendChild(n),n=i.dom)}return n}serializeMark(t,e,n={}){let r=this.marks[t.type.name];return r&&SS.renderSpec(kS(n),r(t,e))}static renderSpec(t,e,n=null){if("string"==typeof e)return{dom:t.createTextNode(e)};if(null!=e.nodeType)return{dom:e};if(e.dom&&null!=e.dom.nodeType)return e;let r,i=e[0],s=i.indexOf(" ");s>0&&(n=i.slice(0,s),i=i.slice(s+1));let o=n?t.createElementNS(n,i):t.createElement(i),a=e[1],l=1;if(a&&"object"==typeof a&&null==a.nodeType&&!Array.isArray(a)){l=2;for(let t in a)if(null!=a[t]){let e=t.indexOf(" ");e>0?o.setAttributeNS(t.slice(0,e),t.slice(e+1),a[t]):o.setAttribute(t,a[t])}}for(let c=l;c<e.length;c++){let i=e[c];if(0===i){if(c<e.length-1||c>l)throw new RangeError("Content hole must be the only child of its parent node");return{dom:o,contentDOM:o}}{let{dom:e,contentDOM:s}=SS.renderSpec(t,i,n);if(o.appendChild(e),s){if(r)throw new RangeError("Multiple content holes");r=s}}}return{dom:o,contentDOM:r}}static fromSchema(t){return t.cached.domSerializer||(t.cached.domSerializer=new SS(this.nodesFromSchema(t),this.marksFromSchema(t)))}static nodesFromSchema(t){let e=TS(t.nodes);return e.text||(e.text=t=>t.text),e}static marksFromSchema(t){return TS(t.marks)}}function TS(t){let e={};for(let n in t){let r=t[n].spec.toDOM;r&&(e[n]=r)}return e}function kS(t){return t.document||window.document}var AS=Object.defineProperty,CS=(t,e,n)=>(((t,e,n)=>{e in t?AS(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),RS=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},MS=(t,e,n)=>(((t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)})(t,e,"access private method"),n);const IS=()=>{const t=t=>t.elements.length,e=e=>e.elements[t(e)-1];return{size:t,top:e,push:t=>n=>{var r;null==(r=e(t))||r.push(n)},open:t=>e=>{t.elements.push(e)},close:t=>{const e=t.elements.pop();if(!e)throw ew();return e}}},{size:DS,push:OS,top:PS,open:LS,close:FS}=IS(),NS=t=>t.isText,BS=t=>(e,n)=>LS(t)(((t,e,n)=>{const r={type:t,content:e,attrs:n,push:(...t)=>((t,e,...n)=>{t.content.push(e,...n)})(r,...t),pop:()=>(t=>t.content.pop())(r)};return r})(e,[],n)),US=t=>(e,n,r)=>{const i=e.createAndFill(n,r,t.marks);if(!i)throw((...t)=>{const e=t.reduce(((t,e)=>{if(!e)return t;const n=t=>Array.isArray(t)?t.map((t=>n(t))).join(", "):t.toJSON?tw(t.toJSON()):t.spec?tw(t.spec):t.toString();return`${t}, ${n(e)}`}),"Create prosemirror node from remark failed in parser");return new Jx(Zx.createNodeInParserFail,e)})(e,n,r);return OS(t)(i),i},VS=t=>()=>{t.marks=C_.none;const e=FS(t);return US(t)(e.type,e.attrs,e.content)},jS=t=>(e,n)=>{const r=e.create(n);t.marks=r.addToSet(t.marks)},zS=t=>e=>{t.marks=e.removeFromSet(t.marks)},GS=t=>e=>{const n=PS(t);if(!n)throw ew();const r=n.pop(),i=t.schema.text(e,t.marks);if(!r)return void n.push(i);const s=((t,e,n)=>{if(NS(e)&&NS(n)&&C_.sameSet(e.marks,n.marks))return t.text(e.text+n.text,e.marks)})(t.schema,r,i);s?n.push(s):n.push(r,i)},WS=t=>()=>{let e;do{e=VS(t)()}while(DS(t));return e};var HS,$S,YS,XS;let qS=class{constructor(t,e,n){RS(this,HS),RS(this,YS),CS(this,"run",((t,e)=>{const n=t.runSync(t.parse(e),e);return this.next(n),this})),CS(this,"next",((t=[])=>([t].flat().forEach((t=>MS(this,YS,XS).call(this,t))),this))),CS(this,"toDoc",(()=>this.stack.build())),CS(this,"injectRoot",((t,e,n)=>(this.stack.openNode(e,n),this.next(t.children),this))),CS(this,"addText",((t="")=>(this.stack.addText(t),this))),CS(this,"addNode",((...t)=>(this.stack.addNode(...t),this))),CS(this,"openNode",((...t)=>(this.stack.openNode(...t),this))),CS(this,"closeNode",((...t)=>(this.stack.closeNode(...t),this))),CS(this,"openMark",((...t)=>(this.stack.openMark(...t),this))),CS(this,"closeMark",((...t)=>(this.stack.closeMark(...t),this))),this.stack=t,this.schema=e,this.specMap=n}};HS=new WeakSet,$S=function(t){const e=Object.values(this.specMap).find((e=>e.match(t)));if(!e)throw(t=>new Jx(Zx.parserMatchError,`Cannot match target parser for node: ${tw(t)}.`))(t);return e},YS=new WeakSet,XS=function(t){const{key:e,runner:n,is:r}=MS(this,HS,$S).call(this,t);n(this,t,this.schema["node"===r?"nodes":"marks"][e])};const KS=(t,e,n)=>{const r=new qS((t=>{const e={marks:[],elements:[],schema:t};return{build:WS(e),openMark:jS(e),closeMark:zS(e),addText:GS(e),openNode:BS(e),addNode:US(e),closeNode:VS(e)}})(t),t,e);return t=>(r.run(n,t),r.toDoc())},ZS=(t,e,n,r={})=>{const i={type:t,children:e,props:r,value:n,push:(...t)=>((t,e,...n)=>{t.children||(t.children=[]),t.children.push(e,...n)})(i,...t),pop:()=>(t=>{var e;return null==(e=t.children)?void 0:e.pop()})(i)};return i},{size:JS,push:QS,open:tT,close:eT}=IS(),nT=t=>{const{children:e}=t;return e&&(t.children=e.reduce(((t,e,n)=>{if(0===n)return[e];const r=t[t.length-1];if(r&&r.isMark&&e.isMark){e=((t,e)=>{var n;if(t.type===e||1!==(null==(n=t.children)?void 0:n.length))return t;const r=t=>{var n;if(t.type===e)return t;if(1!==(null==(n=t.children)?void 0:n.length))return null;const[i]=t.children;return i?r(i):null},i=r(t);if(!i)return t;const s=i.children?[...i.children]:void 0,o={...t,children:s};return o.children=s,i.children=[o],i})(e,r.type);const{children:n,...i}=e,{children:s,...o}=r;if(e.type===r.type&&n&&s&&JSON.stringify(i)===JSON.stringify(o)){const e={...o,children:[...s,...n]};return t.slice(0,-1).concat(nT(e))}}return t.concat(e)}),[])),t},rT=t=>(e,n,r)=>tT(t)(ZS(e,[],n,r)),iT=t=>(e,n,r,i)=>{const s=ZS(e,n,r,i),o=nT((t=>{const e={...t.props,type:t.type};return t.children&&(e.children=t.children),t.value&&(e.value=t.value),e})(s));return QS(t)(o),o},sT=t=>()=>{const e=eT(t);return iT(t)(e.type,e.children,e.value,e.props)},oT=t=>(e,n,r,i)=>{e.isInSet(t.marks)||(t.marks=e.addToSet(t.marks),rT(t)(n,r,{...i,isMark:!0}))},aT=t=>e=>e.isInSet(t.marks)?(t.marks=e.type.removeFromSet(t.marks),sT(t)()):null,lT=t=>()=>{let e=null;do{e=sT(t)()}while(JS(t));return e};var cT,hT,uT,dT,fT,pT,mT,gT;let vT=class{constructor(t,e,n){RS(this,cT),RS(this,uT),RS(this,fT),RS(this,mT),CS(this,"toString",(t=>t.stringify(this.stack.build()))),CS(this,"next",(t=>(t=>Object.prototype.hasOwnProperty.call(t,"size"))(t)?(t.forEach((t=>{MS(this,mT,gT).call(this,t)})),this):(MS(this,mT,gT).call(this,t),this))),CS(this,"addNode",((...t)=>(this.stack.addNode(...t),this))),CS(this,"openNode",((...t)=>(this.stack.openNode(...t),this))),CS(this,"closeNode",((...t)=>(this.stack.closeNode(...t),this))),CS(this,"withMark",((...t)=>(this.stack.openMark(...t),this))),this.stack=t,this.schema=e,this.specMap=n}run(t){return this.next(t),this}};cT=new WeakSet,hT=function(t){const e=Object.entries(this.specMap).map((([t,e])=>({key:t,...e}))).find((e=>e.match(t)));if(!e)throw(t=>new Jx(Zx.serializerMatchError,`Cannot match target serializer for node: ${tw(t)}.`))(t.type);return e},uT=new WeakSet,dT=function(t){const{runner:e}=MS(this,cT,hT).call(this,t);e(this,t)},fT=new WeakSet,pT=function(t,e){const{runner:n}=MS(this,cT,hT).call(this,t);return n(this,t,e)},mT=new WeakSet,gT=function(t){const{marks:e}=t,n=t=>{var e;return null!=(e=t.type.spec.priority)?e:50};[...e].sort(((t,e)=>n(t)-n(e))).every((e=>!MS(this,fT,pT).call(this,e,t)))&&MS(this,uT,dT).call(this,t),e.forEach((t=>this.stack.closeMark(t)))};const yT=(t,e,n)=>r=>{const i=new vT((()=>{const t={marks:[],elements:[]};return{build:lT(t),openMark:oT(t),closeMark:aT(t),openNode:rT(t),addNode:iT(t),closeNode:sT(t)}})(),t,e);return i.run(r),i.toString(n)},bT=Math.pow(2,16);function xT(t){return 65535&t}class wT{constructor(t,e,n){this.pos=t,this.delInfo=e,this.recover=n}get deleted(){return(8&this.delInfo)>0}get deletedBefore(){return(5&this.delInfo)>0}get deletedAfter(){return(6&this.delInfo)>0}get deletedAcross(){return(4&this.delInfo)>0}}class ET{constructor(t,e=!1){if(this.ranges=t,this.inverted=e,!t.length&&ET.empty)return ET.empty}recover(t){let e=0,n=xT(t);if(!this.inverted)for(let r=0;r<n;r++)e+=this.ranges[3*r+2]-this.ranges[3*r+1];return this.ranges[3*n]+e+function(t){return(t-(65535&t))/bT}(t)}mapResult(t,e=1){return this._map(t,e,!1)}map(t,e=1){return this._map(t,e,!0)}_map(t,e,n){let r=0,i=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let a=this.ranges[o]-(this.inverted?r:0);if(a>t)break;let l=this.ranges[o+i],c=this.ranges[o+s],h=a+l;if(t<=h){let i=a+r+((l?t==a?-1:t==h?1:e:e)<0?0:c);if(n)return i;let s=t==(e<0?a:h)?null:o/3+(t-a)*bT,u=t==a?2:t==h?1:4;return(e<0?t!=a:t!=h)&&(u|=8),new wT(i,u,s)}r+=c-l}return n?t+r:new wT(t+r,0,null)}touches(t,e){let n=0,r=xT(e),i=this.inverted?2:1,s=this.inverted?1:2;for(let o=0;o<this.ranges.length;o+=3){let e=this.ranges[o]-(this.inverted?n:0);if(e>t)break;let a=this.ranges[o+i];if(t<=e+a&&o==3*r)return!0;n+=this.ranges[o+s]-a}return!1}forEach(t){let e=this.inverted?2:1,n=this.inverted?1:2;for(let r=0,i=0;r<this.ranges.length;r+=3){let s=this.ranges[r],o=s-(this.inverted?i:0),a=s+(this.inverted?0:i),l=this.ranges[r+e],c=this.ranges[r+n];t(o,o+l,a,a+c),i+=c-l}}invert(){return new ET(this.ranges,!this.inverted)}toString(){return(this.inverted?"-":"")+JSON.stringify(this.ranges)}static offset(t){return 0==t?ET.empty:new ET(t<0?[0,-t,0]:[0,0,t])}}ET.empty=new ET([]);class _T{constructor(t=[],e,n=0,r=t.length){this.maps=t,this.mirror=e,this.from=n,this.to=r}slice(t=0,e=this.maps.length){return new _T(this.maps,this.mirror,t,e)}copy(){return new _T(this.maps.slice(),this.mirror&&this.mirror.slice(),this.from,this.to)}appendMap(t,e){this.to=this.maps.push(t),null!=e&&this.setMirror(this.maps.length-1,e)}appendMapping(t){for(let e=0,n=this.maps.length;e<t.maps.length;e++){let r=t.getMirror(e);this.appendMap(t.maps[e],null!=r&&r<e?n+r:void 0)}}getMirror(t){if(this.mirror)for(let e=0;e<this.mirror.length;e++)if(this.mirror[e]==t)return this.mirror[e+(e%2?-1:1)]}setMirror(t,e){this.mirror||(this.mirror=[]),this.mirror.push(t,e)}appendMappingInverted(t){for(let e=t.maps.length-1,n=this.maps.length+t.maps.length;e>=0;e--){let r=t.getMirror(e);this.appendMap(t.maps[e].invert(),null!=r&&r>e?n-r-1:void 0)}}invert(){let t=new _T;return t.appendMappingInverted(this),t}map(t,e=1){if(this.mirror)return this._map(t,e,!0);for(let n=this.from;n<this.to;n++)t=this.maps[n].map(t,e);return t}mapResult(t,e=1){return this._map(t,e,!1)}_map(t,e,n){let r=0;for(let i=this.from;i<this.to;i++){let n=this.maps[i].mapResult(t,e);if(null!=n.recover){let e=this.getMirror(i);if(null!=e&&e>i&&e<this.to){i=e,t=this.maps[e].recover(n.recover);continue}}r|=n.delInfo,t=n.pos}return n?t:new wT(t,r,null)}}const ST=Object.create(null);class TT{getMap(){return ET.empty}merge(t){return null}static fromJSON(t,e){if(!e||!e.stepType)throw new RangeError("Invalid input for Step.fromJSON");let n=ST[e.stepType];if(!n)throw new RangeError(`No step type ${e.stepType} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in ST)throw new RangeError("Duplicate use of step JSON ID "+t);return ST[t]=e,e.prototype.jsonID=t,e}}class kT{constructor(t,e){this.doc=t,this.failed=e}static ok(t){return new kT(t,null)}static fail(t){return new kT(null,t)}static fromReplace(t,e,n,r){try{return kT.ok(t.replace(e,n,r))}catch(Ni){if(Ni instanceof R_)return kT.fail(Ni.message);throw Ni}}}function AT(t,e,n){let r=[];for(let i=0;i<t.childCount;i++){let s=t.child(i);s.content.size&&(s=s.copy(AT(s.content,e,s))),s.isInline&&(s=e(s,n,i)),r.push(s)}return S_.fromArray(r)}class CT extends TT{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=t.resolve(this.from),r=n.node(n.sharedDepth(this.to)),i=new M_(AT(e.content,((t,e)=>t.isAtom&&e.type.allowsMarkType(this.mark.type)?t.mark(this.mark.addToSet(t.marks)):t),r),e.openStart,e.openEnd);return kT.fromReplace(t,this.from,this.to,i)}invert(){return new RT(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new CT(e.pos,n.pos,this.mark)}merge(t){return t instanceof CT&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new CT(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"addMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for AddMarkStep.fromJSON");return new CT(e.from,e.to,t.markFromJSON(e.mark))}}TT.jsonID("addMark",CT);class RT extends TT{constructor(t,e,n){super(),this.from=t,this.to=e,this.mark=n}apply(t){let e=t.slice(this.from,this.to),n=new M_(AT(e.content,(t=>t.mark(this.mark.removeFromSet(t.marks))),t),e.openStart,e.openEnd);return kT.fromReplace(t,this.from,this.to,n)}invert(){return new CT(this.from,this.to,this.mark)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deleted&&n.deleted||e.pos>=n.pos?null:new RT(e.pos,n.pos,this.mark)}merge(t){return t instanceof RT&&t.mark.eq(this.mark)&&this.from<=t.to&&this.to>=t.from?new RT(Math.min(this.from,t.from),Math.max(this.to,t.to),this.mark):null}toJSON(){return{stepType:"removeMark",mark:this.mark.toJSON(),from:this.from,to:this.to}}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for RemoveMarkStep.fromJSON");return new RT(e.from,e.to,t.markFromJSON(e.mark))}}TT.jsonID("removeMark",RT);class MT extends TT{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return kT.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.addToSet(e.marks));return kT.fromReplace(t,this.pos,this.pos+1,new M_(S_.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);if(e){let t=this.mark.addToSet(e.marks);if(t.length==e.marks.length){for(let n=0;n<e.marks.length;n++)if(!e.marks[n].isInSet(t))return new MT(this.pos,e.marks[n]);return new MT(this.pos,this.mark)}}return new IT(this.pos,this.mark)}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new MT(e.pos,this.mark)}toJSON(){return{stepType:"addNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for AddNodeMarkStep.fromJSON");return new MT(e.pos,t.markFromJSON(e.mark))}}TT.jsonID("addNodeMark",MT);class IT extends TT{constructor(t,e){super(),this.pos=t,this.mark=e}apply(t){let e=t.nodeAt(this.pos);if(!e)return kT.fail("No node at mark step's position");let n=e.type.create(e.attrs,null,this.mark.removeFromSet(e.marks));return kT.fromReplace(t,this.pos,this.pos+1,new M_(S_.from(n),0,e.isLeaf?0:1))}invert(t){let e=t.nodeAt(this.pos);return e&&this.mark.isInSet(e.marks)?new MT(this.pos,this.mark):this}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new IT(e.pos,this.mark)}toJSON(){return{stepType:"removeNodeMark",pos:this.pos,mark:this.mark.toJSON()}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for RemoveNodeMarkStep.fromJSON");return new IT(e.pos,t.markFromJSON(e.mark))}}TT.jsonID("removeNodeMark",IT);class DT extends TT{constructor(t,e,n,r=!1){super(),this.from=t,this.to=e,this.slice=n,this.structure=r}apply(t){return this.structure&&PT(t,this.from,this.to)?kT.fail("Structure replace would overwrite content"):kT.fromReplace(t,this.from,this.to,this.slice)}getMap(){return new ET([this.from,this.to-this.from,this.slice.size])}invert(t){return new DT(this.from,this.from+this.slice.size,t.slice(this.from,this.to))}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1);return e.deletedAcross&&n.deletedAcross?null:new DT(e.pos,Math.max(e.pos,n.pos),this.slice)}merge(t){if(!(t instanceof DT)||t.structure||this.structure)return null;if(this.from+this.slice.size!=t.from||this.slice.openEnd||t.slice.openStart){if(t.to!=this.from||this.slice.openStart||t.slice.openEnd)return null;{let e=this.slice.size+t.slice.size==0?M_.empty:new M_(t.slice.content.append(this.slice.content),t.slice.openStart,this.slice.openEnd);return new DT(t.from,this.to,e,this.structure)}}{let e=this.slice.size+t.slice.size==0?M_.empty:new M_(this.slice.content.append(t.slice.content),this.slice.openStart,t.slice.openEnd);return new DT(this.from,this.to+(t.to-t.from),e,this.structure)}}toJSON(){let t={stepType:"replace",from:this.from,to:this.to};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to)throw new RangeError("Invalid input for ReplaceStep.fromJSON");return new DT(e.from,e.to,M_.fromJSON(t,e.slice),!!e.structure)}}TT.jsonID("replace",DT);class OT extends TT{constructor(t,e,n,r,i,s,o=!1){super(),this.from=t,this.to=e,this.gapFrom=n,this.gapTo=r,this.slice=i,this.insert=s,this.structure=o}apply(t){if(this.structure&&(PT(t,this.from,this.gapFrom)||PT(t,this.gapTo,this.to)))return kT.fail("Structure gap-replace would overwrite content");let e=t.slice(this.gapFrom,this.gapTo);if(e.openStart||e.openEnd)return kT.fail("Gap is not a flat range");let n=this.slice.insertAt(this.insert,e.content);return n?kT.fromReplace(t,this.from,this.to,n):kT.fail("Content does not fit in gap")}getMap(){return new ET([this.from,this.gapFrom-this.from,this.insert,this.gapTo,this.to-this.gapTo,this.slice.size-this.insert])}invert(t){let e=this.gapTo-this.gapFrom;return new OT(this.from,this.from+this.slice.size+e,this.from+this.insert,this.from+this.insert+e,t.slice(this.from,this.to).removeBetween(this.gapFrom-this.from,this.gapTo-this.from),this.gapFrom-this.from,this.structure)}map(t){let e=t.mapResult(this.from,1),n=t.mapResult(this.to,-1),r=t.map(this.gapFrom,-1),i=t.map(this.gapTo,1);return e.deletedAcross&&n.deletedAcross||r<e.pos||i>n.pos?null:new OT(e.pos,n.pos,r,i,this.slice,this.insert,this.structure)}toJSON(){let t={stepType:"replaceAround",from:this.from,to:this.to,gapFrom:this.gapFrom,gapTo:this.gapTo,insert:this.insert};return this.slice.size&&(t.slice=this.slice.toJSON()),this.structure&&(t.structure=!0),t}static fromJSON(t,e){if("number"!=typeof e.from||"number"!=typeof e.to||"number"!=typeof e.gapFrom||"number"!=typeof e.gapTo||"number"!=typeof e.insert)throw new RangeError("Invalid input for ReplaceAroundStep.fromJSON");return new OT(e.from,e.to,e.gapFrom,e.gapTo,M_.fromJSON(t,e.slice),e.insert,!!e.structure)}}function PT(t,e,n){let r=t.resolve(e),i=n-e,s=r.depth;for(;i>0&&s>0&&r.indexAfter(s)==r.node(s).childCount;)s--,i--;if(i>0){let t=r.node(s).maybeChild(r.indexAfter(s));for(;i>0;){if(!t||t.isLeaf)return!0;t=t.firstChild,i--}}return!1}function LT(t,e,n){return(0==e||t.canReplace(e,t.childCount))&&(n==t.childCount||t.canReplace(0,n))}function FT(t){let e=t.parent.content.cutByIndex(t.startIndex,t.endIndex);for(let n=t.depth;;--n){let r=t.$from.node(n),i=t.$from.index(n),s=t.$to.indexAfter(n);if(n<t.depth&&r.canReplace(i,s,e))return n;if(0==n||r.type.spec.isolating||!LT(r,i,s))break}return null}function NT(t,e,n=null,r=t){let i=function(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.contentMatchAt(r).findWrapping(e);if(!s)return null;let o=s.length?s[0]:e;return n.canReplaceWith(r,i,o)?s:null}(t,e),s=i&&function(t,e){let{parent:n,startIndex:r,endIndex:i}=t,s=n.child(r),o=e.contentMatch.findWrapping(s.type);if(!o)return null;let a=(o.length?o[o.length-1]:e).contentMatch;for(let l=r;a&&l<i;l++)a=a.matchType(n.child(l).type);return a&&a.validEnd?o:null}(r,e);return s?i.map(BT).concat({type:e,attrs:n}).concat(s.map(BT)):null}function BT(t){return{type:t,attrs:null}}function UT(t,e,n=1,r){let i=t.resolve(e),s=i.depth-n,o=r&&r[r.length-1]||i.parent;if(s<0||i.parent.type.spec.isolating||!i.parent.canReplace(i.index(),i.parent.childCount)||!o.type.validContent(i.parent.content.cutByIndex(i.index(),i.parent.childCount)))return!1;for(let c=i.depth-1,h=n-2;c>s;c--,h--){let t=i.node(c),e=i.index(c);if(t.type.spec.isolating)return!1;let n=t.content.cutByIndex(e,t.childCount),s=r&&r[h+1];s&&(n=n.replaceChild(0,s.type.create(s.attrs)));let o=r&&r[h]||t;if(!t.canReplace(e+1,t.childCount)||!o.type.validContent(n))return!1}let a=i.indexAfter(s),l=r&&r[0];return i.node(s).canReplaceWith(a,a,l?l.type:i.node(s+1).type)}function VT(t,e){let n=t.resolve(e),r=n.index();return i=n.nodeBefore,s=n.nodeAfter,!(!i||!s||i.isLeaf||!i.canAppend(s))&&n.parent.canReplace(r,r+1);var i,s}function jT(t,e,n){let r=t.resolve(e);if(!n.content.size)return e;let i=n.content;for(let s=0;s<n.openStart;s++)i=i.firstChild.content;for(let s=1;s<=(0==n.openStart&&n.size?2:1);s++)for(let t=r.depth;t>=0;t--){let e=t==r.depth?0:r.pos<=(r.start(t+1)+r.end(t+1))/2?-1:1,n=r.index(t)+(e>0?1:0),o=r.node(t),a=!1;if(1==s)a=o.canReplace(n,n,i);else{let t=o.contentMatchAt(n).findWrapping(i.firstChild.type);a=t&&o.canReplaceWith(n,n,t[0])}if(a)return 0==e?r.pos:e<0?r.before(t+1):r.after(t+1)}return null}function zT(t,e,n=e,r=M_.empty){if(e==n&&!r.size)return null;let i=t.resolve(e),s=t.resolve(n);return GT(i,s,r)?new DT(e,n,r):new WT(i,s,r).fit()}function GT(t,e,n){return!n.openStart&&!n.openEnd&&t.start()==e.start()&&t.parent.canReplace(t.index(),e.index(),n.content)}TT.jsonID("replaceAround",OT);class WT{constructor(t,e,n){this.$from=t,this.$to=e,this.unplaced=n,this.frontier=[],this.placed=S_.empty;for(let r=0;r<=t.depth;r++){let e=t.node(r);this.frontier.push({type:e.type,match:e.contentMatchAt(t.indexAfter(r))})}for(let r=t.depth;r>0;r--)this.placed=S_.from(t.node(r).copy(this.placed))}get depth(){return this.frontier.length-1}fit(){for(;this.unplaced.size;){let t=this.findFittable();t?this.placeNodes(t):this.openMore()||this.dropNode()}let t=this.mustMoveInline(),e=this.placed.size-this.depth-this.$from.depth,n=this.$from,r=this.close(t<0?this.$to:n.doc.resolve(t));if(!r)return null;let i=this.placed,s=n.depth,o=r.depth;for(;s&&o&&1==i.childCount;)i=i.firstChild.content,s--,o--;let a=new M_(i,s,o);return t>-1?new OT(n.pos,t,this.$to.pos,this.$to.end(),a,e):a.size||n.pos!=this.$to.pos?new DT(n.pos,r.pos,a):null}findFittable(){let t=this.unplaced.openStart;for(let e=this.unplaced.content,n=0,r=this.unplaced.openEnd;n<t;n++){let i=e.firstChild;if(e.childCount>1&&(r=0),i.type.spec.isolating&&r<=n){t=n;break}e=i.content}for(let e=1;e<=2;e++)for(let n=1==e?t:this.unplaced.openStart;n>=0;n--){let t,r=null;n?(r=YT(this.unplaced.content,n-1).firstChild,t=r.content):t=this.unplaced.content;let i=t.firstChild;for(let s=this.depth;s>=0;s--){let t,{type:o,match:a}=this.frontier[s],l=null;if(1==e&&(i?a.matchType(i.type)||(l=a.fillBefore(S_.from(i),!1)):r&&o.compatibleContent(r.type)))return{sliceDepth:n,frontierDepth:s,parent:r,inject:l};if(2==e&&i&&(t=a.findWrapping(i.type)))return{sliceDepth:n,frontierDepth:s,parent:r,wrap:t};if(r&&a.matchType(r.type))break}}}openMore(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=YT(t,e);return!(!r.childCount||r.firstChild.isLeaf)&&(this.unplaced=new M_(t,e+1,Math.max(n,r.size+e>=t.size-n?e+1:0)),!0)}dropNode(){let{content:t,openStart:e,openEnd:n}=this.unplaced,r=YT(t,e);if(r.childCount<=1&&e>0){let i=t.size-e<=e+r.size;this.unplaced=new M_(HT(t,e-1,1),e-1,i?e-1:n)}else this.unplaced=new M_(HT(t,e,1),e,n)}placeNodes({sliceDepth:t,frontierDepth:e,parent:n,inject:r,wrap:i}){for(;this.depth>e;)this.closeFrontierNode();if(i)for(let p=0;p<i.length;p++)this.openFrontierNode(i[p]);let s=this.unplaced,o=n?n.content:s.content,a=s.openStart-t,l=0,c=[],{match:h,type:u}=this.frontier[e];if(r){for(let t=0;t<r.childCount;t++)c.push(r.child(t));h=h.matchFragment(r)}let d=o.size+t-(s.content.size-s.openEnd);for(;l<o.childCount;){let t=o.child(l),e=h.matchType(t.type);if(!e)break;l++,(l>1||0==a||t.content.size)&&(h=e,c.push(XT(t.mark(u.allowedMarks(t.marks)),1==l?a:0,l==o.childCount?d:-1)))}let f=l==o.childCount;f||(d=-1),this.placed=$T(this.placed,e,S_.from(c)),this.frontier[e].match=h,f&&d<0&&n&&n.type==this.frontier[this.depth].type&&this.frontier.length>1&&this.closeFrontierNode();for(let p=0,m=o;p<d;p++){let t=m.lastChild;this.frontier.push({type:t.type,match:t.contentMatchAt(t.childCount)}),m=t.content}this.unplaced=f?0==t?M_.empty:new M_(HT(s.content,t-1,1),t-1,d<0?s.openEnd:t-1):new M_(HT(s.content,t,l),s.openStart,s.openEnd)}mustMoveInline(){if(!this.$to.parent.isTextblock)return-1;let t,e=this.frontier[this.depth];if(!e.type.isTextblock||!qT(this.$to,this.$to.depth,e.type,e.match,!1)||this.$to.depth==this.depth&&(t=this.findCloseLevel(this.$to))&&t.depth==this.depth)return-1;let{depth:n}=this.$to,r=this.$to.after(n);for(;n>1&&r==this.$to.end(--n);)++r;return r}findCloseLevel(t){t:for(let e=Math.min(this.depth,t.depth);e>=0;e--){let{match:n,type:r}=this.frontier[e],i=e<t.depth&&t.end(e+1)==t.pos+(t.depth-(e+1)),s=qT(t,e,r,n,i);if(s){for(let n=e-1;n>=0;n--){let{match:e,type:r}=this.frontier[n],i=qT(t,n,r,e,!0);if(!i||i.childCount)continue t}return{depth:e,fit:s,move:i?t.doc.resolve(t.after(e+1)):t}}}}close(t){let e=this.findCloseLevel(t);if(!e)return null;for(;this.depth>e.depth;)this.closeFrontierNode();e.fit.childCount&&(this.placed=$T(this.placed,e.depth,e.fit)),t=e.move;for(let n=e.depth+1;n<=t.depth;n++){let e=t.node(n),r=e.type.contentMatch.fillBefore(e.content,!0,t.index(n));this.openFrontierNode(e.type,e.attrs,r)}return t}openFrontierNode(t,e=null,n){let r=this.frontier[this.depth];r.match=r.match.matchType(t),this.placed=$T(this.placed,this.depth,S_.from(t.create(e,n))),this.frontier.push({type:t,match:t.contentMatch})}closeFrontierNode(){let t=this.frontier.pop().match.fillBefore(S_.empty,!0);t.childCount&&(this.placed=$T(this.placed,this.frontier.length,t))}}function HT(t,e,n){return 0==e?t.cutByIndex(n,t.childCount):t.replaceChild(0,t.firstChild.copy(HT(t.firstChild.content,e-1,n)))}function $T(t,e,n){return 0==e?t.append(n):t.replaceChild(t.childCount-1,t.lastChild.copy($T(t.lastChild.content,e-1,n)))}function YT(t,e){for(let n=0;n<e;n++)t=t.firstChild.content;return t}function XT(t,e,n){if(e<=0)return t;let r=t.content;return e>1&&(r=r.replaceChild(0,XT(r.firstChild,e-1,1==r.childCount?n-1:0))),e>0&&(r=t.type.contentMatch.fillBefore(r).append(r),n<=0&&(r=r.append(t.type.contentMatch.matchFragment(r).fillBefore(S_.empty,!0)))),t.copy(r)}function qT(t,e,n,r,i){let s=t.node(e),o=i?t.indexAfter(e):t.index(e);if(o==s.childCount&&!n.compatibleContent(s.type))return null;let a=r.fillBefore(s.content,!0,o);return a&&!function(t,e,n){for(let r=n;r<e.childCount;r++)if(!t.allowsMarks(e.child(r).marks))return!0;return!1}(n,s.content,o)?a:null}function KT(t,e,n,r,i){if(e<n){let i=t.firstChild;t=t.replaceChild(0,i.copy(KT(i.content,e+1,n,r,i)))}if(e>r){let e=i.contentMatchAt(0),n=e.fillBefore(t).append(t);t=n.append(e.matchFragment(n).fillBefore(S_.empty,!0))}return t}function ZT(t,e){let n=[];for(let r=Math.min(t.depth,e.depth);r>=0;r--){let i=t.start(r);if(i<t.pos-(t.depth-r)||e.end(r)>e.pos+(e.depth-r)||t.node(r).type.spec.isolating||e.node(r).type.spec.isolating)break;(i==e.start(r)||r==t.depth&&r==e.depth&&t.parent.inlineContent&&e.parent.inlineContent&&r&&e.start(r-1)==i-1)&&n.push(r)}return n}class JT extends TT{constructor(t,e,n){super(),this.pos=t,this.attr=e,this.value=n}apply(t){let e=t.nodeAt(this.pos);if(!e)return kT.fail("No node at attribute step's position");let n=Object.create(null);for(let i in e.attrs)n[i]=e.attrs[i];n[this.attr]=this.value;let r=e.type.create(n,null,e.marks);return kT.fromReplace(t,this.pos,this.pos+1,new M_(S_.from(r),0,e.isLeaf?0:1))}getMap(){return ET.empty}invert(t){return new JT(this.pos,this.attr,t.nodeAt(this.pos).attrs[this.attr])}map(t){let e=t.mapResult(this.pos,1);return e.deletedAfter?null:new JT(e.pos,this.attr,this.value)}toJSON(){return{stepType:"attr",pos:this.pos,attr:this.attr,value:this.value}}static fromJSON(t,e){if("number"!=typeof e.pos||"string"!=typeof e.attr)throw new RangeError("Invalid input for AttrStep.fromJSON");return new JT(e.pos,e.attr,e.value)}}TT.jsonID("attr",JT);class QT extends TT{constructor(t,e){super(),this.attr=t,this.value=e}apply(t){let e=Object.create(null);for(let r in t.attrs)e[r]=t.attrs[r];e[this.attr]=this.value;let n=t.type.create(e,t.content,t.marks);return kT.ok(n)}getMap(){return ET.empty}invert(t){return new QT(this.attr,t.attrs[this.attr])}map(t){return this}toJSON(){return{stepType:"docAttr",attr:this.attr,value:this.value}}static fromJSON(t,e){if("string"!=typeof e.attr)throw new RangeError("Invalid input for DocAttrStep.fromJSON");return new QT(e.attr,e.value)}}TT.jsonID("docAttr",QT);let tk=class extends Error{};tk=function t(e){let n=Error.call(this,e);return n.__proto__=t.prototype,n},(tk.prototype=Object.create(Error.prototype)).constructor=tk,tk.prototype.name="TransformError";let ek=class{constructor(t){this.doc=t,this.steps=[],this.docs=[],this.mapping=new _T}get before(){return this.docs.length?this.docs[0]:this.doc}step(t){let e=this.maybeStep(t);if(e.failed)throw new tk(e.failed);return this}maybeStep(t){let e=t.apply(this.doc);return e.failed||this.addStep(t,e.doc),e}get docChanged(){return this.steps.length>0}addStep(t,e){this.docs.push(this.doc),this.steps.push(t),this.mapping.appendMap(t.getMap()),this.doc=e}replace(t,e=t,n=M_.empty){let r=zT(this.doc,t,e,n);return r&&this.step(r),this}replaceWith(t,e,n){return this.replace(t,e,new M_(S_.from(n),0,0))}delete(t,e){return this.replace(t,e,M_.empty)}insert(t,e){return this.replaceWith(t,t,e)}replaceRange(t,e,n){return function(t,e,n,r){if(!r.size)return t.deleteRange(e,n);let i=t.doc.resolve(e),s=t.doc.resolve(n);if(GT(i,s,r))return t.step(new DT(e,n,r));let o=ZT(i,t.doc.resolve(n));0==o[o.length-1]&&o.pop();let a=-(i.depth+1);o.unshift(a);for(let f=i.depth,p=i.pos-1;f>0;f--,p--){let t=i.node(f).type.spec;if(t.defining||t.definingAsContext||t.isolating)break;o.indexOf(f)>-1?a=f:i.before(f)==p&&o.splice(1,0,-f)}let l=o.indexOf(a),c=[],h=r.openStart;for(let f=r.content,p=0;;p++){let t=f.firstChild;if(c.push(t),p==r.openStart)break;f=t.content}for(let f=h-1;f>=0;f--){let t=c[f],e=(u=t.type).spec.defining||u.spec.definingForContent;if(e&&!t.sameMarkup(i.node(Math.abs(a)-1)))h=f;else if(e||!t.type.isTextblock)break}var u;for(let f=r.openStart;f>=0;f--){let e=(f+h+1)%(r.openStart+1),a=c[e];if(a)for(let c=0;c<o.length;c++){let h=o[(c+l)%o.length],u=!0;h<0&&(u=!1,h=-h);let d=i.node(h-1),f=i.index(h-1);if(d.canReplaceWith(f,f,a.type,a.marks))return t.replace(i.before(h),u?s.after(h):n,new M_(KT(r.content,0,r.openStart,e),e,r.openEnd))}}let d=t.steps.length;for(let f=o.length-1;f>=0&&(t.replace(e,n,r),!(t.steps.length>d));f--){let t=o[f];t<0||(e=i.before(t),n=s.after(t))}}(this,t,e,n),this}replaceRangeWith(t,e,n){return function(t,e,n,r){if(!r.isInline&&e==n&&t.doc.resolve(e).parent.content.size){let i=function(t,e,n){let r=t.resolve(e);if(r.parent.canReplaceWith(r.index(),r.index(),n))return e;if(0==r.parentOffset)for(let i=r.depth-1;i>=0;i--){let t=r.index(i);if(r.node(i).canReplaceWith(t,t,n))return r.before(i+1);if(t>0)return null}if(r.parentOffset==r.parent.content.size)for(let i=r.depth-1;i>=0;i--){let t=r.indexAfter(i);if(r.node(i).canReplaceWith(t,t,n))return r.after(i+1);if(t<r.node(i).childCount)return null}return null}(t.doc,e,r.type);null!=i&&(e=n=i)}t.replaceRange(e,n,new M_(S_.from(r),0,0))}(this,t,e,n),this}deleteRange(t,e){return function(t,e,n){let r=t.doc.resolve(e),i=t.doc.resolve(n),s=ZT(r,i);for(let o=0;o<s.length;o++){let e=s[o],n=o==s.length-1;if(n&&0==e||r.node(e).type.contentMatch.validEnd)return t.delete(r.start(e),i.end(e));if(e>0&&(n||r.node(e-1).canReplace(r.index(e-1),i.indexAfter(e-1))))return t.delete(r.before(e),i.after(e))}for(let o=1;o<=r.depth&&o<=i.depth;o++)if(e-r.start(o)==r.depth-o&&n>r.end(o)&&i.end(o)-n!=i.depth-o)return t.delete(r.before(o),n);t.delete(e,n)}(this,t,e),this}lift(t,e){return function(t,e,n){let{$from:r,$to:i,depth:s}=e,o=r.before(s+1),a=i.after(s+1),l=o,c=a,h=S_.empty,u=0;for(let p=s,m=!1;p>n;p--)m||r.index(p)>0?(m=!0,h=S_.from(r.node(p).copy(h)),u++):l--;let d=S_.empty,f=0;for(let p=s,m=!1;p>n;p--)m||i.after(p+1)<i.end(p)?(m=!0,d=S_.from(i.node(p).copy(d)),f++):c++;t.step(new OT(l,c,o,a,new M_(h.append(d),u,f),h.size-u,!0))}(this,t,e),this}join(t,e=1){return function(t,e,n){let r=new DT(e-n,e+n,M_.empty,!0);t.step(r)}(this,t,e),this}wrap(t,e){return function(t,e,n){let r=S_.empty;for(let o=n.length-1;o>=0;o--){if(r.size){let t=n[o].type.contentMatch.matchFragment(r);if(!t||!t.validEnd)throw new RangeError("Wrapper type given to Transform.wrap does not form valid content of its parent wrapper")}r=S_.from(n[o].type.create(n[o].attrs,r))}let i=e.start,s=e.end;t.step(new OT(i,s,i,s,new M_(r,0,0),n.length,!0))}(this,t,e),this}setBlockType(t,e=t,n,r=null){return function(t,e,n,r,i){if(!r.isTextblock)throw new RangeError("Type given to setBlockType should be a textblock");let s=t.steps.length;t.doc.nodesBetween(e,n,((e,n)=>{if(e.isTextblock&&!e.hasMarkup(r,i)&&function(t,e,n){let r=t.resolve(e),i=r.index();return r.parent.canReplaceWith(i,i+1,n)}(t.doc,t.mapping.slice(s).map(n),r)){t.clearIncompatible(t.mapping.slice(s).map(n,1),r);let o=t.mapping.slice(s),a=o.map(n,1),l=o.map(n+e.nodeSize,1);return t.step(new OT(a,l,a+1,l-1,new M_(S_.from(r.create(i,null,e.marks)),0,0),1,!0)),!1}}))}(this,t,e,n,r),this}setNodeMarkup(t,e,n=null,r){return function(t,e,n,r,i){let s=t.doc.nodeAt(e);if(!s)throw new RangeError("No node at given position");n||(n=s.type);let o=n.create(r,null,i||s.marks);if(s.isLeaf)return t.replaceWith(e,e+s.nodeSize,o);if(!n.validContent(s.content))throw new RangeError("Invalid content for node type "+n.name);t.step(new OT(e,e+s.nodeSize,e+1,e+s.nodeSize-1,new M_(S_.from(o),0,0),1,!0))}(this,t,e,n,r),this}setNodeAttribute(t,e,n){return this.step(new JT(t,e,n)),this}setDocAttribute(t,e){return this.step(new QT(t,e)),this}addNodeMark(t,e){return this.step(new MT(t,e)),this}removeNodeMark(t,e){if(!(e instanceof C_)){let n=this.doc.nodeAt(t);if(!n)throw new RangeError("No node at position "+t);if(!(e=e.isInSet(n.marks)))return this}return this.step(new IT(t,e)),this}split(t,e=1,n){return function(t,e,n=1,r){let i=t.doc.resolve(e),s=S_.empty,o=S_.empty;for(let a=i.depth,l=i.depth-n,c=n-1;a>l;a--,c--){s=S_.from(i.node(a).copy(s));let t=r&&r[c];o=S_.from(t?t.type.create(t.attrs,o):i.node(a).copy(o))}t.step(new DT(e,e,new M_(s.append(o),n,n),!0))}(this,t,e,n),this}addMark(t,e,n){return function(t,e,n,r){let i,s,o=[],a=[];t.doc.nodesBetween(e,n,((t,l,c)=>{if(!t.isInline)return;let h=t.marks;if(!r.isInSet(h)&&c.type.allowsMarkType(r.type)){let c=Math.max(l,e),u=Math.min(l+t.nodeSize,n),d=r.addToSet(h);for(let t=0;t<h.length;t++)h[t].isInSet(d)||(i&&i.to==c&&i.mark.eq(h[t])?i.to=u:o.push(i=new RT(c,u,h[t])));s&&s.to==c?s.to=u:a.push(s=new CT(c,u,r))}})),o.forEach((e=>t.step(e))),a.forEach((e=>t.step(e)))}(this,t,e,n),this}removeMark(t,e,n){return function(t,e,n,r){let i=[],s=0;t.doc.nodesBetween(e,n,((t,o)=>{if(!t.isInline)return;s++;let a=null;if(r instanceof uS){let e,n=t.marks;for(;e=r.isInSet(n);)(a||(a=[])).push(e),n=e.removeFromSet(n)}else r?r.isInSet(t.marks)&&(a=[r]):a=t.marks;if(a&&a.length){let r=Math.min(o+t.nodeSize,n);for(let t=0;t<a.length;t++){let n,l=a[t];for(let t=0;t<i.length;t++){let e=i[t];e.step==s-1&&l.eq(i[t].style)&&(n=e)}n?(n.to=r,n.step=s):i.push({style:l,from:Math.max(o,e),to:r,step:s})}}})),i.forEach((e=>t.step(new RT(e.from,e.to,e.style))))}(this,t,e,n),this}clearIncompatible(t,e,n){return function(t,e,n,r=n.contentMatch){let i=t.doc.nodeAt(e),s=[],o=e+1;for(let a=0;a<i.childCount;a++){let e=i.child(a),l=o+e.nodeSize,c=r.matchType(e.type);if(c){r=c;for(let r=0;r<e.marks.length;r++)n.allowsMarkType(e.marks[r].type)||t.step(new RT(o,l,e.marks[r]));if(e.isText&&!n.spec.code){let t,r,i=/\r?\n|\r/g;for(;t=i.exec(e.text);)r||(r=new M_(S_.from(n.schema.text(" ",n.allowedMarks(e.marks))),0,0)),s.push(new DT(o+t.index,o+t.index+t[0].length,r))}}else s.push(new DT(o,l,M_.empty));o=l}if(!r.validEnd){let e=r.fillBefore(S_.empty,!0);t.replace(o,o,new M_(e,0,0))}for(let a=s.length-1;a>=0;a--)t.step(s[a])}(this,t,e,n),this}};const nk=Object.create(null);class rk{constructor(t,e,n){this.$anchor=t,this.$head=e,this.ranges=n||[new ik(t.min(e),t.max(e))]}get anchor(){return this.$anchor.pos}get head(){return this.$head.pos}get from(){return this.$from.pos}get to(){return this.$to.pos}get $from(){return this.ranges[0].$from}get $to(){return this.ranges[0].$to}get empty(){let t=this.ranges;for(let e=0;e<t.length;e++)if(t[e].$from.pos!=t[e].$to.pos)return!1;return!0}content(){return this.$from.doc.slice(this.from,this.to,!0)}replace(t,e=M_.empty){let n=e.content.lastChild,r=null;for(let o=0;o<e.openEnd;o++)r=n,n=n.lastChild;let i=t.steps.length,s=this.ranges;for(let o=0;o<s.length;o++){let{$from:a,$to:l}=s[o],c=t.mapping.slice(i);t.replaceRange(c.map(a.pos),c.map(l.pos),o?M_.empty:e),0==o&&pk(t,i,(n?n.isInline:r&&r.isTextblock)?-1:1)}}replaceWith(t,e){let n=t.steps.length,r=this.ranges;for(let i=0;i<r.length;i++){let{$from:s,$to:o}=r[i],a=t.mapping.slice(n),l=a.map(s.pos),c=a.map(o.pos);i?t.deleteRange(l,c):(t.replaceRangeWith(l,c,e),pk(t,n,e.isInline?-1:1))}}static findFrom(t,e,n=!1){let r=t.parent.inlineContent?new ak(t):fk(t.node(0),t.parent,t.pos,t.index(),e,n);if(r)return r;for(let i=t.depth-1;i>=0;i--){let r=e<0?fk(t.node(0),t.node(i),t.before(i+1),t.index(i),e,n):fk(t.node(0),t.node(i),t.after(i+1),t.index(i)+1,e,n);if(r)return r}return null}static near(t,e=1){return this.findFrom(t,e)||this.findFrom(t,-e)||new uk(t.node(0))}static atStart(t){return fk(t,t,0,0,1)||new uk(t)}static atEnd(t){return fk(t,t,t.content.size,t.childCount,-1)||new uk(t)}static fromJSON(t,e){if(!e||!e.type)throw new RangeError("Invalid input for Selection.fromJSON");let n=nk[e.type];if(!n)throw new RangeError(`No selection type ${e.type} defined`);return n.fromJSON(t,e)}static jsonID(t,e){if(t in nk)throw new RangeError("Duplicate use of selection JSON ID "+t);return nk[t]=e,e.prototype.jsonID=t,e}getBookmark(){return ak.between(this.$anchor,this.$head).getBookmark()}}rk.prototype.visible=!0;class ik{constructor(t,e){this.$from=t,this.$to=e}}let sk=!1;function ok(t){sk||t.parent.inlineContent||(sk=!0)}class ak extends rk{constructor(t,e=t){ok(t),ok(e),super(t,e)}get $cursor(){return this.$anchor.pos==this.$head.pos?this.$head:null}map(t,e){let n=t.resolve(e.map(this.head));if(!n.parent.inlineContent)return rk.near(n);let r=t.resolve(e.map(this.anchor));return new ak(r.parent.inlineContent?r:n,n)}replace(t,e=M_.empty){if(super.replace(t,e),e==M_.empty){let e=this.$from.marksAcross(this.$to);e&&t.ensureMarks(e)}}eq(t){return t instanceof ak&&t.anchor==this.anchor&&t.head==this.head}getBookmark(){return new lk(this.anchor,this.head)}toJSON(){return{type:"text",anchor:this.anchor,head:this.head}}static fromJSON(t,e){if("number"!=typeof e.anchor||"number"!=typeof e.head)throw new RangeError("Invalid input for TextSelection.fromJSON");return new ak(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){let r=t.resolve(e);return new this(r,n==e?r:t.resolve(n))}static between(t,e,n){let r=t.pos-e.pos;if(n&&!r||(n=r>=0?1:-1),!e.parent.inlineContent){let t=rk.findFrom(e,n,!0)||rk.findFrom(e,-n,!0);if(!t)return rk.near(e,n);e=t.$head}return t.parent.inlineContent||(0==r||(t=(rk.findFrom(t,-n,!0)||rk.findFrom(t,n,!0)).$anchor).pos<e.pos!=r<0)&&(t=e),new ak(t,e)}}rk.jsonID("text",ak);class lk{constructor(t,e){this.anchor=t,this.head=e}map(t){return new lk(t.map(this.anchor),t.map(this.head))}resolve(t){return ak.between(t.resolve(this.anchor),t.resolve(this.head))}}class ck extends rk{constructor(t){let e=t.nodeAfter,n=t.node(0).resolve(t.pos+e.nodeSize);super(t,n),this.node=e}map(t,e){let{deleted:n,pos:r}=e.mapResult(this.anchor),i=t.resolve(r);return n?rk.near(i):new ck(i)}content(){return new M_(S_.from(this.node),0,0)}eq(t){return t instanceof ck&&t.anchor==this.anchor}toJSON(){return{type:"node",anchor:this.anchor}}getBookmark(){return new hk(this.anchor)}static fromJSON(t,e){if("number"!=typeof e.anchor)throw new RangeError("Invalid input for NodeSelection.fromJSON");return new ck(t.resolve(e.anchor))}static create(t,e){return new ck(t.resolve(e))}static isSelectable(t){return!t.isText&&!1!==t.type.spec.selectable}}ck.prototype.visible=!1,rk.jsonID("node",ck);class hk{constructor(t){this.anchor=t}map(t){let{deleted:e,pos:n}=t.mapResult(this.anchor);return e?new lk(n,n):new hk(n)}resolve(t){let e=t.resolve(this.anchor),n=e.nodeAfter;return n&&ck.isSelectable(n)?new ck(e):rk.near(e)}}class uk extends rk{constructor(t){super(t.resolve(0),t.resolve(t.content.size))}replace(t,e=M_.empty){if(e==M_.empty){t.delete(0,t.doc.content.size);let e=rk.atStart(t.doc);e.eq(t.selection)||t.setSelection(e)}else super.replace(t,e)}toJSON(){return{type:"all"}}static fromJSON(t){return new uk(t)}map(t){return new uk(t)}eq(t){return t instanceof uk}getBookmark(){return dk}}rk.jsonID("all",uk);const dk={map(){return this},resolve:t=>new uk(t)};function fk(t,e,n,r,i,s=!1){if(e.inlineContent)return ak.create(t,n);for(let o=r-(i>0?0:1);i>0?o<e.childCount:o>=0;o+=i){let r=e.child(o);if(r.isAtom){if(!s&&ck.isSelectable(r))return ck.create(t,n-(i<0?r.nodeSize:0))}else{let e=fk(t,r,n+i,i<0?r.childCount:0,i,s);if(e)return e}n+=r.nodeSize*i}return null}function pk(t,e,n){let r=t.steps.length-1;if(r<e)return;let i,s=t.steps[r];(s instanceof DT||s instanceof OT)&&(t.mapping.maps[r].forEach(((t,e,n,r)=>{null==i&&(i=r)})),t.setSelection(rk.near(t.doc.resolve(i),n)))}class mk extends ek{constructor(t){super(t.doc),this.curSelectionFor=0,this.updated=0,this.meta=Object.create(null),this.time=Date.now(),this.curSelection=t.selection,this.storedMarks=t.storedMarks}get selection(){return this.curSelectionFor<this.steps.length&&(this.curSelection=this.curSelection.map(this.doc,this.mapping.slice(this.curSelectionFor)),this.curSelectionFor=this.steps.length),this.curSelection}setSelection(t){if(t.$from.doc!=this.doc)throw new RangeError("Selection passed to setSelection must point at the current document");return this.curSelection=t,this.curSelectionFor=this.steps.length,this.updated=-3&(1|this.updated),this.storedMarks=null,this}get selectionSet(){return(1&this.updated)>0}setStoredMarks(t){return this.storedMarks=t,this.updated|=2,this}ensureMarks(t){return C_.sameSet(this.storedMarks||this.selection.$from.marks(),t)||this.setStoredMarks(t),this}addStoredMark(t){return this.ensureMarks(t.addToSet(this.storedMarks||this.selection.$head.marks()))}removeStoredMark(t){return this.ensureMarks(t.removeFromSet(this.storedMarks||this.selection.$head.marks()))}get storedMarksSet(){return(2&this.updated)>0}addStep(t,e){super.addStep(t,e),this.updated=-3&this.updated,this.storedMarks=null}setTime(t){return this.time=t,this}replaceSelection(t){return this.selection.replace(this,t),this}replaceSelectionWith(t,e=!0){let n=this.selection;return e&&(t=t.mark(this.storedMarks||(n.empty?n.$from.marks():n.$from.marksAcross(n.$to)||C_.none))),n.replaceWith(this,t),this}deleteSelection(){return this.selection.replace(this),this}insertText(t,e,n){let r=this.doc.type.schema;if(null==e)return t?this.replaceSelectionWith(r.text(t),!0):this.deleteSelection();{if(null==n&&(n=e),n=null==n?e:n,!t)return this.deleteRange(e,n);let i=this.storedMarks;if(!i){let t=this.doc.resolve(e);i=n==e?t.marks():t.marksAcross(this.doc.resolve(n))}return this.replaceRangeWith(e,n,r.text(t,i)),this.selection.empty||this.setSelection(rk.near(this.selection.$to)),this}}setMeta(t,e){return this.meta["string"==typeof t?t:t.key]=e,this}getMeta(t){return this.meta["string"==typeof t?t:t.key]}get isGeneric(){for(let t in this.meta)return!1;return!0}scrollIntoView(){return this.updated|=4,this}get scrolledIntoView(){return(4&this.updated)>0}}function gk(t,e){return e&&t?t.bind(e):t}class vk{constructor(t,e,n){this.name=t,this.init=gk(e.init,n),this.apply=gk(e.apply,n)}}const yk=[new vk("doc",{init:t=>t.doc||t.schema.topNodeType.createAndFill(),apply:t=>t.doc}),new vk("selection",{init:(t,e)=>t.selection||rk.atStart(e.doc),apply:t=>t.selection}),new vk("storedMarks",{init:t=>t.storedMarks||null,apply:(t,e,n,r)=>r.selection.$cursor?t.storedMarks:null}),new vk("scrollToSelection",{init:()=>0,apply:(t,e)=>t.scrolledIntoView?e+1:e})];class bk{constructor(t,e){this.schema=t,this.plugins=[],this.pluginsByKey=Object.create(null),this.fields=yk.slice(),e&&e.forEach((t=>{if(this.pluginsByKey[t.key])throw new RangeError("Adding different instances of a keyed plugin ("+t.key+")");this.plugins.push(t),this.pluginsByKey[t.key]=t,t.spec.state&&this.fields.push(new vk(t.key,t.spec.state,t))}))}}class xk{constructor(t){this.config=t}get schema(){return this.config.schema}get plugins(){return this.config.plugins}apply(t){return this.applyTransaction(t).state}filterTransaction(t,e=-1){for(let n=0;n<this.config.plugins.length;n++)if(n!=e){let e=this.config.plugins[n];if(e.spec.filterTransaction&&!e.spec.filterTransaction.call(e,t,this))return!1}return!0}applyTransaction(t){if(!this.filterTransaction(t))return{state:this,transactions:[]};let e=[t],n=this.applyInner(t),r=null;for(;;){let i=!1;for(let s=0;s<this.config.plugins.length;s++){let o=this.config.plugins[s];if(o.spec.appendTransaction){let a=r?r[s].n:0,l=r?r[s].state:this,c=a<e.length&&o.spec.appendTransaction.call(o,a?e.slice(a):e,l,n);if(c&&n.filterTransaction(c,s)){if(c.setMeta("appendedTransaction",t),!r){r=[];for(let t=0;t<this.config.plugins.length;t++)r.push(t<s?{state:n,n:e.length}:{state:this,n:0})}e.push(c),n=n.applyInner(c),i=!0}r&&(r[s]={state:n,n:e.length})}}if(!i)return{state:n,transactions:e}}}applyInner(t){if(!t.before.eq(this.doc))throw new RangeError("Applying a mismatched transaction");let e=new xk(this.config),n=this.config.fields;for(let r=0;r<n.length;r++){let i=n[r];e[i.name]=i.apply(t,this[i.name],this,e)}return e}get tr(){return new mk(this)}static create(t){let e=new bk(t.doc?t.doc.type.schema:t.schema,t.plugins),n=new xk(e);for(let r=0;r<e.fields.length;r++)n[e.fields[r].name]=e.fields[r].init(t,n);return n}reconfigure(t){let e=new bk(this.schema,t.plugins),n=e.fields,r=new xk(e);for(let i=0;i<n.length;i++){let e=n[i].name;r[e]=this.hasOwnProperty(e)?this[e]:n[i].init(t,r)}return r}toJSON(t){let e={doc:this.doc.toJSON(),selection:this.selection.toJSON()};if(this.storedMarks&&(e.storedMarks=this.storedMarks.map((t=>t.toJSON()))),t&&"object"==typeof t)for(let n in t){if("doc"==n||"selection"==n)throw new RangeError("The JSON fields `doc` and `selection` are reserved");let r=t[n],i=r.spec.state;i&&i.toJSON&&(e[n]=i.toJSON.call(r,this[r.key]))}return e}static fromJSON(t,e,n){if(!e)throw new RangeError("Invalid input for EditorState.fromJSON");if(!t.schema)throw new RangeError("Required config field 'schema' missing");let r=new bk(t.schema,t.plugins),i=new xk(r);return r.fields.forEach((r=>{if("doc"==r.name)i.doc=X_.fromJSON(t.schema,e.doc);else if("selection"==r.name)i.selection=rk.fromJSON(i.doc,e.selection);else if("storedMarks"==r.name)e.storedMarks&&(i.storedMarks=e.storedMarks.map(t.schema.markFromJSON));else{if(n)for(let s in n){let o=n[s],a=o.spec.state;if(o.key==r.name&&a&&a.fromJSON&&Object.prototype.hasOwnProperty.call(e,s))return void(i[r.name]=a.fromJSON.call(o,t,e[s],i))}i[r.name]=r.init(t,i)}})),i}}function wk(t,e,n){for(let r in t){let i=t[r];i instanceof Function?i=i.bind(e):"handleDOMEvents"==r&&(i=wk(i,e,{})),n[r]=i}return n}class Ek{constructor(t){this.spec=t,this.props={},t.props&&wk(t.props,this,this.props),this.key=t.key?t.key.key:Sk("plugin")}getState(t){return t[this.key]}}const _k=Object.create(null);function Sk(t){return t in _k?t+"$"+ ++_k[t]:(_k[t]=0,t+"$")}class Tk{constructor(t="key"){this.key=Sk(t)}get(t){return t.config.pluginsByKey[this.key]}getState(t){return t[this.key]}}const kk={};function Ak(t,e){const n=e||kk;return Ck(t,"boolean"!=typeof n.includeImageAlt||n.includeImageAlt,"boolean"!=typeof n.includeHtml||n.includeHtml)}function Ck(t,e,n){if(function(t){return Boolean(t&&"object"==typeof t)}(t)){if("value"in t)return"html"!==t.type||n?t.value:"";if(e&&"alt"in t&&t.alt)return t.alt;if("children"in t)return Rk(t.children,e,n)}return Array.isArray(t)?Rk(t,e,n):""}function Rk(t,e,n){const r=[];let i=-1;for(;++i<t.length;)r[i]=Ck(t[i],e,n);return r.join("")}function Mk(t,e,n,r){const i=t.length;let s,o=0;if(e=e<0?-e>i?0:i+e:e>i?i:e,n=n>0?n:0,r.length<1e4)s=Array.from(r),s.unshift(e,n),t.splice(...s);else for(n&&t.splice(e,n);o<r.length;)s=r.slice(o,o+1e4),s.unshift(e,0),t.splice(...s),o+=1e4,e+=1e4}function Ik(t,e){return t.length>0?(Mk(t,t.length,0,e),t):e}const Dk={}.hasOwnProperty;function Ok(t){const e={};let n=-1;for(;++n<t.length;)Pk(e,t[n]);return e}function Pk(t,e){let n;for(n in e){const r=(Dk.call(t,n)?t[n]:void 0)||(t[n]={}),i=e[n];let s;if(i)for(s in i){Dk.call(r,s)||(r[s]=[]);const t=i[s];Lk(r[s],Array.isArray(t)?t:t?[t]:[])}}}function Lk(t,e){let n=-1;const r=[];for(;++n<e.length;)("after"===e[n].add?t:r).push(e[n]);Mk(t,0,0,r)}const Fk=Xk(/[A-Za-z]/),Nk=Xk(/[\dA-Za-z]/),Bk=Xk(/[#-'*+\--9=?A-Z^-~]/);function Uk(t){return null!==t&&(t<32||127===t)}const Vk=Xk(/\d/),jk=Xk(/[\dA-Fa-f]/),zk=Xk(/[!-/:-@[-`{-~]/);function Gk(t){return null!==t&&t<-2}function Wk(t){return null!==t&&(t<0||32===t)}function Hk(t){return-2===t||-1===t||32===t}const $k=Xk(/[!-\/:-@\[-`\{-~\xA1\xA7\xAB\xB6\xB7\xBB\xBF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061D-\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u09FD\u0A76\u0AF0\u0C77\u0C84\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1B7D\u1B7E\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2308-\u230B\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E4F\u2E52-\u2E5D\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA8FC\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/),Yk=Xk(/\s/);function Xk(t){return function(e){return null!==e&&t.test(String.fromCharCode(e))}}function qk(t,e,n,r){const i=r?r-1:Number.POSITIVE_INFINITY;let s=0;return function(r){if(Hk(r))return t.enter(n),o(r);return e(r)};function o(r){return Hk(r)&&s++<i?(t.consume(r),o):(t.exit(n),e(r))}}const Kk={tokenize:function(t){const e=t.attempt(this.parser.constructs.contentInitial,(function(n){if(null===n)return void t.consume(n);return t.enter("lineEnding"),t.consume(n),t.exit("lineEnding"),qk(t,e,"linePrefix")}),(function(e){return t.enter("paragraph"),r(e)}));let n;return e;function r(e){const r=t.enter("chunkText",{contentType:"text",previous:n});return n&&(n.next=r),n=r,i(e)}function i(e){return null===e?(t.exit("chunkText"),t.exit("paragraph"),void t.consume(e)):Gk(e)?(t.consume(e),t.exit("chunkText"),r):(t.consume(e),i)}}};const Zk={tokenize:function(t){const e=this,n=[];let r,i,s,o=0;return a;function a(r){if(o<n.length){const i=n[o];return e.containerState=i[1],t.attempt(i[0].continuation,l,c)(r)}return c(r)}function l(t){if(o++,e.containerState._closeFlow){e.containerState._closeFlow=void 0,r&&y();const n=e.events.length;let i,s=n;for(;s--;)if("exit"===e.events[s][0]&&"chunkFlow"===e.events[s][1].type){i=e.events[s][1].end;break}v(o);let a=n;for(;a<e.events.length;)e.events[a][1].end=Object.assign({},i),a++;return Mk(e.events,s+1,0,e.events.slice(n)),e.events.length=a,c(t)}return a(t)}function c(i){if(o===n.length){if(!r)return d(i);if(r.currentConstruct&&r.currentConstruct.concrete)return p(i);e.interrupt=Boolean(r.currentConstruct&&!r._gfmTableDynamicInterruptHack)}return e.containerState={},t.check(Jk,h,u)(i)}function h(t){return r&&y(),v(o),d(t)}function u(t){return e.parser.lazy[e.now().line]=o!==n.length,s=e.now().offset,p(t)}function d(n){return e.containerState={},t.attempt(Jk,f,p)(n)}function f(t){return o++,n.push([e.currentConstruct,e.containerState]),d(t)}function p(n){return null===n?(r&&y(),v(0),void t.consume(n)):(r=r||e.parser.flow(e.now()),t.enter("chunkFlow",{contentType:"flow",previous:i,_tokenizer:r}),m(n))}function m(n){return null===n?(g(t.exit("chunkFlow"),!0),v(0),void t.consume(n)):Gk(n)?(t.consume(n),g(t.exit("chunkFlow")),o=0,e.interrupt=void 0,a):(t.consume(n),m)}function g(t,n){const a=e.sliceStream(t);if(n&&a.push(null),t.previous=i,i&&(i.next=t),i=t,r.defineSkip(t.start),r.write(a),e.parser.lazy[t.start.line]){let t=r.events.length;for(;t--;)if(r.events[t][1].start.offset<s&&(!r.events[t][1].end||r.events[t][1].end.offset>s))return;const n=e.events.length;let i,a,l=n;for(;l--;)if("exit"===e.events[l][0]&&"chunkFlow"===e.events[l][1].type){if(i){a=e.events[l][1].end;break}i=!0}for(v(o),t=n;t<e.events.length;)e.events[t][1].end=Object.assign({},a),t++;Mk(e.events,l+1,0,e.events.slice(n)),e.events.length=t}}function v(r){let i=n.length;for(;i-- >r;){const r=n[i];e.containerState=r[1],r[0].exit.call(e,t)}n.length=r}function y(){r.write([null]),i=void 0,r=void 0,e.containerState._closeFlow=void 0}}},Jk={tokenize:function(t,e,n){return qk(t,t.attempt(this.parser.constructs.document,e,n),"linePrefix",this.parser.constructs.disable.null.includes("codeIndented")?void 0:4)}};function Qk(t){return null===t||Wk(t)||Yk(t)?1:$k(t)?2:void 0}function tA(t,e,n){const r=[];let i=-1;for(;++i<t.length;){const s=t[i].resolveAll;s&&!r.includes(s)&&(e=s(e,n),r.push(s))}return e}const eA={name:"attention",tokenize:function(t,e){const n=this.parser.constructs.attentionMarkers.null,r=this.previous,i=Qk(r);let s;return function(e){return s=e,t.enter("attentionSequence"),o(e)};function o(a){if(a===s)return t.consume(a),o;const l=t.exit("attentionSequence"),c=Qk(a),h=!c||2===c&&i||n.includes(a),u=!i||2===i&&c||n.includes(r);return l._open=Boolean(42===s?h:h&&(i||!u)),l._close=Boolean(42===s?u:u&&(c||!h)),e(a)}},resolveAll:function(t,e){let n,r,i,s,o,a,l,c,h=-1;for(;++h<t.length;)if("enter"===t[h][0]&&"attentionSequence"===t[h][1].type&&t[h][1]._close)for(n=h;n--;)if("exit"===t[n][0]&&"attentionSequence"===t[n][1].type&&t[n][1]._open&&e.sliceSerialize(t[n][1]).charCodeAt(0)===e.sliceSerialize(t[h][1]).charCodeAt(0)){if((t[n][1]._close||t[h][1]._open)&&(t[h][1].end.offset-t[h][1].start.offset)%3&&!((t[n][1].end.offset-t[n][1].start.offset+t[h][1].end.offset-t[h][1].start.offset)%3))continue;a=t[n][1].end.offset-t[n][1].start.offset>1&&t[h][1].end.offset-t[h][1].start.offset>1?2:1;const u=Object.assign({},t[n][1].end),d=Object.assign({},t[h][1].start);nA(u,-a),nA(d,a),s={type:a>1?"strongSequence":"emphasisSequence",start:u,end:Object.assign({},t[n][1].end)},o={type:a>1?"strongSequence":"emphasisSequence",start:Object.assign({},t[h][1].start),end:d},i={type:a>1?"strongText":"emphasisText",start:Object.assign({},t[n][1].end),end:Object.assign({},t[h][1].start)},r={type:a>1?"strong":"emphasis",start:Object.assign({},s.start),end:Object.assign({},o.end)},t[n][1].end=Object.assign({},s.start),t[h][1].start=Object.assign({},o.end),l=[],t[n][1].end.offset-t[n][1].start.offset&&(l=Ik(l,[["enter",t[n][1],e],["exit",t[n][1],e]])),l=Ik(l,[["enter",r,e],["enter",s,e],["exit",s,e],["enter",i,e]]),l=Ik(l,tA(e.parser.constructs.insideSpan.null,t.slice(n+1,h),e)),l=Ik(l,[["exit",i,e],["enter",o,e],["exit",o,e],["exit",r,e]]),t[h][1].end.offset-t[h][1].start.offset?(c=2,l=Ik(l,[["enter",t[h][1],e],["exit",t[h][1],e]])):c=0,Mk(t,n-1,h-n+3,l),h=n+l.length-c-2;break}h=-1;for(;++h<t.length;)"attentionSequence"===t[h][1].type&&(t[h][1].type="data");return t}};function nA(t,e){t.column+=e,t.offset+=e,t._bufferIndex+=e}const rA={name:"autolink",tokenize:function(t,e,n){let r=0;return function(e){return t.enter("autolink"),t.enter("autolinkMarker"),t.consume(e),t.exit("autolinkMarker"),t.enter("autolinkProtocol"),i};function i(e){return Fk(e)?(t.consume(e),s):l(e)}function s(t){return 43===t||45===t||46===t||Nk(t)?(r=1,o(t)):l(t)}function o(e){return 58===e?(t.consume(e),r=0,a):(43===e||45===e||46===e||Nk(e))&&r++<32?(t.consume(e),o):(r=0,l(e))}function a(r){return 62===r?(t.exit("autolinkProtocol"),t.enter("autolinkMarker"),t.consume(r),t.exit("autolinkMarker"),t.exit("autolink"),e):null===r||32===r||60===r||Uk(r)?n(r):(t.consume(r),a)}function l(e){return 64===e?(t.consume(e),c):Bk(e)?(t.consume(e),l):n(e)}function c(t){return Nk(t)?h(t):n(t)}function h(n){return 46===n?(t.consume(n),r=0,c):62===n?(t.exit("autolinkProtocol").type="autolinkEmail",t.enter("autolinkMarker"),t.consume(n),t.exit("autolinkMarker"),t.exit("autolink"),e):u(n)}function u(e){if((45===e||Nk(e))&&r++<63){const n=45===e?u:h;return t.consume(e),n}return n(e)}}};const iA={tokenize:function(t,e,n){return function(e){return Hk(e)?qk(t,r,"linePrefix")(e):r(e)};function r(t){return null===t||Gk(t)?e(t):n(t)}},partial:!0};const sA={name:"blockQuote",tokenize:function(t,e,n){const r=this;return function(e){if(62===e){const n=r.containerState;return n.open||(t.enter("blockQuote",{_container:!0}),n.open=!0),t.enter("blockQuotePrefix"),t.enter("blockQuoteMarker"),t.consume(e),t.exit("blockQuoteMarker"),i}return n(e)};function i(n){return Hk(n)?(t.enter("blockQuotePrefixWhitespace"),t.consume(n),t.exit("blockQuotePrefixWhitespace"),t.exit("blockQuotePrefix"),e):(t.exit("blockQuotePrefix"),e(n))}},continuation:{tokenize:function(t,e,n){const r=this;return function(e){if(Hk(e))return qk(t,i,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(e);return i(e)};function i(r){return t.attempt(sA,e,n)(r)}}},exit:function(t){t.exit("blockQuote")}};const oA={name:"characterEscape",tokenize:function(t,e,n){return function(e){return t.enter("characterEscape"),t.enter("escapeMarker"),t.consume(e),t.exit("escapeMarker"),r};function r(r){return zk(r)?(t.enter("characterEscapeValue"),t.consume(r),t.exit("characterEscapeValue"),t.exit("characterEscape"),e):n(r)}}};const aA=document.createElement("i");function lA(t){const e="&"+t+";";aA.innerHTML=e;const n=aA.textContent;return(59!==n.charCodeAt(n.length-1)||"semi"===t)&&(n!==e&&n)}const cA={name:"characterReference",tokenize:function(t,e,n){const r=this;let i,s,o=0;return function(e){return t.enter("characterReference"),t.enter("characterReferenceMarker"),t.consume(e),t.exit("characterReferenceMarker"),a};function a(e){return 35===e?(t.enter("characterReferenceMarkerNumeric"),t.consume(e),t.exit("characterReferenceMarkerNumeric"),l):(t.enter("characterReferenceValue"),i=31,s=Nk,c(e))}function l(e){return 88===e||120===e?(t.enter("characterReferenceMarkerHexadecimal"),t.consume(e),t.exit("characterReferenceMarkerHexadecimal"),t.enter("characterReferenceValue"),i=6,s=jk,c):(t.enter("characterReferenceValue"),i=7,s=Vk,c(e))}function c(a){if(59===a&&o){const i=t.exit("characterReferenceValue");return s!==Nk||lA(r.sliceSerialize(i))?(t.enter("characterReferenceMarker"),t.consume(a),t.exit("characterReferenceMarker"),t.exit("characterReference"),e):n(a)}return s(a)&&o++<i?(t.consume(a),c):n(a)}}};const hA={tokenize:function(t,e,n){const r=this;return function(e){if(null===e)return n(e);return t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),i};function i(t){return r.parser.lazy[r.now().line]?n(t):e(t)}},partial:!0},uA={name:"codeFenced",tokenize:function(t,e,n){const r=this,i={tokenize:function(t,e,n){let i=0;return o;function o(e){return t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),l}function l(e){return t.enter("codeFencedFence"),Hk(e)?qk(t,c,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(e):c(e)}function c(e){return e===s?(t.enter("codeFencedFenceSequence"),h(e)):n(e)}function h(e){return e===s?(i++,t.consume(e),h):i>=a?(t.exit("codeFencedFenceSequence"),Hk(e)?qk(t,u,"whitespace")(e):u(e)):n(e)}function u(r){return null===r||Gk(r)?(t.exit("codeFencedFence"),e(r)):n(r)}},partial:!0};let s,o=0,a=0;return function(e){return function(e){const n=r.events[r.events.length-1];return o=n&&"linePrefix"===n[1].type?n[2].sliceSerialize(n[1],!0).length:0,s=e,t.enter("codeFenced"),t.enter("codeFencedFence"),t.enter("codeFencedFenceSequence"),l(e)}(e)};function l(e){return e===s?(a++,t.consume(e),l):a<3?n(e):(t.exit("codeFencedFenceSequence"),Hk(e)?qk(t,c,"whitespace")(e):c(e))}function c(n){return null===n||Gk(n)?(t.exit("codeFencedFence"),r.interrupt?e(n):t.check(hA,f,y)(n)):(t.enter("codeFencedFenceInfo"),t.enter("chunkString",{contentType:"string"}),h(n))}function h(e){return null===e||Gk(e)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),c(e)):Hk(e)?(t.exit("chunkString"),t.exit("codeFencedFenceInfo"),qk(t,u,"whitespace")(e)):96===e&&e===s?n(e):(t.consume(e),h)}function u(e){return null===e||Gk(e)?c(e):(t.enter("codeFencedFenceMeta"),t.enter("chunkString",{contentType:"string"}),d(e))}function d(e){return null===e||Gk(e)?(t.exit("chunkString"),t.exit("codeFencedFenceMeta"),c(e)):96===e&&e===s?n(e):(t.consume(e),d)}function f(e){return t.attempt(i,y,p)(e)}function p(e){return t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),m}function m(e){return o>0&&Hk(e)?qk(t,g,"linePrefix",o+1)(e):g(e)}function g(e){return null===e||Gk(e)?t.check(hA,f,y)(e):(t.enter("codeFlowValue"),v(e))}function v(e){return null===e||Gk(e)?(t.exit("codeFlowValue"),g(e)):(t.consume(e),v)}function y(n){return t.exit("codeFenced"),e(n)}},concrete:!0};const dA={name:"codeIndented",tokenize:function(t,e,n){const r=this;return function(e){return t.enter("codeIndented"),qk(t,i,"linePrefix",5)(e)};function i(t){const e=r.events[r.events.length-1];return e&&"linePrefix"===e[1].type&&e[2].sliceSerialize(e[1],!0).length>=4?s(t):n(t)}function s(e){return null===e?a(e):Gk(e)?t.attempt(fA,s,a)(e):(t.enter("codeFlowValue"),o(e))}function o(e){return null===e||Gk(e)?(t.exit("codeFlowValue"),s(e)):(t.consume(e),o)}function a(n){return t.exit("codeIndented"),e(n)}}},fA={tokenize:function(t,e,n){const r=this;return i;function i(e){return r.parser.lazy[r.now().line]?n(e):Gk(e)?(t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),i):qk(t,s,"linePrefix",5)(e)}function s(t){const s=r.events[r.events.length-1];return s&&"linePrefix"===s[1].type&&s[2].sliceSerialize(s[1],!0).length>=4?e(t):Gk(t)?i(t):n(t)}},partial:!0};const pA={name:"codeText",tokenize:function(t,e,n){let r,i,s=0;return function(e){return t.enter("codeText"),t.enter("codeTextSequence"),o(e)};function o(e){return 96===e?(t.consume(e),s++,o):(t.exit("codeTextSequence"),a(e))}function a(e){return null===e?n(e):32===e?(t.enter("space"),t.consume(e),t.exit("space"),a):96===e?(i=t.enter("codeTextSequence"),r=0,c(e)):Gk(e)?(t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),a):(t.enter("codeTextData"),l(e))}function l(e){return null===e||32===e||96===e||Gk(e)?(t.exit("codeTextData"),a(e)):(t.consume(e),l)}function c(n){return 96===n?(t.consume(n),r++,c):r===s?(t.exit("codeTextSequence"),t.exit("codeText"),e(n)):(i.type="codeTextData",l(n))}},resolve:function(t){let e,n,r=t.length-4,i=3;if(!("lineEnding"!==t[i][1].type&&"space"!==t[i][1].type||"lineEnding"!==t[r][1].type&&"space"!==t[r][1].type))for(e=i;++e<r;)if("codeTextData"===t[e][1].type){t[i][1].type="codeTextPadding",t[r][1].type="codeTextPadding",i+=2,r-=2;break}e=i-1,r++;for(;++e<=r;)void 0===n?e!==r&&"lineEnding"!==t[e][1].type&&(n=e):e!==r&&"lineEnding"!==t[e][1].type||(t[n][1].type="codeTextData",e!==n+2&&(t[n][1].end=t[e-1][1].end,t.splice(n+2,e-n-2),r-=e-n-2,e=n+2),n=void 0);return t},previous:function(t){return 96!==t||"characterEscape"===this.events[this.events.length-1][1].type}};function mA(t){const e={};let n,r,i,s,o,a,l,c=-1;for(;++c<t.length;){for(;c in e;)c=e[c];if(n=t[c],c&&"chunkFlow"===n[1].type&&"listItemPrefix"===t[c-1][1].type&&(a=n[1]._tokenizer.events,i=0,i<a.length&&"lineEndingBlank"===a[i][1].type&&(i+=2),i<a.length&&"content"===a[i][1].type))for(;++i<a.length&&"content"!==a[i][1].type;)"chunkText"===a[i][1].type&&(a[i][1]._isInFirstContentOfListItem=!0,i++);if("enter"===n[0])n[1].contentType&&(Object.assign(e,gA(t,c)),c=e[c],l=!0);else if(n[1]._container){for(i=c,r=void 0;i--&&(s=t[i],"lineEnding"===s[1].type||"lineEndingBlank"===s[1].type);)"enter"===s[0]&&(r&&(t[r][1].type="lineEndingBlank"),s[1].type="lineEnding",r=i);r&&(n[1].end=Object.assign({},t[r][1].start),o=t.slice(r,c),o.unshift(n),Mk(t,r,c-r+1,o))}}return!l}function gA(t,e){const n=t[e][1],r=t[e][2];let i=e-1;const s=[],o=n._tokenizer||r.parser[n.contentType](n.start),a=o.events,l=[],c={};let h,u,d=-1,f=n,p=0,m=0;const g=[m];for(;f;){for(;t[++i][1]!==f;);s.push(i),f._tokenizer||(h=r.sliceStream(f),f.next||h.push(null),u&&o.defineSkip(f.start),f._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=!0),o.write(h),f._isInFirstContentOfListItem&&(o._gfmTasklistFirstContentOfListItem=void 0)),u=f,f=f.next}for(f=n;++d<a.length;)"exit"===a[d][0]&&"enter"===a[d-1][0]&&a[d][1].type===a[d-1][1].type&&a[d][1].start.line!==a[d][1].end.line&&(m=d+1,g.push(m),f._tokenizer=void 0,f.previous=void 0,f=f.next);for(o.events=[],f?(f._tokenizer=void 0,f.previous=void 0):g.pop(),d=g.length;d--;){const e=a.slice(g[d],g[d+1]),n=s.pop();l.unshift([n,n+e.length-1]),Mk(t,n,2,e)}for(d=-1;++d<l.length;)c[p+l[d][0]]=p+l[d][1],p+=l[d][1]-l[d][0]-1;return c}const vA={tokenize:function(t,e){let n;return function(e){return t.enter("content"),n=t.enter("chunkContent",{contentType:"content"}),r(e)};function r(e){return null===e?i(e):Gk(e)?t.check(yA,s,i)(e):(t.consume(e),r)}function i(n){return t.exit("chunkContent"),t.exit("content"),e(n)}function s(e){return t.consume(e),t.exit("chunkContent"),n.next=t.enter("chunkContent",{contentType:"content",previous:n}),n=n.next,r}},resolve:function(t){return mA(t),t}},yA={tokenize:function(t,e,n){const r=this;return function(e){return t.exit("chunkContent"),t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),qk(t,i,"linePrefix")};function i(i){if(null===i||Gk(i))return n(i);const s=r.events[r.events.length-1];return!r.parser.constructs.disable.null.includes("codeIndented")&&s&&"linePrefix"===s[1].type&&s[2].sliceSerialize(s[1],!0).length>=4?e(i):t.interrupt(r.parser.constructs.flow,n,e)(i)}},partial:!0};function bA(t,e,n,r,i,s,o,a,l){const c=l||Number.POSITIVE_INFINITY;let h=0;return function(e){if(60===e)return t.enter(r),t.enter(i),t.enter(s),t.consume(e),t.exit(s),u;if(null===e||32===e||41===e||Uk(e))return n(e);return t.enter(r),t.enter(o),t.enter(a),t.enter("chunkString",{contentType:"string"}),p(e)};function u(n){return 62===n?(t.enter(s),t.consume(n),t.exit(s),t.exit(i),t.exit(r),e):(t.enter(a),t.enter("chunkString",{contentType:"string"}),d(n))}function d(e){return 62===e?(t.exit("chunkString"),t.exit(a),u(e)):null===e||60===e||Gk(e)?n(e):(t.consume(e),92===e?f:d)}function f(e){return 60===e||62===e||92===e?(t.consume(e),d):d(e)}function p(i){return h||null!==i&&41!==i&&!Wk(i)?h<c&&40===i?(t.consume(i),h++,p):41===i?(t.consume(i),h--,p):null===i||32===i||40===i||Uk(i)?n(i):(t.consume(i),92===i?m:p):(t.exit("chunkString"),t.exit(a),t.exit(o),t.exit(r),e(i))}function m(e){return 40===e||41===e||92===e?(t.consume(e),p):p(e)}}function xA(t,e,n,r,i,s){const o=this;let a,l=0;return function(e){return t.enter(r),t.enter(i),t.consume(e),t.exit(i),t.enter(s),c};function c(u){return l>999||null===u||91===u||93===u&&!a||94===u&&!l&&"_hiddenFootnoteSupport"in o.parser.constructs?n(u):93===u?(t.exit(s),t.enter(i),t.consume(u),t.exit(i),t.exit(r),e):Gk(u)?(t.enter("lineEnding"),t.consume(u),t.exit("lineEnding"),c):(t.enter("chunkString",{contentType:"string"}),h(u))}function h(e){return null===e||91===e||93===e||Gk(e)||l++>999?(t.exit("chunkString"),c(e)):(t.consume(e),a||(a=!Hk(e)),92===e?u:h)}function u(e){return 91===e||92===e||93===e?(t.consume(e),l++,h):h(e)}}function wA(t,e,n,r,i,s){let o;return function(e){if(34===e||39===e||40===e)return t.enter(r),t.enter(i),t.consume(e),t.exit(i),o=40===e?41:e,a;return n(e)};function a(n){return n===o?(t.enter(i),t.consume(n),t.exit(i),t.exit(r),e):(t.enter(s),l(n))}function l(e){return e===o?(t.exit(s),a(o)):null===e?n(e):Gk(e)?(t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),qk(t,l,"linePrefix")):(t.enter("chunkString",{contentType:"string"}),c(e))}function c(e){return e===o||null===e||Gk(e)?(t.exit("chunkString"),l(e)):(t.consume(e),92===e?h:c)}function h(e){return e===o||92===e?(t.consume(e),c):c(e)}}function EA(t,e){let n;return function r(i){if(Gk(i))return t.enter("lineEnding"),t.consume(i),t.exit("lineEnding"),n=!0,r;if(Hk(i))return qk(t,r,n?"linePrefix":"lineSuffix")(i);return e(i)}}function _A(t){return t.replace(/[\t\n\r ]+/g," ").replace(/^ | $/g,"").toLowerCase().toUpperCase()}const SA={name:"definition",tokenize:function(t,e,n){const r=this;let i;return function(e){return t.enter("definition"),function(e){return xA.call(r,t,s,n,"definitionLabel","definitionLabelMarker","definitionLabelString")(e)}(e)};function s(e){return i=_A(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)),58===e?(t.enter("definitionMarker"),t.consume(e),t.exit("definitionMarker"),o):n(e)}function o(e){return Wk(e)?EA(t,a)(e):a(e)}function a(e){return bA(t,l,n,"definitionDestination","definitionDestinationLiteral","definitionDestinationLiteralMarker","definitionDestinationRaw","definitionDestinationString")(e)}function l(e){return t.attempt(TA,c,c)(e)}function c(e){return Hk(e)?qk(t,h,"whitespace")(e):h(e)}function h(s){return null===s||Gk(s)?(t.exit("definition"),r.parser.defined.push(i),e(s)):n(s)}}},TA={tokenize:function(t,e,n){return function(e){return Wk(e)?EA(t,r)(e):n(e)};function r(e){return wA(t,i,n,"definitionTitle","definitionTitleMarker","definitionTitleString")(e)}function i(e){return Hk(e)?qk(t,s,"whitespace")(e):s(e)}function s(t){return null===t||Gk(t)?e(t):n(t)}},partial:!0};const kA={name:"hardBreakEscape",tokenize:function(t,e,n){return function(e){return t.enter("hardBreakEscape"),t.consume(e),r};function r(r){return Gk(r)?(t.exit("hardBreakEscape"),e(r)):n(r)}}};const AA={name:"headingAtx",tokenize:function(t,e,n){let r=0;return function(e){return t.enter("atxHeading"),function(e){return t.enter("atxHeadingSequence"),i(e)}(e)};function i(e){return 35===e&&r++<6?(t.consume(e),i):null===e||Wk(e)?(t.exit("atxHeadingSequence"),s(e)):n(e)}function s(n){return 35===n?(t.enter("atxHeadingSequence"),o(n)):null===n||Gk(n)?(t.exit("atxHeading"),e(n)):Hk(n)?qk(t,s,"whitespace")(n):(t.enter("atxHeadingText"),a(n))}function o(e){return 35===e?(t.consume(e),o):(t.exit("atxHeadingSequence"),s(e))}function a(e){return null===e||35===e||Wk(e)?(t.exit("atxHeadingText"),s(e)):(t.consume(e),a)}},resolve:function(t,e){let n,r,i=t.length-2,s=3;"whitespace"===t[s][1].type&&(s+=2);i-2>s&&"whitespace"===t[i][1].type&&(i-=2);"atxHeadingSequence"===t[i][1].type&&(s===i-1||i-4>s&&"whitespace"===t[i-2][1].type)&&(i-=s+1===i?2:4);i>s&&(n={type:"atxHeadingText",start:t[s][1].start,end:t[i][1].end},r={type:"chunkText",start:t[s][1].start,end:t[i][1].end,contentType:"text"},Mk(t,s,i-s+1,[["enter",n,e],["enter",r,e],["exit",r,e],["exit",n,e]]));return t}};const CA=["address","article","aside","base","basefont","blockquote","body","caption","center","col","colgroup","dd","details","dialog","dir","div","dl","dt","fieldset","figcaption","figure","footer","form","frame","frameset","h1","h2","h3","h4","h5","h6","head","header","hr","html","iframe","legend","li","link","main","menu","menuitem","nav","noframes","ol","optgroup","option","p","param","search","section","summary","table","tbody","td","tfoot","th","thead","title","tr","track","ul"],RA=["pre","script","style","textarea"],MA={name:"htmlFlow",tokenize:function(t,e,n){const r=this;let i,s,o,a,l;return function(e){return function(e){return t.enter("htmlFlow"),t.enter("htmlFlowData"),t.consume(e),c}(e)};function c(a){return 33===a?(t.consume(a),h):47===a?(t.consume(a),s=!0,f):63===a?(t.consume(a),i=3,r.interrupt?e:P):Fk(a)?(t.consume(a),o=String.fromCharCode(a),p):n(a)}function h(s){return 45===s?(t.consume(s),i=2,u):91===s?(t.consume(s),i=5,a=0,d):Fk(s)?(t.consume(s),i=4,r.interrupt?e:P):n(s)}function u(i){return 45===i?(t.consume(i),r.interrupt?e:P):n(i)}function d(i){const s="CDATA[";return i===s.charCodeAt(a++)?(t.consume(i),6===a?r.interrupt?e:k:d):n(i)}function f(e){return Fk(e)?(t.consume(e),o=String.fromCharCode(e),p):n(e)}function p(a){if(null===a||47===a||62===a||Wk(a)){const l=47===a,c=o.toLowerCase();return l||s||!RA.includes(c)?CA.includes(o.toLowerCase())?(i=6,l?(t.consume(a),m):r.interrupt?e(a):k(a)):(i=7,r.interrupt&&!r.parser.lazy[r.now().line]?n(a):s?g(a):v(a)):(i=1,r.interrupt?e(a):k(a))}return 45===a||Nk(a)?(t.consume(a),o+=String.fromCharCode(a),p):n(a)}function m(i){return 62===i?(t.consume(i),r.interrupt?e:k):n(i)}function g(e){return Hk(e)?(t.consume(e),g):S(e)}function v(e){return 47===e?(t.consume(e),S):58===e||95===e||Fk(e)?(t.consume(e),y):Hk(e)?(t.consume(e),v):S(e)}function y(e){return 45===e||46===e||58===e||95===e||Nk(e)?(t.consume(e),y):b(e)}function b(e){return 61===e?(t.consume(e),x):Hk(e)?(t.consume(e),b):v(e)}function x(e){return null===e||60===e||61===e||62===e||96===e?n(e):34===e||39===e?(t.consume(e),l=e,w):Hk(e)?(t.consume(e),x):E(e)}function w(e){return e===l?(t.consume(e),l=null,_):null===e||Gk(e)?n(e):(t.consume(e),w)}function E(e){return null===e||34===e||39===e||47===e||60===e||61===e||62===e||96===e||Wk(e)?b(e):(t.consume(e),E)}function _(t){return 47===t||62===t||Hk(t)?v(t):n(t)}function S(e){return 62===e?(t.consume(e),T):n(e)}function T(e){return null===e||Gk(e)?k(e):Hk(e)?(t.consume(e),T):n(e)}function k(e){return 45===e&&2===i?(t.consume(e),M):60===e&&1===i?(t.consume(e),I):62===e&&4===i?(t.consume(e),L):63===e&&3===i?(t.consume(e),P):93===e&&5===i?(t.consume(e),O):!Gk(e)||6!==i&&7!==i?null===e||Gk(e)?(t.exit("htmlFlowData"),A(e)):(t.consume(e),k):(t.exit("htmlFlowData"),t.check(IA,F,A)(e))}function A(e){return t.check(DA,C,F)(e)}function C(e){return t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),R}function R(e){return null===e||Gk(e)?A(e):(t.enter("htmlFlowData"),k(e))}function M(e){return 45===e?(t.consume(e),P):k(e)}function I(e){return 47===e?(t.consume(e),o="",D):k(e)}function D(e){if(62===e){const n=o.toLowerCase();return RA.includes(n)?(t.consume(e),L):k(e)}return Fk(e)&&o.length<8?(t.consume(e),o+=String.fromCharCode(e),D):k(e)}function O(e){return 93===e?(t.consume(e),P):k(e)}function P(e){return 62===e?(t.consume(e),L):45===e&&2===i?(t.consume(e),P):k(e)}function L(e){return null===e||Gk(e)?(t.exit("htmlFlowData"),F(e)):(t.consume(e),L)}function F(n){return t.exit("htmlFlow"),e(n)}},resolveTo:function(t){let e=t.length;for(;e--&&("enter"!==t[e][0]||"htmlFlow"!==t[e][1].type););e>1&&"linePrefix"===t[e-2][1].type&&(t[e][1].start=t[e-2][1].start,t[e+1][1].start=t[e-2][1].start,t.splice(e-2,2));return t},concrete:!0},IA={tokenize:function(t,e,n){return function(r){return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),t.attempt(iA,e,n)}},partial:!0},DA={tokenize:function(t,e,n){const r=this;return function(e){if(Gk(e))return t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),i;return n(e)};function i(t){return r.parser.lazy[r.now().line]?n(t):e(t)}},partial:!0};const OA={name:"htmlText",tokenize:function(t,e,n){const r=this;let i,s,o;return function(e){return t.enter("htmlText"),t.enter("htmlTextData"),t.consume(e),a};function a(e){return 33===e?(t.consume(e),l):47===e?(t.consume(e),x):63===e?(t.consume(e),y):Fk(e)?(t.consume(e),_):n(e)}function l(e){return 45===e?(t.consume(e),c):91===e?(t.consume(e),s=0,f):Fk(e)?(t.consume(e),v):n(e)}function c(e){return 45===e?(t.consume(e),d):n(e)}function h(e){return null===e?n(e):45===e?(t.consume(e),u):Gk(e)?(o=h,D(e)):(t.consume(e),h)}function u(e){return 45===e?(t.consume(e),d):h(e)}function d(t){return 62===t?I(t):45===t?u(t):h(t)}function f(e){const r="CDATA[";return e===r.charCodeAt(s++)?(t.consume(e),6===s?p:f):n(e)}function p(e){return null===e?n(e):93===e?(t.consume(e),m):Gk(e)?(o=p,D(e)):(t.consume(e),p)}function m(e){return 93===e?(t.consume(e),g):p(e)}function g(e){return 62===e?I(e):93===e?(t.consume(e),g):p(e)}function v(e){return null===e||62===e?I(e):Gk(e)?(o=v,D(e)):(t.consume(e),v)}function y(e){return null===e?n(e):63===e?(t.consume(e),b):Gk(e)?(o=y,D(e)):(t.consume(e),y)}function b(t){return 62===t?I(t):y(t)}function x(e){return Fk(e)?(t.consume(e),w):n(e)}function w(e){return 45===e||Nk(e)?(t.consume(e),w):E(e)}function E(e){return Gk(e)?(o=E,D(e)):Hk(e)?(t.consume(e),E):I(e)}function _(e){return 45===e||Nk(e)?(t.consume(e),_):47===e||62===e||Wk(e)?S(e):n(e)}function S(e){return 47===e?(t.consume(e),I):58===e||95===e||Fk(e)?(t.consume(e),T):Gk(e)?(o=S,D(e)):Hk(e)?(t.consume(e),S):I(e)}function T(e){return 45===e||46===e||58===e||95===e||Nk(e)?(t.consume(e),T):k(e)}function k(e){return 61===e?(t.consume(e),A):Gk(e)?(o=k,D(e)):Hk(e)?(t.consume(e),k):S(e)}function A(e){return null===e||60===e||61===e||62===e||96===e?n(e):34===e||39===e?(t.consume(e),i=e,C):Gk(e)?(o=A,D(e)):Hk(e)?(t.consume(e),A):(t.consume(e),R)}function C(e){return e===i?(t.consume(e),i=void 0,M):null===e?n(e):Gk(e)?(o=C,D(e)):(t.consume(e),C)}function R(e){return null===e||34===e||39===e||60===e||61===e||96===e?n(e):47===e||62===e||Wk(e)?S(e):(t.consume(e),R)}function M(t){return 47===t||62===t||Wk(t)?S(t):n(t)}function I(r){return 62===r?(t.consume(r),t.exit("htmlTextData"),t.exit("htmlText"),e):n(r)}function D(e){return t.exit("htmlTextData"),t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),O}function O(e){return Hk(e)?qk(t,P,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(e):P(e)}function P(e){return t.enter("htmlTextData"),o(e)}}};const PA={name:"labelEnd",tokenize:function(t,e,n){const r=this;let i,s,o=r.events.length;for(;o--;)if(("labelImage"===r.events[o][1].type||"labelLink"===r.events[o][1].type)&&!r.events[o][1]._balanced){i=r.events[o][1];break}return function(e){if(!i)return n(e);if(i._inactive)return h(e);return s=r.parser.defined.includes(_A(r.sliceSerialize({start:i.end,end:r.now()}))),t.enter("labelEnd"),t.enter("labelMarker"),t.consume(e),t.exit("labelMarker"),t.exit("labelEnd"),a};function a(e){return 40===e?t.attempt(LA,c,s?c:h)(e):91===e?t.attempt(FA,c,s?l:h)(e):s?c(e):h(e)}function l(e){return t.attempt(NA,c,h)(e)}function c(t){return e(t)}function h(t){return i._balanced=!0,n(t)}},resolveTo:function(t,e){let n,r,i,s,o=t.length,a=0;for(;o--;)if(n=t[o][1],r){if("link"===n.type||"labelLink"===n.type&&n._inactive)break;"enter"===t[o][0]&&"labelLink"===n.type&&(n._inactive=!0)}else if(i){if("enter"===t[o][0]&&("labelImage"===n.type||"labelLink"===n.type)&&!n._balanced&&(r=o,"labelLink"!==n.type)){a=2;break}}else"labelEnd"===n.type&&(i=o);const l={type:"labelLink"===t[r][1].type?"link":"image",start:Object.assign({},t[r][1].start),end:Object.assign({},t[t.length-1][1].end)},c={type:"label",start:Object.assign({},t[r][1].start),end:Object.assign({},t[i][1].end)},h={type:"labelText",start:Object.assign({},t[r+a+2][1].end),end:Object.assign({},t[i-2][1].start)};return s=[["enter",l,e],["enter",c,e]],s=Ik(s,t.slice(r+1,r+a+3)),s=Ik(s,[["enter",h,e]]),s=Ik(s,tA(e.parser.constructs.insideSpan.null,t.slice(r+a+4,i-3),e)),s=Ik(s,[["exit",h,e],t[i-2],t[i-1],["exit",c,e]]),s=Ik(s,t.slice(i+1)),s=Ik(s,[["exit",l,e]]),Mk(t,r,t.length,s),t},resolveAll:function(t){let e=-1;for(;++e<t.length;){const n=t[e][1];"labelImage"!==n.type&&"labelLink"!==n.type&&"labelEnd"!==n.type||(t.splice(e+1,"labelImage"===n.type?4:2),n.type="data",e++)}return t}},LA={tokenize:function(t,e,n){return function(e){return t.enter("resource"),t.enter("resourceMarker"),t.consume(e),t.exit("resourceMarker"),r};function r(e){return Wk(e)?EA(t,i)(e):i(e)}function i(e){return 41===e?c(e):bA(t,s,o,"resourceDestination","resourceDestinationLiteral","resourceDestinationLiteralMarker","resourceDestinationRaw","resourceDestinationString",32)(e)}function s(e){return Wk(e)?EA(t,a)(e):c(e)}function o(t){return n(t)}function a(e){return 34===e||39===e||40===e?wA(t,l,n,"resourceTitle","resourceTitleMarker","resourceTitleString")(e):c(e)}function l(e){return Wk(e)?EA(t,c)(e):c(e)}function c(r){return 41===r?(t.enter("resourceMarker"),t.consume(r),t.exit("resourceMarker"),t.exit("resource"),e):n(r)}}},FA={tokenize:function(t,e,n){const r=this;return function(e){return xA.call(r,t,i,s,"reference","referenceMarker","referenceString")(e)};function i(t){return r.parser.defined.includes(_A(r.sliceSerialize(r.events[r.events.length-1][1]).slice(1,-1)))?e(t):n(t)}function s(t){return n(t)}}},NA={tokenize:function(t,e,n){return function(e){return t.enter("reference"),t.enter("referenceMarker"),t.consume(e),t.exit("referenceMarker"),r};function r(r){return 93===r?(t.enter("referenceMarker"),t.consume(r),t.exit("referenceMarker"),t.exit("reference"),e):n(r)}}};const BA={name:"labelStartImage",tokenize:function(t,e,n){const r=this;return function(e){return t.enter("labelImage"),t.enter("labelImageMarker"),t.consume(e),t.exit("labelImageMarker"),i};function i(e){return 91===e?(t.enter("labelMarker"),t.consume(e),t.exit("labelMarker"),t.exit("labelImage"),s):n(e)}function s(t){return 94===t&&"_hiddenFootnoteSupport"in r.parser.constructs?n(t):e(t)}},resolveAll:PA.resolveAll};const UA={name:"labelStartLink",tokenize:function(t,e,n){const r=this;return function(e){return t.enter("labelLink"),t.enter("labelMarker"),t.consume(e),t.exit("labelMarker"),t.exit("labelLink"),i};function i(t){return 94===t&&"_hiddenFootnoteSupport"in r.parser.constructs?n(t):e(t)}},resolveAll:PA.resolveAll};const VA={name:"lineEnding",tokenize:function(t,e){return function(n){return t.enter("lineEnding"),t.consume(n),t.exit("lineEnding"),qk(t,e,"linePrefix")}}};const jA={name:"thematicBreak",tokenize:function(t,e,n){let r,i=0;return function(e){return t.enter("thematicBreak"),function(t){return r=t,s(t)}(e)};function s(s){return s===r?(t.enter("thematicBreakSequence"),o(s)):i>=3&&(null===s||Gk(s))?(t.exit("thematicBreak"),e(s)):n(s)}function o(e){return e===r?(t.consume(e),i++,o):(t.exit("thematicBreakSequence"),Hk(e)?qk(t,s,"whitespace")(e):s(e))}}};const zA={name:"list",tokenize:function(t,e,n){const r=this,i=r.events[r.events.length-1];let s=i&&"linePrefix"===i[1].type?i[2].sliceSerialize(i[1],!0).length:0,o=0;return function(e){const i=r.containerState.type||(42===e||43===e||45===e?"listUnordered":"listOrdered");if("listUnordered"===i?!r.containerState.marker||e===r.containerState.marker:Vk(e)){if(r.containerState.type||(r.containerState.type=i,t.enter(i,{_container:!0})),"listUnordered"===i)return t.enter("listItemPrefix"),42===e||45===e?t.check(jA,n,l)(e):l(e);if(!r.interrupt||49===e)return t.enter("listItemPrefix"),t.enter("listItemValue"),a(e)}return n(e)};function a(e){return Vk(e)&&++o<10?(t.consume(e),a):(!r.interrupt||o<2)&&(r.containerState.marker?e===r.containerState.marker:41===e||46===e)?(t.exit("listItemValue"),l(e)):n(e)}function l(e){return t.enter("listItemMarker"),t.consume(e),t.exit("listItemMarker"),r.containerState.marker=r.containerState.marker||e,t.check(iA,r.interrupt?n:c,t.attempt(GA,u,h))}function c(t){return r.containerState.initialBlankLine=!0,s++,u(t)}function h(e){return Hk(e)?(t.enter("listItemPrefixWhitespace"),t.consume(e),t.exit("listItemPrefixWhitespace"),u):n(e)}function u(n){return r.containerState.size=s+r.sliceSerialize(t.exit("listItemPrefix"),!0).length,e(n)}},continuation:{tokenize:function(t,e,n){const r=this;return r.containerState._closeFlow=void 0,t.check(iA,(function(n){return r.containerState.furtherBlankLines=r.containerState.furtherBlankLines||r.containerState.initialBlankLine,qk(t,e,"listItemIndent",r.containerState.size+1)(n)}),(function(n){if(r.containerState.furtherBlankLines||!Hk(n))return r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,i(n);return r.containerState.furtherBlankLines=void 0,r.containerState.initialBlankLine=void 0,t.attempt(WA,e,i)(n)}));function i(i){return r.containerState._closeFlow=!0,r.interrupt=void 0,qk(t,t.attempt(zA,e,n),"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(i)}}},exit:function(t){t.exit(this.containerState.type)}},GA={tokenize:function(t,e,n){const r=this;return qk(t,(function(t){const i=r.events[r.events.length-1];return!Hk(t)&&i&&"listItemPrefixWhitespace"===i[1].type?e(t):n(t)}),"listItemPrefixWhitespace",r.parser.constructs.disable.null.includes("codeIndented")?void 0:5)},partial:!0},WA={tokenize:function(t,e,n){const r=this;return qk(t,(function(t){const i=r.events[r.events.length-1];return i&&"listItemIndent"===i[1].type&&i[2].sliceSerialize(i[1],!0).length===r.containerState.size?e(t):n(t)}),"listItemIndent",r.containerState.size+1)},partial:!0};const HA={name:"setextUnderline",tokenize:function(t,e,n){const r=this;let i;return function(e){let o,a=r.events.length;for(;a--;)if("lineEnding"!==r.events[a][1].type&&"linePrefix"!==r.events[a][1].type&&"content"!==r.events[a][1].type){o="paragraph"===r.events[a][1].type;break}if(!r.parser.lazy[r.now().line]&&(r.interrupt||o))return t.enter("setextHeadingLine"),i=e,function(e){return t.enter("setextHeadingLineSequence"),s(e)}(e);return n(e)};function s(e){return e===i?(t.consume(e),s):(t.exit("setextHeadingLineSequence"),Hk(e)?qk(t,o,"lineSuffix")(e):o(e))}function o(r){return null===r||Gk(r)?(t.exit("setextHeadingLine"),e(r)):n(r)}},resolveTo:function(t,e){let n,r,i,s=t.length;for(;s--;)if("enter"===t[s][0]){if("content"===t[s][1].type){n=s;break}"paragraph"===t[s][1].type&&(r=s)}else"content"===t[s][1].type&&t.splice(s,1),i||"definition"!==t[s][1].type||(i=s);const o={type:"setextHeading",start:Object.assign({},t[r][1].start),end:Object.assign({},t[t.length-1][1].end)};t[r][1].type="setextHeadingText",i?(t.splice(r,0,["enter",o,e]),t.splice(i+1,0,["exit",t[n][1],e]),t[n][1].end=Object.assign({},t[i][1].end)):t[n][1]=o;return t.push(["exit",o,e]),t}};const $A={tokenize:function(t){const e=this,n=t.attempt(iA,(function(r){if(null===r)return void t.consume(r);return t.enter("lineEndingBlank"),t.consume(r),t.exit("lineEndingBlank"),e.currentConstruct=void 0,n}),t.attempt(this.parser.constructs.flowInitial,r,qk(t,t.attempt(this.parser.constructs.flow,r,t.attempt(vA,r)),"linePrefix")));return n;function r(r){if(null!==r)return t.enter("lineEnding"),t.consume(r),t.exit("lineEnding"),e.currentConstruct=void 0,n;t.consume(r)}}};const YA={resolveAll:ZA()},XA=KA("string"),qA=KA("text");function KA(t){return{tokenize:function(e){const n=this,r=this.parser.constructs[t],i=e.attempt(r,s,o);return s;function s(t){return l(t)?i(t):o(t)}function o(t){if(null!==t)return e.enter("data"),e.consume(t),a;e.consume(t)}function a(t){return l(t)?(e.exit("data"),i(t)):(e.consume(t),a)}function l(t){if(null===t)return!0;const e=r[t];let i=-1;if(e)for(;++i<e.length;){const t=e[i];if(!t.previous||t.previous.call(n,n.previous))return!0}return!1}},resolveAll:ZA("text"===t?JA:void 0)}}function ZA(t){return function(e,n){let r,i=-1;for(;++i<=e.length;)void 0===r?e[i]&&"data"===e[i][1].type&&(r=i,i++):e[i]&&"data"===e[i][1].type||(i!==r+2&&(e[r][1].end=e[i-1][1].end,e.splice(r+2,i-r-2),i=r+2),r=void 0);return t?t(e,n):e}}function JA(t,e){let n=0;for(;++n<=t.length;)if((n===t.length||"lineEnding"===t[n][1].type)&&"data"===t[n-1][1].type){const r=t[n-1][1],i=e.sliceStream(r);let s,o=i.length,a=-1,l=0;for(;o--;){const t=i[o];if("string"==typeof t){for(a=t.length;32===t.charCodeAt(a-1);)l++,a--;if(a)break;a=-1}else if(-2===t)s=!0,l++;else if(-1!==t){o++;break}}if(l){const i={type:n===t.length||s||l<2?"lineSuffix":"hardBreakTrailing",start:{line:r.end.line,column:r.end.column-l,offset:r.end.offset-l,_index:r.start._index+o,_bufferIndex:o?a:r.start._bufferIndex+a},end:Object.assign({},r.end)};r.end=Object.assign({},i.start),r.start.offset===r.end.offset?Object.assign(r,i):(t.splice(n,0,["enter",i,e],["exit",i,e]),n+=2)}n++}return t}function QA(t,e,n){let r=Object.assign(n?Object.assign({},n):{line:1,column:1,offset:0},{_index:0,_bufferIndex:-1});const i={},s=[];let o=[],a=[];const l={consume:function(t){Gk(t)?(r.line++,r.column=1,r.offset+=-3===t?2:1,y()):-1!==t&&(r.column++,r.offset++);r._bufferIndex<0?r._index++:(r._bufferIndex++,r._bufferIndex===o[r._index].length&&(r._bufferIndex=-1,r._index++));c.previous=t},enter:function(t,e){const n=e||{};return n.type=t,n.start=d(),c.events.push(["enter",n,c]),a.push(n),n},exit:function(t){const e=a.pop();return e.end=d(),c.events.push(["exit",e,c]),e},attempt:g((function(t,e){v(t,e.from)})),check:g(m),interrupt:g(m,{interrupt:!0})},c={previous:null,code:null,containerState:{},events:[],parser:t,sliceStream:u,sliceSerialize:function(t,e){return function(t,e){let n=-1;const r=[];let i;for(;++n<t.length;){const s=t[n];let o;if("string"==typeof s)o=s;else switch(s){case-5:o="\r";break;case-4:o="\n";break;case-3:o="\r\n";break;case-2:o=e?" ":"\t";break;case-1:if(!e&&i)continue;o=" ";break;default:o=String.fromCharCode(s)}i=-2===s,r.push(o)}return r.join("")}(u(t),e)},now:d,defineSkip:function(t){i[t.line]=t.column,y()},write:function(t){if(o=Ik(o,t),f(),null!==o[o.length-1])return[];return v(e,0),c.events=tA(s,c.events,c),c.events}};let h=e.tokenize.call(c,l);return e.resolveAll&&s.push(e),c;function u(t){return function(t,e){const n=e.start._index,r=e.start._bufferIndex,i=e.end._index,s=e.end._bufferIndex;let o;if(n===i)o=[t[n].slice(r,s)];else{if(o=t.slice(n,i),r>-1){const t=o[0];"string"==typeof t?o[0]=t.slice(r):o.shift()}s>0&&o.push(t[i].slice(0,s))}return o}(o,t)}function d(){const{line:t,column:e,offset:n,_index:i,_bufferIndex:s}=r;return{line:t,column:e,offset:n,_index:i,_bufferIndex:s}}function f(){let t;for(;r._index<o.length;){const e=o[r._index];if("string"==typeof e)for(t=r._index,r._bufferIndex<0&&(r._bufferIndex=0);r._index===t&&r._bufferIndex<e.length;)p(e.charCodeAt(r._bufferIndex));else p(e)}}function p(t){h=h(t)}function m(t,e){e.restore()}function g(t,e){return function(n,i,s){let o,h,u,f;return Array.isArray(n)?p(n):"tokenize"in n?p([n]):function(t){return e;function e(e){const n=null!==e&&t[e],r=null!==e&&t.null;return p([...Array.isArray(n)?n:n?[n]:[],...Array.isArray(r)?r:r?[r]:[]])(e)}}(n);function p(t){return o=t,h=0,0===t.length?s:m(t[h])}function m(t){return function(n){f=function(){const t=d(),e=c.previous,n=c.currentConstruct,i=c.events.length,s=Array.from(a);return{restore:o,from:i};function o(){r=t,c.previous=e,c.currentConstruct=n,c.events.length=i,a=s,y()}}(),u=t,t.partial||(c.currentConstruct=t);if(t.name&&c.parser.constructs.disable.null.includes(t.name))return v();return t.tokenize.call(e?Object.assign(Object.create(c),e):c,l,g,v)(n)}}function g(e){return t(u,f),i}function v(t){return f.restore(),++h<o.length?m(o[h]):s}}}function v(t,e){t.resolveAll&&!s.includes(t)&&s.push(t),t.resolve&&Mk(c.events,e,c.events.length-e,t.resolve(c.events.slice(e),c)),t.resolveTo&&(c.events=t.resolveTo(c.events,c))}function y(){r.line in i&&r.column<2&&(r.column=i[r.line],r.offset+=i[r.line]-1)}}const tC={42:zA,43:zA,45:zA,48:zA,49:zA,50:zA,51:zA,52:zA,53:zA,54:zA,55:zA,56:zA,57:zA,62:sA},eC={91:SA},nC={[-2]:dA,[-1]:dA,32:dA},rC={35:AA,42:jA,45:[HA,jA],60:MA,61:HA,95:jA,96:uA,126:uA},iC={38:cA,92:oA},sC={[-5]:VA,[-4]:VA,[-3]:VA,33:BA,38:cA,42:eA,60:[rA,OA],91:UA,92:[kA,oA],93:PA,95:eA,96:pA},oC={null:[eA,YA]},aC=Object.freeze(Object.defineProperty({__proto__:null,attentionMarkers:{null:[42,95]},contentInitial:eC,disable:{null:[]},document:tC,flow:rC,flowInitial:nC,insideSpan:oC,string:iC,text:sC},Symbol.toStringTag,{value:"Module"}));const lC=/[\0\t\n\r]/g;function cC(t,e){const n=Number.parseInt(t,e);return n<9||11===n||n>13&&n<32||n>126&&n<160||n>55295&&n<57344||n>64975&&n<65008||65535==(65535&n)||65534==(65535&n)||n>1114111?"�":String.fromCharCode(n)}const hC=/\\([!-/:-@[-`{-~])|&(#(?:\d{1,7}|x[\da-f]{1,6})|[\da-z]{1,31});/gi;function uC(t){return t.replace(hC,dC)}function dC(t,e,n){if(e)return e;if(35===n.charCodeAt(0)){const t=n.charCodeAt(1),e=120===t||88===t;return cC(n.slice(e?2:1),e?16:10)}return lA(n)||t}function fC(t){return t&&"object"==typeof t?"position"in t||"type"in t?mC(t.position):"start"in t||"end"in t?mC(t):"line"in t||"column"in t?pC(t):"":""}function pC(t){return gC(t&&t.line)+":"+gC(t&&t.column)}function mC(t){return pC(t&&t.start)+"-"+pC(t&&t.end)}function gC(t){return t&&"number"==typeof t?t:1}const vC={}.hasOwnProperty,yC=function(t,e,n){return"string"!=typeof e&&(n=e,e=void 0),function(t){const e={transforms:[],canContainEols:["emphasis","fragment","heading","paragraph","strong"],enter:{autolink:a(nt),autolinkProtocol:A,autolinkEmail:A,atxHeading:a(J),blockQuote:a(Y),characterEscape:A,characterReference:A,codeFenced:a(X),codeFencedFenceInfo:l,codeFencedFenceMeta:l,codeIndented:a(X,l),codeText:a(q,l),codeTextData:A,data:A,codeFlowValue:A,definition:a(K),definitionDestinationString:l,definitionLabelString:l,definitionTitleString:l,emphasis:a(Z),hardBreakEscape:a(Q),hardBreakTrailing:a(Q),htmlFlow:a(tt,l),htmlFlowData:A,htmlText:a(tt,l),htmlTextData:A,image:a(et),label:l,link:a(nt),listItem:a(it),listItemValue:p,listOrdered:a(rt,f),listUnordered:a(rt),paragraph:a(st),reference:j,referenceString:l,resourceDestinationString:l,resourceTitleString:l,setextHeading:a(J),strong:a(ot),thematicBreak:a(lt)},exit:{atxHeading:h(),atxHeadingSequence:_,autolink:h(),autolinkEmail:$,autolinkProtocol:H,blockQuote:h(),characterEscapeValue:C,characterReferenceMarkerHexadecimal:G,characterReferenceMarkerNumeric:G,characterReferenceValue:W,codeFenced:h(y),codeFencedFence:v,codeFencedFenceInfo:m,codeFencedFenceMeta:g,codeFlowValue:C,codeIndented:h(b),codeText:h(O),codeTextData:C,data:C,definition:h(),definitionDestinationString:E,definitionLabelString:x,definitionTitleString:w,emphasis:h(),hardBreakEscape:h(M),hardBreakTrailing:h(M),htmlFlow:h(I),htmlFlowData:C,htmlText:h(D),htmlTextData:C,image:h(L),label:N,labelText:F,lineEnding:R,link:h(P),listItem:h(),listOrdered:h(),listUnordered:h(),paragraph:h(),referenceString:z,resourceDestinationString:B,resourceTitleString:U,resource:V,setextHeading:h(k),setextHeadingLineSequence:T,setextHeadingText:S,strong:h(),thematicBreak:h()}};xC(e,(t||{}).mdastExtensions||[]);const n={};return r;function r(t){let n={type:"root",children:[]};const r={stack:[n],tokenStack:[],config:e,enter:c,exit:u,buffer:l,resume:d,setData:s,getData:o},a=[];let h=-1;for(;++h<t.length;)if("listOrdered"===t[h][1].type||"listUnordered"===t[h][1].type)if("enter"===t[h][0])a.push(h);else{h=i(t,a.pop(),h)}for(h=-1;++h<t.length;){const n=e[t[h][0]];vC.call(n,t[h][1].type)&&n[t[h][1].type].call(Object.assign({sliceSerialize:t[h][2].sliceSerialize},r),t[h][1])}if(r.tokenStack.length>0){const t=r.tokenStack[r.tokenStack.length-1];(t[1]||EC).call(r,void 0,t[0])}for(n.position={start:bC(t.length>0?t[0][1].start:{line:1,column:1,offset:0}),end:bC(t.length>0?t[t.length-2][1].end:{line:1,column:1,offset:0})},h=-1;++h<e.transforms.length;)n=e.transforms[h](n)||n;return n}function i(t,e,n){let r,i,s,o,a=e-1,l=-1,c=!1;for(;++a<=n;){const e=t[a];if("listUnordered"===e[1].type||"listOrdered"===e[1].type||"blockQuote"===e[1].type?("enter"===e[0]?l++:l--,o=void 0):"lineEndingBlank"===e[1].type?"enter"===e[0]&&(!r||o||l||s||(s=a),o=void 0):"linePrefix"===e[1].type||"listItemValue"===e[1].type||"listItemMarker"===e[1].type||"listItemPrefix"===e[1].type||"listItemPrefixWhitespace"===e[1].type||(o=void 0),!l&&"enter"===e[0]&&"listItemPrefix"===e[1].type||-1===l&&"exit"===e[0]&&("listUnordered"===e[1].type||"listOrdered"===e[1].type)){if(r){let o=a;for(i=void 0;o--;){const e=t[o];if("lineEnding"===e[1].type||"lineEndingBlank"===e[1].type){if("exit"===e[0])continue;i&&(t[i][1].type="lineEndingBlank",c=!0),e[1].type="lineEnding",i=o}else if("linePrefix"!==e[1].type&&"blockQuotePrefix"!==e[1].type&&"blockQuotePrefixWhitespace"!==e[1].type&&"blockQuoteMarker"!==e[1].type&&"listItemIndent"!==e[1].type)break}s&&(!i||s<i)&&(r._spread=!0),r.end=Object.assign({},i?t[i][1].start:e[1].end),t.splice(i||a,0,["exit",r,e[2]]),a++,n++}"listItemPrefix"===e[1].type&&(r={type:"listItem",_spread:!1,start:Object.assign({},e[1].start),end:void 0},t.splice(a,0,["enter",r,e[2]]),a++,n++,s=void 0,o=!0)}}return t[e][1]._spread=c,n}function s(t,e){n[t]=e}function o(t){return n[t]}function a(t,e){return n;function n(n){c.call(this,t(n),n),e&&e.call(this,n)}}function l(){this.stack.push({type:"fragment",children:[]})}function c(t,e,n){return this.stack[this.stack.length-1].children.push(t),this.stack.push(t),this.tokenStack.push([e,n]),t.position={start:bC(e.start)},t}function h(t){return e;function e(e){t&&t.call(this,e),u.call(this,e)}}function u(t,e){const n=this.stack.pop(),r=this.tokenStack.pop();if(!r)throw new Error("Cannot close `"+t.type+"` ("+fC({start:t.start,end:t.end})+"): it’s not open");if(r[0].type!==t.type)if(e)e.call(this,t,r[0]);else{(r[1]||EC).call(this,t,r[0])}return n.position.end=bC(t.end),n}function d(){return Ak(this.stack.pop())}function f(){s("expectingFirstListItemValue",!0)}function p(t){if(o("expectingFirstListItemValue")){this.stack[this.stack.length-2].start=Number.parseInt(this.sliceSerialize(t),10),s("expectingFirstListItemValue")}}function m(){const t=this.resume();this.stack[this.stack.length-1].lang=t}function g(){const t=this.resume();this.stack[this.stack.length-1].meta=t}function v(){o("flowCodeInside")||(this.buffer(),s("flowCodeInside",!0))}function y(){const t=this.resume();this.stack[this.stack.length-1].value=t.replace(/^(\r?\n|\r)|(\r?\n|\r)$/g,""),s("flowCodeInside")}function b(){const t=this.resume();this.stack[this.stack.length-1].value=t.replace(/(\r?\n|\r)$/g,"")}function x(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.label=e,n.identifier=_A(this.sliceSerialize(t)).toLowerCase()}function w(){const t=this.resume();this.stack[this.stack.length-1].title=t}function E(){const t=this.resume();this.stack[this.stack.length-1].url=t}function _(t){const e=this.stack[this.stack.length-1];if(!e.depth){const n=this.sliceSerialize(t).length;e.depth=n}}function S(){s("setextHeadingSlurpLineEnding",!0)}function T(t){this.stack[this.stack.length-1].depth=61===this.sliceSerialize(t).charCodeAt(0)?1:2}function k(){s("setextHeadingSlurpLineEnding")}function A(t){const e=this.stack[this.stack.length-1];let n=e.children[e.children.length-1];n&&"text"===n.type||(n=at(),n.position={start:bC(t.start)},e.children.push(n)),this.stack.push(n)}function C(t){const e=this.stack.pop();e.value+=this.sliceSerialize(t),e.position.end=bC(t.end)}function R(t){const n=this.stack[this.stack.length-1];if(o("atHardBreak")){return n.children[n.children.length-1].position.end=bC(t.end),void s("atHardBreak")}!o("setextHeadingSlurpLineEnding")&&e.canContainEols.includes(n.type)&&(A.call(this,t),C.call(this,t))}function M(){s("atHardBreak",!0)}function I(){const t=this.resume();this.stack[this.stack.length-1].value=t}function D(){const t=this.resume();this.stack[this.stack.length-1].value=t}function O(){const t=this.resume();this.stack[this.stack.length-1].value=t}function P(){const t=this.stack[this.stack.length-1];if(o("inReference")){const e=o("referenceType")||"shortcut";t.type+="Reference",t.referenceType=e,delete t.url,delete t.title}else delete t.identifier,delete t.label;s("referenceType")}function L(){const t=this.stack[this.stack.length-1];if(o("inReference")){const e=o("referenceType")||"shortcut";t.type+="Reference",t.referenceType=e,delete t.url,delete t.title}else delete t.identifier,delete t.label;s("referenceType")}function F(t){const e=this.sliceSerialize(t),n=this.stack[this.stack.length-2];n.label=uC(e),n.identifier=_A(e).toLowerCase()}function N(){const t=this.stack[this.stack.length-1],e=this.resume(),n=this.stack[this.stack.length-1];if(s("inReference",!0),"link"===n.type){const e=t.children;n.children=e}else n.alt=e}function B(){const t=this.resume();this.stack[this.stack.length-1].url=t}function U(){const t=this.resume();this.stack[this.stack.length-1].title=t}function V(){s("inReference")}function j(){s("referenceType","collapsed")}function z(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.label=e,n.identifier=_A(this.sliceSerialize(t)).toLowerCase(),s("referenceType","full")}function G(t){s("characterReferenceType",t.type)}function W(t){const e=this.sliceSerialize(t),n=o("characterReferenceType");let r;if(n)r=cC(e,"characterReferenceMarkerNumeric"===n?10:16),s("characterReferenceType");else{r=lA(e)}const i=this.stack.pop();i.value+=r,i.position.end=bC(t.end)}function H(t){C.call(this,t);this.stack[this.stack.length-1].url=this.sliceSerialize(t)}function $(t){C.call(this,t);this.stack[this.stack.length-1].url="mailto:"+this.sliceSerialize(t)}function Y(){return{type:"blockquote",children:[]}}function X(){return{type:"code",lang:null,meta:null,value:""}}function q(){return{type:"inlineCode",value:""}}function K(){return{type:"definition",identifier:"",label:null,title:null,url:""}}function Z(){return{type:"emphasis",children:[]}}function J(){return{type:"heading",depth:void 0,children:[]}}function Q(){return{type:"break"}}function tt(){return{type:"html",value:""}}function et(){return{type:"image",title:null,url:"",alt:null}}function nt(){return{type:"link",title:null,url:"",children:[]}}function rt(t){return{type:"list",ordered:"listOrdered"===t.type,start:null,spread:t._spread,children:[]}}function it(t){return{type:"listItem",spread:t._spread,checked:null,children:[]}}function st(){return{type:"paragraph",children:[]}}function ot(){return{type:"strong",children:[]}}function at(){return{type:"text",value:""}}function lt(){return{type:"thematicBreak"}}}(n)(function(t){for(;!mA(t););return t}(function(t){const e={defined:[],lazy:{},constructs:Ok([aC,...(t||{}).extensions||[]]),content:n(Kk),document:n(Zk),flow:n($A),string:n(XA),text:n(qA)};return e;function n(t){return function(n){return QA(e,t,n)}}}(n).document().write(function(){let t,e=1,n="",r=!0;return function(i,s,o){const a=[];let l,c,h,u,d;for(i=n+i.toString(s),h=0,n="",r&&(65279===i.charCodeAt(0)&&h++,r=void 0);h<i.length;){if(lC.lastIndex=h,l=lC.exec(i),u=l&&void 0!==l.index?l.index:i.length,d=i.charCodeAt(u),!l){n=i.slice(h);break}if(10===d&&h===u&&t)a.push(-3),t=void 0;else switch(t&&(a.push(-5),t=void 0),h<u&&(a.push(i.slice(h,u)),e+=u-h),d){case 0:a.push(65533),e++;break;case 9:for(c=4*Math.ceil(e/4),a.push(-2);e++<c;)a.push(-1);break;case 10:a.push(-4),e=1;break;default:t=!0,e=1}h=u+1}return o&&(t&&a.push(-5),n&&a.push(n),a.push(null)),a}}()(t,e,!0))))};function bC(t){return{line:t.line,column:t.column,offset:t.offset}}function xC(t,e){let n=-1;for(;++n<e.length;){const r=e[n];Array.isArray(r)?xC(t,r):wC(t,r)}}function wC(t,e){let n;for(n in e)if(vC.call(e,n))if("canContainEols"===n){const r=e[n];r&&t[n].push(...r)}else if("transforms"===n){const r=e[n];r&&t[n].push(...r)}else if("enter"===n||"exit"===n){const r=e[n];r&&Object.assign(t[n],r)}}function EC(t,e){throw t?new Error("Cannot close `"+t.type+"` ("+fC({start:t.start,end:t.end})+"): a different token (`"+e.type+"`, "+fC({start:e.start,end:e.end})+") is open"):new Error("Cannot close document, a token (`"+e.type+"`, "+fC({start:e.start,end:e.end})+") is still open")}function _C(t){Object.assign(this,{Parser:e=>{const n=this.data("settings");return yC(e,Object.assign({},n,t,{extensions:this.data("micromarkExtensions")||[],mdastExtensions:this.data("fromMarkdownExtensions")||[]}))}})}const SC={}.hasOwnProperty;function TC(t,e){let n,r=-1;if(e.extensions)for(;++r<e.extensions.length;)TC(t,e.extensions[r]);for(n in e)"extensions"===n||("unsafe"===n||"join"===n?t[n]=[...t[n]||[],...e[n]||[]]:"handlers"===n?t[n]=Object.assign(t[n],e[n]||{}):t.options[n]=e[n]);return t}function kC(t,e,n){return">"+(n?"":" ")+t}function AC(t,e){return CC(t,e.inConstruct,!0)&&!CC(t,e.notInConstruct,!1)}function CC(t,e,n){if("string"==typeof e&&(e=[e]),!e||0===e.length)return n;let r=-1;for(;++r<e.length;)if(t.includes(e[r]))return!0;return!1}function RC(t,e,n,r){let i=-1;for(;++i<n.unsafe.length;)if("\n"===n.unsafe[i].character&&AC(n.stack,n.unsafe[i]))return/[ \t]/.test(r.before)?"":" ";return"\\\n"}function MC(t,e){return Boolean(!e.options.fences&&t.value&&!t.lang&&/[^ \r\n]/.test(t.value)&&!/^[\t ]*(?:[\r\n]|$)|(?:^|[\r\n])[\t ]*$/.test(t.value))}function IC(t,e,n){return(n?"":"    ")+t}function DC(t){const e=t.options.quote||'"';if('"'!==e&&"'"!==e)throw new Error("Cannot serialize title with `"+e+"` for `options.quote`, expected `\"`, or `'`");return e}function OC(t,e,n,r){const i=function(t){const e=t.options.emphasis||"*";if("*"!==e&&"_"!==e)throw new Error("Cannot serialize emphasis with `"+e+"` for `options.emphasis`, expected `*`, or `_`");return e}(n),s=n.enter("emphasis"),o=n.createTracker(r);let a=o.move(i);return a+=o.move(n.containerPhrasing(t,{before:a,after:i,...o.current()})),a+=o.move(i),s(),a}OC.peek=function(t,e,n){return n.options.emphasis||"*"};const PC=function(t){if(null==t)return FC;if("string"==typeof t)return function(t){return LC(e);function e(e){return e&&e.type===t}}(t);if("object"==typeof t)return Array.isArray(t)?function(t){const e=[];let n=-1;for(;++n<t.length;)e[n]=PC(t[n]);return LC(r);function r(...t){let n=-1;for(;++n<e.length;)if(e[n].call(this,...t))return!0;return!1}}(t):function(t){return LC(e);function e(e){let n;for(n in t)if(e[n]!==t[n])return!1;return!0}}(t);if("function"==typeof t)return LC(t);throw new Error("Expected function, string, or object as test")};function LC(t){return function(e,...n){return Boolean(e&&"object"==typeof e&&"type"in e&&Boolean(t.call(this,e,...n)))}}function FC(){return!0}const NC=!1,BC="skip",UC=function(t,e,n,r){"function"==typeof e&&"function"!=typeof n&&(r=n,n=e,e=null);const i=PC(e),s=r?-1:1;!function t(o,a,l){const c=o&&"object"==typeof o?o:{};if("string"==typeof c.type){const t="string"==typeof c.tagName?c.tagName:"string"==typeof c.name?c.name:void 0;Object.defineProperty(h,"name",{value:"node ("+o.type+(t?"<"+t+">":"")+")"})}return h;function h(){let c,h,u,d=[];if((!e||i(o,a,l[l.length-1]||null))&&(d=function(t){if(Array.isArray(t))return t;if("number"==typeof t)return[true,t];return[t]}(n(o,l)),d[0]===NC))return d;if(o.children&&d[0]!==BC)for(h=(r?o.children.length:-1)+s,u=l.concat(o);h>-1&&h<o.children.length;){if(c=t(o.children[h],h,u)(),c[0]===NC)return c;h="number"==typeof c[1]?c[1]:h+s}return d}}(t,void 0,[])()};const VC=function(t,e,n,r){"function"==typeof e&&"function"!=typeof n&&(r=n,n=e,e=null),UC(t,e,(function(t,e){const r=e[e.length-1];return n(t,r?r.children.indexOf(t):null,r)}),r)};function jC(t,e){let n=!1;return VC(t,(t=>{if("value"in t&&/\r?\n|\r/.test(t.value)||"break"===t.type)return n=!0,NC})),Boolean((!t.depth||t.depth<3)&&Ak(t)&&(e.options.setext||n))}function zC(t){return t.value||""}function GC(t,e,n,r){const i=DC(n),s='"'===i?"Quote":"Apostrophe",o=n.enter("image");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("![");return c+=l.move(n.safe(t.alt,{before:c,after:"]",...l.current()})),c+=l.move("]("),a(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(t.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(t.url,{before:c,after:t.title?" ":")",...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),c+=l.move(" "+i),c+=l.move(n.safe(t.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),c+=l.move(")"),o(),c}function WC(t,e,n,r){const i=t.referenceType,s=n.enter("imageReference");let o=n.enter("label");const a=n.createTracker(r);let l=a.move("![");const c=n.safe(t.alt,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const h=n.stack;n.stack=[],o=n.enter("reference");const u=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=h,s(),"full"!==i&&c&&c===u?"shortcut"===i?l=l.slice(0,-1):l+=a.move("]"):l+=a.move(u+"]"),l}function HC(t){if(!t._compiled){const e=(t.atBreak?"[\\r\\n][\\t ]*":"")+(t.before?"(?:"+t.before+")":"");t._compiled=new RegExp((e?"("+e+")":"")+(/[|\\{}()[\]^$+*?.-]/.test(t.character)?"\\":"")+t.character+(t.after?"(?:"+t.after+")":""),"g")}return t._compiled}function $C(t,e,n){let r=t.value||"",i="`",s=-1;for(;new RegExp("(^|[^`])"+i+"([^`]|$)").test(r);)i+="`";for(/[^ \r\n]/.test(r)&&(/^[ \r\n]/.test(r)&&/[ \r\n]$/.test(r)||/^`|`$/.test(r))&&(r=" "+r+" ");++s<n.unsafe.length;){const t=n.unsafe[s],e=HC(t);let i;if(t.atBreak)for(;i=e.exec(r);){let t=i.index;10===r.charCodeAt(t)&&13===r.charCodeAt(t-1)&&t--,r=r.slice(0,t)+" "+r.slice(i.index+1)}}return i+r+i}function YC(t,e){const n=Ak(t);return Boolean(!e.options.resourceLink&&t.url&&!t.title&&t.children&&1===t.children.length&&"text"===t.children[0].type&&(n===t.url||"mailto:"+n===t.url)&&/^[a-z][a-z+.-]+:/i.test(t.url)&&!/[\0- <>\u007F]/.test(t.url))}function XC(t,e,n,r){const i=DC(n),s='"'===i?"Quote":"Apostrophe",o=n.createTracker(r);let a,l;if(YC(t,n)){const e=n.stack;n.stack=[],a=n.enter("autolink");let r=o.move("<");return r+=o.move(n.containerPhrasing(t,{before:r,after:">",...o.current()})),r+=o.move(">"),a(),n.stack=e,r}a=n.enter("link"),l=n.enter("label");let c=o.move("[");return c+=o.move(n.containerPhrasing(t,{before:c,after:"](",...o.current()})),c+=o.move("]("),l(),!t.url&&t.title||/[\0- \u007F]/.test(t.url)?(l=n.enter("destinationLiteral"),c+=o.move("<"),c+=o.move(n.safe(t.url,{before:c,after:">",...o.current()})),c+=o.move(">")):(l=n.enter("destinationRaw"),c+=o.move(n.safe(t.url,{before:c,after:t.title?" ":")",...o.current()}))),l(),t.title&&(l=n.enter(`title${s}`),c+=o.move(" "+i),c+=o.move(n.safe(t.title,{before:c,after:i,...o.current()})),c+=o.move(i),l()),c+=o.move(")"),a(),c}function qC(t,e,n,r){const i=t.referenceType,s=n.enter("linkReference");let o=n.enter("label");const a=n.createTracker(r);let l=a.move("[");const c=n.containerPhrasing(t,{before:l,after:"]",...a.current()});l+=a.move(c+"]["),o();const h=n.stack;n.stack=[],o=n.enter("reference");const u=n.safe(n.associationId(t),{before:l,after:"]",...a.current()});return o(),n.stack=h,s(),"full"!==i&&c&&c===u?"shortcut"===i?l=l.slice(0,-1):l+=a.move("]"):l+=a.move(u+"]"),l}function KC(t){const e=t.options.bullet||"*";if("*"!==e&&"+"!==e&&"-"!==e)throw new Error("Cannot serialize items with `"+e+"` for `options.bullet`, expected `*`, `+`, or `-`");return e}function ZC(t){const e=t.options.bulletOrdered||".";if("."!==e&&")"!==e)throw new Error("Cannot serialize items with `"+e+"` for `options.bulletOrdered`, expected `.` or `)`");return e}function JC(t){const e=t.options.rule||"*";if("*"!==e&&"-"!==e&&"_"!==e)throw new Error("Cannot serialize rules with `"+e+"` for `options.rule`, expected `*`, `-`, or `_`");return e}function QC(t,e,n,r){const i=function(t){const e=t.options.listItemIndent||"tab";if(1===e||"1"===e)return"one";if("tab"!==e&&"one"!==e&&"mixed"!==e)throw new Error("Cannot serialize items with `"+e+"` for `options.listItemIndent`, expected `tab`, `one`, or `mixed`");return e}(n);let s=n.bulletCurrent||KC(n);e&&"list"===e.type&&e.ordered&&(s=("number"==typeof e.start&&e.start>-1?e.start:1)+(!1===n.options.incrementListMarker?0:e.children.indexOf(t))+s);let o=s.length+1;("tab"===i||"mixed"===i&&(e&&"list"===e.type&&e.spread||t.spread))&&(o=4*Math.ceil(o/4));const a=n.createTracker(r);a.move(s+" ".repeat(o-s.length)),a.shift(o);const l=n.enter("listItem"),c=n.indentLines(n.containerFlow(t,a.current()),(function(t,e,n){if(e)return(n?"":" ".repeat(o))+t;return(n?s:s+" ".repeat(o-s.length))+t}));return l(),c}zC.peek=function(){return"<"},GC.peek=function(){return"!"},WC.peek=function(){return"!"},$C.peek=function(){return"`"},XC.peek=function(t,e,n){return YC(t,n)?"<":"["},qC.peek=function(){return"["};const tR=PC(["break","delete","emphasis","footnote","footnoteReference","image","imageReference","inlineCode","link","linkReference","strong","text"]);function eR(t,e,n,r){const i=function(t){const e=t.options.strong||"*";if("*"!==e&&"_"!==e)throw new Error("Cannot serialize strong with `"+e+"` for `options.strong`, expected `*`, or `_`");return e}(n),s=n.enter("strong"),o=n.createTracker(r);let a=o.move(i+i);return a+=o.move(n.containerPhrasing(t,{before:a,after:i,...o.current()})),a+=o.move(i+i),s(),a}eR.peek=function(t,e,n){return n.options.strong||"*"};const nR={blockquote:function(t,e,n,r){const i=n.enter("blockquote"),s=n.createTracker(r);s.move("> "),s.shift(2);const o=n.indentLines(n.containerFlow(t,s.current()),kC);return i(),o},break:RC,code:function(t,e,n,r){const i=function(t){const e=t.options.fence||"`";if("`"!==e&&"~"!==e)throw new Error("Cannot serialize code with `"+e+"` for `options.fence`, expected `` ` `` or `~`");return e}(n),s=t.value||"",o="`"===i?"GraveAccent":"Tilde";if(MC(t,n)){const t=n.enter("codeIndented"),e=n.indentLines(s,IC);return t(),e}const a=n.createTracker(r),l=i.repeat(Math.max(function(t,e){const n=String(t);let r=n.indexOf(e),i=r,s=0,o=0;if("string"!=typeof e)throw new TypeError("Expected substring");for(;-1!==r;)r===i?++s>o&&(o=s):s=1,i=r+e.length,r=n.indexOf(e,i);return o}(s,i)+1,3)),c=n.enter("codeFenced");let h=a.move(l);if(t.lang){const e=n.enter(`codeFencedLang${o}`);h+=a.move(n.safe(t.lang,{before:h,after:" ",encode:["`"],...a.current()})),e()}if(t.lang&&t.meta){const e=n.enter(`codeFencedMeta${o}`);h+=a.move(" "),h+=a.move(n.safe(t.meta,{before:h,after:"\n",encode:["`"],...a.current()})),e()}return h+=a.move("\n"),s&&(h+=a.move(s+"\n")),h+=a.move(l),c(),h},definition:function(t,e,n,r){const i=DC(n),s='"'===i?"Quote":"Apostrophe",o=n.enter("definition");let a=n.enter("label");const l=n.createTracker(r);let c=l.move("[");return c+=l.move(n.safe(n.associationId(t),{before:c,after:"]",...l.current()})),c+=l.move("]: "),a(),!t.url||/[\0- \u007F]/.test(t.url)?(a=n.enter("destinationLiteral"),c+=l.move("<"),c+=l.move(n.safe(t.url,{before:c,after:">",...l.current()})),c+=l.move(">")):(a=n.enter("destinationRaw"),c+=l.move(n.safe(t.url,{before:c,after:t.title?" ":"\n",...l.current()}))),a(),t.title&&(a=n.enter(`title${s}`),c+=l.move(" "+i),c+=l.move(n.safe(t.title,{before:c,after:i,...l.current()})),c+=l.move(i),a()),o(),c},emphasis:OC,hardBreak:RC,heading:function(t,e,n,r){const i=Math.max(Math.min(6,t.depth||1),1),s=n.createTracker(r);if(jC(t,n)){const e=n.enter("headingSetext"),r=n.enter("phrasing"),o=n.containerPhrasing(t,{...s.current(),before:"\n",after:"\n"});return r(),e(),o+"\n"+(1===i?"=":"-").repeat(o.length-(Math.max(o.lastIndexOf("\r"),o.lastIndexOf("\n"))+1))}const o="#".repeat(i),a=n.enter("headingAtx"),l=n.enter("phrasing");s.move(o+" ");let c=n.containerPhrasing(t,{before:"# ",after:"\n",...s.current()});return/^[\t ]/.test(c)&&(c="&#x"+c.charCodeAt(0).toString(16).toUpperCase()+";"+c.slice(1)),c=c?o+" "+c:o,n.options.closeAtx&&(c+=" "+o),l(),a(),c},html:zC,image:GC,imageReference:WC,inlineCode:$C,link:XC,linkReference:qC,list:function(t,e,n,r){const i=n.enter("list"),s=n.bulletCurrent;let o=t.ordered?ZC(n):KC(n);const a=t.ordered?function(t){const e=ZC(t),n=t.options.bulletOrderedOther;if(!n)return"."===e?")":".";if("."!==n&&")"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOrderedOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bulletOrdered` (`"+e+"`) and `bulletOrderedOther` (`"+n+"`) to be different");return n}(n):function(t){const e=KC(t),n=t.options.bulletOther;if(!n)return"*"===e?"-":"*";if("*"!==n&&"+"!==n&&"-"!==n)throw new Error("Cannot serialize items with `"+n+"` for `options.bulletOther`, expected `*`, `+`, or `-`");if(n===e)throw new Error("Expected `bullet` (`"+e+"`) and `bulletOther` (`"+n+"`) to be different");return n}(n),l=n.bulletLastUsed;let c=!1;if(e&&(t.ordered?n.options.bulletOrderedOther:n.options.bulletOther)&&l&&o===l&&(c=!0),!t.ordered){const e=t.children?t.children[0]:void 0;if("*"!==o&&"-"!==o||!e||e.children&&e.children[0]||"list"!==n.stack[n.stack.length-1]||"listItem"!==n.stack[n.stack.length-2]||"list"!==n.stack[n.stack.length-3]||"listItem"!==n.stack[n.stack.length-4]||0!==n.indexStack[n.indexStack.length-1]||0!==n.indexStack[n.indexStack.length-2]||0!==n.indexStack[n.indexStack.length-3]||(c=!0),JC(n)===o&&e){let e=-1;for(;++e<t.children.length;){const n=t.children[e];if(n&&"listItem"===n.type&&n.children&&n.children[0]&&"thematicBreak"===n.children[0].type){c=!0;break}}}}c&&(o=a),n.bulletCurrent=o;const h=n.containerFlow(t,r);return n.bulletLastUsed=o,n.bulletCurrent=s,i(),h},listItem:QC,paragraph:function(t,e,n,r){const i=n.enter("paragraph"),s=n.enter("phrasing"),o=n.containerPhrasing(t,r);return s(),i(),o},root:function(t,e,n,r){return(t.children.some((t=>tR(t)))?n.containerPhrasing:n.containerFlow).call(n,t,r)},strong:eR,text:function(t,e,n,r){return n.safe(t.value,r)},thematicBreak:function(t,e,n){const r=(JC(n)+(n.options.ruleSpaces?" ":"")).repeat(function(t){const e=t.options.ruleRepetition||3;if(e<3)throw new Error("Cannot serialize rules with repetition `"+e+"` for `options.ruleRepetition`, expected `3` or more");return e}(n));return n.options.ruleSpaces?r.slice(0,-1):r}},rR=[function(t,e,n,r){if("code"===e.type&&MC(e,r)&&("list"===t.type||t.type===e.type&&MC(t,r)))return!1;if("list"===t.type&&t.type===e.type&&Boolean(t.ordered)===Boolean(e.ordered)&&!(t.ordered?r.options.bulletOrderedOther:r.options.bulletOther))return!1;if("spread"in n&&"boolean"==typeof n.spread){if("paragraph"===t.type&&(t.type===e.type||"definition"===e.type||"heading"===e.type&&jC(e,r)))return;return n.spread?1:0}}];const iR=["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"],sR=[{character:"\t",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"\t",before:"[\\r\\n]",inConstruct:"phrasing"},{character:"\t",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"\r",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:"\n",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde","codeFencedMetaGraveAccent","codeFencedMetaTilde","destinationLiteral","headingAtx"]},{character:" ",after:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",before:"[\\r\\n]",inConstruct:"phrasing"},{character:" ",inConstruct:["codeFencedLangGraveAccent","codeFencedLangTilde"]},{character:"!",after:"\\[",inConstruct:"phrasing",notInConstruct:iR},{character:'"',inConstruct:"titleQuote"},{atBreak:!0,character:"#"},{character:"#",inConstruct:"headingAtx",after:"(?:[\r\n]|$)"},{character:"&",after:"[#A-Za-z]",inConstruct:"phrasing"},{character:"'",inConstruct:"titleApostrophe"},{character:"(",inConstruct:"destinationRaw"},{before:"\\]",character:"(",inConstruct:"phrasing",notInConstruct:iR},{atBreak:!0,before:"\\d+",character:")"},{character:")",inConstruct:"destinationRaw"},{atBreak:!0,character:"*",after:"(?:[ \t\r\n*])"},{character:"*",inConstruct:"phrasing",notInConstruct:iR},{atBreak:!0,character:"+",after:"(?:[ \t\r\n])"},{atBreak:!0,character:"-",after:"(?:[ \t\r\n-])"},{atBreak:!0,before:"\\d+",character:".",after:"(?:[ \t\r\n]|$)"},{atBreak:!0,character:"<",after:"[!/?A-Za-z]"},{character:"<",after:"[!/?A-Za-z]",inConstruct:"phrasing",notInConstruct:iR},{character:"<",inConstruct:"destinationLiteral"},{atBreak:!0,character:"="},{atBreak:!0,character:">"},{character:">",inConstruct:"destinationLiteral"},{atBreak:!0,character:"["},{character:"[",inConstruct:"phrasing",notInConstruct:iR},{character:"[",inConstruct:["label","reference"]},{character:"\\",after:"[\\r\\n]",inConstruct:"phrasing"},{character:"]",inConstruct:["label","reference"]},{atBreak:!0,character:"_"},{character:"_",inConstruct:"phrasing",notInConstruct:iR},{atBreak:!0,character:"`"},{character:"`",inConstruct:["codeFencedLangGraveAccent","codeFencedMetaGraveAccent"]},{character:"`",inConstruct:"phrasing",notInConstruct:iR},{atBreak:!0,character:"~"}];function oR(t){return t.label||!t.identifier?t.label||"":uC(t.identifier)}function aR(t,e,n){const r=e.indexStack,i=t.children||[],s=[];let o=-1,a=n.before;r.push(-1);let l=e.createTracker(n);for(;++o<i.length;){const c=i[o];let h;if(r[r.length-1]=o,o+1<i.length){let n=e.handle.handlers[i[o+1].type];n&&n.peek&&(n=n.peek),h=n?n(i[o+1],t,e,{before:"",after:"",...l.current()}).charAt(0):""}else h=n.after;s.length>0&&("\r"===a||"\n"===a)&&"html"===c.type&&(s[s.length-1]=s[s.length-1].replace(/(\r?\n|\r)$/," "),a=" ",l=e.createTracker(n),l.move(s.join(""))),s.push(l.move(e.handle(c,t,e,{...l.current(),before:a,after:h}))),a=s[s.length-1].slice(-1)}return r.pop(),s.join("")}function lR(t,e,n){const r=e.indexStack,i=t.children||[],s=e.createTracker(n),o=[];let a=-1;for(r.push(-1);++a<i.length;){const n=i[a];r[r.length-1]=a,o.push(s.move(e.handle(n,t,e,{before:"\n",after:"\n",...s.current()}))),"list"!==n.type&&(e.bulletLastUsed=void 0),a<i.length-1&&o.push(s.move(cR(n,i[a+1],t,e)))}return r.pop(),o.join("")}function cR(t,e,n,r){let i=r.join.length;for(;i--;){const s=r.join[i](t,e,n,r);if(!0===s||1===s)break;if("number"==typeof s)return"\n".repeat(1+s);if(!1===s)return"\n\n\x3c!----\x3e\n\n"}return"\n\n"}const hR=/\r?\n|\r/g;function uR(t,e){const n=[];let r,i=0,s=0;for(;r=hR.exec(t);)o(t.slice(i,r.index)),n.push(r[0]),i=r.index+r[0].length,s++;return o(t.slice(i)),n.join("");function o(t){n.push(e(t,s,!t))}}function dR(t,e,n){const r=(n.before||"")+(e||"")+(n.after||""),i=[],s=[],o={};let a=-1;for(;++a<t.unsafe.length;){const e=t.unsafe[a];if(!AC(t.stack,e))continue;const n=HC(e);let s;for(;s=n.exec(r);){const t="before"in e||Boolean(e.atBreak),n="after"in e,r=s.index+(t?s[1].length:0);i.includes(r)?(o[r].before&&!t&&(o[r].before=!1),o[r].after&&!n&&(o[r].after=!1)):(i.push(r),o[r]={before:t,after:n})}}i.sort(fR);let l=n.before?n.before.length:0;const c=r.length-(n.after?n.after.length:0);for(a=-1;++a<i.length;){const t=i[a];t<l||t>=c||(t+1<c&&i[a+1]===t+1&&o[t].after&&!o[t+1].before&&!o[t+1].after||i[a-1]===t-1&&o[t].before&&!o[t-1].before&&!o[t-1].after||(l!==t&&s.push(pR(r.slice(l,t),"\\")),l=t,!/[!-/:-@[-`{-~]/.test(r.charAt(t))||n.encode&&n.encode.includes(r.charAt(t))?(s.push("&#x"+r.charCodeAt(t).toString(16).toUpperCase()+";"),l++):s.push("\\")))}return s.push(pR(r.slice(l,c),n.after)),s.join("")}function fR(t,e){return t-e}function pR(t,e){const n=/\\(?=[!-/:-@[-`{-~])/g,r=[],i=[],s=t+e;let o,a=-1,l=0;for(;o=n.exec(s);)r.push(o.index);for(;++a<r.length;)l!==r[a]&&i.push(t.slice(l,r[a])),i.push("\\"),l=r[a];return i.push(t.slice(l)),i.join("")}function mR(t){const e=t||{},n=e.now||{};let r=e.lineShift||0,i=n.line||1,s=n.column||1;return{move:function(t){const e=t||"",n=e.split(/\r?\n|\r/g),o=n[n.length-1];return i+=n.length-1,s=1===n.length?s+o.length:1+o.length+r,e},current:function(){return{now:{line:i,column:s},lineShift:r}},shift:function(t){r+=t}}}function gR(t,e={}){const n={enter:function(t){return n.stack.push(t),function(){n.stack.pop()}},indentLines:uR,associationId:oR,containerPhrasing:xR,containerFlow:wR,createTracker:mR,safe:ER,stack:[],unsafe:[],join:[],handlers:{},options:{},indexStack:[],handle:void 0};TC(n,{unsafe:sR,join:rR,handlers:nR}),TC(n,e),n.options.tightDefinitions&&TC(n,{join:[bR]}),n.handle=function(t,e){const n=e||{};function r(e,...n){let i=r.invalid;const s=r.handlers;if(e&&SC.call(e,t)){const n=String(e[t]);i=SC.call(s,n)?s[n]:r.unknown}if(i)return i.call(this,e,...n)}return r.handlers=n.handlers||{},r.invalid=n.invalid,r.unknown=n.unknown,r}("type",{invalid:vR,unknown:yR,handlers:n.handlers});let r=n.handle(t,void 0,n,{before:"\n",after:"\n",now:{line:1,column:1},lineShift:0});return r&&10!==r.charCodeAt(r.length-1)&&13!==r.charCodeAt(r.length-1)&&(r+="\n"),r}function vR(t){throw new Error("Cannot handle value `"+t+"`, expected node")}function yR(t){throw new Error("Cannot handle unknown node `"+t.type+"`")}function bR(t,e){if("definition"===t.type&&t.type===e.type)return 0}function xR(t,e){return aR(t,this,e)}function wR(t,e){return lR(t,this,e)}function ER(t,e){return dR(this,t,e)}function _R(t){Object.assign(this,{Compiler:e=>{const n=this.data("settings");return gR(e,Object.assign({},n,t,{extensions:this.data("toMarkdownExtensions")||[]}))}})}function SR(t){if(t)throw t}
/*!
 * Determine if an object is a Buffer
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */const TR=ni((function(t){return null!=t&&null!=t.constructor&&"function"==typeof t.constructor.isBuffer&&t.constructor.isBuffer(t)}));var kR=Object.prototype.hasOwnProperty,AR=Object.prototype.toString,CR=Object.defineProperty,RR=Object.getOwnPropertyDescriptor,MR=function(t){return"function"==typeof Array.isArray?Array.isArray(t):"[object Array]"===AR.call(t)},IR=function(t){if(!t||"[object Object]"!==AR.call(t))return!1;var e,n=kR.call(t,"constructor"),r=t.constructor&&t.constructor.prototype&&kR.call(t.constructor.prototype,"isPrototypeOf");if(t.constructor&&!n&&!r)return!1;for(e in t);return void 0===e||kR.call(t,e)},DR=function(t,e){CR&&"__proto__"===e.name?CR(t,e.name,{enumerable:!0,configurable:!0,value:e.newValue,writable:!0}):t[e.name]=e.newValue},OR=function(t,e){if("__proto__"===e){if(!kR.call(t,e))return;if(RR)return RR(t,e).value}return t[e]};const PR=ni((function t(){var e,n,r,i,s,o,a=arguments[0],l=1,c=arguments.length,h=!1;for("boolean"==typeof a&&(h=a,a=arguments[1]||{},l=2),(null==a||"object"!=typeof a&&"function"!=typeof a)&&(a={});l<c;++l)if(null!=(e=arguments[l]))for(n in e)r=OR(a,n),a!==(i=OR(e,n))&&(h&&i&&(IR(i)||(s=MR(i)))?(s?(s=!1,o=r&&MR(r)?r:[]):o=r&&IR(r)?r:{},DR(a,{name:n,newValue:t(h,o,i)})):void 0!==i&&DR(a,{name:n,newValue:i}));return a}));function LR(t){if("object"!=typeof t||null===t)return!1;const e=Object.getPrototypeOf(t);return!(null!==e&&e!==Object.prototype&&null!==Object.getPrototypeOf(e)||Symbol.toStringTag in t||Symbol.iterator in t)}function FR(){const t=[],e={run:function(...e){let n=-1;const r=e.pop();if("function"!=typeof r)throw new TypeError("Expected function as last argument, not "+r);!function i(s,...o){const a=t[++n];let l=-1;if(s)r(s);else{for(;++l<e.length;)null!==o[l]&&void 0!==o[l]||(o[l]=e[l]);e=o,a?function(t,e){let n;return r;function r(...e){const r=t.length>e.length;let a;r&&e.push(i);try{a=t.apply(this,e)}catch(s){if(r&&n)throw s;return i(s)}r||(a instanceof Promise?a.then(o,i):a instanceof Error?i(a):o(a))}function i(t,...r){n||(n=!0,e(t,...r))}function o(t){i(null,t)}}(a,i)(...o):r(null,...o)}}(null,...e)},use:function(n){if("function"!=typeof n)throw new TypeError("Expected `middelware` to be a function, not "+n);return t.push(n),e}};return e}class NR extends Error{constructor(t,e,n){const r=[null,null];let i={start:{line:null,column:null},end:{line:null,column:null}};if(super(),"string"==typeof e&&(n=e,e=void 0),"string"==typeof n){const t=n.indexOf(":");-1===t?r[1]=n:(r[0]=n.slice(0,t),r[1]=n.slice(t+1))}e&&("type"in e||"position"in e?e.position&&(i=e.position):"start"in e||"end"in e?i=e:("line"in e||"column"in e)&&(i.start=e)),this.name=fC(e)||"1:1",this.message="object"==typeof t?t.message:t,this.stack="","object"==typeof t&&t.stack&&(this.stack=t.stack),this.reason=this.message,this.fatal,this.line=i.start.line,this.column=i.start.column,this.position=i,this.source=r[0],this.ruleId=r[1],this.file,this.actual,this.expected,this.url,this.note}}NR.prototype.file="",NR.prototype.name="",NR.prototype.reason="",NR.prototype.message="",NR.prototype.stack="",NR.prototype.fatal=null,NR.prototype.column=null,NR.prototype.line=null,NR.prototype.source=null,NR.prototype.ruleId=null,NR.prototype.position=null;const BR={basename:function(t,e){if(void 0!==e&&"string"!=typeof e)throw new TypeError('"ext" argument must be a string');UR(t);let n,r=0,i=-1,s=t.length;if(void 0===e||0===e.length||e.length>t.length){for(;s--;)if(47===t.charCodeAt(s)){if(n){r=s+1;break}}else i<0&&(n=!0,i=s+1);return i<0?"":t.slice(r,i)}if(e===t)return"";let o=-1,a=e.length-1;for(;s--;)if(47===t.charCodeAt(s)){if(n){r=s+1;break}}else o<0&&(n=!0,o=s+1),a>-1&&(t.charCodeAt(s)===e.charCodeAt(a--)?a<0&&(i=s):(a=-1,i=o));r===i?i=o:i<0&&(i=t.length);return t.slice(r,i)},dirname:function(t){if(UR(t),0===t.length)return".";let e,n=-1,r=t.length;for(;--r;)if(47===t.charCodeAt(r)){if(e){n=r;break}}else e||(e=!0);return n<0?47===t.charCodeAt(0)?"/":".":1===n&&47===t.charCodeAt(0)?"//":t.slice(0,n)},extname:function(t){UR(t);let e,n=t.length,r=-1,i=0,s=-1,o=0;for(;n--;){const a=t.charCodeAt(n);if(47!==a)r<0&&(e=!0,r=n+1),46===a?s<0?s=n:1!==o&&(o=1):s>-1&&(o=-1);else if(e){i=n+1;break}}if(s<0||r<0||0===o||1===o&&s===r-1&&s===i+1)return"";return t.slice(s,r)},join:function(...t){let e,n=-1;for(;++n<t.length;)UR(t[n]),t[n]&&(e=void 0===e?t[n]:e+"/"+t[n]);return void 0===e?".":function(t){UR(t);const e=47===t.charCodeAt(0);let n=function(t,e){let n,r,i="",s=0,o=-1,a=0,l=-1;for(;++l<=t.length;){if(l<t.length)n=t.charCodeAt(l);else{if(47===n)break;n=47}if(47===n){if(o===l-1||1===a);else if(o!==l-1&&2===a){if(i.length<2||2!==s||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2))if(i.length>2){if(r=i.lastIndexOf("/"),r!==i.length-1){r<0?(i="",s=0):(i=i.slice(0,r),s=i.length-1-i.lastIndexOf("/")),o=l,a=0;continue}}else if(i.length>0){i="",s=0,o=l,a=0;continue}e&&(i=i.length>0?i+"/..":"..",s=2)}else i.length>0?i+="/"+t.slice(o+1,l):i=t.slice(o+1,l),s=l-o-1;o=l,a=0}else 46===n&&a>-1?a++:a=-1}return i}(t,!e);0!==n.length||e||(n=".");n.length>0&&47===t.charCodeAt(t.length-1)&&(n+="/");return e?"/"+n:n}(e)},sep:"/"};function UR(t){if("string"!=typeof t)throw new TypeError("Path must be a string. Received "+JSON.stringify(t))}const VR={cwd:function(){return"/"}};function jR(t){return null!==t&&"object"==typeof t&&t.href&&t.origin}function zR(t){if("string"==typeof t)t=new URL(t);else if(!jR(t)){const e=new TypeError('The "path" argument must be of type string or an instance of URL. Received `'+t+"`");throw e.code="ERR_INVALID_ARG_TYPE",e}if("file:"!==t.protocol){const t=new TypeError("The URL must be of scheme file");throw t.code="ERR_INVALID_URL_SCHEME",t}return function(t){if(""!==t.hostname){const t=new TypeError('File URL host must be "localhost" or empty on darwin');throw t.code="ERR_INVALID_FILE_URL_HOST",t}const e=t.pathname;let n=-1;for(;++n<e.length;)if(37===e.charCodeAt(n)&&50===e.charCodeAt(n+1)){const t=e.charCodeAt(n+2);if(70===t||102===t){const t=new TypeError("File URL path must not include encoded / characters");throw t.code="ERR_INVALID_FILE_URL_PATH",t}}return decodeURIComponent(e)}(t)}const GR=["history","path","basename","stem","extname","dirname"];class WR{constructor(t){let e;e=t?"string"==typeof t||function(t){return TR(t)}(t)?{value:t}:jR(t)?{path:t}:t:{},this.data={},this.messages=[],this.history=[],this.cwd=VR.cwd(),this.value,this.stored,this.result,this.map;let n,r=-1;for(;++r<GR.length;){const t=GR[r];t in e&&void 0!==e[t]&&null!==e[t]&&(this[t]="history"===t?[...e[t]]:e[t])}for(n in e)GR.includes(n)||(this[n]=e[n])}get path(){return this.history[this.history.length-1]}set path(t){jR(t)&&(t=zR(t)),$R(t,"path"),this.path!==t&&this.history.push(t)}get dirname(){return"string"==typeof this.path?BR.dirname(this.path):void 0}set dirname(t){YR(this.basename,"dirname"),this.path=BR.join(t||"",this.basename)}get basename(){return"string"==typeof this.path?BR.basename(this.path):void 0}set basename(t){$R(t,"basename"),HR(t,"basename"),this.path=BR.join(this.dirname||"",t)}get extname(){return"string"==typeof this.path?BR.extname(this.path):void 0}set extname(t){if(HR(t,"extname"),YR(this.dirname,"extname"),t){if(46!==t.charCodeAt(0))throw new Error("`extname` must start with `.`");if(t.includes(".",1))throw new Error("`extname` cannot contain multiple dots")}this.path=BR.join(this.dirname,this.stem+(t||""))}get stem(){return"string"==typeof this.path?BR.basename(this.path,this.extname):void 0}set stem(t){$R(t,"stem"),HR(t,"stem"),this.path=BR.join(this.dirname||"",t+(this.extname||""))}toString(t){return(this.value||"").toString(t||void 0)}message(t,e,n){const r=new NR(t,e,n);return this.path&&(r.name=this.path+":"+r.name,r.file=this.path),r.fatal=!1,this.messages.push(r),r}info(t,e,n){const r=this.message(t,e,n);return r.fatal=null,r}fail(t,e,n){const r=this.message(t,e,n);throw r.fatal=!0,r}}function HR(t,e){if(t&&t.includes(BR.sep))throw new Error("`"+e+"` cannot be a path: did not expect `"+BR.sep+"`")}function $R(t,e){if(!t)throw new Error("`"+e+"` cannot be empty")}function YR(t,e){if(!t)throw new Error("Setting `"+e+"` requires `path` to be set too")}const XR=function t(){const e=FR(),n=[];let r,i={},s=-1;return o.data=function(t,e){if("string"==typeof t)return 2===arguments.length?(QR("data",r),i[t]=e,o):qR.call(i,t)&&i[t]||null;if(t)return QR("data",r),i=t,o;return i},o.Parser=void 0,o.Compiler=void 0,o.freeze=function(){if(r)return o;for(;++s<n.length;){const[t,...r]=n[s];if(!1===r[0])continue;!0===r[0]&&(r[0]=void 0);const i=t.call(o,...r);"function"==typeof i&&e.use(i)}return r=!0,s=Number.POSITIVE_INFINITY,o},o.attachers=n,o.use=function(t,...e){let s;if(QR("use",r),null==t);else if("function"==typeof t)h(t,...e);else{if("object"!=typeof t)throw new TypeError("Expected usable value, not `"+t+"`");Array.isArray(t)?c(t):l(t)}s&&(i.settings=Object.assign(i.settings||{},s));return o;function a(t){if("function"==typeof t)h(t);else{if("object"!=typeof t)throw new TypeError("Expected usable value, not `"+t+"`");if(Array.isArray(t)){const[e,...n]=t;h(e,...n)}else l(t)}}function l(t){c(t.plugins),t.settings&&(s=Object.assign(s||{},t.settings))}function c(t){let e=-1;if(null==t);else{if(!Array.isArray(t))throw new TypeError("Expected a list of plugins, not `"+t+"`");for(;++e<t.length;){a(t[e])}}}function h(t,e){let r,i=-1;for(;++i<n.length;)if(n[i][0]===t){r=n[i];break}r?(LR(r[1])&&LR(e)&&(e=PR(!0,r[1],e)),r[1]=e):n.push([...arguments])}},o.parse=function(t){o.freeze();const e=nM(t),n=o.Parser;if(ZR("parse",n),KR(n,"parse"))return new n(String(e),e).parse();return n(String(e),e)},o.stringify=function(t,e){o.freeze();const n=nM(e),r=o.Compiler;if(JR("stringify",r),tM(t),KR(r,"compile"))return new r(t,n).compile();return r(t,n)},o.run=function(t,n,r){tM(t),o.freeze(),r||"function"!=typeof n||(r=n,n=void 0);if(!r)return new Promise(i);function i(i,s){function o(e,n,o){n=n||t,e?s(e):i?i(n):r(null,n,o)}e.run(t,nM(n),o)}i(null,r)},o.runSync=function(t,e){let n,r;return o.run(t,e,i),eM("runSync","run",r),n;function i(t,e){SR(t),n=e,r=!0}},o.process=function(t,e){if(o.freeze(),ZR("process",o.Parser),JR("process",o.Compiler),!e)return new Promise(n);function n(n,r){const i=nM(t);function s(t,i){t||!i?r(t):n?n(i):e(null,i)}o.run(o.parse(i),i,((t,e,n)=>{if(!t&&e&&n){const i=o.stringify(e,n);null==i||("string"==typeof(r=i)||TR(r)?n.value=i:n.result=i),s(t,n)}else s(t);var r}))}n(null,e)},o.processSync=function(t){let e;o.freeze(),ZR("processSync",o.Parser),JR("processSync",o.Compiler);const n=nM(t);return o.process(n,r),eM("processSync","process",e),n;function r(t){e=!0,SR(t)}},o;function o(){const e=t();let r=-1;for(;++r<n.length;)e.use(...n[r]);return e.data(PR(!0,{},i)),e}}().freeze(),qR={}.hasOwnProperty;function KR(t,e){return"function"==typeof t&&t.prototype&&(function(t){let e;for(e in t)if(qR.call(t,e))return!0;return!1}(t.prototype)||e in t.prototype)}function ZR(t,e){if("function"!=typeof e)throw new TypeError("Cannot `"+t+"` without `Parser`")}function JR(t,e){if("function"!=typeof e)throw new TypeError("Cannot `"+t+"` without `Compiler`")}function QR(t,e){if(e)throw new Error("Cannot call `"+t+"` on a frozen processor.\nCreate a new processor first, by calling it: use `processor()` instead of `processor`.")}function tM(t){if(!LR(t)||"string"!=typeof t.type)throw new TypeError("Expected node, got `"+t+"`")}function eM(t,e,n){if(!n)throw new Error("`"+t+"` finished async. Use `"+e+"` instead")}function nM(t){return function(t){return Boolean(t&&"object"==typeof t&&"message"in t&&"messages"in t)}(t)?t:new WR(t)}const rM=function(t){for(var e=0;;e++)if(!(t=t.previousSibling))return e},iM=function(t){let e=t.assignedSlot||t.parentNode;return e&&11==e.nodeType?e.host:e};let sM=null;const oM=function(t,e,n){let r=sM||(sM=document.createRange());return r.setEnd(t,null==n?t.nodeValue.length:n),r.setStart(t,e||0),r},aM=function(t,e,n,r){return n&&(cM(t,e,n,r,-1)||cM(t,e,n,r,1))},lM=/^(img|br|input|textarea|hr)$/i;function cM(t,e,n,r,i){for(;;){if(t==n&&e==r)return!0;if(e==(i<0?0:hM(t))){let n=t.parentNode;if(!n||1!=n.nodeType||uM(t)||lM.test(t.nodeName)||"false"==t.contentEditable)return!1;e=rM(t)+(i<0?0:1),t=n}else{if(1!=t.nodeType)return!1;if("false"==(t=t.childNodes[e+(i<0?-1:0)]).contentEditable)return!1;e=i<0?hM(t):0}}}function hM(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function uM(t){let e;for(let n=t;n&&!(e=n.pmViewDesc);n=n.parentNode);return e&&e.node&&e.node.isBlock&&(e.dom==t||e.contentDOM==t)}const dM=function(t){return t.focusNode&&aM(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset)};function fM(t,e){let n=document.createEvent("Event");return n.initEvent("keydown",!0,!0),n.keyCode=t,n.key=n.code=e,n}const pM="undefined"!=typeof navigator?navigator:null,mM="undefined"!=typeof document?document:null,gM=pM&&pM.userAgent||"",vM=/Edge\/(\d+)/.exec(gM),yM=/MSIE \d/.exec(gM),bM=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(gM),xM=!!(yM||bM||vM),wM=yM?document.documentMode:bM?+bM[1]:vM?+vM[1]:0,EM=!xM&&/gecko\/(\d+)/i.test(gM);EM&&(/Firefox\/(\d+)/.exec(gM)||[0,0])[1];const _M=!xM&&/Chrome\/(\d+)/.exec(gM),SM=!!_M,TM=_M?+_M[1]:0,kM=!xM&&!!pM&&/Apple Computer/.test(pM.vendor),AM=kM&&(/Mobile\/\w+/.test(gM)||!!pM&&pM.maxTouchPoints>2),CM=AM||!!pM&&/Mac/.test(pM.platform),RM=!!pM&&/Win/.test(pM.platform),MM=/Android \d/.test(gM),IM=!!mM&&"webkitFontSmoothing"in mM.documentElement.style,DM=IM?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;function OM(t){return{left:0,right:t.documentElement.clientWidth,top:0,bottom:t.documentElement.clientHeight}}function PM(t,e){return"number"==typeof t?t:t[e]}function LM(t){let e=t.getBoundingClientRect(),n=e.width/t.offsetWidth||1,r=e.height/t.offsetHeight||1;return{left:e.left,right:e.left+t.clientWidth*n,top:e.top,bottom:e.top+t.clientHeight*r}}function FM(t,e,n){let r=t.someProp("scrollThreshold")||0,i=t.someProp("scrollMargin")||5,s=t.dom.ownerDocument;for(let o=n||t.dom;o;o=iM(o)){if(1!=o.nodeType)continue;let t=o,n=t==s.body,a=n?OM(s):LM(t),l=0,c=0;if(e.top<a.top+PM(r,"top")?c=-(a.top-e.top+PM(i,"top")):e.bottom>a.bottom-PM(r,"bottom")&&(c=e.bottom-e.top>a.bottom-a.top?e.top+PM(i,"top")-a.top:e.bottom-a.bottom+PM(i,"bottom")),e.left<a.left+PM(r,"left")?l=-(a.left-e.left+PM(i,"left")):e.right>a.right-PM(r,"right")&&(l=e.right-a.right+PM(i,"right")),l||c)if(n)s.defaultView.scrollBy(l,c);else{let n=t.scrollLeft,r=t.scrollTop;c&&(t.scrollTop+=c),l&&(t.scrollLeft+=l);let i=t.scrollLeft-n,s=t.scrollTop-r;e={left:e.left-i,top:e.top-s,right:e.right-i,bottom:e.bottom-s}}if(n||/^(fixed|sticky)$/.test(getComputedStyle(o).position))break}}function NM(t){let e=[],n=t.ownerDocument;for(let r=t;r&&(e.push({dom:r,top:r.scrollTop,left:r.scrollLeft}),t!=n);r=iM(r));return e}function BM(t,e){for(let n=0;n<t.length;n++){let{dom:r,top:i,left:s}=t[n];r.scrollTop!=i+e&&(r.scrollTop=i+e),r.scrollLeft!=s&&(r.scrollLeft=s)}}let UM=null;function VM(t,e){let n,r,i,s,o=2e8,a=0,l=e.top,c=e.top;for(let h=t.firstChild,u=0;h;h=h.nextSibling,u++){let t;if(1==h.nodeType)t=h.getClientRects();else{if(3!=h.nodeType)continue;t=oM(h).getClientRects()}for(let d=0;d<t.length;d++){let f=t[d];if(f.top<=l&&f.bottom>=c){l=Math.max(f.bottom,l),c=Math.min(f.top,c);let t=f.left>e.left?f.left-e.left:f.right<e.left?e.left-f.right:0;if(t<o){n=h,o=t,r=t&&3==n.nodeType?{left:f.right<e.left?f.right:f.left,top:e.top}:e,1==h.nodeType&&t&&(a=u+(e.left>=(f.left+f.right)/2?1:0));continue}}else f.top>e.top&&!i&&f.left<=e.left&&f.right>=e.left&&(i=h,s={left:Math.max(f.left,Math.min(f.right,e.left)),top:f.top});!n&&(e.left>=f.right&&e.top>=f.top||e.left>=f.left&&e.top>=f.bottom)&&(a=u+1)}}return!n&&i&&(n=i,r=s,o=0),n&&3==n.nodeType?function(t,e){let n=t.nodeValue.length,r=document.createRange();for(let i=0;i<n;i++){r.setEnd(t,i+1),r.setStart(t,i);let n=HM(r,1);if(n.top!=n.bottom&&jM(e,n))return{node:t,offset:i+(e.left>=(n.left+n.right)/2?1:0)}}return{node:t,offset:0}}(n,r):!n||o&&1==n.nodeType?{node:t,offset:a}:VM(n,r)}function jM(t,e){return t.left>=e.left-1&&t.left<=e.right+1&&t.top>=e.top-1&&t.top<=e.bottom+1}function zM(t,e,n){let r=t.childNodes.length;if(r&&n.top<n.bottom)for(let i=Math.max(0,Math.min(r-1,Math.floor(r*(e.top-n.top)/(n.bottom-n.top))-2)),s=i;;){let n=t.childNodes[s];if(1==n.nodeType){let t=n.getClientRects();for(let r=0;r<t.length;r++){let i=t[r];if(jM(e,i))return zM(n,e,i)}}if((s=(s+1)%r)==i)break}return t}function GM(t,e){let n,r=t.dom.ownerDocument,i=0,s=function(t,e,n){if(t.caretPositionFromPoint)try{let r=t.caretPositionFromPoint(e,n);if(r)return{node:r.offsetNode,offset:r.offset}}catch(r){}if(t.caretRangeFromPoint){let r=t.caretRangeFromPoint(e,n);if(r)return{node:r.startContainer,offset:r.startOffset}}}(r,e.left,e.top);s&&({node:n,offset:i}=s);let o,a=(t.root.elementFromPoint?t.root:r).elementFromPoint(e.left,e.top);if(!a||!t.dom.contains(1!=a.nodeType?a.parentNode:a)){let n=t.dom.getBoundingClientRect();if(!jM(e,n))return null;if(a=zM(t.dom,e,n),!a)return null}if(kM)for(let c=a;n&&c;c=iM(c))c.draggable&&(n=void 0);if(a=function(t,e){let n=t.parentNode;return n&&/^li$/i.test(n.nodeName)&&e.left<t.getBoundingClientRect().left?n:t}(a,e),n){if(EM&&1==n.nodeType&&(i=Math.min(i,n.childNodes.length),i<n.childNodes.length)){let t,r=n.childNodes[i];"IMG"==r.nodeName&&(t=r.getBoundingClientRect()).right<=e.left&&t.bottom>e.top&&i++}let r;IM&&i&&1==n.nodeType&&1==(r=n.childNodes[i-1]).nodeType&&"false"==r.contentEditable&&r.getBoundingClientRect().top>=e.top&&i--,n==t.dom&&i==n.childNodes.length-1&&1==n.lastChild.nodeType&&e.top>n.lastChild.getBoundingClientRect().bottom?o=t.state.doc.content.size:0!=i&&1==n.nodeType&&"BR"==n.childNodes[i-1].nodeName||(o=function(t,e,n,r){let i=-1;for(let s=e,o=!1;s!=t.dom;){let e=t.docView.nearestDesc(s,!0);if(!e)return null;if(1==e.dom.nodeType&&(e.node.isBlock&&e.parent&&!o||!e.contentDOM)){let t=e.dom.getBoundingClientRect();if(e.node.isBlock&&e.parent&&!o&&(o=!0,t.left>r.left||t.top>r.top?i=e.posBefore:(t.right<r.left||t.bottom<r.top)&&(i=e.posAfter)),!e.contentDOM&&i<0&&!e.node.isText)return(e.node.isBlock?r.top<(t.top+t.bottom)/2:r.left<(t.left+t.right)/2)?e.posBefore:e.posAfter}s=e.dom.parentNode}return i>-1?i:t.docView.posFromDOM(e,n,-1)}(t,n,i,e))}null==o&&(o=function(t,e,n){let{node:r,offset:i}=VM(e,n),s=-1;if(1==r.nodeType&&!r.firstChild){let t=r.getBoundingClientRect();s=t.left!=t.right&&n.left>(t.left+t.right)/2?1:-1}return t.docView.posFromDOM(r,i,s)}(t,a,e));let l=t.docView.nearestDesc(a,!0);return{pos:o,inside:l?l.posAtStart-l.border:-1}}function WM(t){return t.top<t.bottom||t.left<t.right}function HM(t,e){let n=t.getClientRects();if(n.length){let t=n[e<0?0:n.length-1];if(WM(t))return t}return Array.prototype.find.call(n,WM)||t.getBoundingClientRect()}const $M=/[\u0590-\u05f4\u0600-\u06ff\u0700-\u08ac]/;function YM(t,e,n){let{node:r,offset:i,atom:s}=t.docView.domFromPos(e,n<0?-1:1),o=IM||EM;if(3==r.nodeType){if(!o||!$M.test(r.nodeValue)&&(n<0?i:i!=r.nodeValue.length)){let t=i,e=i,s=n<0?1:-1;return n<0&&!i?(e++,s=-1):n>=0&&i==r.nodeValue.length?(t--,s=1):n<0?t--:e++,XM(HM(oM(r,t,e),s),s<0)}{let t=HM(oM(r,i,i),n);if(EM&&i&&/\s/.test(r.nodeValue[i-1])&&i<r.nodeValue.length){let e=HM(oM(r,i-1,i-1),-1);if(e.top==t.top){let n=HM(oM(r,i,i+1),-1);if(n.top!=t.top)return XM(n,n.left<e.left)}}return t}}if(!t.state.doc.resolve(e-(s||0)).parent.inlineContent){if(null==s&&i&&(n<0||i==hM(r))){let t=r.childNodes[i-1];if(1==t.nodeType)return qM(t.getBoundingClientRect(),!1)}if(null==s&&i<hM(r)){let t=r.childNodes[i];if(1==t.nodeType)return qM(t.getBoundingClientRect(),!0)}return qM(r.getBoundingClientRect(),n>=0)}if(null==s&&i&&(n<0||i==hM(r))){let t=r.childNodes[i-1],e=3==t.nodeType?oM(t,hM(t)-(o?0:1)):1!=t.nodeType||"BR"==t.nodeName&&t.nextSibling?null:t;if(e)return XM(HM(e,1),!1)}if(null==s&&i<hM(r)){let t=r.childNodes[i];for(;t.pmViewDesc&&t.pmViewDesc.ignoreForCoords;)t=t.nextSibling;let e=t?3==t.nodeType?oM(t,0,o?0:1):1==t.nodeType?t:null:null;if(e)return XM(HM(e,-1),!0)}return XM(HM(3==r.nodeType?oM(r):r,-n),n>=0)}function XM(t,e){if(0==t.width)return t;let n=e?t.left:t.right;return{top:t.top,bottom:t.bottom,left:n,right:n}}function qM(t,e){if(0==t.height)return t;let n=e?t.top:t.bottom;return{top:n,bottom:n,left:t.left,right:t.right}}function KM(t,e,n){let r=t.state,i=t.root.activeElement;r!=e&&t.updateState(e),i!=t.dom&&t.focus();try{return n()}finally{r!=e&&t.updateState(r),i!=t.dom&&i&&i.focus()}}const ZM=/[\u0590-\u08ac]/;let JM=null,QM=null,tI=!1;function eI(t,e,n){return JM==e&&QM==n?tI:(JM=e,QM=n,tI="up"==n||"down"==n?function(t,e,n){let r=e.selection,i="up"==n?r.$from:r.$to;return KM(t,e,(()=>{let{node:e}=t.docView.domFromPos(i.pos,"up"==n?-1:1);for(;;){let n=t.docView.nearestDesc(e,!0);if(!n)break;if(n.node.isBlock){e=n.contentDOM||n.dom;break}e=n.dom.parentNode}let r=YM(t,i.pos,1);for(let t=e.firstChild;t;t=t.nextSibling){let e;if(1==t.nodeType)e=t.getClientRects();else{if(3!=t.nodeType)continue;e=oM(t,0,t.nodeValue.length).getClientRects()}for(let t=0;t<e.length;t++){let i=e[t];if(i.bottom>i.top+1&&("up"==n?r.top-i.top>2*(i.bottom-r.top):i.bottom-r.bottom>2*(r.bottom-i.top)))return!1}}return!0}))}(t,e,n):function(t,e,n){let{$head:r}=e.selection;if(!r.parent.isTextblock)return!1;let i=r.parentOffset,s=!i,o=i==r.parent.content.size,a=t.domSelection();return ZM.test(r.parent.textContent)&&a.modify?KM(t,e,(()=>{let{focusNode:e,focusOffset:i,anchorNode:s,anchorOffset:o}=t.domSelectionRange(),l=a.caretBidiLevel;a.modify("move",n,"character");let c=r.depth?t.docView.domAfterPos(r.before()):t.dom,{focusNode:h,focusOffset:u}=t.domSelectionRange(),d=h&&!c.contains(1==h.nodeType?h:h.parentNode)||e==h&&i==u;try{a.collapse(s,o),e&&(e!=s||i!=o)&&a.extend&&a.extend(e,i)}catch(f){}return null!=l&&(a.caretBidiLevel=l),d})):"left"==n||"backward"==n?s:o}(t,e,n))}class nI{constructor(t,e,n,r){this.parent=t,this.children=e,this.dom=n,this.contentDOM=r,this.dirty=0,n.pmViewDesc=this}matchesWidget(t){return!1}matchesMark(t){return!1}matchesNode(t,e,n){return!1}matchesHack(t){return!1}parseRule(){return null}stopEvent(t){return!1}get size(){let t=0;for(let e=0;e<this.children.length;e++)t+=this.children[e].size;return t}get border(){return 0}destroy(){this.parent=void 0,this.dom.pmViewDesc==this&&(this.dom.pmViewDesc=void 0);for(let t=0;t<this.children.length;t++)this.children[t].destroy()}posBeforeChild(t){for(let e=0,n=this.posAtStart;;e++){let r=this.children[e];if(r==t)return n;n+=r.size}}get posBefore(){return this.parent.posBeforeChild(this)}get posAtStart(){return this.parent?this.parent.posBeforeChild(this)+this.border:0}get posAfter(){return this.posBefore+this.size}get posAtEnd(){return this.posAtStart+this.size-2*this.border}localPosFromDOM(t,e,n){if(this.contentDOM&&this.contentDOM.contains(1==t.nodeType?t:t.parentNode)){if(n<0){let n,r;if(t==this.contentDOM)n=t.childNodes[e-1];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.previousSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.previousSibling;return n?this.posBeforeChild(r)+r.size:this.posAtStart}{let n,r;if(t==this.contentDOM)n=t.childNodes[e];else{for(;t.parentNode!=this.contentDOM;)t=t.parentNode;n=t.nextSibling}for(;n&&(!(r=n.pmViewDesc)||r.parent!=this);)n=n.nextSibling;return n?this.posBeforeChild(r):this.posAtEnd}}let r;if(t==this.dom&&this.contentDOM)r=e>rM(this.contentDOM);else if(this.contentDOM&&this.contentDOM!=this.dom&&this.dom.contains(this.contentDOM))r=2&t.compareDocumentPosition(this.contentDOM);else if(this.dom.firstChild){if(0==e)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!1;break}if(e.previousSibling)break}if(null==r&&e==t.childNodes.length)for(let e=t;;e=e.parentNode){if(e==this.dom){r=!0;break}if(e.nextSibling)break}}return(null==r?n>0:r)?this.posAtEnd:this.posAtStart}nearestDesc(t,e=!1){for(let n=!0,r=t;r;r=r.parentNode){let i,s=this.getDesc(r);if(s&&(!e||s.node)){if(!n||!(i=s.nodeDOM)||(1==i.nodeType?i.contains(1==t.nodeType?t:t.parentNode):i==t))return s;n=!1}}}getDesc(t){let e=t.pmViewDesc;for(let n=e;n;n=n.parent)if(n==this)return e}posFromDOM(t,e,n){for(let r=t;r;r=r.parentNode){let i=this.getDesc(r);if(i)return i.localPosFromDOM(t,e,n)}return-1}descAt(t){for(let e=0,n=0;e<this.children.length;e++){let r=this.children[e],i=n+r.size;if(n==t&&i!=n){for(;!r.border&&r.children.length;)r=r.children[0];return r}if(t<i)return r.descAt(t-n-r.border);n=i}}domFromPos(t,e){if(!this.contentDOM)return{node:this.dom,offset:0,atom:t+1};let n=0,r=0;for(let i=0;n<this.children.length;n++){let e=this.children[n],s=i+e.size;if(s>t||e instanceof cI){r=t-i;break}i=s}if(r)return this.children[n].domFromPos(r-this.children[n].border,e);for(let i;n&&!(i=this.children[n-1]).size&&i instanceof rI&&i.side>=0;n--);if(e<=0){let t,r=!0;for(;t=n?this.children[n-1]:null,t&&t.dom.parentNode!=this.contentDOM;n--,r=!1);return t&&e&&r&&!t.border&&!t.domAtom?t.domFromPos(t.size,e):{node:this.contentDOM,offset:t?rM(t.dom)+1:0}}{let t,r=!0;for(;t=n<this.children.length?this.children[n]:null,t&&t.dom.parentNode!=this.contentDOM;n++,r=!1);return t&&r&&!t.border&&!t.domAtom?t.domFromPos(0,e):{node:this.contentDOM,offset:t?rM(t.dom):this.contentDOM.childNodes.length}}}parseRange(t,e,n=0){if(0==this.children.length)return{node:this.contentDOM,from:t,to:e,fromOffset:0,toOffset:this.contentDOM.childNodes.length};let r=-1,i=-1;for(let s=n,o=0;;o++){let n=this.children[o],a=s+n.size;if(-1==r&&t<=a){let i=s+n.border;if(t>=i&&e<=a-n.border&&n.node&&n.contentDOM&&this.contentDOM.contains(n.contentDOM))return n.parseRange(t,e,i);t=s;for(let e=o;e>0;e--){let n=this.children[e-1];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(1)){r=rM(n.dom)+1;break}t-=n.size}-1==r&&(r=0)}if(r>-1&&(a>e||o==this.children.length-1)){e=a;for(let t=o+1;t<this.children.length;t++){let n=this.children[t];if(n.size&&n.dom.parentNode==this.contentDOM&&!n.emptyChildAt(-1)){i=rM(n.dom);break}e+=n.size}-1==i&&(i=this.contentDOM.childNodes.length);break}s=a}return{node:this.contentDOM,from:t,to:e,fromOffset:r,toOffset:i}}emptyChildAt(t){if(this.border||!this.contentDOM||!this.children.length)return!1;let e=this.children[t<0?0:this.children.length-1];return 0==e.size||e.emptyChildAt(t)}domAfterPos(t){let{node:e,offset:n}=this.domFromPos(t,0);if(1!=e.nodeType||n==e.childNodes.length)throw new RangeError("No node after pos "+t);return e.childNodes[n]}setSelection(t,e,n,r=!1){let i=Math.min(t,e),s=Math.max(t,e);for(let d=0,f=0;d<this.children.length;d++){let o=this.children[d],a=f+o.size;if(i>f&&s<a)return o.setSelection(t-f-o.border,e-f-o.border,n,r);f=a}let o=this.domFromPos(t,t?-1:1),a=e==t?o:this.domFromPos(e,e?-1:1),l=n.getSelection(),c=!1;if((EM||kM)&&t==e){let{node:t,offset:e}=o;if(3==t.nodeType){if(c=!(!e||"\n"!=t.nodeValue[e-1]),c&&e==t.nodeValue.length)for(let n,r=t;r;r=r.parentNode){if(n=r.nextSibling){"BR"==n.nodeName&&(o=a={node:n.parentNode,offset:rM(n)+1});break}let t=r.pmViewDesc;if(t&&t.node&&t.node.isBlock)break}}else{let n=t.childNodes[e-1];c=n&&("BR"==n.nodeName||"false"==n.contentEditable)}}if(EM&&l.focusNode&&l.focusNode!=a.node&&1==l.focusNode.nodeType){let t=l.focusNode.childNodes[l.focusOffset];t&&"false"==t.contentEditable&&(r=!0)}if(!(r||c&&kM)&&aM(o.node,o.offset,l.anchorNode,l.anchorOffset)&&aM(a.node,a.offset,l.focusNode,l.focusOffset))return;let h=!1;if((l.extend||t==e)&&!c){l.collapse(o.node,o.offset);try{t!=e&&l.extend(a.node,a.offset),h=!0}catch(u){}}if(!h){if(t>e){let t=o;o=a,a=t}let n=document.createRange();n.setEnd(a.node,a.offset),n.setStart(o.node,o.offset),l.removeAllRanges(),l.addRange(n)}}ignoreMutation(t){return!this.contentDOM&&"selection"!=t.type}get contentLost(){return this.contentDOM&&this.contentDOM!=this.dom&&!this.dom.contains(this.contentDOM)}markDirty(t,e){for(let n=0,r=0;r<this.children.length;r++){let i=this.children[r],s=n+i.size;if(n==s?t<=s&&e>=n:t<s&&e>n){let r=n+i.border,o=s-i.border;if(t>=r&&e<=o)return this.dirty=t==n||e==s?2:1,void(t!=r||e!=o||!i.contentLost&&i.dom.parentNode==this.contentDOM?i.markDirty(t-r,e-r):i.dirty=3);i.dirty=i.dom!=i.contentDOM||i.dom.parentNode!=this.contentDOM||i.children.length?3:2}n=s}this.dirty=2}markParentsDirty(){let t=1;for(let e=this.parent;e;e=e.parent,t++){let n=1==t?2:1;e.dirty<n&&(e.dirty=n)}}get domAtom(){return!1}get ignoreForCoords(){return!1}}class rI extends nI{constructor(t,e,n,r){let i,s=e.type.toDOM;if("function"==typeof s&&(s=s(n,(()=>i?i.parent?i.parent.posBeforeChild(i):void 0:r))),!e.type.spec.raw){if(1!=s.nodeType){let t=document.createElement("span");t.appendChild(s),s=t}s.contentEditable="false",s.classList.add("ProseMirror-widget")}super(t,[],s,null),this.widget=e,this.widget=e,i=this}matchesWidget(t){return 0==this.dirty&&t.type.eq(this.widget.type)}parseRule(){return{ignore:!0}}stopEvent(t){let e=this.widget.spec.stopEvent;return!!e&&e(t)}ignoreMutation(t){return"selection"!=t.type||this.widget.spec.ignoreSelection}destroy(){this.widget.type.destroy(this.dom),super.destroy()}get domAtom(){return!0}get side(){return this.widget.type.side}}class iI extends nI{constructor(t,e,n,r){super(t,[],e,null),this.textDOM=n,this.text=r}get size(){return this.text.length}localPosFromDOM(t,e){return t!=this.textDOM?this.posAtStart+(e?this.size:0):this.posAtStart+e}domFromPos(t){return{node:this.textDOM,offset:t}}ignoreMutation(t){return"characterData"===t.type&&t.target.nodeValue==t.oldValue}}class sI extends nI{constructor(t,e,n,r){super(t,[],n,r),this.mark=e}static create(t,e,n,r){let i=r.nodeViews[e.type.name],s=i&&i(e,r,n);return s&&s.dom||(s=SS.renderSpec(document,e.type.spec.toDOM(e,n))),new sI(t,e,s.dom,s.contentDOM||s.dom)}parseRule(){return 3&this.dirty||this.mark.type.spec.reparseInView?null:{mark:this.mark.type.name,attrs:this.mark.attrs,contentElement:this.contentDOM}}matchesMark(t){return 3!=this.dirty&&this.mark.eq(t)}markDirty(t,e){if(super.markDirty(t,e),0!=this.dirty){let t=this.parent;for(;!t.node;)t=t.parent;t.dirty<this.dirty&&(t.dirty=this.dirty),this.dirty=0}}slice(t,e,n){let r=sI.create(this.parent,this.mark,!0,n),i=this.children,s=this.size;e<s&&(i=EI(i,e,s,n)),t>0&&(i=EI(i,0,t,n));for(let o=0;o<i.length;o++)i[o].parent=r;return r.children=i,r}}class oI extends nI{constructor(t,e,n,r,i,s,o,a,l){super(t,[],i,s),this.node=e,this.outerDeco=n,this.innerDeco=r,this.nodeDOM=o}static create(t,e,n,r,i,s){let o,a=i.nodeViews[e.type.name],l=a&&a(e,i,(()=>o?o.parent?o.parent.posBeforeChild(o):void 0:s),n,r),c=l&&l.dom,h=l&&l.contentDOM;if(e.isText)if(c){if(3!=c.nodeType)throw new RangeError("Text must be rendered as a DOM text node")}else c=document.createTextNode(e.text);else c||({dom:c,contentDOM:h}=SS.renderSpec(document,e.type.spec.toDOM(e)));h||e.isText||"BR"==c.nodeName||(c.hasAttribute("contenteditable")||(c.contentEditable="false"),e.type.spec.draggable&&(c.draggable=!0));let u=c;return c=vI(c,n,e),l?o=new hI(t,e,n,r,c,h||null,u,l,i,s+1):e.isText?new lI(t,e,n,r,c,u,i):new oI(t,e,n,r,c,h||null,u,i,s+1)}parseRule(){if(this.node.type.spec.reparseInView)return null;let t={node:this.node.type.name,attrs:this.node.attrs};if("pre"==this.node.type.whitespace&&(t.preserveWhitespace="full"),this.contentDOM)if(this.contentLost){for(let e=this.children.length-1;e>=0;e--){let n=this.children[e];if(this.dom.contains(n.dom.parentNode)){t.contentElement=n.dom.parentNode;break}}t.contentElement||(t.getContent=()=>S_.empty)}else t.contentElement=this.contentDOM;else t.getContent=()=>this.node.content;return t}matchesNode(t,e,n){return 0==this.dirty&&t.eq(this.node)&&yI(e,this.outerDeco)&&n.eq(this.innerDeco)}get size(){return this.node.nodeSize}get border(){return this.node.isLeaf?0:1}updateChildren(t,e){let n=this.node.inlineContent,r=e,i=t.composing?this.localCompositionInfo(t,e):null,s=i&&i.pos>-1?i:null,o=i&&i.pos<0,a=new xI(this,s&&s.node,t);!function(t,e,n,r){let i=e.locals(t),s=0;if(0==i.length){for(let n=0;n<t.childCount;n++){let o=t.child(n);r(o,i,e.forChild(s,o),n),s+=o.nodeSize}return}let o=0,a=[],l=null;for(let c=0;;){let h,u,d,f;for(;o<i.length&&i[o].to==s;){let t=i[o++];t.widget&&(h?(u||(u=[h])).push(t):h=t)}if(h)if(u){u.sort(wI);for(let t=0;t<u.length;t++)n(u[t],c,!!l)}else n(h,c,!!l);if(l)f=-1,d=l,l=null;else{if(!(c<t.childCount))break;f=c,d=t.child(c++)}for(let t=0;t<a.length;t++)a[t].to<=s&&a.splice(t--,1);for(;o<i.length&&i[o].from<=s&&i[o].to>s;)a.push(i[o++]);let p=s+d.nodeSize;if(d.isText){let t=p;o<i.length&&i[o].from<t&&(t=i[o].from);for(let e=0;e<a.length;e++)a[e].to<t&&(t=a[e].to);t<p&&(l=d.cut(t-s),d=d.cut(0,t-s),p=t,f=-1)}r(d,d.isInline&&!d.isLeaf?a.filter((t=>!t.inline)):a.slice(),e.forChild(s,d),f),s=p}}(this.node,this.innerDeco,((e,i,s)=>{e.spec.marks?a.syncToMarks(e.spec.marks,n,t):e.type.side>=0&&!s&&a.syncToMarks(i==this.node.childCount?C_.none:this.node.child(i).marks,n,t),a.placeWidget(e,t,r)}),((e,s,l,c)=>{let h;a.syncToMarks(e.marks,n,t),a.findNodeMatch(e,s,l,c)||o&&t.state.selection.from>r&&t.state.selection.to<r+e.nodeSize&&(h=a.findIndexWithChild(i.node))>-1&&a.updateNodeAt(e,s,l,h,t)||a.updateNextNode(e,s,l,t,c,r)||a.addNode(e,s,l,t,r),r+=e.nodeSize})),a.syncToMarks([],n,t),this.node.isTextblock&&a.addTextblockHacks(),a.destroyRest(),(a.changed||2==this.dirty)&&(s&&this.protectLocalComposition(t,s),uI(this.contentDOM,this.children,t),AM&&function(t){if("UL"==t.nodeName||"OL"==t.nodeName){let e=t.style.cssText;t.style.cssText=e+"; list-style: square !important",window.getComputedStyle(t).listStyle,t.style.cssText=e}}(this.dom))}localCompositionInfo(t,e){let{from:n,to:r}=t.state.selection;if(!(t.state.selection instanceof ak)||n<e||r>e+this.node.content.size)return null;let i=t.domSelectionRange(),s=function(t,e){for(;;){if(3==t.nodeType)return t;if(1==t.nodeType&&e>0){if(t.childNodes.length>e&&3==t.childNodes[e].nodeType)return t.childNodes[e];e=hM(t=t.childNodes[e-1])}else{if(!(1==t.nodeType&&e<t.childNodes.length))return null;t=t.childNodes[e],e=0}}}(i.focusNode,i.focusOffset);if(!s||!this.dom.contains(s.parentNode))return null;if(this.node.inlineContent){let t=s.nodeValue,i=function(t,e,n,r){for(let i=0,s=0;i<t.childCount&&s<=r;){let o=t.child(i++),a=s;if(s+=o.nodeSize,!o.isText)continue;let l=o.text;for(;i<t.childCount;){let e=t.child(i++);if(s+=e.nodeSize,!e.isText)break;l+=e.text}if(s>=n){if(s>=r&&l.slice(r-e.length-a,r-a)==e)return r-e.length;let t=a<r?l.lastIndexOf(e,r-a-1):-1;if(t>=0&&t+e.length+a>=n)return a+t;if(n==r&&l.length>=r+e.length-a&&l.slice(r-a,r-a+e.length)==e)return r}}return-1}(this.node.content,t,n-e,r-e);return i<0?null:{node:s,pos:i,text:t}}return{node:s,pos:-1,text:""}}protectLocalComposition(t,{node:e,pos:n,text:r}){if(this.getDesc(e))return;let i=e;for(;i.parentNode!=this.contentDOM;i=i.parentNode){for(;i.previousSibling;)i.parentNode.removeChild(i.previousSibling);for(;i.nextSibling;)i.parentNode.removeChild(i.nextSibling);i.pmViewDesc&&(i.pmViewDesc=void 0)}let s=new iI(this,i,e,r);t.input.compositionNodes.push(s),this.children=EI(this.children,n,n+r.length,t,s)}update(t,e,n,r){return!(3==this.dirty||!t.sameMarkup(this.node))&&(this.updateInner(t,e,n,r),!0)}updateInner(t,e,n,r){this.updateOuterDeco(e),this.node=t,this.innerDeco=n,this.contentDOM&&this.updateChildren(r,this.posAtStart),this.dirty=0}updateOuterDeco(t){if(yI(t,this.outerDeco))return;let e=1!=this.nodeDOM.nodeType,n=this.dom;this.dom=mI(this.dom,this.nodeDOM,pI(this.outerDeco,this.node,e),pI(t,this.node,e)),this.dom!=n&&(n.pmViewDesc=void 0,this.dom.pmViewDesc=this),this.outerDeco=t}selectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.add("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||(this.dom.draggable=!0)}deselectNode(){1==this.nodeDOM.nodeType&&this.nodeDOM.classList.remove("ProseMirror-selectednode"),!this.contentDOM&&this.node.type.spec.draggable||this.dom.removeAttribute("draggable")}get domAtom(){return this.node.isAtom}}function aI(t,e,n,r,i){vI(r,e,t);let s=new oI(void 0,t,e,n,r,r,r,i,0);return s.contentDOM&&s.updateChildren(i,0),s}class lI extends oI{constructor(t,e,n,r,i,s,o){super(t,e,n,r,i,null,s,o,0)}parseRule(){let t=this.nodeDOM.parentNode;for(;t&&t!=this.dom&&!t.pmIsDeco;)t=t.parentNode;return{skip:t||!0}}update(t,e,n,r){return!(3==this.dirty||0!=this.dirty&&!this.inParent()||!t.sameMarkup(this.node))&&(this.updateOuterDeco(e),0==this.dirty&&t.text==this.node.text||t.text==this.nodeDOM.nodeValue||(this.nodeDOM.nodeValue=t.text,r.trackWrites==this.nodeDOM&&(r.trackWrites=null)),this.node=t,this.dirty=0,!0)}inParent(){let t=this.parent.contentDOM;for(let e=this.nodeDOM;e;e=e.parentNode)if(e==t)return!0;return!1}domFromPos(t){return{node:this.nodeDOM,offset:t}}localPosFromDOM(t,e,n){return t==this.nodeDOM?this.posAtStart+Math.min(e,this.node.text.length):super.localPosFromDOM(t,e,n)}ignoreMutation(t){return"characterData"!=t.type&&"selection"!=t.type}slice(t,e,n){let r=this.node.cut(t,e),i=document.createTextNode(r.text);return new lI(this.parent,r,this.outerDeco,this.innerDeco,i,i,n)}markDirty(t,e){super.markDirty(t,e),this.dom==this.nodeDOM||0!=t&&e!=this.nodeDOM.nodeValue.length||(this.dirty=3)}get domAtom(){return!1}}class cI extends nI{parseRule(){return{ignore:!0}}matchesHack(t){return 0==this.dirty&&this.dom.nodeName==t}get domAtom(){return!0}get ignoreForCoords(){return"IMG"==this.dom.nodeName}}class hI extends oI{constructor(t,e,n,r,i,s,o,a,l,c){super(t,e,n,r,i,s,o,l,c),this.spec=a}update(t,e,n,r){if(3==this.dirty)return!1;if(this.spec.update){let i=this.spec.update(t,e,n);return i&&this.updateInner(t,e,n,r),i}return!(!this.contentDOM&&!t.isLeaf)&&super.update(t,e,n,r)}selectNode(){this.spec.selectNode?this.spec.selectNode():super.selectNode()}deselectNode(){this.spec.deselectNode?this.spec.deselectNode():super.deselectNode()}setSelection(t,e,n,r){this.spec.setSelection?this.spec.setSelection(t,e,n):super.setSelection(t,e,n,r)}destroy(){this.spec.destroy&&this.spec.destroy(),super.destroy()}stopEvent(t){return!!this.spec.stopEvent&&this.spec.stopEvent(t)}ignoreMutation(t){return this.spec.ignoreMutation?this.spec.ignoreMutation(t):super.ignoreMutation(t)}}function uI(t,e,n){let r=t.firstChild,i=!1;for(let s=0;s<e.length;s++){let o=e[s],a=o.dom;if(a.parentNode==t){for(;a!=r;)r=bI(r),i=!0;r=r.nextSibling}else i=!0,t.insertBefore(a,r);if(o instanceof sI){let e=r?r.previousSibling:t.lastChild;uI(o.contentDOM,o.children,n),r=e?e.nextSibling:t.firstChild}}for(;r;)r=bI(r),i=!0;i&&n.trackWrites==t&&(n.trackWrites=null)}const dI=function(t){t&&(this.nodeName=t)};dI.prototype=Object.create(null);const fI=[new dI];function pI(t,e,n){if(0==t.length)return fI;let r=n?fI[0]:new dI,i=[r];for(let s=0;s<t.length;s++){let o=t[s].type.attrs;if(o){o.nodeName&&i.push(r=new dI(o.nodeName));for(let t in o){let s=o[t];null!=s&&(n&&1==i.length&&i.push(r=new dI(e.isInline?"span":"div")),"class"==t?r.class=(r.class?r.class+" ":"")+s:"style"==t?r.style=(r.style?r.style+";":"")+s:"nodeName"!=t&&(r[t]=s))}}}return i}function mI(t,e,n,r){if(n==fI&&r==fI)return e;let i=e;for(let s=0;s<r.length;s++){let e=r[s],o=n[s];if(s){let n;o&&o.nodeName==e.nodeName&&i!=t&&(n=i.parentNode)&&n.nodeName.toLowerCase()==e.nodeName||(n=document.createElement(e.nodeName),n.pmIsDeco=!0,n.appendChild(i),o=fI[0]),i=n}gI(i,o||fI[0],e)}return i}function gI(t,e,n){for(let r in e)"class"==r||"style"==r||"nodeName"==r||r in n||t.removeAttribute(r);for(let r in n)"class"!=r&&"style"!=r&&"nodeName"!=r&&n[r]!=e[r]&&t.setAttribute(r,n[r]);if(e.class!=n.class){let r=e.class?e.class.split(" ").filter(Boolean):[],i=n.class?n.class.split(" ").filter(Boolean):[];for(let e=0;e<r.length;e++)-1==i.indexOf(r[e])&&t.classList.remove(r[e]);for(let e=0;e<i.length;e++)-1==r.indexOf(i[e])&&t.classList.add(i[e]);0==t.classList.length&&t.removeAttribute("class")}if(e.style!=n.style){if(e.style){let n,r=/\s*([\w\-\xa1-\uffff]+)\s*:(?:"(?:\\.|[^"])*"|'(?:\\.|[^'])*'|\(.*?\)|[^;])*/g;for(;n=r.exec(e.style);)t.style.removeProperty(n[1])}n.style&&(t.style.cssText+=n.style)}}function vI(t,e,n){return mI(t,t,fI,pI(e,n,1!=t.nodeType))}function yI(t,e){if(t.length!=e.length)return!1;for(let n=0;n<t.length;n++)if(!t[n].type.eq(e[n].type))return!1;return!0}function bI(t){let e=t.nextSibling;return t.parentNode.removeChild(t),e}class xI{constructor(t,e,n){this.lock=e,this.view=n,this.index=0,this.stack=[],this.changed=!1,this.top=t,this.preMatch=function(t,e){let n=e,r=n.children.length,i=t.childCount,s=new Map,o=[];t:for(;i>0;){let a;for(;;)if(r){let t=n.children[r-1];if(!(t instanceof sI)){a=t,r--;break}n=t,r=t.children.length}else{if(n==e)break t;r=n.parent.children.indexOf(n),n=n.parent}let l=a.node;if(l){if(l!=t.child(i-1))break;--i,s.set(a,i),o.push(a)}}return{index:i,matched:s,matches:o.reverse()}}(t.node.content,t)}destroyBetween(t,e){if(t!=e){for(let n=t;n<e;n++)this.top.children[n].destroy();this.top.children.splice(t,e-t),this.changed=!0}}destroyRest(){this.destroyBetween(this.index,this.top.children.length)}syncToMarks(t,e,n){let r=0,i=this.stack.length>>1,s=Math.min(i,t.length);for(;r<s&&(r==i-1?this.top:this.stack[r+1<<1]).matchesMark(t[r])&&!1!==t[r].type.spec.spanning;)r++;for(;r<i;)this.destroyRest(),this.top.dirty=0,this.index=this.stack.pop(),this.top=this.stack.pop(),i--;for(;i<t.length;){this.stack.push(this.top,this.index+1);let r=-1;for(let e=this.index;e<Math.min(this.index+3,this.top.children.length);e++){let n=this.top.children[e];if(n.matchesMark(t[i])&&!this.isLocked(n.dom)){r=e;break}}if(r>-1)r>this.index&&(this.changed=!0,this.destroyBetween(this.index,r)),this.top=this.top.children[this.index];else{let r=sI.create(this.top,t[i],e,n);this.top.children.splice(this.index,0,r),this.top=r,this.changed=!0}this.index=0,i++}}findNodeMatch(t,e,n,r){let i,s=-1;if(r>=this.preMatch.index&&(i=this.preMatch.matches[r-this.preMatch.index]).parent==this.top&&i.matchesNode(t,e,n))s=this.top.children.indexOf(i,this.index);else for(let o=this.index,a=Math.min(this.top.children.length,o+5);o<a;o++){let r=this.top.children[o];if(r.matchesNode(t,e,n)&&!this.preMatch.matched.has(r)){s=o;break}}return!(s<0)&&(this.destroyBetween(this.index,s),this.index++,!0)}updateNodeAt(t,e,n,r,i){let s=this.top.children[r];return 3==s.dirty&&s.dom==s.contentDOM&&(s.dirty=2),!!s.update(t,e,n,i)&&(this.destroyBetween(this.index,r),this.index++,!0)}findIndexWithChild(t){for(;;){let e=t.parentNode;if(!e)return-1;if(e==this.top.contentDOM){let e=t.pmViewDesc;if(e)for(let t=this.index;t<this.top.children.length;t++)if(this.top.children[t]==e)return t;return-1}t=e}}updateNextNode(t,e,n,r,i,s){for(let o=this.index;o<this.top.children.length;o++){let a=this.top.children[o];if(a instanceof oI){let l=this.preMatch.matched.get(a);if(null!=l&&l!=i)return!1;let c,h=a.dom,u=this.isLocked(h)&&!(t.isText&&a.node&&a.node.isText&&a.nodeDOM.nodeValue==t.text&&3!=a.dirty&&yI(e,a.outerDeco));if(!u&&a.update(t,e,n,r))return this.destroyBetween(this.index,o),a.dom!=h&&(this.changed=!0),this.index++,!0;if(!u&&(c=this.recreateWrapper(a,t,e,n,r,s)))return this.top.children[this.index]=c,c.contentDOM&&(c.dirty=2,c.updateChildren(r,s+1),c.dirty=0),this.changed=!0,this.index++,!0;break}}return!1}recreateWrapper(t,e,n,r,i,s){if(t.dirty||e.isAtom||!t.children.length||!t.node.content.eq(e.content))return null;let o=oI.create(this.top,e,n,r,i,s);if(o.contentDOM){o.children=t.children,t.children=[];for(let t of o.children)t.parent=o}return t.destroy(),o}addNode(t,e,n,r,i){let s=oI.create(this.top,t,e,n,r,i);s.contentDOM&&s.updateChildren(r,i+1),this.top.children.splice(this.index++,0,s),this.changed=!0}placeWidget(t,e,n){let r=this.index<this.top.children.length?this.top.children[this.index]:null;if(!r||!r.matchesWidget(t)||t!=r.widget&&r.widget.type.toDOM.parentNode){let r=new rI(this.top,t,e,n);this.top.children.splice(this.index++,0,r),this.changed=!0}else this.index++}addTextblockHacks(){let t=this.top.children[this.index-1],e=this.top;for(;t instanceof sI;)e=t,t=e.children[e.children.length-1];(!t||!(t instanceof lI)||/\n$/.test(t.node.text)||this.view.requiresGeckoHackNode&&/\s$/.test(t.node.text))&&((kM||SM)&&t&&"false"==t.dom.contentEditable&&this.addHackNode("IMG",e),this.addHackNode("BR",this.top))}addHackNode(t,e){if(e==this.top&&this.index<e.children.length&&e.children[this.index].matchesHack(t))this.index++;else{let n=document.createElement(t);"IMG"==t&&(n.className="ProseMirror-separator",n.alt=""),"BR"==t&&(n.className="ProseMirror-trailingBreak");let r=new cI(this.top,[],n,null);e!=this.top?e.children.push(r):e.children.splice(this.index++,0,r),this.changed=!0}}isLocked(t){return this.lock&&(t==this.lock||1==t.nodeType&&t.contains(this.lock.parentNode))}}function wI(t,e){return t.type.side-e.type.side}function EI(t,e,n,r,i){let s=[];for(let o=0,a=0;o<t.length;o++){let l=t[o],c=a,h=a+=l.size;c>=n||h<=e?s.push(l):(c<e&&s.push(l.slice(0,e-c,r)),i&&(s.push(i),i=void 0),h>n&&s.push(l.slice(n-c,l.size,r)))}return s}function _I(t,e=null){let n=t.domSelectionRange(),r=t.state.doc;if(!n.focusNode)return null;let i=t.docView.nearestDesc(n.focusNode),s=i&&0==i.size,o=t.docView.posFromDOM(n.focusNode,n.focusOffset,1);if(o<0)return null;let a,l,c=r.resolve(o);if(dM(n)){for(a=c;i&&!i.node;)i=i.parent;let t=i.node;if(i&&t.isAtom&&ck.isSelectable(t)&&i.parent&&(!t.isInline||!function(t,e,n){for(let r=0==e,i=e==hM(t);r||i;){if(t==n)return!0;let e=rM(t);if(!(t=t.parentNode))return!1;r=r&&0==e,i=i&&e==hM(t)}}(n.focusNode,n.focusOffset,i.dom))){let t=i.posBefore;l=new ck(o==t?c:r.resolve(t))}}else{let e=t.docView.posFromDOM(n.anchorNode,n.anchorOffset,1);if(e<0)return null;a=r.resolve(e)}if(!l){l=DI(t,a,c,"pointer"==e||t.state.selection.head<c.pos&&!s?1:-1)}return l}function SI(t){return t.editable?t.hasFocus():PI(t)&&document.activeElement&&document.activeElement.contains(t.dom)}function TI(t,e=!1){let n=t.state.selection;if(MI(t,n),SI(t)){if(!e&&t.input.mouseDown&&t.input.mouseDown.allowDefault&&SM){let e=t.domSelectionRange(),n=t.domObserver.currentSelection;if(e.anchorNode&&n.anchorNode&&aM(e.anchorNode,e.anchorOffset,n.anchorNode,n.anchorOffset))return t.input.mouseDown.delayedSelectionSync=!0,void t.domObserver.setCurSelection()}if(t.domObserver.disconnectSelection(),t.cursorWrapper)!function(t){let e=t.domSelection(),n=document.createRange(),r=t.cursorWrapper.dom,i="IMG"==r.nodeName;i?n.setEnd(r.parentNode,rM(r)+1):n.setEnd(r,0);n.collapse(!1),e.removeAllRanges(),e.addRange(n),!i&&!t.state.selection.visible&&xM&&wM<=11&&(r.disabled=!0,r.disabled=!1)}(t);else{let r,i,{anchor:s,head:o}=n;!kI||n instanceof ak||(n.$from.parent.inlineContent||(r=AI(t,n.from)),n.empty||n.$from.parent.inlineContent||(i=AI(t,n.to))),t.docView.setSelection(s,o,t.root,e),kI&&(r&&RI(r),i&&RI(i)),n.visible?t.dom.classList.remove("ProseMirror-hideselection"):(t.dom.classList.add("ProseMirror-hideselection"),"onselectionchange"in document&&function(t){let e=t.dom.ownerDocument;e.removeEventListener("selectionchange",t.input.hideSelectionGuard);let n=t.domSelectionRange(),r=n.anchorNode,i=n.anchorOffset;e.addEventListener("selectionchange",t.input.hideSelectionGuard=()=>{n.anchorNode==r&&n.anchorOffset==i||(e.removeEventListener("selectionchange",t.input.hideSelectionGuard),setTimeout((()=>{SI(t)&&!t.state.selection.visible||t.dom.classList.remove("ProseMirror-hideselection")}),20))})}(t))}t.domObserver.setCurSelection(),t.domObserver.connectSelection()}}const kI=kM||SM&&TM<63;function AI(t,e){let{node:n,offset:r}=t.docView.domFromPos(e,0),i=r<n.childNodes.length?n.childNodes[r]:null,s=r?n.childNodes[r-1]:null;if(kM&&i&&"false"==i.contentEditable)return CI(i);if(!(i&&"false"!=i.contentEditable||s&&"false"!=s.contentEditable)){if(i)return CI(i);if(s)return CI(s)}}function CI(t){return t.contentEditable="true",kM&&t.draggable&&(t.draggable=!1,t.wasDraggable=!0),t}function RI(t){t.contentEditable="false",t.wasDraggable&&(t.draggable=!0,t.wasDraggable=null)}function MI(t,e){if(e instanceof ck){let n=t.docView.descAt(e.from);n!=t.lastSelectedViewDesc&&(II(t),n&&n.selectNode(),t.lastSelectedViewDesc=n)}else II(t)}function II(t){t.lastSelectedViewDesc&&(t.lastSelectedViewDesc.parent&&t.lastSelectedViewDesc.deselectNode(),t.lastSelectedViewDesc=void 0)}function DI(t,e,n,r){return t.someProp("createSelectionBetween",(r=>r(t,e,n)))||ak.between(e,n,r)}function OI(t){return!(t.editable&&!t.hasFocus())&&PI(t)}function PI(t){let e=t.domSelectionRange();if(!e.anchorNode)return!1;try{return t.dom.contains(3==e.anchorNode.nodeType?e.anchorNode.parentNode:e.anchorNode)&&(t.editable||t.dom.contains(3==e.focusNode.nodeType?e.focusNode.parentNode:e.focusNode))}catch(n){return!1}}function LI(t,e){let{$anchor:n,$head:r}=t.selection,i=e>0?n.max(r):n.min(r),s=i.parent.inlineContent?i.depth?t.doc.resolve(e>0?i.after():i.before()):null:i;return s&&rk.findFrom(s,e)}function FI(t,e){return t.dispatch(t.state.tr.setSelection(e).scrollIntoView()),!0}function NI(t,e,n){let r=t.state.selection;if(!(r instanceof ak)){if(r instanceof ck&&r.node.isInline)return FI(t,new ak(e>0?r.$to:r.$from));{let n=LI(t.state,e);return!!n&&FI(t,n)}}if(n.indexOf("s")>-1){let{$head:n}=r,i=n.textOffset?null:e<0?n.nodeBefore:n.nodeAfter;if(!i||i.isText||!i.isLeaf)return!1;let s=t.state.doc.resolve(n.pos+i.nodeSize*(e<0?-1:1));return FI(t,new ak(r.$anchor,s))}if(!r.empty)return!1;if(t.endOfTextblock(e>0?"forward":"backward")){let n=LI(t.state,e);return!!(n&&n instanceof ck)&&FI(t,n)}if(!(CM&&n.indexOf("m")>-1)){let n,i=r.$head,s=i.textOffset?null:e<0?i.nodeBefore:i.nodeAfter;if(!s||s.isText)return!1;let o=e<0?i.pos-s.nodeSize:i.pos;return!!(s.isAtom||(n=t.docView.descAt(o))&&!n.contentDOM)&&(ck.isSelectable(s)?FI(t,new ck(e<0?t.state.doc.resolve(i.pos-s.nodeSize):i)):!!IM&&FI(t,new ak(t.state.doc.resolve(e<0?o:o+s.nodeSize))))}}function BI(t){return 3==t.nodeType?t.nodeValue.length:t.childNodes.length}function UI(t,e){let n=t.pmViewDesc;return n&&0==n.size&&(e<0||t.nextSibling||"BR"!=t.nodeName)}function VI(t,e){return e<0?function(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=!1;EM&&1==n.nodeType&&r<BI(n)&&UI(n.childNodes[r],-1)&&(o=!0);for(;;)if(r>0){if(1!=n.nodeType)break;{let t=n.childNodes[r-1];if(UI(t,-1))i=n,s=--r;else{if(3!=t.nodeType)break;n=t,r=n.nodeValue.length}}}else{if(jI(n))break;{let e=n.previousSibling;for(;e&&UI(e,-1);)i=n.parentNode,s=rM(e),e=e.previousSibling;if(e)n=e,r=BI(n);else{if(n=n.parentNode,n==t.dom)break;r=0}}}o?zI(t,n,r):i&&zI(t,i,s)}(t):function(t){let e=t.domSelectionRange(),n=e.focusNode,r=e.focusOffset;if(!n)return;let i,s,o=BI(n);for(;;)if(r<o){if(1!=n.nodeType)break;if(!UI(n.childNodes[r],1))break;i=n,s=++r}else{if(jI(n))break;{let e=n.nextSibling;for(;e&&UI(e,1);)i=e.parentNode,s=rM(e)+1,e=e.nextSibling;if(e)n=e,r=0,o=BI(n);else{if(n=n.parentNode,n==t.dom)break;r=o=0}}}i&&zI(t,i,s)}(t)}function jI(t){let e=t.pmViewDesc;return e&&e.node&&e.node.isBlock}function zI(t,e,n){if(3!=e.nodeType){let t,r;(r=function(t,e){for(;t&&e==t.childNodes.length&&!uM(t);)e=rM(t)+1,t=t.parentNode;for(;t&&e<t.childNodes.length;){let n=t.childNodes[e];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;t=n,e=0}}(e,n))?(e=r,n=0):(t=function(t,e){for(;t&&!e&&!uM(t);)e=rM(t),t=t.parentNode;for(;t&&e;){let n=t.childNodes[e-1];if(3==n.nodeType)return n;if(1==n.nodeType&&"false"==n.contentEditable)break;e=(t=n).childNodes.length}}(e,n))&&(e=t,n=t.nodeValue.length)}let r=t.domSelection();if(dM(r)){let t=document.createRange();t.setEnd(e,n),t.setStart(e,n),r.removeAllRanges(),r.addRange(t)}else r.extend&&r.extend(e,n);t.domObserver.setCurSelection();let{state:i}=t;setTimeout((()=>{t.state==i&&TI(t)}),50)}function GI(t,e){let n=t.state.doc.resolve(e);if(!SM&&!RM&&n.parent.inlineContent){let r=t.coordsAtPos(e);if(e>n.start()){let n=t.coordsAtPos(e-1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left<r.left?"ltr":"rtl"}if(e<n.end()){let n=t.coordsAtPos(e+1),i=(n.top+n.bottom)/2;if(i>r.top&&i<r.bottom&&Math.abs(n.left-r.left)>1)return n.left>r.left?"ltr":"rtl"}}return"rtl"==getComputedStyle(t.dom).direction?"rtl":"ltr"}function WI(t,e,n){let r=t.state.selection;if(r instanceof ak&&!r.empty||n.indexOf("s")>-1)return!1;if(CM&&n.indexOf("m")>-1)return!1;let{$from:i,$to:s}=r;if(!i.parent.inlineContent||t.endOfTextblock(e<0?"up":"down")){let n=LI(t.state,e);if(n&&n instanceof ck)return FI(t,n)}if(!i.parent.inlineContent){let n=e<0?i:s,o=r instanceof uk?rk.near(n,e):rk.findFrom(n,e);return!!o&&FI(t,o)}return!1}function HI(t,e){if(!(t.state.selection instanceof ak))return!0;let{$head:n,$anchor:r,empty:i}=t.state.selection;if(!n.sameParent(r))return!0;if(!i)return!1;if(t.endOfTextblock(e>0?"forward":"backward"))return!0;let s=!n.textOffset&&(e<0?n.nodeBefore:n.nodeAfter);if(s&&!s.isText){let r=t.state.tr;return e<0?r.delete(n.pos-s.nodeSize,n.pos):r.delete(n.pos,n.pos+s.nodeSize),t.dispatch(r),!0}return!1}function $I(t,e,n){t.domObserver.stop(),e.contentEditable=n,t.domObserver.start()}function YI(t,e){let n=e.keyCode,r=function(t){let e="";return t.ctrlKey&&(e+="c"),t.metaKey&&(e+="m"),t.altKey&&(e+="a"),t.shiftKey&&(e+="s"),e}(e);if(8==n||CM&&72==n&&"c"==r)return HI(t,-1)||VI(t,-1);if(46==n&&!e.shiftKey||CM&&68==n&&"c"==r)return HI(t,1)||VI(t,1);if(13==n||27==n)return!0;if(37==n||CM&&66==n&&"c"==r){let e=37==n?"ltr"==GI(t,t.state.selection.from)?-1:1:-1;return NI(t,e,r)||VI(t,e)}if(39==n||CM&&70==n&&"c"==r){let e=39==n?"ltr"==GI(t,t.state.selection.from)?1:-1:1;return NI(t,e,r)||VI(t,e)}return 38==n||CM&&80==n&&"c"==r?WI(t,-1,r)||VI(t,-1):40==n||CM&&78==n&&"c"==r?function(t){if(!kM||t.state.selection.$head.parentOffset>0)return!1;let{focusNode:e,focusOffset:n}=t.domSelectionRange();if(e&&1==e.nodeType&&0==n&&e.firstChild&&"false"==e.firstChild.contentEditable){let n=e.firstChild;$I(t,n,"true"),setTimeout((()=>$I(t,n,"false")),20)}return!1}(t)||WI(t,1,r)||VI(t,1):r==(CM?"m":"c")&&(66==n||73==n||89==n||90==n)}function XI(t,e){t.someProp("transformCopied",(n=>{e=n(e,t)}));let n=[],{content:r,openStart:i,openEnd:s}=e;for(;i>1&&s>1&&1==r.childCount&&1==r.firstChild.childCount;){i--,s--;let t=r.firstChild;n.push(t.type.name,t.attrs!=t.type.defaultAttrs?t.attrs:null),r=t.content}let o=t.someProp("clipboardSerializer")||SS.fromSchema(t.state.schema),a=iD(),l=a.createElement("div");l.appendChild(o.serializeFragment(r,{document:a}));let c,h=l.firstChild,u=0;for(;h&&1==h.nodeType&&(c=nD[h.nodeName.toLowerCase()]);){for(let t=c.length-1;t>=0;t--){let e=a.createElement(c[t]);for(;l.firstChild;)e.appendChild(l.firstChild);l.appendChild(e),u++}h=l.firstChild}return h&&1==h.nodeType&&h.setAttribute("data-pm-slice",`${i} ${s}${u?` -${u}`:""} ${JSON.stringify(n)}`),{dom:l,text:t.someProp("clipboardTextSerializer",(n=>n(e,t)))||e.content.textBetween(0,e.content.size,"\n\n")}}function qI(t,e,n,r,i){let s,o,a=i.parent.type.spec.code;if(!n&&!e)return null;let l=e&&(r||a||!n);if(l){if(t.someProp("transformPastedText",(n=>{e=n(e,a||r,t)})),a)return e?new M_(S_.from(t.state.schema.text(e.replace(/\r\n?/g,"\n"))),0,0):M_.empty;let n=t.someProp("clipboardTextParser",(n=>n(e,i,r,t)));if(n)o=n;else{let n=i.marks(),{schema:r}=t.state,o=SS.fromSchema(r);s=document.createElement("div"),e.split(/(?:\r\n?|\n)+/).forEach((t=>{let e=s.appendChild(document.createElement("p"));t&&e.appendChild(o.serializeNode(r.text(t,n)))}))}}else t.someProp("transformPastedHTML",(e=>{n=e(n,t)})),s=function(t){let e=/^(\s*<meta [^>]*>)*/.exec(t);e&&(t=t.slice(e[0].length));let n,r=iD().createElement("div"),i=/<([a-z][^>\s]+)/i.exec(t);(n=i&&nD[i[1].toLowerCase()])&&(t=n.map((t=>"<"+t+">")).join("")+t+n.map((t=>"</"+t+">")).reverse().join(""));if(r.innerHTML=t,n)for(let s=0;s<n.length;s++)r=r.querySelector(n[s])||r;return r}(n),IM&&function(t){let e=t.querySelectorAll(SM?"span:not([class]):not([style])":"span.Apple-converted-space");for(let n=0;n<e.length;n++){let r=e[n];1==r.childNodes.length&&" "==r.textContent&&r.parentNode&&r.parentNode.replaceChild(t.ownerDocument.createTextNode(" "),r)}}(s);let c=s&&s.querySelector("[data-pm-slice]"),h=c&&/^(\d+) (\d+)(?: -(\d+))? (.*)/.exec(c.getAttribute("data-pm-slice")||"");if(h&&h[3])for(let u=+h[3];u>0;u--){let t=s.firstChild;for(;t&&1!=t.nodeType;)t=t.nextSibling;if(!t)break;s=t}if(!o){let e=t.someProp("clipboardParser")||t.someProp("domParser")||pS.fromSchema(t.state.schema);o=e.parseSlice(s,{preserveWhitespace:!(!l&&!h),context:i,ruleFromNode:t=>"BR"!=t.nodeName||t.nextSibling||!t.parentNode||KI.test(t.parentNode.nodeName)?null:{ignore:!0}})}if(h)o=function(t,e){if(!t.size)return t;let n,r=t.content.firstChild.type.schema;try{n=JSON.parse(e)}catch(Ni){return t}let{content:i,openStart:s,openEnd:o}=t;for(let a=n.length-2;a>=0;a-=2){let t=r.nodes[n[a]];if(!t||t.hasRequiredAttrs())break;i=S_.from(t.create(n[a+1],i)),s++,o++}return new M_(i,s,o)}(eD(o,+h[1],+h[2]),h[4]);else if(o=M_.maxOpen(function(t,e){if(t.childCount<2)return t;for(let n=e.depth;n>=0;n--){let r,i=e.node(n).contentMatchAt(e.index(n)),s=[];if(t.forEach((t=>{if(!s)return;let e,n=i.findWrapping(t.type);if(!n)return s=null;if(e=s.length&&r.length&&JI(n,r,t,s[s.length-1],0))s[s.length-1]=e;else{s.length&&(s[s.length-1]=QI(s[s.length-1],r.length));let e=ZI(t,n);s.push(e),i=i.matchType(e.type),r=n}})),s)return S_.from(s)}return t}(o.content,i),!0),o.openStart||o.openEnd){let t=0,e=0;for(let n=o.content.firstChild;t<o.openStart&&!n.type.spec.isolating;t++,n=n.firstChild);for(let n=o.content.lastChild;e<o.openEnd&&!n.type.spec.isolating;e++,n=n.lastChild);o=eD(o,t,e)}return t.someProp("transformPasted",(e=>{o=e(o,t)})),o}const KI=/^(a|abbr|acronym|b|cite|code|del|em|i|ins|kbd|label|output|q|ruby|s|samp|span|strong|sub|sup|time|u|tt|var)$/i;function ZI(t,e,n=0){for(let r=e.length-1;r>=n;r--)t=e[r].create(null,S_.from(t));return t}function JI(t,e,n,r,i){if(i<t.length&&i<e.length&&t[i]==e[i]){let s=JI(t,e,n,r.lastChild,i+1);if(s)return r.copy(r.content.replaceChild(r.childCount-1,s));if(r.contentMatchAt(r.childCount).matchType(i==t.length-1?n.type:t[i+1]))return r.copy(r.content.append(S_.from(ZI(n,t,i+1))))}}function QI(t,e){if(0==e)return t;let n=t.content.replaceChild(t.childCount-1,QI(t.lastChild,e-1)),r=t.contentMatchAt(t.childCount).fillBefore(S_.empty,!0);return t.copy(n.append(r))}function tD(t,e,n,r,i,s){let o=e<0?t.firstChild:t.lastChild,a=o.content;return t.childCount>1&&(s=0),i<r-1&&(a=tD(a,e,n,r,i+1,s)),i>=n&&(a=e<0?o.contentMatchAt(0).fillBefore(a,s<=i).append(a):a.append(o.contentMatchAt(o.childCount).fillBefore(S_.empty,!0))),t.replaceChild(e<0?0:t.childCount-1,o.copy(a))}function eD(t,e,n){return e<t.openStart&&(t=new M_(tD(t.content,-1,e,t.openStart,0,t.openEnd),e,t.openEnd)),n<t.openEnd&&(t=new M_(tD(t.content,1,n,t.openEnd,0,0),t.openStart,n)),t}const nD={thead:["table"],tbody:["table"],tfoot:["table"],caption:["table"],colgroup:["table"],col:["table","colgroup"],tr:["table","tbody"],td:["table","tbody","tr"],th:["table","tbody","tr"]};let rD=null;function iD(){return rD||(rD=document.implementation.createHTMLDocument("title"))}const sD={},oD={},aD={touchstart:!0,touchmove:!0};class lD{constructor(){this.shiftKey=!1,this.mouseDown=null,this.lastKeyCode=null,this.lastKeyCodeTime=0,this.lastClick={time:0,x:0,y:0,type:""},this.lastSelectionOrigin=null,this.lastSelectionTime=0,this.lastIOSEnter=0,this.lastIOSEnterFallbackTimeout=-1,this.lastFocus=0,this.lastTouch=0,this.lastAndroidDelete=0,this.composing=!1,this.composingTimeout=-1,this.compositionNodes=[],this.compositionEndedAt=-2e8,this.compositionID=1,this.compositionPendingChanges=0,this.domChangeCount=0,this.eventHandlers=Object.create(null),this.hideSelectionGuard=null}}function cD(t,e){t.input.lastSelectionOrigin=e,t.input.lastSelectionTime=Date.now()}function hD(t){t.someProp("handleDOMEvents",(e=>{for(let n in e)t.input.eventHandlers[n]||t.dom.addEventListener(n,t.input.eventHandlers[n]=e=>uD(t,e))}))}function uD(t,e){return t.someProp("handleDOMEvents",(n=>{let r=n[e.type];return!!r&&(r(t,e)||e.defaultPrevented)}))}function dD(t,e){if(!e.bubbles)return!0;if(e.defaultPrevented)return!1;for(let n=e.target;n!=t.dom;n=n.parentNode)if(!n||11==n.nodeType||n.pmViewDesc&&n.pmViewDesc.stopEvent(e))return!1;return!0}function fD(t){return{left:t.clientX,top:t.clientY}}function pD(t,e,n,r,i){if(-1==r)return!1;let s=t.state.doc.resolve(r);for(let o=s.depth+1;o>0;o--)if(t.someProp(e,(e=>o>s.depth?e(t,n,s.nodeAfter,s.before(o),i,!0):e(t,n,s.node(o),s.before(o),i,!1))))return!0;return!1}function mD(t,e,n){t.focused||t.focus();let r=t.state.tr.setSelection(e);"pointer"==n&&r.setMeta("pointer",!0),t.dispatch(r)}function gD(t,e,n,r,i){return pD(t,"handleClickOn",e,n,r)||t.someProp("handleClick",(n=>n(t,e,r)))||(i?function(t,e){if(-1==e)return!1;let n,r,i=t.state.selection;i instanceof ck&&(n=i.node);let s=t.state.doc.resolve(e);for(let o=s.depth+1;o>0;o--){let t=o>s.depth?s.nodeAfter:s.node(o);if(ck.isSelectable(t)){r=n&&i.$from.depth>0&&o>=i.$from.depth&&s.before(i.$from.depth+1)==i.$from.pos?s.before(i.$from.depth):s.before(o);break}}return null!=r&&(mD(t,ck.create(t.state.doc,r),"pointer"),!0)}(t,n):function(t,e){if(-1==e)return!1;let n=t.state.doc.resolve(e),r=n.nodeAfter;return!!(r&&r.isAtom&&ck.isSelectable(r))&&(mD(t,new ck(n),"pointer"),!0)}(t,n))}function vD(t,e,n,r){return pD(t,"handleDoubleClickOn",e,n,r)||t.someProp("handleDoubleClick",(n=>n(t,e,r)))}function yD(t,e,n,r){return pD(t,"handleTripleClickOn",e,n,r)||t.someProp("handleTripleClick",(n=>n(t,e,r)))||function(t,e,n){if(0!=n.button)return!1;let r=t.state.doc;if(-1==e)return!!r.inlineContent&&(mD(t,ak.create(r,0,r.content.size),"pointer"),!0);let i=r.resolve(e);for(let s=i.depth+1;s>0;s--){let e=s>i.depth?i.nodeAfter:i.node(s),n=i.before(s);if(e.inlineContent)mD(t,ak.create(r,n+1,n+1+e.content.size),"pointer");else{if(!ck.isSelectable(e))continue;mD(t,ck.create(r,n),"pointer")}return!0}}(t,n,r)}function bD(t){return kD(t)}oD.keydown=(t,e)=>{let n=e;if(t.input.shiftKey=16==n.keyCode||n.shiftKey,!ED(t,n)&&(t.input.lastKeyCode=n.keyCode,t.input.lastKeyCodeTime=Date.now(),!MM||!SM||13!=n.keyCode))if(229!=n.keyCode&&t.domObserver.forceFlush(),!AM||13!=n.keyCode||n.ctrlKey||n.altKey||n.metaKey)t.someProp("handleKeyDown",(e=>e(t,n)))||YI(t,n)?n.preventDefault():cD(t,"key");else{let e=Date.now();t.input.lastIOSEnter=e,t.input.lastIOSEnterFallbackTimeout=setTimeout((()=>{t.input.lastIOSEnter==e&&(t.someProp("handleKeyDown",(e=>e(t,fM(13,"Enter")))),t.input.lastIOSEnter=0)}),200)}},oD.keyup=(t,e)=>{16==e.keyCode&&(t.input.shiftKey=!1)},oD.keypress=(t,e)=>{let n=e;if(ED(t,n)||!n.charCode||n.ctrlKey&&!n.altKey||CM&&n.metaKey)return;if(t.someProp("handleKeyPress",(e=>e(t,n))))return void n.preventDefault();let r=t.state.selection;if(!(r instanceof ak&&r.$from.sameParent(r.$to))){let e=String.fromCharCode(n.charCode);/[\r\n]/.test(e)||t.someProp("handleTextInput",(n=>n(t,r.$from.pos,r.$to.pos,e)))||t.dispatch(t.state.tr.insertText(e).scrollIntoView()),n.preventDefault()}};const xD=CM?"metaKey":"ctrlKey";sD.mousedown=(t,e)=>{let n=e;t.input.shiftKey=n.shiftKey;let r=bD(t),i=Date.now(),s="singleClick";i-t.input.lastClick.time<500&&function(t,e){let n=e.x-t.clientX,r=e.y-t.clientY;return n*n+r*r<100}(n,t.input.lastClick)&&!n[xD]&&("singleClick"==t.input.lastClick.type?s="doubleClick":"doubleClick"==t.input.lastClick.type&&(s="tripleClick")),t.input.lastClick={time:i,x:n.clientX,y:n.clientY,type:s};let o=t.posAtCoords(fD(n));o&&("singleClick"==s?(t.input.mouseDown&&t.input.mouseDown.done(),t.input.mouseDown=new wD(t,o,n,!!r)):("doubleClick"==s?vD:yD)(t,o.pos,o.inside,n)?n.preventDefault():cD(t,"pointer"))};class wD{constructor(t,e,n,r){let i,s;if(this.view=t,this.pos=e,this.event=n,this.flushed=r,this.delayedSelectionSync=!1,this.mightDrag=null,this.startDoc=t.state.doc,this.selectNode=!!n[xD],this.allowDefault=n.shiftKey,e.inside>-1)i=t.state.doc.nodeAt(e.inside),s=e.inside;else{let n=t.state.doc.resolve(e.pos);i=n.parent,s=n.depth?n.before():0}const o=r?null:n.target,a=o?t.docView.nearestDesc(o,!0):null;this.target=a?a.dom:null;let{selection:l}=t.state;(0==n.button&&i.type.spec.draggable&&!1!==i.type.spec.selectable||l instanceof ck&&l.from<=s&&l.to>s)&&(this.mightDrag={node:i,pos:s,addAttr:!(!this.target||this.target.draggable),setUneditable:!(!this.target||!EM||this.target.hasAttribute("contentEditable"))}),this.target&&this.mightDrag&&(this.mightDrag.addAttr||this.mightDrag.setUneditable)&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&(this.target.draggable=!0),this.mightDrag.setUneditable&&setTimeout((()=>{this.view.input.mouseDown==this&&this.target.setAttribute("contentEditable","false")}),20),this.view.domObserver.start()),t.root.addEventListener("mouseup",this.up=this.up.bind(this)),t.root.addEventListener("mousemove",this.move=this.move.bind(this)),cD(t,"pointer")}done(){this.view.root.removeEventListener("mouseup",this.up),this.view.root.removeEventListener("mousemove",this.move),this.mightDrag&&this.target&&(this.view.domObserver.stop(),this.mightDrag.addAttr&&this.target.removeAttribute("draggable"),this.mightDrag.setUneditable&&this.target.removeAttribute("contentEditable"),this.view.domObserver.start()),this.delayedSelectionSync&&setTimeout((()=>TI(this.view))),this.view.input.mouseDown=null}up(t){if(this.done(),!this.view.dom.contains(t.target))return;let e=this.pos;this.view.state.doc!=this.startDoc&&(e=this.view.posAtCoords(fD(t))),this.updateAllowDefault(t),this.allowDefault||!e?cD(this.view,"pointer"):gD(this.view,e.pos,e.inside,t,this.selectNode)?t.preventDefault():0==t.button&&(this.flushed||kM&&this.mightDrag&&!this.mightDrag.node.isAtom||SM&&!this.view.state.selection.visible&&Math.min(Math.abs(e.pos-this.view.state.selection.from),Math.abs(e.pos-this.view.state.selection.to))<=2)?(mD(this.view,rk.near(this.view.state.doc.resolve(e.pos)),"pointer"),t.preventDefault()):cD(this.view,"pointer")}move(t){this.updateAllowDefault(t),cD(this.view,"pointer"),0==t.buttons&&this.done()}updateAllowDefault(t){!this.allowDefault&&(Math.abs(this.event.x-t.clientX)>4||Math.abs(this.event.y-t.clientY)>4)&&(this.allowDefault=!0)}}function ED(t,e){return!!t.composing||!!(kM&&Math.abs(e.timeStamp-t.input.compositionEndedAt)<500)&&(t.input.compositionEndedAt=-2e8,!0)}sD.touchstart=t=>{t.input.lastTouch=Date.now(),bD(t),cD(t,"pointer")},sD.touchmove=t=>{t.input.lastTouch=Date.now(),cD(t,"pointer")},sD.contextmenu=t=>bD(t);const _D=MM?5e3:-1;function SD(t,e){clearTimeout(t.input.composingTimeout),e>-1&&(t.input.composingTimeout=setTimeout((()=>kD(t)),e))}function TD(t){for(t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=function(){let t=document.createEvent("Event");return t.initEvent("event",!0,!0),t.timeStamp}());t.input.compositionNodes.length>0;)t.input.compositionNodes.pop().markParentsDirty()}function kD(t,e=!1){if(!(MM&&t.domObserver.flushingSoon>=0)){if(t.domObserver.forceFlush(),TD(t),e||t.docView&&t.docView.dirty){let e=_I(t);return e&&!e.eq(t.state.selection)?t.dispatch(t.state.tr.setSelection(e)):t.updateState(t.state),!0}return!1}}oD.compositionstart=oD.compositionupdate=t=>{if(!t.composing){t.domObserver.flush();let{state:e}=t,n=e.selection.$from;if(e.selection.empty&&(e.storedMarks||!n.textOffset&&n.parentOffset&&n.nodeBefore.marks.some((t=>!1===t.type.spec.inclusive))))t.markCursor=t.state.storedMarks||n.marks(),kD(t,!0),t.markCursor=null;else if(kD(t),EM&&e.selection.empty&&n.parentOffset&&!n.textOffset&&n.nodeBefore.marks.length){let e=t.domSelectionRange();for(let n=e.focusNode,r=e.focusOffset;n&&1==n.nodeType&&0!=r;){let e=r<0?n.lastChild:n.childNodes[r-1];if(!e)break;if(3==e.nodeType){t.domSelection().collapse(e,e.nodeValue.length);break}n=e,r=-1}}t.input.composing=!0}SD(t,_D)},oD.compositionend=(t,e)=>{t.composing&&(t.input.composing=!1,t.input.compositionEndedAt=e.timeStamp,t.input.compositionPendingChanges=t.domObserver.pendingRecords().length?t.input.compositionID:0,t.input.compositionPendingChanges&&Promise.resolve().then((()=>t.domObserver.flush())),t.input.compositionID++,SD(t,20))};const AD=xM&&wM<15||AM&&DM<604;function CD(t,e,n,r,i){let s=qI(t,e,n,r,t.state.selection.$from);if(t.someProp("handlePaste",(e=>e(t,i,s||M_.empty))))return!0;if(!s)return!1;let o=function(t){return 0==t.openStart&&0==t.openEnd&&1==t.content.childCount?t.content.firstChild:null}(s),a=o?t.state.tr.replaceSelectionWith(o,r):t.state.tr.replaceSelection(s);return t.dispatch(a.scrollIntoView().setMeta("paste",!0).setMeta("uiEvent","paste")),!0}sD.copy=oD.cut=(t,e)=>{let n=e,r=t.state.selection,i="cut"==n.type;if(r.empty)return;let s=AD?null:n.clipboardData,o=r.content(),{dom:a,text:l}=XI(t,o);s?(n.preventDefault(),s.clearData(),s.setData("text/html",a.innerHTML),s.setData("text/plain",l)):function(t,e){if(!t.dom.parentNode)return;let n=t.dom.parentNode.appendChild(document.createElement("div"));n.appendChild(e),n.style.cssText="position: fixed; left: -10000px; top: 10px";let r=getSelection(),i=document.createRange();i.selectNodeContents(e),t.dom.blur(),r.removeAllRanges(),r.addRange(i),setTimeout((()=>{n.parentNode&&n.parentNode.removeChild(n),t.focus()}),50)}(t,a),i&&t.dispatch(t.state.tr.deleteSelection().scrollIntoView().setMeta("uiEvent","cut"))},oD.paste=(t,e)=>{let n=e;if(t.composing&&!MM)return;let r=AD?null:n.clipboardData,i=t.input.shiftKey&&45!=t.input.lastKeyCode;r&&CD(t,r.getData("text/plain"),r.getData("text/html"),i,n)?n.preventDefault():function(t,e){if(!t.dom.parentNode)return;let n=t.input.shiftKey||t.state.selection.$from.parent.type.spec.code,r=t.dom.parentNode.appendChild(document.createElement(n?"textarea":"div"));n||(r.contentEditable="true"),r.style.cssText="position: fixed; left: -10000px; top: 10px",r.focus();let i=t.input.shiftKey&&45!=t.input.lastKeyCode;setTimeout((()=>{t.focus(),r.parentNode&&r.parentNode.removeChild(r),n?CD(t,r.value,null,i,e):CD(t,r.textContent,r.innerHTML,i,e)}),50)}(t,n)};class RD{constructor(t,e){this.slice=t,this.move=e}}const MD=CM?"altKey":"ctrlKey";sD.dragstart=(t,e)=>{let n=e,r=t.input.mouseDown;if(r&&r.done(),!n.dataTransfer)return;let i=t.state.selection,s=i.empty?null:t.posAtCoords(fD(n));if(s&&s.pos>=i.from&&s.pos<=(i instanceof ck?i.to-1:i.to));else if(r&&r.mightDrag)t.dispatch(t.state.tr.setSelection(ck.create(t.state.doc,r.mightDrag.pos)));else if(n.target&&1==n.target.nodeType){let e=t.docView.nearestDesc(n.target,!0);e&&e.node.type.spec.draggable&&e!=t.docView&&t.dispatch(t.state.tr.setSelection(ck.create(t.state.doc,e.posBefore)))}let o=t.state.selection.content(),{dom:a,text:l}=XI(t,o);n.dataTransfer.clearData(),n.dataTransfer.setData(AD?"Text":"text/html",a.innerHTML),n.dataTransfer.effectAllowed="copyMove",AD||n.dataTransfer.setData("text/plain",l),t.dragging=new RD(o,!n[MD])},sD.dragend=t=>{let e=t.dragging;window.setTimeout((()=>{t.dragging==e&&(t.dragging=null)}),50)},oD.dragover=oD.dragenter=(t,e)=>e.preventDefault(),oD.drop=(t,e)=>{let n=e,r=t.dragging;if(t.dragging=null,!n.dataTransfer)return;let i=t.posAtCoords(fD(n));if(!i)return;let s=t.state.doc.resolve(i.pos),o=r&&r.slice;o?t.someProp("transformPasted",(e=>{o=e(o,t)})):o=qI(t,n.dataTransfer.getData(AD?"Text":"text/plain"),AD?null:n.dataTransfer.getData("text/html"),!1,s);let a=!(!r||n[MD]);if(t.someProp("handleDrop",(e=>e(t,n,o||M_.empty,a))))return void n.preventDefault();if(!o)return;n.preventDefault();let l=o?jT(t.state.doc,s.pos,o):s.pos;null==l&&(l=s.pos);let c=t.state.tr;a&&c.deleteSelection();let h=c.mapping.map(l),u=0==o.openStart&&0==o.openEnd&&1==o.content.childCount,d=c.doc;if(u?c.replaceRangeWith(h,h,o.content.firstChild):c.replaceRange(h,h,o),c.doc.eq(d))return;let f=c.doc.resolve(h);if(u&&ck.isSelectable(o.content.firstChild)&&f.nodeAfter&&f.nodeAfter.sameMarkup(o.content.firstChild))c.setSelection(new ck(f));else{let e=c.mapping.map(l);c.mapping.maps[c.mapping.maps.length-1].forEach(((t,n,r,i)=>e=i)),c.setSelection(DI(t,f,c.doc.resolve(e)))}t.focus(),t.dispatch(c.setMeta("uiEvent","drop"))},sD.focus=t=>{t.input.lastFocus=Date.now(),t.focused||(t.domObserver.stop(),t.dom.classList.add("ProseMirror-focused"),t.domObserver.start(),t.focused=!0,setTimeout((()=>{t.docView&&t.hasFocus()&&!t.domObserver.currentSelection.eq(t.domSelectionRange())&&TI(t)}),20))},sD.blur=(t,e)=>{let n=e;t.focused&&(t.domObserver.stop(),t.dom.classList.remove("ProseMirror-focused"),t.domObserver.start(),n.relatedTarget&&t.dom.contains(n.relatedTarget)&&t.domObserver.currentSelection.clear(),t.focused=!1)},sD.beforeinput=(t,e)=>{if(SM&&MM&&"deleteContentBackward"==e.inputType){t.domObserver.flushSoon();let{domChangeCount:e}=t.input;setTimeout((()=>{if(t.input.domChangeCount!=e)return;if(t.dom.blur(),t.focus(),t.someProp("handleKeyDown",(e=>e(t,fM(8,"Backspace")))))return;let{$cursor:n}=t.state.selection;n&&n.pos>0&&t.dispatch(t.state.tr.delete(n.pos-1,n.pos).scrollIntoView())}),50)}};for(let os in oD)sD[os]=oD[os];function ID(t,e){if(t==e)return!0;for(let n in t)if(t[n]!==e[n])return!1;for(let n in e)if(!(n in t))return!1;return!0}class DD{constructor(t,e){this.toDOM=t,this.spec=e||ND,this.side=this.spec.side||0}map(t,e,n,r){let{pos:i,deleted:s}=t.mapResult(e.from+r,this.side<0?-1:1);return s?null:new LD(i-n,i-n,this)}valid(){return!0}eq(t){return this==t||t instanceof DD&&(this.spec.key&&this.spec.key==t.spec.key||this.toDOM==t.toDOM&&ID(this.spec,t.spec))}destroy(t){this.spec.destroy&&this.spec.destroy(t)}}class OD{constructor(t,e){this.attrs=t,this.spec=e||ND}map(t,e,n,r){let i=t.map(e.from+r,this.spec.inclusiveStart?-1:1)-n,s=t.map(e.to+r,this.spec.inclusiveEnd?1:-1)-n;return i>=s?null:new LD(i,s,this)}valid(t,e){return e.from<e.to}eq(t){return this==t||t instanceof OD&&ID(this.attrs,t.attrs)&&ID(this.spec,t.spec)}static is(t){return t.type instanceof OD}destroy(){}}class PD{constructor(t,e){this.attrs=t,this.spec=e||ND}map(t,e,n,r){let i=t.mapResult(e.from+r,1);if(i.deleted)return null;let s=t.mapResult(e.to+r,-1);return s.deleted||s.pos<=i.pos?null:new LD(i.pos-n,s.pos-n,this)}valid(t,e){let n,{index:r,offset:i}=t.content.findIndex(e.from);return i==e.from&&!(n=t.child(r)).isText&&i+n.nodeSize==e.to}eq(t){return this==t||t instanceof PD&&ID(this.attrs,t.attrs)&&ID(this.spec,t.spec)}destroy(){}}class LD{constructor(t,e,n){this.from=t,this.to=e,this.type=n}copy(t,e){return new LD(t,e,this.type)}eq(t,e=0){return this.type.eq(t.type)&&this.from+e==t.from&&this.to+e==t.to}map(t,e,n){return this.type.map(t,this,e,n)}static widget(t,e,n){return new LD(t,t,new DD(e,n))}static inline(t,e,n,r){return new LD(t,e,new OD(n,r))}static node(t,e,n,r){return new LD(t,e,new PD(n,r))}get spec(){return this.type.spec}get inline(){return this.type instanceof OD}get widget(){return this.type instanceof DD}}const FD=[],ND={};class BD{constructor(t,e){this.local=t.length?t:FD,this.children=e.length?e:FD}static create(t,e){return e.length?WD(e,t,0,ND):UD}find(t,e,n){let r=[];return this.findInner(null==t?0:t,null==e?1e9:e,r,0,n),r}findInner(t,e,n,r,i){for(let s=0;s<this.local.length;s++){let o=this.local[s];o.from<=e&&o.to>=t&&(!i||i(o.spec))&&n.push(o.copy(o.from+r,o.to+r))}for(let s=0;s<this.children.length;s+=3)if(this.children[s]<e&&this.children[s+1]>t){let o=this.children[s]+1;this.children[s+2].findInner(t-o,e-o,n,r+o,i)}}map(t,e,n){return this==UD||0==t.maps.length?this:this.mapInner(t,e,0,0,n||ND)}mapInner(t,e,n,r,i){let s;for(let o=0;o<this.local.length;o++){let a=this.local[o].map(t,n,r);a&&a.type.valid(e,a)?(s||(s=[])).push(a):i.onRemove&&i.onRemove(this.local[o].spec)}return this.children.length?function(t,e,n,r,i,s,o){let a=t.slice();for(let c=0,h=s;c<n.maps.length;c++){let t=0;n.maps[c].forEach(((e,n,r,s)=>{let o=s-r-(n-e);for(let l=0;l<a.length;l+=3){let s=a[l+1];if(s<0||e>s+h-t)continue;let c=a[l]+h-t;n>=c?a[l+1]=e<=c?-2:-1:r>=i&&o&&(a[l]+=o,a[l+1]+=o)}t+=o})),h=n.maps[c].map(h,-1)}let l=!1;for(let c=0;c<a.length;c+=3)if(a[c+1]<0){if(-2==a[c+1]){l=!0,a[c+1]=-1;continue}let e=n.map(t[c]+s),h=e-i;if(h<0||h>=r.content.size){l=!0;continue}let u=n.map(t[c+1]+s,-1)-i,{index:d,offset:f}=r.content.findIndex(h),p=r.maybeChild(d);if(p&&f==h&&f+p.nodeSize==u){let r=a[c+2].mapInner(n,p,e+1,t[c]+s+1,o);r!=UD?(a[c]=h,a[c+1]=u,a[c+2]=r):(a[c+1]=-2,l=!0)}else l=!0}if(l){let l=function(t,e,n,r,i,s,o){function a(t,e){for(let s=0;s<t.local.length;s++){let a=t.local[s].map(r,i,e);a?n.push(a):o.onRemove&&o.onRemove(t.local[s].spec)}for(let n=0;n<t.children.length;n+=3)a(t.children[n+2],t.children[n]+e+1)}for(let l=0;l<t.length;l+=3)-1==t[l+1]&&a(t[l+2],e[l]+s+1);return n}(a,t,e,n,i,s,o),c=WD(l,r,0,o);e=c.local;for(let t=0;t<a.length;t+=3)a[t+1]<0&&(a.splice(t,3),t-=3);for(let t=0,e=0;t<c.children.length;t+=3){let n=c.children[t];for(;e<a.length&&a[e]<n;)e+=3;a.splice(e,0,c.children[t],c.children[t+1],c.children[t+2])}}return new BD(e.sort(HD),a)}(this.children,s||[],t,e,n,r,i):s?new BD(s.sort(HD),FD):UD}add(t,e){return e.length?this==UD?BD.create(t,e):this.addInner(t,e,0):this}addInner(t,e,n){let r,i=0;t.forEach(((t,s)=>{let o,a=s+n;if(o=zD(e,t,a)){for(r||(r=this.children.slice());i<r.length&&r[i]<s;)i+=3;r[i]==s?r[i+2]=r[i+2].addInner(t,o,a+1):r.splice(i,0,s,s+t.nodeSize,WD(o,t,a+1,ND)),i+=3}}));let s=jD(i?GD(e):e,-n);for(let o=0;o<s.length;o++)s[o].type.valid(t,s[o])||s.splice(o--,1);return new BD(s.length?this.local.concat(s).sort(HD):this.local,r||this.children)}remove(t){return 0==t.length||this==UD?this:this.removeInner(t,0)}removeInner(t,e){let n=this.children,r=this.local;for(let i=0;i<n.length;i+=3){let r,s=n[i]+e,o=n[i+1]+e;for(let e,n=0;n<t.length;n++)(e=t[n])&&e.from>s&&e.to<o&&(t[n]=null,(r||(r=[])).push(e));if(!r)continue;n==this.children&&(n=this.children.slice());let a=n[i+2].removeInner(r,s+1);a!=UD?n[i+2]=a:(n.splice(i,3),i-=3)}if(r.length)for(let i,s=0;s<t.length;s++)if(i=t[s])for(let t=0;t<r.length;t++)r[t].eq(i,e)&&(r==this.local&&(r=this.local.slice()),r.splice(t--,1));return n==this.children&&r==this.local?this:r.length||n.length?new BD(r,n):UD}forChild(t,e){if(this==UD)return this;if(e.isLeaf)return BD.empty;let n,r;for(let o=0;o<this.children.length;o+=3)if(this.children[o]>=t){this.children[o]==t&&(n=this.children[o+2]);break}let i=t+1,s=i+e.content.size;for(let o=0;o<this.local.length;o++){let t=this.local[o];if(t.from<s&&t.to>i&&t.type instanceof OD){let e=Math.max(i,t.from)-i,n=Math.min(s,t.to)-i;e<n&&(r||(r=[])).push(t.copy(e,n))}}if(r){let t=new BD(r.sort(HD),FD);return n?new VD([t,n]):t}return n||UD}eq(t){if(this==t)return!0;if(!(t instanceof BD)||this.local.length!=t.local.length||this.children.length!=t.children.length)return!1;for(let e=0;e<this.local.length;e++)if(!this.local[e].eq(t.local[e]))return!1;for(let e=0;e<this.children.length;e+=3)if(this.children[e]!=t.children[e]||this.children[e+1]!=t.children[e+1]||!this.children[e+2].eq(t.children[e+2]))return!1;return!0}locals(t){return $D(this.localsInner(t))}localsInner(t){if(this==UD)return FD;if(t.inlineContent||!this.local.some(OD.is))return this.local;let e=[];for(let n=0;n<this.local.length;n++)this.local[n].type instanceof OD||e.push(this.local[n]);return e}}BD.empty=new BD([],[]),BD.removeOverlap=$D;const UD=BD.empty;class VD{constructor(t){this.members=t}map(t,e){const n=this.members.map((n=>n.map(t,e,ND)));return VD.from(n)}forChild(t,e){if(e.isLeaf)return BD.empty;let n=[];for(let r=0;r<this.members.length;r++){let i=this.members[r].forChild(t,e);i!=UD&&(i instanceof VD?n=n.concat(i.members):n.push(i))}return VD.from(n)}eq(t){if(!(t instanceof VD)||t.members.length!=this.members.length)return!1;for(let e=0;e<this.members.length;e++)if(!this.members[e].eq(t.members[e]))return!1;return!0}locals(t){let e,n=!0;for(let r=0;r<this.members.length;r++){let i=this.members[r].localsInner(t);if(i.length)if(e){n&&(e=e.slice(),n=!1);for(let t=0;t<i.length;t++)e.push(i[t])}else e=i}return e?$D(n?e:e.sort(HD)):FD}static from(t){switch(t.length){case 0:return UD;case 1:return t[0];default:return new VD(t.every((t=>t instanceof BD))?t:t.reduce(((t,e)=>t.concat(e instanceof BD?e:e.members)),[]))}}}function jD(t,e){if(!e||!t.length)return t;let n=[];for(let r=0;r<t.length;r++){let i=t[r];n.push(new LD(i.from+e,i.to+e,i.type))}return n}function zD(t,e,n){if(e.isLeaf)return null;let r=n+e.nodeSize,i=null;for(let s,o=0;o<t.length;o++)(s=t[o])&&s.from>n&&s.to<r&&((i||(i=[])).push(s),t[o]=null);return i}function GD(t){let e=[];for(let n=0;n<t.length;n++)null!=t[n]&&e.push(t[n]);return e}function WD(t,e,n,r){let i=[],s=!1;e.forEach(((e,o)=>{let a=zD(t,e,o+n);if(a){s=!0;let t=WD(a,e,n+o+1,r);t!=UD&&i.push(o,o+e.nodeSize,t)}}));let o=jD(s?GD(t):t,-n).sort(HD);for(let a=0;a<o.length;a++)o[a].type.valid(e,o[a])||(r.onRemove&&r.onRemove(o[a].spec),o.splice(a--,1));return o.length||i.length?new BD(o,i):UD}function HD(t,e){return t.from-e.from||t.to-e.to}function $D(t){let e=t;for(let n=0;n<e.length-1;n++){let r=e[n];if(r.from!=r.to)for(let i=n+1;i<e.length;i++){let s=e[i];if(s.from!=r.from){s.from<r.to&&(e==t&&(e=t.slice()),e[n]=r.copy(r.from,s.from),YD(e,i,r.copy(s.from,r.to)));break}s.to!=r.to&&(e==t&&(e=t.slice()),e[i]=s.copy(s.from,r.to),YD(e,i+1,s.copy(r.to,s.to)))}}return e}function YD(t,e,n){for(;e<t.length&&HD(n,t[e])>0;)e++;t.splice(e,0,n)}function XD(t){let e=[];return t.someProp("decorations",(n=>{let r=n(t.state);r&&r!=UD&&e.push(r)})),t.cursorWrapper&&e.push(BD.create(t.state.doc,[t.cursorWrapper.deco])),VD.from(e)}const qD={childList:!0,characterData:!0,characterDataOldValue:!0,attributes:!0,attributeOldValue:!0,subtree:!0},KD=xM&&wM<=11;class ZD{constructor(){this.anchorNode=null,this.anchorOffset=0,this.focusNode=null,this.focusOffset=0}set(t){this.anchorNode=t.anchorNode,this.anchorOffset=t.anchorOffset,this.focusNode=t.focusNode,this.focusOffset=t.focusOffset}clear(){this.anchorNode=this.focusNode=null}eq(t){return t.anchorNode==this.anchorNode&&t.anchorOffset==this.anchorOffset&&t.focusNode==this.focusNode&&t.focusOffset==this.focusOffset}}class JD{constructor(t,e){this.view=t,this.handleDOMChange=e,this.queue=[],this.flushingSoon=-1,this.observer=null,this.currentSelection=new ZD,this.onCharData=null,this.suppressingSelectionUpdates=!1,this.observer=window.MutationObserver&&new window.MutationObserver((t=>{for(let e=0;e<t.length;e++)this.queue.push(t[e]);xM&&wM<=11&&t.some((t=>"childList"==t.type&&t.removedNodes.length||"characterData"==t.type&&t.oldValue.length>t.target.nodeValue.length))?this.flushSoon():this.flush()})),KD&&(this.onCharData=t=>{this.queue.push({target:t.target,type:"characterData",oldValue:t.prevValue}),this.flushSoon()}),this.onSelectionChange=this.onSelectionChange.bind(this)}flushSoon(){this.flushingSoon<0&&(this.flushingSoon=window.setTimeout((()=>{this.flushingSoon=-1,this.flush()}),20))}forceFlush(){this.flushingSoon>-1&&(window.clearTimeout(this.flushingSoon),this.flushingSoon=-1,this.flush())}start(){this.observer&&(this.observer.takeRecords(),this.observer.observe(this.view.dom,qD)),this.onCharData&&this.view.dom.addEventListener("DOMCharacterDataModified",this.onCharData),this.connectSelection()}stop(){if(this.observer){let t=this.observer.takeRecords();if(t.length){for(let e=0;e<t.length;e++)this.queue.push(t[e]);window.setTimeout((()=>this.flush()),20)}this.observer.disconnect()}this.onCharData&&this.view.dom.removeEventListener("DOMCharacterDataModified",this.onCharData),this.disconnectSelection()}connectSelection(){this.view.dom.ownerDocument.addEventListener("selectionchange",this.onSelectionChange)}disconnectSelection(){this.view.dom.ownerDocument.removeEventListener("selectionchange",this.onSelectionChange)}suppressSelectionUpdates(){this.suppressingSelectionUpdates=!0,setTimeout((()=>this.suppressingSelectionUpdates=!1),50)}onSelectionChange(){if(OI(this.view)){if(this.suppressingSelectionUpdates)return TI(this.view);if(xM&&wM<=11&&!this.view.state.selection.empty){let t=this.view.domSelectionRange();if(t.focusNode&&aM(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset))return this.flushSoon()}this.flush()}}setCurSelection(){this.currentSelection.set(this.view.domSelectionRange())}ignoreSelectionChange(t){if(!t.focusNode)return!0;let e,n=new Set;for(let i=t.focusNode;i;i=iM(i))n.add(i);for(let i=t.anchorNode;i;i=iM(i))if(n.has(i)){e=i;break}let r=e&&this.view.docView.nearestDesc(e);return r&&r.ignoreMutation({type:"selection",target:3==e.nodeType?e.parentNode:e})?(this.setCurSelection(),!0):void 0}pendingRecords(){if(this.observer)for(let t of this.observer.takeRecords())this.queue.push(t);return this.queue}flush(){let{view:t}=this;if(!t.docView||this.flushingSoon>-1)return;let e=this.pendingRecords();e.length&&(this.queue=[]);let n=t.domSelectionRange(),r=!this.suppressingSelectionUpdates&&!this.currentSelection.eq(n)&&OI(t)&&!this.ignoreSelectionChange(n),i=-1,s=-1,o=!1,a=[];if(t.editable)for(let c=0;c<e.length;c++){let t=this.registerMutation(e[c],a);t&&(i=i<0?t.from:Math.min(t.from,i),s=s<0?t.to:Math.max(t.to,s),t.typeOver&&(o=!0))}if(EM&&a.length>1){let t=a.filter((t=>"BR"==t.nodeName));if(2==t.length){let e=t[0],n=t[1];e.parentNode&&e.parentNode.parentNode==n.parentNode?n.remove():e.remove()}}let l=null;i<0&&r&&t.input.lastFocus>Date.now()-200&&Math.max(t.input.lastTouch,t.input.lastClick.time)<Date.now()-300&&dM(n)&&(l=_I(t))&&l.eq(rk.near(t.state.doc.resolve(0),1))?(t.input.lastFocus=0,TI(t),this.currentSelection.set(n),t.scrollToSelection()):(i>-1||r)&&(i>-1&&(t.docView.markDirty(i,s),function(t){if(QD.has(t))return;if(QD.set(t,null),-1!==["normal","nowrap","pre-line"].indexOf(getComputedStyle(t.dom).whiteSpace)){if(t.requiresGeckoHackNode=EM,tO)return;tO=!0}}(t)),this.handleDOMChange(i,s,o,a),t.docView&&t.docView.dirty?t.updateState(t.state):this.currentSelection.eq(n)||TI(t),this.currentSelection.set(n))}registerMutation(t,e){if(e.indexOf(t.target)>-1)return null;let n=this.view.docView.nearestDesc(t.target);if("attributes"==t.type&&(n==this.view.docView||"contenteditable"==t.attributeName||"style"==t.attributeName&&!t.oldValue&&!t.target.getAttribute("style")))return null;if(!n||n.ignoreMutation(t))return null;if("childList"==t.type){for(let n=0;n<t.addedNodes.length;n++)e.push(t.addedNodes[n]);if(n.contentDOM&&n.contentDOM!=n.dom&&!n.contentDOM.contains(t.target))return{from:n.posBefore,to:n.posAfter};let r=t.previousSibling,i=t.nextSibling;if(xM&&wM<=11&&t.addedNodes.length)for(let e=0;e<t.addedNodes.length;e++){let{previousSibling:n,nextSibling:s}=t.addedNodes[e];(!n||Array.prototype.indexOf.call(t.addedNodes,n)<0)&&(r=n),(!s||Array.prototype.indexOf.call(t.addedNodes,s)<0)&&(i=s)}let s=r&&r.parentNode==t.target?rM(r)+1:0,o=n.localPosFromDOM(t.target,s,-1),a=i&&i.parentNode==t.target?rM(i):t.target.childNodes.length;return{from:o,to:n.localPosFromDOM(t.target,a,1)}}return"attributes"==t.type?{from:n.posAtStart-n.border,to:n.posAtEnd+n.border}:{from:n.posAtStart,to:n.posAtEnd,typeOver:t.target.nodeValue==t.oldValue}}}let QD=new WeakMap,tO=!1;function eO(t){let e=t.pmViewDesc;if(e)return e.parseRule();if("BR"==t.nodeName&&t.parentNode){if(kM&&/^(ul|ol)$/i.test(t.parentNode.nodeName)){let t=document.createElement("div");return t.appendChild(document.createElement("li")),{skip:t}}if(t.parentNode.lastChild==t||kM&&/^(tr|table)$/i.test(t.parentNode.nodeName))return{ignore:!0}}else if("IMG"==t.nodeName&&t.getAttribute("mark-placeholder"))return{ignore:!0};return null}const nO=/^(a|abbr|acronym|b|bd[io]|big|br|button|cite|code|data(list)?|del|dfn|em|i|ins|kbd|label|map|mark|meter|output|q|ruby|s|samp|small|span|strong|su[bp]|time|u|tt|var)$/i;function rO(t,e,n,r,i){let s=t.input.compositionPendingChanges||(t.composing?t.input.compositionID:0);if(t.input.compositionPendingChanges=0,e<0){let e=t.input.lastSelectionTime>Date.now()-50?t.input.lastSelectionOrigin:null,n=_I(t,e);if(n&&!t.state.selection.eq(n)){if(SM&&MM&&13===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime&&t.someProp("handleKeyDown",(e=>e(t,fM(13,"Enter")))))return;let r=t.state.tr.setSelection(n);"pointer"==e?r.setMeta("pointer",!0):"key"==e&&r.scrollIntoView(),s&&r.setMeta("composition",s),t.dispatch(r)}return}let o=t.state.doc.resolve(e),a=o.sharedDepth(n);e=o.before(a+1),n=t.state.doc.resolve(n).after(a+1);let l,c,h=t.state.selection,u=function(t,e,n){let r,{node:i,fromOffset:s,toOffset:o,from:a,to:l}=t.docView.parseRange(e,n),c=t.domSelectionRange(),h=c.anchorNode;if(h&&t.dom.contains(1==h.nodeType?h:h.parentNode)&&(r=[{node:h,offset:c.anchorOffset}],dM(c)||r.push({node:c.focusNode,offset:c.focusOffset})),SM&&8===t.input.lastKeyCode)for(let g=o;g>s;g--){let t=i.childNodes[g-1],e=t.pmViewDesc;if("BR"==t.nodeName&&!e){o=g;break}if(!e||e.size)break}let u=t.state.doc,d=t.someProp("domParser")||pS.fromSchema(t.state.schema),f=u.resolve(a),p=null,m=d.parse(i,{topNode:f.parent,topMatch:f.parent.contentMatchAt(f.index()),topOpen:!0,from:s,to:o,preserveWhitespace:"pre"!=f.parent.type.whitespace||"full",findPositions:r,ruleFromNode:eO,context:f});if(r&&null!=r[0].pos){let t=r[0].pos,e=r[1]&&r[1].pos;null==e&&(e=t),p={anchor:t+a,head:e+a}}return{doc:m,sel:p,from:a,to:l}}(t,e,n),d=t.state.doc,f=d.slice(u.from,u.to);8===t.input.lastKeyCode&&Date.now()-100<t.input.lastKeyCodeTime?(l=t.state.selection.to,c="end"):(l=t.state.selection.from,c="start"),t.input.lastKeyCode=null;let p=function(t,e,n,r,i){let s=t.findDiffStart(e,n);if(null==s)return null;let{a:o,b:a}=t.findDiffEnd(e,n+t.size,n+e.size);if("end"==i){r-=o+Math.max(0,s-Math.min(o,a))-s}if(o<s&&t.size<e.size){s-=r<=s&&r>=o?s-r:0,a=s+(a-o),o=s}else if(a<s){s-=r<=s&&r>=a?s-r:0,o=s+(o-a),a=s}return{start:s,endA:o,endB:a}}(f.content,u.doc.content,u.from,l,c);if((AM&&t.input.lastIOSEnter>Date.now()-225||MM)&&i.some((t=>1==t.nodeType&&!nO.test(t.nodeName)))&&(!p||p.endA>=p.endB)&&t.someProp("handleKeyDown",(e=>e(t,fM(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(!p){if(!(r&&h instanceof ak&&!h.empty&&h.$head.sameParent(h.$anchor))||t.composing||u.sel&&u.sel.anchor!=u.sel.head){if(u.sel){let e=iO(t,t.state.doc,u.sel);if(e&&!e.eq(t.state.selection)){let n=t.state.tr.setSelection(e);s&&n.setMeta("composition",s),t.dispatch(n)}}return}p={start:h.from,endA:h.to,endB:h.to}}if(SM&&t.cursorWrapper&&u.sel&&u.sel.anchor==t.cursorWrapper.deco.from&&u.sel.head==u.sel.anchor){let t=p.endB-p.start;u.sel={anchor:u.sel.anchor+t,head:u.sel.anchor+t}}t.input.domChangeCount++,t.state.selection.from<t.state.selection.to&&p.start==p.endB&&t.state.selection instanceof ak&&(p.start>t.state.selection.from&&p.start<=t.state.selection.from+2&&t.state.selection.from>=u.from?p.start=t.state.selection.from:p.endA<t.state.selection.to&&p.endA>=t.state.selection.to-2&&t.state.selection.to<=u.to&&(p.endB+=t.state.selection.to-p.endA,p.endA=t.state.selection.to)),xM&&wM<=11&&p.endB==p.start+1&&p.endA==p.start&&p.start>u.from&&"  "==u.doc.textBetween(p.start-u.from-1,p.start-u.from+1)&&(p.start--,p.endA--,p.endB--);let m,g=u.doc.resolveNoCache(p.start-u.from),v=u.doc.resolveNoCache(p.endB-u.from),y=d.resolve(p.start),b=g.sameParent(v)&&g.parent.inlineContent&&y.end()>=p.endA;if((AM&&t.input.lastIOSEnter>Date.now()-225&&(!b||i.some((t=>"DIV"==t.nodeName||"P"==t.nodeName)))||!b&&g.pos<u.doc.content.size&&!g.sameParent(v)&&(m=rk.findFrom(u.doc.resolve(g.pos+1),1,!0))&&m.head==v.pos)&&t.someProp("handleKeyDown",(e=>e(t,fM(13,"Enter")))))return void(t.input.lastIOSEnter=0);if(t.state.selection.anchor>p.start&&function(t,e,n,r,i){if(!r.parent.isTextblock||n-e<=i.pos-r.pos||sO(r,!0,!1)<i.pos)return!1;let s=t.resolve(e);if(s.parentOffset<s.parent.content.size||!s.parent.isTextblock)return!1;let o=t.resolve(sO(s,!0,!0));return!(!o.parent.isTextblock||o.pos>n||sO(o,!0,!1)<n)&&r.parent.content.cut(r.parentOffset).eq(o.parent.content)}(d,p.start,p.endA,g,v)&&t.someProp("handleKeyDown",(e=>e(t,fM(8,"Backspace")))))return void(MM&&SM&&t.domObserver.suppressSelectionUpdates());SM&&MM&&p.endB==p.start&&(t.input.lastAndroidDelete=Date.now()),MM&&!b&&g.start()!=v.start()&&0==v.parentOffset&&g.depth==v.depth&&u.sel&&u.sel.anchor==u.sel.head&&u.sel.head==p.endA&&(p.endB-=2,v=u.doc.resolveNoCache(p.endB-u.from),setTimeout((()=>{t.someProp("handleKeyDown",(function(e){return e(t,fM(13,"Enter"))}))}),20));let x,w,E,_=p.start,S=p.endA;if(b)if(g.pos==v.pos)xM&&wM<=11&&0==g.parentOffset&&(t.domObserver.suppressSelectionUpdates(),setTimeout((()=>TI(t)),20)),x=t.state.tr.delete(_,S),w=d.resolve(p.start).marksAcross(d.resolve(p.endA));else if(p.endA==p.endB&&(E=function(t,e){let n,r,i,s=t.firstChild.marks,o=e.firstChild.marks,a=s,l=o;for(let h=0;h<o.length;h++)a=o[h].removeFromSet(a);for(let h=0;h<s.length;h++)l=s[h].removeFromSet(l);if(1==a.length&&0==l.length)r=a[0],n="add",i=t=>t.mark(r.addToSet(t.marks));else{if(0!=a.length||1!=l.length)return null;r=l[0],n="remove",i=t=>t.mark(r.removeFromSet(t.marks))}let c=[];for(let h=0;h<e.childCount;h++)c.push(i(e.child(h)));if(S_.from(c).eq(t))return{mark:r,type:n}}(g.parent.content.cut(g.parentOffset,v.parentOffset),y.parent.content.cut(y.parentOffset,p.endA-y.start()))))x=t.state.tr,"add"==E.type?x.addMark(_,S,E.mark):x.removeMark(_,S,E.mark);else if(g.parent.child(g.index()).isText&&g.index()==v.index()-(v.textOffset?0:1)){let e=g.parent.textBetween(g.parentOffset,v.parentOffset);if(t.someProp("handleTextInput",(n=>n(t,_,S,e))))return;x=t.state.tr.insertText(e,_,S)}if(x||(x=t.state.tr.replace(_,S,u.doc.slice(p.start-u.from,p.endB-u.from))),u.sel){let e=iO(t,x.doc,u.sel);e&&!(SM&&MM&&t.composing&&e.empty&&(p.start!=p.endB||t.input.lastAndroidDelete<Date.now()-100)&&(e.head==_||e.head==x.mapping.map(S)-1)||xM&&e.empty&&e.head==_)&&x.setSelection(e)}w&&x.ensureMarks(w),s&&x.setMeta("composition",s),t.dispatch(x.scrollIntoView())}function iO(t,e,n){return Math.max(n.anchor,n.head)>e.content.size?null:DI(t,e.resolve(n.anchor),e.resolve(n.head))}function sO(t,e,n){let r=t.depth,i=e?t.end():t.pos;for(;r>0&&(e||t.indexAfter(r)==t.node(r).childCount);)r--,i++,e=!1;if(n){let e=t.node(r).maybeChild(t.indexAfter(r));for(;e&&!e.isLeaf;)e=e.firstChild,i++}return i}class oO{constructor(t,e){this._root=null,this.focused=!1,this.trackWrites=null,this.mounted=!1,this.markCursor=null,this.cursorWrapper=null,this.lastSelectedViewDesc=void 0,this.input=new lD,this.prevDirectPlugins=[],this.pluginViews=[],this.requiresGeckoHackNode=!1,this.dragging=null,this._props=e,this.state=e.state,this.directPlugins=e.plugins||[],this.directPlugins.forEach(uO),this.dispatch=this.dispatch.bind(this),this.dom=t&&t.mount||document.createElement("div"),t&&(t.appendChild?t.appendChild(this.dom):"function"==typeof t?t(this.dom):t.mount&&(this.mounted=!0)),this.editable=cO(this),lO(this),this.nodeViews=hO(this),this.docView=aI(this.state.doc,aO(this),XD(this),this.dom,this),this.domObserver=new JD(this,((t,e,n,r)=>rO(this,t,e,n,r))),this.domObserver.start(),function(t){for(let e in sD){let n=sD[e];t.dom.addEventListener(e,t.input.eventHandlers[e]=e=>{!dD(t,e)||uD(t,e)||!t.editable&&e.type in oD||n(t,e)},aD[e]?{passive:!0}:void 0)}kM&&t.dom.addEventListener("input",(()=>null)),hD(t)}(this),this.updatePluginViews()}get composing(){return this.input.composing}get props(){if(this._props.state!=this.state){let t=this._props;this._props={};for(let e in t)this._props[e]=t[e];this._props.state=this.state}return this._props}update(t){t.handleDOMEvents!=this._props.handleDOMEvents&&hD(this);let e=this._props;this._props=t,t.plugins&&(t.plugins.forEach(uO),this.directPlugins=t.plugins),this.updateStateInner(t.state,e)}setProps(t){let e={};for(let n in this._props)e[n]=this._props[n];e.state=this.state;for(let n in t)e[n]=t[n];this.update(e)}updateState(t){this.updateStateInner(t,this._props)}updateStateInner(t,e){let n=this.state,r=!1,i=!1;t.storedMarks&&this.composing&&(TD(this),i=!0),this.state=t;let s=n.plugins!=t.plugins||this._props.plugins!=e.plugins;if(s||this._props.plugins!=e.plugins||this._props.nodeViews!=e.nodeViews){let t=hO(this);(function(t,e){let n=0,r=0;for(let i in t){if(t[i]!=e[i])return!0;n++}for(let i in e)r++;return n!=r})(t,this.nodeViews)&&(this.nodeViews=t,r=!0)}(s||e.handleDOMEvents!=this._props.handleDOMEvents)&&hD(this),this.editable=cO(this),lO(this);let o=XD(this),a=aO(this),l=n.plugins==t.plugins||n.doc.eq(t.doc)?t.scrollToSelection>n.scrollToSelection?"to selection":"preserve":"reset",c=r||!this.docView.matchesNode(t.doc,a,o);!c&&t.selection.eq(n.selection)||(i=!0);let h="preserve"==l&&i&&null==this.dom.style.overflowAnchor&&function(t){let e,n,r=t.dom.getBoundingClientRect(),i=Math.max(0,r.top);for(let s=(r.left+r.right)/2,o=i+1;o<Math.min(innerHeight,r.bottom);o+=5){let r=t.root.elementFromPoint(s,o);if(!r||r==t.dom||!t.dom.contains(r))continue;let a=r.getBoundingClientRect();if(a.top>=i-20){e=r,n=a.top;break}}return{refDOM:e,refTop:n,stack:NM(t.dom)}}(this);if(i){this.domObserver.stop();let e=c&&(xM||SM)&&!this.composing&&!n.selection.empty&&!t.selection.empty&&function(t,e){let n=Math.min(t.$anchor.sharedDepth(t.head),e.$anchor.sharedDepth(e.head));return t.$anchor.start(n)!=e.$anchor.start(n)}(n.selection,t.selection);if(c){let n=SM?this.trackWrites=this.domSelectionRange().focusNode:null;!r&&this.docView.update(t.doc,a,o,this)||(this.docView.updateOuterDeco([]),this.docView.destroy(),this.docView=aI(t.doc,a,o,this.dom,this)),n&&!this.trackWrites&&(e=!0)}e||!(this.input.mouseDown&&this.domObserver.currentSelection.eq(this.domSelectionRange())&&function(t){let e=t.docView.domFromPos(t.state.selection.anchor,0),n=t.domSelectionRange();return aM(e.node,e.offset,n.anchorNode,n.anchorOffset)}(this))?TI(this,e):(MI(this,t.selection),this.domObserver.setCurSelection()),this.domObserver.start()}this.updatePluginViews(n),"reset"==l?this.dom.scrollTop=0:"to selection"==l?this.scrollToSelection():h&&function({refDOM:t,refTop:e,stack:n}){let r=t?t.getBoundingClientRect().top:0;BM(n,0==r?0:r-e)}(h)}scrollToSelection(){let t=this.domSelectionRange().focusNode;if(this.someProp("handleScrollToSelection",(t=>t(this))));else if(this.state.selection instanceof ck){let e=this.docView.domAfterPos(this.state.selection.from);1==e.nodeType&&FM(this,e.getBoundingClientRect(),t)}else FM(this,this.coordsAtPos(this.state.selection.head,1),t)}destroyPluginViews(){let t;for(;t=this.pluginViews.pop();)t.destroy&&t.destroy()}updatePluginViews(t){if(t&&t.plugins==this.state.plugins&&this.directPlugins==this.prevDirectPlugins)for(let e=0;e<this.pluginViews.length;e++){let n=this.pluginViews[e];n.update&&n.update(this,t)}else{this.prevDirectPlugins=this.directPlugins,this.destroyPluginViews();for(let t=0;t<this.directPlugins.length;t++){let e=this.directPlugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}for(let t=0;t<this.state.plugins.length;t++){let e=this.state.plugins[t];e.spec.view&&this.pluginViews.push(e.spec.view(this))}}}someProp(t,e){let n,r=this._props&&this._props[t];if(null!=r&&(n=e?e(r):r))return n;for(let s=0;s<this.directPlugins.length;s++){let r=this.directPlugins[s].props[t];if(null!=r&&(n=e?e(r):r))return n}let i=this.state.plugins;if(i)for(let s=0;s<i.length;s++){let r=i[s].props[t];if(null!=r&&(n=e?e(r):r))return n}}hasFocus(){if(xM){let t=this.root.activeElement;if(t==this.dom)return!0;if(!t||!this.dom.contains(t))return!1;for(;t&&this.dom!=t&&this.dom.contains(t);){if("false"==t.contentEditable)return!1;t=t.parentElement}return!0}return this.root.activeElement==this.dom}focus(){this.domObserver.stop(),this.editable&&function(t){if(t.setActive)return t.setActive();if(UM)return t.focus(UM);let e=NM(t);t.focus(null==UM?{get preventScroll(){return UM={preventScroll:!0},!0}}:void 0),UM||(UM=!1,BM(e,0))}(this.dom),TI(this),this.domObserver.start()}get root(){let t=this._root;if(null==t)for(let e=this.dom.parentNode;e;e=e.parentNode)if(9==e.nodeType||11==e.nodeType&&e.host)return e.getSelection||(Object.getPrototypeOf(e).getSelection=()=>e.ownerDocument.getSelection()),this._root=e;return t||document}updateRoot(){this._root=null}posAtCoords(t){return GM(this,t)}coordsAtPos(t,e=1){return YM(this,t,e)}domAtPos(t,e=0){return this.docView.domFromPos(t,e)}nodeDOM(t){let e=this.docView.descAt(t);return e?e.nodeDOM:null}posAtDOM(t,e,n=-1){let r=this.docView.posFromDOM(t,e,n);if(null==r)throw new RangeError("DOM position not inside the editor");return r}endOfTextblock(t,e){return eI(this,e||this.state,t)}pasteHTML(t,e){return CD(this,"",t,!1,e||new ClipboardEvent("paste"))}pasteText(t,e){return CD(this,t,null,!0,e||new ClipboardEvent("paste"))}destroy(){this.docView&&(!function(t){t.domObserver.stop();for(let e in t.input.eventHandlers)t.dom.removeEventListener(e,t.input.eventHandlers[e]);clearTimeout(t.input.composingTimeout),clearTimeout(t.input.lastIOSEnterFallbackTimeout)}(this),this.destroyPluginViews(),this.mounted?(this.docView.update(this.state.doc,[],XD(this),this),this.dom.textContent=""):this.dom.parentNode&&this.dom.parentNode.removeChild(this.dom),this.docView.destroy(),this.docView=null)}get isDestroyed(){return null==this.docView}dispatchEvent(t){return function(t,e){uD(t,e)||!sD[e.type]||!t.editable&&e.type in oD||sD[e.type](t,e)}(this,t)}dispatch(t){let e=this._props.dispatchTransaction;e?e.call(this,t):this.updateState(this.state.apply(t))}domSelectionRange(){return kM&&11===this.root.nodeType&&function(t){let e=t.activeElement;for(;e&&e.shadowRoot;)e=e.shadowRoot.activeElement;return e}(this.dom.ownerDocument)==this.dom?function(t){let e;function n(t){t.preventDefault(),t.stopImmediatePropagation(),e=t.getTargetRanges()[0]}t.dom.addEventListener("beforeinput",n,!0),document.execCommand("indent"),t.dom.removeEventListener("beforeinput",n,!0);let r=e.startContainer,i=e.startOffset,s=e.endContainer,o=e.endOffset,a=t.domAtPos(t.state.selection.anchor);return aM(a.node,a.offset,s,o)&&([r,i,s,o]=[s,o,r,i]),{anchorNode:r,anchorOffset:i,focusNode:s,focusOffset:o}}(this):this.domSelection()}domSelection(){return this.root.getSelection()}}function aO(t){let e=Object.create(null);return e.class="ProseMirror",e.contenteditable=String(t.editable),t.someProp("attributes",(n=>{if("function"==typeof n&&(n=n(t.state)),n)for(let t in n)"class"==t?e.class+=" "+n[t]:"style"==t?e.style=(e.style?e.style+";":"")+n[t]:e[t]||"contenteditable"==t||"nodeName"==t||(e[t]=String(n[t]))})),e.translate||(e.translate="no"),[LD.node(0,t.state.doc.content.size,e)]}function lO(t){if(t.markCursor){let e=document.createElement("img");e.className="ProseMirror-separator",e.setAttribute("mark-placeholder","true"),e.setAttribute("alt",""),t.cursorWrapper={dom:e,deco:LD.widget(t.state.selection.head,e,{raw:!0,marks:t.markCursor})}}else t.cursorWrapper=null}function cO(t){return!t.someProp("editable",(e=>!1===e(t.state)))}function hO(t){let e=Object.create(null);function n(t){for(let n in t)Object.prototype.hasOwnProperty.call(e,n)||(e[n]=t[n])}return t.someProp("nodeViews",n),t.someProp("markViews",n),e}function uO(t){if(t.spec.state||t.spec.filterTransaction||t.spec.appendTransaction)throw new RangeError("Plugins passed directly to the view must not have a state component")}class dO{constructor(t,e){var n;this.match=t,this.match=t,this.handler="string"==typeof e?(n=e,function(t,e,r,i){let s=n;if(e[1]){let t=e[0].lastIndexOf(e[1]);s+=e[0].slice(t+e[1].length);let n=(r+=t)-i;n>0&&(s=e[0].slice(t-n,t)+s,r=i)}return t.tr.insertText(s,r,i)}):e}}function fO(t,e,n=null,r){return new dO(t,((t,i,s,o)=>{let a=n instanceof Function?n(i):n,l=t.tr.delete(s,o),c=l.doc.resolve(s).blockRange(),h=c&&NT(c,e,a);if(!h)return null;l.wrap(c,h);let u=l.doc.resolve(s-1).nodeBefore;return u&&u.type==e&&VT(l.doc,s-1)&&(!r||r(i,u))&&l.join(s-1),l}))}function pO(t,e,n=null){return new dO(t,((t,r,i,s)=>{let o=t.doc.resolve(i),a=n instanceof Function?n(r):n;return o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),e)?t.tr.delete(i,s).setBlockType(i,i,e,a):null}))}const mO="undefined"!=typeof navigator?navigator:null,gO="undefined"!=typeof document?document:null,vO=mO&&mO.userAgent||"",yO=/Edge\/(\d+)/.exec(vO),bO=/MSIE \d/.exec(vO),xO=/Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(vO),wO=!!(bO||xO||yO),EO=bO?document.documentMode:xO?+xO[1]:yO?+yO[1]:0,_O=!wO&&/gecko\/(\d+)/i.test(vO),SO=_O&&+(/Firefox\/(\d+)/.exec(vO)||[0,0])[1],TO=!wO&&/Chrome\/(\d+)/.exec(vO),kO=!!TO,AO=TO?+TO[1]:0,CO=!wO&&!!mO&&/Apple Computer/.test(mO.vendor),RO=CO&&(/Mobile\/\w+/.test(vO)||!!mO&&mO.maxTouchPoints>2),MO=RO||!!mO&&/Mac/.test(mO.platform),IO=/Android \d/.test(vO),DO=!!gO&&"webkitFontSmoothing"in gO.documentElement.style,OO=DO?+(/\bAppleWebKit\/(\d+)/.exec(navigator.userAgent)||[0,0])[1]:0;var PO=Object.freeze({__proto__:null,ie:wO,ie_version:EO,gecko:_O,gecko_version:SO,chrome:kO,chrome_version:AO,safari:CO,ios:RO,mac:MO,android:IO,webkit:DO,webkit_version:OO});function LO(t,e,n,r,i,s){if(t.composing)return!1;const o=t.state,a=o.doc.resolve(e);if(a.parent.type.spec.code)return!1;const l=a.parent.textBetween(Math.max(0,a.parentOffset-500),a.parentOffset,void 0,"￼")+r;for(let c=0;c<i.length;c++){const a=i[c].match.exec(l),h=a&&a[0]&&i[c].handler(o,a,e-(a[0].length-r.length),n);if(h)return t.dispatch(h.setMeta(s,{transform:h,from:e,to:n,text:r})),!0}return!1}const FO=new Tk("MILKDOWN_CUSTOM_INPUTRULES"),NO=({rules:t})=>{const e=new Ek({key:FO,isInputRules:!0,state:{init:()=>null,apply(t,e){const n=t.getMeta(this);return n||(t.selectionSet||t.docChanged?null:e)}},props:{handleTextInput:(n,r,i,s)=>LO(n,r,i,s,t,e),handleDOMEvents:{compositionend:n=>(setTimeout((()=>{const{$cursor:r}=n.state.selection;r&&LO(n,r.pos,r.pos,"",t,e)})),!1)},handleKeyDown(n,r){if("Enter"!==r.key)return!1;const{$cursor:i}=n.state.selection;return!!i&&LO(n,i.pos,i.pos,"\n",t,e)}}});return e},BO=(t,e,n)=>{const r=t.state,{from:i}=r.selection,{node:s}=t.domAtPos(i),o=s instanceof Text?s.parentElement:s;if(!(o instanceof HTMLElement))throw nw(o);const a=o.getBoundingClientRect(),l=e.getBoundingClientRect(),c=e.parentElement;if(!c)throw nw(c);const h=c.getBoundingClientRect(),[u,d]=n(a,l,h);e.style.top=`${u}px`,e.style.left=`${d}px`},UO=(t,e,n)=>{const r=t.state,{from:i,to:s}=r.selection,o=t.coordsAtPos(i),a=t.coordsAtPos(s),l=e.getBoundingClientRect(),c=e.parentElement;if(!c)throw iw();const h=c.getBoundingClientRect(),[u,d]=n(o,a,l,h);e.style.top=`${u}px`,e.style.left=`${d}px`},VO=t=>Object.assign(Object.create(t),t).setTime(Date.now()),jO=t=>(e,n)=>((t,e=!0)=>{const n=[];return t.descendants(((t,r)=>{if(n.push({node:t,pos:r}),!e)return!1})),n})(e,n).filter((e=>t(e.node))),zO=(t,e)=>{const n=e.nodes[t];if(!n)throw((t,e)=>new Jx(Zx.getAtomFromSchemaFail,`Cannot get ${t}: ${e} from schema.`))("node",t);return n},GO=t=>e=>(t=>e=>{for(let n=e.depth;n>0;n--){const r=e.node(n);if(t(r))return{pos:n>0?e.before(n):0,start:e.start(n),depth:n,node:r}}})(t)(e.$from),WO=(t,e)=>{if(!(t instanceof ck))return;const{node:n,$from:r}=t;return((t,e)=>Array.isArray(t)&&t.includes(e.type)||e.type===t)(e,n)?{node:n,pos:r.pos,start:r.start(r.depth),depth:r.depth}:void 0},HO=(t,e)=>!t.selection.empty&&(e&&e(t.tr.deleteSelection().scrollIntoView()),!0);function $O(t,e,n=!1){for(let r=t;r;r="start"==e?r.firstChild:r.lastChild){if(r.isTextblock)return!0;if(n&&1!=r.childCount)return!1}return!1}function YO(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){if(t.index(e)>0)return t.doc.resolve(t.before(e+1));if(t.node(e).type.spec.isolating)break}return null}function XO(t){if(!t.parent.type.spec.isolating)for(let e=t.depth-1;e>=0;e--){let n=t.node(e);if(t.index(e)+1<n.childCount)return t.doc.resolve(t.after(e+1));if(n.type.spec.isolating)break}return null}function qO(t){for(let e=0;e<t.edgeCount;e++){let{type:n}=t.edge(e);if(n.isTextblock&&!n.hasRequiredAttrs())return n}return null}const KO=(t,e)=>{let{$from:n,$to:r}=t.selection;if(t.selection instanceof ck&&t.selection.node.isBlock)return!(!n.parentOffset||!UT(t.doc,n.pos)||(e&&e(t.tr.split(n.pos).scrollIntoView()),0));if(!n.parent.isBlock)return!1;if(e){let i=r.parentOffset==r.parent.content.size,s=t.tr;(t.selection instanceof ak||t.selection instanceof uk)&&s.deleteSelection();let o=0==n.depth?null:qO(n.node(-1).contentMatchAt(n.indexAfter(-1))),a=ZO&&ZO(r.parent,i),l=a?[a]:i&&o?[{type:o}]:void 0,c=UT(s.doc,s.mapping.map(n.pos),1,l);if(l||c||!UT(s.doc,s.mapping.map(n.pos),1,o?[{type:o}]:void 0)||(o&&(l=[{type:o}]),c=!0),c&&(s.split(s.mapping.map(n.pos),1,l),!i&&!n.parentOffset&&n.parent.type!=o)){let t=s.mapping.map(n.before()),e=s.doc.resolve(t);o&&n.node(-1).canReplaceWith(e.index(),e.index()+1,o)&&s.setNodeMarkup(s.mapping.map(n.before()),o)}e(s.scrollIntoView())}return!0};var ZO;const JO=(t,e)=>{let n,{$from:r,to:i}=t.selection,s=r.sharedDepth(i);return 0!=s&&(n=r.before(s),e&&e(t.tr.setSelection(ck.create(t.doc,n))),!0)};function QO(t,e,n){let r,i,s=e.nodeBefore,o=e.nodeAfter;if(s.type.spec.isolating||o.type.spec.isolating)return!1;if(function(t,e,n){let r=e.nodeBefore,i=e.nodeAfter,s=e.index();return!(!(r&&i&&r.type.compatibleContent(i.type))||(!r.content.size&&e.parent.canReplace(s-1,s)?(n&&n(t.tr.delete(e.pos-r.nodeSize,e.pos).scrollIntoView()),0):!e.parent.canReplace(s,s+1)||!i.isTextblock&&!VT(t.doc,e.pos)||(n&&n(t.tr.clearIncompatible(e.pos,r.type,r.contentMatchAt(r.childCount)).join(e.pos).scrollIntoView()),0)))}(t,e,n))return!0;let a=e.parent.canReplace(e.index(),e.index()+1);if(a&&(r=(i=s.contentMatchAt(s.childCount)).findWrapping(o.type))&&i.matchType(r[0]||o.type).validEnd){if(n){let i=e.pos+o.nodeSize,a=S_.empty;for(let t=r.length-1;t>=0;t--)a=S_.from(r[t].create(null,a));a=S_.from(s.copy(a));let l=t.tr.step(new OT(e.pos-1,i,e.pos,i,new M_(a,1,0),r.length,!0)),c=i+2*r.length;VT(l.doc,c)&&l.join(c),n(l.scrollIntoView())}return!0}let l=rk.findFrom(e,1),c=l&&l.$from.blockRange(l.$to),h=c&&FT(c);if(null!=h&&h>=e.depth)return n&&n(t.tr.lift(c,h).scrollIntoView()),!0;if(a&&$O(o,"start",!0)&&$O(s,"end")){let r=s,i=[];for(;i.push(r),!r.isTextblock;)r=r.lastChild;let a=o,l=1;for(;!a.isTextblock;a=a.firstChild)l++;if(r.canReplace(r.childCount,r.childCount,a.content)){if(n){let r=S_.empty;for(let t=i.length-1;t>=0;t--)r=S_.from(i[t].copy(r));n(t.tr.step(new OT(e.pos-i.length,e.pos+o.nodeSize,e.pos+l,e.pos+o.nodeSize-l,new M_(r,i.length,0),0,!0)).scrollIntoView())}return!0}}return!1}function tP(t){return function(e,n){let r=e.selection,i=t<0?r.$from:r.$to,s=i.depth;for(;i.node(s).isInline;){if(!s)return!1;s--}return!!i.node(s).isTextblock&&(n&&n(e.tr.setSelection(ak.create(e.doc,t<0?i.start(s):i.end(s)))),!0)}}const eP=tP(-1),nP=tP(1);function rP(t,e=null){return function(n,r){let{$from:i,$to:s}=n.selection,o=i.blockRange(s),a=o&&NT(o,t,e);return!!a&&(r&&r(n.tr.wrap(o,a).scrollIntoView()),!0)}}function iP(t,e=null){return function(n,r){let i=!1;for(let s=0;s<n.selection.ranges.length&&!i;s++){let{$from:{pos:r},$to:{pos:o}}=n.selection.ranges[s];n.doc.nodesBetween(r,o,((r,s)=>{if(i)return!1;if(r.isTextblock&&!r.hasMarkup(t,e))if(r.type==t)i=!0;else{let e=n.doc.resolve(s),r=e.index();i=e.parent.canReplaceWith(r,r+1,t)}}))}if(!i)return!1;if(r){let i=n.tr;for(let r=0;r<n.selection.ranges.length;r++){let{$from:{pos:s},$to:{pos:o}}=n.selection.ranges[r];i.setBlockType(s,o,t,e)}r(i.scrollIntoView())}return!0}}function sP(t,e=null){return function(n,r){let{empty:i,$cursor:s,ranges:o}=n.selection;if(i&&!s||!function(t,e,n){for(let r=0;r<e.length;r++){let{$from:i,$to:s}=e[r],o=0==i.depth&&t.inlineContent&&t.type.allowsMarkType(n);if(t.nodesBetween(i.pos,s.pos,(t=>{if(o)return!1;o=t.inlineContent&&t.type.allowsMarkType(n)})),o)return!0}return!1}(n.doc,o,t))return!1;if(r)if(s)t.isInSet(n.storedMarks||s.marks())?r(n.tr.removeStoredMark(t)):r(n.tr.addStoredMark(t.create(e)));else{let i=!1,s=n.tr;for(let e=0;!i&&e<o.length;e++){let{$from:r,$to:s}=o[e];i=n.doc.rangeHasMark(r.pos,s.pos,t)}for(let n=0;n<o.length;n++){let{$from:r,$to:a}=o[n];if(i)s.removeMark(r.pos,a.pos,t);else{let n=r.pos,i=a.pos,o=r.nodeAfter,l=a.nodeBefore,c=o&&o.isText?/^\s*/.exec(o.text)[0].length:0,h=l&&l.isText?/\s*$/.exec(l.text)[0].length:0;n+c<i&&(n+=c,i-=h),s.addMark(n,i,t.create(e))}}r(s.scrollIntoView())}return!0}}function oP(...t){return function(e,n,r){for(let i=0;i<t.length;i++)if(t[i](e,n,r))return!0;return!1}}let aP=oP(HO,((t,e,n)=>{let r=function(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("backward",t):n.parentOffset>0)?null:n}(t,n);if(!r)return!1;let i=YO(r);if(!i){let n=r.blockRange(),i=n&&FT(n);return null!=i&&(e&&e(t.tr.lift(n,i).scrollIntoView()),!0)}let s=i.nodeBefore;if(!s.type.spec.isolating&&QO(t,i,e))return!0;if(0==r.parent.content.size&&($O(s,"end")||ck.isSelectable(s))){let n=zT(t.doc,r.before(),r.after(),M_.empty);if(n&&n.slice.size<n.to-n.from){if(e){let r=t.tr.step(n);r.setSelection($O(s,"end")?rk.findFrom(r.doc.resolve(r.mapping.map(i.pos,-1)),-1):ck.create(r.doc,i.pos-s.nodeSize)),e(r.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=r.depth-1)&&(e&&e(t.tr.delete(i.pos-s.nodeSize,i.pos).scrollIntoView()),!0)}),((t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("backward",t):r.parentOffset>0)return!1;s=YO(r)}let o=s&&s.nodeBefore;return!(!o||!ck.isSelectable(o))&&(e&&e(t.tr.setSelection(ck.create(t.doc,s.pos-o.nodeSize)).scrollIntoView()),!0)})),lP=oP(HO,((t,e,n)=>{let r=function(t,e){let{$cursor:n}=t.selection;return!n||(e?!e.endOfTextblock("forward",t):n.parentOffset<n.parent.content.size)?null:n}(t,n);if(!r)return!1;let i=XO(r);if(!i)return!1;let s=i.nodeAfter;if(QO(t,i,e))return!0;if(0==r.parent.content.size&&($O(s,"start")||ck.isSelectable(s))){let n=zT(t.doc,r.before(),r.after(),M_.empty);if(n&&n.slice.size<n.to-n.from){if(e){let r=t.tr.step(n);r.setSelection($O(s,"start")?rk.findFrom(r.doc.resolve(r.mapping.map(i.pos)),1):ck.create(r.doc,r.mapping.map(i.pos))),e(r.scrollIntoView())}return!0}}return!(!s.isAtom||i.depth!=r.depth-1)&&(e&&e(t.tr.delete(i.pos,i.pos+s.nodeSize).scrollIntoView()),!0)}),((t,e,n)=>{let{$head:r,empty:i}=t.selection,s=r;if(!i)return!1;if(r.parent.isTextblock){if(n?!n.endOfTextblock("forward",t):r.parentOffset<r.parent.content.size)return!1;s=XO(r)}let o=s&&s.nodeAfter;return!(!o||!ck.isSelectable(o))&&(e&&e(t.tr.setSelection(ck.create(t.doc,s.pos)).scrollIntoView()),!0)}));const cP={Enter:oP(((t,e)=>{let{$head:n,$anchor:r}=t.selection;return!(!n.parent.type.spec.code||!n.sameParent(r))&&(e&&e(t.tr.insertText("\n").scrollIntoView()),!0)}),((t,e)=>{let n=t.selection,{$from:r,$to:i}=n;if(n instanceof uk||r.parent.inlineContent||i.parent.inlineContent)return!1;let s=qO(i.parent.contentMatchAt(i.indexAfter()));if(!s||!s.isTextblock)return!1;if(e){let n=(!r.parentOffset&&i.index()<i.parent.childCount?r:i).pos,o=t.tr.insert(n,s.createAndFill());o.setSelection(ak.create(o.doc,n+1)),e(o.scrollIntoView())}return!0}),((t,e)=>{let{$cursor:n}=t.selection;if(!n||n.parent.content.size)return!1;if(n.depth>1&&n.after()!=n.end(-1)){let r=n.before();if(UT(t.doc,r))return e&&e(t.tr.split(r).scrollIntoView()),!0}let r=n.blockRange(),i=r&&FT(r);return null!=i&&(e&&e(t.tr.lift(r,i).scrollIntoView()),!0)}),KO),"Mod-Enter":(t,e)=>{let{$head:n,$anchor:r}=t.selection;if(!n.parent.type.spec.code||!n.sameParent(r))return!1;let i=n.node(-1),s=n.indexAfter(-1),o=qO(i.contentMatchAt(s));if(!o||!i.canReplaceWith(s,s,o))return!1;if(e){let r=n.after(),i=t.tr.replaceWith(r,r,o.createAndFill());i.setSelection(rk.near(i.doc.resolve(r),1)),e(i.scrollIntoView())}return!0},Backspace:aP,"Mod-Backspace":aP,"Shift-Backspace":aP,Delete:lP,"Mod-Delete":lP,"Mod-a":(t,e)=>(e&&e(t.tr.setSelection(new uk(t.doc))),!0)},hP={"Ctrl-h":cP.Backspace,"Alt-Backspace":cP["Mod-Backspace"],"Ctrl-d":cP.Delete,"Ctrl-Alt-Backspace":cP["Mod-Delete"],"Alt-Delete":cP["Mod-Delete"],"Alt-d":cP["Mod-Delete"],"Ctrl-a":eP,"Ctrl-e":nP};for(let os in cP)hP[os]=cP[os];const uP=("undefined"!=typeof navigator?/Mac|iP(hone|[oa]d)/.test(navigator.platform):!("undefined"==typeof os||!os.platform)&&"darwin"==os.platform())?hP:cP;for(var dP={8:"Backspace",9:"Tab",10:"Enter",12:"NumLock",13:"Enter",16:"Shift",17:"Control",18:"Alt",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",44:"PrintScreen",45:"Insert",46:"Delete",59:";",61:"=",91:"Meta",92:"Meta",106:"*",107:"+",108:",",109:"-",110:".",111:"/",144:"NumLock",145:"ScrollLock",160:"Shift",161:"Shift",162:"Control",163:"Control",164:"Alt",165:"Alt",173:"-",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},fP={48:")",49:"!",50:"@",51:"#",52:"$",53:"%",54:"^",55:"&",56:"*",57:"(",59:":",61:"+",173:"_",186:":",187:"+",188:"<",189:"_",190:">",191:"?",192:"~",219:"{",220:"|",221:"}",222:'"'},pP="undefined"!=typeof navigator&&/Mac/.test(navigator.platform),mP="undefined"!=typeof navigator&&/MSIE \d|Trident\/(?:[7-9]|\d{2,})\..*rv:(\d+)/.exec(navigator.userAgent),gP=0;gP<10;gP++)dP[48+gP]=dP[96+gP]=String(gP);for(gP=1;gP<=24;gP++)dP[gP+111]="F"+gP;for(gP=65;gP<=90;gP++)dP[gP]=String.fromCharCode(gP+32),fP[gP]=String.fromCharCode(gP);for(var vP in dP)fP.hasOwnProperty(vP)||(fP[vP]=dP[vP]);const yP="undefined"!=typeof navigator&&/Mac|iP(hone|[oa]d)/.test(navigator.platform);function bP(t){let e,n,r,i,s=t.split(/-(?!$)/),o=s[s.length-1];"Space"==o&&(o=" ");for(let a=0;a<s.length-1;a++){let t=s[a];if(/^(cmd|meta|m)$/i.test(t))i=!0;else if(/^a(lt)?$/i.test(t))e=!0;else if(/^(c|ctrl|control)$/i.test(t))n=!0;else if(/^s(hift)?$/i.test(t))r=!0;else{if(!/^mod$/i.test(t))throw new Error("Unrecognized modifier name: "+t);yP?i=!0:n=!0}}return e&&(o="Alt-"+o),n&&(o="Ctrl-"+o),i&&(o="Meta-"+o),r&&(o="Shift-"+o),o}function xP(t,e,n=!0){return e.altKey&&(t="Alt-"+t),e.ctrlKey&&(t="Ctrl-"+t),e.metaKey&&(t="Meta-"+t),n&&e.shiftKey&&(t="Shift-"+t),t}function wP(t){return new Ek({props:{handleKeyDown:EP(t)}})}function EP(t){let e=function(t){let e=Object.create(null);for(let n in t)e[bP(n)]=t[n];return e}(t);return function(t,n){let r,i=function(t){var e=!(pP&&t.metaKey&&t.shiftKey&&!t.ctrlKey&&!t.altKey||mP&&t.shiftKey&&t.key&&1==t.key.length||"Unidentified"==t.key)&&t.key||(t.shiftKey?fP:dP)[t.keyCode]||t.key||"Unidentified";return"Esc"==e&&(e="Escape"),"Del"==e&&(e="Delete"),"Left"==e&&(e="ArrowLeft"),"Up"==e&&(e="ArrowUp"),"Right"==e&&(e="ArrowRight"),"Down"==e&&(e="ArrowDown"),e}(n),s=e[xP(i,n)];if(s&&s(t.state,t.dispatch,t))return!0;if(1==i.length&&" "!=i){if(n.shiftKey){let r=e[xP(i,n,!1)];if(r&&r(t.state,t.dispatch,t))return!0}if((n.shiftKey||n.altKey||n.metaKey||i.charCodeAt(0)>127)&&(r=dP[n.keyCode])&&r!=i){let i=e[xP(r,n)];if(i&&i(t.state,t.dispatch,t))return!0}}return!1}}var _P=Object.defineProperty,SP=(t,e,n)=>(((t,e,n)=>{e in t?_P(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n),TP=(t,e,n)=>{if(!e.has(t))throw TypeError("Cannot "+n)},kP=(t,e,n)=>(TP(t,e,"read from private field"),n?n.call(t):e.get(t)),AP=(t,e,n)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,n)},CP=(t,e,n,r)=>(TP(t,e,"write to private field"),r?r.call(t,n):e.set(t,n),n);const RP=Cw("ConfigReady"),MP=pw([],"themeTimer"),IP=Cw("ThemeEnvironmentReady"),DP=Cw("ThemeReady"),OP=new Tk("MILKDOWN_THEME_RESET"),PP=t=>{const e=new r_;return t.inject(KE).inject(ZE).inject(i_,e).inject(MP,[RP]).record(DP).record(IP),async t=>{await t.waitTimers(MP);const n=(t=>qE(t))(t.get(KE));return y_.forEach((t=>{e.inject(t)})),t.set(ZE,n),t.done(IP),t.done(DP),await t.wait(FP),t.update(VP,(t=>t.concat(new Ek({key:OP,view:()=>(e.runExecutor(),{destroy:()=>{n.flush()}})})))),t=>{t.remove(KE).remove(ZE).remove(i_).remove(MP).clearTimer(DP).clearTimer(IP)}}},LP=t=>{let e=null;const n=()=>async n=>{await n.wait(IP);const r=n.get(ZE),i=n.get(i_);i.setExecutor((()=>{null==t||t(r,i),null==e||e(r,i),y_.forEach((t=>{i.has(t)})),i.get(l_,void 0)}))};return n.override=t=>(e=t,n),n},FP=Cw("InitReady"),NP=pw([],"initTimer"),BP=pw({},"editor"),UP=pw([],"inputRules"),VP=pw([],"prosePlugins"),jP=pw([],"remarkPlugins"),zP=pw([],"nodeView"),GP=pw([],"markView"),WP=pw(XR().use(_C).use(_R),"remark"),HP=pw({},"remarkStringifyOptions"),$P=Cw("schemaReady"),YP=pw({},"schema"),XP=pw([],"schemaTimer"),qP=pw([],"nodes"),KP=pw([],"marks"),ZP=t=>{var e;return{...t,parseDOM:null==(e=t.parseDOM)?void 0:e.map((e=>({priority:t.priority,...e})))}},JP=t=>(t.inject(YP).inject(qP).inject(KP).inject(XP,[FP]).record($P),async t=>{await t.waitTimers(XP);const e=t.get(WP),n=t.get(jP).reduce(((t,e)=>t.use(e)),e);t.set(WP,n);const r=Object.fromEntries(t.get(qP).map((([t,e])=>[t,ZP(e)]))),i=Object.fromEntries(t.get(KP).map((([t,e])=>[t,ZP(e)])));return t.set(YP,new dS({nodes:r,marks:i})),t.done($P),t=>{t.remove(YP).remove(qP).remove(KP).remove(XP).clearTimer($P)}}),QP=pw((()=>{}),"parser"),tL=pw([],"parserTimer"),eL=Cw("ParserReady"),nL=t=>(t.inject(QP).inject(tL,[$P]).record(eL),async t=>{await t.waitTimers(tL);const e=t.get(qP),n=t.get(KP),r=t.get(WP),i=t.get(YP),s=[...e.map((([t,e])=>({id:t,...e}))).map((t=>({...t,is:"node"}))),...n.map((([t,e])=>({id:t,...e}))).map((t=>({...t,is:"mark"})))],o=Object.fromEntries(s.map((({id:t,parseMarkdown:e,is:n})=>[t,{...e,is:n,key:t}])));return t.set(QP,KS(i,o,r)),t.done(eL),t=>{t.remove(QP).remove(tL).clearTimer(eL)}}),rL=pw((()=>""),"serializer"),iL=pw([],"serializerTimer"),sL=Cw("SerializerReady"),oL=t=>(t.inject(rL).inject(iL,[$P]).record(sL),async t=>{await t.waitTimers(iL);const e=t.get(qP),n=t.get(KP),r=t.get(WP),i=t.get(YP),s=[...e,...n],o=Object.fromEntries(s.map((([t,e])=>[t,e.toMarkdown])));return t.set(rL,yT(i,o,r)),t.done(sL),t=>{t.remove(rL).remove(iL).clearTimer(sL)}}),aL=pw("","defaultValue"),lL=pw({},"editorState"),cL=pw((t=>t),"stateOptions"),hL=pw([],"editorStateTimer"),uL=Cw("EditorStateReady"),dL=new Tk("MILKDOWN_STATE_TRACKER"),fL=(t,e,n)=>{if("string"==typeof t)return e(t);if("html"===t.type)return pS.fromSchema(n).parse(t.dom);if("json"===t.type)return X_.fromJSON(n,t.value);throw(t=>new Jx(Zx.docTypeError,`Doc type error, unsupported type: ${tw(t)}`))(t)},pL=t=>(t.inject(aL).inject(lL).inject(cL).inject(hL,[eL,sL,ML]).record(uL),async t=>{await t.waitTimers(hL);const e=t.get(YP),n=t.get(QP),r=t.get(UP),i=t.get(cL),s=t.get(VP),o=t.get(aL),a=fL(o,n,e),l=[...s,new Ek({key:dL,state:{init:()=>{},apply:(e,n,r,i)=>{t.set(lL,i)}}}),NO({rules:r}),wP(uP)];t.set(VP,l);const c=i({schema:e,doc:a,plugins:l}),h=xk.create(c);return t.set(lL,h),t.done(uL),t=>{t.remove(aL).remove(lL).remove(cL).remove(hL).clearTimer(uL)}}),mL=pw({},"editorView"),gL=pw({},"editorViewOptions"),vL=pw(null,"root"),yL=pw([],"editorViewTimer"),bL=pw(null,"rootDOM"),xL=Cw("EditorViewReady"),wL=new Tk("MILKDOWN_VIEW_CLEAR"),EL=t=>(t.inject(vL,document.body).inject(mL).inject(gL).inject(bL).inject(yL,[uL]).record(xL),async t=>{await t.wait(FP);const e=t.get(vL)||document.body,n="string"==typeof e?document.querySelector(e):e;t.update(VP,(e=>[new Ek({key:wL,view:e=>{const r=n?((t,e)=>{const n=document.createElement("div");return n.className="milkdown",t.appendChild(n),e.set(bL,n),n})(n,t):void 0;return(()=>{if(r&&n){const t=e.dom;n.replaceChild(r,t),r.appendChild(t)}})(),{destroy:()=>{null!=r&&r.parentNode&&(null==r||r.parentNode.replaceChild(e.dom,r)),null==r||r.remove()}}}}),...e])),await t.waitTimers(yL);const r=t.get(lL),i=t.get(gL),s=Object.fromEntries(t.get(zP)),o=Object.fromEntries(t.get(GP)),a=new oO(n,{state:r,nodeViews:s,markViews:o,...i});return(t=>{t.classList.add("editor"),t.setAttribute("role","textbox")})(a.dom),t.set(mL,a),t.done(xL),t=>{null==a||a.destroy(),t.remove(vL).remove(mL).remove(gL).remove(bL).remove(yL).clearTimer(xL)}});var _L,SL;let TL=class{constructor(){AP(this,_L,fw()),AP(this,SL,null),SP(this,"setCtx",(t=>{CP(this,SL,t)}))}create(t,e){return t(kP(this,_L).sliceMap,e)}get(t){return kP(this,_L).getSlice(t).get()}call(t,e){if(null==kP(this,SL))throw new Jx(Zx.callCommandBeforeEditorView,"You're trying to call a command before editor view initialized, make sure to get commandManager from ctx after editor view has been initialized");const n=this.get(t)(e),r=kP(this,SL).get(mL);return n(r.state,r.dispatch,r)}remove(t){return kP(this,_L).removeSlice(t)}};_L=new WeakMap,SL=new WeakMap;const kL=(t,e)=>[t,e],AL=(t="cmdKey")=>pw((()=>()=>!1),t),CL=pw({},"commands"),RL=pw([],"commandsTimer"),ML=Cw("CommandsReady"),IL=t=>{const e=new TL;return t.inject(CL,e).inject(RL,[$P]).record(ML),async t=>(await t.waitTimers(RL),t.done(ML),await t.wait(xL),e.setCtx(t),t=>{t.remove(CL).remove(RL).clearTimer(ML)})};var DL,OL,PL,LL,FL,NL,BL,UL,VL,jL,zL,GL,WL;const HL=class{constructor(){AP(this,DL,"Idle"),AP(this,OL,[]),AP(this,PL,(()=>{})),AP(this,LL,fw()),AP(this,FL,Aw()),AP(this,NL,new Map),AP(this,BL,new vw(kP(this,LL),kP(this,FL))),AP(this,UL,new kw(kP(this,LL),kP(this,FL))),AP(this,VL,new _w(kP(this,LL),kP(this,FL))),AP(this,jL,(()=>{const t=[PP,JP,nL,oL,IL,pL,EL,(n=this,t=>(t.inject(BP,n).inject(VP).inject(jP).inject(UP).inject(zP).inject(GP).inject(HP).inject(WP,XR().use(_C).use(_R)).inject(NP,[DP]).record(FP),async t=>{await t.waitTimers(NP);const e=t.get(HP);return t.set(WP,XR().use(_C).use(_R,e)),t.done(FP),t=>{t.remove(BP).remove(VP).remove(jP).remove(UP).remove(zP).remove(GP).remove(HP).remove(WP).remove(NP).clearTimer(FP)}}))],e=(t=>e=>(e.record(RP),async e=>(await t(e),e.done(RP),t=>{t.clearTimer(RP)})))((async t=>{await Promise.all(kP(this,OL).map((e=>e(t))))}));var n;this.use(t.concat(e))})),AP(this,zL,(()=>{[...kP(this,NL).entries()].map((async([t,e])=>{var n;const r=null!=(n=e.handler)?n:t(kP(this,UL));kP(this,NL).set(t,{...e,handler:r})}))})),AP(this,GL,((t,e=!1)=>Promise.all([t].flat().map((t=>{const n=kP(this,NL).get(t),r=null==n?void 0:n.cleanup;if(e&&kP(this,NL).delete(t),"function"==typeof r)return r(kP(this,VL))}))))),AP(this,WL,(t=>{CP(this,DL,t),kP(this,PL).call(this,t)})),SP(this,"use",(t=>([t].flat().forEach((t=>{const e="Created"===kP(this,DL)?t(kP(this,UL)):void 0;kP(this,NL).set(t,{handler:e,cleanup:void 0})})),this))),SP(this,"config",(t=>(kP(this,OL).push(t),this))),SP(this,"onStatusChange",(t=>(CP(this,PL,t),this))),SP(this,"create",(async()=>("OnCreate"===kP(this,DL)||("Created"===kP(this,DL)&&await this.destroy(),kP(this,WL).call(this,"OnCreate"),kP(this,jL).call(this),kP(this,zL).call(this),await Promise.all([...kP(this,NL).entries()].map((async([t,e])=>{const n=e.handler;if(!n)return;const r=await n(kP(this,BL));return kP(this,NL).set(t,{handler:n,cleanup:r}),r}))),kP(this,WL).call(this,"Created")),this))),SP(this,"remove",(async t=>(await kP(this,GL).call(this,[t].flat(),!0),this))),SP(this,"destroy",(async(t=!1)=>("Destroyed"===kP(this,DL)||"OnDestroy"===kP(this,DL)||(t&&CP(this,OL,[]),kP(this,WL).call(this,"OnDestroy"),await kP(this,GL).call(this,[...kP(this,NL).keys()],t),kP(this,WL).call(this,"Destroyed")),this))),SP(this,"action",(t=>t(kP(this,BL))))}static make(){return new HL}get ctx(){return kP(this,BL)}get status(){return kP(this,DL)}};let $L=HL;DL=new WeakMap,OL=new WeakMap,PL=new WeakMap,LL=new WeakMap,FL=new WeakMap,NL=new WeakMap,BL=new WeakMap,UL=new WeakMap,VL=new WeakMap,jL=new WeakMap,zL=new WeakMap,GL=new WeakMap,WL=new WeakMap;var YL=200,XL=function(){};XL.prototype.append=function(t){return t.length?(t=XL.from(t),!this.length&&t||t.length<YL&&this.leafAppend(t)||this.length<YL&&t.leafPrepend(this)||this.appendInner(t)):this},XL.prototype.prepend=function(t){return t.length?XL.from(t).append(this):this},XL.prototype.appendInner=function(t){return new KL(this,t)},XL.prototype.slice=function(t,e){return void 0===t&&(t=0),void 0===e&&(e=this.length),t>=e?XL.empty:this.sliceInner(Math.max(0,t),Math.min(this.length,e))},XL.prototype.get=function(t){if(!(t<0||t>=this.length))return this.getInner(t)},XL.prototype.forEach=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length),e<=n?this.forEachInner(t,e,n,0):this.forEachInvertedInner(t,e,n,0)},XL.prototype.map=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=this.length);var r=[];return this.forEach((function(e,n){return r.push(t(e,n))}),e,n),r},XL.from=function(t){return t instanceof XL?t:t&&t.length?new qL(t):XL.empty};var qL=function(t){function e(e){t.call(this),this.values=e}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={length:{configurable:!0},depth:{configurable:!0}};return e.prototype.flatten=function(){return this.values},e.prototype.sliceInner=function(t,n){return 0==t&&n==this.length?this:new e(this.values.slice(t,n))},e.prototype.getInner=function(t){return this.values[t]},e.prototype.forEachInner=function(t,e,n,r){for(var i=e;i<n;i++)if(!1===t(this.values[i],r+i))return!1},e.prototype.forEachInvertedInner=function(t,e,n,r){for(var i=e-1;i>=n;i--)if(!1===t(this.values[i],r+i))return!1},e.prototype.leafAppend=function(t){if(this.length+t.length<=YL)return new e(this.values.concat(t.flatten()))},e.prototype.leafPrepend=function(t){if(this.length+t.length<=YL)return new e(t.flatten().concat(this.values))},n.length.get=function(){return this.values.length},n.depth.get=function(){return 0},Object.defineProperties(e.prototype,n),e}(XL);XL.empty=new qL([]);var KL=function(t){function e(e,n){t.call(this),this.left=e,this.right=n,this.length=e.length+n.length,this.depth=Math.max(e.depth,n.depth)+1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.flatten=function(){return this.left.flatten().concat(this.right.flatten())},e.prototype.getInner=function(t){return t<this.left.length?this.left.get(t):this.right.get(t-this.left.length)},e.prototype.forEachInner=function(t,e,n,r){var i=this.left.length;return!(e<i&&!1===this.left.forEachInner(t,e,Math.min(n,i),r))&&(!(n>i&&!1===this.right.forEachInner(t,Math.max(e-i,0),Math.min(this.length,n)-i,r+i))&&void 0)},e.prototype.forEachInvertedInner=function(t,e,n,r){var i=this.left.length;return!(e>i&&!1===this.right.forEachInvertedInner(t,e-i,Math.max(n,i)-i,r+i))&&(!(n<i&&!1===this.left.forEachInvertedInner(t,Math.min(e,i),n,r))&&void 0)},e.prototype.sliceInner=function(t,e){if(0==t&&e==this.length)return this;var n=this.left.length;return e<=n?this.left.slice(t,e):t>=n?this.right.slice(t-n,e-n):this.left.slice(t,n).append(this.right.slice(0,e-n))},e.prototype.leafAppend=function(t){var n=this.right.leafAppend(t);if(n)return new e(this.left,n)},e.prototype.leafPrepend=function(t){var n=this.left.leafPrepend(t);if(n)return new e(n,this.right)},e.prototype.appendInner=function(t){return this.left.depth>=Math.max(this.right.depth,t.depth)+1?new e(this.left,new e(this.right,t)):new e(this,t)},e}(XL);class ZL{constructor(t,e){this.items=t,this.eventCount=e}popEvent(t,e){if(0==this.eventCount)return null;let n,r,i=this.items.length;for(;;i--){if(this.items.get(i-1).selection){--i;break}}e&&(n=this.remapping(i,this.items.length),r=n.maps.length);let s,o,a=t.tr,l=[],c=[];return this.items.forEach(((t,e)=>{if(!t.step)return n||(n=this.remapping(i,e+1),r=n.maps.length),r--,void c.push(t);if(n){c.push(new JL(t.map));let e,i=t.step.map(n.slice(r));i&&a.maybeStep(i).doc&&(e=a.mapping.maps[a.mapping.maps.length-1],l.push(new JL(e,void 0,void 0,l.length+c.length))),r--,e&&n.appendMap(e,r)}else a.maybeStep(t.step);return t.selection?(s=n?t.selection.map(n.slice(r)):t.selection,o=new ZL(this.items.slice(0,i).append(c.reverse().concat(l)),this.eventCount-1),!1):void 0}),this.items.length,0),{remaining:o,transform:a,selection:s}}addTransform(t,e,n,r){let i=[],s=this.eventCount,o=this.items,a=!r&&o.length?o.get(o.length-1):null;for(let c=0;c<t.steps.length;c++){let n,l=t.steps[c].invert(t.docs[c]),h=new JL(t.mapping.maps[c],l,e);(n=a&&a.merge(h))&&(h=n,c?i.pop():o=o.slice(0,o.length-1)),i.push(h),e&&(s++,e=void 0),r||(a=h)}let l=s-n.depth;return l>tF&&(o=function(t,e){let n;return t.forEach(((t,r)=>{if(t.selection&&0==e--)return n=r,!1})),t.slice(n)}(o,l),s-=l),new ZL(o.append(i),s)}remapping(t,e){let n=new _T;return this.items.forEach(((e,r)=>{let i=null!=e.mirrorOffset&&r-e.mirrorOffset>=t?n.maps.length-e.mirrorOffset:void 0;n.appendMap(e.map,i)}),t,e),n}addMaps(t){return 0==this.eventCount?this:new ZL(this.items.append(t.map((t=>new JL(t)))),this.eventCount)}rebased(t,e){if(!this.eventCount)return this;let n=[],r=Math.max(0,this.items.length-e),i=t.mapping,s=t.steps.length,o=this.eventCount;this.items.forEach((t=>{t.selection&&o--}),r);let a=e;this.items.forEach((e=>{let r=i.getMirror(--a);if(null==r)return;s=Math.min(s,r);let l=i.maps[r];if(e.step){let s=t.steps[r].invert(t.docs[r]),c=e.selection&&e.selection.map(i.slice(a+1,r));c&&o++,n.push(new JL(l,s,c))}else n.push(new JL(l))}),r);let l=[];for(let u=e;u<s;u++)l.push(new JL(i.maps[u]));let c=this.items.slice(0,r).append(l).append(n),h=new ZL(c,o);return h.emptyItemCount()>500&&(h=h.compress(this.items.length-n.length)),h}emptyItemCount(){let t=0;return this.items.forEach((e=>{e.step||t++})),t}compress(t=this.items.length){let e=this.remapping(0,t),n=e.maps.length,r=[],i=0;return this.items.forEach(((s,o)=>{if(o>=t)r.push(s),s.selection&&i++;else if(s.step){let t=s.step.map(e.slice(n)),o=t&&t.getMap();if(n--,o&&e.appendMap(o,n),t){let a=s.selection&&s.selection.map(e.slice(n));a&&i++;let l,c=new JL(o.invert(),t,a),h=r.length-1;(l=r.length&&r[h].merge(c))?r[h]=l:r.push(c)}}else s.map&&n--}),this.items.length,0),new ZL(XL.from(r.reverse()),i)}}ZL.empty=new ZL(XL.empty,0);class JL{constructor(t,e,n,r){this.map=t,this.step=e,this.selection=n,this.mirrorOffset=r}merge(t){if(this.step&&t.step&&!t.selection){let e=t.step.merge(this.step);if(e)return new JL(e.getMap().invert(),e,this.selection)}}}class QL{constructor(t,e,n,r,i){this.done=t,this.undone=e,this.prevRanges=n,this.prevTime=r,this.prevComposition=i}}const tF=20;function eF(t){let e=[];return t.forEach(((t,n,r,i)=>e.push(r,i))),e}function nF(t,e){if(!t)return null;let n=[];for(let r=0;r<t.length;r+=2){let i=e.map(t[r],1),s=e.map(t[r+1],-1);i<=s&&n.push(i,s)}return n}function rF(t,e,n,r){let i=oF(e),s=aF.get(e).spec.config,o=(r?t.undone:t.done).popEvent(e,i);if(!o)return;let a=o.selection.resolve(o.transform.doc),l=(r?t.done:t.undone).addTransform(o.transform,e.selection.getBookmark(),s,i),c=new QL(r?l:o.remaining,r?o.remaining:l,null,0,-1);n(o.transform.setSelection(a).setMeta(aF,{redo:r,historyState:c}).scrollIntoView())}let iF=!1,sF=null;function oF(t){let e=t.plugins;if(sF!=e){iF=!1,sF=e;for(let t=0;t<e.length;t++)if(e[t].spec.historyPreserveItems){iF=!0;break}}return iF}const aF=new Tk("history"),lF=new Tk("closeHistory");function cF(t={}){return t={depth:t.depth||100,newGroupDelay:t.newGroupDelay||500},new Ek({key:aF,state:{init:()=>new QL(ZL.empty,ZL.empty,null,0,-1),apply:(e,n,r)=>function(t,e,n,r){let i,s=n.getMeta(aF);if(s)return s.historyState;n.getMeta(lF)&&(t=new QL(t.done,t.undone,null,0,-1));let o=n.getMeta("appendedTransaction");if(0==n.steps.length)return t;if(o&&o.getMeta(aF))return o.getMeta(aF).redo?new QL(t.done.addTransform(n,void 0,r,oF(e)),t.undone,eF(n.mapping.maps[n.steps.length-1]),t.prevTime,t.prevComposition):new QL(t.done,t.undone.addTransform(n,void 0,r,oF(e)),null,t.prevTime,t.prevComposition);if(!1===n.getMeta("addToHistory")||o&&!1===o.getMeta("addToHistory"))return(i=n.getMeta("rebased"))?new QL(t.done.rebased(n,i),t.undone.rebased(n,i),nF(t.prevRanges,n.mapping),t.prevTime,t.prevComposition):new QL(t.done.addMaps(n.mapping.maps),t.undone.addMaps(n.mapping.maps),nF(t.prevRanges,n.mapping),t.prevTime,t.prevComposition);{let i=n.getMeta("composition"),s=0==t.prevTime||!o&&t.prevComposition!=i&&(t.prevTime<(n.time||0)-r.newGroupDelay||!function(t,e){if(!e)return!1;if(!t.docChanged)return!0;let n=!1;return t.mapping.maps[0].forEach(((t,r)=>{for(let i=0;i<e.length;i+=2)t<=e[i+1]&&r>=e[i]&&(n=!0)})),n}(n,t.prevRanges)),a=o?nF(t.prevRanges,n.mapping):eF(n.mapping.maps[n.steps.length-1]);return new QL(t.done.addTransform(n,s?e.selection.getBookmark():void 0,r,oF(e)),ZL.empty,a,n.time,null==i?t.prevComposition:i)}}(n,r,e,t)},config:t,props:{handleDOMEvents:{beforeinput(t,e){let n=e.inputType,r="historyUndo"==n?hF:"historyRedo"==n?uF:null;return!!r&&(e.preventDefault(),r(t.state,t.dispatch))}}}})}const hF=(t,e)=>{let n=aF.getState(t);return!(!n||0==n.done.eventCount)&&(e&&rF(n,t,e,!1),!0)},uF=(t,e)=>{let n=aF.getState(t);return!(!n||0==n.undone.eventCount)&&(e&&rF(n,t,e,!0),!0)},dF=({injectGlobal:t})=>t`
    /* copy from https://github.com/ProseMirror/@milkdown/prose/blob/master/style/prosemirror.css */
    .ProseMirror {
        position: relative;
    }

    .ProseMirror {
        word-wrap: break-word;
        white-space: pre-wrap;
        white-space: break-spaces;
        -webkit-font-variant-ligatures: none;
        font-variant-ligatures: none;
        font-feature-settings: 'liga' 0; /* the above doesn't seem to work in Edge */
    }

    .ProseMirror pre {
        white-space: pre-wrap;
    }

    .ProseMirror li {
        position: relative;
    }

    .ProseMirror-hideselection *::selection {
        background: transparent;
    }
    .ProseMirror-hideselection *::-moz-selection {
        background: transparent;
    }
    .ProseMirror-hideselection {
        caret-color: transparent;
    }

    .ProseMirror-selectednode {
        outline: 2px solid #8cf;
    }

    /* Make sure li selections wrap around markers */

    li.ProseMirror-selectednode {
        outline: none;
    }

    li.ProseMirror-selectednode:after {
        content: '';
        position: absolute;
        left: -32px;
        right: -2px;
        top: -2px;
        bottom: -2px;
        border: 2px solid #8cf;
        pointer-events: none;
    }

    /* Protect against generic img rules */

    img.ProseMirror-separator {
        display: inline !important;
        border: none !important;
        margin: 0 !important;
    }
`,fF=(t,e)=>{t.set("code-fence",(({view:n,editable:r,onSelectLanguage:i,onBlur:s,onFocus:o,languageList:a})=>{const l=document.createElement("div"),c=document.createElement("div"),h=document.createElement("ul"),u=document.createElement("pre"),d=document.createElement("code"),f=document.createElement("div");f.className="code-fence_selector";const p=document.createElement("span");f.appendChild(p);const m=t.get(c_,"downArrow");r()&&m&&f.appendChild(m.dom),d.spellcheck=!1,c.className="code-fence_selector-wrapper",c.contentEditable="false",c.append(f),c.append(h),u.append(d);const g=document.createElement("div");d.append(g),g.style.whiteSpace="inherit",l.append(c,u),l.classList.add("code-fence"),t.onFlush((()=>{const n=((t,{css:e})=>{const n=x_(t),r=t.get(v_,"radius"),i=t.get(v_,"lineWidth");return e`
        background-color: ${n("background")};
        color: ${n("neutral")};
        font-size: 14px;
        padding: 18px 6px 22px;
        border-radius: ${r};
        font-family: ${t.get(a_,"typography")};

        .code-fence_selector-wrapper {
            position: relative;
        }

        .code-fence_selector {
            width: 180px;
            box-sizing: border-box;
            border-radius: ${r};
            margin: 0 18px 18px;
            cursor: pointer;
            background-color: ${n("surface")};
            position: relative;
            display: flex;
            color: ${n("neutral",.87)};
            letter-spacing: 0.5px;
            height: 42px;
            align-items: center;

            ${t.get(s_,void 0)};
            ${t.get(g_,void 0)};

            & > .icon {
                width: 42px;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                color: ${n("solid",.87)};
                border-left: ${i} solid ${n("line")};

                text-align: center;
                transition: all 0.2s ease-in-out;
                &:hover {
                    background: ${n("background")};
                    color: ${n("primary")};
                }
            }

            > span:first-child {
                padding-left: 16px;
                flex: 1;
                font-weight: 500;
            }
        }

        .code-fence_selector-list-item {
            list-style: none;
            line-height: 2;
            padding-left: 16px;
            cursor: pointer;
            margin: 0 !important;
            :hover {
                background: ${n("secondary",.12)};
                color: ${n("primary")};
            }
        }

        .code-fence_selector-list {
            &[data-fold='true'] {
                display: none;
            }

            margin: 0 !important;
            font-weight: 500;
            position: absolute;
            z-index: 1;
            top: 42px;
            box-sizing: border-box;
            left: 18px;
            padding: 8px 0;
            max-height: 260px;
            width: 180px;
            background-color: ${n("surface")};
            border-top: none;
            overflow-y: auto;
            display: flex;
            flex-direction: column;

            ${t.get(m_,["y"])}
            ${t.get(s_,void 0)};
            ${t.get(g_,void 0)};
        }
    `})(t,e);n&&l.classList.add(n)})),h.className="code-fence_selector-list",h.addEventListener("mousedown",(t=>{if(t.preventDefault(),t.stopPropagation(),!r())return;const e=t.target;if(!(e instanceof HTMLLIElement))return;const n=e.dataset.value;null!=n&&i(n)})),f.addEventListener("mousedown",(t=>{t.preventDefault(),t.stopPropagation(),r()&&o()}));const v=()=>{!r()||"true"===h.dataset.fold||s()};return document.addEventListener("mousedown",v),a.forEach((t=>{const e=document.createElement("li");e.className="code-fence_selector-list-item",e.innerText=t||"--",h.appendChild(e),e.setAttribute("data-value",t)})),{dom:l,contentDOM:g,onUpdate:t=>{l.dataset.language=t.attrs.language,p.innerText=t.attrs.language||"--",h.style.maxHeight="",h.setAttribute("data-fold",t.attrs.fold?"true":"false");const e=n.dom.parentElement;if(!e)throw iw();const r=e.getBoundingClientRect(),i=c.getBoundingClientRect(),s=h.getBoundingClientRect();let o,a;const u=i.top-r.top,d=r.height+r.top-(i.height+i.top);d>=s.height+14?o="bottom":u>=s.height+14?o="top":d>=u?(o="bottom",a=d-14):(o="top",a=u-14);const f="top"===o?-(null!=a?a:s.height):i.height;h.style.maxHeight=void 0!==a&&a>0?`${a}px`:"",h.style.top=`${f}px`},onDestroy:()=>{l.remove(),document.removeEventListener("mousedown",v)}}}))},pF=(t,{css:e})=>{const n=x_(t);t.set("image",(({placeholder:r,isBlock:i,onError:s,onLoad:o})=>{const a=e=>{var n;return null==(n=t.get(c_,e))?void 0:n.dom},l=document.createElement("span");l.classList.add("image-container"),t.onFlush((()=>{const s=e`
                display: inline-block;
                position: relative;
                text-align: center;
                font-size: 0;
                vertical-align: text-bottom;
                line-height: 1;

                ${i?"\n                width: 100%;\n                margin: 0 auto;\n                ":""}

                &.ProseMirror-selectednode::after {
                    content: '';
                    background: ${n("secondary",.38)};
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    bottom: 0;
                }

                img {
                    max-width: 100%;
                    height: auto;
                    object-fit: contain;
                    margin: 0 2px;
                }
                .icon,
                .placeholder {
                    display: none;
                }

                &.system {
                    width: 100%;
                    padding: 0 32px;
                    font-size: inherit;

                    img {
                        width: 0;
                        height: 0;
                        display: none;
                    }

                    .icon,
                    .placeholder {
                        display: inline;
                    }

                    box-sizing: border-box;
                    height: 48px;
                    background-color: ${n("background")};
                    border-radius: ${t.get(v_,"radius")};
                    display: inline-flex;
                    gap: 32px;
                    justify-content: flex-start;
                    align-items: center;
                    .placeholder {
                        margin: 0;
                        line-height: 1;
                        &::before {
                            content: '';
                            font-size: 14px;
                            color: ${n("neutral",.6)};
                        }
                    }
                }

                &.empty {
                    .placeholder {
                        &::before {
                            content: '${r}';
                        }
                    }
                }
            `;s&&l.classList.add(s)}));const c=document.createElement("img");l.append(c);let h=a("image");const u=document.createElement("span");u.classList.add("placeholder"),l.append(h,u);const d=t=>{const e=a(t);l.replaceChild(e,h),h=e};return{dom:l,onUpdate:t=>{const{src:e,alt:n,title:r,loading:i,failed:a}=t.attrs;return c.src=e,c.title=r||n,c.alt=n,0===e.length?(l.classList.add("system","empty"),void d("image")):i?void(t=>{l.classList.add("system","loading"),d("loading");const e=document.createElement("img");e.src=t,e.onerror=()=>{null==s||s(e)},e.onload=()=>{null==o||o(e)}})(e):a?(l.classList.remove("loading","empty"),l.classList.add("system","failed"),void d("brokenImage")):void(e.length>0?l.classList.remove("system","empty","loading"):(l.classList.add("system","empty"),d("image")))}}}))},mF=(t,e)=>{t.set("inner-editor",(({view:n,getPos:r,render:i})=>{const s=((t,e)=>{let n,r=!1;return{isEditing:()=>r,innerView:()=>n,openEditor:(i,s)=>{n=new oO(i,{state:xk.create({doc:s,plugins:[cF(),wP({...uP,Backspace:oP(HO,(e=>{var r;if(!e.selection.empty||n&&n.state.doc.textContent.length>0)return!1;const{dispatch:i,state:s}=t,o=null==(r=s.schema.nodes.paragraph)?void 0:r.create();if(!o)return!1;const a=s.tr.replaceSelectionWith(o);let l=a.selection.from-2;return l<0&&(l=0),i(a.setSelection(ak.create(a.doc,l))),t.focus(),!0})),"Mod-Enter":(e,n)=>{var r;if(n){const{state:e}=t,{to:n}=e.selection,i=null==(r=e.schema.nodes.paragraph)?void 0:r.createAndFill();if(!i)return!1;const s=e.tr.replaceWith(n,n,i);t.dispatch(s.setSelection(ak.create(s.doc,n))),t.focus()}return!0}}),wP({"Mod-z":hF,"Mod-y":uF,"Shift-Mod-z":uF})]}),plugins:[],dispatchTransaction:r=>{if(!n)return;const{state:i,transactions:s}=n.state.applyTransaction(r);if(n.updateState(i),!r.getMeta("fromOutside")){const n=t.state.tr,r=ET.offset(e()+1);s.forEach((t=>{const{steps:e}=t;e.forEach((t=>{const e=t.map(r);if(!e)throw new Error("step discarded!");n.step(e)}))})),n.docChanged&&t.dispatch(n)}}}),n.focus();const{state:o}=n;n.dispatch(o.tr.setSelection(ak.create(o.doc,0))),r=!0},closeEditor:()=>{n&&n.destroy(),n=void 0,r=!1}}})(n,r),o=document.createElement("div");o.classList.add("math-block");const a=document.createElement("div"),l=document.createElement("div");let c="",h="",u="";return t.onFlush((()=>{({codeStyle:c,hideCodeStyle:h,previewPanelStyle:u}=((t,{css:e})=>{const n=x_(t),r=t.get(v_,"radius"),i=t.get(a_,"code");return{codeStyle:e`
        color: ${n("neutral",.87)};
        background-color: ${n("background")};
        border-radius: ${r};
        padding: 16px 32px;
        font-size: 14px;
        font-family: ${i};
        overflow: hidden;
        line-height: 1.5;
        .ProseMirror {
            outline: none;
        }
    `,hideCodeStyle:e`
        display: none;
    `,previewPanelStyle:e`
        display: flex;
        justify-content: center;
        padding: 16px 0;
    `}})(t,e)),c&&h&&a.classList.add(c,h),u&&l.classList.add(u)})),o.append(a),{dom:o,preview:l,editor:a,onUpdate:(t,e)=>{var n;if(e){const e=t.attrs.value||t.textContent||"";return a.dataset.value=e,void i(e)}const r=s.innerView();if(r){const e=r.state,n=t.content.findDiffStart(e.doc.content);if(null!=n){const i=t.content.findDiffEnd(e.doc.content);if(i){let{a:s,b:o}=i;const a=n-Math.min(s,o);a>0&&(s+=a,o+=a),r.dispatch(e.tr.replace(n,o,t.slice(n,s)).setMeta("fromOutside",!0))}}}const o=(null==(n=t.content.firstChild)?void 0:n.text)||"";a.dataset.value=o,i(o)},onFocus:t=>{!n.editable||(h&&a.classList.remove(h),s.openEditor(a,t),o.classList.add("ProseMirror-selectednode"))},onBlur:()=>{h&&a.classList.add(h),s.closeEditor(),o.classList.remove("ProseMirror-selectednode")},onDestroy:()=>{l.remove(),a.remove(),o.remove()},stopEvent:t=>{const e=s.innerView(),{target:n}=t,r=n&&(null==e?void 0:e.dom.contains(n));return!(!e||!r)}}}))},gF=(t,e)=>{UO(t,e,((e,n,r,i)=>{const s=t.dom.parentElement;if(!s)throw iw();const o=n.left-e.left;let a=e.left-i.left-(r.width-o)/2;const l=e.bottom-i.top+14+s.scrollTop;a<0&&(a=0);const c=s.clientWidth-(r.width+4);return a>c&&(a=c),[l,a]}))},vF=(t,e)=>{t.set("input-chip",(({isBindMode:n,onUpdate:r,buttonText:i,placeholder:s,width:o="400px",calculatePosition:a=gF})=>{let l=null,c=!1,h="";const u=document.createElement("div");t.onFlush((()=>{const n=((t,{css:e},n)=>{const r=x_(t);return e`
        ${t.get(s_,void 0)}
        ${t.get(g_,void 0)}

        display: inline-flex;
        justify-content: space-between;
        align-items: center;
        position: absolute;
        background: ${r("surface")};
        border-radius: ${t.get(v_,"radius")};
        font-size: 16px;

        height: 56px;
        box-sizing: border-box;
        width: ${n.width};
        padding: 0 16px;
        gap: 16px;
        z-index: 2;

        input,
        button {
            all: unset;
        }

        input {
            flex-grow: 1;
            caret-color: ${r("primary")};
            &::placeholder {
                color: ${r("neutral",.6)};
            }
        }

        button {
            cursor: pointer;
            height: 36px;
            color: ${r("primary")};
            font-size: 14px;
            padding: 0 8px;
            font-weight: 500;
            letter-spacing: 1.25px;
            &:hover {
                background-color: ${r("secondary",.12)};
            }
            &.disable {
                color: ${r("neutral",.38)};
                cursor: not-allowed;
                &:hover {
                    background: transparent;
                }
            }
            &.hide {
                display: none;
            }
        }

        &.hide {
            display: none;
        }
    `})(t,e,{width:o});n&&u.classList.add(n)})),u.classList.add("tooltip-input");const d=document.createElement("input");s&&(d.placeholder=s),u.appendChild(d),n||(l=document.createElement("button"),l.innerText=i||"APPLY",u.appendChild(l));const f=()=>{u.classList.add("hide")},p=t=>{const{target:e}=t;if(e instanceof HTMLInputElement){if(h=e.value,!l)return void r(h);if(!h)return l.classList.add("disable"),void(c=!0);l.classList.remove("disable"),c=!1}},m=t=>{c||(t.stopPropagation(),r(h),f())},g=t=>{"key"in t&&"Enter"===t.key&&(r(h),f())};return{dom:u,init:t=>{const e=t.dom.parentElement;if(!e)throw iw();d.addEventListener("input",p),d.addEventListener("keydown",g),null==l||l.addEventListener("mousedown",m),e.appendChild(u),f()},show:t=>{u.classList.remove("hide"),a(t,u)},hide:f,destroy:()=>{d.removeEventListener("input",p),d.removeEventListener("keydown",g),null==l||l.removeEventListener("mousedown",m),u.remove()},update:t=>{h=t,d.value=t}}}))},yF=(t,{css:e})=>{const n=x_(t);t.set("task-list-item",(({onChange:r,editable:i})=>{const s=e=>{var n;return null==(n=t.get(c_,e))?void 0:n.dom},o=document.createElement("li"),a=document.createElement("label"),l=document.createElement("span"),c=document.createElement("input"),h=document.createElement("div");let u=s("unchecked");a.appendChild(u);return a.append(c,l),o.append(a,h),a.contentEditable="false",c.type="checkbox",i()||(c.disabled=!0,a.style.cursor="not-allowed"),c.onchange=t=>{if(t.target instanceof HTMLInputElement){if(!i())return void(c.checked=!c.checked);t.preventDefault(),r(c.checked)}},o.dataset.type="task-item",o.classList.add("task-list-item"),t.onFlush((()=>{const t=e`
                list-style-type: none;
                position: relative;

                & > div {
                    overflow: hidden;
                    padding: 0 2px;
                    width: 100%;
                }

                label {
                    display: inline-block;
                    width: 24px;
                    height: 24px;
                    cursor: pointer;
                    input {
                        visibility: hidden;
                    }
                }
                &[data-checked='true'] {
                    > label {
                        color: ${n("primary")};
                    }
                }
                &[data-checked='false'] {
                    > label {
                        color: ${n("solid",.87)};
                    }
                }
                .paragraph {
                    margin: 8px 0;
                }
            `;t&&o.classList.add(t)})),{dom:o,contentDOM:h,onUpdate:t=>{o.dataset.checked=t.attrs.checked,t.attrs.checked?c.setAttribute("checked","checked"):c.removeAttribute("checked"),(t=>{const e=s(t);a.replaceChild(e,u),u=e})(t.attrs.checked?"checked":"unchecked")}}}))},bF=(t,e)=>{[vF,pF,fF,yF,mF].forEach((n=>{n(t,e)}))};let xF=t=>crypto.getRandomValues(new Uint8Array(t));const wF=t=>Object.prototype.hasOwnProperty.call(t,"origin");let EF=class t extends Array{findThenRun(t,e){const n=this.findIndex((e=>wF(e)&&e.origin===t));return n<0||e(n),this}configure(t,e){return this.findThenRun(t,(n=>{this.splice(n,1,t(e))}))}replace(t,e){return this.findThenRun(t,(t=>{this.splice(t,1,e)}))}remove(t){return this.findThenRun(t,(t=>{this.splice(t,1)}))}headless(){return this.filter(wF).forEach((t=>{this.configure(t.origin,{headless:!0})})),this}static create(e){return new t(...e)}};((t,e=21)=>{((t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*e/t.length)})(t,e,xF)})("abcedfghicklmn",10);const _F=t=>{const e=()=>async n=>{await n.wait($P);const r=t(n);n.update(VP,(t=>[...t,r])),e.plugin=r};return e},SF=t=>(e,...n)=>{var r;const i=null!=(r=null==t?void 0:t(e,...n))?r:n;return Array.isArray(i)?i.filter((t=>t)).join(" "):i},TF=(t,e,n)=>[t,e,n];function kF(t,e){try{const n=t.get(i_),r=t.get(ZE);if(!r.css)throw rw();return{getClassName:SF(null==e?void 0:e.className),getStyle:t=>null!=e&&e.headless?"":t(r),themeManager:n}}catch{throw rw()}}const AF=t=>{const e=n=>{const r=t(n);return r.origin=e,r};return e},CF=(t,e)=>n=>{const r=n;return r.extend=n=>e(((...e)=>n(t(...e),...e))),r},RF=(...t)=>{const e=t.length;let n=e;for(;n--;)if("function"!=typeof t[n])throw new TypeError("Expected a function");return(...n)=>{let r=0,i=e?t[r](...n):n[0];for(;++r<e;)i=t[r](i);return i}},MF=pw({},"optionsPipeCtx"),IF=pw([],"injectPipeCtx"),DF=async(t,e)=>{const{pipelineCtx:n,onCleanup:r,pre:i}=t,s=n.get(IF);s&&(s.forEach((t=>i.inject(t))),r((t=>{s.forEach((e=>t.remove(e)))}))),await e()},OF=async(t,e)=>{const{ctx:n}=t;await n.wait(DP),await e()},PF=pw(void 0,"getRemarkPluginsPipeCtx"),LF=async(t,e)=>{const{ctx:n,pipelineCtx:r,onCleanup:i}=t;await n.wait(FP);const s=r.get(PF);if(s){const t=s(n);n.update(jP,(e=>e.concat(t))),i((()=>{n.update(jP,(e=>e.filter((e=>!t.includes(e)))))}))}await e()},FF=pw(void 0,"getSchemaPipeCtx"),NF=pw({},"Type"),BF=async(t,e)=>{var n;const{ctx:r,pipelineCtx:i,onCleanup:s}=t,o=i.get(FF),a=null!=(n=null==o?void 0:o(t.ctx))?n:{};let l={},c={};if(a.node){l=a.node;const t=Object.entries(a.node);r.update(qP,(e=>[...e,...t])),s((()=>{r.update(qP,(e=>e.filter((e=>!t.includes(e)))))}))}if(a.mark){c=a.mark;const t=Object.entries(a.mark);r.update(KP,(e=>[...e,...t])),s((()=>{r.update(KP,(e=>e.filter((e=>!t.includes(e)))))}))}await r.wait($P);const h=r.get(YP),u=Object.keys(l).map((t=>[t,h.nodes[t]])),d=Object.keys(c).map((t=>[t,h.marks[t]])),f=Object.fromEntries([...u,...d]);i.set(NF,f),await e()},UF=pw(void 0,"getCommandsPipeCtx"),VF=async(t,e)=>{const{ctx:n,pipelineCtx:r,onCleanup:i}=t,s=r.get(UF);if(s){const t=s(r.get(NF),n);t.forEach((([t,e])=>{n.get(CL).create(t,e)})),i((()=>{t.forEach((([t])=>{n.get(CL).remove(t)}))}))}await e()},jF=pw(void 0,"getInputRulesPipeCtx"),zF=async(t,e)=>{const{ctx:n,pipelineCtx:r,onCleanup:i}=t,s=r.get(jF);if(s){const t=s(r.get(NF),n);n.update(UP,(e=>[...e,...t])),i((()=>{n.update(UP,(e=>e.filter((e=>!t.includes(e)))))}))}await e()},GF=pw({},"shortcutsPipeCtx"),WF=async(t,e)=>{const{pipelineCtx:n,ctx:r,onCleanup:i}=t,s=n.get(GF),o=n.get(MF),a=Object.entries(s).flatMap((([t,[e,n,i]])=>{const s=()=>r.get(CL).call(e,i),a=((t,e)=>{var n,r;return null!=(r=null==(n=null==o?void 0:o.keymap)?void 0:n[t])?r:e})(t,n);return Array.isArray(a)?a.map((t=>({key:t,runner:s}))):{key:a,runner:s}})).map((t=>[t.key,t.runner])),l=wP(Object.fromEntries(a));r.update(VP,(t=>t.concat(l))),i((()=>{r.update(VP,(t=>t.filter((t=>t!==l))))})),await e()},HF=pw(void 0,"getProsePluginsPipeCtx"),$F=async(t,e)=>{const{pipelineCtx:n,ctx:r,onCleanup:i}=t,s=n.get(HF);if(s){const t=s(n.get(NF),r);r.update(VP,(e=>[...e,...t])),i((()=>{r.update(VP,(e=>e.filter((e=>!t.includes(e)))))}))}await e()},YF=pw(void 0,"getViewPipeCtx"),XF=async(t,e)=>{const{pipelineCtx:n,ctx:r,onCleanup:i}=t,s=n.get(YF),o=n.get(MF),a=o.view?o.view(r):null==s?void 0:s(r);if(a){const t=Object.entries(a).filter((([t])=>-1!==r.get(qP).findIndex((e=>e[0]===t)))),e=Object.entries(a).filter((([t])=>-1!==r.get(KP).findIndex((e=>e[0]===t))));r.update(zP,(e=>[...e,...t])),r.update(GP,(t=>[...t,...e])),i((()=>{r.update(zP,(e=>e.filter((e=>!t.includes(e))))),r.update(GP,(t=>t.filter((t=>!e.includes(t)))))}))}await e()},qF=pw("","idPipeCtx"),KF=async(t,e)=>{const{pipelineCtx:n}=t;n.inject(qF).inject(MF).inject(IF).inject(PF).inject(FF).inject(NF).inject(UF).inject(jF).inject(GF).inject(HF).inject(YF),await e()},ZF=t=>{const e=(t=>(e,n)=>{let r=-1;const i=s=>{if(s<=r)return Promise.reject(new Error("next() called multiple times"));r=s;let o=t[s];if(s===t.length&&(o=n),!o)return Promise.resolve();try{return Promise.resolve(o(e,(()=>i(s+1))))}catch(a){return Promise.reject(a)}};return i(0)})(t),n=fw(),r=Aw(),i=new Set,s=new xw(n,r),o=t=>{i.add(t)},a=(t,n)=>e({pre:t,ctx:n,pipelineCtx:s,onCleanup:o});return a.runCleanup=async t=>{await Promise.all([...i].map((e=>e(t))))},a},JF=t=>RF(AF,CF(t,JF))((e=>n=>async r=>{const i=ZF([KF,OF,async({pipelineCtx:n},i)=>{const s=kF(r,e),o=t(s,e),{id:a,commands:l,remarkPlugins:c,schema:h,inputRules:u,shortcuts:d,prosePlugins:f,view:p,injectSlices:m}=o,g=null==e?void 0:e.view,v=null!=m?m:[],y={...e||{},view:g?t=>({[a]:g(t)}):void 0};n.set(IF,v),n.set(qF,a),n.set(MF,y),n.set(PF,c),n.set(FF,(t=>({mark:{[a]:h(t)}}))),l&&n.set(UF,((t,e)=>l(t[a],e))),u&&n.set(jF,((t,e)=>u(t[a],e))),d&&n.set(GF,d),f&&n.set(HF,((t,e)=>f(t[a],e))),p&&n.set(YF,(t=>({[a]:p(t)}))),await i()},DF,LF,BF,VF,zF,WF,$F,XF]);return await i(n,r),i.runCleanup})),QF=t=>RF(AF,CF(t,QF))((e=>n=>async r=>{const i=ZF([KF,OF,async({pipelineCtx:n},i)=>{const s=kF(r,e),o=t(s,e),{id:a,commands:l,remarkPlugins:c,schema:h,inputRules:u,shortcuts:d,prosePlugins:f,view:p,injectSlices:m}=o,g=null==e?void 0:e.view,v=null!=m?m:[],y={...e||{},view:g?t=>({[a]:g(t)}):void 0};n.set(IF,v),n.set(qF,a),n.set(MF,y),n.set(PF,c),n.set(FF,(t=>({node:{[a]:h(t)}}))),l&&n.set(UF,((t,e)=>l(t[a],e))),u&&n.set(jF,((t,e)=>u(t[a],e))),d&&n.set(GF,d),f&&n.set(HF,((t,e)=>f(t[a],e))),p&&n.set(YF,(t=>({[a]:p(t)}))),await i()},DF,LF,BF,VF,zF,WF,$F,XF]);return await i(n,r),i.runCleanup})),tN=t=>RF(AF,CF(t,tN))((e=>n=>async r=>{const i=ZF([KF,OF,async({pipelineCtx:n},i)=>{const s=kF(r,e),o=t(s,e),{commands:a,remarkPlugins:l,schema:c,inputRules:h,shortcuts:u,prosePlugins:d,view:f,injectSlices:p}=o,m=null!=p?p:[];n.set(IF,m),n.set(MF,e||{}),n.set(PF,l),c&&n.set(FF,c),a&&n.set(UF,a),h&&n.set(jF,h),u&&n.set(GF,u),d&&n.set(HF,d),f&&n.set(YF,f),await i()},DF,LF,BF,VF,zF,WF,$F,XF]);return await i(n,r),i.runCleanup}));function eN(t,e){return function(n,r){let{$from:i,$to:s,node:o}=n.selection;if(o&&o.isBlock||i.depth<2||!i.sameParent(s))return!1;let a=i.node(-1);if(a.type!=t)return!1;if(0==i.parent.content.size&&i.node(-1).childCount==i.indexAfter(-1)){if(3==i.depth||i.node(-3).type!=t||i.index(-2)!=i.node(-2).childCount-1)return!1;if(r){let e=S_.empty,s=i.index(-1)?1:i.index(-2)?2:3;for(let t=i.depth-s;t>=i.depth-3;t--)e=S_.from(i.node(t).copy(e));let o=i.indexAfter(-1)<i.node(-2).childCount?1:i.indexAfter(-2)<i.node(-3).childCount?2:3;e=e.append(S_.from(t.createAndFill()));let a=i.before(i.depth-(s-1)),l=n.tr.replace(a,i.after(-o),new M_(e,4-s,0)),c=-1;l.doc.nodesBetween(a,l.doc.content.size,((t,e)=>{if(c>-1)return!1;t.isTextblock&&0==t.content.size&&(c=e+1)})),c>-1&&l.setSelection(rk.near(l.doc.resolve(c))),r(l.scrollIntoView())}return!0}let l=s.pos==i.end()?a.contentMatchAt(0).defaultType:null,c=n.tr.delete(i.pos,s.pos),h=l?[e?{type:t,attrs:e}:null,{type:l}]:void 0;return!!UT(c.doc,i.pos,2,h)&&(r&&r(c.split(i.pos,2,h).scrollIntoView()),!0)}}function nN(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==t));return!!s&&(!n||(r.node(s.depth-1).type==t?function(t,e,n,r){let i=t.tr,s=r.end,o=r.$to.end(r.depth);s<o&&(i.step(new OT(s-1,o,s,o,new M_(S_.from(n.create(null,r.parent.copy())),1,0),1,!0)),r=new $_(i.doc.resolve(r.$from.pos),i.doc.resolve(o),r.depth));const a=FT(r);if(null==a)return!1;i.lift(r,a);let l=i.mapping.map(s,-1)-1;VT(i.doc,l)&&i.join(l);return e(i.scrollIntoView()),!0}(e,n,t,s):function(t,e,n){let r=t.tr,i=n.parent;for(let f=n.end,p=n.endIndex-1,m=n.startIndex;p>m;p--)f-=i.child(p).nodeSize,r.delete(f-1,f+1);let s=r.doc.resolve(n.start),o=s.nodeAfter;if(r.mapping.map(n.end)!=n.start+s.nodeAfter.nodeSize)return!1;let a=0==n.startIndex,l=n.endIndex==i.childCount,c=s.node(-1),h=s.index(-1);if(!c.canReplace(h+(a?0:1),h+1,o.content.append(l?S_.empty:S_.from(i))))return!1;let u=s.pos,d=u+o.nodeSize;return r.step(new OT(u-(a?1:0),d+(l?1:0),u+1,d-1,new M_((a?S_.empty:S_.from(i.copy(S_.empty))).append(l?S_.empty:S_.from(i.copy(S_.empty))),a?0:1,l?0:1),a?0:1)),e(r.scrollIntoView()),!0}(e,n,s)))}}function rN(t){return function(e,n){let{$from:r,$to:i}=e.selection,s=r.blockRange(i,(e=>e.childCount>0&&e.firstChild.type==t));if(!s)return!1;let o=s.startIndex;if(0==o)return!1;let a=s.parent,l=a.child(o-1);if(l.type!=t)return!1;if(n){let r=l.lastChild&&l.lastChild.type==a.type,i=S_.from(r?t.create():null),o=new M_(S_.from(t.create(null,S_.from(a.type.create(null,i)))),r?3:1,0),c=s.start,h=s.end;n(e.tr.step(new OT(c-(r?3:1),h,c,h,o,1,!0)).scrollIntoView())}return!0}}function iN(t){return"object"==typeof t&&null!=t&&1===t.nodeType}function sN(t,e){return(!e||"hidden"!==t)&&"visible"!==t&&"clip"!==t}function oN(t,e){if(t.clientHeight<t.scrollHeight||t.clientWidth<t.scrollWidth){var n=getComputedStyle(t,null);return sN(n.overflowY,e)||sN(n.overflowX,e)||function(t){var e=function(t){if(!t.ownerDocument||!t.ownerDocument.defaultView)return null;try{return t.ownerDocument.defaultView.frameElement}catch(e){return null}}(t);return!!e&&(e.clientHeight<t.scrollHeight||e.clientWidth<t.scrollWidth)}(t)}return!1}function aN(t,e,n,r,i,s,o,a){return s<t&&o>e||s>t&&o<e?0:s<=t&&a<=n||o>=e&&a>=n?s-t-r:o>e&&a<n||s<t&&a>n?o-e+i:0}var lN,cN=function(t,e){var n=window,r=e.scrollMode,i=e.block,s=e.inline,o=e.boundary,a=e.skipOverflowHiddenElements,l="function"==typeof o?o:function(t){return t!==o};if(!iN(t))throw new TypeError("Invalid target");for(var c,h,u=document.scrollingElement||document.documentElement,d=[],f=t;iN(f)&&l(f);){if((f=null==(h=(c=f).parentElement)?c.getRootNode().host||null:h)===u){d.push(f);break}null!=f&&f===document.body&&oN(f)&&!oN(document.documentElement)||null!=f&&oN(f,a)&&d.push(f)}for(var p=n.visualViewport?n.visualViewport.width:innerWidth,m=n.visualViewport?n.visualViewport.height:innerHeight,g=window.scrollX||pageXOffset,v=window.scrollY||pageYOffset,y=t.getBoundingClientRect(),b=y.height,x=y.width,w=y.top,E=y.right,_=y.bottom,S=y.left,T="start"===i||"nearest"===i?w:"end"===i?_:w+b/2,k="center"===s?S+x/2:"end"===s?E:S,A=[],C=0;C<d.length;C++){var R=d[C],M=R.getBoundingClientRect(),I=M.height,D=M.width,O=M.top,P=M.right,L=M.bottom,F=M.left;if("if-needed"===r&&w>=0&&S>=0&&_<=m&&E<=p&&w>=O&&_<=L&&S>=F&&E<=P)return A;var N=getComputedStyle(R),B=parseInt(N.borderLeftWidth,10),U=parseInt(N.borderTopWidth,10),V=parseInt(N.borderRightWidth,10),j=parseInt(N.borderBottomWidth,10),z=0,G=0,W="offsetWidth"in R?R.offsetWidth-R.clientWidth-B-V:0,H="offsetHeight"in R?R.offsetHeight-R.clientHeight-U-j:0,$="offsetWidth"in R?0===R.offsetWidth?0:D/R.offsetWidth:0,Y="offsetHeight"in R?0===R.offsetHeight?0:I/R.offsetHeight:0;if(u===R)z="start"===i?T:"end"===i?T-m:"nearest"===i?aN(v,v+m,m,U,j,v+T,v+T+b,b):T-m/2,G="start"===s?k:"center"===s?k-p/2:"end"===s?k-p:aN(g,g+p,p,B,V,g+k,g+k+x,x),z=Math.max(0,z+v),G=Math.max(0,G+g);else{z="start"===i?T-O-U:"end"===i?T-L+j+H:"nearest"===i?aN(O,L,I,U,j+H,T,T+b,b):T-(O+I/2)+H/2,G="start"===s?k-F-B:"center"===s?k-(F+D/2)+W/2:"end"===s?k-P+V+W:aN(F,P,D,B,V+W,k,k+x,x);var X=R.scrollLeft,q=R.scrollTop;T+=q-(z=Math.max(0,Math.min(q+z/Y,R.scrollHeight-I/Y+H))),k+=X-(G=Math.max(0,Math.min(X+G/$,R.scrollWidth-D/$+W)))}A.push({el:R,top:z,left:G})}return A};function hN(t){return t===Object(t)&&0!==Object.keys(t).length}function uN(t,e){var n=t.isConnected||t.ownerDocument.documentElement.contains(t);if(hN(e)&&"function"==typeof e.behavior)return e.behavior(n?cN(t,e):[]);if(n){var r=function(t){return!1===t?{block:"end",inline:"nearest"}:hN(t)?t:{block:"start",inline:"nearest"}}(e);return function(t,e){void 0===e&&(e="auto");var n="scrollBehavior"in document.body.style;t.forEach((function(t){var r=t.el,i=t.top,s=t.left;r.scroll&&n?r.scroll({top:i,left:s,behavior:e}):(r.scrollTop=i,r.scrollLeft=s)}))}(cN(t,r),r.behavior)}}var dN=function(){return lN||(lN="performance"in window?performance.now.bind(performance):Date.now),lN()};function fN(t){var e=dN(),n=Math.min((e-t.startTime)/t.duration,1),r=t.ease(n),i=t.startX+(t.x-t.startX)*r,s=t.startY+(t.y-t.startY)*r;t.method(i,s),i!==t.x||s!==t.y?requestAnimationFrame((function(){return fN(t)})):t.cb()}function pN(t,e,n,r,i,s){var o,a,l;void 0===r&&(r=600),void 0===i&&(i=function(t){return 1+--t*t*t*t*t}),o=t,a=t.scrollLeft,l=t.scrollTop,fN({scrollable:o,method:function(e,n){t.scrollLeft=Math.ceil(e),t.scrollTop=Math.ceil(n)},startTime:dN(),startX:a,startY:l,x:e,y:n,duration:r,ease:i,cb:s})}const mN=function(t,e){var n=e||{};return function(t){return t&&!t.behavior||"smooth"===t.behavior}(n)?uN(t,{block:n.block,inline:n.inline,scrollMode:n.scrollMode,boundary:n.boundary,behavior:function(t){return Promise.all(t.reduce((function(t,e){var r=e.el,i=e.left,s=e.top,o=r.scrollLeft,a=r.scrollTop;return o===i&&a===s?t:[].concat(t,[new Promise((function(t){return pN(r,i,s,n.duration,n.ease,(function(){return t({el:r,left:[o,i],top:[a,s]})}))}))])}),[]))}}):Promise.resolve(uN(t,e))};function gN(t){t.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/}}function vN(t){t.register(gN),t.languages.c=t.languages.extend("clike",{comment:{pattern:/\/\/(?:[^\r\n\\]|\\(?:\r\n?|\n|(?![\r\n])))*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},string:{pattern:/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},"class-name":{pattern:/(\b(?:enum|struct)\s+(?:__attribute__\s*\(\([\s\S]*?\)\)\s*)?)\w+|\b[a-z]\w*_t\b/,lookbehind:!0},keyword:/\b(?:_Alignas|_Alignof|_Atomic|_Bool|_Complex|_Generic|_Imaginary|_Noreturn|_Static_assert|_Thread_local|__attribute__|asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|inline|int|long|register|return|short|signed|sizeof|static|struct|switch|typedef|typeof|union|unsigned|void|volatile|while)\b/,function:/\b[a-z_]\w*(?=\s*\()/i,number:/(?:\b0x(?:[\da-f]+(?:\.[\da-f]*)?|\.[\da-f]+)(?:p[+-]?\d+)?|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?)[ful]{0,4}/i,operator:/>>=?|<<=?|->|([-+&|:])\1|[?:~]|[-+*/%&|^!=<>]=?/}),t.languages.insertBefore("c","string",{char:{pattern:/'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n]){0,32}'/,greedy:!0}}),t.languages.insertBefore("c","string",{macro:{pattern:/(^[\t ]*)#\s*[a-z](?:[^\r\n\\/]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|\\(?:\r\n|[\s\S]))*/im,lookbehind:!0,greedy:!0,alias:"property",inside:{string:[{pattern:/^(#\s*include\s*)<[^>]+>/,lookbehind:!0},t.languages.c.string],char:t.languages.c.char,comment:t.languages.c.comment,"macro-name":[{pattern:/(^#\s*define\s+)\w+\b(?!\()/i,lookbehind:!0},{pattern:/(^#\s*define\s+)\w+\b(?=\()/i,lookbehind:!0,alias:"function"}],directive:{pattern:/^(#\s*)[a-z]+/,lookbehind:!0,alias:"keyword"},"directive-hash":/^#/,punctuation:/##|\\(?=[\r\n])/,expression:{pattern:/\S[\s\S]*/,inside:t.languages.c}}}}),t.languages.insertBefore("c","function",{constant:/\b(?:EOF|NULL|SEEK_CUR|SEEK_END|SEEK_SET|__DATE__|__FILE__|__LINE__|__TIMESTAMP__|__TIME__|__func__|stderr|stdin|stdout)\b/}),delete t.languages.c.boolean}function yN(t){var e,n,r;t.register(vN),e=t,n=/\b(?:alignas|alignof|asm|auto|bool|break|case|catch|char|char16_t|char32_t|char8_t|class|co_await|co_return|co_yield|compl|concept|const|const_cast|consteval|constexpr|constinit|continue|decltype|default|delete|do|double|dynamic_cast|else|enum|explicit|export|extern|final|float|for|friend|goto|if|import|inline|int|int16_t|int32_t|int64_t|int8_t|long|module|mutable|namespace|new|noexcept|nullptr|operator|override|private|protected|public|register|reinterpret_cast|requires|return|short|signed|sizeof|static|static_assert|static_cast|struct|switch|template|this|thread_local|throw|try|typedef|typeid|typename|uint16_t|uint32_t|uint64_t|uint8_t|union|unsigned|using|virtual|void|volatile|wchar_t|while)\b/,r=/\b(?!<keyword>)\w+(?:\s*\.\s*\w+)*\b/.source.replace(/<keyword>/g,(function(){return n.source})),e.languages.cpp=e.languages.extend("c",{"class-name":[{pattern:RegExp(/(\b(?:class|concept|enum|struct|typename)\s+)(?!<keyword>)\w+/.source.replace(/<keyword>/g,(function(){return n.source}))),lookbehind:!0},/\b[A-Z]\w*(?=\s*::\s*\w+\s*\()/,/\b[A-Z_]\w*(?=\s*::\s*~\w+\s*\()/i,/\b\w+(?=\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>\s*::\s*\w+\s*\()/],keyword:n,number:{pattern:/(?:\b0b[01']+|\b0x(?:[\da-f']+(?:\.[\da-f']*)?|\.[\da-f']+)(?:p[+-]?[\d']+)?|(?:\b[\d']+(?:\.[\d']*)?|\B\.[\d']+)(?:e[+-]?[\d']+)?)[ful]{0,4}/i,greedy:!0},operator:/>>=?|<<=?|->|--|\+\+|&&|\|\||[?:~]|<=>|[-+*/%&|^!=<>]=?|\b(?:and|and_eq|bitand|bitor|not|not_eq|or|or_eq|xor|xor_eq)\b/,boolean:/\b(?:false|true)\b/}),e.languages.insertBefore("cpp","string",{module:{pattern:RegExp(/(\b(?:import|module)\s+)/.source+"(?:"+/"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|<[^<>\r\n]*>/.source+"|"+/<mod-name>(?:\s*:\s*<mod-name>)?|:\s*<mod-name>/.source.replace(/<mod-name>/g,(function(){return r}))+")"),lookbehind:!0,greedy:!0,inside:{string:/^[<"][\s\S]+/,operator:/:/,punctuation:/\./}},"raw-string":{pattern:/R"([^()\\ ]{0,16})\([\s\S]*?\)\1"/,alias:"string",greedy:!0}}),e.languages.insertBefore("cpp","keyword",{"generic-function":{pattern:/\b(?!operator\b)[a-z_]\w*\s*<(?:[^<>]|<[^<>]*>)*>(?=\s*\()/i,inside:{function:/^\w+/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e.languages.cpp}}}}),e.languages.insertBefore("cpp","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}}),e.languages.insertBefore("cpp","class-name",{"base-clause":{pattern:/(\b(?:class|struct)\s+\w+\s*:\s*)[^;{}"'\s]+(?:\s+[^;{}"'\s]+)*(?=\s*[;{])/,lookbehind:!0,greedy:!0,inside:e.languages.extend("cpp",{})}}),e.languages.insertBefore("inside","double-colon",{"class-name":/\b[a-z_]\w*\b(?!\s*::)/i},e.languages.cpp["base-clause"])}function bN(t){t.register(yN),t.languages.arduino=t.languages.extend("cpp",{keyword:/\b(?:String|array|bool|boolean|break|byte|case|catch|continue|default|do|double|else|finally|for|function|goto|if|in|instanceof|int|integer|long|loop|new|null|return|setup|string|switch|throw|try|void|while|word)\b/,constant:/\b(?:ANALOG_MESSAGE|DEFAULT|DIGITAL_MESSAGE|EXTERNAL|FIRMATA_STRING|HIGH|INPUT|INPUT_PULLUP|INTERNAL|INTERNAL1V1|INTERNAL2V56|LED_BUILTIN|LOW|OUTPUT|REPORT_ANALOG|REPORT_DIGITAL|SET_PIN_MODE|SYSEX_START|SYSTEM_RESET)\b/,builtin:/\b(?:Audio|BSSID|Bridge|Client|Console|EEPROM|Esplora|EsploraTFT|Ethernet|EthernetClient|EthernetServer|EthernetUDP|File|FileIO|FileSystem|Firmata|GPRS|GSM|GSMBand|GSMClient|GSMModem|GSMPIN|GSMScanner|GSMServer|GSMVoiceCall|GSM_SMS|HttpClient|IPAddress|IRread|Keyboard|KeyboardController|LiquidCrystal|LiquidCrystal_I2C|Mailbox|Mouse|MouseController|PImage|Process|RSSI|RobotControl|RobotMotor|SD|SPI|SSID|Scheduler|Serial|Server|Servo|SoftwareSerial|Stepper|Stream|TFT|Task|USBHost|WiFi|WiFiClient|WiFiServer|WiFiUDP|Wire|YunClient|YunServer|abs|addParameter|analogRead|analogReadResolution|analogReference|analogWrite|analogWriteResolution|answerCall|attach|attachGPRS|attachInterrupt|attached|autoscroll|available|background|beep|begin|beginPacket|beginSD|beginSMS|beginSpeaker|beginTFT|beginTransmission|beginWrite|bit|bitClear|bitRead|bitSet|bitWrite|blink|blinkVersion|buffer|changePIN|checkPIN|checkPUK|checkReg|circle|cityNameRead|cityNameWrite|clear|clearScreen|click|close|compassRead|config|connect|connected|constrain|cos|countryNameRead|countryNameWrite|createChar|cursor|debugPrint|delay|delayMicroseconds|detach|detachInterrupt|digitalRead|digitalWrite|disconnect|display|displayLogos|drawBMP|drawCompass|encryptionType|end|endPacket|endSMS|endTransmission|endWrite|exists|exitValue|fill|find|findUntil|flush|gatewayIP|get|getAsynchronously|getBand|getButton|getCurrentCarrier|getIMEI|getKey|getModifiers|getOemKey|getPINUsed|getResult|getSignalStrength|getSocket|getVoiceCallStatus|getXChange|getYChange|hangCall|height|highByte|home|image|interrupts|isActionDone|isDirectory|isListening|isPIN|isPressed|isValid|keyPressed|keyReleased|keyboardRead|knobRead|leftToRight|line|lineFollowConfig|listen|listenOnLocalhost|loadImage|localIP|lowByte|macAddress|maintain|map|max|messageAvailable|micros|millis|min|mkdir|motorsStop|motorsWrite|mouseDragged|mouseMoved|mousePressed|mouseReleased|move|noAutoscroll|noBlink|noBuffer|noCursor|noDisplay|noFill|noInterrupts|noListenOnLocalhost|noStroke|noTone|onReceive|onRequest|open|openNextFile|overflow|parseCommand|parseFloat|parseInt|parsePacket|pauseMode|peek|pinMode|playFile|playMelody|point|pointTo|position|pow|prepare|press|print|printFirmwareVersion|printVersion|println|process|processInput|pulseIn|put|random|randomSeed|read|readAccelerometer|readBlue|readButton|readBytes|readBytesUntil|readGreen|readJoystickButton|readJoystickSwitch|readJoystickX|readJoystickY|readLightSensor|readMessage|readMicrophone|readNetworks|readRed|readSlider|readString|readStringUntil|readTemperature|ready|rect|release|releaseAll|remoteIP|remoteNumber|remotePort|remove|requestFrom|retrieveCallingNumber|rewindDirectory|rightToLeft|rmdir|robotNameRead|robotNameWrite|run|runAsynchronously|runShellCommand|runShellCommandAsynchronously|running|scanNetworks|scrollDisplayLeft|scrollDisplayRight|seek|sendAnalog|sendDigitalPortPair|sendDigitalPorts|sendString|sendSysex|serialEvent|setBand|setBitOrder|setClockDivider|setCursor|setDNS|setDataMode|setFirmwareVersion|setMode|setPINUsed|setSpeed|setTextSize|setTimeout|shiftIn|shiftOut|shutdown|sin|size|sqrt|startLoop|step|stop|stroke|subnetMask|switchPIN|tan|tempoWrite|text|tone|transfer|tuneWrite|turn|updateIR|userNameRead|userNameWrite|voiceCall|waitContinue|width|write|writeBlue|writeGreen|writeJSON|writeMessage|writeMicroseconds|writeRGB|writeRed|yield)\b/}),t.languages.ino=t.languages.arduino}function xN(t){!function(t){var e="\\b(?:BASH|BASHOPTS|BASH_ALIASES|BASH_ARGC|BASH_ARGV|BASH_CMDS|BASH_COMPLETION_COMPAT_DIR|BASH_LINENO|BASH_REMATCH|BASH_SOURCE|BASH_VERSINFO|BASH_VERSION|COLORTERM|COLUMNS|COMP_WORDBREAKS|DBUS_SESSION_BUS_ADDRESS|DEFAULTS_PATH|DESKTOP_SESSION|DIRSTACK|DISPLAY|EUID|GDMSESSION|GDM_LANG|GNOME_KEYRING_CONTROL|GNOME_KEYRING_PID|GPG_AGENT_INFO|GROUPS|HISTCONTROL|HISTFILE|HISTFILESIZE|HISTSIZE|HOME|HOSTNAME|HOSTTYPE|IFS|INSTANCE|JOB|LANG|LANGUAGE|LC_ADDRESS|LC_ALL|LC_IDENTIFICATION|LC_MEASUREMENT|LC_MONETARY|LC_NAME|LC_NUMERIC|LC_PAPER|LC_TELEPHONE|LC_TIME|LESSCLOSE|LESSOPEN|LINES|LOGNAME|LS_COLORS|MACHTYPE|MAILCHECK|MANDATORY_PATH|NO_AT_BRIDGE|OLDPWD|OPTERR|OPTIND|ORBIT_SOCKETDIR|OSTYPE|PAPERSIZE|PATH|PIPESTATUS|PPID|PS1|PS2|PS3|PS4|PWD|RANDOM|REPLY|SECONDS|SELINUX_INIT|SESSION|SESSIONTYPE|SESSION_MANAGER|SHELL|SHELLOPTS|SHLVL|SSH_AUTH_SOCK|TERM|UID|UPSTART_EVENTS|UPSTART_INSTANCE|UPSTART_JOB|UPSTART_SESSION|USER|WINDOWID|XAUTHORITY|XDG_CONFIG_DIRS|XDG_CURRENT_DESKTOP|XDG_DATA_DIRS|XDG_GREETER_DATA_DIR|XDG_MENU_PREFIX|XDG_RUNTIME_DIR|XDG_SEAT|XDG_SEAT_PATH|XDG_SESSION_DESKTOP|XDG_SESSION_ID|XDG_SESSION_PATH|XDG_SESSION_TYPE|XDG_VTNR|XMODIFIERS)\\b",n={pattern:/(^(["']?)\w+\2)[ \t]+\S.*/,lookbehind:!0,alias:"punctuation",inside:null},r={bash:n,environment:{pattern:RegExp("\\$"+e),alias:"constant"},variable:[{pattern:/\$?\(\([\s\S]+?\)\)/,greedy:!0,inside:{variable:[{pattern:/(^\$\(\([\s\S]+)\)\)/,lookbehind:!0},/^\$\(\(/],number:/\b0x[\dA-Fa-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:[Ee]-?\d+)?/,operator:/--|\+\+|\*\*=?|<<=?|>>=?|&&|\|\||[=!+\-*/%<>^&|]=?|[?~:]/,punctuation:/\(\(?|\)\)?|,|;/}},{pattern:/\$\((?:\([^)]+\)|[^()])+\)|`[^`]+`/,greedy:!0,inside:{variable:/^\$\(|^`|\)$|`$/}},{pattern:/\$\{[^}]+\}/,greedy:!0,inside:{operator:/:[-=?+]?|[!\/]|##?|%%?|\^\^?|,,?/,punctuation:/[\[\]]/,environment:{pattern:RegExp("(\\{)"+e),lookbehind:!0,alias:"constant"}}},/\$(?:\w+|[#?*!@$])/],entity:/\\(?:[abceEfnrtv\\"]|O?[0-7]{1,3}|U[0-9a-fA-F]{8}|u[0-9a-fA-F]{4}|x[0-9a-fA-F]{1,2})/};t.languages.bash={shebang:{pattern:/^#!\s*\/.*/,alias:"important"},comment:{pattern:/(^|[^"{\\$])#.*/,lookbehind:!0},"function-name":[{pattern:/(\bfunction\s+)[\w-]+(?=(?:\s*\(?:\s*\))?\s*\{)/,lookbehind:!0,alias:"function"},{pattern:/\b[\w-]+(?=\s*\(\s*\)\s*\{)/,alias:"function"}],"for-or-select":{pattern:/(\b(?:for|select)\s+)\w+(?=\s+in\s)/,alias:"variable",lookbehind:!0},"assign-left":{pattern:/(^|[\s;|&]|[<>]\()\w+(?:\.\w+)*(?=\+?=)/,inside:{environment:{pattern:RegExp("(^|[\\s;|&]|[<>]\\()"+e),lookbehind:!0,alias:"constant"}},alias:"variable",lookbehind:!0},parameter:{pattern:/(^|\s)-{1,2}(?:\w+:[+-]?)?\w+(?:\.\w+)*(?=[=\s]|$)/,alias:"variable",lookbehind:!0},string:[{pattern:/((?:^|[^<])<<-?\s*)(\w+)\s[\s\S]*?(?:\r?\n|\r)\2/,lookbehind:!0,greedy:!0,inside:r},{pattern:/((?:^|[^<])<<-?\s*)(["'])(\w+)\2\s[\s\S]*?(?:\r?\n|\r)\3/,lookbehind:!0,greedy:!0,inside:{bash:n}},{pattern:/(^|[^\\](?:\\\\)*)"(?:\\[\s\S]|\$\([^)]+\)|\$(?!\()|`[^`]+`|[^"\\`$])*"/,lookbehind:!0,greedy:!0,inside:r},{pattern:/(^|[^$\\])'[^']*'/,lookbehind:!0,greedy:!0},{pattern:/\$'(?:[^'\\]|\\[\s\S])*'/,greedy:!0,inside:{entity:r.entity}}],environment:{pattern:RegExp("\\$?"+e),alias:"constant"},variable:r.variable,function:{pattern:/(^|[\s;|&]|[<>]\()(?:add|apropos|apt|apt-cache|apt-get|aptitude|aspell|automysqlbackup|awk|basename|bash|bc|bconsole|bg|bzip2|cal|cargo|cat|cfdisk|chgrp|chkconfig|chmod|chown|chroot|cksum|clear|cmp|column|comm|composer|cp|cron|crontab|csplit|curl|cut|date|dc|dd|ddrescue|debootstrap|df|diff|diff3|dig|dir|dircolors|dirname|dirs|dmesg|docker|docker-compose|du|egrep|eject|env|ethtool|expand|expect|expr|fdformat|fdisk|fg|fgrep|file|find|fmt|fold|format|free|fsck|ftp|fuser|gawk|git|gparted|grep|groupadd|groupdel|groupmod|groups|grub-mkconfig|gzip|halt|head|hg|history|host|hostname|htop|iconv|id|ifconfig|ifdown|ifup|import|install|ip|java|jobs|join|kill|killall|less|link|ln|locate|logname|logrotate|look|lpc|lpr|lprint|lprintd|lprintq|lprm|ls|lsof|lynx|make|man|mc|mdadm|mkconfig|mkdir|mke2fs|mkfifo|mkfs|mkisofs|mknod|mkswap|mmv|more|most|mount|mtools|mtr|mutt|mv|nano|nc|netstat|nice|nl|node|nohup|notify-send|npm|nslookup|op|open|parted|passwd|paste|pathchk|ping|pkill|pnpm|podman|podman-compose|popd|pr|printcap|printenv|ps|pushd|pv|quota|quotacheck|quotactl|ram|rar|rcp|reboot|remsync|rename|renice|rev|rm|rmdir|rpm|rsync|scp|screen|sdiff|sed|sendmail|seq|service|sftp|sh|shellcheck|shuf|shutdown|sleep|slocate|sort|split|ssh|stat|strace|su|sudo|sum|suspend|swapon|sync|sysctl|tac|tail|tar|tee|time|timeout|top|touch|tr|traceroute|tsort|tty|umount|uname|unexpand|uniq|units|unrar|unshar|unzip|update-grub|uptime|useradd|userdel|usermod|users|uudecode|uuencode|v|vcpkg|vdir|vi|vim|virsh|vmstat|wait|watch|wc|wget|whereis|which|who|whoami|write|xargs|xdg-open|yarn|yes|zenity|zip|zsh|zypper)(?=$|[)\s;|&])/,lookbehind:!0},keyword:{pattern:/(^|[\s;|&]|[<>]\()(?:case|do|done|elif|else|esac|fi|for|function|if|in|select|then|until|while)(?=$|[)\s;|&])/,lookbehind:!0},builtin:{pattern:/(^|[\s;|&]|[<>]\()(?:\.|:|alias|bind|break|builtin|caller|cd|command|continue|declare|echo|enable|eval|exec|exit|export|getopts|hash|help|let|local|logout|mapfile|printf|pwd|read|readarray|readonly|return|set|shift|shopt|source|test|times|trap|type|typeset|ulimit|umask|unalias|unset)(?=$|[)\s;|&])/,lookbehind:!0,alias:"class-name"},boolean:{pattern:/(^|[\s;|&]|[<>]\()(?:false|true)(?=$|[)\s;|&])/,lookbehind:!0},"file-descriptor":{pattern:/\B&\d\b/,alias:"important"},operator:{pattern:/\d?<>|>\||\+=|=[=~]?|!=?|<<[<-]?|[&\d]?>>|\d[<>]&?|[<>][&=]?|&[>&]?|\|[&|]?/,inside:{"file-descriptor":{pattern:/^\d/,alias:"important"}}},punctuation:/\$?\(\(?|\)\)?|\.\.|[{}[\];\\]/,number:{pattern:/(^|\s)(?:[1-9]\d*|0)(?:[.,]\d+)?\b/,lookbehind:!0}},n.inside=t.languages.bash;for(var i=["comment","function-name","for-or-select","assign-left","parameter","string","environment","function","keyword","builtin","boolean","file-descriptor","operator","punctuation","number"],s=r.variable[1].inside,o=0;o<i.length;o++)s[i[o]]=t.languages.bash[i[o]];t.languages.sh=t.languages.bash,t.languages.shell=t.languages.bash}(t)}function wN(t){t.register(gN),function(t){function e(t,e){return t.replace(/<<(\d+)>>/g,(function(t,n){return"(?:"+e[+n]+")"}))}function n(t,n,r){return RegExp(e(t,n),r||"")}function r(t,e){for(var n=0;n<e;n++)t=t.replace(/<<self>>/g,(function(){return"(?:"+t+")"}));return t.replace(/<<self>>/g,"[^\\s\\S]")}var i="bool byte char decimal double dynamic float int long object sbyte short string uint ulong ushort var void",s="class enum interface record struct",o="add alias and ascending async await by descending from(?=\\s*(?:\\w|$)) get global group into init(?=\\s*;) join let nameof not notnull on or orderby partial remove select set unmanaged value when where with(?=\\s*{)",a="abstract as base break case catch checked const continue default delegate do else event explicit extern finally fixed for foreach goto if implicit in internal is lock namespace new null operator out override params private protected public readonly ref return sealed sizeof stackalloc static switch this throw try typeof unchecked unsafe using virtual volatile while yield";function l(t){return"\\b(?:"+t.trim().replace(/ /g,"|")+")\\b"}var c=l(s),h=RegExp(l(i+" "+s+" "+o+" "+a)),u=l(s+" "+o+" "+a),d=l(i+" "+s+" "+a),f=r(/<(?:[^<>;=+\-*/%&|^]|<<self>>)*>/.source,2),p=r(/\((?:[^()]|<<self>>)*\)/.source,2),m=/@?\b[A-Za-z_]\w*\b/.source,g=e(/<<0>>(?:\s*<<1>>)?/.source,[m,f]),v=e(/(?!<<0>>)<<1>>(?:\s*\.\s*<<1>>)*/.source,[u,g]),y=/\[\s*(?:,\s*)*\]/.source,b=e(/<<0>>(?:\s*(?:\?\s*)?<<1>>)*(?:\s*\?)?/.source,[v,y]),x=e(/[^,()<>[\];=+\-*/%&|^]|<<0>>|<<1>>|<<2>>/.source,[f,p,y]),w=e(/\(<<0>>+(?:,<<0>>+)+\)/.source,[x]),E=e(/(?:<<0>>|<<1>>)(?:\s*(?:\?\s*)?<<2>>)*(?:\s*\?)?/.source,[w,v,y]),_={keyword:h,punctuation:/[<>()?,.:[\]]/},S=/'(?:[^\r\n'\\]|\\.|\\[Uux][\da-fA-F]{1,8})'/.source,T=/"(?:\\.|[^\\"\r\n])*"/.source,k=/@"(?:""|\\[\s\S]|[^\\"])*"(?!")/.source;t.languages.csharp=t.languages.extend("clike",{string:[{pattern:n(/(^|[^$\\])<<0>>/.source,[k]),lookbehind:!0,greedy:!0},{pattern:n(/(^|[^@$\\])<<0>>/.source,[T]),lookbehind:!0,greedy:!0}],"class-name":[{pattern:n(/(\busing\s+static\s+)<<0>>(?=\s*;)/.source,[v]),lookbehind:!0,inside:_},{pattern:n(/(\busing\s+<<0>>\s*=\s*)<<1>>(?=\s*;)/.source,[m,E]),lookbehind:!0,inside:_},{pattern:n(/(\busing\s+)<<0>>(?=\s*=)/.source,[m]),lookbehind:!0},{pattern:n(/(\b<<0>>\s+)<<1>>/.source,[c,g]),lookbehind:!0,inside:_},{pattern:n(/(\bcatch\s*\(\s*)<<0>>/.source,[v]),lookbehind:!0,inside:_},{pattern:n(/(\bwhere\s+)<<0>>/.source,[m]),lookbehind:!0},{pattern:n(/(\b(?:is(?:\s+not)?|as)\s+)<<0>>/.source,[b]),lookbehind:!0,inside:_},{pattern:n(/\b<<0>>(?=\s+(?!<<1>>|with\s*\{)<<2>>(?:\s*[=,;:{)\]]|\s+(?:in|when)\b))/.source,[E,d,m]),inside:_}],keyword:h,number:/(?:\b0(?:x[\da-f_]*[\da-f]|b[01_]*[01])|(?:\B\.\d+(?:_+\d+)*|\b\d+(?:_+\d+)*(?:\.\d+(?:_+\d+)*)?)(?:e[-+]?\d+(?:_+\d+)*)?)(?:[dflmu]|lu|ul)?\b/i,operator:/>>=?|<<=?|[-=]>|([-+&|])\1|~|\?\?=?|[-+*/%&|^!=<>]=?/,punctuation:/\?\.?|::|[{}[\];(),.:]/}),t.languages.insertBefore("csharp","number",{range:{pattern:/\.\./,alias:"operator"}}),t.languages.insertBefore("csharp","punctuation",{"named-parameter":{pattern:n(/([(,]\s*)<<0>>(?=\s*:)/.source,[m]),lookbehind:!0,alias:"punctuation"}}),t.languages.insertBefore("csharp","class-name",{namespace:{pattern:n(/(\b(?:namespace|using)\s+)<<0>>(?:\s*\.\s*<<0>>)*(?=\s*[;{])/.source,[m]),lookbehind:!0,inside:{punctuation:/\./}},"type-expression":{pattern:n(/(\b(?:default|sizeof|typeof)\s*\(\s*(?!\s))(?:[^()\s]|\s(?!\s)|<<0>>)*(?=\s*\))/.source,[p]),lookbehind:!0,alias:"class-name",inside:_},"return-type":{pattern:n(/<<0>>(?=\s+(?:<<1>>\s*(?:=>|[({]|\.\s*this\s*\[)|this\s*\[))/.source,[E,v]),inside:_,alias:"class-name"},"constructor-invocation":{pattern:n(/(\bnew\s+)<<0>>(?=\s*[[({])/.source,[E]),lookbehind:!0,inside:_,alias:"class-name"},"generic-method":{pattern:n(/<<0>>\s*<<1>>(?=\s*\()/.source,[m,f]),inside:{function:n(/^<<0>>/.source,[m]),generic:{pattern:RegExp(f),alias:"class-name",inside:_}}},"type-list":{pattern:n(/\b((?:<<0>>\s+<<1>>|record\s+<<1>>\s*<<5>>|where\s+<<2>>)\s*:\s*)(?:<<3>>|<<4>>|<<1>>\s*<<5>>|<<6>>)(?:\s*,\s*(?:<<3>>|<<4>>|<<6>>))*(?=\s*(?:where|[{;]|=>|$))/.source,[c,g,m,E,h.source,p,/\bnew\s*\(\s*\)/.source]),lookbehind:!0,inside:{"record-arguments":{pattern:n(/(^(?!new\s*\()<<0>>\s*)<<1>>/.source,[g,p]),lookbehind:!0,greedy:!0,inside:t.languages.csharp},keyword:h,"class-name":{pattern:RegExp(E),greedy:!0,inside:_},punctuation:/[,()]/}},preprocessor:{pattern:/(^[\t ]*)#.*/m,lookbehind:!0,alias:"property",inside:{directive:{pattern:/(#)\b(?:define|elif|else|endif|endregion|error|if|line|nullable|pragma|region|undef|warning)\b/,lookbehind:!0,alias:"keyword"}}}});var A=T+"|"+S,C=e(/\/(?![*/])|\/\/[^\r\n]*[\r\n]|\/\*(?:[^*]|\*(?!\/))*\*\/|<<0>>/.source,[A]),R=r(e(/[^"'/()]|<<0>>|\(<<self>>*\)/.source,[C]),2),M=/\b(?:assembly|event|field|method|module|param|property|return|type)\b/.source,I=e(/<<0>>(?:\s*\(<<1>>*\))?/.source,[v,R]);t.languages.insertBefore("csharp","class-name",{attribute:{pattern:n(/((?:^|[^\s\w>)?])\s*\[\s*)(?:<<0>>\s*:\s*)?<<1>>(?:\s*,\s*<<1>>)*(?=\s*\])/.source,[M,I]),lookbehind:!0,greedy:!0,inside:{target:{pattern:n(/^<<0>>(?=\s*:)/.source,[M]),alias:"keyword"},"attribute-arguments":{pattern:n(/\(<<0>>*\)/.source,[R]),inside:t.languages.csharp},"class-name":{pattern:RegExp(v),inside:{punctuation:/\./}},punctuation:/[:,]/}}});var D=/:[^}\r\n]+/.source,O=r(e(/[^"'/()]|<<0>>|\(<<self>>*\)/.source,[C]),2),P=e(/\{(?!\{)(?:(?![}:])<<0>>)*<<1>>?\}/.source,[O,D]),L=r(e(/[^"'/()]|\/(?!\*)|\/\*(?:[^*]|\*(?!\/))*\*\/|<<0>>|\(<<self>>*\)/.source,[A]),2),F=e(/\{(?!\{)(?:(?![}:])<<0>>)*<<1>>?\}/.source,[L,D]);function N(e,r){return{interpolation:{pattern:n(/((?:^|[^{])(?:\{\{)*)<<0>>/.source,[e]),lookbehind:!0,inside:{"format-string":{pattern:n(/(^\{(?:(?![}:])<<0>>)*)<<1>>(?=\}$)/.source,[r,D]),lookbehind:!0,inside:{punctuation:/^:/}},punctuation:/^\{|\}$/,expression:{pattern:/[\s\S]+/,alias:"language-csharp",inside:t.languages.csharp}}},string:/[\s\S]+/}}t.languages.insertBefore("csharp","string",{"interpolation-string":[{pattern:n(/(^|[^\\])(?:\$@|@\$)"(?:""|\\[\s\S]|\{\{|<<0>>|[^\\{"])*"/.source,[P]),lookbehind:!0,greedy:!0,inside:N(P,O)},{pattern:n(/(^|[^@\\])\$"(?:\\.|\{\{|<<0>>|[^\\"{])*"/.source,[F]),lookbehind:!0,greedy:!0,inside:N(F,L)}],char:{pattern:RegExp(S),greedy:!0}}),t.languages.dotnet=t.languages.cs=t.languages.csharp}(t)}function EN(t){t.languages.markup={comment:{pattern:/<!--(?:(?!<!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|<!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},t.languages.markup.tag.inside["attr-value"].inside.entity=t.languages.markup.entity,t.languages.markup.doctype.inside["internal-subset"].inside=t.languages.markup,t.hooks.add("wrap",(function(t){"entity"===t.type&&(t.attributes.title=t.content.value.replace(/&amp;/,"&"))})),Object.defineProperty(t.languages.markup.tag,"addInlined",{value:function(e,n){var r={};r["language-"+n]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:t.languages[n]},r.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:r}};i["language-"+n]={pattern:/[\s\S]+/,inside:t.languages[n]};var s={};s[e]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,(function(){return e})),"i"),lookbehind:!0,greedy:!0,inside:i},t.languages.insertBefore("markup","cdata",s)}}),Object.defineProperty(t.languages.markup.tag,"addAttribute",{value:function(e,n){t.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+e+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[n,"language-"+n],inside:t.languages[n]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),t.languages.html=t.languages.markup,t.languages.mathml=t.languages.markup,t.languages.svg=t.languages.markup,t.languages.xml=t.languages.extend("markup",{}),t.languages.ssml=t.languages.xml,t.languages.atom=t.languages.xml,t.languages.rss=t.languages.xml}function _N(t){!function(t){var e=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;t.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+e.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+e.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+e.source+"$"),alias:"url"}}},selector:{pattern:RegExp("(^|[{}\\s])[^{}\\s](?:[^{};\"'\\s]|\\s+(?![\\s{])|"+e.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:e,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},t.languages.css.atrule.inside.rest=t.languages.css;var n=t.languages.markup;n&&(n.tag.addInlined("style","css"),n.tag.addAttribute("style","css"))}(t)}function SN(t){!function(t){t.languages.diff={coord:[/^(?:\*{3}|-{3}|\+{3}).*$/m,/^@@.*@@$/m,/^\d.*$/m]};var e={"deleted-sign":"-","deleted-arrow":"<","inserted-sign":"+","inserted-arrow":">",unchanged:" ",diff:"!"};Object.keys(e).forEach((function(n){var r=e[n],i=[];/^\w+$/.test(n)||i.push(/\w+/.exec(n)[0]),"diff"===n&&i.push("bold"),t.languages.diff[n]={pattern:RegExp("^(?:["+r+"].*(?:\r\n?|\n|(?![\\s\\S])))+","m"),alias:i,inside:{line:{pattern:/(.)(?=[\s\S]).*(?:\r\n?|\n)?/,lookbehind:!0},prefix:{pattern:/[\s\S]/,alias:/\w+/.exec(n)[0]}}}})),Object.defineProperty(t.languages.diff,"PREFIXES",{value:e})}(t)}function TN(t){t.register(gN),t.languages.go=t.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"|`[^`]*`/,lookbehind:!0,greedy:!0},keyword:/\b(?:break|case|chan|const|continue|default|defer|else|fallthrough|for|func|go(?:to)?|if|import|interface|map|package|range|return|select|struct|switch|type|var)\b/,boolean:/\b(?:_|false|iota|nil|true)\b/,number:[/\b0(?:b[01_]+|o[0-7_]+)i?\b/i,/\b0x(?:[a-f\d_]+(?:\.[a-f\d_]*)?|\.[a-f\d_]+)(?:p[+-]?\d+(?:_\d+)*)?i?(?!\w)/i,/(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?[\d_]+)?i?(?!\w)/i],operator:/[*\/%^!=]=?|\+[=+]?|-[=-]?|\|[=|]?|&(?:=|&|\^=?)?|>(?:>=?|=)?|<(?:<=?|=|-)?|:=|\.\.\./,builtin:/\b(?:append|bool|byte|cap|close|complex|complex(?:64|128)|copy|delete|error|float(?:32|64)|u?int(?:8|16|32|64)?|imag|len|make|new|panic|print(?:ln)?|real|recover|rune|string|uintptr)\b/}),t.languages.insertBefore("go","string",{char:{pattern:/'(?:\\.|[^'\\\r\n]){0,10}'/,greedy:!0}}),delete t.languages.go["class-name"]}function kN(t){t.languages.ini={comment:{pattern:/(^[ \f\t\v]*)[#;][^\n\r]*/m,lookbehind:!0},section:{pattern:/(^[ \f\t\v]*)\[[^\n\r\]]*\]?/m,lookbehind:!0,inside:{"section-name":{pattern:/(^\[[ \f\t\v]*)[^ \f\t\v\]]+(?:[ \f\t\v]+[^ \f\t\v\]]+)*/,lookbehind:!0,alias:"selector"},punctuation:/\[|\]/}},key:{pattern:/(^[ \f\t\v]*)[^ \f\n\r\t\v=]+(?:[ \f\t\v]+[^ \f\n\r\t\v=]+)*(?=[ \f\t\v]*=)/m,lookbehind:!0,alias:"attr-name"},value:{pattern:/(=[ \f\t\v]*)[^ \f\n\r\t\v]+(?:[ \f\t\v]+[^ \f\n\r\t\v]+)*/,lookbehind:!0,alias:"attr-value",inside:{"inner-value":{pattern:/^("|').+(?=\1$)/,lookbehind:!0}}},punctuation:/=/}}function AN(t){var e,n,r,i;t.register(gN),e=t,n=/\b(?:abstract|assert|boolean|break|byte|case|catch|char|class|const|continue|default|do|double|else|enum|exports|extends|final|finally|float|for|goto|if|implements|import|instanceof|int|interface|long|module|native|new|non-sealed|null|open|opens|package|permits|private|protected|provides|public|record(?!\s*[(){}[\]<>=%~.:,;?+\-*/&|^])|requires|return|sealed|short|static|strictfp|super|switch|synchronized|this|throw|throws|to|transient|transitive|try|uses|var|void|volatile|while|with|yield)\b/,r=/(?:[a-z]\w*\s*\.\s*)*(?:[A-Z]\w*\s*\.\s*)*/.source,i={pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z](?:[\d_A-Z]*[a-z]\w*)?\b/.source),lookbehind:!0,inside:{namespace:{pattern:/^[a-z]\w*(?:\s*\.\s*[a-z]\w*)*(?:\s*\.)?/,inside:{punctuation:/\./}},punctuation:/\./}},e.languages.java=e.languages.extend("clike",{string:{pattern:/(^|[^\\])"(?:\\.|[^"\\\r\n])*"/,lookbehind:!0,greedy:!0},"class-name":[i,{pattern:RegExp(/(^|[^\w.])/.source+r+/[A-Z]\w*(?=\s+\w+\s*[;,=()]|\s*(?:\[[\s,]*\]\s*)?::\s*new\b)/.source),lookbehind:!0,inside:i.inside},{pattern:RegExp(/(\b(?:class|enum|extends|implements|instanceof|interface|new|record|throws)\s+)/.source+r+/[A-Z]\w*\b/.source),lookbehind:!0,inside:i.inside}],keyword:n,function:[e.languages.clike.function,{pattern:/(::\s*)[a-z_]\w*/,lookbehind:!0}],number:/\b0b[01][01_]*L?\b|\b0x(?:\.[\da-f_p+-]+|[\da-f_]+(?:\.[\da-f_p+-]+)?)\b|(?:\b\d[\d_]*(?:\.[\d_]*)?|\B\.\d[\d_]*)(?:e[+-]?\d[\d_]*)?[dfl]?/i,operator:{pattern:/(^|[^.])(?:<<=?|>>>?=?|->|--|\+\+|&&|\|\||::|[?:~]|[-+*/%&|^!=<>]=?)/m,lookbehind:!0},constant:/\b[A-Z][A-Z_\d]+\b/}),e.languages.insertBefore("java","string",{"triple-quoted-string":{pattern:/"""[ \t]*[\r\n](?:(?:"|"")?(?:\\.|[^"\\]))*"""/,greedy:!0,alias:"string"},char:{pattern:/'(?:\\.|[^'\\\r\n]){1,6}'/,greedy:!0}}),e.languages.insertBefore("java","class-name",{annotation:{pattern:/(^|[^.])@\w+(?:\s*\.\s*\w+)*/,lookbehind:!0,alias:"punctuation"},generics:{pattern:/<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&)|<(?:[\w\s,.?]|&(?!&))*>)*>)*>)*>/,inside:{"class-name":i,keyword:n,punctuation:/[<>(),.:]/,operator:/[?&|]/}},import:[{pattern:RegExp(/(\bimport\s+)/.source+r+/(?:[A-Z]\w*|\*)(?=\s*;)/.source),lookbehind:!0,inside:{namespace:i.inside.namespace,punctuation:/\./,operator:/\*/,"class-name":/\w+/}},{pattern:RegExp(/(\bimport\s+static\s+)/.source+r+/(?:\w+|\*)(?=\s*;)/.source),lookbehind:!0,alias:"static",inside:{namespace:i.inside.namespace,static:/\b\w+$/,punctuation:/\./,operator:/\*/,"class-name":/\w+/}}],namespace:{pattern:RegExp(/(\b(?:exports|import(?:\s+static)?|module|open|opens|package|provides|requires|to|transitive|uses|with)\s+)(?!<keyword>)[a-z]\w*(?:\.[a-z]\w*)*\.?/.source.replace(/<keyword>/g,(function(){return n.source}))),lookbehind:!0,inside:{punctuation:/\./}}})}function CN(t){var e,n,r,i,s,o;e=t,n={pattern:/\\[\\(){}[\]^$+*?|.]/,alias:"escape"},i="(?:[^\\\\-]|"+(r=/\\(?:x[\da-fA-F]{2}|u[\da-fA-F]{4}|u\{[\da-fA-F]+\}|0[0-7]{0,2}|[123][0-7]{2}|c[a-zA-Z]|.)/).source+")",s=RegExp(i+"-"+i),o={pattern:/(<|')[^<>']+(?=[>']$)/,lookbehind:!0,alias:"variable"},e.languages.regex={"char-class":{pattern:/((?:^|[^\\])(?:\\\\)*)\[(?:[^\\\]]|\\[\s\S])*\]/,lookbehind:!0,inside:{"char-class-negation":{pattern:/(^\[)\^/,lookbehind:!0,alias:"operator"},"char-class-punctuation":{pattern:/^\[|\]$/,alias:"punctuation"},range:{pattern:s,inside:{escape:r,"range-punctuation":{pattern:/-/,alias:"operator"}}},"special-escape":n,"char-set":{pattern:/\\[wsd]|\\p\{[^{}]+\}/i,alias:"class-name"},escape:r}},"special-escape":n,"char-set":{pattern:/\.|\\[wsd]|\\p\{[^{}]+\}/i,alias:"class-name"},backreference:[{pattern:/\\(?![123][0-7]{2})[1-9]/,alias:"keyword"},{pattern:/\\k<[^<>']+>/,alias:"keyword",inside:{"group-name":o}}],anchor:{pattern:/[$^]|\\[ABbGZz]/,alias:"function"},escape:r,group:[{pattern:/\((?:\?(?:<[^<>']+>|'[^<>']+'|[>:]|<?[=!]|[idmnsuxU]+(?:-[idmnsuxU]+)?:?))?/,alias:"punctuation",inside:{"group-name":o}},{pattern:/\)/,alias:"punctuation"}],quantifier:{pattern:/(?:[+*?]|\{\d+(?:,\d*)?\})[?+]?/,alias:"number"},alternation:{pattern:/\|/,alias:"keyword"}}}function RN(t){t.register(gN),t.languages.javascript=t.languages.extend("clike",{"class-name":[t.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),t.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,t.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:t.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:t.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:t.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:t.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:t.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),t.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:t.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),t.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),t.languages.markup&&(t.languages.markup.tag.addInlined("script","javascript"),t.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),t.languages.js=t.languages.javascript}function MN(t){t.languages.json={property:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?=\s*:)/,lookbehind:!0,greedy:!0},string:{pattern:/(^|[^\\])"(?:\\.|[^\\"\r\n])*"(?!\s*:)/,lookbehind:!0,greedy:!0},comment:{pattern:/\/\/.*|\/\*[\s\S]*?(?:\*\/|$)/,greedy:!0},number:/-?\b\d+(?:\.\d+)?(?:e[+-]?\d+)?\b/i,punctuation:/[{}[\],]/,operator:/:/,boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"}},t.languages.webmanifest=t.languages.json}function IN(t){t.register(gN),function(t){t.languages.kotlin=t.languages.extend("clike",{keyword:{pattern:/(^|[^.])\b(?:abstract|actual|annotation|as|break|by|catch|class|companion|const|constructor|continue|crossinline|data|do|dynamic|else|enum|expect|external|final|finally|for|fun|get|if|import|in|infix|init|inline|inner|interface|internal|is|lateinit|noinline|null|object|open|operator|out|override|package|private|protected|public|reified|return|sealed|set|super|suspend|tailrec|this|throw|to|try|typealias|val|var|vararg|when|where|while)\b/,lookbehind:!0},function:[{pattern:/(?:`[^\r\n`]+`|\b\w+)(?=\s*\()/,greedy:!0},{pattern:/(\.)(?:`[^\r\n`]+`|\w+)(?=\s*\{)/,lookbehind:!0,greedy:!0}],number:/\b(?:0[xX][\da-fA-F]+(?:_[\da-fA-F]+)*|0[bB][01]+(?:_[01]+)*|\d+(?:_\d+)*(?:\.\d+(?:_\d+)*)?(?:[eE][+-]?\d+(?:_\d+)*)?[fFL]?)\b/,operator:/\+[+=]?|-[-=>]?|==?=?|!(?:!|==?)?|[\/*%<>]=?|[?:]:?|\.\.|&&|\|\||\b(?:and|inv|or|shl|shr|ushr|xor)\b/}),delete t.languages.kotlin["class-name"];var e={"interpolation-punctuation":{pattern:/^\$\{?|\}$/,alias:"punctuation"},expression:{pattern:/[\s\S]+/,inside:t.languages.kotlin}};t.languages.insertBefore("kotlin","string",{"string-literal":[{pattern:/"""(?:[^$]|\$(?:(?!\{)|\{[^{}]*\}))*?"""/,alias:"multiline",inside:{interpolation:{pattern:/\$(?:[a-z_]\w*|\{[^{}]*\})/i,inside:e},string:/[\s\S]+/}},{pattern:/"(?:[^"\\\r\n$]|\\.|\$(?:(?!\{)|\{[^{}]*\}))*"/,alias:"singleline",inside:{interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$(?:[a-z_]\w*|\{[^{}]*\})/i,lookbehind:!0,inside:e},string:/[\s\S]+/}}],char:{pattern:/'(?:[^'\\\r\n]|\\(?:.|u[a-fA-F0-9]{0,4}))'/,greedy:!0}}),delete t.languages.kotlin.string,t.languages.insertBefore("kotlin","keyword",{annotation:{pattern:/\B@(?:\w+:)?(?:[A-Z]\w*|\[[^\]]+\])/,alias:"builtin"}}),t.languages.insertBefore("kotlin","function",{label:{pattern:/\b\w+@|@\w+\b/,alias:"symbol"}}),t.languages.kt=t.languages.kotlin,t.languages.kts=t.languages.kotlin}(t)}function DN(t){t.register(_N),t.languages.less=t.languages.extend("css",{comment:[/\/\*[\s\S]*?\*\//,{pattern:/(^|[^\\])\/\/.*/,lookbehind:!0}],atrule:{pattern:/@[\w-](?:\((?:[^(){}]|\([^(){}]*\))*\)|[^(){};\s]|\s+(?!\s))*?(?=\s*\{)/,inside:{punctuation:/[:()]/}},selector:{pattern:/(?:@\{[\w-]+\}|[^{};\s@])(?:@\{[\w-]+\}|\((?:[^(){}]|\([^(){}]*\))*\)|[^(){};@\s]|\s+(?!\s))*?(?=\s*\{)/,inside:{variable:/@+[\w-]+/}},property:/(?:@\{[\w-]+\}|[\w-])+(?:\+_?)?(?=\s*:)/,operator:/[+\-*\/]/}),t.languages.insertBefore("less","property",{variable:[{pattern:/@[\w-]+\s*:/,inside:{punctuation:/:/}},/@@?[\w-]+/],"mixin-usage":{pattern:/([{;]\s*)[.#](?!\d)[\w-].*?(?=[(;])/,lookbehind:!0,alias:"function"}})}function ON(t){t.languages.lua={comment:/^#!.+|--(?:\[(=*)\[[\s\S]*?\]\1\]|.*)/m,string:{pattern:/(["'])(?:(?!\1)[^\\\r\n]|\\z(?:\r\n|\s)|\\(?:\r\n|[^z]))*\1|\[(=*)\[[\s\S]*?\]\2\]/,greedy:!0},number:/\b0x[a-f\d]+(?:\.[a-f\d]*)?(?:p[+-]?\d+)?\b|\b\d+(?:\.\B|(?:\.\d*)?(?:e[+-]?\d+)?\b)|\B\.\d+(?:e[+-]?\d+)?\b/i,keyword:/\b(?:and|break|do|else|elseif|end|false|for|function|goto|if|in|local|nil|not|or|repeat|return|then|true|until|while)\b/,function:/(?!\d)\w+(?=\s*(?:[({]))/,operator:[/[-+*%^&|#]|\/\/?|<[<=]?|>[>=]?|[=~]=?/,{pattern:/(^|[^.])\.\.(?!\.)/,lookbehind:!0}],punctuation:/[\[\](){},;]|\.+|:+/}}function PN(t){t.languages.makefile={comment:{pattern:/(^|[^\\])#(?:\\(?:\r\n|[\s\S])|[^\\\r\n])*/,lookbehind:!0},string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"builtin-target":{pattern:/\.[A-Z][^:#=\s]+(?=\s*:(?!=))/,alias:"builtin"},target:{pattern:/^(?:[^:=\s]|[ \t]+(?![\s:]))+(?=\s*:(?!=))/m,alias:"symbol",inside:{variable:/\$+(?:(?!\$)[^(){}:#=\s]+|(?=[({]))/}},variable:/\$+(?:(?!\$)[^(){}:#=\s]+|\([@*%<^+?][DF]\)|(?=[({]))/,keyword:/-include\b|\b(?:define|else|endef|endif|export|ifn?def|ifn?eq|include|override|private|sinclude|undefine|unexport|vpath)\b/,function:{pattern:/(\()(?:abspath|addsuffix|and|basename|call|dir|error|eval|file|filter(?:-out)?|findstring|firstword|flavor|foreach|guile|if|info|join|lastword|load|notdir|or|origin|patsubst|realpath|shell|sort|strip|subst|suffix|value|warning|wildcard|word(?:list|s)?)(?=[ \t])/,lookbehind:!0},operator:/(?:::|[?:+!])?=|[|@]/,punctuation:/[:;(){}]/}}function LN(t){!function(t){var e=/[*&][^\s[\]{},]+/,n=/!(?:<[\w\-%#;/?:@&=+$,.!~*'()[\]]+>|(?:[a-zA-Z\d-]*!)?[\w\-%#;/?:@&=+$.~*'()]+)?/,r="(?:"+n.source+"(?:[ \t]+"+e.source+")?|"+e.source+"(?:[ \t]+"+n.source+")?)",i=/(?:[^\s\x00-\x08\x0e-\x1f!"#%&'*,\-:>?@[\]`{|}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]|[?:-]<PLAIN>)(?:[ \t]*(?:(?![#:])<PLAIN>|:<PLAIN>))*/.source.replace(/<PLAIN>/g,(function(){return/[^\s\x00-\x08\x0e-\x1f,[\]{}\x7f-\x84\x86-\x9f\ud800-\udfff\ufffe\uffff]/.source})),s=/"(?:[^"\\\r\n]|\\.)*"|'(?:[^'\\\r\n]|\\.)*'/.source;function o(t,e){e=(e||"").replace(/m/g,"")+"m";var n=/([:\-,[{]\s*(?:\s<<prop>>[ \t]+)?)(?:<<value>>)(?=[ \t]*(?:$|,|\]|\}|(?:[\r\n]\s*)?#))/.source.replace(/<<prop>>/g,(function(){return r})).replace(/<<value>>/g,(function(){return t}));return RegExp(n,e)}t.languages.yaml={scalar:{pattern:RegExp(/([\-:]\s*(?:\s<<prop>>[ \t]+)?[|>])[ \t]*(?:((?:\r?\n|\r)[ \t]+)\S[^\r\n]*(?:\2[^\r\n]+)*)/.source.replace(/<<prop>>/g,(function(){return r}))),lookbehind:!0,alias:"string"},comment:/#.*/,key:{pattern:RegExp(/((?:^|[:\-,[{\r\n?])[ \t]*(?:<<prop>>[ \t]+)?)<<key>>(?=\s*:\s)/.source.replace(/<<prop>>/g,(function(){return r})).replace(/<<key>>/g,(function(){return"(?:"+i+"|"+s+")"}))),lookbehind:!0,greedy:!0,alias:"atrule"},directive:{pattern:/(^[ \t]*)%.+/m,lookbehind:!0,alias:"important"},datetime:{pattern:o(/\d{4}-\d\d?-\d\d?(?:[tT]|[ \t]+)\d\d?:\d{2}:\d{2}(?:\.\d*)?(?:[ \t]*(?:Z|[-+]\d\d?(?::\d{2})?))?|\d{4}-\d{2}-\d{2}|\d\d?:\d{2}(?::\d{2}(?:\.\d*)?)?/.source),lookbehind:!0,alias:"number"},boolean:{pattern:o(/false|true/.source,"i"),lookbehind:!0,alias:"important"},null:{pattern:o(/null|~/.source,"i"),lookbehind:!0,alias:"important"},string:{pattern:o(s),lookbehind:!0,greedy:!0},number:{pattern:o(/[+-]?(?:0x[\da-f]+|0o[0-7]+|(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?|\.inf|\.nan)/.source,"i"),lookbehind:!0},tag:n,important:e,punctuation:/---|[:[\]{}\-,|>?]|\.\.\./},t.languages.yml=t.languages.yaml}(t)}function FN(t){t.register(EN),function(t){var e=/(?:\\.|[^\\\n\r]|(?:\n|\r\n?)(?![\r\n]))/.source;function n(t){return t=t.replace(/<inner>/g,(function(){return e})),RegExp(/((?:^|[^\\])(?:\\{2})*)/.source+"(?:"+t+")")}var r=/(?:\\.|``(?:[^`\r\n]|`(?!`))+``|`[^`\r\n]+`|[^\\|\r\n`])+/.source,i=/\|?__(?:\|__)+\|?(?:(?:\n|\r\n?)|(?![\s\S]))/.source.replace(/__/g,(function(){return r})),s=/\|?[ \t]*:?-{3,}:?[ \t]*(?:\|[ \t]*:?-{3,}:?[ \t]*)+\|?(?:\n|\r\n?)/.source;t.languages.markdown=t.languages.extend("markup",{}),t.languages.insertBefore("markdown","prolog",{"front-matter-block":{pattern:/(^(?:\s*[\r\n])?)---(?!.)[\s\S]*?[\r\n]---(?!.)/,lookbehind:!0,greedy:!0,inside:{punctuation:/^---|---$/,"front-matter":{pattern:/\S+(?:\s+\S+)*/,alias:["yaml","language-yaml"],inside:t.languages.yaml}}},blockquote:{pattern:/^>(?:[\t ]*>)*/m,alias:"punctuation"},table:{pattern:RegExp("^"+i+s+"(?:"+i+")*","m"),inside:{"table-data-rows":{pattern:RegExp("^("+i+s+")(?:"+i+")*$"),lookbehind:!0,inside:{"table-data":{pattern:RegExp(r),inside:t.languages.markdown},punctuation:/\|/}},"table-line":{pattern:RegExp("^("+i+")"+s+"$"),lookbehind:!0,inside:{punctuation:/\||:?-{3,}:?/}},"table-header-row":{pattern:RegExp("^"+i+"$"),inside:{"table-header":{pattern:RegExp(r),alias:"important",inside:t.languages.markdown},punctuation:/\|/}}}},code:[{pattern:/((?:^|\n)[ \t]*\n|(?:^|\r\n?)[ \t]*\r\n?)(?: {4}|\t).+(?:(?:\n|\r\n?)(?: {4}|\t).+)*/,lookbehind:!0,alias:"keyword"},{pattern:/^```[\s\S]*?^```$/m,greedy:!0,inside:{"code-block":{pattern:/^(```.*(?:\n|\r\n?))[\s\S]+?(?=(?:\n|\r\n?)^```$)/m,lookbehind:!0},"code-language":{pattern:/^(```).+/,lookbehind:!0},punctuation:/```/}}],title:[{pattern:/\S.*(?:\n|\r\n?)(?:==+|--+)(?=[ \t]*$)/m,alias:"important",inside:{punctuation:/==+$|--+$/}},{pattern:/(^\s*)#.+/m,lookbehind:!0,alias:"important",inside:{punctuation:/^#+|#+$/}}],hr:{pattern:/(^\s*)([*-])(?:[\t ]*\2){2,}(?=\s*$)/m,lookbehind:!0,alias:"punctuation"},list:{pattern:/(^\s*)(?:[*+-]|\d+\.)(?=[\t ].)/m,lookbehind:!0,alias:"punctuation"},"url-reference":{pattern:/!?\[[^\]]+\]:[\t ]+(?:\S+|<(?:\\.|[^>\\])+>)(?:[\t ]+(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\)))?/,inside:{variable:{pattern:/^(!?\[)[^\]]+/,lookbehind:!0},string:/(?:"(?:\\.|[^"\\])*"|'(?:\\.|[^'\\])*'|\((?:\\.|[^)\\])*\))$/,punctuation:/^[\[\]!:]|[<>]/},alias:"url"},bold:{pattern:n(/\b__(?:(?!_)<inner>|_(?:(?!_)<inner>)+_)+__\b|\*\*(?:(?!\*)<inner>|\*(?:(?!\*)<inner>)+\*)+\*\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^..)[\s\S]+(?=..$)/,lookbehind:!0,inside:{}},punctuation:/\*\*|__/}},italic:{pattern:n(/\b_(?:(?!_)<inner>|__(?:(?!_)<inner>)+__)+_\b|\*(?:(?!\*)<inner>|\*\*(?:(?!\*)<inner>)+\*\*)+\*/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^.)[\s\S]+(?=.$)/,lookbehind:!0,inside:{}},punctuation:/[*_]/}},strike:{pattern:n(/(~~?)(?:(?!~)<inner>)+\2/.source),lookbehind:!0,greedy:!0,inside:{content:{pattern:/(^~~?)[\s\S]+(?=\1$)/,lookbehind:!0,inside:{}},punctuation:/~~?/}},"code-snippet":{pattern:/(^|[^\\`])(?:``[^`\r\n]+(?:`[^`\r\n]+)*``(?!`)|`[^`\r\n]+`(?!`))/,lookbehind:!0,greedy:!0,alias:["code","keyword"]},url:{pattern:n(/!?\[(?:(?!\])<inner>)+\](?:\([^\s)]+(?:[\t ]+"(?:\\.|[^"\\])*")?\)|[ \t]?\[(?:(?!\])<inner>)+\])/.source),lookbehind:!0,greedy:!0,inside:{operator:/^!/,content:{pattern:/(^\[)[^\]]+(?=\])/,lookbehind:!0,inside:{}},variable:{pattern:/(^\][ \t]?\[)[^\]]+(?=\]$)/,lookbehind:!0},url:{pattern:/(^\]\()[^\s)]+/,lookbehind:!0},string:{pattern:/(^[ \t]+)"(?:\\.|[^"\\])*"(?=\)$)/,lookbehind:!0}}}}),["url","bold","italic","strike"].forEach((function(e){["url","bold","italic","strike","code-snippet"].forEach((function(n){e!==n&&(t.languages.markdown[e].inside.content.inside[n]=t.languages.markdown[n])}))})),t.hooks.add("after-tokenize",(function(t){"markdown"!==t.language&&"md"!==t.language||function t(e){if(e&&"string"!=typeof e)for(var n=0,r=e.length;n<r;n++){var i=e[n];if("code"===i.type){var s=i.content[1],o=i.content[3];if(s&&o&&"code-language"===s.type&&"code-block"===o.type&&"string"==typeof s.content){var a=s.content.replace(/\b#/g,"sharp").replace(/\b\+\+/g,"pp"),l="language-"+(a=(/[a-z][\w-]*/i.exec(a)||[""])[0].toLowerCase());o.alias?"string"==typeof o.alias?o.alias=[o.alias,l]:o.alias.push(l):o.alias=[l]}}else t(i.content)}}(t.tokens)})),t.hooks.add("wrap",(function(e){if("code-block"===e.type){for(var n="",r=0,i=e.classes.length;r<i;r++){var s=e.classes[r],o=/language-(.+)/.exec(s);if(o){n=o[1];break}}var a=t.languages[n];if(a)e.content=t.highlight(e.content.value,a,n);else if(n&&"none"!==n&&t.plugins.autoloader){var l="md-"+(new Date).valueOf()+"-"+Math.floor(1e16*Math.random());e.attributes.id=l,t.plugins.autoloader.loadLanguages(n,(function(){var e=document.getElementById(l);e&&(e.innerHTML=t.highlight(e.textContent,t.languages[n],n))}))}}})),RegExp(t.languages.markup.tag.pattern.source,"gi"),t.languages.md=t.languages.markdown}(t)}function NN(t){t.register(vN),t.languages.objectivec=t.languages.extend("c",{string:{pattern:/@?"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"/,greedy:!0},keyword:/\b(?:asm|auto|break|case|char|const|continue|default|do|double|else|enum|extern|float|for|goto|if|in|inline|int|long|register|return|self|short|signed|sizeof|static|struct|super|switch|typedef|typeof|union|unsigned|void|volatile|while)\b|(?:@interface|@end|@implementation|@protocol|@class|@public|@protected|@private|@property|@try|@catch|@finally|@throw|@synthesize|@dynamic|@selector)\b/,operator:/-[->]?|\+\+?|!=?|<<?=?|>>?=?|==?|&&?|\|\|?|[~^%?*\/@]/}),delete t.languages.objectivec["class-name"],t.languages.objc=t.languages.objectivec}function BN(t){var e;e=/(?:\((?:[^()\\]|\\[\s\S])*\)|\{(?:[^{}\\]|\\[\s\S])*\}|\[(?:[^[\]\\]|\\[\s\S])*\]|<(?:[^<>\\]|\\[\s\S])*>)/.source,t.languages.perl={comment:[{pattern:/(^\s*)=\w[\s\S]*?=cut.*/m,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\$])#.*/,lookbehind:!0,greedy:!0}],string:[{pattern:RegExp(/\b(?:q|qq|qw|qx)(?![a-zA-Z0-9])\s*/.source+"(?:"+[/([^a-zA-Z0-9\s{(\[<])(?:(?!\1)[^\\]|\\[\s\S])*\1/.source,/([a-zA-Z0-9])(?:(?!\2)[^\\]|\\[\s\S])*\2/.source,e].join("|")+")"),greedy:!0},{pattern:/("|`)(?:(?!\1)[^\\]|\\[\s\S])*\1/,greedy:!0},{pattern:/'(?:[^'\\\r\n]|\\.)*'/,greedy:!0}],regex:[{pattern:RegExp(/\b(?:m|qr)(?![a-zA-Z0-9])\s*/.source+"(?:"+[/([^a-zA-Z0-9\s{(\[<])(?:(?!\1)[^\\]|\\[\s\S])*\1/.source,/([a-zA-Z0-9])(?:(?!\2)[^\\]|\\[\s\S])*\2/.source,e].join("|")+")"+/[msixpodualngc]*/.source),greedy:!0},{pattern:RegExp(/(^|[^-])\b(?:s|tr|y)(?![a-zA-Z0-9])\s*/.source+"(?:"+[/([^a-zA-Z0-9\s{(\[<])(?:(?!\2)[^\\]|\\[\s\S])*\2(?:(?!\2)[^\\]|\\[\s\S])*\2/.source,/([a-zA-Z0-9])(?:(?!\3)[^\\]|\\[\s\S])*\3(?:(?!\3)[^\\]|\\[\s\S])*\3/.source,e+/\s*/.source+e].join("|")+")"+/[msixpodualngcer]*/.source),lookbehind:!0,greedy:!0},{pattern:/\/(?:[^\/\\\r\n]|\\.)*\/[msixpodualngc]*(?=\s*(?:$|[\r\n,.;})&|\-+*~<>!?^]|(?:and|cmp|eq|ge|gt|le|lt|ne|not|or|x|xor)\b))/,greedy:!0}],variable:[/[&*$@%]\{\^[A-Z]+\}/,/[&*$@%]\^[A-Z_]/,/[&*$@%]#?(?=\{)/,/[&*$@%]#?(?:(?:::)*'?(?!\d)[\w$]+(?![\w$]))+(?:::)*/,/[&*$@%]\d+/,/(?!%=)[$@%][!"#$%&'()*+,\-.\/:;<=>?@[\\\]^_`{|}~]/],filehandle:{pattern:/<(?![<=])\S*?>|\b_\b/,alias:"symbol"},"v-string":{pattern:/v\d+(?:\.\d+)*|\d+(?:\.\d+){2,}/,alias:"string"},function:{pattern:/(\bsub[ \t]+)\w+/,lookbehind:!0},keyword:/\b(?:any|break|continue|default|delete|die|do|else|elsif|eval|for|foreach|given|goto|if|last|local|my|next|our|package|print|redo|require|return|say|state|sub|switch|undef|unless|until|use|when|while)\b/,number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)\b/,operator:/-[rwxoRWXOezsfdlpSbctugkTBMAC]\b|\+[+=]?|-[-=>]?|\*\*?=?|\/\/?=?|=[=~>]?|~[~=]?|\|\|?=?|&&?=?|<(?:=>?|<=?)?|>>?=?|![~=]?|[%^]=?|\.(?:=|\.\.?)?|[\\?]|\bx(?:=|\b)|\b(?:and|cmp|eq|ge|gt|le|lt|ne|not|or|xor)\b/,punctuation:/[{}[\];(),:]/}}function UN(t){t.register(EN),function(t){function e(t,e){return"___"+t.toUpperCase()+e+"___"}Object.defineProperties(t.languages["markup-templating"]={},{buildPlaceholders:{value:function(n,r,i,s){if(n.language===r){var o=n.tokenStack=[];n.code=n.code.replace(i,(function(t){if("function"==typeof s&&!s(t))return t;for(var i,a=o.length;-1!==n.code.indexOf(i=e(r,a));)++a;return o[a]=t,i})),n.grammar=t.languages.markup}}},tokenizePlaceholders:{value:function(n,r){if(n.language===r&&n.tokenStack){n.grammar=t.languages[r];var i=0,s=Object.keys(n.tokenStack);!function o(a){for(var l=0;l<a.length&&!(i>=s.length);l++){var c=a[l];if("string"==typeof c||c.content&&"string"==typeof c.content){var h=s[i],u=n.tokenStack[h],d="string"==typeof c?c:c.content,f=e(r,h),p=d.indexOf(f);if(p>-1){++i;var m=d.substring(0,p),g=new t.Token(r,t.tokenize(u,n.grammar),"language-"+r,u),v=d.substring(p+f.length),y=[];m&&y.push.apply(y,o([m])),y.push(g),v&&y.push.apply(y,o([v])),"string"==typeof c?a.splice.apply(a,[l,1].concat(y)):c.content=y}}else c.content&&o(c.content)}return a}(n.tokens)}}}})}(t)}function VN(t){t.register(UN),function(t){var e=/\/\*[\s\S]*?\*\/|\/\/.*|#(?!\[).*/,n=[{pattern:/\b(?:false|true)\b/i,alias:"boolean"},{pattern:/(::\s*)\b[a-z_]\w*\b(?!\s*\()/i,greedy:!0,lookbehind:!0},{pattern:/(\b(?:case|const)\s+)\b[a-z_]\w*(?=\s*[;=])/i,greedy:!0,lookbehind:!0},/\b(?:null)\b/i,/\b[A-Z_][A-Z0-9_]*\b(?!\s*\()/],r=/\b0b[01]+(?:_[01]+)*\b|\b0o[0-7]+(?:_[0-7]+)*\b|\b0x[\da-f]+(?:_[\da-f]+)*\b|(?:\b\d+(?:_\d+)*\.?(?:\d+(?:_\d+)*)?|\B\.\d+)(?:e[+-]?\d+)?/i,i=/<?=>|\?\?=?|\.{3}|\??->|[!=]=?=?|::|\*\*=?|--|\+\+|&&|\|\||<<|>>|[?~]|[/^|%*&<>.+-]=?/,s=/[{}\[\](),:;]/;t.languages.php={delimiter:{pattern:/\?>$|^<\?(?:php(?=\s)|=)?/i,alias:"important"},comment:e,variable:/\$+(?:\w+\b|(?=\{))/,package:{pattern:/(namespace\s+|use\s+(?:function\s+)?)(?:\\?\b[a-z_]\w*)+\b(?!\\)/i,lookbehind:!0,inside:{punctuation:/\\/}},"class-name-definition":{pattern:/(\b(?:class|enum|interface|trait)\s+)\b[a-z_]\w*(?!\\)\b/i,lookbehind:!0,alias:"class-name"},"function-definition":{pattern:/(\bfunction\s+)[a-z_]\w*(?=\s*\()/i,lookbehind:!0,alias:"function"},keyword:[{pattern:/(\(\s*)\b(?:array|bool|boolean|float|int|integer|object|string)\b(?=\s*\))/i,alias:"type-casting",greedy:!0,lookbehind:!0},{pattern:/([(,?]\s*)\b(?:array(?!\s*\()|bool|callable|(?:false|null)(?=\s*\|)|float|int|iterable|mixed|object|self|static|string)\b(?=\s*\$)/i,alias:"type-hint",greedy:!0,lookbehind:!0},{pattern:/(\)\s*:\s*(?:\?\s*)?)\b(?:array(?!\s*\()|bool|callable|(?:false|null)(?=\s*\|)|float|int|iterable|mixed|never|object|self|static|string|void)\b/i,alias:"return-type",greedy:!0,lookbehind:!0},{pattern:/\b(?:array(?!\s*\()|bool|float|int|iterable|mixed|object|string|void)\b/i,alias:"type-declaration",greedy:!0},{pattern:/(\|\s*)(?:false|null)\b|\b(?:false|null)(?=\s*\|)/i,alias:"type-declaration",greedy:!0,lookbehind:!0},{pattern:/\b(?:parent|self|static)(?=\s*::)/i,alias:"static-context",greedy:!0},{pattern:/(\byield\s+)from\b/i,lookbehind:!0},/\bclass\b/i,{pattern:/((?:^|[^\s>:]|(?:^|[^-])>|(?:^|[^:]):)\s*)\b(?:abstract|and|array|as|break|callable|case|catch|clone|const|continue|declare|default|die|do|echo|else|elseif|empty|enddeclare|endfor|endforeach|endif|endswitch|endwhile|enum|eval|exit|extends|final|finally|fn|for|foreach|function|global|goto|if|implements|include|include_once|instanceof|insteadof|interface|isset|list|match|namespace|never|new|or|parent|print|private|protected|public|readonly|require|require_once|return|self|static|switch|throw|trait|try|unset|use|var|while|xor|yield|__halt_compiler)\b/i,lookbehind:!0}],"argument-name":{pattern:/([(,]\s*)\b[a-z_]\w*(?=\s*:(?!:))/i,lookbehind:!0},"class-name":[{pattern:/(\b(?:extends|implements|instanceof|new(?!\s+self|\s+static))\s+|\bcatch\s*\()\b[a-z_]\w*(?!\\)\b/i,greedy:!0,lookbehind:!0},{pattern:/(\|\s*)\b[a-z_]\w*(?!\\)\b/i,greedy:!0,lookbehind:!0},{pattern:/\b[a-z_]\w*(?!\\)\b(?=\s*\|)/i,greedy:!0},{pattern:/(\|\s*)(?:\\?\b[a-z_]\w*)+\b/i,alias:"class-name-fully-qualified",greedy:!0,lookbehind:!0,inside:{punctuation:/\\/}},{pattern:/(?:\\?\b[a-z_]\w*)+\b(?=\s*\|)/i,alias:"class-name-fully-qualified",greedy:!0,inside:{punctuation:/\\/}},{pattern:/(\b(?:extends|implements|instanceof|new(?!\s+self\b|\s+static\b))\s+|\bcatch\s*\()(?:\\?\b[a-z_]\w*)+\b(?!\\)/i,alias:"class-name-fully-qualified",greedy:!0,lookbehind:!0,inside:{punctuation:/\\/}},{pattern:/\b[a-z_]\w*(?=\s*\$)/i,alias:"type-declaration",greedy:!0},{pattern:/(?:\\?\b[a-z_]\w*)+(?=\s*\$)/i,alias:["class-name-fully-qualified","type-declaration"],greedy:!0,inside:{punctuation:/\\/}},{pattern:/\b[a-z_]\w*(?=\s*::)/i,alias:"static-context",greedy:!0},{pattern:/(?:\\?\b[a-z_]\w*)+(?=\s*::)/i,alias:["class-name-fully-qualified","static-context"],greedy:!0,inside:{punctuation:/\\/}},{pattern:/([(,?]\s*)[a-z_]\w*(?=\s*\$)/i,alias:"type-hint",greedy:!0,lookbehind:!0},{pattern:/([(,?]\s*)(?:\\?\b[a-z_]\w*)+(?=\s*\$)/i,alias:["class-name-fully-qualified","type-hint"],greedy:!0,lookbehind:!0,inside:{punctuation:/\\/}},{pattern:/(\)\s*:\s*(?:\?\s*)?)\b[a-z_]\w*(?!\\)\b/i,alias:"return-type",greedy:!0,lookbehind:!0},{pattern:/(\)\s*:\s*(?:\?\s*)?)(?:\\?\b[a-z_]\w*)+\b(?!\\)/i,alias:["class-name-fully-qualified","return-type"],greedy:!0,lookbehind:!0,inside:{punctuation:/\\/}}],constant:n,function:{pattern:/(^|[^\\\w])\\?[a-z_](?:[\w\\]*\w)?(?=\s*\()/i,lookbehind:!0,inside:{punctuation:/\\/}},property:{pattern:/(->\s*)\w+/,lookbehind:!0},number:r,operator:i,punctuation:s};var o={pattern:/\{\$(?:\{(?:\{[^{}]+\}|[^{}]+)\}|[^{}])+\}|(^|[^\\{])\$+(?:\w+(?:\[[^\r\n\[\]]+\]|->\w+)?)/,lookbehind:!0,inside:t.languages.php},a=[{pattern:/<<<'([^']+)'[\r\n](?:.*[\r\n])*?\1;/,alias:"nowdoc-string",greedy:!0,inside:{delimiter:{pattern:/^<<<'[^']+'|[a-z_]\w*;$/i,alias:"symbol",inside:{punctuation:/^<<<'?|[';]$/}}}},{pattern:/<<<(?:"([^"]+)"[\r\n](?:.*[\r\n])*?\1;|([a-z_]\w*)[\r\n](?:.*[\r\n])*?\2;)/i,alias:"heredoc-string",greedy:!0,inside:{delimiter:{pattern:/^<<<(?:"[^"]+"|[a-z_]\w*)|[a-z_]\w*;$/i,alias:"symbol",inside:{punctuation:/^<<<"?|[";]$/}},interpolation:o}},{pattern:/`(?:\\[\s\S]|[^\\`])*`/,alias:"backtick-quoted-string",greedy:!0},{pattern:/'(?:\\[\s\S]|[^\\'])*'/,alias:"single-quoted-string",greedy:!0},{pattern:/"(?:\\[\s\S]|[^\\"])*"/,alias:"double-quoted-string",greedy:!0,inside:{interpolation:o}}];t.languages.insertBefore("php","variable",{string:a,attribute:{pattern:/#\[(?:[^"'\/#]|\/(?![*/])|\/\/.*$|#(?!\[).*$|\/\*(?:[^*]|\*(?!\/))*\*\/|"(?:\\[\s\S]|[^\\"])*"|'(?:\\[\s\S]|[^\\'])*')+\](?=\s*[a-z$#])/im,greedy:!0,inside:{"attribute-content":{pattern:/^(#\[)[\s\S]+(?=\]$)/,lookbehind:!0,inside:{comment:e,string:a,"attribute-class-name":[{pattern:/([^:]|^)\b[a-z_]\w*(?!\\)\b/i,alias:"class-name",greedy:!0,lookbehind:!0},{pattern:/([^:]|^)(?:\\?\b[a-z_]\w*)+/i,alias:["class-name","class-name-fully-qualified"],greedy:!0,lookbehind:!0,inside:{punctuation:/\\/}}],constant:n,number:r,operator:i,punctuation:s}},delimiter:{pattern:/^#\[|\]$/,alias:"punctuation"}}}}),t.hooks.add("before-tokenize",(function(e){if(/<\?/.test(e.code)){t.languages["markup-templating"].buildPlaceholders(e,"php",/<\?(?:[^"'/#]|\/(?![*/])|("|')(?:\\[\s\S]|(?!\1)[^\\])*\1|(?:\/\/|#(?!\[))(?:[^?\n\r]|\?(?!>))*(?=$|\?>|[\r\n])|#\[|\/\*(?:[^*]|\*(?!\/))*(?:\*\/|$))*?(?:\?>|$)/g)}})),t.hooks.add("after-tokenize",(function(e){t.languages["markup-templating"].tokenizePlaceholders(e,"php")}))}(t)}function jN(t){t.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/},t.languages.python["string-interpolation"].inside.interpolation.inside.rest=t.languages.python,t.languages.py=t.languages.python}function zN(t){t.languages.r={comment:/#.*/,string:{pattern:/(['"])(?:\\.|(?!\1)[^\\\r\n])*\1/,greedy:!0},"percent-operator":{pattern:/%[^%\s]*%/,alias:"operator"},boolean:/\b(?:FALSE|TRUE)\b/,ellipsis:/\.\.(?:\.|\d+)/,number:[/\b(?:Inf|NaN)\b/,/(?:\b0x[\dA-Fa-f]+(?:\.\d*)?|\b\d+(?:\.\d*)?|\B\.\d+)(?:[EePp][+-]?\d+)?[iL]?/],keyword:/\b(?:NA|NA_character_|NA_complex_|NA_integer_|NA_real_|NULL|break|else|for|function|if|in|next|repeat|while)\b/,operator:/->?>?|<(?:=|<?-)?|[>=!]=?|::?|&&?|\|\|?|[+*\/^$@~]/,punctuation:/[(){}\[\],;]/}}function GN(t){t.register(gN),function(t){t.languages.ruby=t.languages.extend("clike",{comment:{pattern:/#.*|^=begin\s[\s\S]*?^=end/m,greedy:!0},"class-name":{pattern:/(\b(?:class|module)\s+|\bcatch\s+\()[\w.\\]+|\b[A-Z_]\w*(?=\s*\.\s*new\b)/,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:BEGIN|END|alias|and|begin|break|case|class|def|define_method|defined|do|each|else|elsif|end|ensure|extend|for|if|in|include|module|new|next|nil|not|or|prepend|private|protected|public|raise|redo|require|rescue|retry|return|self|super|then|throw|undef|unless|until|when|while|yield)\b/,operator:/\.{2,3}|&\.|===|<?=>|[!=]?~|(?:&&|\|\||<<|>>|\*\*|[+\-*/%<>!^&|=])=?|[?:]/,punctuation:/[(){}[\].,;]/}),t.languages.insertBefore("ruby","operator",{"double-colon":{pattern:/::/,alias:"punctuation"}});var e={pattern:/((?:^|[^\\])(?:\\{2})*)#\{(?:[^{}]|\{[^{}]*\})*\}/,lookbehind:!0,inside:{content:{pattern:/^(#\{)[\s\S]+(?=\}$)/,lookbehind:!0,inside:t.languages.ruby},delimiter:{pattern:/^#\{|\}$/,alias:"punctuation"}}};delete t.languages.ruby.function;var n="(?:"+[/([^a-zA-Z0-9\s{(\[<=])(?:(?!\1)[^\\]|\\[\s\S])*\1/.source,/\((?:[^()\\]|\\[\s\S]|\((?:[^()\\]|\\[\s\S])*\))*\)/.source,/\{(?:[^{}\\]|\\[\s\S]|\{(?:[^{}\\]|\\[\s\S])*\})*\}/.source,/\[(?:[^\[\]\\]|\\[\s\S]|\[(?:[^\[\]\\]|\\[\s\S])*\])*\]/.source,/<(?:[^<>\\]|\\[\s\S]|<(?:[^<>\\]|\\[\s\S])*>)*>/.source].join("|")+")",r=/(?:"(?:\\.|[^"\\\r\n])*"|(?:\b[a-zA-Z_]\w*|[^\s\0-\x7F]+)[?!]?|\$.)/.source;t.languages.insertBefore("ruby","keyword",{"regex-literal":[{pattern:RegExp(/%r/.source+n+/[egimnosux]{0,6}/.source),greedy:!0,inside:{interpolation:e,regex:/[\s\S]+/}},{pattern:/(^|[^/])\/(?!\/)(?:\[[^\r\n\]]+\]|\\.|[^[/\\\r\n])+\/[egimnosux]{0,6}(?=\s*(?:$|[\r\n,.;})#]))/,lookbehind:!0,greedy:!0,inside:{interpolation:e,regex:/[\s\S]+/}}],variable:/[@$]+[a-zA-Z_]\w*(?:[?!]|\b)/,symbol:[{pattern:RegExp(/(^|[^:]):/.source+r),lookbehind:!0,greedy:!0},{pattern:RegExp(/([\r\n{(,][ \t]*)/.source+r+/(?=:(?!:))/.source),lookbehind:!0,greedy:!0}],"method-definition":{pattern:/(\bdef\s+)\w+(?:\s*\.\s*\w+)?/,lookbehind:!0,inside:{function:/\b\w+$/,keyword:/^self\b/,"class-name":/^\w+/,punctuation:/\./}}}),t.languages.insertBefore("ruby","string",{"string-literal":[{pattern:RegExp(/%[qQiIwWs]?/.source+n),greedy:!0,inside:{interpolation:e,string:/[\s\S]+/}},{pattern:/("|')(?:#\{[^}]+\}|#(?!\{)|\\(?:\r\n|[\s\S])|(?!\1)[^\\#\r\n])*\1/,greedy:!0,inside:{interpolation:e,string:/[\s\S]+/}},{pattern:/<<[-~]?([a-z_]\w*)[\r\n](?:.*[\r\n])*?[\t ]*\1/i,alias:"heredoc-string",greedy:!0,inside:{delimiter:{pattern:/^<<[-~]?[a-z_]\w*|\b[a-z_]\w*$/i,inside:{symbol:/\b\w+/,punctuation:/^<<[-~]?/}},interpolation:e,string:/[\s\S]+/}},{pattern:/<<[-~]?'([a-z_]\w*)'[\r\n](?:.*[\r\n])*?[\t ]*\1/i,alias:"heredoc-string",greedy:!0,inside:{delimiter:{pattern:/^<<[-~]?'[a-z_]\w*'|\b[a-z_]\w*$/i,inside:{symbol:/\b\w+/,punctuation:/^<<[-~]?'|'$/}},string:/[\s\S]+/}}],"command-literal":[{pattern:RegExp(/%x/.source+n),greedy:!0,inside:{interpolation:e,command:{pattern:/[\s\S]+/,alias:"string"}}},{pattern:/`(?:#\{[^}]+\}|#(?!\{)|\\(?:\r\n|[\s\S])|[^\\`#\r\n])*`/,greedy:!0,inside:{interpolation:e,command:{pattern:/[\s\S]+/,alias:"string"}}}]}),delete t.languages.ruby.string,t.languages.insertBefore("ruby","number",{builtin:/\b(?:Array|Bignum|Binding|Class|Continuation|Dir|Exception|FalseClass|File|Fixnum|Float|Hash|IO|Integer|MatchData|Method|Module|NilClass|Numeric|Object|Proc|Range|Regexp|Stat|String|Struct|Symbol|TMS|Thread|ThreadGroup|Time|TrueClass)\b/,constant:/\b[A-Z][A-Z0-9_]*(?:[?!]|\b)/}),t.languages.rb=t.languages.ruby}(t)}function WN(t){!function(t){for(var e=/\/\*(?:[^*/]|\*(?!\/)|\/(?!\*)|<self>)*\*\//.source,n=0;n<2;n++)e=e.replace(/<self>/g,(function(){return e}));e=e.replace(/<self>/g,(function(){return/[^\s\S]/.source})),t.languages.rust={comment:[{pattern:RegExp(/(^|[^\\])/.source+e),lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/b?"(?:\\[\s\S]|[^\\"])*"|b?r(#*)"(?:[^"]|"(?!\1))*"\1/,greedy:!0},char:{pattern:/b?'(?:\\(?:x[0-7][\da-fA-F]|u\{(?:[\da-fA-F]_*){1,6}\}|.)|[^\\\r\n\t'])'/,greedy:!0},attribute:{pattern:/#!?\[(?:[^\[\]"]|"(?:\\[\s\S]|[^\\"])*")*\]/,greedy:!0,alias:"attr-name",inside:{string:null}},"closure-params":{pattern:/([=(,:]\s*|\bmove\s*)\|[^|]*\||\|[^|]*\|(?=\s*(?:\{|->))/,lookbehind:!0,greedy:!0,inside:{"closure-punctuation":{pattern:/^\||\|$/,alias:"punctuation"},rest:null}},"lifetime-annotation":{pattern:/'\w+/,alias:"symbol"},"fragment-specifier":{pattern:/(\$\w+:)[a-z]+/,lookbehind:!0,alias:"punctuation"},variable:/\$\w+/,"function-definition":{pattern:/(\bfn\s+)\w+/,lookbehind:!0,alias:"function"},"type-definition":{pattern:/(\b(?:enum|struct|trait|type|union)\s+)\w+/,lookbehind:!0,alias:"class-name"},"module-declaration":[{pattern:/(\b(?:crate|mod)\s+)[a-z][a-z_\d]*/,lookbehind:!0,alias:"namespace"},{pattern:/(\b(?:crate|self|super)\s*)::\s*[a-z][a-z_\d]*\b(?:\s*::(?:\s*[a-z][a-z_\d]*\s*::)*)?/,lookbehind:!0,alias:"namespace",inside:{punctuation:/::/}}],keyword:[/\b(?:Self|abstract|as|async|await|become|box|break|const|continue|crate|do|dyn|else|enum|extern|final|fn|for|if|impl|in|let|loop|macro|match|mod|move|mut|override|priv|pub|ref|return|self|static|struct|super|trait|try|type|typeof|union|unsafe|unsized|use|virtual|where|while|yield)\b/,/\b(?:bool|char|f(?:32|64)|[ui](?:8|16|32|64|128|size)|str)\b/],function:/\b[a-z_]\w*(?=\s*(?:::\s*<|\())/,macro:{pattern:/\b\w+!/,alias:"property"},constant:/\b[A-Z_][A-Z_\d]+\b/,"class-name":/\b[A-Z]\w*\b/,namespace:{pattern:/(?:\b[a-z][a-z_\d]*\s*::\s*)*\b[a-z][a-z_\d]*\s*::(?!\s*<)/,inside:{punctuation:/::/}},number:/\b(?:0x[\dA-Fa-f](?:_?[\dA-Fa-f])*|0o[0-7](?:_?[0-7])*|0b[01](?:_?[01])*|(?:(?:\d(?:_?\d)*)?\.)?\d(?:_?\d)*(?:[Ee][+-]?\d+)?)(?:_?(?:f32|f64|[iu](?:8|16|32|64|size)?))?\b/,boolean:/\b(?:false|true)\b/,punctuation:/->|\.\.=|\.{1,3}|::|[{}[\];(),:]/,operator:/[-+*\/%!^]=?|=[=>]?|&[&=]?|\|[|=]?|<<?=?|>>?=?|[@?]/},t.languages.rust["closure-params"].inside.rest=t.languages.rust,t.languages.rust.attribute.inside.string=t.languages.rust.string}(t)}function HN(t){t.register(_N),function(t){t.languages.sass=t.languages.extend("css",{comment:{pattern:/^([ \t]*)\/[\/*].*(?:(?:\r?\n|\r)\1[ \t].+)*/m,lookbehind:!0,greedy:!0}}),t.languages.insertBefore("sass","atrule",{"atrule-line":{pattern:/^(?:[ \t]*)[@+=].+/m,greedy:!0,inside:{atrule:/(?:@[\w-]+|[+=])/}}}),delete t.languages.sass.atrule;var e=/\$[-\w]+|#\{\$[-\w]+\}/,n=[/[+*\/%]|[=!]=|<=?|>=?|\b(?:and|not|or)\b/,{pattern:/(\s)-(?=\s)/,lookbehind:!0}];t.languages.insertBefore("sass","property",{"variable-line":{pattern:/^[ \t]*\$.+/m,greedy:!0,inside:{punctuation:/:/,variable:e,operator:n}},"property-line":{pattern:/^[ \t]*(?:[^:\s]+ *:.*|:[^:\s].*)/m,greedy:!0,inside:{property:[/[^:\s]+(?=\s*:)/,{pattern:/(:)[^:\s]+/,lookbehind:!0}],punctuation:/:/,variable:e,operator:n,important:t.languages.sass.important}}}),delete t.languages.sass.property,delete t.languages.sass.important,t.languages.insertBefore("sass","punctuation",{selector:{pattern:/^([ \t]*)\S(?:,[^,\r\n]+|[^,\r\n]*)(?:,[^,\r\n]+)*(?:,(?:\r?\n|\r)\1[ \t]+\S(?:,[^,\r\n]+|[^,\r\n]*)(?:,[^,\r\n]+)*)*/m,lookbehind:!0,greedy:!0}})}(t)}function $N(t){t.register(_N),t.languages.scss=t.languages.extend("css",{comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|\/\/.*)/,lookbehind:!0},atrule:{pattern:/@[\w-](?:\([^()]+\)|[^()\s]|\s+(?!\s))*?(?=\s+[{;])/,inside:{rule:/@[\w-]+/}},url:/(?:[-a-z]+-)?url(?=\()/i,selector:{pattern:/(?=\S)[^@;{}()]?(?:[^@;{}()\s]|\s+(?!\s)|#\{\$[-\w]+\})+(?=\s*\{(?:\}|\s|[^}][^:{}]*[:{][^}]))/,inside:{parent:{pattern:/&/,alias:"important"},placeholder:/%[-\w]+/,variable:/\$[-\w]+|#\{\$[-\w]+\}/}},property:{pattern:/(?:[-\w]|\$[-\w]|#\{\$[-\w]+\})+(?=\s*:)/,inside:{variable:/\$[-\w]+|#\{\$[-\w]+\}/}}}),t.languages.insertBefore("scss","atrule",{keyword:[/@(?:content|debug|each|else(?: if)?|extend|for|forward|function|if|import|include|mixin|return|use|warn|while)\b/i,{pattern:/( )(?:from|through)(?= )/,lookbehind:!0}]}),t.languages.insertBefore("scss","important",{variable:/\$[-\w]+|#\{\$[-\w]+\}/}),t.languages.insertBefore("scss","function",{"module-modifier":{pattern:/\b(?:as|hide|show|with)\b/i,alias:"keyword"},placeholder:{pattern:/%[-\w]+/,alias:"selector"},statement:{pattern:/\B!(?:default|optional)\b/i,alias:"keyword"},boolean:/\b(?:false|true)\b/,null:{pattern:/\bnull\b/,alias:"keyword"},operator:{pattern:/(\s)(?:[-+*\/%]|[=!]=|<=?|>=?|and|not|or)(?=\s)/,lookbehind:!0}}),t.languages.scss.atrule.inside.rest=t.languages.scss}function YN(t){t.languages.sql={comment:{pattern:/(^|[^\\])(?:\/\*[\s\S]*?\*\/|(?:--|\/\/|#).*)/,lookbehind:!0},variable:[{pattern:/@(["'`])(?:\\[\s\S]|(?!\1)[^\\])+\1/,greedy:!0},/@[\w.$]+/],string:{pattern:/(^|[^@\\])("|')(?:\\[\s\S]|(?!\2)[^\\]|\2\2)*\2/,greedy:!0,lookbehind:!0},identifier:{pattern:/(^|[^@\\])`(?:\\[\s\S]|[^`\\]|``)*`/,greedy:!0,lookbehind:!0,inside:{punctuation:/^`|`$/}},function:/\b(?:AVG|COUNT|FIRST|FORMAT|LAST|LCASE|LEN|MAX|MID|MIN|MOD|NOW|ROUND|SUM|UCASE)(?=\s*\()/i,keyword:/\b(?:ACTION|ADD|AFTER|ALGORITHM|ALL|ALTER|ANALYZE|ANY|APPLY|AS|ASC|AUTHORIZATION|AUTO_INCREMENT|BACKUP|BDB|BEGIN|BERKELEYDB|BIGINT|BINARY|BIT|BLOB|BOOL|BOOLEAN|BREAK|BROWSE|BTREE|BULK|BY|CALL|CASCADED?|CASE|CHAIN|CHAR(?:ACTER|SET)?|CHECK(?:POINT)?|CLOSE|CLUSTERED|COALESCE|COLLATE|COLUMNS?|COMMENT|COMMIT(?:TED)?|COMPUTE|CONNECT|CONSISTENT|CONSTRAINT|CONTAINS(?:TABLE)?|CONTINUE|CONVERT|CREATE|CROSS|CURRENT(?:_DATE|_TIME|_TIMESTAMP|_USER)?|CURSOR|CYCLE|DATA(?:BASES?)?|DATE(?:TIME)?|DAY|DBCC|DEALLOCATE|DEC|DECIMAL|DECLARE|DEFAULT|DEFINER|DELAYED|DELETE|DELIMITERS?|DENY|DESC|DESCRIBE|DETERMINISTIC|DISABLE|DISCARD|DISK|DISTINCT|DISTINCTROW|DISTRIBUTED|DO|DOUBLE|DROP|DUMMY|DUMP(?:FILE)?|DUPLICATE|ELSE(?:IF)?|ENABLE|ENCLOSED|END|ENGINE|ENUM|ERRLVL|ERRORS|ESCAPED?|EXCEPT|EXEC(?:UTE)?|EXISTS|EXIT|EXPLAIN|EXTENDED|FETCH|FIELDS|FILE|FILLFACTOR|FIRST|FIXED|FLOAT|FOLLOWING|FOR(?: EACH ROW)?|FORCE|FOREIGN|FREETEXT(?:TABLE)?|FROM|FULL|FUNCTION|GEOMETRY(?:COLLECTION)?|GLOBAL|GOTO|GRANT|GROUP|HANDLER|HASH|HAVING|HOLDLOCK|HOUR|IDENTITY(?:COL|_INSERT)?|IF|IGNORE|IMPORT|INDEX|INFILE|INNER|INNODB|INOUT|INSERT|INT|INTEGER|INTERSECT|INTERVAL|INTO|INVOKER|ISOLATION|ITERATE|JOIN|KEYS?|KILL|LANGUAGE|LAST|LEAVE|LEFT|LEVEL|LIMIT|LINENO|LINES|LINESTRING|LOAD|LOCAL|LOCK|LONG(?:BLOB|TEXT)|LOOP|MATCH(?:ED)?|MEDIUM(?:BLOB|INT|TEXT)|MERGE|MIDDLEINT|MINUTE|MODE|MODIFIES|MODIFY|MONTH|MULTI(?:LINESTRING|POINT|POLYGON)|NATIONAL|NATURAL|NCHAR|NEXT|NO|NONCLUSTERED|NULLIF|NUMERIC|OFF?|OFFSETS?|ON|OPEN(?:DATASOURCE|QUERY|ROWSET)?|OPTIMIZE|OPTION(?:ALLY)?|ORDER|OUT(?:ER|FILE)?|OVER|PARTIAL|PARTITION|PERCENT|PIVOT|PLAN|POINT|POLYGON|PRECEDING|PRECISION|PREPARE|PREV|PRIMARY|PRINT|PRIVILEGES|PROC(?:EDURE)?|PUBLIC|PURGE|QUICK|RAISERROR|READS?|REAL|RECONFIGURE|REFERENCES|RELEASE|RENAME|REPEAT(?:ABLE)?|REPLACE|REPLICATION|REQUIRE|RESIGNAL|RESTORE|RESTRICT|RETURN(?:ING|S)?|REVOKE|RIGHT|ROLLBACK|ROUTINE|ROW(?:COUNT|GUIDCOL|S)?|RTREE|RULE|SAVE(?:POINT)?|SCHEMA|SECOND|SELECT|SERIAL(?:IZABLE)?|SESSION(?:_USER)?|SET(?:USER)?|SHARE|SHOW|SHUTDOWN|SIMPLE|SMALLINT|SNAPSHOT|SOME|SONAME|SQL|START(?:ING)?|STATISTICS|STATUS|STRIPED|SYSTEM_USER|TABLES?|TABLESPACE|TEMP(?:ORARY|TABLE)?|TERMINATED|TEXT(?:SIZE)?|THEN|TIME(?:STAMP)?|TINY(?:BLOB|INT|TEXT)|TOP?|TRAN(?:SACTIONS?)?|TRIGGER|TRUNCATE|TSEQUAL|TYPES?|UNBOUNDED|UNCOMMITTED|UNDEFINED|UNION|UNIQUE|UNLOCK|UNPIVOT|UNSIGNED|UPDATE(?:TEXT)?|USAGE|USE|USER|USING|VALUES?|VAR(?:BINARY|CHAR|CHARACTER|YING)|VIEW|WAITFOR|WARNINGS|WHEN|WHERE|WHILE|WITH(?: ROLLUP|IN)?|WORK|WRITE(?:TEXT)?|YEAR)\b/i,boolean:/\b(?:FALSE|NULL|TRUE)\b/i,number:/\b0x[\da-f]+\b|\b\d+(?:\.\d*)?|\B\.\d+\b/i,operator:/[-+*\/=%^~]|&&?|\|\|?|!=?|<(?:=>?|<|>)?|>[>=]?|\b(?:AND|BETWEEN|DIV|ILIKE|IN|IS|LIKE|NOT|OR|REGEXP|RLIKE|SOUNDS LIKE|XOR)\b/i,punctuation:/[;[\]()`,.]/}}function XN(t){t.languages.swift={comment:{pattern:/(^|[^\\:])(?:\/\/.*|\/\*(?:[^/*]|\/(?!\*)|\*(?!\/)|\/\*(?:[^*]|\*(?!\/))*\*\/)*\*\/)/,lookbehind:!0,greedy:!0},"string-literal":[{pattern:RegExp(/(^|[^"#])/.source+"(?:"+/"(?:\\(?:\((?:[^()]|\([^()]*\))*\)|\r\n|[^(])|[^\\\r\n"])*"/.source+"|"+/"""(?:\\(?:\((?:[^()]|\([^()]*\))*\)|[^(])|[^\\"]|"(?!""))*"""/.source+")"+/(?!["#])/.source),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\\($/,alias:"punctuation"},punctuation:/\\(?=[\r\n])/,string:/[\s\S]+/}},{pattern:RegExp(/(^|[^"#])(#+)/.source+"(?:"+/"(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|\r\n|[^#])|[^\\\r\n])*?"/.source+"|"+/"""(?:\\(?:#+\((?:[^()]|\([^()]*\))*\)|[^#])|[^\\])*?"""/.source+")\\2"),lookbehind:!0,greedy:!0,inside:{interpolation:{pattern:/(\\#+\()(?:[^()]|\([^()]*\))*(?=\))/,lookbehind:!0,inside:null},"interpolation-punctuation":{pattern:/^\)|\\#+\($/,alias:"punctuation"},string:/[\s\S]+/}}],directive:{pattern:RegExp(/#/.source+"(?:"+/(?:elseif|if)\b/.source+"(?:[ \t]*"+/(?:![ \t]*)?(?:\b\w+\b(?:[ \t]*\((?:[^()]|\([^()]*\))*\))?|\((?:[^()]|\([^()]*\))*\))(?:[ \t]*(?:&&|\|\|))?/.source+")+|"+/(?:else|endif)\b/.source+")"),alias:"property",inside:{"directive-name":/^#\w+/,boolean:/\b(?:false|true)\b/,number:/\b\d+(?:\.\d+)*\b/,operator:/!|&&|\|\||[<>]=?/,punctuation:/[(),]/}},literal:{pattern:/#(?:colorLiteral|column|dsohandle|file(?:ID|Literal|Path)?|function|imageLiteral|line)\b/,alias:"constant"},"other-directive":{pattern:/#\w+\b/,alias:"property"},attribute:{pattern:/@\w+/,alias:"atrule"},"function-definition":{pattern:/(\bfunc\s+)\w+/,lookbehind:!0,alias:"function"},label:{pattern:/\b(break|continue)\s+\w+|\b[a-zA-Z_]\w*(?=\s*:\s*(?:for|repeat|while)\b)/,lookbehind:!0,alias:"important"},keyword:/\b(?:Any|Protocol|Self|Type|actor|as|assignment|associatedtype|associativity|async|await|break|case|catch|class|continue|convenience|default|defer|deinit|didSet|do|dynamic|else|enum|extension|fallthrough|fileprivate|final|for|func|get|guard|higherThan|if|import|in|indirect|infix|init|inout|internal|is|isolated|lazy|left|let|lowerThan|mutating|none|nonisolated|nonmutating|open|operator|optional|override|postfix|precedencegroup|prefix|private|protocol|public|repeat|required|rethrows|return|right|safe|self|set|some|static|struct|subscript|super|switch|throw|throws|try|typealias|unowned|unsafe|var|weak|where|while|willSet)\b/,boolean:/\b(?:false|true)\b/,nil:{pattern:/\bnil\b/,alias:"constant"},"short-argument":/\$\d+\b/,omit:{pattern:/\b_\b/,alias:"keyword"},number:/\b(?:[\d_]+(?:\.[\de_]+)?|0x[a-f0-9_]+(?:\.[a-f0-9p_]+)?|0b[01_]+|0o[0-7_]+)\b/i,"class-name":/\b[A-Z](?:[A-Z_\d]*[a-z]\w*)?\b/,function:/\b[a-z_]\w*(?=\s*\()/i,constant:/\b(?:[A-Z_]{2,}|k[A-Z][A-Za-z_]+)\b/,operator:/[-+*/%=!<>&|^~?]+|\.[.\-+*/%=!<>&|^~?]+/,punctuation:/[{}[\]();,.:\\]/},t.languages.swift["string-literal"].forEach((function(e){e.inside.interpolation.inside=t.languages.swift}))}function qN(t){t.register(RN),function(t){t.languages.typescript=t.languages.extend("javascript",{"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|type)\s+)(?!keyof\b)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?:\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>)?/,lookbehind:!0,greedy:!0,inside:null},builtin:/\b(?:Array|Function|Promise|any|boolean|console|never|number|string|symbol|unknown)\b/}),t.languages.typescript.keyword.push(/\b(?:abstract|declare|is|keyof|readonly|require)\b/,/\b(?:asserts|infer|interface|module|namespace|type)\b(?=\s*(?:[{_$a-zA-Z\xA0-\uFFFF]|$))/,/\btype\b(?=\s*(?:[\{*]|$))/),delete t.languages.typescript.parameter,delete t.languages.typescript["literal-property"];var e=t.languages.extend("typescript",{});delete e["class-name"],t.languages.typescript["class-name"].inside=e,t.languages.insertBefore("typescript","function",{decorator:{pattern:/@[$\w\xA0-\uFFFF]+/,inside:{at:{pattern:/^@/,alias:"operator"},function:/^[\s\S]+/}},"generic-function":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*<(?:[^<>]|<(?:[^<>]|<[^<>]*>)*>)*>(?=\s*\()/,greedy:!0,inside:{function:/^#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*/,generic:{pattern:/<[\s\S]+/,alias:"class-name",inside:e}}}}),t.languages.ts=t.languages.typescript}(t)}function KN(t){t.languages.basic={comment:{pattern:/(?:!|REM\b).+/i,inside:{keyword:/^REM/i}},string:{pattern:/"(?:""|[!#$%&'()*,\/:;<=>?^\w +\-.])*"/,greedy:!0},number:/(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:E[+-]?\d+)?/i,keyword:/\b(?:AS|BEEP|BLOAD|BSAVE|CALL(?: ABSOLUTE)?|CASE|CHAIN|CHDIR|CLEAR|CLOSE|CLS|COM|COMMON|CONST|DATA|DECLARE|DEF(?: FN| SEG|DBL|INT|LNG|SNG|STR)|DIM|DO|DOUBLE|ELSE|ELSEIF|END|ENVIRON|ERASE|ERROR|EXIT|FIELD|FILES|FOR|FUNCTION|GET|GOSUB|GOTO|IF|INPUT|INTEGER|IOCTL|KEY|KILL|LINE INPUT|LOCATE|LOCK|LONG|LOOP|LSET|MKDIR|NAME|NEXT|OFF|ON(?: COM| ERROR| KEY| TIMER)?|OPEN|OPTION BASE|OUT|POKE|PUT|READ|REDIM|REM|RESTORE|RESUME|RETURN|RMDIR|RSET|RUN|SELECT CASE|SHARED|SHELL|SINGLE|SLEEP|STATIC|STEP|STOP|STRING|SUB|SWAP|SYSTEM|THEN|TIMER|TO|TROFF|TRON|TYPE|UNLOCK|UNTIL|USING|VIEW PRINT|WAIT|WEND|WHILE|WRITE)(?:\$|\b)/i,function:/\b(?:ABS|ACCESS|ACOS|ANGLE|AREA|ARITHMETIC|ARRAY|ASIN|ASK|AT|ATN|BASE|BEGIN|BREAK|CAUSE|CEIL|CHR|CLIP|COLLATE|COLOR|CON|COS|COSH|COT|CSC|DATE|DATUM|DEBUG|DECIMAL|DEF|DEG|DEGREES|DELETE|DET|DEVICE|DISPLAY|DOT|ELAPSED|EPS|ERASABLE|EXLINE|EXP|EXTERNAL|EXTYPE|FILETYPE|FIXED|FP|GO|GRAPH|HANDLER|IDN|IMAGE|IN|INT|INTERNAL|IP|IS|KEYED|LBOUND|LCASE|LEFT|LEN|LENGTH|LET|LINE|LINES|LOG|LOG10|LOG2|LTRIM|MARGIN|MAT|MAX|MAXNUM|MID|MIN|MISSING|MOD|NATIVE|NUL|NUMERIC|OF|OPTION|ORD|ORGANIZATION|OUTIN|OUTPUT|PI|POINT|POINTER|POINTS|POS|PRINT|PROGRAM|PROMPT|RAD|RADIANS|RANDOMIZE|RECORD|RECSIZE|RECTYPE|RELATIVE|REMAINDER|REPEAT|REST|RETRY|REWRITE|RIGHT|RND|ROUND|RTRIM|SAME|SEC|SELECT|SEQUENTIAL|SET|SETTER|SGN|SIN|SINH|SIZE|SKIP|SQR|STANDARD|STATUS|STR|STREAM|STYLE|TAB|TAN|TANH|TEMPLATE|TEXT|THERE|TIME|TIMEOUT|TRACE|TRANSFORM|TRUNCATE|UBOUND|UCASE|USE|VAL|VARIABLE|VIEWPORT|WHEN|WINDOW|WITH|ZER|ZONEWIDTH)(?:\$|\b)/i,operator:/<[=>]?|>=?|[+\-*\/^=&]|\b(?:AND|EQV|IMP|NOT|OR|XOR)\b/i,punctuation:/[,;:()]/}}function ZN(t){t.register(KN),t.languages.vbnet=t.languages.extend("basic",{comment:[{pattern:/(?:!|REM\b).+/i,inside:{keyword:/^REM/i}},{pattern:/(^|[^\\:])'.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(^|[^"])"(?:""|[^"])*"(?!")/,lookbehind:!0,greedy:!0},keyword:/(?:\b(?:ADDHANDLER|ADDRESSOF|ALIAS|AND|ANDALSO|AS|BEEP|BLOAD|BOOLEAN|BSAVE|BYREF|BYTE|BYVAL|CALL(?: ABSOLUTE)?|CASE|CATCH|CBOOL|CBYTE|CCHAR|CDATE|CDBL|CDEC|CHAIN|CHAR|CHDIR|CINT|CLASS|CLEAR|CLNG|CLOSE|CLS|COBJ|COM|COMMON|CONST|CONTINUE|CSBYTE|CSHORT|CSNG|CSTR|CTYPE|CUINT|CULNG|CUSHORT|DATA|DATE|DECIMAL|DECLARE|DEF(?: FN| SEG|DBL|INT|LNG|SNG|STR)|DEFAULT|DELEGATE|DIM|DIRECTCAST|DO|DOUBLE|ELSE|ELSEIF|END|ENUM|ENVIRON|ERASE|ERROR|EVENT|EXIT|FALSE|FIELD|FILES|FINALLY|FOR(?: EACH)?|FRIEND|FUNCTION|GET|GETTYPE|GETXMLNAMESPACE|GLOBAL|GOSUB|GOTO|HANDLES|IF|IMPLEMENTS|IMPORTS|IN|INHERITS|INPUT|INTEGER|INTERFACE|IOCTL|IS|ISNOT|KEY|KILL|LET|LIB|LIKE|LINE INPUT|LOCATE|LOCK|LONG|LOOP|LSET|ME|MKDIR|MOD|MODULE|MUSTINHERIT|MUSTOVERRIDE|MYBASE|MYCLASS|NAME|NAMESPACE|NARROWING|NEW|NEXT|NOT|NOTHING|NOTINHERITABLE|NOTOVERRIDABLE|OBJECT|OF|OFF|ON(?: COM| ERROR| KEY| TIMER)?|OPEN|OPERATOR|OPTION(?: BASE)?|OPTIONAL|OR|ORELSE|OUT|OVERLOADS|OVERRIDABLE|OVERRIDES|PARAMARRAY|PARTIAL|POKE|PRIVATE|PROPERTY|PROTECTED|PUBLIC|PUT|RAISEEVENT|READ|READONLY|REDIM|REM|REMOVEHANDLER|RESTORE|RESUME|RETURN|RMDIR|RSET|RUN|SBYTE|SELECT(?: CASE)?|SET|SHADOWS|SHARED|SHELL|SHORT|SINGLE|SLEEP|STATIC|STEP|STOP|STRING|STRUCTURE|SUB|SWAP|SYNCLOCK|SYSTEM|THEN|THROW|TIMER|TO|TROFF|TRON|TRUE|TRY|TRYCAST|TYPE|TYPEOF|UINTEGER|ULONG|UNLOCK|UNTIL|USHORT|USING|VIEW PRINT|WAIT|WEND|WHEN|WHILE|WIDENING|WITH|WITHEVENTS|WRITE|WRITEONLY|XOR)|\B(?:#CONST|#ELSE|#ELSEIF|#END|#IF))(?:\$|\b)/i,punctuation:/[,;:(){}]/})}gN.displayName="clike",gN.aliases=[],vN.displayName="c",vN.aliases=[],yN.displayName="cpp",yN.aliases=[],bN.displayName="arduino",bN.aliases=["ino"],xN.displayName="bash",xN.aliases=["sh","shell"],wN.displayName="csharp",wN.aliases=["cs","dotnet"],EN.displayName="markup",EN.aliases=["atom","html","mathml","rss","ssml","svg","xml"],_N.displayName="css",_N.aliases=[],SN.displayName="diff",SN.aliases=[],TN.displayName="go",TN.aliases=[],kN.displayName="ini",kN.aliases=[],AN.displayName="java",AN.aliases=[],CN.displayName="regex",CN.aliases=[],RN.displayName="javascript",RN.aliases=["js"],MN.displayName="json",MN.aliases=["webmanifest"],IN.displayName="kotlin",IN.aliases=["kt","kts"],DN.displayName="less",DN.aliases=[],ON.displayName="lua",ON.aliases=[],PN.displayName="makefile",PN.aliases=[],LN.displayName="yaml",LN.aliases=["yml"],FN.displayName="markdown",FN.aliases=["md"],NN.displayName="objectivec",NN.aliases=["objc"],BN.displayName="perl",BN.aliases=[],UN.displayName="markup-templating",UN.aliases=[],VN.displayName="php",VN.aliases=[],jN.displayName="python",jN.aliases=["py"],zN.displayName="r",zN.aliases=[],GN.displayName="ruby",GN.aliases=["rb"],WN.displayName="rust",WN.aliases=[],HN.displayName="sass",HN.aliases=[],$N.displayName="scss",$N.aliases=[],YN.displayName="sql",YN.aliases=[],XN.displayName="swift",XN.aliases=[],qN.displayName="typescript",qN.aliases=["ts"],KN.displayName="basic",KN.aliases=[],ZN.displayName="vbnet",ZN.aliases=[];class JN{constructor(t,e,n){this.property=t,this.normal=e,n&&(this.space=n)}}function QN(t,e){const n={},r={};let i=-1;for(;++i<t.length;)Object.assign(n,t[i].property),Object.assign(r,t[i].normal);return new JN(n,r,e)}function tB(t){return t.toLowerCase()}JN.prototype.property={},JN.prototype.normal={},JN.prototype.space=null;class eB{constructor(t,e){this.property=t,this.attribute=e}}eB.prototype.space=null,eB.prototype.boolean=!1,eB.prototype.booleanish=!1,eB.prototype.overloadedBoolean=!1,eB.prototype.number=!1,eB.prototype.commaSeparated=!1,eB.prototype.spaceSeparated=!1,eB.prototype.commaOrSpaceSeparated=!1,eB.prototype.mustUseProperty=!1,eB.prototype.defined=!1;let nB=0;const rB=hB(),iB=hB(),sB=hB(),oB=hB(),aB=hB(),lB=hB(),cB=hB();function hB(){return 2**++nB}const uB=Object.freeze(Object.defineProperty({__proto__:null,boolean:rB,booleanish:iB,commaOrSpaceSeparated:cB,commaSeparated:lB,number:oB,overloadedBoolean:sB,spaceSeparated:aB},Symbol.toStringTag,{value:"Module"})),dB=Object.keys(uB);class fB extends eB{constructor(t,e,n,r){let i=-1;if(super(t,e),pB(this,"space",r),"number"==typeof n)for(;++i<dB.length;){const t=dB[i];pB(this,dB[i],(n&uB[t])===uB[t])}}}function pB(t,e,n){n&&(t[e]=n)}fB.prototype.defined=!0;const mB={}.hasOwnProperty;function gB(t){const e={},n={};let r;for(r in t.properties)if(mB.call(t.properties,r)){const i=t.properties[r],s=new fB(r,t.transform(t.attributes||{},r),i,t.space);t.mustUseProperty&&t.mustUseProperty.includes(r)&&(s.mustUseProperty=!0),e[r]=s,n[tB(r)]=r,n[tB(s.attribute)]=r}return new JN(e,n,t.space)}const vB=gB({space:"xlink",transform:(t,e)=>"xlink:"+e.slice(5).toLowerCase(),properties:{xLinkActuate:null,xLinkArcRole:null,xLinkHref:null,xLinkRole:null,xLinkShow:null,xLinkTitle:null,xLinkType:null}}),yB=gB({space:"xml",transform:(t,e)=>"xml:"+e.slice(3).toLowerCase(),properties:{xmlLang:null,xmlBase:null,xmlSpace:null}});function bB(t,e){return e in t?t[e]:e}function xB(t,e){return bB(t,e.toLowerCase())}const wB=gB({space:"xmlns",attributes:{xmlnsxlink:"xmlns:xlink"},transform:xB,properties:{xmlns:null,xmlnsXLink:null}}),EB=gB({transform:(t,e)=>"role"===e?e:"aria-"+e.slice(4).toLowerCase(),properties:{ariaActiveDescendant:null,ariaAtomic:iB,ariaAutoComplete:null,ariaBusy:iB,ariaChecked:iB,ariaColCount:oB,ariaColIndex:oB,ariaColSpan:oB,ariaControls:aB,ariaCurrent:null,ariaDescribedBy:aB,ariaDetails:null,ariaDisabled:iB,ariaDropEffect:aB,ariaErrorMessage:null,ariaExpanded:iB,ariaFlowTo:aB,ariaGrabbed:iB,ariaHasPopup:null,ariaHidden:iB,ariaInvalid:null,ariaKeyShortcuts:null,ariaLabel:null,ariaLabelledBy:aB,ariaLevel:oB,ariaLive:null,ariaModal:iB,ariaMultiLine:iB,ariaMultiSelectable:iB,ariaOrientation:null,ariaOwns:aB,ariaPlaceholder:null,ariaPosInSet:oB,ariaPressed:iB,ariaReadOnly:iB,ariaRelevant:null,ariaRequired:iB,ariaRoleDescription:aB,ariaRowCount:oB,ariaRowIndex:oB,ariaRowSpan:oB,ariaSelected:iB,ariaSetSize:oB,ariaSort:null,ariaValueMax:oB,ariaValueMin:oB,ariaValueNow:oB,ariaValueText:null,role:null}}),_B=gB({space:"html",attributes:{acceptcharset:"accept-charset",classname:"class",htmlfor:"for",httpequiv:"http-equiv"},transform:xB,mustUseProperty:["checked","multiple","muted","selected"],properties:{abbr:null,accept:lB,acceptCharset:aB,accessKey:aB,action:null,allow:null,allowFullScreen:rB,allowPaymentRequest:rB,allowUserMedia:rB,alt:null,as:null,async:rB,autoCapitalize:null,autoComplete:aB,autoFocus:rB,autoPlay:rB,blocking:aB,capture:rB,charSet:null,checked:rB,cite:null,className:aB,cols:oB,colSpan:null,content:null,contentEditable:iB,controls:rB,controlsList:aB,coords:oB|lB,crossOrigin:null,data:null,dateTime:null,decoding:null,default:rB,defer:rB,dir:null,dirName:null,disabled:rB,download:sB,draggable:iB,encType:null,enterKeyHint:null,fetchPriority:null,form:null,formAction:null,formEncType:null,formMethod:null,formNoValidate:rB,formTarget:null,headers:aB,height:oB,hidden:rB,high:oB,href:null,hrefLang:null,htmlFor:aB,httpEquiv:aB,id:null,imageSizes:null,imageSrcSet:null,inert:rB,inputMode:null,integrity:null,is:null,isMap:rB,itemId:null,itemProp:aB,itemRef:aB,itemScope:rB,itemType:aB,kind:null,label:null,lang:null,language:null,list:null,loading:null,loop:rB,low:oB,manifest:null,max:null,maxLength:oB,media:null,method:null,min:null,minLength:oB,multiple:rB,muted:rB,name:null,nonce:null,noModule:rB,noValidate:rB,onAbort:null,onAfterPrint:null,onAuxClick:null,onBeforeMatch:null,onBeforePrint:null,onBeforeUnload:null,onBlur:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onContextLost:null,onContextMenu:null,onContextRestored:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnded:null,onError:null,onFocus:null,onFormData:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLanguageChange:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadEnd:null,onLoadStart:null,onMessage:null,onMessageError:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRejectionHandled:null,onReset:null,onResize:null,onScroll:null,onScrollEnd:null,onSecurityPolicyViolation:null,onSeeked:null,onSeeking:null,onSelect:null,onSlotChange:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnhandledRejection:null,onUnload:null,onVolumeChange:null,onWaiting:null,onWheel:null,open:rB,optimum:oB,pattern:null,ping:aB,placeholder:null,playsInline:rB,popover:null,popoverTarget:null,popoverTargetAction:null,poster:null,preload:null,readOnly:rB,referrerPolicy:null,rel:aB,required:rB,reversed:rB,rows:oB,rowSpan:oB,sandbox:aB,scope:null,scoped:rB,seamless:rB,selected:rB,shape:null,size:oB,sizes:null,slot:null,span:oB,spellCheck:iB,src:null,srcDoc:null,srcLang:null,srcSet:null,start:oB,step:null,style:null,tabIndex:oB,target:null,title:null,translate:null,type:null,typeMustMatch:rB,useMap:null,value:iB,width:oB,wrap:null,align:null,aLink:null,archive:aB,axis:null,background:null,bgColor:null,border:oB,borderColor:null,bottomMargin:oB,cellPadding:null,cellSpacing:null,char:null,charOff:null,classId:null,clear:null,code:null,codeBase:null,codeType:null,color:null,compact:rB,declare:rB,event:null,face:null,frame:null,frameBorder:null,hSpace:oB,leftMargin:oB,link:null,longDesc:null,lowSrc:null,marginHeight:oB,marginWidth:oB,noResize:rB,noHref:rB,noShade:rB,noWrap:rB,object:null,profile:null,prompt:null,rev:null,rightMargin:oB,rules:null,scheme:null,scrolling:iB,standby:null,summary:null,text:null,topMargin:oB,valueType:null,version:null,vAlign:null,vLink:null,vSpace:oB,allowTransparency:null,autoCorrect:null,autoSave:null,disablePictureInPicture:rB,disableRemotePlayback:rB,prefix:null,property:null,results:oB,security:null,unselectable:null}}),SB=gB({space:"svg",attributes:{accentHeight:"accent-height",alignmentBaseline:"alignment-baseline",arabicForm:"arabic-form",baselineShift:"baseline-shift",capHeight:"cap-height",className:"class",clipPath:"clip-path",clipRule:"clip-rule",colorInterpolation:"color-interpolation",colorInterpolationFilters:"color-interpolation-filters",colorProfile:"color-profile",colorRendering:"color-rendering",crossOrigin:"crossorigin",dataType:"datatype",dominantBaseline:"dominant-baseline",enableBackground:"enable-background",fillOpacity:"fill-opacity",fillRule:"fill-rule",floodColor:"flood-color",floodOpacity:"flood-opacity",fontFamily:"font-family",fontSize:"font-size",fontSizeAdjust:"font-size-adjust",fontStretch:"font-stretch",fontStyle:"font-style",fontVariant:"font-variant",fontWeight:"font-weight",glyphName:"glyph-name",glyphOrientationHorizontal:"glyph-orientation-horizontal",glyphOrientationVertical:"glyph-orientation-vertical",hrefLang:"hreflang",horizAdvX:"horiz-adv-x",horizOriginX:"horiz-origin-x",horizOriginY:"horiz-origin-y",imageRendering:"image-rendering",letterSpacing:"letter-spacing",lightingColor:"lighting-color",markerEnd:"marker-end",markerMid:"marker-mid",markerStart:"marker-start",navDown:"nav-down",navDownLeft:"nav-down-left",navDownRight:"nav-down-right",navLeft:"nav-left",navNext:"nav-next",navPrev:"nav-prev",navRight:"nav-right",navUp:"nav-up",navUpLeft:"nav-up-left",navUpRight:"nav-up-right",onAbort:"onabort",onActivate:"onactivate",onAfterPrint:"onafterprint",onBeforePrint:"onbeforeprint",onBegin:"onbegin",onCancel:"oncancel",onCanPlay:"oncanplay",onCanPlayThrough:"oncanplaythrough",onChange:"onchange",onClick:"onclick",onClose:"onclose",onCopy:"oncopy",onCueChange:"oncuechange",onCut:"oncut",onDblClick:"ondblclick",onDrag:"ondrag",onDragEnd:"ondragend",onDragEnter:"ondragenter",onDragExit:"ondragexit",onDragLeave:"ondragleave",onDragOver:"ondragover",onDragStart:"ondragstart",onDrop:"ondrop",onDurationChange:"ondurationchange",onEmptied:"onemptied",onEnd:"onend",onEnded:"onended",onError:"onerror",onFocus:"onfocus",onFocusIn:"onfocusin",onFocusOut:"onfocusout",onHashChange:"onhashchange",onInput:"oninput",onInvalid:"oninvalid",onKeyDown:"onkeydown",onKeyPress:"onkeypress",onKeyUp:"onkeyup",onLoad:"onload",onLoadedData:"onloadeddata",onLoadedMetadata:"onloadedmetadata",onLoadStart:"onloadstart",onMessage:"onmessage",onMouseDown:"onmousedown",onMouseEnter:"onmouseenter",onMouseLeave:"onmouseleave",onMouseMove:"onmousemove",onMouseOut:"onmouseout",onMouseOver:"onmouseover",onMouseUp:"onmouseup",onMouseWheel:"onmousewheel",onOffline:"onoffline",onOnline:"ononline",onPageHide:"onpagehide",onPageShow:"onpageshow",onPaste:"onpaste",onPause:"onpause",onPlay:"onplay",onPlaying:"onplaying",onPopState:"onpopstate",onProgress:"onprogress",onRateChange:"onratechange",onRepeat:"onrepeat",onReset:"onreset",onResize:"onresize",onScroll:"onscroll",onSeeked:"onseeked",onSeeking:"onseeking",onSelect:"onselect",onShow:"onshow",onStalled:"onstalled",onStorage:"onstorage",onSubmit:"onsubmit",onSuspend:"onsuspend",onTimeUpdate:"ontimeupdate",onToggle:"ontoggle",onUnload:"onunload",onVolumeChange:"onvolumechange",onWaiting:"onwaiting",onZoom:"onzoom",overlinePosition:"overline-position",overlineThickness:"overline-thickness",paintOrder:"paint-order",panose1:"panose-1",pointerEvents:"pointer-events",referrerPolicy:"referrerpolicy",renderingIntent:"rendering-intent",shapeRendering:"shape-rendering",stopColor:"stop-color",stopOpacity:"stop-opacity",strikethroughPosition:"strikethrough-position",strikethroughThickness:"strikethrough-thickness",strokeDashArray:"stroke-dasharray",strokeDashOffset:"stroke-dashoffset",strokeLineCap:"stroke-linecap",strokeLineJoin:"stroke-linejoin",strokeMiterLimit:"stroke-miterlimit",strokeOpacity:"stroke-opacity",strokeWidth:"stroke-width",tabIndex:"tabindex",textAnchor:"text-anchor",textDecoration:"text-decoration",textRendering:"text-rendering",transformOrigin:"transform-origin",typeOf:"typeof",underlinePosition:"underline-position",underlineThickness:"underline-thickness",unicodeBidi:"unicode-bidi",unicodeRange:"unicode-range",unitsPerEm:"units-per-em",vAlphabetic:"v-alphabetic",vHanging:"v-hanging",vIdeographic:"v-ideographic",vMathematical:"v-mathematical",vectorEffect:"vector-effect",vertAdvY:"vert-adv-y",vertOriginX:"vert-origin-x",vertOriginY:"vert-origin-y",wordSpacing:"word-spacing",writingMode:"writing-mode",xHeight:"x-height",playbackOrder:"playbackorder",timelineBegin:"timelinebegin"},transform:bB,properties:{about:cB,accentHeight:oB,accumulate:null,additive:null,alignmentBaseline:null,alphabetic:oB,amplitude:oB,arabicForm:null,ascent:oB,attributeName:null,attributeType:null,azimuth:oB,bandwidth:null,baselineShift:null,baseFrequency:null,baseProfile:null,bbox:null,begin:null,bias:oB,by:null,calcMode:null,capHeight:oB,className:aB,clip:null,clipPath:null,clipPathUnits:null,clipRule:null,color:null,colorInterpolation:null,colorInterpolationFilters:null,colorProfile:null,colorRendering:null,content:null,contentScriptType:null,contentStyleType:null,crossOrigin:null,cursor:null,cx:null,cy:null,d:null,dataType:null,defaultAction:null,descent:oB,diffuseConstant:oB,direction:null,display:null,dur:null,divisor:oB,dominantBaseline:null,download:rB,dx:null,dy:null,edgeMode:null,editable:null,elevation:oB,enableBackground:null,end:null,event:null,exponent:oB,externalResourcesRequired:null,fill:null,fillOpacity:oB,fillRule:null,filter:null,filterRes:null,filterUnits:null,floodColor:null,floodOpacity:null,focusable:null,focusHighlight:null,fontFamily:null,fontSize:null,fontSizeAdjust:null,fontStretch:null,fontStyle:null,fontVariant:null,fontWeight:null,format:null,fr:null,from:null,fx:null,fy:null,g1:lB,g2:lB,glyphName:lB,glyphOrientationHorizontal:null,glyphOrientationVertical:null,glyphRef:null,gradientTransform:null,gradientUnits:null,handler:null,hanging:oB,hatchContentUnits:null,hatchUnits:null,height:null,href:null,hrefLang:null,horizAdvX:oB,horizOriginX:oB,horizOriginY:oB,id:null,ideographic:oB,imageRendering:null,initialVisibility:null,in:null,in2:null,intercept:oB,k:oB,k1:oB,k2:oB,k3:oB,k4:oB,kernelMatrix:cB,kernelUnitLength:null,keyPoints:null,keySplines:null,keyTimes:null,kerning:null,lang:null,lengthAdjust:null,letterSpacing:null,lightingColor:null,limitingConeAngle:oB,local:null,markerEnd:null,markerMid:null,markerStart:null,markerHeight:null,markerUnits:null,markerWidth:null,mask:null,maskContentUnits:null,maskUnits:null,mathematical:null,max:null,media:null,mediaCharacterEncoding:null,mediaContentEncodings:null,mediaSize:oB,mediaTime:null,method:null,min:null,mode:null,name:null,navDown:null,navDownLeft:null,navDownRight:null,navLeft:null,navNext:null,navPrev:null,navRight:null,navUp:null,navUpLeft:null,navUpRight:null,numOctaves:null,observer:null,offset:null,onAbort:null,onActivate:null,onAfterPrint:null,onBeforePrint:null,onBegin:null,onCancel:null,onCanPlay:null,onCanPlayThrough:null,onChange:null,onClick:null,onClose:null,onCopy:null,onCueChange:null,onCut:null,onDblClick:null,onDrag:null,onDragEnd:null,onDragEnter:null,onDragExit:null,onDragLeave:null,onDragOver:null,onDragStart:null,onDrop:null,onDurationChange:null,onEmptied:null,onEnd:null,onEnded:null,onError:null,onFocus:null,onFocusIn:null,onFocusOut:null,onHashChange:null,onInput:null,onInvalid:null,onKeyDown:null,onKeyPress:null,onKeyUp:null,onLoad:null,onLoadedData:null,onLoadedMetadata:null,onLoadStart:null,onMessage:null,onMouseDown:null,onMouseEnter:null,onMouseLeave:null,onMouseMove:null,onMouseOut:null,onMouseOver:null,onMouseUp:null,onMouseWheel:null,onOffline:null,onOnline:null,onPageHide:null,onPageShow:null,onPaste:null,onPause:null,onPlay:null,onPlaying:null,onPopState:null,onProgress:null,onRateChange:null,onRepeat:null,onReset:null,onResize:null,onScroll:null,onSeeked:null,onSeeking:null,onSelect:null,onShow:null,onStalled:null,onStorage:null,onSubmit:null,onSuspend:null,onTimeUpdate:null,onToggle:null,onUnload:null,onVolumeChange:null,onWaiting:null,onZoom:null,opacity:null,operator:null,order:null,orient:null,orientation:null,origin:null,overflow:null,overlay:null,overlinePosition:oB,overlineThickness:oB,paintOrder:null,panose1:null,path:null,pathLength:oB,patternContentUnits:null,patternTransform:null,patternUnits:null,phase:null,ping:aB,pitch:null,playbackOrder:null,pointerEvents:null,points:null,pointsAtX:oB,pointsAtY:oB,pointsAtZ:oB,preserveAlpha:null,preserveAspectRatio:null,primitiveUnits:null,propagate:null,property:cB,r:null,radius:null,referrerPolicy:null,refX:null,refY:null,rel:cB,rev:cB,renderingIntent:null,repeatCount:null,repeatDur:null,requiredExtensions:cB,requiredFeatures:cB,requiredFonts:cB,requiredFormats:cB,resource:null,restart:null,result:null,rotate:null,rx:null,ry:null,scale:null,seed:null,shapeRendering:null,side:null,slope:null,snapshotTime:null,specularConstant:oB,specularExponent:oB,spreadMethod:null,spacing:null,startOffset:null,stdDeviation:null,stemh:null,stemv:null,stitchTiles:null,stopColor:null,stopOpacity:null,strikethroughPosition:oB,strikethroughThickness:oB,string:null,stroke:null,strokeDashArray:cB,strokeDashOffset:null,strokeLineCap:null,strokeLineJoin:null,strokeMiterLimit:oB,strokeOpacity:oB,strokeWidth:null,style:null,surfaceScale:oB,syncBehavior:null,syncBehaviorDefault:null,syncMaster:null,syncTolerance:null,syncToleranceDefault:null,systemLanguage:cB,tabIndex:oB,tableValues:null,target:null,targetX:oB,targetY:oB,textAnchor:null,textDecoration:null,textRendering:null,textLength:null,timelineBegin:null,title:null,transformBehavior:null,type:null,typeOf:cB,to:null,transform:null,transformOrigin:null,u1:null,u2:null,underlinePosition:oB,underlineThickness:oB,unicode:null,unicodeBidi:null,unicodeRange:null,unitsPerEm:oB,values:null,vAlphabetic:oB,vMathematical:oB,vectorEffect:null,vHanging:oB,vIdeographic:oB,version:null,vertAdvY:oB,vertOriginX:oB,vertOriginY:oB,viewBox:null,viewTarget:null,visibility:null,width:null,widths:null,wordSpacing:null,writingMode:null,x:null,x1:null,x2:null,xChannelSelector:null,xHeight:oB,y:null,y1:null,y2:null,yChannelSelector:null,z:null,zoomAndPan:null}}),TB=/^data[-\w.:]+$/i,kB=/-[a-z]/g,AB=/[A-Z]/g;function CB(t){return"-"+t.toLowerCase()}function RB(t){return t.charAt(1).toUpperCase()}const MB=QN([yB,vB,wB,EB,_B],"html");QN([yB,vB,wB,EB,SB],"svg");const IB=/[#.]/g;function DB(t){const e=String(t||"").trim();return e?e.split(/[ \t\n\r\f]+/g):[]}function OB(t){const e=[],n=String(t||"");let r=n.indexOf(","),i=0,s=!1;for(;!s;){-1===r&&(r=n.length,s=!0);const t=n.slice(i,r).trim();!t&&s||e.push(t),i=r+1,r=n.indexOf(",",i)}return e}const PB=new Set(["menu","submit","reset","button"]),LB={}.hasOwnProperty;function FB(t,e,n,r){const i=function(t,e){const n=tB(e);let r=e,i=eB;if(n in t.normal)return t.property[t.normal[n]];if(n.length>4&&"data"===n.slice(0,4)&&TB.test(e)){if("-"===e.charAt(4)){const t=e.slice(5).replace(kB,RB);r="data"+t.charAt(0).toUpperCase()+t.slice(1)}else{const t=e.slice(4);if(!kB.test(t)){let n=t.replace(AB,CB);"-"!==n.charAt(0)&&(n="-"+n),e="data"+n}}i=fB}return new i(r,e)}(t,n);let s,o=-1;if(null!=r){if("number"==typeof r){if(Number.isNaN(r))return;s=r}else s="boolean"==typeof r?r:"string"==typeof r?i.spaceSeparated?DB(r):i.commaSeparated?OB(r):i.commaOrSpaceSeparated?DB(OB(r).join(" ")):BB(i,i.property,r):Array.isArray(r)?r.concat():"style"===i.property?function(t){const e=[];let n;for(n in t)LB.call(t,n)&&e.push([n,t[n]].join(": "));return e.join("; ")}(r):String(r);if(Array.isArray(s)){const t=[];for(;++o<s.length;)t[o]=BB(i,i.property,s[o]);s=t}"className"===i.property&&Array.isArray(e.className)&&(s=e.className.concat(s)),e[i.property]=s}}function NB(t,e){let n=-1;if(null==e);else if("string"==typeof e||"number"==typeof e)t.push({type:"text",value:String(e)});else if(Array.isArray(e))for(;++n<e.length;)NB(t,e[n]);else{if("object"!=typeof e||!("type"in e))throw new Error("Expected node, nodes, or string, got `"+e+"`");"root"===e.type?NB(t,e.children):t.push(e)}}function BB(t,e,n){if("string"==typeof n){if(t.number&&n&&!Number.isNaN(Number(n)))return Number(n);if((t.boolean||t.overloadedBoolean)&&(""===n||tB(n)===tB(e)))return!0}return n}const UB=function(t,e,n){const r=n&&function(t){const e={};let n=-1;for(;++n<t.length;)e[t[n].toLowerCase()]=t[n];return e}(n);return function(n,i,...s){let o,a=-1;if(null==n)o={type:"root",children:[]},s.unshift(i);else if(o=function(t,e){const n=t||"",r={};let i,s,o=0;for(;o<n.length;){IB.lastIndex=o;const t=IB.exec(n),e=n.slice(o,t?t.index:n.length);e&&(i?"#"===i?r.id=e:Array.isArray(r.className)?r.className.push(e):r.className=[e]:s=e,o+=e.length),t&&(i=t[0],o++)}return{type:"element",tagName:s||e||"div",properties:r,children:[]}}(n,e),o.tagName=o.tagName.toLowerCase(),r&&LB.call(r,o.tagName)&&(o.tagName=r[o.tagName]),function(t,e){if(null==t||"object"!=typeof t||Array.isArray(t))return!1;if("input"===e||!t.type||"string"!=typeof t.type)return!0;if("children"in t&&Array.isArray(t.children))return!1;if("button"===e)return PB.has(t.type.toLowerCase());return!("value"in t)}(i,o.tagName)){let e;for(e in i)LB.call(i,e)&&FB(t,o.properties,e,i[e])}else s.unshift(i);for(;++a<s.length;)NB(o.children,s[a]);return"element"===o.type&&"template"===o.tagName&&(o.content={type:"root",children:o.children},o.children=[]),o}}(MB,"div"),VB=["AElig","AMP","Aacute","Acirc","Agrave","Aring","Atilde","Auml","COPY","Ccedil","ETH","Eacute","Ecirc","Egrave","Euml","GT","Iacute","Icirc","Igrave","Iuml","LT","Ntilde","Oacute","Ocirc","Ograve","Oslash","Otilde","Ouml","QUOT","REG","THORN","Uacute","Ucirc","Ugrave","Uuml","Yacute","aacute","acirc","acute","aelig","agrave","amp","aring","atilde","auml","brvbar","ccedil","cedil","cent","copy","curren","deg","divide","eacute","ecirc","egrave","eth","euml","frac12","frac14","frac34","gt","iacute","icirc","iexcl","igrave","iquest","iuml","laquo","lt","macr","micro","middot","nbsp","not","ntilde","oacute","ocirc","ograve","ordf","ordm","oslash","otilde","ouml","para","plusmn","pound","quot","raquo","reg","sect","shy","sup1","sup2","sup3","szlig","thorn","times","uacute","ucirc","ugrave","uml","uuml","yacute","yen","yuml"],jB={0:"�",128:"€",130:"‚",131:"ƒ",132:"„",133:"…",134:"†",135:"‡",136:"ˆ",137:"‰",138:"Š",139:"‹",140:"Œ",142:"Ž",145:"‘",146:"’",147:"“",148:"”",149:"•",150:"–",151:"—",152:"˜",153:"™",154:"š",155:"›",156:"œ",158:"ž",159:"Ÿ"};function zB(t){const e="string"==typeof t?t.charCodeAt(0):t;return e>=48&&e<=57}function GB(t){const e="string"==typeof t?t.charCodeAt(0):t;return e>=97&&e<=102||e>=65&&e<=70||e>=48&&e<=57}function WB(t){return function(t){const e="string"==typeof t?t.charCodeAt(0):t;return e>=97&&e<=122||e>=65&&e<=90}(t)||zB(t)}const HB=String.fromCharCode,$B=["","Named character references must be terminated by a semicolon","Numeric character references must be terminated by a semicolon","Named character references cannot be empty","Numeric character references cannot be empty","Named character references must be known","Numeric character references cannot be disallowed","Numeric character references cannot be outside the permissible Unicode range"];function YB(t,e={}){const n="string"==typeof e.additional?e.additional.charCodeAt(0):e.additional,r=[];let i,s,o=0,a=-1,l="";e.position&&("start"in e.position||"indent"in e.position?(s=e.position.indent,i=e.position.start):i=e.position);let c,h=(i?i.line:0)||1,u=(i?i.column:0)||1,d=p();for(o--;++o<=t.length;)if(10===c&&(u=(s?s[a]:0)||1),c=t.charCodeAt(o),38===c){const i=t.charCodeAt(o+1);if(9===i||10===i||12===i||32===i||38===i||60===i||Number.isNaN(i)||n&&i===n){l+=HB(c),u++;continue}const s=o+1;let a,h=s,v=s;if(35===i){v=++h;const e=t.charCodeAt(v);88===e||120===e?(a="hexadecimal",v=++h):a="decimal"}else a="named";let y="",b="",x="";const w="named"===a?WB:"decimal"===a?zB:GB;for(v--;++v<=t.length;){const e=t.charCodeAt(v);if(!w(e))break;x+=HB(e),"named"===a&&VB.includes(x)&&(y=x,b=lA(x))}let E=59===t.charCodeAt(v);if(E){v++;const t="named"===a&&lA(x);t&&(y=x,b=t)}let _=1+v-s,S="";if(E||!1!==e.nonTerminated)if(x)if("named"===a){if(E&&!b)m(5,1);else if(y!==x&&(v=h+y.length,_=1+v-h,E=!1),!E){const n=y?1:3;if(e.attribute){const e=t.charCodeAt(v);61===e?(m(n,_),b=""):WB(e)?b="":m(n,_)}else m(n,_)}S=b}else{E||m(2,_);let t=Number.parseInt(x,"hexadecimal"===a?16:10);if((f=t)>=55296&&f<=57343||f>1114111)m(7,_),S=HB(65533);else if(t in jB)m(6,_),S=jB[t];else{let e="";XB(t)&&m(6,_),t>65535&&(t-=65536,e+=HB(t>>>10|55296),t=56320|1023&t),S=e+HB(t)}}else"named"!==a&&m(4,_);else;if(S){g(),d=p(),o=v-1,u+=v-s+1,r.push(S);const n=p();n.offset++,e.reference&&e.reference.call(e.referenceContext,S,{start:d,end:n},t.slice(s-1,v)),d=n}else x=t.slice(s-1,v),l+=x,u+=x.length,o=v-1}else 10===c&&(h++,a++,u=0),Number.isNaN(c)?g():(l+=HB(c),u++);var f;return r.join("");function p(){return{line:h,column:u,offset:o+((i?i.offset:0)||0)}}function m(t,n){let r;e.warning&&(r=p(),r.column+=n,r.offset+=n,e.warning.call(e.warningContext,$B[t],r,t))}function g(){l&&(r.push(l),e.text&&e.text.call(e.textContext,l,{start:d,end:p()}),l="")}}function XB(t){return t>=1&&t<=8||11===t||t>=13&&t<=31||t>=127&&t<=159||t>=64976&&t<=65007||65535==(65535&t)||65534==(65535&t)}var qB=0,KB={},ZB={util:{type:function(t){return Object.prototype.toString.call(t).slice(8,-1)},objId:function(t){return t.__id||Object.defineProperty(t,"__id",{value:++qB}),t.__id},clone:function t(e,n){var r,i;switch(n=n||{},ZB.util.type(e)){case"Object":if(i=ZB.util.objId(e),n[i])return n[i];for(var s in r={},n[i]=r,e)e.hasOwnProperty(s)&&(r[s]=t(e[s],n));return r;case"Array":return i=ZB.util.objId(e),n[i]?n[i]:(r=[],n[i]=r,e.forEach((function(e,i){r[i]=t(e,n)})),r);default:return e}}},languages:{plain:KB,plaintext:KB,text:KB,txt:KB,extend:function(t,e){var n=ZB.util.clone(ZB.languages[t]);for(var r in e)n[r]=e[r];return n},insertBefore:function(t,e,n,r){var i=(r=r||ZB.languages)[t],s={};for(var o in i)if(i.hasOwnProperty(o)){if(o==e)for(var a in n)n.hasOwnProperty(a)&&(s[a]=n[a]);n.hasOwnProperty(o)||(s[o]=i[o])}var l=r[t];return r[t]=s,ZB.languages.DFS(ZB.languages,(function(e,n){n===l&&e!=t&&(this[e]=s)})),s},DFS:function t(e,n,r,i){i=i||{};var s=ZB.util.objId;for(var o in e)if(e.hasOwnProperty(o)){n.call(e,o,e[o],r||o);var a=e[o],l=ZB.util.type(a);"Object"!==l||i[s(a)]?"Array"!==l||i[s(a)]||(i[s(a)]=!0,t(a,n,o,i)):(i[s(a)]=!0,t(a,n,null,i))}}},plugins:{},highlight:function(t,e,n){var r={code:t,grammar:e,language:n};if(ZB.hooks.run("before-tokenize",r),!r.grammar)throw new Error('The language "'+r.language+'" has no grammar.');return r.tokens=ZB.tokenize(r.code,r.grammar),ZB.hooks.run("after-tokenize",r),JB.stringify(ZB.util.encode(r.tokens),r.language)},tokenize:function(t,e){var n=e.rest;if(n){for(var r in n)e[r]=n[r];delete e.rest}var i=new eU;return nU(i,i.head,t),tU(t,i,e,i.head,0),function(t){var e=[],n=t.head.next;for(;n!==t.tail;)e.push(n.value),n=n.next;return e}(i)},hooks:{all:{},add:function(t,e){var n=ZB.hooks.all;n[t]=n[t]||[],n[t].push(e)},run:function(t,e){var n=ZB.hooks.all[t];if(n&&n.length)for(var r,i=0;r=n[i++];)r(e)}},Token:JB};function JB(t,e,n,r){this.type=t,this.content=e,this.alias=n,this.length=0|(r||"").length}function QB(t,e,n,r){t.lastIndex=e;var i=t.exec(n);if(i&&r&&i[1]){var s=i[1].length;i.index+=s,i[0]=i[0].slice(s)}return i}function tU(t,e,n,r,i,s){for(var o in n)if(n.hasOwnProperty(o)&&n[o]){var a=n[o];a=Array.isArray(a)?a:[a];for(var l=0;l<a.length;++l){if(s&&s.cause==o+","+l)return;var c=a[l],h=c.inside,u=!!c.lookbehind,d=!!c.greedy,f=c.alias;if(d&&!c.pattern.global){var p=c.pattern.toString().match(/[imsuy]*$/)[0];c.pattern=RegExp(c.pattern.source,p+"g")}for(var m=c.pattern||c,g=r.next,v=i;g!==e.tail&&!(s&&v>=s.reach);v+=g.value.length,g=g.next){var y=g.value;if(e.length>t.length)return;if(!(y instanceof JB)){var b,x=1;if(d){if(!(b=QB(m,v,t,u))||b.index>=t.length)break;var w=b.index,E=b.index+b[0].length,_=v;for(_+=g.value.length;w>=_;)_+=(g=g.next).value.length;if(v=_-=g.value.length,g.value instanceof JB)continue;for(var S=g;S!==e.tail&&(_<E||"string"==typeof S.value);S=S.next)x++,_+=S.value.length;x--,y=t.slice(v,_),b.index-=v}else if(!(b=QB(m,0,y,u)))continue;w=b.index;var T=b[0],k=y.slice(0,w),A=y.slice(w+T.length),C=v+y.length;s&&C>s.reach&&(s.reach=C);var R=g.prev;if(k&&(R=nU(e,R,k),v+=k.length),rU(e,R,x),g=nU(e,R,new JB(o,h?ZB.tokenize(T,h):T,f,T)),A&&nU(e,g,A),x>1){var M={cause:o+","+l,reach:C};tU(t,e,n,g.prev,v,M),s&&M.reach>s.reach&&(s.reach=M.reach)}}}}}}function eU(){var t={value:null,prev:null,next:null},e={value:null,prev:t,next:null};t.next=e,this.head=t,this.tail=e,this.length=0}function nU(t,e,n){var r=e.next,i={value:n,prev:e,next:r};return e.next=i,r.prev=i,t.length++,i}function rU(t,e,n){for(var r=e.next,i=0;i<n&&r!==t.tail;i++)r=r.next;e.next=r,r.prev=e,t.length-=i}const iU=ZB,sU={}.hasOwnProperty;function oU(){}oU.prototype=iU;const aU=new oU;aU.highlight=function(t,e){if("string"!=typeof t)throw new TypeError("Expected `string` for `value`, got `"+t+"`");let n,r;if(e&&"object"==typeof e)n=e;else{if(r=e,"string"!=typeof r)throw new TypeError("Expected `string` for `name`, got `"+r+"`");if(!sU.call(aU.languages,r))throw new Error("Unknown language: `"+r+"` is not registered");n=aU.languages[r]}return{type:"root",children:iU.highlight.call(aU,t,n,r)}},aU.register=function(t){if("function"!=typeof t||!t.displayName)throw new Error("Expected `function` for `syntax`, got `"+t+"`");sU.call(aU.languages,t.displayName)||t(aU)},aU.alias=function(t,e){const n=aU.languages;let r,i={};"string"==typeof t?e&&(i[t]=e):i=t;for(r in i)if(sU.call(i,r)){const t=i[r],e="string"==typeof t?[t]:t;let s=-1;for(;++s<e.length;)n[e[s]]=n[r]}},aU.registered=function(t){if("string"!=typeof t)throw new TypeError("Expected `string` for `aliasOrLanguage`, got `"+t+"`");return sU.call(aU.languages,t)},aU.listLanguages=function(){const t=aU.languages,e=[];let n;for(n in t)sU.call(t,n)&&"object"==typeof t[n]&&e.push(n);return e},aU.util.encode=function(t){return t},aU.Token.stringify=function t(e,n){if("string"==typeof e)return{type:"text",value:e};if(Array.isArray(e)){const r=[];let i=-1;for(;++i<e.length;)""!==e[i]&&null!==e[i]&&void 0!==e[i]&&r.push(t(e[i],n));return r}const r={type:e.type,content:t(e.content,n),tag:"span",classes:["token",e.type],attributes:{},language:n};e.alias&&r.classes.push(..."string"==typeof e.alias?[e.alias]:e.alias);return aU.hooks.run("wrap",r),UB(r.tag+"."+r.classes.join("."),function(t){let e;for(e in t)sU.call(t,e)&&(t[e]=YB(t[e]));return t}(r.attributes),r.content)},aU.register(gN),aU.register(vN),aU.register(yN),aU.register(bN),aU.register(xN),aU.register(wN),aU.register(EN),aU.register(_N),aU.register(SN),aU.register(TN),aU.register(kN),aU.register(AN),aU.register(CN),aU.register(RN),aU.register(MN),aU.register(IN),aU.register(DN),aU.register(ON),aU.register(PN),aU.register(LN),aU.register(FN),aU.register(NN),aU.register(BN),aU.register(UN),aU.register(VN),aU.register(jN),aU.register(zN),aU.register(GN),aU.register(WN),aU.register(HN),aU.register($N),aU.register(YN),aU.register(XN),aU.register(qN),aU.register(KN),aU.register(ZN);let lU=t=>crypto.getRandomValues(new Uint8Array(t));var cU=Object.defineProperty,hU=(t,e,n)=>(((t,e,n)=>{e in t?cU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const uU=Symbol("rendererKey"),dU=t=>{const e=b(uU,(()=>{throw new Jx(Zx.vueRendererCallOutOfScope,"Should not call vue renderer before it has been created.")})),{dom:n,loading:r,editor:i}=b(wU,{}),s=o(!1);c((()=>{if(!n.value)return;const o=t(n.value,e);!o||s.value||(r.value=!0,s.value=!0,o.create().then((t=>{i.value=t})).finally((()=>{r.value=!1,s.value=!1})).catch((t=>{})))})),T((()=>{var t;null==(t=i.value)||t.destroy()}))},fU=E({name:"MilkdownDomRoot",setup:(t,{slots:e})=>{dU(t.editor);const n=b(wU,{});return t.editorRef&&(t.editorRef.get=()=>n.editor.value,t.editorRef.dom=()=>n.dom.value),()=>{var t;return C("div",{ref:n.dom},[null==(t=e.default)?void 0:t.call(e)])}}});fU.props=["editor","editorRef"];const pU=Symbol("nodeMetadata"),mU=E({name:"MilkdownNodeContainer",setup:({node:t,view:e,getPos:n,decorations:r,ctx:i,as:s},o)=>(k(pU,{ctx:i,node:t,view:e,getPos:n,decorations:r}),()=>{var t,e;return R(s,{"data-view-container":!0},null==(e=(t=o.slots).default)?void 0:e.call(t))})});mU.props=["ctx","editor","node","view","getPos","decorations","as"];const gU=E({name:"MilkdownContent",setup:({isInline:t})=>()=>C(t?"span":"div",{"data-view-content":!0},null)});gU.props=["isInline"];const vU=((t,e=21)=>((t,e,n)=>{let r=(2<<Math.log(t.length-1)/Math.LN2)-1,i=-~(1.6*r*e/t.length);return(s=e)=>{let o="";for(;;){let e=n(i),a=i;for(;a--;)if(o+=t[e[a]&r]||"",o.length===s)return o}}})(t,e,lU))("abcedfghicklmn",10);var yU,bU;let xU=class{constructor(t,e,n,r,i,s,a,l,c,h){hU(this,"getPortal",(()=>{const t=this.component,e=this.options.as?this.options.as:this.isInlineOrMark?"span":"div";return f(E({name:"MilkdownPortal",setup:()=>()=>C(I,{key:this.key,to:this.teleportDOM},{default:()=>[C(mU,{as:e,ctx:this.ctx,node:this.node,view:this.view,getPos:this.getPos,decorations:this.decorations},{default:()=>[C(t,null,{default:()=>[C(gU,{isInline:this.isInlineOrMark},null)]})]})]})}))})),hU(this,"selectNode",null==(yU=this.options)?void 0:yU.selectNode),hU(this,"deselectNode",null==(bU=this.options)?void 0:bU.deselectNode),this.ctx=t,this.component=e,this.rootInstance=n,this.addPortal=r,this.removePortalByKey=i,this.options=s,this.view=l,this.getPos=c,this.key=vU(),this.node=o(a),this.decorations=o(h);const u=s.as?s.as:this.isInlineOrMark?"span":"div";this.teleportDOM=document.createElement(u),this.renderPortal()}get isInlineOrMark(){return this.node.value instanceof C_||this.node.value.isInline}get dom(){return this.teleportDOM.firstElementChild||this.teleportDOM}get contentDOM(){if(!(this.node instanceof X_&&this.node.isLeaf))return this.teleportDOM.querySelector("[data-view-content]")||this.dom}renderPortal(){if(!this.teleportDOM)return;const t=this.getPortal();this.addPortal(t,this.key);const e=this.rootInstance.value;e&&e.update()}destroy(){var t,e;null==(e=(t=this.options).destroy)||e.call(t),this.teleportDOM.remove(),this.removePortalByKey(this.key)}ignoreMutation(t){return this.options.ignoreMutation?this.options.ignoreMutation(t):!(this.dom&&this.contentDOM&&!(this.node instanceof X_&&(this.node.isLeaf||this.node.isAtom)))||!("selection"===t.type||this.contentDOM===this.dom||this.contentDOM.contains(t.target))}update(t,e,n){return(()=>{var r,i;if(this.options.update){const s=null==(i=(r=this.options).update)?void 0:i.call(r,t,e,n);if(null!=s)return s}return this.node.value.type===t.type&&(t===this.node.value&&this.decorations.value===e||(this.node.value=t,this.decorations.value=e),!0)})()}};const wU=Symbol("editorInfoCtxKey"),EU=E({name:"MilkdownVueRoot",setup:t=>{const e=_([]),n=l(),r=o(null);S((()=>{r.value=n.ctx._})),T((()=>{r.value=null}));const i=f(((t,n)=>{e.push([n,t])})),s=f((t=>{const n=e.findIndex((e=>e[0]===t));e.splice(n,1)})),a=((t,e,n)=>(r,i={})=>s=>(o,a,l,c)=>new xU(s,r,t,e,n,i,o,a,l,c))(r,i,s);k(uU,a);const c=Object.hasOwnProperty.call(t.editor,"getInstance"),{getEditorCallback:h,dom:u,editor:d,loading:p}=c?t.editor.editor:t.editor;return A((()=>{t.editorRef})),k(wU,{dom:u,editor:d,loading:p}),()=>{const n=e.map((([t,e])=>C(e,{key:t},null)));return C(fU,{editorRef:t.editorRef,editor:h.value},function(t){return"function"==typeof t||"[object Object]"===Object.prototype.toString.call(t)&&!M(t)}(n)?n:{default:()=>[n]})}}});EU.props=["editor","editorRef"];const _U=t=>{const e=o(null),n=o(),r=o(!0);return{loading:r,getInstance:()=>n.value,getDom:()=>e.value,editor:{getEditorCallback:o(((...e)=>t(...e))),dom:e,editor:n,loading:r}}};AL("Indent");const SU=tN(((t,e)=>({prosePlugins:()=>{const n={type:"tab",size:4,...null!=e?e:{}};return t.themeManager.onFlush((()=>{((t,e)=>{"tab"===t.type&&e.getStyle((({injectGlobal:e})=>e`
                .milkdown {
                    tab-size: ${t.size};
                }
            `))})(n,t)})),[wP({Tab:(t,e)=>{const{tr:r}=t,i=((t,e)=>{const{doc:n,selection:r}=t;if(!n||!r||!(r instanceof ak||r instanceof uk))return t;const{to:i}=r,s="space"===e.type?Array(e.size).fill(" ").join(""):"\t";return t.insertText(s,i)})(r,n);return!!i.docChanged&&(null==e||e(i),!0)}})]}}))),TU=EF.create([SU()]),kU=new Tk("MILKDOWN_TRAILING"),AU=tN(((t,e)=>({prosePlugins:()=>{var t;const n=null!=(t=null==e?void 0:e.shouldAppend)?t:t=>!(!t||["heading","paragraph"].includes(t.type.name)),r=new Ek({key:kU,state:{init:(t,e)=>{const r=e.tr.doc.lastChild;return n(r,e)},apply:(t,e,r,i)=>{if(!t.docChanged)return e;const s=t.doc.lastChild;return n(s,i)}},appendTransaction:(t,n,i)=>{var s,o,a;const{doc:l,tr:c,schema:h}=i,u=null!=(a=null==(s=null==e?void 0:e.getNode)?void 0:s.call(e,i))?a:null==(o=h.nodes.paragraph)?void 0:o.create(),d=r.getState(i),f=l.content.size;if(d&&u)return c.insert(f,u)}});return[r]}}))),CU=EF.create([AU()]);function RU(t={}){return new Ek({view:e=>new MU(e,t)})}class MU{constructor(t,e){var n;this.editorView=t,this.cursorPos=null,this.element=null,this.timeout=-1,this.width=null!==(n=e.width)&&void 0!==n?n:1,this.color=!1===e.color?void 0:e.color||"black",this.class=e.class,this.handlers=["dragover","dragend","drop","dragleave"].map((e=>{let n=t=>{this[e](t)};return t.dom.addEventListener(e,n),{name:e,handler:n}}))}destroy(){this.handlers.forEach((({name:t,handler:e})=>this.editorView.dom.removeEventListener(t,e)))}update(t,e){null!=this.cursorPos&&e.doc!=t.state.doc&&(this.cursorPos>t.state.doc.content.size?this.setCursor(null):this.updateOverlay())}setCursor(t){t!=this.cursorPos&&(this.cursorPos=t,null==t?(this.element.parentNode.removeChild(this.element),this.element=null):this.updateOverlay())}updateOverlay(){let t,e=this.editorView.state.doc.resolve(this.cursorPos),n=!e.parent.inlineContent;if(n){let n=e.nodeBefore,r=e.nodeAfter;if(n||r){let e=this.editorView.nodeDOM(this.cursorPos-(n?n.nodeSize:0));if(e){let i=e.getBoundingClientRect(),s=n?i.bottom:i.top;n&&r&&(s=(s+this.editorView.nodeDOM(this.cursorPos).getBoundingClientRect().top)/2),t={left:i.left,right:i.right,top:s-this.width/2,bottom:s+this.width/2}}}}if(!t){let e=this.editorView.coordsAtPos(this.cursorPos);t={left:e.left-this.width/2,right:e.left+this.width/2,top:e.top,bottom:e.bottom}}let r,i,s=this.editorView.dom.offsetParent;if(this.element||(this.element=s.appendChild(document.createElement("div")),this.class&&(this.element.className=this.class),this.element.style.cssText="position: absolute; z-index: 50; pointer-events: none;",this.color&&(this.element.style.backgroundColor=this.color)),this.element.classList.toggle("prosemirror-dropcursor-block",n),this.element.classList.toggle("prosemirror-dropcursor-inline",!n),!s||s==document.body&&"static"==getComputedStyle(s).position)r=-pageXOffset,i=-pageYOffset;else{let t=s.getBoundingClientRect();r=t.left-s.scrollLeft,i=t.top-s.scrollTop}this.element.style.left=t.left-r+"px",this.element.style.top=t.top-i+"px",this.element.style.width=t.right-t.left+"px",this.element.style.height=t.bottom-t.top+"px"}scheduleRemoval(t){clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.setCursor(null)),t)}dragover(t){if(!this.editorView.editable)return;let e=this.editorView.posAtCoords({left:t.clientX,top:t.clientY}),n=e&&e.inside>=0&&this.editorView.state.doc.nodeAt(e.inside),r=n&&n.type.spec.disableDropCursor,i="function"==typeof r?r(this.editorView,e,t):r;if(e&&!i){let t=e.pos;if(this.editorView.dragging&&this.editorView.dragging.slice){let e=jT(this.editorView.state.doc,t,this.editorView.dragging.slice);null!=e&&(t=e)}this.setCursor(t),this.scheduleRemoval(5e3)}}dragend(){this.scheduleRemoval(20)}drop(){this.scheduleRemoval(20)}dragleave(t){t.target!=this.editorView.dom&&this.editorView.dom.contains(t.relatedTarget)||this.setCursor(null)}}class IU extends rk{constructor(t){super(t,t)}map(t,e){let n=t.resolve(e.map(this.head));return IU.valid(n)?new IU(n):rk.near(n)}content(){return M_.empty}eq(t){return t instanceof IU&&t.head==this.head}toJSON(){return{type:"gapcursor",pos:this.head}}static fromJSON(t,e){if("number"!=typeof e.pos)throw new RangeError("Invalid input for GapCursor.fromJSON");return new IU(t.resolve(e.pos))}getBookmark(){return new DU(this.anchor)}static valid(t){let e=t.parent;if(e.isTextblock||!function(t){for(let e=t.depth;e>=0;e--){let n=t.index(e),r=t.node(e);if(0!=n)for(let t=r.child(n-1);;t=t.lastChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t)||!function(t){for(let e=t.depth;e>=0;e--){let n=t.indexAfter(e),r=t.node(e);if(n!=r.childCount)for(let t=r.child(n);;t=t.firstChild){if(0==t.childCount&&!t.inlineContent||t.isAtom||t.type.spec.isolating)return!0;if(t.inlineContent)return!1}else if(r.type.spec.isolating)return!0}return!0}(t))return!1;let n=e.type.spec.allowGapCursor;if(null!=n)return n;let r=e.contentMatchAt(t.index()).defaultType;return r&&r.isTextblock}static findGapCursorFrom(t,e,n=!1){t:for(;;){if(!n&&IU.valid(t))return t;let r=t.pos,i=null;for(let n=t.depth;;n--){let s=t.node(n);if(e>0?t.indexAfter(n)<s.childCount:t.index(n)>0){i=s.child(e>0?t.indexAfter(n):t.index(n)-1);break}if(0==n)return null;r+=e;let o=t.doc.resolve(r);if(IU.valid(o))return o}for(;;){let s=e>0?i.firstChild:i.lastChild;if(!s){if(i.isAtom&&!i.isText&&!ck.isSelectable(i)){t=t.doc.resolve(r+i.nodeSize*e),n=!1;continue t}break}i=s,r+=e;let o=t.doc.resolve(r);if(IU.valid(o))return o}return null}}}IU.prototype.visible=!1,IU.findFrom=IU.findGapCursorFrom,rk.jsonID("gapcursor",IU);class DU{constructor(t){this.pos=t}map(t){return new DU(t.map(this.pos))}resolve(t){let e=t.resolve(this.pos);return IU.valid(e)?new IU(e):rk.near(e)}}const OU=EP({ArrowLeft:PU("horiz",-1),ArrowRight:PU("horiz",1),ArrowUp:PU("vert",-1),ArrowDown:PU("vert",1)});function PU(t,e){const n="vert"==t?e>0?"down":"up":e>0?"right":"left";return function(t,r,i){let s=t.selection,o=e>0?s.$to:s.$from,a=s.empty;if(s instanceof ak){if(!i.endOfTextblock(n)||0==o.depth)return!1;a=!1,o=t.doc.resolve(e>0?o.after():o.before())}let l=IU.findGapCursorFrom(o,e,a);return!!l&&(r&&r(t.tr.setSelection(new IU(l))),!0)}}function LU(t,e,n){if(!t||!t.editable)return!1;let r=t.state.doc.resolve(e);if(!IU.valid(r))return!1;let i=t.posAtCoords({left:n.clientX,top:n.clientY});return!(i&&i.inside>-1&&ck.isSelectable(t.state.doc.nodeAt(i.inside)))&&(t.dispatch(t.state.tr.setSelection(new IU(r))),!0)}function FU(t,e){if("insertCompositionText"!=e.inputType||!(t.state.selection instanceof IU))return!1;let{$from:n}=t.state.selection,r=n.parent.contentMatchAt(n.index()).findWrapping(t.state.schema.nodes.text);if(!r)return!1;let i=S_.empty;for(let o=r.length-1;o>=0;o--)i=S_.from(r[o].createAndFill(null,i));let s=t.state.tr.replace(n.pos,n.pos,new M_(i,0,0));return s.setSelection(ak.near(s.doc.resolve(n.pos+1))),t.dispatch(s),!1}function NU(t){if(!(t.selection instanceof IU))return null;let e=document.createElement("div");return e.className="ProseMirror-gapcursor",BD.create(t.doc,[LD.widget(t.selection.head,e,{key:"gapcursor"})])}const BU=tN((({getStyle:t,themeManager:e})=>(e.onFlush((()=>{t((({injectGlobal:t})=>{t`
                /* copy from https://github.com/ProseMirror/prosemirror-gapcursor/blob/master/style/gapcursor.css */
                .ProseMirror-gapcursor {
                    display: none;
                    pointer-events: none;
                    position: absolute;
                    margin: 0 !important;
                }

                .ProseMirror-gapcursor:after {
                    content: '';
                    display: block;
                    position: absolute;
                    top: -2px;
                    width: 20px;
                    border-top: ${e.get(v_,"lineWidth")} solid
                        ${e.get(o_,["secondary"])};
                    animation: ProseMirror-cursor-blink 1.1s steps(2, start) infinite;
                }

                @keyframes ProseMirror-cursor-blink {
                    to {
                        visibility: hidden;
                    }
                }

                .ProseMirror-focused .ProseMirror-gapcursor {
                    display: block;
                }
            `}))})),{prosePlugins:(t,e)=>{var n,r;const i=e.get(i_),s=i.get(v_,"lineWidth"),o=i.get(o_,["secondary"]),a=Number(null!=(r=null==(n=null==s?void 0:s.match(/\d+/))?void 0:n[0])?r:1);return[new Ek({props:{decorations:NU,createSelectionBetween:(t,e,n)=>e.pos==n.pos&&IU.valid(n)?new IU(n):null,handleClick:LU,handleKeyDown:OU,handleDOMEvents:{beforeinput:FU}}}),RU({color:o,width:a})]}})))();var UU=Object.defineProperty,VU=(t,e,n)=>(((t,e,n)=>{e in t?UU(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);class jU{constructor(){VU(this,"beforeMountedListeners",[]),VU(this,"mountedListeners",[]),VU(this,"updatedListeners",[]),VU(this,"markdownUpdatedListeners",[]),VU(this,"blurListeners",[]),VU(this,"focusListeners",[]),VU(this,"destroyListeners",[]),VU(this,"beforeMount",(t=>(this.beforeMountedListeners.push(t),this))),VU(this,"mounted",(t=>(this.mountedListeners.push(t),this))),VU(this,"updated",(t=>(this.updatedListeners.push(t),this)))}get listeners(){return{beforeMounted:this.beforeMountedListeners,mounted:this.mountedListeners,updated:this.updatedListeners,markdownUpdated:this.markdownUpdatedListeners,blur:this.blurListeners,focus:this.focusListeners,destroy:this.destroyListeners}}markdownUpdated(t){return this.markdownUpdatedListeners.push(t),this}blur(t){return this.blurListeners.push(t),this}focus(t){return this.focusListeners.push(t),this}destroy(t){return this.destroyListeners.push(t),this}}const zU=pw(new jU,"listener"),GU=new Tk("MILKDOWN_LISTENER"),WU=t=>(t.inject(zU,new jU),async t=>{await t.wait(FP);const e=t.get(zU),{listeners:n}=e;n.beforeMounted.forEach((e=>e(t))),await t.wait(sL);const r=t.get(rL);let i=null,s=null;const o=new Ek({key:GU,view:()=>({destroy:()=>{n.destroy.forEach((e=>e(t)))}}),props:{handleDOMEvents:{focus:()=>(n.focus.forEach((e=>e(t))),!1),blur:()=>(n.blur.forEach((e=>e(t))),!1)}},state:{init:()=>{},apply:e=>{if(!e.docChanged)return;const{doc:o}=e;if(n.updated.length>0&&(null==i||!i.eq(o))&&n.updated.forEach((e=>{e(t,o,i)})),n.markdownUpdated.length>0&&(null==i||!i.eq(o))){const i=r(e.doc);(null==s||s!==i)&&(n.markdownUpdated.forEach((e=>{e(t,i,s)})),s=i)}i=o}}});t.update(VP,(t=>t.concat(o))),await t.wait(xL),n.mounted.forEach((e=>e(t)))}),HU={}.hasOwnProperty;function $U(t){return String(t||"").toUpperCase()}function YU(){return t=>{const e=function(t){const e=Object.create(null);if(!t||!t.type)throw new Error("mdast-util-definitions expected node");return VC(t,"definition",(t=>{const n=$U(t.identifier);n&&!HU.call(e,n)&&(e[n]=t)})),function(t){const n=$U(t);return n&&HU.call(e,n)?e[n]:null}}(t);VC(t,((t,n,r)=>{if("definition"===t.type&&null!==r&&"number"==typeof n)return r.children.splice(n,1),[BC,n];if("imageReference"===t.type||"linkReference"===t.type){const i=e(t.identifier);if(i&&null!==r&&"number"==typeof n){const e="imageReference"===t.type?{type:"image",url:i.url,title:i.title,alt:t.alt}:{type:"link",url:i.url,title:i.title,children:t.children};return r.children[n]=e,[BC,n]}}}))}}const XU={HardBreak:"HardBreak",Blockquote:"Blockquote",BulletList:"BulletList",OrderedList:"OrderedList",CodeFence:"CodeFence",H1:"H1",H2:"H2",H3:"H3",H4:"H4",H5:"H5",H6:"H6",DowngradeHeading:"DowngradeHeading",Text:"Text",CodeInline:"CodeInline",Em:"Em",Bold:"Bold",NextListItem:"NextListItem",SinkListItem:"SinkListItem",LiftListItem:"LiftListItem"},qU="code_inline",KU=AL("ToggleInlineCode"),ZU=JF((t=>({id:qU,schema:()=>({priority:100,code:!0,inclusive:!1,parseDOM:[{tag:"code"}],toDOM:e=>["code",{class:t.getClassName(e.attrs,"code-inline")}],parseMarkdown:{match:t=>"inlineCode"===t.type,runner:(t,e,n)=>{t.openMark(n),t.addText(e.value),t.closeMark(n)}},toMarkdown:{match:t=>t.type.name===qU,runner:(t,e,n)=>{t.withMark(e,"inlineCode",n.text||"")}}}),commands:t=>[kL(KU,(()=>(e,n)=>{const{selection:r,tr:i}=e;if(r.empty)return!1;const{from:s,to:o}=r;return e.doc.rangeHasMark(s,o,t)?(null==n||n(i.removeMark(s,o,t)),!0):(Object.keys(e.schema.marks).filter((e=>e!==t.name)).map((t=>e.schema.marks[t])).forEach((t=>{i.removeMark(s,o,t)})),null==n||n(i.addMark(s,o,t.create())),!0)}))],shortcuts:{[XU.CodeInline]:TF(KU,"Mod-e")}}))),JU="em",QU=AL("ToggleItalic"),tV=JF((t=>({id:JU,schema:()=>({inclusive:!1,parseDOM:[{tag:"i"},{tag:"em"},{style:"font-style",getAttrs:t=>"italic"===t}],toDOM:e=>["em",{class:t.getClassName(e.attrs,JU)}],parseMarkdown:{match:t=>"emphasis"===t.type,runner:(t,e,n)=>{t.openMark(n),t.next(e.children),t.closeMark(n)}},toMarkdown:{match:t=>t.type.name===JU,runner:(t,e)=>{t.withMark(e,"emphasis")}}}),commands:t=>[kL(QU,(()=>sP(t)))],shortcuts:{[XU.Em]:TF(QU,"Mod-i")}}))),eV=new Tk("MILKDOWN_LINK_INPUT"),nV=AL("ToggleLink"),rV=AL("ModifyLink"),iV="link",sV=JF(((t,e)=>({id:iV,schema:()=>({attrs:{href:{},title:{default:null}},parseDOM:[{tag:"a[href]",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{href:t.getAttribute("href"),title:t.getAttribute("title")}}}],toDOM:e=>["a",{...e.attrs,class:t.getClassName(e.attrs,iV)}],parseMarkdown:{match:t=>"link"===t.type,runner:(t,e,n)=>{const r=e.url,i=e.title;t.openMark(n,{href:r,title:i}),t.next(e.children),t.closeMark(n)}},toMarkdown:{match:t=>t.type.name===iV,runner:(t,e)=>{t.withMark(e,"link",void 0,{title:e.attrs.title,url:e.attrs.href})}}}),commands:t=>[kL(nV,((e="")=>sP(t,{href:e}))),kL(rV,((e="")=>(n,r)=>{var i;if(!r)return!1;const{marks:s}=n.schema;let o,a=-1;const{selection:l}=n,{from:c,to:h}=l;if(n.doc.nodesBetween(c,c===h?h+1:h,((t,e)=>{var n;if(null!=(n=s.link)&&n.isInSet(t.marks))return o=t,a=e,!1})),!o)return!1;const u=o.marks.find((({type:e})=>e===t));if(!u)return!1;const d=a,f=a+o.nodeSize,{tr:p}=n,m=null==(i=s.link)?void 0:i.create({...u.attrs,href:e});return!!m&&(r(p.removeMark(d,f,u).addMark(d,f,m).setSelection(new ak(p.selection.$anchor)).scrollIntoView()),!0)}))],prosePlugins:(n,r)=>{let i=!1;return[new Ek({key:eV,view:s=>{var o,a,l;const c=t.themeManager.get("input-chip",{placeholder:null!=(a=null==(o=null==e?void 0:e.input)?void 0:o.placeholder)?a:"Input Web Link",buttonText:null==(l=null==e?void 0:e.input)?void 0:l.buttonText,onUpdate:t=>{r.get(CL).call(rV,t)},calculatePosition:(t,e)=>{UO(t,e,((e,n,r,s)=>{const o=t.dom.parentElement;if(!o)throw iw();const a=n.left-e.left;let l=e.left-s.left-(r.width-a)/2,c=e.bottom-s.top+14+o.scrollTop;i&&(c=e.top-s.top-r.height-14+o.scrollTop),l<0&&(l=0);const h=o.clientWidth-(r.width+4);return l>h&&(l=h),[c,l]}))}});if(!c)return{};const h=t=>{t.editable&&((t=>{var r;const{selection:s,doc:o}=t.state,{from:a,to:l}=s;if(!t.hasFocus())return!1;if(s instanceof ak&&l<o.content.size&&a<o.content.size&&o.rangeHasMark(a,a===l?l+1:l,n)){let t=s.empty;if((null==(r=null==e?void 0:e.input)?void 0:r.displayWhenSelected)&&!t&&o.nodesBetween(a,a===l?l+1:l,((e,r)=>{if(e.marks.some((t=>t.type===n&&a>=r&&l<=r+e.nodeSize)))return t=!0,!1})),t)return i=!1,!0}if(s instanceof ck){const{node:t}=s;if("image"===t.type.name&&t.marks.findIndex((t=>t.type.name===iV))>-1)return i=!0,!0}return!1})(t)?(c.show(t),c.update((t=>{const{selection:e}=t.state;let r;const{from:i,to:s}=e;if(t.state.doc.nodesBetween(i,i===s?s+1:s,(t=>{if(n.isInSet(t.marks))return r=t,!1})),!r)return;const o=r.marks.find((t=>t.type===n));return o?o.attrs.href:void 0})(t))):c.hide())};return c.init(s),h(s),{update:(t,e)=>{(null==e?void 0:e.doc.eq(t.state.doc))&&e.selection.eq(t.state.selection)||requestAnimationFrame((()=>{h(t)}))},destroy:()=>{c.destroy()}}}})]}}))),oV="strong",aV=AL("ToggleBold"),lV=JF((t=>({id:oV,schema:()=>({inclusive:!1,parseDOM:[{tag:"b"},{tag:"strong"},{style:"font-style",getAttrs:t=>"bold"===t}],toDOM:e=>["strong",{class:t.getClassName(e.attrs,oV)}],parseMarkdown:{match:t=>"strong"===t.type,runner:(t,e,n)=>{t.openMark(n),t.next(e.children),t.closeMark(n)}},toMarkdown:{match:t=>t.type.name===oV,runner:(t,e)=>{t.withMark(e,"strong")}}}),commands:t=>[kL(aV,(()=>sP(t)))],shortcuts:{[XU.Bold]:TF(aV,"Mod-b")}}))),cV=[ZU(),tV(),lV(),sV()],hV="blockquote",uV=AL("WrapInBlockquote"),dV=QF((t=>({id:hV,schema:()=>({content:"block+",group:"block",defining:!0,parseDOM:[{tag:"blockquote"}],toDOM:e=>["blockquote",{class:t.getClassName(e.attrs,hV)},0],parseMarkdown:{match:({type:t})=>t===hV,runner:(t,e,n)=>{t.openNode(n).next(e.children).closeNode()}},toMarkdown:{match:t=>t.type.name===hV,runner:(t,e)=>{t.openNode("blockquote").next(e.content).closeNode()}}}),inputRules:t=>[fO(/^\s*>\s$/,t)],commands:t=>[kL(uV,(()=>rP(t)))],shortcuts:{[XU.Blockquote]:TF(uV,"Mod-Shift-b")}}))),fV=AL("WrapInBulletList"),pV=QF((t=>{const e="bullet_list";return{id:e,schema:()=>({content:"listItem+",group:"block",attrs:{spread:{default:!1}},parseDOM:[{tag:"ul",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{spread:t.dataset.spread}}}],toDOM:e=>["ul",{"data-spread":e.attrs.spread,class:t.getClassName(e.attrs,"bullet-list")},0],parseMarkdown:{match:({type:t,ordered:e})=>"list"===t&&!e,runner:(t,e,n)=>{const r=null!=e.spread?`${e.spread}`:"false";t.openNode(n,{spread:r}).next(e.children).closeNode()}},toMarkdown:{match:t=>t.type.name===e,runner:(t,e)=>{t.openNode("list",void 0,{ordered:!1,spread:"true"===e.attrs.spread}).next(e.content).closeNode()}}}),inputRules:t=>[fO(/^\s*([-+*])\s$/,t)],commands:t=>[kL(fV,(()=>rP(t)))],shortcuts:{[XU.BulletList]:TF(fV,"Mod-Alt-8")}}})),mV=["","javascript","typescript","bash","sql","json","html","css","c","cpp","java","ruby","python","go","rust","markdown"],gV=/^```(?<language>[a-z]*)?[\s\n]$/,vV=/^~~~(?<language>[a-z]*)?[\s\n]$/,yV=AL("TurnIntoCodeFence"),bV="fence",xV=QF(((t,e)=>{const n=(null==e?void 0:e.languageList)||mV;return{id:bV,schema:e=>({content:"text*",group:"block",marks:"",defining:!0,code:!0,attrs:{language:{default:""},fold:{default:!0}},parseDOM:[{tag:"div.code-fence-container",preserveWhitespace:"full",getAttrs:t=>{var e;if(!(t instanceof HTMLElement))throw nw(t);return{language:null==(e=t.querySelector("pre"))?void 0:e.dataset.language}},getContent:(t,e)=>{var n,r;if(!(t instanceof HTMLElement))throw nw(t);const i=null!=(r=null==(n=t.querySelector("pre"))?void 0:n.textContent)?r:"";if(!i)return S_.empty;const s=e.text(i);return S_.from(s)}},{tag:"pre",preserveWhitespace:"full",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{language:t.dataset.language}}}],toDOM:r=>{const i=document.createElement("select");return n.forEach((t=>{const e=document.createElement("option");e.value=t,e.innerText=t||"--",t===r.attrs.language&&(e.selected=!0),i.appendChild(e)})),i.onchange=t=>{const n=t.target;if(!(n instanceof HTMLSelectElement))return;const i=e.get(mL);if(!i.editable)return void(n.value=r.attrs.language);const{top:s,left:o}=n.getBoundingClientRect(),a=i.posAtCoords({top:s,left:o});if(!a)return;const{tr:l}=i.state;i.dispatch(l.setNodeMarkup(a.inside,void 0,{...r.attrs,language:n.value}))},["div",{class:"code-fence-container"},i,["pre",{"data-language":r.attrs.language,class:t.getClassName(r.attrs,"code-fence")},["code",{spellCheck:"false"},0]]]},parseMarkdown:{match:({type:t})=>"code"===t,runner:(t,e,n)=>{const r=e.lang,i=e.value;t.openNode(n,{language:r}),i&&t.addText(i),t.closeNode()}},toMarkdown:{match:t=>t.type.name===bV,runner:(t,e)=>{var n;t.addNode("code",void 0,(null==(n=e.content.firstChild)?void 0:n.text)||"",{lang:e.attrs.language})}}}),inputRules:t=>[pO(gV,t,(t=>{const[e,n]=t;if(e)return{language:n}})),pO(vV,t,(t=>{const[e,n]=t;if(e)return{language:n}}))],commands:t=>[kL(yV,(()=>iP(t)))],shortcuts:{[XU.CodeFence]:TF(yV,"Mod-Alt-c")},view:()=>(e,r,i)=>{let s=e;const o=t.themeManager.get("code-fence",{view:r,onBlur:()=>{const{tr:t}=r.state;r.dispatch(t.setNodeMarkup(i(),void 0,{...s.attrs,fold:!0}))},onFocus:()=>{const{tr:t}=r.state;r.dispatch(t.setNodeMarkup(i(),void 0,{...s.attrs,fold:!1}))},onSelectLanguage:t=>{const{tr:e}=r.state;r.dispatch(e.setNodeMarkup(i(),void 0,{fold:!0,language:t}))},editable:()=>r.editable,languageList:n});if(!o)return{};const{dom:a,contentDOM:l,onUpdate:c,onDestroy:h}=o;return c(s),{dom:a,contentDOM:l,update:t=>t.type.name===bV&&(s=t,c(s),!0),destroy:h}}}})),wV=QF((()=>({id:"doc",schema:()=>({content:"block+",parseMarkdown:{match:({type:t})=>"root"===t,runner:(t,e,n)=>{t.injectRoot(e,n)}},toMarkdown:{match:t=>"doc"===t.type.name,runner:(t,e)=>{t.openNode("root"),t.next(e.content)}}})}))),EV=AL("InsertHardbreak"),_V=new Tk("MILKDOWN_HARDBREAK_FILTER"),SV=QF(((t,e)=>{var n;const r=null!=(n=null==e?void 0:e.notIn)?n:["table","fence"];return{id:"hardbreak",schema:()=>({inline:!0,group:"inline",selectable:!1,parseDOM:[{tag:"br"}],toDOM:e=>["br",{class:t.getClassName(e.attrs,"hardbreak")}],parseMarkdown:{match:({type:t})=>"break"===t,runner:(t,e,n)=>{t.addNode(n)}},toMarkdown:{match:t=>"hardbreak"===t.type.name,runner:t=>{t.addNode("break")}}}),commands:t=>[kL(EV,(()=>(e,n)=>{var r;const{selection:i,tr:s}=e;if(i.empty){const t=i.$from.node();if(t.childCount>0&&"hardbreak"===(null==(r=t.lastChild)?void 0:r.type.name))return null==n||n(s.replaceRangeWith(i.to-1,i.to,e.schema.node("paragraph")).setSelection(rk.near(s.doc.resolve(i.to))).scrollIntoView()),!0}return null==n||n(s.setMeta("hardbreak",!0).replaceSelectionWith(t.create()).scrollIntoView()),!0}))],shortcuts:{[XU.HardBreak]:TF(EV,"Shift-Enter")},prosePlugins:t=>[new Ek({key:_V,filterTransaction:(t,e)=>{const n=t.getMeta("hardbreak"),[i]=t.steps;if(n&&i){const{from:t}=i,n=e.doc.resolve(t);let s=n.depth,o=!0;for(;s>0;)r.includes(n.node(s).type.name)&&(o=!1),s--;return o}return!0}}),new Ek({key:new Tk("MILKDOWN_HARDBREAK_MARKS"),appendTransaction:(e,n,r)=>{if(!e.length)return;const[i]=e;if(!i)return;const[s]=i.steps;if(i.getMeta("hardbreak")){if(!(s instanceof DT))return;const{from:e}=s;return r.tr.setNodeMarkup(e,t,void 0,[])}if(s instanceof CT){let e=r.tr;const{from:n,to:i}=s;return r.doc.nodesBetween(n,i,((n,r)=>{n.type===t&&(e=e.setNodeMarkup(r,t,void 0,[]))})),e}}})]}})),TV=Array(6).fill(0).map(((t,e)=>e+1)),kV=AL("TurnIntoHeading"),AV=AL("DowngradeHeading"),CV=new Tk("MILKDOWN_HEADING_ID"),RV=new Tk("MILKDOWN_HEADING_HASH"),MV=t=>t.textContent.replace(/[\p{P}\p{S}]/gu,"").replace(/\s/g,"-").toLowerCase().trim(),IV=(t,e,n)=>{let r=!1;const i=(t,i)=>{const s=t.tr.setMeta("addToHistory",!1);let o=!1;t.doc.descendants(((t,i)=>{if(t.type===e&&!r){if(0===t.textContent.trim().length)return;const e=t.attrs,r=n(t);e.id!==r&&(o=!0,s.setMeta(CV,!0).setNodeMarkup(i,void 0,{...e,id:r}))}})),o&&i(s)};return new Ek({key:CV,props:{handleDOMEvents:{compositionstart:()=>(r=!0,!1),compositionend:()=>{r=!1;const e=t.get(mL);return setTimeout((()=>{i(e.state,(t=>e.dispatch(t)))}),0),!1}}},appendTransaction:(t,e,n)=>{let r=null;return t.every((t=>!t.getMeta(CV)))&&t.some((t=>t.docChanged))&&i(n,(t=>{r=t})),r},view:t=>{const e=t.state.doc;let r=t.state.tr.setMeta("addToHistory",!1);return e.descendants(((t,e)=>{"heading"===t.type.name&&t.attrs.level&&(t.attrs.id||(r=r.setNodeMarkup(e,void 0,{...t.attrs,id:n(t)})))})),t.dispatch(r),{}}})},DV=(t,e,n)=>new Ek({key:RV,state:{init:()=>BD.empty,apply:r=>{var i;const s=t.get(mL);if(null==(i=s.hasFocus)||!i.call(s)||!s.editable)return BD.empty;const{$from:o}=r.selection,a=o.node();if(a.type!==e)return BD.empty;const l=a.attrs.level,c=document.createElement("span");c.textContent=Array(l).fill(0).map((t=>"#")).join(""),c.contentEditable="false",n.themeManager.onFlush((()=>{const t=n.getStyle((({css:t})=>t`
                            margin-right: 4px;
                            color: ${x_(n.themeManager)("primary")};
                        `));t&&(c.className=t)}));const h=LD.widget(o.before()+1,c,{side:-1});return BD.create(r.doc,[h])}},props:{handleDOMEvents:{focus:t=>{const e=VO(t.state.tr);return t.dispatch(e),!1}},decorations(t){return this.getState(t)}}}),OV=QF(((t,e)=>{var n,r;const i="heading",s=null!=(n=null==e?void 0:e.getId)?n:MV,o=null==(r=null==e?void 0:e.displayHashtag)||r;return{id:i,schema:()=>({content:"inline*",group:"block",defining:!0,attrs:{id:{default:""},level:{default:1}},parseDOM:TV.map((t=>({tag:`h${t}`,getAttrs:e=>{if(!(e instanceof HTMLElement))throw nw(e);return{level:t,id:e.id}}}))),toDOM:e=>[`h${e.attrs.level}`,{id:e.attrs.id||s(e),class:t.getClassName(e.attrs,`heading h${e.attrs.level}`)},0],parseMarkdown:{match:({type:t})=>t===i,runner:(t,e,n)=>{const r=e.depth;t.openNode(n,{level:r}),t.next(e.children),t.closeNode()}},toMarkdown:{match:t=>t.type.name===i,runner:(t,e)=>{var n;if(t.openNode("heading",void 0,{depth:e.attrs.level}),e.childCount>=1&&"hardbreak"===(null==(n=e.lastChild)?void 0:n.type.name)){const n=[];e.content.forEach(((t,r,i)=>{i!==e.childCount-1&&n.push(t)})),t.next(S_.fromArray(n))}else t.next(e.content);t.closeNode()}}}),inputRules:(t,e)=>TV.map((n=>pO(new RegExp(`^(#{1,${n}})\\s$`),t,(()=>{const t=e.get(mL),{$from:r}=t.state.selection,i=r.node();if("heading"===i.type.name){let t=Number(i.attrs.level)+Number(n);return t>6&&(t=6),{level:t}}return{level:n}})))),commands:(t,e)=>[kL(kV,((n=1)=>n<1?iP(0===n&&e.get(YP).nodes.paragraph||t):iP(0===n&&e.get(YP).nodes.paragraph||t,{level:n}))),kL(AV,(()=>(n,r,i)=>{const{$from:s}=n.selection,o=s.node();if(o.type!==t||!n.selection.empty||0!==s.parentOffset)return!1;const a=o.attrs.level-1;return a?(null==r||r(n.tr.setNodeMarkup(n.selection.$from.before(),void 0,{...o.attrs,level:a})),!0):iP(e.get(YP).nodes.paragraph||t)(n,r,i)}))],shortcuts:{[XU.H1]:TF(kV,"Mod-Alt-1",1),[XU.H2]:TF(kV,"Mod-Alt-2",2),[XU.H3]:TF(kV,"Mod-Alt-3",3),[XU.H4]:TF(kV,"Mod-Alt-4",4),[XU.H5]:TF(kV,"Mod-Alt-5",5),[XU.H6]:TF(kV,"Mod-Alt-6",6),[XU.DowngradeHeading]:TF(AV,["Backspace","Delete"])},prosePlugins:(e,n)=>{const r=[IV(n,e,s)];return o&&r.push(DV(n,e,t)),r}}})),PV="hr",LV=AL("InsertHr"),FV=QF((t=>({id:PV,schema:()=>({group:"block",parseDOM:[{tag:"hr"}],toDOM:e=>["hr",{class:t.getClassName(e.attrs,PV)}],parseMarkdown:{match:({type:t})=>"thematicBreak"===t,runner:(t,e,n)=>{t.addNode(n)}},toMarkdown:{match:t=>t.type.name===PV,runner:t=>{t.addNode("thematicBreak")}}}),inputRules:t=>[new dO(/^(?:---|___\s|\*\*\*\s)$/,((e,n,r,i)=>{const{tr:s}=e;return n[0]&&s.replaceWith(r-1,i,t.create()),s}))],commands:(t,e)=>[kL(LV,(()=>(n,r)=>{if(!r)return!0;const i=e.get(YP).node("paragraph"),{tr:s,selection:o}=n,{from:a}=o,l=t.create();if(!l)return!0;const c=s.replaceSelectionWith(l).insert(a,i),h=rk.findFrom(c.doc.resolve(a),1,!0);return h&&r(c.setSelection(h).scrollIntoView()),!0}))]}))),NV=AL("ModifyImage"),BV=AL("InsertImage"),UV="image",VV=new Tk("MILKDOWN_IMAGE_INPUT"),jV=QF(((t,e)=>({id:"image",schema:()=>({inline:!0,group:"inline",selectable:!0,draggable:!0,marks:"",atom:!0,defining:!0,isolating:!0,attrs:{src:{default:""},alt:{default:""},title:{default:""}},parseDOM:[{tag:"img[src]",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{src:t.getAttribute("src")||"",alt:t.getAttribute("alt")||"",title:t.getAttribute("title")||t.getAttribute("alt")||""}}}],toDOM:e=>["img",{...e.attrs,class:t.getClassName(e.attrs,UV)}],parseMarkdown:{match:({type:t})=>t===UV,runner:(t,e,n)=>{const r=e.url,i=e.alt,s=e.title;t.addNode(n,{src:r,alt:i,title:s})}},toMarkdown:{match:t=>t.type.name===UV,runner:(t,e)=>{t.addNode("image",void 0,void 0,{title:e.attrs.title,url:e.attrs.src,alt:e.attrs.alt})}}}),commands:t=>[kL(BV,((e="")=>(n,r)=>{if(!r)return!0;const{tr:i}=n,s=t.create({src:e});if(!s)return!0;return r(i.replaceSelectionWith(s).scrollIntoView()),!0})),kL(NV,((e="")=>(n,r)=>{const i=WO(n.selection,t);if(!i)return!1;const{tr:s}=n;return null==r||r(s.setNodeMarkup(i.pos,void 0,{...i.node.attrs,loading:!0,src:e}).scrollIntoView()),!0}))],inputRules:t=>[new dO(/!\[(?<alt>.*?)]\((?<filename>.*?)\s*(?="|\))"?(?<title>[^"]+)?"?\)/,((e,n,r,i)=>{const[s,o,a="",l]=n,{tr:c}=e;return s&&c.replaceWith(r,i,t.create({src:a,alt:o,title:l})),c}))],view:()=>n=>{var r,i;let s=n;const o=null!=(r=null==e?void 0:e.placeholder)?r:"Add an Image",a=null!=(i=null==e?void 0:e.isBlock)&&i,l=t.themeManager.get("image",{placeholder:o,isBlock:a});if(!l)return{};const{dom:c,onUpdate:h}=l;return h(s),{dom:c,update:t=>t.type.name===UV&&(s=t,h(s),!0),selectNode:()=>{c.classList.add("ProseMirror-selectednode")},deselectNode:()=>{c.classList.remove("ProseMirror-selectednode")}}},prosePlugins:(n,r)=>[new Ek({key:VV,view:i=>{var s,o,a;const l=t.themeManager.get("input-chip",{placeholder:null!=(o=null==(s=null==e?void 0:e.input)?void 0:s.placeholder)?o:"Input Image Link",buttonText:null==(a=null==e?void 0:e.input)?void 0:a.buttonText,onUpdate:t=>{r.get(CL).call(NV,t)}});if(!l)return{};const c=t=>{t.editable&&((t=>Boolean(t.hasFocus()&&n&&WO(t.state.selection,n)))(t)?(l.show(t),l.update((t=>{const e=WO(t.state.selection,n);return e?e.node.attrs.src:void 0})(t))):l.hide())};return l.init(i),c(i),{update:(t,e)=>{(null==e?void 0:e.doc.eq(t.state.doc))&&e.selection.eq(t.state.selection)||c(t)},destroy:()=>{l.destroy()}}}})]}))),zV="list_item",GV=AL("SplitListItem"),WV=AL("SinkListItem"),HV=AL("LiftListItem"),$V=new Tk("MILKDOWN_KEEP_LIST_ORDER"),YV=t=>new Ek({key:$V,appendTransaction:(e,n,r)=>{let i=null;return e.some((t=>t.docChanged))&&((e,n)=>{const r=zO("ordered_list",e.schema);let i=e.tr;e.doc.descendants(((e,n,s,o)=>{if(e.type===t&&(null==s?void 0:s.type)===r){let r=!1;const a={...e.attrs};"ordered"!==e.attrs.listType&&(a.listType="ordered",r=!0);const l=null==s?void 0:s.maybeChild(0);l&&l.type===t&&"ordered"===l.attrs.listType&&(a.label=`${o+1}.`,r=!0),"•"===e.attrs.label&&(a.label=`${o+1}.`,r=!0),r&&(i=i.setNodeMarkup(n,void 0,a))}})),n(i)})(r,(t=>{i=t})),i}}),XV=QF((t=>({id:zV,schema:()=>({group:"listItem",content:"paragraph block*",attrs:{label:{default:"•"},listType:{default:"bullet"},spread:{default:"true"}},defining:!0,parseDOM:[{tag:"li.list-item",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{label:t.dataset.label,listType:t.dataset["list-type"],spread:t.dataset.spread}},contentElement:t=>{if(!(t instanceof HTMLElement))throw nw(t);return t.querySelector(".list-item_body")||t}},{tag:"li"}],toDOM:e=>["li",{class:t.getClassName(e.attrs,"list-item"),"data-label":e.attrs.label,"data-list-type":e.attrs.listType,"data-spread":e.attrs.spread},["div",{class:t.getClassName(e.attrs,"list-item_label")},e.attrs.label],["div",{class:t.getClassName(e.attrs,"list-item_body")},0]],parseMarkdown:{match:({type:t,checked:e})=>"listItem"===t&&null===e,runner:(t,e,n)=>{const r=null!=e.label?`${e.label}.`:"•",i=null!=e.label?"ordered":"bullet",s=null!=e.spread?`${e.spread}`:"true";t.openNode(n,{label:r,listType:i,spread:s}),t.next(e.children),t.closeNode()}},toMarkdown:{match:t=>t.type.name===zV,runner:(t,e)=>{t.openNode("listItem",void 0,{spread:"true"===e.attrs.spread}),t.next(e.content),t.closeNode()}}}),inputRules:t=>[fO(/^\s*([-+*])\s$/,t)],commands:t=>[kL(GV,(()=>eN(t))),kL(WV,(()=>rN(t))),kL(HV,(()=>nN(t)))],shortcuts:{[XU.NextListItem]:TF(GV,"Enter"),[XU.SinkListItem]:TF(WV,"Mod-]"),[XU.LiftListItem]:TF(HV,"Mod-[")},prosePlugins:t=>[YV(t)]}))),qV=AL("WrapInOrderedList"),KV="ordered_list",ZV=QF((t=>({id:KV,schema:()=>({content:"listItem+",group:"block",attrs:{order:{default:1},spread:{default:!1}},parseDOM:[{tag:"ol",getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{spread:t.dataset.spread,order:t.hasAttribute("start")?Number(t.getAttribute("start")):1}}}],toDOM:e=>["ol",{...1===e.attrs.order?{}:e.attrs.order,"data-spread":e.attrs.spread,class:t.getClassName(e.attrs,"ordered-list")},0],parseMarkdown:{match:({type:t,ordered:e})=>"list"===t&&!!e,runner:(t,e,n)=>{const r=null!=e.spread?`${e.spread}`:"true";t.openNode(n,{spread:r}).next(e.children).closeNode()}},toMarkdown:{match:t=>t.type.name===KV,runner:(t,e)=>{t.openNode("list",void 0,{ordered:!0,start:1,spread:"true"===e.attrs.spread}),t.next(e.content),t.closeNode()}}}),inputRules:t=>[fO(/^(\d+)\.\s$/,t,(t=>({order:Number(t[1])})),((t,e)=>e.childCount+e.attrs.order===Number(t[1])))],commands:t=>[kL(qV,(()=>rP(t)))],shortcuts:{[XU.OrderedList]:TF(qV,"Mod-Alt-7")}}))),JV=AL("TurnIntoText"),QV="paragraph",tj=QF((t=>({id:QV,schema:()=>({content:"inline*",group:"block",parseDOM:[{tag:"p"}],toDOM:e=>["p",{class:t.getClassName(e.attrs,QV)},0],parseMarkdown:{match:t=>"paragraph"===t.type,runner:(t,e,n)=>{t.openNode(n),e.children?t.next(e.children):t.addText(e.value),t.closeNode()}},toMarkdown:{match:t=>"paragraph"===t.type.name,runner:(t,e)=>{var n;if(t.openNode("paragraph"),e.childCount>=1&&"hardbreak"===(null==(n=e.lastChild)?void 0:n.type.name)){const n=[];e.content.forEach(((t,r,i)=>{i!==e.childCount-1&&n.push(t)})),t.next(S_.fromArray(n))}else t.next(e.content);t.closeNode()}}}),commands:t=>[kL(JV,(()=>iP(t)))],shortcuts:{[XU.Text]:TF(JV,"Mod-Alt-0")}}))),ej=QF((()=>({id:"text",schema:()=>({group:"inline",parseMarkdown:{match:({type:t})=>"text"===t,runner:(t,e)=>{t.addText(e.value)}},toMarkdown:{match:t=>"text"===t.type.name,runner:(t,e)=>{t.addNode("text",void 0,e.text)}}})}))),nj=[wV(),tj(),SV(),dV(),xV(),pV(),ZV(),XV(),OV(),FV(),jV(),ej()],rj=()=>function(t){VC(t,"list",(t=>{var e;if(t.ordered){const n=null!=(e=t.start)?e:1;t.children.forEach(((t,e)=>{t.label=e+n}))}}))};const ij=()=>function(t){!function(t,e){(function t(n,r,i){if((t=>!!t.children)(n)){const e=[];for(let r=0,i=n.children.length;r<i;r++){const i=n.children[r];if(i){const s=t(i,r,n);if(s)for(let t=0,n=s.length;t<n;t++){const n=s[t];n&&e.push(n)}}}n.children=e}return e(n,r,i)})(t,0,null)[0]}(t,(t=>(t=>"html"===t.type)(t)?[]:[t]))},sj=new Tk("MILKDOWN_INLINE_NODES_CURSOR"),oj=()=>{let t=!1;const e=new Ek({key:sj,state:{init:()=>!1,apply(t){if(!t.selection.empty)return!1;const e=t.selection.$from,n=e.nodeBefore,r=e.nodeAfter;return!(!(n&&r&&n.isInline&&!n.isText&&r.isInline)||r.isText)}},props:{handleDOMEvents:{compositionend:(n,r)=>!!t&&(t=!1,requestAnimationFrame((()=>{if(e.getState(n.state)){const t=n.state.selection.from;r.preventDefault(),n.dispatch(n.state.tr.insertText(r.data||"",t))}})),!0),compositionstart:n=>(e.getState(n.state)&&(t=!0),!1),beforeinput:(n,r)=>{if(e.getState(n.state)&&r instanceof InputEvent&&r.data&&!t){const t=n.state.selection.from;return r.preventDefault(),n.dispatch(n.state.tr.insertText(r.data||"",t)),!0}return!1}},decorations(t){if(e.getState(t)){const e=t.selection.$from.pos,n=document.createElement("span"),r=LD.widget(e,n,{side:-1}),i=document.createElement("span"),s=LD.widget(e,i);return setTimeout((()=>{n.contentEditable="true",i.contentEditable="true"})),BD.create(t.doc,[r,s])}return BD.empty}}});return e},aj=/\[(?<span>((www|https:\/\/|http:\/\/)[^\s\]]+))]\((?<url>[^\s\]]+)\)/,lj=t=>{let e=t,n=e.match(aj);for(;n&&n.groups;){const{span:t}=n.groups;e=e.replace(aj,t),n=e.match(aj)}return e},cj=(t,e,n)=>{const r=t.split(""),i=r[e];return r[e]&&r[n]&&(r[e]=r[n],r[n]=i),r.join("").toString()},hj=t=>e=>e.replace((t=>new RegExp(`\\\\(?=[^\\w\\s${t}\\\\]|_)`,"g"))(t),""),uj={placeholderConfig:{hole:"∅",punctuation:"⁂",char:"∴"},globalNodes:["footnote_definition"],shouldSyncNode:({prevNode:t,nextNode:e})=>t.inlineContent&&e&&t.type===e.type&&!t.eq(e),movePlaceholder:(t,e)=>{const n=["*","_"];let r=e.indexOf(t);for(;n.includes(e[r-1]||"")&&n.includes(e[r+1]||"");)e=cj(e,r,r+1),r+=1;return e}},dj=pw(uj,"inlineSyncConfig"),fj=t=>t.split("\n\n")[0]||"",pj=(t,e)=>{try{const n=((t,e)=>{const{globalNodes:n}=t.get(dj),r=[];return e.doc.descendants((t=>{if(n.includes(t.type.name)||n.includes(t.type))return r.push(t),!1})),r})(t,e),r=(t=>{const{selection:e}=t,{$from:n}=e;return n.node()})(e),i=((t,e,n,r)=>t.get(rL)(e.schema.topNodeType.create(void 0,[n,...r])))(t,e,r,n),[s,o]=((t,e)=>{const n=t.get(dj),r=n.placeholderConfig.hole,[i="",...s]=e.split("\n\n");let o=RF(hj(r),(t=>n.movePlaceholder(r,t)),lj)(i);const a=(t=>e=>{const n=e.indexOf(t.hole),r=e.charAt(n-1),i=e.charAt(n+1),s=/[^\w]|_/;return i?r&&s.test(r)&&s.test(i)?t.punctuation:t.char:t.punctuation})(n.placeholderConfig)(o);return o=o.replace(r,a),o=[o,...s].join("\n\n"),[o,a]})(t,i),a=((t,e)=>{const n=t.get(QP)(e);return n?n.firstChild:null})(t,s);return a&&r.type===a.type?(a.attrs={...r.attrs},a.descendants((t=>{var e;const n=t.marks.find((t=>"link"===t.type.name));n&&(null==(e=t.text)?void 0:e.includes(o))&&n.attrs.href.includes(o)&&(n.attrs.href=n.attrs.href.replace(o,""))})),{text:fj(s),prevNode:r,nextNode:a,placeholder:o}):null}catch{return null}},mj=new Tk("MILKDOWN_INLINE_SYNC"),gj=t=>{let e=null;return new Ek({key:mj,state:{init:()=>null,apply:(n,r,i,s)=>{var o;const a=t.get(mL);if(null==(o=a.hasFocus)||!o.call(a)||!a.editable||!n.docChanged||n.getMeta(mj))return null;const l=pj(t,s);if(!l)return null;e&&(cancelAnimationFrame(e),e=null);const{prevNode:c,nextNode:h,text:u}=l,{shouldSyncNode:d}=t.get(dj);return d({prevNode:c,nextNode:h,ctx:t,tr:n,text:u})&&(e=requestAnimationFrame((()=>{e=null;const{dispatch:n,state:r}=t.get(mL);((t,e,n,r,i)=>{const{placeholderConfig:s}=t.get(dj),o=s.hole;let a=n.tr.setMeta(e,!0).insertText(o,n.selection.from);const l=n.apply(a),c=pj(t,l);if(!c)return;const{$from:h}=l.selection,u=h.before(),d=h.after(),f=((t,e,n)=>{let r=e,i=!1;return t.descendants((t=>{var e;if(i)return!1;if(t.isText){const s=null==(e=t.text)?void 0:e.indexOf(n);if(null!=s&&s>=0)return i=!0,r+=s,!1}r+=t.nodeSize})),r})(c.nextNode,u,c.placeholder);a=a.replaceWith(u,d,c.nextNode).setNodeMarkup(u,void 0,i).delete(f+1,f+2),a=a.setSelection(ak.near(a.doc.resolve(f+1))),r(a)})(t,mj,r,n,c.attrs)}))),null}}})},vj=[tN((()=>({injectSlices:[dj],prosePlugins:(t,e)=>[oj(),gj(e)],remarkPlugins:()=>[YU,ij,rj]})))()],yj=EF.create([...nj,...cV]),bj=EF.create([...vj,...yj]),xj={tokenize:function(t,e,n){let r=0;return function e(s){if((87===s||119===s)&&r<3)return r++,t.consume(s),e;if(46===s&&3===r)return t.consume(s),i;return n(s)};function i(t){return null===t?n(t):e(t)}},partial:!0},wj={tokenize:function(t,e,n){let r,i,s;return o;function o(e){return 46===e||95===e?t.check(_j,l,a)(e):null===e||Wk(e)||Yk(e)||45!==e&&$k(e)?l(e):(s=!0,t.consume(e),o)}function a(e){return 95===e?r=!0:(i=r,r=void 0),t.consume(e),o}function l(t){return i||r||!s?n(t):e(t)}},partial:!0},Ej={tokenize:function(t,e){let n=0,r=0;return i;function i(o){return 40===o?(n++,t.consume(o),i):41===o&&r<n?s(o):33===o||34===o||38===o||39===o||41===o||42===o||44===o||46===o||58===o||59===o||60===o||63===o||93===o||95===o||126===o?t.check(_j,e,s)(o):null===o||Wk(o)||Yk(o)?e(o):(t.consume(o),i)}function s(e){return 41===e&&r++,t.consume(e),i}},partial:!0},_j={tokenize:function(t,e,n){return r;function r(o){return 33===o||34===o||39===o||41===o||42===o||44===o||46===o||58===o||59===o||63===o||95===o||126===o?(t.consume(o),r):38===o?(t.consume(o),s):93===o?(t.consume(o),i):60===o||null===o||Wk(o)||Yk(o)?e(o):n(o)}function i(t){return null===t||40===t||91===t||Wk(t)||Yk(t)?e(t):r(t)}function s(t){return Fk(t)?o(t):n(t)}function o(e){return 59===e?(t.consume(e),r):Fk(e)?(t.consume(e),o):n(e)}},partial:!0},Sj={tokenize:function(t,e,n){return function(e){return t.consume(e),r};function r(t){return Nk(t)?n(t):e(t)}},partial:!0},Tj={tokenize:function(t,e,n){const r=this;return function(e){if(87!==e&&119!==e||!Ij.call(r,r.previous)||Lj(r.events))return n(e);return t.enter("literalAutolink"),t.enter("literalAutolinkWww"),t.check(xj,t.attempt(wj,t.attempt(Ej,i),n),n)(e)};function i(n){return t.exit("literalAutolinkWww"),t.exit("literalAutolink"),e(n)}},previous:Ij},kj={tokenize:function(t,e,n){const r=this;let i="",s=!1;return function(e){if((72===e||104===e)&&Dj.call(r,r.previous)&&!Lj(r.events))return t.enter("literalAutolink"),t.enter("literalAutolinkHttp"),i+=String.fromCodePoint(e),t.consume(e),o;return n(e)};function o(e){if(Fk(e)&&i.length<5)return i+=String.fromCodePoint(e),t.consume(e),o;if(58===e){const n=i.toLowerCase();if("http"===n||"https"===n)return t.consume(e),a}return n(e)}function a(e){return 47===e?(t.consume(e),s?l:(s=!0,a)):n(e)}function l(e){return null===e||Uk(e)||Wk(e)||Yk(e)||$k(e)?n(e):t.attempt(wj,t.attempt(Ej,c),n)(e)}function c(n){return t.exit("literalAutolinkHttp"),t.exit("literalAutolink"),e(n)}},previous:Dj},Aj={tokenize:function(t,e,n){const r=this;let i,s;return function(e){if(!Pj(e)||!Oj.call(r,r.previous)||Lj(r.events))return n(e);return t.enter("literalAutolink"),t.enter("literalAutolinkEmail"),o(e)};function o(e){return Pj(e)?(t.consume(e),o):64===e?(t.consume(e),a):n(e)}function a(e){return 46===e?t.check(Sj,c,l)(e):45===e||95===e||Nk(e)?(s=!0,t.consume(e),a):c(e)}function l(e){return t.consume(e),i=!0,a}function c(o){return s&&i&&Fk(r.previous)?(t.exit("literalAutolinkEmail"),t.exit("literalAutolink"),e(o)):n(o)}},previous:Oj},Cj={},Rj={text:Cj};let Mj=48;for(;Mj<123;)Cj[Mj]=Aj,Mj++,58===Mj?Mj=65:91===Mj&&(Mj=97);function Ij(t){return null===t||40===t||42===t||95===t||91===t||93===t||126===t||Wk(t)}function Dj(t){return!Fk(t)}function Oj(t){return!(47===t||Pj(t))}function Pj(t){return 43===t||45===t||46===t||95===t||Nk(t)}function Lj(t){let e=t.length,n=!1;for(;e--;){const r=t[e][1];if(("labelLink"===r.type||"labelImage"===r.type)&&!r._balanced){n=!0;break}if(r._gfmAutolinkLiteralWalkedInto){n=!1;break}}return t.length>0&&!n&&(t[t.length-1][1]._gfmAutolinkLiteralWalkedInto=!0),n}Cj[43]=Aj,Cj[45]=Aj,Cj[46]=Aj,Cj[95]=Aj,Cj[72]=[Aj,kj],Cj[104]=[Aj,kj],Cj[87]=[Aj,Tj],Cj[119]=[Aj,Tj];const Fj={tokenize:function(t,e,n){const r=this;return qk(t,(function(t){const i=r.events[r.events.length-1];return i&&"gfmFootnoteDefinitionIndent"===i[1].type&&4===i[2].sliceSerialize(i[1],!0).length?e(t):n(t)}),"gfmFootnoteDefinitionIndent",5)},partial:!0};function Nj(t,e,n){const r=this;let i=r.events.length;const s=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let o;for(;i--;){const t=r.events[i][1];if("labelImage"===t.type){o=t;break}if("gfmFootnoteCall"===t.type||"labelLink"===t.type||"label"===t.type||"image"===t.type||"link"===t.type)break}return function(i){if(!o||!o._balanced)return n(i);const a=_A(r.sliceSerialize({start:o.end,end:r.now()}));if(94!==a.codePointAt(0)||!s.includes(a.slice(1)))return n(i);return t.enter("gfmFootnoteCallLabelMarker"),t.consume(i),t.exit("gfmFootnoteCallLabelMarker"),e(i)}}function Bj(t,e){let n=t.length;for(;n--;)if("labelImage"===t[n][1].type&&"enter"===t[n][0]){t[n][1];break}t[n+1][1].type="data",t[n+3][1].type="gfmFootnoteCallLabelMarker";const r={type:"gfmFootnoteCall",start:Object.assign({},t[n+3][1].start),end:Object.assign({},t[t.length-1][1].end)},i={type:"gfmFootnoteCallMarker",start:Object.assign({},t[n+3][1].end),end:Object.assign({},t[n+3][1].end)};i.end.column++,i.end.offset++,i.end._bufferIndex++;const s={type:"gfmFootnoteCallString",start:Object.assign({},i.end),end:Object.assign({},t[t.length-1][1].start)},o={type:"chunkString",contentType:"string",start:Object.assign({},s.start),end:Object.assign({},s.end)},a=[t[n+1],t[n+2],["enter",r,e],t[n+3],t[n+4],["enter",i,e],["exit",i,e],["enter",s,e],["enter",o,e],["exit",o,e],["exit",s,e],t[t.length-2],t[t.length-1],["exit",r,e]];return t.splice(n,t.length-n+1,...a),t}function Uj(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,o=0;return function(e){return t.enter("gfmFootnoteCall"),t.enter("gfmFootnoteCallLabelMarker"),t.consume(e),t.exit("gfmFootnoteCallLabelMarker"),a};function a(e){return 94!==e?n(e):(t.enter("gfmFootnoteCallMarker"),t.consume(e),t.exit("gfmFootnoteCallMarker"),t.enter("gfmFootnoteCallString"),t.enter("chunkString").contentType="string",l)}function l(a){if(o>999||93===a&&!s||null===a||91===a||Wk(a))return n(a);if(93===a){t.exit("chunkString");const s=t.exit("gfmFootnoteCallString");return i.includes(_A(r.sliceSerialize(s)))?(t.enter("gfmFootnoteCallLabelMarker"),t.consume(a),t.exit("gfmFootnoteCallLabelMarker"),t.exit("gfmFootnoteCall"),e):n(a)}return Wk(a)||(s=!0),o++,t.consume(a),92===a?c:l}function c(e){return 91===e||92===e||93===e?(t.consume(e),o++,l):l(e)}}function Vj(t,e,n){const r=this,i=r.parser.gfmFootnotes||(r.parser.gfmFootnotes=[]);let s,o,a=0;return function(e){return t.enter("gfmFootnoteDefinition")._container=!0,t.enter("gfmFootnoteDefinitionLabel"),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(e),t.exit("gfmFootnoteDefinitionLabelMarker"),l};function l(e){return 94===e?(t.enter("gfmFootnoteDefinitionMarker"),t.consume(e),t.exit("gfmFootnoteDefinitionMarker"),t.enter("gfmFootnoteDefinitionLabelString"),t.enter("chunkString").contentType="string",c):n(e)}function c(e){if(a>999||93===e&&!o||null===e||91===e||Wk(e))return n(e);if(93===e){t.exit("chunkString");const n=t.exit("gfmFootnoteDefinitionLabelString");return s=_A(r.sliceSerialize(n)),t.enter("gfmFootnoteDefinitionLabelMarker"),t.consume(e),t.exit("gfmFootnoteDefinitionLabelMarker"),t.exit("gfmFootnoteDefinitionLabel"),u}return Wk(e)||(o=!0),a++,t.consume(e),92===e?h:c}function h(e){return 91===e||92===e||93===e?(t.consume(e),a++,c):c(e)}function u(e){return 58===e?(t.enter("definitionMarker"),t.consume(e),t.exit("definitionMarker"),i.includes(s)||i.push(s),qk(t,d,"gfmFootnoteDefinitionWhitespace")):n(e)}function d(t){return e(t)}}function jj(t,e,n){return t.check(iA,e,t.attempt(Fj,e,n))}function zj(t){t.exit("gfmFootnoteDefinition")}function Gj(t){let e=(t||{}).singleTilde;const n={tokenize:function(t,n,r){const i=this.previous,s=this.events;let o=0;return function(e){if(126===i&&"characterEscape"!==s[s.length-1][1].type)return r(e);return t.enter("strikethroughSequenceTemporary"),a(e)};function a(s){const l=Qk(i);if(126===s)return o>1?r(s):(t.consume(s),o++,a);if(o<2&&!e)return r(s);const c=t.exit("strikethroughSequenceTemporary"),h=Qk(s);return c._open=!h||2===h&&Boolean(l),c._close=!l||2===l&&Boolean(h),n(s)}},resolveAll:function(t,e){let n=-1;for(;++n<t.length;)if("enter"===t[n][0]&&"strikethroughSequenceTemporary"===t[n][1].type&&t[n][1]._close){let r=n;for(;r--;)if("exit"===t[r][0]&&"strikethroughSequenceTemporary"===t[r][1].type&&t[r][1]._open&&t[n][1].end.offset-t[n][1].start.offset==t[r][1].end.offset-t[r][1].start.offset){t[n][1].type="strikethroughSequence",t[r][1].type="strikethroughSequence";const i={type:"strikethrough",start:Object.assign({},t[r][1].start),end:Object.assign({},t[n][1].end)},s={type:"strikethroughText",start:Object.assign({},t[r][1].end),end:Object.assign({},t[n][1].start)},o=[["enter",i,e],["enter",t[r][1],e],["exit",t[r][1],e],["enter",s,e]],a=e.parser.constructs.insideSpan.null;a&&Mk(o,o.length,0,tA(a,t.slice(r+1,n),e)),Mk(o,o.length,0,[["exit",s,e],["enter",t[n][1],e],["exit",t[n][1],e],["exit",i,e]]),Mk(t,r-1,n-r+3,o),n=r+o.length-2;break}}n=-1;for(;++n<t.length;)"strikethroughSequenceTemporary"===t[n][1].type&&(t[n][1].type="data");return t}};return null==e&&(e=!0),{text:{126:n},insideSpan:{null:[n]},attentionMarkers:{null:[126]}}}class Wj{constructor(){this.map=[]}add(t,e,n){!function(t,e,n,r){let i=0;if(0===n&&0===r.length)return;for(;i<t.map.length;){if(t.map[i][0]===e)return t.map[i][1]+=n,void t.map[i][2].push(...r);i+=1}t.map.push([e,n,r])}(this,t,e,n)}consume(t){if(this.map.sort(((t,e)=>t[0]-e[0])),0===this.map.length)return;let e=this.map.length;const n=[];for(;e>0;)e-=1,n.push(t.slice(this.map[e][0]+this.map[e][1])),n.push(this.map[e][2]),t.length=this.map[e][0];n.push([...t]),t.length=0;let r=n.pop();for(;r;)t.push(...r),r=n.pop();this.map.length=0}}function Hj(t,e){let n=!1;const r=[];for(;e<t.length;){const i=t[e];if(n){if("enter"===i[0])"tableContent"===i[1].type&&r.push("tableDelimiterMarker"===t[e+1][1].type?"left":"none");else if("tableContent"===i[1].type){if("tableDelimiterMarker"===t[e-1][1].type){const t=r.length-1;r[t]="left"===r[t]?"center":"right"}}else if("tableDelimiterRow"===i[1].type)break}else"enter"===i[0]&&"tableDelimiterRow"===i[1].type&&(n=!0);e+=1}return r}const $j={flow:{null:{tokenize:function(t,e,n){const r=this;let i,s=0,o=0;return function(t){let e=r.events.length-1;for(;e>-1;){const t=r.events[e][1].type;if("lineEnding"!==t&&"linePrefix"!==t)break;e--}const i=e>-1?r.events[e][1].type:null,s="tableHead"===i||"tableRow"===i?x:a;if(s===x&&r.parser.lazy[r.now().line])return n(t);return s(t)};function a(e){return t.enter("tableHead"),t.enter("tableRow"),function(t){if(124===t)return l(t);return i=!0,o+=1,l(t)}(e)}function l(e){return null===e?n(e):Gk(e)?o>1?(o=0,r.interrupt=!0,t.exit("tableRow"),t.enter("lineEnding"),t.consume(e),t.exit("lineEnding"),u):n(e):Hk(e)?qk(t,l,"whitespace")(e):(o+=1,i&&(i=!1,s+=1),124===e?(t.enter("tableCellDivider"),t.consume(e),t.exit("tableCellDivider"),i=!0,l):(t.enter("data"),c(e)))}function c(e){return null===e||124===e||Wk(e)?(t.exit("data"),l(e)):(t.consume(e),92===e?h:c)}function h(e){return 92===e||124===e?(t.consume(e),c):c(e)}function u(e){return r.interrupt=!1,r.parser.lazy[r.now().line]?n(e):(t.enter("tableDelimiterRow"),i=!1,Hk(e)?qk(t,d,"linePrefix",r.parser.constructs.disable.null.includes("codeIndented")?void 0:4)(e):d(e))}function d(e){return 45===e||58===e?p(e):124===e?(i=!0,t.enter("tableCellDivider"),t.consume(e),t.exit("tableCellDivider"),f):b(e)}function f(e){return Hk(e)?qk(t,p,"whitespace")(e):p(e)}function p(e){return 58===e?(o+=1,i=!0,t.enter("tableDelimiterMarker"),t.consume(e),t.exit("tableDelimiterMarker"),m):45===e?(o+=1,m(e)):null===e||Gk(e)?y(e):b(e)}function m(e){return 45===e?(t.enter("tableDelimiterFiller"),g(e)):b(e)}function g(e){return 45===e?(t.consume(e),g):58===e?(i=!0,t.exit("tableDelimiterFiller"),t.enter("tableDelimiterMarker"),t.consume(e),t.exit("tableDelimiterMarker"),v):(t.exit("tableDelimiterFiller"),v(e))}function v(e){return Hk(e)?qk(t,y,"whitespace")(e):y(e)}function y(n){return 124===n?d(n):(null===n||Gk(n))&&i&&s===o?(t.exit("tableDelimiterRow"),t.exit("tableHead"),e(n)):b(n)}function b(t){return n(t)}function x(e){return t.enter("tableRow"),w(e)}function w(n){return 124===n?(t.enter("tableCellDivider"),t.consume(n),t.exit("tableCellDivider"),w):null===n||Gk(n)?(t.exit("tableRow"),e(n)):Hk(n)?qk(t,w,"whitespace")(n):(t.enter("data"),E(n))}function E(e){return null===e||124===e||Wk(e)?(t.exit("data"),w(e)):(t.consume(e),92===e?_:E)}function _(e){return 92===e||124===e?(t.consume(e),E):E(e)}},resolveAll:function(t,e){let n,r,i,s=-1,o=!0,a=0,l=[0,0,0,0],c=[0,0,0,0],h=!1,u=0;const d=new Wj;for(;++s<t.length;){const f=t[s],p=f[1];"enter"===f[0]?"tableHead"===p.type?(h=!1,0!==u&&(Xj(d,e,u,n,r),r=void 0,u=0),n={type:"table",start:Object.assign({},p.start),end:Object.assign({},p.end)},d.add(s,0,[["enter",n,e]])):"tableRow"===p.type||"tableDelimiterRow"===p.type?(o=!0,i=void 0,l=[0,0,0,0],c=[0,s+1,0,0],h&&(h=!1,r={type:"tableBody",start:Object.assign({},p.start),end:Object.assign({},p.end)},d.add(s,0,[["enter",r,e]])),a="tableDelimiterRow"===p.type?2:r?3:1):!a||"data"!==p.type&&"tableDelimiterMarker"!==p.type&&"tableDelimiterFiller"!==p.type?"tableCellDivider"===p.type&&(o?o=!1:(0!==l[1]&&(c[0]=c[1],i=Yj(d,e,l,a,void 0,i)),l=c,c=[l[1],s,0,0])):(o=!1,0===c[2]&&(0!==l[1]&&(c[0]=c[1],i=Yj(d,e,l,a,void 0,i),l=[0,0,0,0]),c[2]=s)):"tableHead"===p.type?(h=!0,u=s):"tableRow"===p.type||"tableDelimiterRow"===p.type?(u=s,0!==l[1]?(c[0]=c[1],i=Yj(d,e,l,a,s,i)):0!==c[1]&&(i=Yj(d,e,c,a,s,i)),a=0):!a||"data"!==p.type&&"tableDelimiterMarker"!==p.type&&"tableDelimiterFiller"!==p.type||(c[3]=s)}0!==u&&Xj(d,e,u,n,r);d.consume(e.events),s=-1;for(;++s<e.events.length;){const t=e.events[s];"enter"===t[0]&&"table"===t[1].type&&(t[1]._align=Hj(e.events,s))}return t}}}};function Yj(t,e,n,r,i,s){const o=1===r?"tableHeader":2===r?"tableDelimiter":"tableData";0!==n[0]&&(s.end=Object.assign({},qj(e.events,n[0])),t.add(n[0],0,[["exit",s,e]]));const a=qj(e.events,n[1]);if(s={type:o,start:Object.assign({},a),end:Object.assign({},a)},t.add(n[1],0,[["enter",s,e]]),0!==n[2]){const i=qj(e.events,n[2]),s=qj(e.events,n[3]),o={type:"tableContent",start:Object.assign({},i),end:Object.assign({},s)};if(t.add(n[2],0,[["enter",o,e]]),2!==r){const r=e.events[n[2]],i=e.events[n[3]];if(r[1].end=Object.assign({},i[1].end),r[1].type="chunkText",r[1].contentType="text",n[3]>n[2]+1){const e=n[2]+1,r=n[3]-n[2]-1;t.add(e,r,[])}}t.add(n[3]+1,0,[["exit",o,e]])}return void 0!==i&&(s.end=Object.assign({},qj(e.events,i)),t.add(i,0,[["exit",s,e]]),s=void 0),s}function Xj(t,e,n,r,i){const s=[],o=qj(e.events,n);i&&(i.end=Object.assign({},o),s.push(["exit",i,e])),r.end=Object.assign({},o),s.push(["exit",r,e]),t.add(n+1,0,s)}function qj(t,e){const n=t[e],r="enter"===n[0]?"start":"end";return n[1][r]}const Kj={text:{91:{tokenize:function(t,e,n){const r=this;return function(e){if(null!==r.previous||!r._gfmTasklistFirstContentOfListItem)return n(e);return t.enter("taskListCheck"),t.enter("taskListCheckMarker"),t.consume(e),t.exit("taskListCheckMarker"),i};function i(e){return Wk(e)?(t.enter("taskListCheckValueUnchecked"),t.consume(e),t.exit("taskListCheckValueUnchecked"),s):88===e||120===e?(t.enter("taskListCheckValueChecked"),t.consume(e),t.exit("taskListCheckValueChecked"),s):n(e)}function s(e){return 93===e?(t.enter("taskListCheckMarker"),t.consume(e),t.exit("taskListCheckMarker"),t.exit("taskListCheck"),o):n(e)}function o(r){return Gk(r)?e(r):Hk(r)?t.check({tokenize:Zj},e,n)(r):n(r)}}}}};function Zj(t,e,n){return qk(t,(function(t){return null===t?n(t):e(t)}),"whitespace")}function Jj(t,e){const n=String(t);if("string"!=typeof e)throw new TypeError("Expected character");let r=0,i=n.indexOf(e);for(;-1!==i;)r++,i=n.indexOf(e,i+e.length);return r}const Qj={}.hasOwnProperty,tz=function(t,e,n,r){let i,s;"string"==typeof e||e instanceof RegExp?(s=[[e,n]],i=r):(s=e,i=n),i||(i={});const o=PC(i.ignore||[]),a=function(t){const e=[];if("object"!=typeof t)throw new TypeError("Expected array or object as schema");if(Array.isArray(t)){let n=-1;for(;++n<t.length;)e.push([ez(t[n][0]),nz(t[n][1])])}else{let n;for(n in t)Qj.call(t,n)&&e.push([ez(n),nz(t[n])])}return e}(s);let l=-1;for(;++l<a.length;)UC(t,"text",c);return t;function c(t,e){let n,r=-1;for(;++r<e.length;){const t=e[r];if(o(t,n?n.children.indexOf(t):void 0,n))return;n=t}if(n)return function(t,e){const n=e[e.length-1],r=a[l][0],i=a[l][1];let s=0;const o=n.children.indexOf(t);let c=!1,h=[];r.lastIndex=0;let u=r.exec(t.value);for(;u;){const n=u.index,o={index:u.index,input:u.input,stack:[...e,t]};let a=i(...u,o);if("string"==typeof a&&(a=a.length>0?{type:"text",value:a}:void 0),!1!==a&&(s!==n&&h.push({type:"text",value:t.value.slice(s,n)}),Array.isArray(a)?h.push(...a):a&&h.push(a),s=n+u[0].length,c=!0),!r.global)break;u=r.exec(t.value)}c?(s<t.value.length&&h.push({type:"text",value:t.value.slice(s)}),n.children.splice(o,1,...h)):h=[t];return o+h.length}(t,e)}};function ez(t){return"string"==typeof t?new RegExp(function(t){if("string"!=typeof t)throw new TypeError("Expected a string");return t.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}(t),"g"):t}function nz(t){return"function"==typeof t?t:()=>t}const rz="phrasing",iz=["autolink","link","image","label"],sz={transforms:[function(t){tz(t,[[/(https?:\/\/|www(?=\.))([-.\w]+)([^ \t\r\n]*)/gi,lz],[/([-.\w+]+)@([-\w]+(?:\.[-\w]+)+)/g,cz]],{ignore:["link","linkReference"]})}],enter:{literalAutolink:function(t){this.enter({type:"link",title:null,url:"",children:[]},t)},literalAutolinkEmail:az,literalAutolinkHttp:az,literalAutolinkWww:az},exit:{literalAutolink:function(t){this.exit(t)},literalAutolinkEmail:function(t){this.config.exit.autolinkEmail.call(this,t)},literalAutolinkHttp:function(t){this.config.exit.autolinkProtocol.call(this,t)},literalAutolinkWww:function(t){this.config.exit.data.call(this,t);this.stack[this.stack.length-1].url="http://"+this.sliceSerialize(t)}}},oz={unsafe:[{character:"@",before:"[+\\-.\\w]",after:"[\\-.\\w]",inConstruct:rz,notInConstruct:iz},{character:".",before:"[Ww]",after:"[\\-.\\w]",inConstruct:rz,notInConstruct:iz},{character:":",before:"[ps]",after:"\\/",inConstruct:rz,notInConstruct:iz}]};function az(t){this.config.enter.autolinkProtocol.call(this,t)}function lz(t,e,n,r,i){let s="";if(!hz(i))return!1;if(/^w/i.test(e)&&(n=e+n,e="",s="http://"),!function(t){const e=t.split(".");if(e.length<2||e[e.length-1]&&(/_/.test(e[e.length-1])||!/[a-zA-Z\d]/.test(e[e.length-1]))||e[e.length-2]&&(/_/.test(e[e.length-2])||!/[a-zA-Z\d]/.test(e[e.length-2])))return!1;return!0}(n))return!1;const o=function(t){const e=/[!"&'),.:;<>?\]}]+$/.exec(t);if(!e)return[t,void 0];t=t.slice(0,e.index);let n=e[0],r=n.indexOf(")");const i=Jj(t,"(");let s=Jj(t,")");for(;-1!==r&&i>s;)t+=n.slice(0,r+1),n=n.slice(r+1),r=n.indexOf(")"),s++;return[t,n]}(n+r);if(!o[0])return!1;const a={type:"link",title:null,url:s+e+o[0],children:[{type:"text",value:e+o[0]}]};return o[1]?[a,{type:"text",value:o[1]}]:a}function cz(t,e,n,r){return!(!hz(r,!0)||/[-\d_]$/.test(n))&&{type:"link",title:null,url:"mailto:"+e+"@"+n,children:[{type:"text",value:e+"@"+n}]}}function hz(t,e){const n=t.input.charCodeAt(t.index-1);return(0===t.index||Yk(n)||$k(n))&&(!e||47!==n)}function uz(t){this.enter({type:"footnoteDefinition",identifier:"",label:"",children:[]},t)}function dz(){this.buffer()}function fz(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.label=e,n.identifier=_A(this.sliceSerialize(t)).toLowerCase()}function pz(t){this.exit(t)}function mz(t){this.enter({type:"footnoteReference",identifier:"",label:""},t)}function gz(){this.buffer()}function vz(t){const e=this.resume(),n=this.stack[this.stack.length-1];n.label=e,n.identifier=_A(this.sliceSerialize(t)).toLowerCase()}function yz(t){this.exit(t)}function bz(t,e,n,r){const i=mR(r);let s=i.move("[^");const o=n.enter("footnoteReference"),a=n.enter("reference");return s+=i.move(dR(n,oR(t),{...i.current(),before:s,after:"]"})),a(),o(),s+=i.move("]"),s}function xz(t,e,n,r){const i=mR(r);let s=i.move("[^");const o=n.enter("footnoteDefinition"),a=n.enter("label");return s+=i.move(dR(n,oR(t),{...i.current(),before:s,after:"]"})),a(),s+=i.move("]:"+(t.children&&t.children.length>0?" ":"")),i.shift(4),s+=i.move(uR(lR(t,n,i.current()),wz)),o(),s}function wz(t,e,n){return 0===e?t:(n?"":"    ")+t}bz.peek=function(){return"["};Sz.peek=function(){return"~"};const Ez={canContainEols:["delete"],enter:{strikethrough:function(t){this.enter({type:"delete",children:[]},t)}},exit:{strikethrough:function(t){this.exit(t)}}},_z={unsafe:[{character:"~",inConstruct:"phrasing",notInConstruct:["autolink","destinationLiteral","destinationRaw","reference","titleQuote","titleApostrophe"]}],handlers:{delete:Sz}};function Sz(t,e,n,r){const i=mR(r),s=n.enter("strikethrough");let o=i.move("~~");return o+=aR(t,n,{...i.current(),before:o,after:"~"}),o+=i.move("~~"),s(),o}function Tz(t){return t.length}function kz(t){const e="string"==typeof t?t.codePointAt(0):0;return 67===e||99===e?99:76===e||108===e?108:82===e||114===e?114:0}const Az={enter:{table:function(t){const e=t._align;this.enter({type:"table",align:e.map((t=>"none"===t?null:t)),children:[]},t),this.setData("inTable",!0)},tableData:Rz,tableHeader:Rz,tableRow:function(t){this.enter({type:"tableRow",children:[]},t)}},exit:{codeText:function(t){let e=this.resume();this.getData("inTable")&&(e=e.replace(/\\([\\|])/g,Mz));this.stack[this.stack.length-1].value=e,this.exit(t)},table:function(t){this.exit(t),this.setData("inTable")},tableData:Cz,tableHeader:Cz,tableRow:Cz}};function Cz(t){this.exit(t)}function Rz(t){this.enter({type:"tableCell",children:[]},t)}function Mz(t,e){return"|"===e?e:t}function Iz(t){const e=t||{},n=e.tableCellPadding,r=e.tablePipeAlign,i=e.stringLength,s=n?" ":"|";return{unsafe:[{character:"\r",inConstruct:"tableCell"},{character:"\n",inConstruct:"tableCell"},{atBreak:!0,character:"|",after:"[\t :-]"},{character:"|",inConstruct:"tableCell"},{atBreak:!0,character:":",after:"-"},{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{table:function(t,e,n,r){return a(function(t,e,n){const r=t.children;let i=-1;const s=[],o=e.enter("table");for(;++i<r.length;)s[i]=l(r[i],e,n);return o(),s}(t,n,r),t.align)},tableRow:function(t,e,n,r){const i=a([l(t,n,r)]);return i.slice(0,i.indexOf("\n"))},tableCell:o,inlineCode:function(t,e,n){let r=$C(t,0,n);n.stack.includes("tableCell")&&(r=r.replace(/\|/g,"\\$&"));return r}}};function o(t,e,n,r){const i=n.enter("tableCell"),o=n.enter("phrasing"),a=aR(t,n,{...r,before:s,after:s});return o(),i(),a}function a(t,e){return function(t,e={}){const n=(e.align||[]).concat(),r=e.stringLength||Tz,i=[],s=[],o=[],a=[];let l=0,c=-1;for(;++c<t.length;){const n=[],i=[];let u=-1;for(t[c].length>l&&(l=t[c].length);++u<t[c].length;){const s=null==(h=t[c][u])?"":String(h);if(!1!==e.alignDelimiters){const t=r(s);i[u]=t,(void 0===a[u]||t>a[u])&&(a[u]=t)}n.push(s)}s[c]=n,o[c]=i}var h;let u=-1;if("object"==typeof n&&"length"in n)for(;++u<l;)i[u]=kz(n[u]);else{const t=kz(n);for(;++u<l;)i[u]=t}u=-1;const d=[],f=[];for(;++u<l;){const t=i[u];let n="",r="";99===t?(n=":",r=":"):108===t?n=":":114===t&&(r=":");let s=!1===e.alignDelimiters?1:Math.max(1,a[u]-n.length-r.length);const o=n+"-".repeat(s)+r;!1!==e.alignDelimiters&&(s=n.length+s+r.length,s>a[u]&&(a[u]=s),f[u]=s),d[u]=o}s.splice(1,0,d),o.splice(1,0,f),c=-1;const p=[];for(;++c<s.length;){const t=s[c],n=o[c];u=-1;const r=[];for(;++u<l;){const s=t[u]||"";let o="",c="";if(!1!==e.alignDelimiters){const t=a[u]-(n[u]||0),e=i[u];114===e?o=" ".repeat(t):99===e?t%2?(o=" ".repeat(t/2+.5),c=" ".repeat(t/2-.5)):(o=" ".repeat(t/2),c=o):c=" ".repeat(t)}!1===e.delimiterStart||u||r.push("|"),!1===e.padding||!1===e.alignDelimiters&&""===s||!1===e.delimiterStart&&!u||r.push(" "),!1!==e.alignDelimiters&&r.push(o),r.push(s),!1!==e.alignDelimiters&&r.push(c),!1!==e.padding&&r.push(" "),!1===e.delimiterEnd&&u===l-1||r.push("|")}p.push(!1===e.delimiterEnd?r.join("").replace(/ +$/,""):r.join(""))}return p.join("\n")}(t,{align:e,alignDelimiters:r,padding:n,stringLength:i})}function l(t,e,n){const r=t.children;let i=-1;const s=[],a=e.enter("tableRow");for(;++i<r.length;)s[i]=o(r[i],0,e,n);return a(),s}}const Dz={exit:{taskListCheckValueChecked:Pz,taskListCheckValueUnchecked:Pz,paragraph:function(t){const e=this.stack[this.stack.length-2];if(e&&"listItem"===e.type&&"boolean"==typeof e.checked){const t=this.stack[this.stack.length-1],n=t.children[0];if(n&&"text"===n.type){const r=e.children;let i,s=-1;for(;++s<r.length;){const t=r[s];if("paragraph"===t.type){i=t;break}}i===t&&(n.value=n.value.slice(1),0===n.value.length?t.children.shift():t.position&&n.position&&"number"==typeof n.position.start.offset&&(n.position.start.column++,n.position.start.offset++,t.position.start=Object.assign({},n.position.start)))}}this.exit(t)}}},Oz={unsafe:[{atBreak:!0,character:"-",after:"[:|-]"}],handlers:{listItem:function(t,e,n,r){const i=t.children[0],s="boolean"==typeof t.checked&&i&&"paragraph"===i.type,o="["+(t.checked?"x":" ")+"] ",a=mR(r);s&&a.move(o);let l=QC(t,e,n,{...r,...a.current()});s&&(l=l.replace(/^(?:[*+-]|\d+\.)([\r\n]| {1,3})/,(function(t){return t+o})));return l}}};function Pz(t){this.stack[this.stack.length-2].checked="taskListCheckValueChecked"===t.type}function Lz(t={}){const e=this.data();function n(t,n){(e[t]?e[t]:e[t]=[]).push(n)}n("micromarkExtensions",function(t){return Ok([Rj,{document:{91:{tokenize:Vj,continuation:{tokenize:jj},exit:zj}},text:{91:{tokenize:Uj},93:{add:"after",tokenize:Nj,resolveTo:Bj}}},Gj(t),$j,Kj])}(t)),n("fromMarkdownExtensions",[sz,{enter:{gfmFootnoteDefinition:uz,gfmFootnoteDefinitionLabelString:dz,gfmFootnoteCall:mz,gfmFootnoteCallString:gz},exit:{gfmFootnoteDefinition:pz,gfmFootnoteDefinitionLabelString:fz,gfmFootnoteCall:yz,gfmFootnoteCallString:vz}},Ez,Az,Dz]),n("toMarkdownExtensions",function(t){return{extensions:[oz,{unsafe:[{character:"[",inConstruct:["phrasing","label","reference"]}],handlers:{footnoteDefinition:xz,footnoteReference:bz}},_z,Iz(t),Oz]}}(t))}var Fz=Object.defineProperty,Nz=(t,e,n)=>(((t,e,n)=>{e in t?Fz(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n})(t,"symbol"!=typeof e?e+"":e,n),n);const Bz=t=>`footnote-ref-${t}`,Uz=t=>`footnote-def-${t}`,Vz=new Tk("MILKDOWN_FOOTNOTE_DEF_INPUT"),jz=AL("ModifyFootnoteDef"),zz=QF((t=>{const e="footnote_definition",n="footnoteDefinition";return{id:e,schema:r=>({group:"block",content:"block+",defining:!0,attrs:{label:{default:""}},parseDOM:[{tag:`div[data-type="${e}"]`,getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{label:t.dataset.label}},contentElement:"dd"}],toDOM:n=>{const i=n.attrs.label,s=t.getClassName(n.attrs,"footnote-definition"),o=document.createElement("dt");o.textContent=`[${i}]:`,o.onclick=()=>{const t=r.get(mL),e=ck.create(t.state.doc,t.state.selection.from-2);t.dispatch(t.state.tr.setSelection(e))};const a=document.createElement("a");return a.href=`#${Bz(i)}`,a.contentEditable="false",a.textContent="↩",a.onmousedown=t=>{t.preventDefault()},["div",{class:s,"data-label":i,"data-type":e,id:Uz(i)},["div",{class:"footnote-definition_content"},o,["dd",0]],["div",{class:"footnote-definition_anchor"},a]]},parseMarkdown:{match:({type:t})=>t===n,runner:(t,e,n)=>{t.openNode(n,{label:e.label}).next(e.children).closeNode()}},toMarkdown:{match:t=>t.type.name===e,runner:(t,e)=>{t.openNode(n,void 0,{label:e.attrs.label,identifier:e.attrs.label}).next(e.content).closeNode()}}}),commands:t=>[kL(jz,((e="")=>(n,r)=>{const i=WO(n.selection,t);if(!i)return!1;const{tr:s}=n,o=s.setNodeMarkup(i.pos,void 0,{...i.node.attrs,label:e});return null==r||r(o.setSelection(ck.create(o.doc,i.pos))),!0}))],inputRules:t=>[fO(/(?:\[\^)([^:]+)(?::)$/,t,(t=>{var e;return{label:null!=(e=t[1])?e:"footnote"}}),(()=>!1))],prosePlugins:(e,n)=>[new Ek({key:Vz,view:r=>{const i=t.themeManager.get("input-chip",{width:"12em",placeholder:"Input Footnote Label",onUpdate:t=>{n.get(CL).call(jz,t)},isBindMode:!0});if(!i)return{};const s=t=>{t.editable&&((t=>Boolean(e&&WO(t.state.selection,e)))(t)?(i.show(t),i.update((t=>{const n=WO(t.state.selection,e);return n?n.node.attrs.label:void 0})(t))):i.hide())};return i.init(r),s(r),{update:(t,e)=>{(null==e?void 0:e.doc.eq(t.state.doc))&&e.selection.eq(t.state.selection)||s(t)},destroy:()=>{i.destroy()}}}})]}})),Gz=AL("ModifyFootnoteRef"),Wz=new Tk("MILKDOWN_FOOTNOTE_REF_INPUT"),Hz=QF((t=>{const e="footnote_reference";return{id:e,schema:t=>({group:"inline",inline:!0,atom:!0,attrs:{label:{default:""}},parseDOM:[{tag:`sup[data-type="${e}"]`,getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{label:t.dataset.label}}}],toDOM:n=>{const r=n.attrs.label,i=document.createElement("a"),s=`#${Uz(r)}`;return i.href=s,i.textContent=`[${r}]`,i.onclick=e=>{t.get(mL).editable&&e.preventDefault()},i.ondblclick=()=>{t.get(mL).editable&&(window.location.href=s)},["sup",{"data-label":r,"data-type":e,id:Bz(r)},i]},parseMarkdown:{match:({type:t})=>"footnoteReference"===t,runner:(t,e,n)=>{t.addNode(n,{label:e.label})}},toMarkdown:{match:t=>t.type.name===e,runner:(t,e)=>{t.addNode("footnoteReference",void 0,void 0,{label:e.attrs.label,identifier:e.attrs.label})}}}),commands:t=>[kL(Gz,((e="")=>(n,r)=>{const i=WO(n.selection,t);if(!i)return!1;const{tr:s}=n,o=s.setNodeMarkup(i.pos,void 0,{...i.node.attrs,label:e});return null==r||r(o.setSelection(ck.create(o.doc,i.pos))),!0}))],inputRules:t=>[new dO(/(?:\[\^)([^\]]+)(?:\])$/,((e,n,r,i)=>{const s=e.doc.resolve(r),o=s.index(),a=e.doc.resolve(i);if(!s.parent.canReplaceWith(o,a.index(),t))return null;const l=n[1];return e.tr.replaceRangeWith(r,i,t.create({label:l}))}))],prosePlugins:(e,n)=>{const r=t.themeManager.get("input-chip",{width:"12em",placeholder:"Input Footnote Label",onUpdate:t=>{n.get(CL).call(Gz,t)},isBindMode:!0});if(!r)return[];const i=t=>{t.editable&&((t=>Boolean(e&&WO(t.state.selection,e)))(t)?(r.show(t),r.update((t=>{const n=WO(t.state.selection,e);return n?n.node.attrs.label:void 0})(t))):r.hide())};return[new Ek({key:Wz,view:t=>(r.init(t),i(t),{update:(t,e)=>{(null==e?void 0:e.doc.eq(t.state.doc))&&e.selection.eq(t.state.selection)||i(t)},destroy:()=>{r.destroy()}})})]}}})),$z=new WeakMap;class Yz{constructor(t,e,n,r){Nz(this,"tableStart"),Nz(this,"map"),Nz(this,"table"),this.left=t,this.top=e,this.right=n,this.bottom=r}}class Xz{constructor(t,e,n,r){this.width=t,this.height=e,this.map=n,this.problems=r,this.width=t,this.height=e,this.map=n,this.problems=r}findCell(t){for(let e=0;e<this.map.length;e++){const n=this.map[e];if(n!=t)continue;const r=e%this.width,i=e/this.width|0;let s=r+1,o=i+1;for(let t=1;s<this.width&&this.map[e+t]==n;t++)s++;for(let t=1;o<this.height&&this.map[e+this.width*t]==n;t++)o++;return new Yz(r,i,s,o)}throw new RangeError(`No cell with offset ${t} found`)}colCount(t){for(let e=0;e<this.map.length;e++)if(this.map[e]==t)return e%this.width;throw new RangeError(`No cell with offset ${t} found`)}nextCell(t,e,n){const{left:r,right:i,top:s,bottom:o}=this.findCell(t);return"horiz"==e?(n<0?0==r:i==this.width)?void 0:this.map[s*this.width+(n<0?r-1:i)]:(n<0?0==s:o==this.height)?void 0:this.map[r+this.width*(n<0?s-1:o)]}rectBetween(t,e){const{left:n,right:r,top:i,bottom:s}=this.findCell(t),{left:o,right:a,top:l,bottom:c}=this.findCell(e);return new Yz(Math.min(n,o),Math.min(i,l),Math.max(r,a),Math.max(s,c))}cellsInRect(t){const e=[],n={};for(let r=t.top;r<t.bottom;r++)for(let i=t.left;i<t.right;i++){const s=r*this.width+i,o=this.map[s];n[o]||(n[o]=!0,(i!=t.left||!i||this.map[s-1]!=o)&&(r!=t.top||!r||this.map[s-this.width]!=o)&&e.push(o))}return e}positionAt(t,e,n){for(let r=0,i=0;;r++){const s=i+n.child(r).nodeSize;if(r==t){let n=e+t*this.width;const r=(t+1)*this.width;for(;n<r&&this.map[n]<i;)n++;return n==r?s-1:this.map[n]}i=s}}static get(t){return e=t,$z.get(e)||((t,e)=>($z.set(t,e),e))(t,function(t){if("table"!=t.type.spec.tableRole)throw new RangeError(`Not a table node: ${t.type.name}`);const e=function(t){let e=-1,n=!1;for(let r=0;r<t.childCount;r++){const i=t.child(r);let s=0;if(n)for(let e=0;e<r;e++){const n=t.child(e);for(let t=0;t<n.childCount;t++){const i=n.child(t);e+i.attrs.rowspan>r&&(s+=i.attrs.colspan)}}for(let t=0;t<i.childCount;t++){const e=i.child(t);s+=e.attrs.colspan,e.attrs.rowspan>1&&(n=!0)}-1==e?e=s:e!=s&&(e=Math.max(e,s))}return e}(t),n=t.childCount,r=[],i=[];let s,o=0;for(let c=0,h=e*n;c<h;c++)r[c]=0;for(let c=0,h=0;c<n;c++){const a=t.child(c);h++;for(let t=0;;t++){for(;o<r.length&&0!=r[o];)o++;if(t==a.childCount)break;const l=a.child(t),{colspan:u,rowspan:d,colwidth:f}=l.attrs;for(let t=0;t<d;t++){if(t+c>=n){(s||(s=[])).push({type:"overlong_rowspan",pos:h,n:d-t});break}const a=o+t*e;for(let t=0;t<u;t++){0==r[a+t]?r[a+t]=h:(s||(s=[])).push({type:"collision",row:c,pos:h,n:u-t});const n=f&&f[t];if(n){const r=(a+t)%e*2,s=i[r];null==s||s!=n&&1==i[r+1]?(i[r]=n,i[r+1]=1):s==n&&i[r+1]++}}}o+=u,h+=l.nodeSize}const l=(c+1)*e;let u=0;for(;o<l;)0==r[o++]&&u++;u&&(s||(s=[])).push({type:"missing",row:c,n:u}),h++}const a=new Xz(e,n,r,s);let l=!1;for(let c=0;!l&&c<i.length;c+=2)null!=i[c]&&i[c+1]<n&&(l=!0);return l&&function(t,e,n){t.problems||(t.problems=[]);for(let r=0,i={};r<t.map.length;r++){const s=t.map[r];if(i[s])continue;i[s]=!0;const o=n.nodeAt(s);let a=null;for(let n=0;n<o.attrs.colspan;n++){const i=e[2*((r+n)%t.width)];null!=i&&(!o.attrs.colwidth||o.attrs.colwidth[n]!=i)&&((a||(a=qz(o.attrs)))[n]=i)}a&&t.problems.unshift({type:"colwidth mismatch",pos:s,colwidth:a})}}(a,i,t),a}(t));var e}}function qz(t){if(t.colwidth)return t.colwidth.slice();const e=[];for(let n=0;n<t.colspan;n++)e.push(0);return e}class Kz extends rk{constructor(t,e=t){const n=t.node(-1),r=Xz.get(n),i=t.start(-1),s=r.rectBetween(t.pos-i,e.pos-i),o=t.node(0),a=r.cellsInRect(s).filter((t=>t!=e.pos-i));a.unshift(e.pos-i);const l=a.map((t=>{const e=n.nodeAt(t),r=t+i+1;return new ik(o.resolve(r),o.resolve(r+e.content.size))}));super(l[0].$from,l[0].$to,l),this.$anchorCell=t,this.$headCell=e,this.$anchorCell=t,this.$headCell=e}map(t,e){const n=t.resolve(e.map(this.$anchorCell.pos)),r=t.resolve(e.map(this.$headCell.pos));if(iG(n)&&iG(r)&&sG(n,r)){const t=this.$anchorCell.node(-1)!=n.node(-1);return t&&this.isRowSelection()?Kz.rowSelection(n,r):t&&this.isColSelection()?Kz.colSelection(n,r):new Kz(n,r)}return ak.between(n,r)}content(){const t=this.$anchorCell.node(-1),e=Xz.get(t),n=this.$anchorCell.start(-1),r=e.rectBetween(this.$anchorCell.pos-n,this.$headCell.pos-n),i={},s=[];for(let a=r.top;a<r.bottom;a++){const n=[];for(let s=a*e.width+r.left,o=r.left;o<r.right;o++,s++){const o=e.map[s];if(!i[o]){i[o]=!0;const s=e.findCell(o);let a=t.nodeAt(o);const l=r.left-s.left,c=s.right-r.right;if(l>0||c>0){let t=a.attrs;l>0&&(t=lG(t,0,l)),c>0&&(t=lG(t,t.colspan-c,c)),a=s.left<r.left?a.type.createAndFill(t):a.type.create(t,a.content)}if(s.top<r.top||s.bottom>r.bottom){const t=aG(a.attrs,"rowspan",Math.min(s.bottom,r.bottom)-Math.max(s.top,r.top));a=s.top<r.top?a.type.createAndFill(t):a.type.create(t,a.content)}n.push(a)}}s.push(t.child(a).copy(S_.from(n)))}const o=this.isColSelection()&&this.isRowSelection()?t:s;return new M_(S_.from(o),1,1)}replace(t,e=M_.empty){const n=t.steps.length,r=this.ranges;for(let s=0;s<r.length;s++){const{$from:i,$to:o}=r[s],a=t.mapping.slice(n);t.replace(a.map(i.pos),a.map(o.pos),s?M_.empty:e)}const i=rk.findFrom(t.doc.resolve(t.mapping.slice(n).map(this.to)),-1);i&&t.setSelection(i)}replaceWith(t,e){this.replace(t,new M_(S_.from(e),0,0))}forEachCell(t){const e=this.$anchorCell.node(-1),n=Xz.get(e),r=this.$anchorCell.start(-1),i=n.cellsInRect(n.rectBetween(this.$anchorCell.pos-r,this.$headCell.pos-r));for(let s=0;s<i.length;s++)t(e.nodeAt(i[s]),r+i[s])}isColSelection(){const t=this.$anchorCell.index(-1),e=this.$headCell.index(-1);if(Math.min(t,e)>0)return!1;const n=t+this.$anchorCell.nodeAfter.attrs.rowspan,r=e+this.$headCell.nodeAfter.attrs.rowspan;return Math.max(n,r)==this.$headCell.node(-1).childCount}static colSelection(t,e=t){const n=Xz.get(t.node(-1)),r=t.start(-1),i=n.findCell(t.pos-r),s=n.findCell(e.pos-r),o=t.node(0);if(i.top<=s.top){if(i.top>0){const e=n.map[i.left];t=o.resolve(r+e)}if(s.bottom<n.height){const t=n.map[n.width*(n.height-1)+s.right-1];e=o.resolve(r+t)}}else{if(s.top>0){const t=n.map[i.left];e=o.resolve(r+t)}if(i.bottom<n.height){const e=n.map[n.width*(n.height-1)+i.right-1];t=o.resolve(r+e)}}return new Kz(t,e)}isRowSelection(){const t=Xz.get(this.$anchorCell.node(-1)),e=this.$anchorCell.start(-1),n=t.colCount(this.$anchorCell.pos-e),r=t.colCount(this.$headCell.pos-e);if(Math.min(n,r)>0)return!1;const i=n+this.$anchorCell.nodeAfter.attrs.colspan,s=r+this.$headCell.nodeAfter.attrs.colspan;return Math.max(i,s)==t.width}eq(t){return t instanceof Kz&&t.$anchorCell.pos==this.$anchorCell.pos&&t.$headCell.pos==this.$headCell.pos}static rowSelection(t,e=t){const n=Xz.get(t.node(-1)),r=t.start(-1),i=n.findCell(t.pos-r),s=n.findCell(e.pos-r),o=t.node(0);if(i.left<=s.left){if(i.left>0){const e=n.map[i.top*n.width];t=o.resolve(r+e)}if(s.right<n.width){const t=n.map[n.width*(s.top+1)-1];e=o.resolve(r+t)}}else{if(s.left>0){const t=n.map[s.top*n.width];e=o.resolve(r+t)}if(i.right<n.width){const e=n.map[n.width*(i.top+1)-1];t=o.resolve(r+e)}}return new Kz(t,e)}toJSON(){return{type:"cell",anchor:this.$anchorCell.pos,head:this.$headCell.pos}}static fromJSON(t,e){return new Kz(t.resolve(e.anchor),t.resolve(e.head))}static create(t,e,n=e){return new Kz(t.resolve(e),t.resolve(n))}getBookmark(){return new Zz(this.$anchorCell.pos,this.$headCell.pos)}}Kz.prototype.visible=!1,rk.jsonID("cell",Kz);class Zz{constructor(t,e){this.anchor=t,this.head=e,this.anchor=t,this.head=e}map(t){return new Zz(t.map(this.anchor),t.map(this.head))}resolve(t){const e=t.resolve(this.anchor),n=t.resolve(this.head);return"row"==e.parent.type.spec.tableRole&&"row"==n.parent.type.spec.tableRole&&e.index()<e.parent.childCount&&n.index()<n.parent.childCount&&sG(e,n)?new Kz(e,n):rk.near(n,1)}}function Jz(t){if(!(t.selection instanceof Kz))return null;const e=[];return t.selection.forEachCell(((t,n)=>{e.push(LD.node(n,n+t.nodeSize,{class:"selectedCell"}))})),BD.create(t.doc,e)}function Qz(t,e){const n=t.getAttribute("data-colwidth"),r=n&&/^\d+(,\d+)*$/.test(n)?n.split(",").map((t=>Number(t))):null,i=Number(t.getAttribute("colspan")||1),s={colspan:i,rowspan:Number(t.getAttribute("rowspan")||1),colwidth:r&&r.length==i?r:null};for(const o in e){const n=e[o].getFromDOM,r=n&&n(t);null!=r&&(s[o]=r)}return s}function tG(t,e){const n={};1!=t.attrs.colspan&&(n.colspan=t.attrs.colspan),1!=t.attrs.rowspan&&(n.rowspan=t.attrs.rowspan),t.attrs.colwidth&&(n["data-colwidth"]=t.attrs.colwidth.join(","));for(const r in e){const i=e[r].setDOMAttr;i&&i(t.attrs[r],n)}return n}function eG(t){let e=t.cached.tableNodeTypes;if(!e){e=t.cached.tableNodeTypes={};for(const n in t.nodes){const r=t.nodes[n],i=null==r?void 0:r.spec.tableRole;i&&(e[i]=r)}}return e}const nG=function(t){const e=t.cellAttributes||{},n={colspan:{default:1},rowspan:{default:1},colwidth:{default:null}};for(const i in e)n[i]={default:e[i].default};const r=n;return{table:{content:"table_row+",tableRole:"table",isolating:!0,group:t.tableGroup,parseDOM:[{tag:"table"}],toDOM:()=>["table",["tbody",0]]},table_row:{content:"(table_cell | table_header)*",tableRole:"row",parseDOM:[{tag:"tr"}],toDOM:()=>["tr",0]},table_cell:{content:t.cellContent,attrs:r,tableRole:"cell",isolating:!0,parseDOM:[{tag:"td",getAttrs:t=>Qz(t,e)}],toDOM:t=>["td",tG(t,e),0]},table_header:{content:t.cellContent,attrs:r,tableRole:"header_cell",isolating:!0,parseDOM:[{tag:"th",getAttrs:t=>Qz(t,e)}],toDOM:t=>["th",tG(t,e),0]}}}({tableGroup:"block",cellContent:"paragraph",cellAttributes:{alignment:{default:"left",getFromDOM:t=>t.style.textAlign||"left",setDOMAttr:(t,e)=>{e.style=`text-align: ${t||"left"}`}}}});function rG(t){for(let e=t.depth-1;e>0;e--)if("row"==t.node(e).type.spec.tableRole)return t.node(0).resolve(t.before(e+1))}function iG(t){return"row"==t.parent.type.spec.tableRole?t.nodeAfter:null}function sG(t,e){return t.depth==e.depth&&t.pos>=e.start(-1)&&t.pos<=e.end(-1)}function oG(t,e,n){const r=t.start(-1),i=Xz.get(t.node(-1)).nextCell(t.pos-r,e,n);return null==i?null:t.node(0).resolve(r+i)}function aG(t,e,n){const r={};for(const i in t)r[i]=t[i];return r[e]=n,r}function lG(t,e,n=1){const r=aG(t,"colspan",t.colspan-n);if(r.colwidth){const t=r.colwidth;r.colwidth=t.slice(),t.splice(e,n),t.some((t=>t>0))||(r.colwidth=null)}return r}function cG(t){const e=t.selection.$head;for(let n=e.depth;n>0;n--)if("row"==e.node(n).type.spec.tableRole)return!0;return!1}function hG(t){const e=t.selection;return e instanceof Kz?e.$anchorCell.pos>e.$headCell.pos?e.$anchorCell:e.$headCell:e.node&&"cell"==e.node.type.spec.tableRole?e.$anchor:rG(e.$head)||function(t){for(let e=t.nodeAfter,n=t.pos;e;e=e.firstChild,n++){const r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n)}for(let e=t.nodeBefore,n=t.pos;e;e=e.lastChild,n--){const r=e.type.spec.tableRole;if("cell"==r||"header_cell"==r)return t.doc.resolve(n-e.nodeSize)}}(e.$head)}function uG(t,e,n=1){const r=aG(t,"colspan",t.colspan+n);if(r.colwidth){const t=r.colwidth;r.colwidth=t.slice();for(let r=0;r<n;r++)t.splice(e,0,0)}return r}function dG(t){const e=t.selection,n=hG(t),r=n.node(-1),i=n.start(-1),s=Xz.get(r);let o;return o=e instanceof Kz?s.rectBetween(e.$anchorCell.pos-i,e.$headCell.pos-i):s.findCell(n.pos-i),o.tableStart=i,o.map=s,o.table=r,o}function fG(t,{map:e,tableStart:n,table:r},i){let s=i>0?-1:0;(function(t,e,n){const r=eG(e.type.schema).header_cell;for(let i=0;i<t.height;i++){const s=t.map[n+i*t.width];if(e.nodeAt(s).type!=r)return!1}return!0})(e,r,i+s)&&(s=0==i||i==e.width?null:0);for(let o=0;o<e.height;o++){const a=o*e.width+i;if(i>0&&i<e.width&&e.map[a-1]==e.map[a]){const s=e.map[a],l=r.nodeAt(s);t.setNodeMarkup(t.mapping.map(n+s),null,uG(l.attrs,i-e.colCount(s))),o+=l.attrs.rowspan-1}else{const l=e.map[a+s],c=null==s?eG(r.type.schema).cell:r.nodeAt(l).type,h=e.positionAt(o,i,r);t.insert(t.mapping.map(n+h),c.createAndFill())}}return t}const pG=(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t);e(fG(t.tr,n,n.left))}return!0},mG=(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t);e(fG(t.tr,n,n.right))}return!0};function gG(t,{map:e,table:n,tableStart:r},i){const s=t.mapping.maps.length;for(let o=0;o<e.height;){const a=o*e.width+i,l=e.map[a],c=n.nodeAt(l);if(i>0&&e.map[a-1]==l||i<e.width-1&&e.map[a+1]==l)t.setNodeMarkup(t.mapping.slice(s).map(r+l),null,lG(c.attrs,i-e.colCount(l)));else{const e=t.mapping.slice(s).map(r+l);t.delete(e,e+c.nodeSize)}o+=c.attrs.rowspan}}const vG=(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t),r=t.tr;if(0==n.left&&n.right==n.map.width)return!1;for(let t=n.right-1;gG(r,n,t),t!=n.left;t--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xz.get(n.table);e(r)}return!0};function yG(t,{map:e,tableStart:n,table:r},i){let s=0;for(let l=0;l<i;l++)s+=r.child(l).nodeSize;const o=s+r.child(i).nodeSize,a=t.mapping.maps.length;t.delete(s+n,o+n);for(let l=0,c=i*e.width;l<e.width;l++,c++){const s=e.map[c];if(i>0&&s==e.map[c-e.width]){const e=r.nodeAt(s).attrs;t.setNodeMarkup(t.mapping.slice(a).map(s+n),null,aG(e,"rowspan",e.rowspan-1)),l+=e.colspan-1}else if(i<e.width&&s==e.map[c+e.width]){const o=r.nodeAt(s),c=o.type.create(aG(o.attrs,"rowspan",o.attrs.rowspan-1),o.content),h=e.positionAt(i+1,l,r);t.insert(t.mapping.slice(a).map(n+h),c),l+=o.attrs.colspan-1}}}const bG=(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t),r=t.tr;if(0==n.top&&n.bottom==n.map.height)return!1;for(let t=n.bottom-1;yG(r,n,t),t!=n.top;t--)n.table=n.tableStart?r.doc.nodeAt(n.tableStart-1):r.doc,n.map=Xz.get(n.table);e(r)}return!0};function xG(t,e){return(n,r)=>{if(!cG(n))return!1;const i=hG(n);if(i.nodeAfter.attrs[t]===e)return!1;if(r){const s=n.tr;n.selection instanceof Kz?n.selection.forEachCell(((n,r)=>{n.attrs[t]!==e&&s.setNodeMarkup(r,null,aG(n.attrs,t,e))})):s.setNodeMarkup(i.pos,null,aG(i.nodeAfter.attrs,t,e)),r(s)}return!0}}function wG(t){return(e,n)=>{if(!cG(e))return!1;const r=function(t,e){if(e<0){const e=t.nodeBefore;if(e)return t.pos-e.nodeSize;for(let n=t.index(-1)-1,r=t.before();n>=0;n--){const e=t.node(-1).child(n);if(e.childCount)return r-1-e.lastChild.nodeSize;r-=e.nodeSize}}else{if(t.index()<t.parent.childCount-1)return t.pos+t.nodeAfter.nodeSize;const e=t.node(-1);for(let n=t.indexAfter(-1),r=t.after();n<e.childCount;n++){const t=e.child(n);if(t.childCount)return r+1;r+=t.nodeSize}}}(hG(e),t);if(null==r)return!1;if(n){const t=e.doc.resolve(r);n(e.tr.setSelection(ak.between(t,function(t){return t.node(0).resolve(t.pos+t.nodeAfter.nodeSize)}(t))).scrollIntoView())}return!0}}const EG=(t,e)=>{const n=t.selection.$anchor;for(let r=n.depth;r>0;r--)if("table"==n.node(r).type.spec.tableRole)return e&&e(t.tr.delete(n.before(r),n.after(r)).scrollIntoView()),!0;return!1},_G=t=>GO((t=>"table"===t.type.spec.tableRole))(t),SG=(t,e=3,n=3)=>{const{cell:r,header_cell:i,row:s,table:o}=eG(t),a=Array(n).fill(0).map((()=>r.createAndFill(null))),l=Array(n).fill(0).map((()=>i.createAndFill(null))),c=Array(e).fill(0).map(((t,e)=>s.create(null,0===e?l:a)));return o.create(null,c)},TG=t=>e=>n=>{const r=_G(n.selection),i="row"===t;if(r){const t=Xz.get(r.node);if(e>=0&&e<(i?t.height:t.width)){const s=t.positionAt(i?e:t.height-1,i?t.width-1:e,r.node),o=n.doc.resolve(r.start+s),a=i?Kz.rowSelection:Kz.colSelection,l=t.positionAt(i?e:0,i?0:e,r.node),c=n.doc.resolve(r.start+l);return VO(n.setSelection(a(o,c)))}}return n},kG=t=>{const e=(t=>{const e=_G(t);if(!e)return;const n=Xz.get(e.node);return n.cellsInRect({left:0,right:n.width,top:0,bottom:n.height}).map((t=>{const n=e.node.nodeAt(t),r=t+e.start;return{pos:r,start:r+1,node:n}}))})(t.selection);if(e&&e[0]){const n=t.doc.resolve(e[0].pos),r=e[e.length-1];if(r){const e=t.doc.resolve(r.pos);return VO(t.setSelection(new Kz(e,n)))}}return t};function AG(t,{map:e,tableStart:n,table:r},i){const s=Array(i).fill(0).reduce(((t,e,n)=>t+r.child(n).nodeSize),n),{cell:o,row:a}=eG(r.type.schema),l=Array(e.width).fill(0).map(((t,n)=>{const i=r.nodeAt(e.map[n]);return o.createAndFill({alignment:null==i?void 0:i.attrs.alignment})}));return t.insert(s,a.create(null,l)),t}const CG=t=>t.state.selection,RG=t=>{var e,n,r,i,s,o,a,l;return{0:{$:null==(e=t.get(i_).get(c_,"leftArrow"))?void 0:e.dom,command:()=>pG,disable:t=>!CG(t).isColSelection()},1:{$:null==(n=t.get(i_).get(c_,"rightArrow"))?void 0:n.dom,command:()=>mG,disable:t=>!CG(t).isColSelection()},2:{$:null==(r=t.get(i_).get(c_,"upArrow"))?void 0:r.dom,command:()=>(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t);e(AG(t.tr,n,n.top))}return!0},disable:t=>!CG(t).isRowSelection()||"table_header"===CG(t).$head.parent.type.name},3:{$:null==(i=t.get(i_).get(c_,"downArrow"))?void 0:i.dom,command:()=>(t,e)=>{if(!cG(t))return!1;if(e){const n=dG(t);e(AG(t.tr,n,n.bottom))}return!0},disable:t=>!CG(t).isRowSelection()},4:{$:null==(s=t.get(i_).get(c_,"alignLeft"))?void 0:s.dom,command:()=>xG("alignment","left"),disable:t=>!CG(t).isColSelection()},5:{$:null==(o=t.get(i_).get(c_,"alignCenter"))?void 0:o.dom,command:()=>xG("alignment","center"),disable:t=>!CG(t).isColSelection()},6:{$:null==(a=t.get(i_).get(c_,"alignRight"))?void 0:a.dom,command:()=>xG("alignment","right"),disable:t=>!CG(t).isColSelection()},7:{$:null==(l=t.get(i_).get(c_,"delete"))?void 0:l.dom,command:(t,e)=>{const n=CG(e),r=n.isColSelection(),i=n.isRowSelection();return r&&i?EG:r?vG:bG},disable:t=>{const e=CG(t);return!!e.isRowSelection()&&(!e.isColSelection()&&(t=>{const e=Xz.get(t.$anchorCell.node(-1)),n=t.$anchorCell.start(-1),r=e.cellsInRect({left:0,right:e.width,top:0,bottom:1}),i=e.cellsInRect(e.rectBetween(t.$anchorCell.pos-n,t.$headCell.pos-n));for(let s=0,o=r.length;s<o;s++)if(!i.includes(r[s]))return!1;return!0})(e))}}}};var MG=(t=>(t.Left="Left",t.Top="Top",t.Point="Point",t))(MG||{});function IG(t,e,n,r=0){return LD.widget(e.pos+1,(e=>{var i;const s=document.createElement("div");return s.classList.add((t=>{switch(t){case MG.Left:return"milkdown-cell-left";case MG.Top:return"milkdown-cell-top";case MG.Point:default:return"milkdown-cell-point"}})(n)),n===MG.Point&&s.appendChild(null==(i=t.get(i_).get(c_,"select"))?void 0:i.dom),s.addEventListener("mousedown",(t=>{if(e)switch(t.preventDefault(),n){case MG.Point:return void e.dispatch(kG(e.state.tr));case MG.Left:return void e.dispatch(TG("row")(r)(e.state.tr));case MG.Top:e.dispatch(TG("col")(r)(e.state.tr))}})),s}))}const DG=(t,e)=>new Ek({key:new Tk("MILKDOWN_TABLE_OP"),props:{decorations:e=>{if(!t.get(mL).editable)return null;const n=[],r=(t=>e=>{const n=_G(e);if(!n)return;const r=Xz.get(n.node);return t<0||t>=r.width?void 0:r.cellsInRect({left:t,right:t+1,top:0,bottom:r.height}).map((t=>{const e=n.node.nodeAt(t);if(!e)return;const r=t+n.start;return{pos:r,start:r+1,node:e}})).filter((t=>null!=t))})(0)(e.selection);if(!r)return null;const i=(t=>e=>{const n=_G(e);if(!n)return;const r=Xz.get(n.node);return t<0||t>=r.height?void 0:r.cellsInRect({left:0,right:r.width,top:t,bottom:t+1}).map((t=>{const e=n.node.nodeAt(t);if(!e)return;const r=t+n.start;return{pos:r,start:r+1,node:e}})).filter((t=>null!=t))})(0)(e.selection);if(!i)return null;const[s]=r;return n.push(IG(t,s,MG.Point)),r.forEach(((e,r)=>{n.push(IG(t,e,MG.Left,r))})),i.forEach(((e,r)=>{n.push(IG(t,e,MG.Top,r))})),BD.create(e.doc,n)}},view:n=>{var r;const i=Object.fromEntries(Object.entries(RG(t)).filter((([,t])=>null!=t.$))),s=document.createElement("div");e.themeManager.onFlush((()=>{const t=e.getStyle((t=>((t,{css:e,injectGlobal:n})=>{const r=x_(t),i=t.get(v_,"radius"),s=t.get(v_,"lineWidth");return n`
        .milkdown {
            .tableWrapper {
                table {
                    width: calc(100% - 32px) !important;
                    margin: 16px 0 16px 16px !important;

                    .milkdown-cell-left,
                    .milkdown-cell-point,
                    .milkdown-cell-top {
                        position: absolute;

                        &::after {
                            cursor: pointer;
                            position: absolute;
                            top: 0;
                            left: 0;
                            height: 100%;
                            width: 100%;
                            display: block;
                            transition: all 0.2s ease-in-out;
                            background: ${r("secondary",.12)};
                            content: '';
                        }

                        &:hover::after {
                            background: ${r("secondary",.38)};
                        }
                    }

                    .milkdown-cell-left {
                        left: -14px;
                        top: 0;
                        bottom: 0;
                        width: 8px;
                    }

                    .milkdown-cell-top {
                        left: 0;
                        right: 0;
                        top: -14px;
                        height: 8px;
                    }

                    .milkdown-cell-point {
                        left: -18px;
                        top: -18px;
                        width: 16px;
                        height: 16px;

                        .icon {
                            position: absolute;
                            top: 0;
                            bottom: 0;
                            left: 0;
                            right: 0;
                        }
                    }
                }
            }
        }
    `,e`
        display: inline-flex;
        cursor: pointer;
        z-index: 2;

        justify-content: space-evenly;

        position: absolute;

        border-radius: ${i};

        ${t.get(s_,void 0)};
        ${t.get(g_,void 0)};

        overflow: hidden;
        background: ${r("surface")};

        .icon {
            position: relative;
            color: ${r("solid",.87)};

            width: 48px;
            line-height: 48px;
            text-align: center;
            transition: all 0.4s ease-in-out;

            &:hover {
                background-color: ${r("secondary",.12)};
            }

            &.active {
                color: ${r("primary")};
            }

            &:not(:last-child)::after {
                content: '';
                position: absolute;
                right: 0;
                top: 0;
                width: ${s};
                bottom: 0;
                background: ${r("line")};
            }
        }

        &.hide,
        .hide {
            display: none;
        }
    `})(e.themeManager,t)));t&&s.classList.add(t)})),s.classList.add("table-tooltip","hide"),Object.values(i).forEach((({$:t})=>s.appendChild(t))),null==(r=n.dom.parentNode)||r.appendChild(s);const o=t=>{!n||(t.stopPropagation(),t.preventDefault(),Object.values(i).forEach((({$:e,command:r})=>{e.contains(t.target)&&r(t,n)(n.state,n.dispatch,n)})))},a=()=>{s.classList.add("hide")};return s.addEventListener("mousedown",o),{update:(t,e)=>{const n=t.state;(null==e?void 0:e.doc.eq(n.doc))&&e.selection.eq(n.selection)||(n.selection instanceof Kz&&t.editable?(((t,e)=>{Object.values(t).forEach((t=>{var n;(null==(n=t.disable)?void 0:n.call(t,e))?t.$.classList.add("hide"):t.$.classList.remove("hide")}))})(i,t),Object.values(i).every((({$:t})=>t.classList.contains("hide")))?a():(s.classList.remove("hide"),((t,e)=>{const{selection:n}=t.state,r=n.isColSelection(),i=n.isRowSelection();BO(t,e,((t,n,s)=>{const o=e.parentElement;if(!o)throw iw();let a=i?t.left-s.left-n.width/2-8:t.left-s.left+(t.width-n.width)/2,l=t.top-s.top-n.height-(r?14:0)-14+o.scrollTop;a<0&&(a=0);const c=o.clientWidth-(n.width+4);return a>c&&(a=c),l<o.scrollTop&&(l=t.top-s.top+14+o.scrollTop),[l,a]}))})(t,s))):a())},destroy:()=>{s.removeEventListener("mousedown",o),s.remove()}}}}),OG=new Tk("plugin_autoInsertZeroSpace");class PG{constructor(t,e){Nz(this,"dom"),Nz(this,"contentDOM"),Nz(this,"table"),Nz(this,"colgroup"),this.node=t,this.cellMinWidth=e,this.node=t,this.cellMinWidth=e,this.dom=document.createElement("div"),this.dom.className="tableWrapper",this.table=this.dom.appendChild(document.createElement("table")),this.colgroup=this.table.appendChild(document.createElement("colgroup")),LG(t,this.colgroup,this.table,e),this.contentDOM=this.table.appendChild(document.createElement("tbody"))}update(t){return t.type==this.node.type&&(this.node=t,LG(t,this.colgroup,this.table,this.cellMinWidth),!0)}ignoreMutation(t){return"attributes"==t.type&&(t.target==this.table||this.colgroup.contains(t.target))}}function LG(t,e,n,r,i,s){var o;let a=0,l=!0,c=e.firstChild;const h=t.firstChild;for(let u=0,d=0;u<h.childCount;u++){const{colspan:t,colwidth:n}=h.child(u).attrs;for(let o=0;o<t;o++,d++){const t=i==d?s:n&&n[o],h=t?`${t}px`:"";a+=t||r,t||(l=!1),c?(c.style.width!=h&&(c.style.width=h),c=c.nextSibling):e.appendChild(document.createElement("col")).style.width=h}}for(;c;){const t=c.nextSibling;null==(o=c.parentNode)||o.removeChild(c),c=t}l?(n.style.width=`${a}px`,n.style.minWidth=""):(n.style.width="",n.style.minWidth=`${a}px`)}const FG=new Tk("tableColumnResizing");function NG({handleWidth:t=5,cellMinWidth:e=25,View:n=PG,lastColumnResizable:r=!0}={}){return new Ek({key:FG,state:{init(t,r){return this.spec.props.nodeViews[eG(r.schema).table.name]=t=>new n(t,e),new BG(-1,!1)},apply:(t,e)=>e.apply(t)},props:{attributes:t=>FG.getState(t).activeHandle>-1?{class:"resize-cursor"}:void 0,handleDOMEvents:{mousemove(e,n){!e.editable||function(t,e,n,r){const i=FG.getState(t.state);if(!i.dragging){const s=function(t){for(;t&&"TD"!=t.nodeName&&"TH"!=t.nodeName;)t=t.classList.contains("ProseMirror")?null:t.parentNode;return t}(e.target);let o=-1;if(s){const{left:r,right:i}=s.getBoundingClientRect();i-e.clientX<=n||e.clientX===Math.floor(r)?o=UG(t,e,"right"):e.clientX-r<=n&&(o=UG(t,e,"left"))}if(o!=i.activeHandle){if(!r&&-1!==o){const e=t.state.doc.resolve(o),n=e.node(-1),r=Xz.get(n),i=e.start(-1);if(r.colCount(e.pos-i)+e.nodeAfter.attrs.colspan-1==r.width-1)return}jG(t,o)}}}(e,n,t,r)},mouseleave(t){!t.editable||function(t){const e=FG.getState(t.state);e.activeHandle>-1&&!e.dragging&&jG(t,-1)}(t)},mousedown(t,n){!t.editable||function(t,e,n){const r=FG.getState(t.state);if(-1==r.activeHandle||r.dragging)return!1;const i=t.state.doc.nodeAt(r.activeHandle),s=function(t,e,{colspan:n,colwidth:r}){const i=r&&r[r.length-1];if(i)return i;const s=t.domAtPos(e);let o=s.node.childNodes[s.offset].offsetWidth,a=n;if(r)for(let l=0;l<n;l++)r[l]&&(o-=r[l],a--);return o/a}(t,r.activeHandle,i.attrs);function o(e){window.removeEventListener("mouseup",o),window.removeEventListener("mousemove",a);const r=FG.getState(t.state);r.dragging&&(function(t,e,n){const r=t.state.doc.resolve(e),i=r.node(-1),s=Xz.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan-1,l=t.state.tr;for(let c=0;c<s.height;c++){const t=c*s.width+a;if(c&&s.map[t]==s.map[t-s.width])continue;const e=s.map[t],{attrs:r}=i.nodeAt(e),h=1==r.colspan?0:a-s.colCount(e);if(r.colwidth&&r.colwidth[h]==n)continue;const u=r.colwidth?r.colwidth.slice():zG(r.colspan);u[h]=n,l.setNodeMarkup(o+e,null,aG(r,"colwidth",u))}l.docChanged&&t.dispatch(l)}(t,r.activeHandle,VG(r.dragging,e,n)),t.dispatch(t.state.tr.setMeta(FG,{setDragging:null})))}function a(e){if(!e.which)return o(e);const r=FG.getState(t.state),i=VG(r.dragging,e,n);!function(t,e,n,r){const i=t.state.doc.resolve(e),s=i.node(-1),o=i.start(-1),a=Xz.get(s).colCount(i.pos-o)+i.nodeAfter.attrs.colspan-1;let l=t.domAtPos(i.start(-1)).node;for(;"TABLE"!=l.nodeName;)l=l.parentNode;LG(s,l.firstChild,l,r,a,n)}(t,r.activeHandle,i,n)}t.dispatch(t.state.tr.setMeta(FG,{setDragging:{startX:e.clientX,startWidth:s}})),window.addEventListener("mouseup",o),window.addEventListener("mousemove",a),e.preventDefault()}(t,n,e)}},decorations(t){const e=FG.getState(t);return e.activeHandle>-1?function(t,e){const n=[],r=t.doc.resolve(e),i=r.node(-1),s=Xz.get(i),o=r.start(-1),a=s.colCount(r.pos-o)+r.nodeAfter.attrs.colspan;for(let l=0;l<s.height;l++){const t=a+l*s.width-1;if(!(a!=s.width&&s.map[t]==s.map[t+1]||0!=l&&s.map[t-1]==s.map[t-1-s.width])){const e=s.map[t],r=o+e+i.nodeAt(e).nodeSize-1,a=document.createElement("div");a.className="column-resize-handle",n.push(LD.widget(r,a))}}return BD.create(t.doc,n)}(t,e.activeHandle):null},nodeViews:{}}})}let BG=class t{constructor(t,e){this.activeHandle=t,this.dragging=e,this.activeHandle=t,this.dragging=e}apply(e){let n=this;const r=e.getMeta(FG);if(r&&null!=r.setHandle)return new t(r.setHandle,null);if(r&&void 0!==r.setDragging)return new t(n.activeHandle,r.setDragging);if(n.activeHandle>-1&&e.docChanged){let r=e.mapping.map(n.activeHandle,-1);iG(e.doc.resolve(r))||(r=0),n=new t(r,n.dragging)}return n}};function UG(t,e,n){const r=t.posAtCoords({left:e.clientX,top:e.clientY});if(!r)return-1;const{pos:i}=r,s=rG(t.state.doc.resolve(i));if(!s)return-1;if("right"==n)return s.pos;const o=Xz.get(s.node(-1)),a=s.start(-1),l=o.map.indexOf(s.pos-a);return l%o.width==0?-1:a+o.map[l-1]}function VG(t,e,n){const r=e.clientX-t.startX;return Math.max(n,t.startWidth+r)}function jG(t,e){t.dispatch(t.state.tr.setMeta(FG,{setHandle:e}))}function zG(t){const e=[];for(let n=0;n<t;n++)e.push(0);return e}function GG(t){if(!t.size)return null;let{content:e,openStart:n,openEnd:r}=t;for(;1==e.childCount&&(n>0&&r>0||"table"==e.firstChild.type.spec.tableRole);)n--,r--,e=e.firstChild.content;const i=e.firstChild,s=i.type.spec.tableRole,o=i.type.schema,a=[];if("row"==s)for(let l=0;l<e.childCount;l++){let t=e.child(l).content;const i=l?0:Math.max(0,n-1),s=l<e.childCount-1?0:Math.max(0,r-1);(i||s)&&(t=WG(eG(o).row,new M_(t,i,s)).content),a.push(t)}else{if("cell"!=s&&"header_cell"!=s)return null;a.push(n||r?WG(eG(o).row,new M_(e,n,r)).content:e)}return function(t,e){const n=[];for(let i=0;i<e.length;i++){const t=e[i];for(let e=t.childCount-1;e>=0;e--){const{rowspan:r,colspan:s}=t.child(e).attrs;for(let t=i;t<i+r;t++)n[t]=(n[t]||0)+s}}let r=0;for(let i=0;i<n.length;i++)r=Math.max(r,n[i]);for(let i=0;i<n.length;i++)if(i>=e.length&&e.push(S_.empty),n[i]<r){const s=eG(t).cell.createAndFill(),o=[];for(let t=n[i];t<r;t++)o.push(s);e[i]=e[i].append(S_.from(o))}return{height:e.length,width:r,rows:e}}(o,a)}function WG(t,e){const n=t.createAndFill();return new ek(n).replace(0,n.content.size,e).doc}function HG(t,e,n,r,i,s,o,a){if(0==o||o==e.height)return!1;let l=!1;for(let c=i;c<s;c++){const i=o*e.width+c,s=e.map[i];if(e.map[i-e.width]==s){l=!0;const i=n.nodeAt(s),{top:h,left:u}=e.findCell(s);t.setNodeMarkup(t.mapping.slice(a).map(s+r),null,aG(i.attrs,"rowspan",o-h)),t.insert(t.mapping.slice(a).map(e.positionAt(o,u,n)),i.type.createAndFill(aG(i.attrs,"rowspan",h+i.attrs.rowspan-o))),c+=i.attrs.colspan-1}}return l}function $G(t,e,n,r,i,s,o,a){if(0==o||o==e.width)return!1;let l=!1;for(let c=i;c<s;c++){const i=c*e.width+o,s=e.map[i];if(e.map[i-1]==s){l=!0;const i=n.nodeAt(s),h=e.colCount(s),u=t.mapping.slice(a).map(s+r);t.setNodeMarkup(u,null,lG(i.attrs,o-h,i.attrs.colspan-(o-h))),t.insert(u+i.nodeSize,i.type.createAndFill(lG(i.attrs,0,o-h))),c+=i.attrs.rowspan-1}}return l}function YG(t,e,n,r,i){let s=n?t.doc.nodeAt(n-1):t.doc,o=Xz.get(s);const{top:a,left:l}=r,c=l+i.width,h=a+i.height,u=t.tr;let d=0;function f(){s=n?u.doc.nodeAt(n-1):u.doc,o=Xz.get(s),d=u.mapping.maps.length}(function(t,e,n,r,i,s,o){const a=eG(t.doc.type.schema);let l,c;if(i>e.width)for(let h=0,u=0;h<e.height;h++){const s=n.child(h);u+=s.nodeSize;const d=[];let f;f=null==s.lastChild||s.lastChild.type==a.cell?l||(l=a.cell.createAndFill()):c||(c=a.header_cell.createAndFill());for(let t=e.width;t<i;t++)d.push(f);t.insert(t.mapping.slice(o).map(u-1+r),d)}if(s>e.height){const h=[];for(let t=0,r=(e.height-1)*e.width;t<Math.max(e.width,i);t++){const i=!(t>=e.width)&&n.nodeAt(e.map[r+t]).type==a.header_cell;h.push(i?c||(c=a.header_cell.createAndFill()):l||(l=a.cell.createAndFill()))}const u=a.row.create(null,S_.from(h)),d=[];for(let t=e.height;t<s;t++)d.push(u);t.insert(t.mapping.slice(o).map(r+n.nodeSize-2),d)}return!(!l&&!c)})(u,o,s,n,c,h,d)&&f(),HG(u,o,s,n,l,c,a,d)&&f(),HG(u,o,s,n,l,c,h,d)&&f(),$G(u,o,s,n,a,h,l,d)&&f(),$G(u,o,s,n,a,h,c,d)&&f();for(let p=a;p<h;p++){const t=o.positionAt(p,l,s),e=o.positionAt(p,c,s);u.replace(u.mapping.slice(d).map(t+n),u.mapping.slice(d).map(e+n),new M_(i.rows[p-a],0,0))}f(),u.setSelection(new Kz(u.doc.resolve(n+o.positionAt(a,l,s)),u.doc.resolve(n+o.positionAt(h-1,c-1,s)))),e(u)}const XG=new Tk("fix-tables");function qG(t,e,n,r){const i=t.childCount,s=e.childCount;t:for(let o=0,a=0;o<s;o++){const s=e.child(o);for(let e=a,r=Math.min(i,o+3);e<r;e++)if(t.child(e)==s){a=e+1,n+=s.nodeSize;continue t}r(s,n),a<i&&t.child(a).sameMarkup(s)?qG(t.child(a),s,n+1,r):s.nodesBetween(0,s.content.size,r,n+1),n+=s.nodeSize}}function KG(t,e){let n;const r=(e,r)=>{"table"==e.type.spec.tableRole&&(n=function(t,e,n,r){const i=Xz.get(e);if(!i.problems)return r;r||(r=t.tr);const s=[];for(let l=0;l<i.height;l++)s.push(0);for(let l=0;l<i.problems.length;l++){const t=i.problems[l];if("collision"==t.type){const i=e.nodeAt(t.pos);for(let e=0;e<i.attrs.rowspan;e++)s[t.row+e]+=t.n;r.setNodeMarkup(r.mapping.map(n+1+t.pos),null,lG(i.attrs,i.attrs.colspan-t.n,t.n))}else if("missing"==t.type)s[t.row]+=t.n;else if("overlong_rowspan"==t.type){const i=e.nodeAt(t.pos);r.setNodeMarkup(r.mapping.map(n+1+t.pos),null,aG(i.attrs,"rowspan",i.attrs.rowspan-t.n))}else if("colwidth mismatch"==t.type){const i=e.nodeAt(t.pos);r.setNodeMarkup(r.mapping.map(n+1+t.pos),null,aG(i.attrs,"colwidth",t.colwidth))}}let o,a;for(let l=0;l<s.length;l++)s[l]&&(null==o&&(o=l),a=l);for(let l=0,c=n+1;l<i.height;l++){const n=e.child(l),i=c+n.nodeSize,h=s[l];if(h>0){let e="cell";n.firstChild&&(e=n.firstChild.type.spec.tableRole);const s=[];for(let n=0;n<h;n++)s.push(eG(t.schema)[e].createAndFill());const u=0!=l&&o!=l-1||a!=l?i-1:c+1;r.insert(r.mapping.map(u),s)}c=i}return r.setMeta(XG,{fixTables:!0})}(t,e,r,n))};return e?e.doc!=t.doc&&qG(e.doc,t.doc,0,r):t.doc.descendants(r),n}const ZG=new Tk("selectingCells");function JG(t,e){for(;e&&e!=t.dom;e=e.parentNode)if("TD"==e.nodeName||"TH"==e.nodeName)return e}function QG(t,e){const n=t.posAtCoords({left:e.clientX,top:e.clientY});return n&&n?rG(t.state.doc.resolve(n.pos)):null}function tW(t,e){const n=e;if(n.ctrlKey||n.metaKey)return;const r=JG(t,n.target);let i;if(n.shiftKey&&t.state.selection instanceof Kz)s(t.state.selection.$anchorCell,n),n.preventDefault();else if(n.shiftKey&&r&&null!=(i=rG(t.state.selection.$anchor))&&QG(t,n).pos!=i.pos)s(i,n),n.preventDefault();else if(!r)return;function s(e,n){let r=QG(t,n);const i=null==ZG.getState(t.state);if(!r||!sG(e,r)){if(!i)return;r=e}const s=new Kz(e,r);if(i||!t.state.selection.eq(s)){const n=t.state.tr.setSelection(s);i&&n.setMeta(ZG,e.pos),t.dispatch(n)}}function o(){t.root.removeEventListener("mouseup",o),t.root.removeEventListener("dragstart",o),t.root.removeEventListener("mousemove",a),null!=ZG.getState(t.state)&&t.dispatch(t.state.tr.setMeta(ZG,-1))}function a(e){const i=ZG.getState(t.state);let a;if(null!=i)a=t.state.doc.resolve(i);else if(JG(t,e.target)!=r&&(a=QG(t,n),!a))return o();a&&s(a,e)}t.root.addEventListener("mouseup",o),t.root.addEventListener("dragstart",o),t.root.addEventListener("mousemove",a)}function eW(t,e){const n=rG(t.state.doc.resolve(e));return!!n&&(t.dispatch(t.state.tr.setSelection(new Kz(n))),!0)}function nW(t,e,n){return!n.eq(t.selection)&&(e&&e(t.tr.setSelection(n).scrollIntoView()),!0)}function rW(t,e,n){if(!(t.state.selection instanceof ak))return null;const{$head:r}=t.state.selection;for(let i=r.depth-1;i>=0;i--){const s=r.node(i);if((n<0?r.index(i):r.indexAfter(i))!=(n<0?0:s.childCount))return null;if("cell"==s.type.spec.tableRole||"header_cell"==s.type.spec.tableRole){const s=r.before(i),o="vert"==e?n>0?"down":"up":n>0?"right":"left";return t.endOfTextblock(o)?s:null}}return null}function iW(t,e){return(n,r,i)=>{const s=n.selection;if(s instanceof Kz)return nW(n,r,rk.near(s.$headCell,e));if("horiz"!=t&&!s.empty)return!1;const o=rW(i,t,e);if(null==o)return!1;if("horiz"==t)return nW(n,r,rk.near(n.doc.resolve(s.head+e),e));{const i=n.doc.resolve(o),s=oG(i,t,e);let a;return a=s?rk.near(s,1):e<0?rk.near(n.doc.resolve(i.before(-1)),-1):rk.near(n.doc.resolve(i.after(-1)),1),nW(n,r,a)}}}function sW(t,e){return(n,r,i)=>{let s=n.selection;if(!(s instanceof Kz)){const r=rW(i,t,e);if(null==r)return!1;s=new Kz(n.doc.resolve(r))}const o=oG(s.$headCell,t,e);return!!o&&nW(n,r,new Kz(s.$anchorCell,o))}}function oW(t,e){const n=t.selection;if(!(n instanceof Kz))return!1;if(e){const r=t.tr,i=eG(t.schema).cell.createAndFill().content;n.forEachCell(((t,e)=>{t.content.eq(i)||r.replace(r.mapping.map(e+1),r.mapping.map(e+t.nodeSize-1),new M_(i,0,0))})),r.docChanged&&e(r)}return!0}const aW=EP({ArrowLeft:iW("horiz",-1),ArrowRight:iW("horiz",1),ArrowUp:iW("vert",-1),ArrowDown:iW("vert",1),"Shift-ArrowLeft":sW("horiz",-1),"Shift-ArrowRight":sW("horiz",1),"Shift-ArrowUp":sW("vert",-1),"Shift-ArrowDown":sW("vert",1),Backspace:oW,"Mod-Backspace":oW,Delete:oW,"Mod-Delete":oW});function lW(t,e,n){if(!cG(t.state))return!1;let r=GG(n);const i=t.state.selection;if(i instanceof Kz){r||(r={width:1,height:1,rows:[S_.from(WG(eG(t.state.schema).cell,n))]});const e=i.$anchorCell.node(-1),s=i.$anchorCell.start(-1),o=Xz.get(e).rectBetween(i.$anchorCell.pos-s,i.$headCell.pos-s);return r=function({width:t,height:e,rows:n},r,i){if(t!=r){const e=[],i=[];for(let t=0;t<n.length;t++){const s=n[t],o=[];for(let n=e[t]||0,i=0;n<r;i++){let a=s.child(i%s.childCount);n+a.attrs.colspan>r&&(a=a.type.create(lG(a.attrs,a.attrs.colspan,n+a.attrs.colspan-r),a.content)),o.push(a),n+=a.attrs.colspan;for(let n=1;n<a.attrs.rowspan;n++)e[t+n]=(e[t+n]||0)+a.attrs.colspan}i.push(S_.from(o))}n=i,t=r}if(e!=i){const t=[];for(let r=0,s=0;r<i;r++,s++){const o=[],a=n[s%e];for(let t=0;t<a.childCount;t++){let e=a.child(t);r+e.attrs.rowspan>i&&(e=e.type.create(aG(e.attrs,"rowspan",Math.max(1,i-e.attrs.rowspan)),e.content)),o.push(e)}t.push(S_.from(o))}n=t,e=i}return{width:t,height:e,rows:n}}(r,o.right-o.left,o.bottom-o.top),YG(t.state,t.dispatch,s,o,r),!0}if(r){const e=hG(t.state),n=e.start(-1);return YG(t.state,t.dispatch,n,Xz.get(e.node(-1)).findCell(e.pos-n),r),!0}return!1}function cW({allowTableNodeSelection:t=!1}={}){return new Ek({key:ZG,state:{init:()=>null,apply(t,e){const n=t.getMeta(ZG);if(null!=n)return-1==n?null:n;if(null==e||!t.docChanged)return e;const{deleted:r,pos:i}=t.mapping.mapResult(e);return r?null:i}},props:{decorations:Jz,handleDOMEvents:{mousedown:tW},createSelectionBetween:t=>null!=ZG.getState(t.state)?t.state.selection:null,handleTripleClick:eW,handleKeyDown:aW,handlePaste:lW},appendTransaction:(e,n,r)=>function(t,e,n){const r=(e||t).selection,i=(e||t).doc;let s,o;if(r instanceof ck&&(o=r.node.type.spec.tableRole)){if("cell"==o||"header_cell"==o)s=Kz.create(i,r.from);else if("row"==o){const t=i.resolve(r.from+1);s=Kz.rowSelection(t,t)}else if(!n){const t=Xz.get(r.node),e=r.from+1,n=e+t.map[t.width*t.height-1];s=Kz.create(i,e+1,n)}}else r instanceof ak&&function({$from:t,$to:e}){if(t.pos==e.pos||t.pos<t.pos-6)return!1;let n=t.pos,r=e.pos,i=t.depth;for(;i>=0&&!(t.after(i+1)<t.end(i));i--,n++);for(let s=e.depth;s>=0&&!(e.before(s+1)>e.start(s));s--,r--);return n==r&&/row|table/.test(t.node(i).type.spec.tableRole)}(r)?s=ak.create(i,r.from):r instanceof ak&&function({$from:t,$to:e}){let n,r;for(let i=t.depth;i>0;i--){const e=t.node(i);if("cell"===e.type.spec.tableRole||"header_cell"===e.type.spec.tableRole){n=e;break}}for(let i=e.depth;i>0;i--){const t=e.node(i);if("cell"===t.type.spec.tableRole||"header_cell"===t.type.spec.tableRole){r=t;break}}return n!==r&&0===e.parentOffset}(r)&&(s=ak.create(i,r.$from.start(),r.$from.end()));return s&&(e||(e=t.tr)).setSelection(s),e}(r,KG(r,n),t)})}const hW={NextCell:"NextCell",PrevCell:"PrevCell",ExitTable:"ExitTable"},uW=AL("PrevCell"),dW=AL("NextCell"),fW=AL("BreakTable"),pW=AL("InsertTable"),mW=tN((t=>({schema:()=>({node:{table:{...nG.table,parseMarkdown:{match:t=>"table"===t.type,runner:(t,e,n)=>{const r=e.align,i=e.children.map(((t,e)=>({...t,align:r,isHeader:0===e})));t.openNode(n),t.next(i),t.closeNode()}},toMarkdown:{match:t=>"table"===t.type.name,runner:(t,e)=>{var n;const r=null==(n=e.content.firstChild)?void 0:n.content;if(!r)return;const i=[];r.forEach((t=>{i.push(t.attrs.alignment)})),t.openNode("table",void 0,{align:i}),t.next(e.content),t.closeNode()}}},table_row:{...nG.table_row,parseMarkdown:{match:t=>"tableRow"===t.type,runner:(t,e,n)=>{const r=e.align,i=e.children.map(((t,n)=>({...t,align:r[n],isHeader:e.isHeader})));t.openNode(n),t.next(i),t.closeNode()}},toMarkdown:{match:t=>"table_row"===t.type.name,runner:(t,e)=>{t.openNode("tableRow"),t.next(e.content),t.closeNode()}}},table_cell:{...nG.table_cell,parseMarkdown:{match:t=>"tableCell"===t.type&&!t.isHeader,runner:(t,e,n)=>{const r=e.align;t.openNode(n,{alignment:r}).openNode(t.schema.nodes.paragraph).next(e.children).closeNode().closeNode()}},toMarkdown:{match:t=>"table_cell"===t.type.name,runner:(t,e)=>{t.openNode("tableCell").next(e.content).closeNode()}}},table_header:{...nG.table_header,parseMarkdown:{match:t=>"tableCell"===t.type&&!!t.isHeader,runner:(t,e,n)=>{const r=e.align;t.openNode(n,{alignment:r}),t.openNode(t.schema.nodes.paragraph),t.next(e.children),t.closeNode(),t.closeNode()}},toMarkdown:{match:t=>"table_header"===t.type.name,runner:(t,e)=>{t.openNode("tableCell"),t.next(e.content),t.closeNode()}}}}}),inputRules:(t,e)=>[new dO(/^\|\|\s$/,((n,r,i,s)=>{const o=n.doc.resolve(i);if(!o.node(-1).canReplaceWith(o.index(-1),o.indexAfter(-1),t.table))return null;const a=SG(e.get(YP)),l=n.tr.replaceRangeWith(i,s,a).scrollIntoView();return l.setSelection(ak.create(l.doc,i+3))})),new dO(/^\|(?<col>\d+)[xX](?<row>\d+)\|\s$/,((n,r,i,s)=>{var o,a;const l=n.doc.resolve(i);if(!l.node(-1).canReplaceWith(l.index(-1),l.indexAfter(-1),t.table))return null;const c=SG(e.get(YP),Number(null==(o=r.groups)?void 0:o.row),Number(null==(a=r.groups)?void 0:a.col)),h=n.tr.replaceRangeWith(i,s,c).scrollIntoView();return h.setSelection(ak.create(h.doc,i+3))}))],commands:(t,e)=>[kL(uW,(()=>wG(-1))),kL(dW,(()=>wG(1))),kL(fW,(()=>(t=>(e,n)=>{if(!cG(e))return!1;const{$head:r}=e.selection,i=r.after(),s=e.tr.replaceWith(i,i,t.createAndFill());return s.setSelection(rk.near(s.doc.resolve(i),1)),null==n||n(s.scrollIntoView()),!0})(e.get(YP).nodes.paragraph))),kL(pW,(()=>(t,n)=>{const{selection:r,tr:i}=t,{from:s}=r,o=SG(e.get(YP)),a=i.replaceSelectionWith(o),l=rk.findFrom(a.doc.resolve(s),1,!0);return l&&(null==n||n(a.setSelection(l))),!0}))],shortcuts:{[hW.NextCell]:TF(dW,"Mod-]"),[hW.PrevCell]:TF(uW,"Mod-["),[hW.ExitTable]:TF(fW,"Mod-Enter")},prosePlugins:(e,n)=>[DG(n,t),new Ek({key:OG,props:{handleDOMEvents:{compositionstart(t){const{state:e,dispatch:n}=t,{tr:r,selection:i}=e,{$from:s}=i;return PO.safari&&cG(e)&&i.empty&&(t=>"paragraph"===t.type.name&&2===t.nodeSize)(s.parent)&&n(r.insertText("⁠",s.start())),!1},compositionend(t){const{state:e,dispatch:n}=t,{tr:r,selection:i}=e,{$from:s}=i;return PO.safari&&cG(e)&&i.empty&&(t=>"paragraph"===t.type.name)(s.parent)&&s.parent.textContent.startsWith("⁠")&&n(r.delete(s.start(),s.start()+1)),!1}}}}),NG(),cW()]}))),gW={...XU,...hW,StrikeThrough:"StrikeThrough",TaskList:"TaskList"},vW=AL("ToggleStrikeThrough"),yW="strike_through",bW=JF((t=>({id:yW,schema:()=>({inclusive:!1,parseDOM:[{tag:"del"},{style:"text-decoration",getAttrs:t=>"line-through"===t}],toDOM:e=>["del",{class:t.getClassName(e.attrs,"strike-through")}],parseMarkdown:{match:t=>"delete"===t.type,runner:(t,e,n)=>{t.openMark(n),t.next(e.children),t.closeMark(n)}},toMarkdown:{match:t=>t.type.name===yW,runner:(t,e)=>{t.withMark(e,"delete")}}}),commands:t=>[kL(vW,(()=>sP(t)))],shortcuts:{[gW.StrikeThrough]:TF(vW,"Mod-Alt-x")}}))),xW=AL("SplitTaskListItem"),wW=AL("SinkTaskListItem"),EW=AL("LiftTaskListItem"),_W=AL("TurnIntoTaskList"),SW=QF((t=>{const e="task_list_item";return{id:e,schema:n=>({group:"listItem",content:"paragraph block*",defining:!0,priority:60,attrs:{checked:{default:!1}},parseDOM:[{tag:'li[data-type="task-item"]',getAttrs:t=>{if(!(t instanceof HTMLElement))throw nw(t);return{checked:"true"===t.dataset.checked}}}],toDOM:e=>{const r=document.createElement("input");return r.type="checkbox",r.checked=e.attrs.checked,r.className=t.getClassName(e.attrs,"task-list-item_checkbox"),r.onchange=t=>{const e=t.target;if(!(e instanceof HTMLInputElement))return;const i=n.get(mL);if(!i.editable)return void(r.checked=!r.checked);const{top:s,left:o}=e.getBoundingClientRect(),a=i.posAtCoords({top:s,left:o});if(!a)return;const{tr:l}=i.state;i.dispatch(l.setNodeMarkup(a.inside,void 0,{checked:e.checked}))},["li",{"data-type":"task-item","data-checked":e.attrs.checked?"true":"false",class:t.getClassName(e.attrs,"task-list-item")},r,["span",{class:t.getClassName(e.attrs,"task-list-item_body")},0]]},parseMarkdown:{match:({type:t,checked:e})=>"listItem"===t&&null!==e,runner:(t,e,n)=>{t.openNode(n,{checked:e.checked}),t.next(e.children),t.closeNode()}},toMarkdown:{match:t=>t.type.name===e,runner:(t,e)=>{t.openNode("listItem",void 0,{checked:e.attrs.checked}),t.next(e.content),t.closeNode()}}}),inputRules:t=>[fO(/^\s*(\[([ |x])\])\s$/,t,(t=>({checked:"x"===t[t.length-1]})))],commands:t=>[kL(xW,(()=>eN(t))),kL(wW,(()=>rN(t))),kL(EW,(()=>nN(t))),kL(_W,(()=>rP(t)))],shortcuts:{[gW.NextListItem]:TF(xW,"Enter"),[gW.SinkListItem]:TF(wW,"Mod-]"),[gW.LiftListItem]:TF(EW,"Mod-["),[gW.TaskList]:TF(_W,"Mod-Alt-9")},view:()=>(n,r,i)=>{let s=n;const o=t.themeManager.get("task-list-item",{editable:()=>r.editable,onChange:t=>{const{tr:e}=r.state;r.dispatch(e.setNodeMarkup(i(),void 0,{checked:t}))}});if(!o)return{};const{dom:a,contentDOM:l,onUpdate:c}=o;return c(s),{dom:a,contentDOM:l,update:t=>t.type.name===e&&(s=t,c(s),!0)}}}})),TW=EF.create([...bj,(t=>{const e=()=>async n=>{await n.wait(FP);const r=t(n);n.update(jP,(t=>[...t,r])),e.plugin=r};return e})((()=>Lz)),mW(),bW(),SW(),Hz(),zz()]);var kW=(t=>(t[t.WEBGL_LEGACY=0]="WEBGL_LEGACY",t[t.WEBGL=1]="WEBGL",t[t.WEBGL2=2]="WEBGL2",t))(kW||{}),AW=(t=>(t[t.COLOR=16384]="COLOR",t[t.DEPTH=256]="DEPTH",t[t.STENCIL=1024]="STENCIL",t))(AW||{}),CW=(t=>(t[t.NORMAL=0]="NORMAL",t[t.ADD=1]="ADD",t[t.MULTIPLY=2]="MULTIPLY",t[t.SCREEN=3]="SCREEN",t[t.OVERLAY=4]="OVERLAY",t[t.DARKEN=5]="DARKEN",t[t.LIGHTEN=6]="LIGHTEN",t[t.COLOR_DODGE=7]="COLOR_DODGE",t[t.COLOR_BURN=8]="COLOR_BURN",t[t.HARD_LIGHT=9]="HARD_LIGHT",t[t.SOFT_LIGHT=10]="SOFT_LIGHT",t[t.DIFFERENCE=11]="DIFFERENCE",t[t.EXCLUSION=12]="EXCLUSION",t[t.HUE=13]="HUE",t[t.SATURATION=14]="SATURATION",t[t.COLOR=15]="COLOR",t[t.LUMINOSITY=16]="LUMINOSITY",t[t.NORMAL_NPM=17]="NORMAL_NPM",t[t.ADD_NPM=18]="ADD_NPM",t[t.SCREEN_NPM=19]="SCREEN_NPM",t[t.NONE=20]="NONE",t[t.SRC_OVER=0]="SRC_OVER",t[t.SRC_IN=21]="SRC_IN",t[t.SRC_OUT=22]="SRC_OUT",t[t.SRC_ATOP=23]="SRC_ATOP",t[t.DST_OVER=24]="DST_OVER",t[t.DST_IN=25]="DST_IN",t[t.DST_OUT=26]="DST_OUT",t[t.DST_ATOP=27]="DST_ATOP",t[t.ERASE=26]="ERASE",t[t.SUBTRACT=28]="SUBTRACT",t[t.XOR=29]="XOR",t))(CW||{}),RW=(t=>(t[t.POINTS=0]="POINTS",t[t.LINES=1]="LINES",t[t.LINE_LOOP=2]="LINE_LOOP",t[t.LINE_STRIP=3]="LINE_STRIP",t[t.TRIANGLES=4]="TRIANGLES",t[t.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=6]="TRIANGLE_FAN",t))(RW||{}),MW=(t=>(t[t.RGBA=6408]="RGBA",t[t.RGB=6407]="RGB",t[t.RG=33319]="RG",t[t.RED=6403]="RED",t[t.RGBA_INTEGER=36249]="RGBA_INTEGER",t[t.RGB_INTEGER=36248]="RGB_INTEGER",t[t.RG_INTEGER=33320]="RG_INTEGER",t[t.RED_INTEGER=36244]="RED_INTEGER",t[t.ALPHA=6406]="ALPHA",t[t.LUMINANCE=6409]="LUMINANCE",t[t.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",t[t.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",t[t.DEPTH_STENCIL=34041]="DEPTH_STENCIL",t))(MW||{}),IW=(t=>(t[t.TEXTURE_2D=3553]="TEXTURE_2D",t[t.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",t[t.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",t[t.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t))(IW||{}),DW=(t=>(t[t.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",t[t.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",t[t.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",t[t.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",t[t.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",t[t.UNSIGNED_INT=5125]="UNSIGNED_INT",t[t.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",t[t.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",t[t.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",t[t.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",t[t.BYTE=5120]="BYTE",t[t.SHORT=5122]="SHORT",t[t.INT=5124]="INT",t[t.FLOAT=5126]="FLOAT",t[t.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",t[t.HALF_FLOAT=36193]="HALF_FLOAT",t))(DW||{}),OW=(t=>(t[t.FLOAT=0]="FLOAT",t[t.INT=1]="INT",t[t.UINT=2]="UINT",t))(OW||{}),PW=(t=>(t[t.NEAREST=0]="NEAREST",t[t.LINEAR=1]="LINEAR",t))(PW||{}),LW=(t=>(t[t.CLAMP=33071]="CLAMP",t[t.REPEAT=10497]="REPEAT",t[t.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",t))(LW||{}),FW=(t=>(t[t.OFF=0]="OFF",t[t.POW2=1]="POW2",t[t.ON=2]="ON",t[t.ON_MANUAL=3]="ON_MANUAL",t))(FW||{}),NW=(t=>(t[t.NPM=0]="NPM",t[t.UNPACK=1]="UNPACK",t[t.PMA=2]="PMA",t[t.NO_PREMULTIPLIED_ALPHA=0]="NO_PREMULTIPLIED_ALPHA",t[t.PREMULTIPLY_ON_UPLOAD=1]="PREMULTIPLY_ON_UPLOAD",t[t.PREMULTIPLIED_ALPHA=2]="PREMULTIPLIED_ALPHA",t))(NW||{}),BW=(t=>(t[t.NO=0]="NO",t[t.YES=1]="YES",t[t.AUTO=2]="AUTO",t[t.BLEND=0]="BLEND",t[t.CLEAR=1]="CLEAR",t[t.BLIT=2]="BLIT",t))(BW||{}),UW=(t=>(t[t.AUTO=0]="AUTO",t[t.MANUAL=1]="MANUAL",t))(UW||{}),VW=(t=>(t.LOW="lowp",t.MEDIUM="mediump",t.HIGH="highp",t))(VW||{}),jW=(t=>(t[t.NONE=0]="NONE",t[t.SCISSOR=1]="SCISSOR",t[t.STENCIL=2]="STENCIL",t[t.SPRITE=3]="SPRITE",t[t.COLOR=4]="COLOR",t))(jW||{}),zW=(t=>(t[t.NONE=0]="NONE",t[t.LOW=2]="LOW",t[t.MEDIUM=4]="MEDIUM",t[t.HIGH=8]="HIGH",t))(zW||{}),GW=(t=>(t[t.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",t[t.ARRAY_BUFFER=34962]="ARRAY_BUFFER",t[t.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",t))(GW||{});const WW={ADAPTER:{createCanvas:(t,e)=>{const n=document.createElement("canvas");return n.width=t,n.height=e,n},getCanvasRenderingContext2D:()=>CanvasRenderingContext2D,getWebGLRenderingContext:()=>WebGLRenderingContext,getNavigator:()=>navigator,getBaseUrl:()=>document.baseURI??window.location.href,getFontFaceSet:()=>document.fonts,fetch:(t,e)=>fetch(t,e),parseXML:t=>(new DOMParser).parseFromString(t,"text/xml")},RESOLUTION:1,RENDER_OPTIONS:{view:null,width:800,height:600,autoDensity:!1,backgroundColor:0,backgroundAlpha:1,clearBeforeRender:!0,antialias:!1,premultipliedAlpha:!0,preserveDrawingBuffer:!1,hello:!1},CREATE_IMAGE_BITMAP:!1,ROUND_PIXELS:!1};var HW=/iPhone/i,$W=/iPod/i,YW=/iPad/i,XW=/\biOS-universal(?:.+)Mac\b/i,qW=/\bAndroid(?:.+)Mobile\b/i,KW=/Android/i,ZW=/(?:SD4930UR|\bSilk(?:.+)Mobile\b)/i,JW=/Silk/i,QW=/Windows Phone/i,tH=/\bWindows(?:.+)ARM\b/i,eH=/BlackBerry/i,nH=/BB10/i,rH=/Opera Mini/i,iH=/\b(CriOS|Chrome)(?:.+)Mobile/i,sH=/Mobile(?:.+)Firefox\b/i,oH=function(t){return void 0!==t&&"MacIntel"===t.platform&&"number"==typeof t.maxTouchPoints&&t.maxTouchPoints>1&&"undefined"==typeof MSStream};const aH=function(t){var e={userAgent:"",platform:"",maxTouchPoints:0};t||"undefined"==typeof navigator?"string"==typeof t?e.userAgent=t:t&&t.userAgent&&(e={userAgent:t.userAgent,platform:t.platform,maxTouchPoints:t.maxTouchPoints||0}):e={userAgent:navigator.userAgent,platform:navigator.platform,maxTouchPoints:navigator.maxTouchPoints||0};var n=e.userAgent,r=n.split("[FBAN");void 0!==r[1]&&(n=r[0]),void 0!==(r=n.split("Twitter"))[1]&&(n=r[0]);var i=function(t){return function(e){return e.test(t)}}(n),s={apple:{phone:i(HW)&&!i(QW),ipod:i($W),tablet:!i(HW)&&(i(YW)||oH(e))&&!i(QW),universal:i(XW),device:(i(HW)||i($W)||i(YW)||i(XW)||oH(e))&&!i(QW)},amazon:{phone:i(ZW),tablet:!i(ZW)&&i(JW),device:i(ZW)||i(JW)},android:{phone:!i(QW)&&i(ZW)||!i(QW)&&i(qW),tablet:!i(QW)&&!i(ZW)&&!i(qW)&&(i(JW)||i(KW)),device:!i(QW)&&(i(ZW)||i(JW)||i(qW)||i(KW))||i(/\bokhttp\b/i)},windows:{phone:i(QW),tablet:i(tH),device:i(QW)||i(tH)},other:{blackberry:i(eH),blackberry10:i(nH),opera:i(rH),firefox:i(sH),chrome:i(iH),device:i(eH)||i(nH)||i(rH)||i(sH)||i(iH)},any:!1,phone:!1,tablet:!1};return s.any=s.apple.device||s.android.device||s.windows.device||s.other.device,s.phone=s.apple.phone||s.android.phone||s.windows.phone,s.tablet=s.apple.tablet||s.android.tablet||s.windows.tablet,s}(globalThis.navigator);WW.RETINA_PREFIX=/@([0-9\.]+)x/,WW.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT=!1;var lH={exports:{}};!function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,r,s,o){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,s||t,o),l=n?n+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function o(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},a.prototype.listeners=function(t){var e=n?n+t:t,r=this._events[e];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,s=r.length,o=new Array(s);i<s;i++)o[i]=r[i].fn;return o},a.prototype.listenerCount=function(t){var e=n?n+t:t,r=this._events[e];return r?r.fn?1:r.length:0},a.prototype.emit=function(t,e,r,i,s,o){var a=n?n+t:t;if(!this._events[a])return!1;var l,c,h=this._events[a],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,r),!0;case 4:return h.fn.call(h.context,e,r,i),!0;case 5:return h.fn.call(h.context,e,r,i,s),!0;case 6:return h.fn.call(h.context,e,r,i,s,o),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];h.fn.apply(h.context,l)}else{var d,f=h.length;for(c=0;c<f;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),u){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,r);break;case 4:h[c].fn.call(h[c].context,e,r,i);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];h[c].fn.apply(h[c].context,l)}}return!0},a.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},a.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},a.prototype.removeListener=function(t,e,r,i){var s=n?n+t:t;if(!this._events[s])return this;if(!e)return o(this,s),this;var a=this._events[s];if(a.fn)a.fn!==e||i&&!a.once||r&&a.context!==r||o(this,s);else{for(var l=0,c=[],h=a.length;l<h;l++)(a[l].fn!==e||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[s]=1===c.length?c[0]:c:o(this,s)}return this},a.prototype.removeAllListeners=function(t){var e;return t?(e=n?n+t:t,this._events[e]&&o(this,e)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,t.exports=a}(lH);const cH=ni(lH.exports);var hH={exports:{}};function uH(t,e,n){n=n||2;var r,i,s,o,a,l,c,h=e&&e.length,u=h?e[0]*n:t.length,d=dH(t,0,u,n,!0),f=[];if(!d||d.next===d.prev)return f;if(h&&(d=function(t,e,n,r){var i,s,o,a=[];for(i=0,s=e.length;i<s;i++)(o=dH(t,e[i]*r,i<s-1?e[i+1]*r:t.length,r,!1))===o.next&&(o.steiner=!0),a.push(_H(o));for(a.sort(bH),i=0;i<a.length;i++)n=xH(a[i],n);return n}(t,e,d,n)),t.length>80*n){r=s=t[0],i=o=t[1];for(var p=n;p<u;p+=n)(a=t[p])<r&&(r=a),(l=t[p+1])<i&&(i=l),a>s&&(s=a),l>o&&(o=l);c=0!==(c=Math.max(s-r,o-i))?32767/c:0}return pH(d,f,n,r,i,c,0),f}function dH(t,e,n,r,i){var s,o;if(i===FH(t,e,n,r)>0)for(s=e;s<n;s+=r)o=OH(s,t[s],t[s+1],o);else for(s=n-r;s>=e;s-=r)o=OH(s,t[s],t[s+1],o);return o&&AH(o,o.next)&&(PH(o),o=o.next),o}function fH(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!AH(r,r.next)&&0!==kH(r.prev,r,r.next))r=r.next;else{if(PH(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function pH(t,e,n,r,i,s,o){if(t){!o&&s&&function(t,e,n,r){var i=t;do{0===i.z&&(i.z=EH(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,s,o,a,l,c=1;do{for(n=t,t=null,s=null,o=0;n;){for(o++,r=n,a=0,e=0;e<c&&(a++,r=r.nextZ);e++);for(l=c;a>0||l>0&&r;)0!==a&&(0===l||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,l--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;n=r}s.nextZ=null,c*=2}while(o>1)}(i)}(t,r,i,s);for(var a,l,c=t;t.prev!==t.next;)if(a=t.prev,l=t.next,s?gH(t,r,i,s):mH(t))e.push(a.i/n|0),e.push(t.i/n|0),e.push(l.i/n|0),PH(t),t=l.next,c=l.next;else if((t=l)===c){o?1===o?pH(t=vH(fH(t),e,n),e,n,r,i,s,2):2===o&&yH(t,e,n,r,i,s):pH(fH(t),e,n,r,i,s,1);break}}}function mH(t){var e=t.prev,n=t,r=t.next;if(kH(e,n,r)>=0)return!1;for(var i=e.x,s=n.x,o=r.x,a=e.y,l=n.y,c=r.y,h=i<s?i<o?i:o:s<o?s:o,u=a<l?a<c?a:c:l<c?l:c,d=i>s?i>o?i:o:s>o?s:o,f=a>l?a>c?a:c:l>c?l:c,p=r.next;p!==e;){if(p.x>=h&&p.x<=d&&p.y>=u&&p.y<=f&&SH(i,a,s,l,o,c,p.x,p.y)&&kH(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function gH(t,e,n,r){var i=t.prev,s=t,o=t.next;if(kH(i,s,o)>=0)return!1;for(var a=i.x,l=s.x,c=o.x,h=i.y,u=s.y,d=o.y,f=a<l?a<c?a:c:l<c?l:c,p=h<u?h<d?h:d:u<d?u:d,m=a>l?a>c?a:c:l>c?l:c,g=h>u?h>d?h:d:u>d?u:d,v=EH(f,p,e,n,r),y=EH(m,g,e,n,r),b=t.prevZ,x=t.nextZ;b&&b.z>=v&&x&&x.z<=y;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&SH(a,h,l,u,c,d,b.x,b.y)&&kH(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==o&&SH(a,h,l,u,c,d,x.x,x.y)&&kH(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=v;){if(b.x>=f&&b.x<=m&&b.y>=p&&b.y<=g&&b!==i&&b!==o&&SH(a,h,l,u,c,d,b.x,b.y)&&kH(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=y;){if(x.x>=f&&x.x<=m&&x.y>=p&&x.y<=g&&x!==i&&x!==o&&SH(a,h,l,u,c,d,x.x,x.y)&&kH(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function vH(t,e,n){var r=t;do{var i=r.prev,s=r.next.next;!AH(i,s)&&CH(i,r,r.next,s)&&IH(i,s)&&IH(s,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(s.i/n|0),PH(r),PH(r.next),r=t=s),r=r.next}while(r!==t);return fH(r)}function yH(t,e,n,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&TH(o,a)){var l=DH(o,a);return o=fH(o,o.next),l=fH(l,l.next),pH(o,e,n,r,i,s,0),void pH(l,e,n,r,i,s,0)}a=a.next}o=o.next}while(o!==t)}function bH(t,e){return t.x-e.x}function xH(t,e){var n=function(t,e){var n,r=e,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,n=r.x<r.next.x?r:r.next,a===i))return n}r=r.next}while(r!==e);if(!n)return null;var l,c=n,h=n.x,u=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=h&&i!==r.x&&SH(s<u?i:o,s,h,u,s<u?o:i,s,r.x,r.y)&&(l=Math.abs(s-r.y)/(i-r.x),IH(r,t)&&(l<d||l===d&&(r.x>n.x||r.x===n.x&&wH(n,r)))&&(n=r,d=l)),r=r.next}while(r!==c);return n}(t,e);if(!n)return e;var r=DH(n,t);return fH(r,r.next),fH(n,n.next)}function wH(t,e){return kH(t.prev,t,e.prev)<0&&kH(e.next,t,t.next)<0}function EH(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function _H(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function SH(t,e,n,r,i,s,o,a){return(i-o)*(e-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(n-o)*(e-a)&&(n-o)*(s-a)>=(i-o)*(r-a)}function TH(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&CH(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(IH(t,e)&&IH(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,s=(t.y+e.y)/2;do{n.y>s!=n.next.y>s&&n.next.y!==n.y&&i<(n.next.x-n.x)*(s-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(kH(t.prev,t,e.prev)||kH(t,e.prev,e))||AH(t,e)&&kH(t.prev,t,t.next)>0&&kH(e.prev,e,e.next)>0)}function kH(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function AH(t,e){return t.x===e.x&&t.y===e.y}function CH(t,e,n,r){var i=MH(kH(t,e,n)),s=MH(kH(t,e,r)),o=MH(kH(n,r,t)),a=MH(kH(n,r,e));return i!==s&&o!==a||(!(0!==i||!RH(t,n,e))||(!(0!==s||!RH(t,r,e))||(!(0!==o||!RH(n,t,r))||!(0!==a||!RH(n,e,r)))))}function RH(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function MH(t){return t>0?1:t<0?-1:0}function IH(t,e){return kH(t.prev,t,t.next)<0?kH(t,e,t.next)>=0&&kH(t,t.prev,e)>=0:kH(t,e,t.prev)<0||kH(t,t.next,e)<0}function DH(t,e){var n=new LH(t.i,t.x,t.y),r=new LH(e.i,e.x,e.y),i=t.next,s=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,s.next=r,r.prev=s,r}function OH(t,e,n,r){var i=new LH(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function PH(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function LH(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function FH(t,e,n,r){for(var i=0,s=e,o=n-r;s<n;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}hH.exports=uH,hH.exports.default=uH,uH.deviation=function(t,e,n,r){var i=e&&e.length,s=i?e[0]*n:t.length,o=Math.abs(FH(t,0,s,n));if(i)for(var a=0,l=e.length;a<l;a++){var c=e[a]*n,h=a<l-1?e[a+1]*n:t.length;o-=Math.abs(FH(t,c,h,n))}var u=0;for(a=0;a<r.length;a+=3){var d=r[a]*n,f=r[a+1]*n,p=r[a+2]*n;u+=Math.abs((t[d]-t[p])*(t[f+1]-t[d+1])-(t[d]-t[f])*(t[p+1]-t[d+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},uH.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<e;o++)n.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n};const NH=ni(hH.exports);var BH={exports:{}};
/*! https://mths.be/punycode v1.4.1 by @mathias */!function(t,e){!function(n){var r=e&&!e.nodeType&&e,i=t&&!t.nodeType&&t,s="object"==typeof ei&&ei;s.global!==s&&s.window!==s&&s.self!==s||(n=s);var o,a,l=2147483647,c=36,h=1,u=26,d=38,f=700,p=72,m=128,g="-",v=/^xn--/,y=/[^\x20-\x7E]/,b=/[\x2E\u3002\uFF0E\uFF61]/g,x={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},w=c-h,E=Math.floor,_=String.fromCharCode;function S(t){throw new RangeError(x[t])}function T(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function k(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+T((t=t.replace(b,".")).split("."),e).join(".")}function A(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function C(t){return T(t,(function(t){var e="";return t>65535&&(e+=_((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+=_(t)})).join("")}function R(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function M(t,e,n){var r=0;for(t=n?E(t/f):t>>1,t+=E(t/e);t>w*u>>1;r+=c)t=E(t/w);return E(r+(w+1)*t/(t+d))}function I(t){var e,n,r,i,s,o,a,d,f,v,y,b=[],x=t.length,w=0,_=m,T=p;for((n=t.lastIndexOf(g))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&S("not-basic"),b.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<x;){for(s=w,o=1,a=c;i>=x&&S("invalid-input"),((d=(y=t.charCodeAt(i++))-48<10?y-22:y-65<26?y-65:y-97<26?y-97:c)>=c||d>E((l-w)/o))&&S("overflow"),w+=d*o,!(d<(f=a<=T?h:a>=T+u?u:a-T));a+=c)o>E(l/(v=c-f))&&S("overflow"),o*=v;T=M(w-s,e=b.length+1,0==s),E(w/e)>l-_&&S("overflow"),_+=E(w/e),w%=e,b.splice(w++,0,_)}return C(b)}function D(t){var e,n,r,i,s,o,a,d,f,v,y,b,x,w,T,k=[];for(b=(t=A(t)).length,e=m,n=0,s=p,o=0;o<b;++o)(y=t[o])<128&&k.push(_(y));for(r=i=k.length,i&&k.push(g);r<b;){for(a=l,o=0;o<b;++o)(y=t[o])>=e&&y<a&&(a=y);for(a-e>E((l-n)/(x=r+1))&&S("overflow"),n+=(a-e)*x,e=a,o=0;o<b;++o)if((y=t[o])<e&&++n>l&&S("overflow"),y==e){for(d=n,f=c;!(d<(v=f<=s?h:f>=s+u?u:f-s));f+=c)T=d-v,w=c-v,k.push(_(R(v+T%w,0))),d=E(T/w);k.push(_(R(d,0))),s=M(n,x,r==i),n=0,++r}++n,++e}return k.join("")}if(o={version:"1.4.1",ucs2:{decode:A,encode:C},decode:I,encode:D,toASCII:function(t){return k(t,(function(t){return y.test(t)?"xn--"+D(t):t}))},toUnicode:function(t){return k(t,(function(t){return v.test(t)?I(t.slice(4).toLowerCase()):t}))}},r&&i)if(t.exports==r)i.exports=o;else for(a in o)o.hasOwnProperty(a)&&(r[a]=o[a]);else n.punycode=o}(ei)}(BH,BH.exports);var UH=BH.exports;function VH(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}var jH=/^([a-z0-9.+-]+:)/i,zH=/:[0-9]*$/,GH=/^(\/\/?(?!\/)[^?\s]*)(\?[^\s]*)?$/,WH=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),HH=["'"].concat(WH),$H=["%","/","?",";","#"].concat(HH),YH=["/","?","#"],XH=/^[+a-z0-9A-Z_-]{0,63}$/,qH=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,KH={javascript:!0,"javascript:":!0},ZH={javascript:!0,"javascript:":!0},JH={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},QH=Oa;function t$(t,e,n){if(t&&"object"==typeof t&&t instanceof VH)return t;var r=new VH;return r.parse(t,e,n),r}VH.prototype.parse=function(t,e,n){if("string"!=typeof t)throw new TypeError("Parameter 'url' must be a string, not "+typeof t);var r=t.indexOf("?"),i=-1!==r&&r<t.indexOf("#")?"?":"#",s=t.split(i);s[0]=s[0].replace(/\\/g,"/");var o=t=s.join(i);if(o=o.trim(),!n&&1===t.split("#").length){var a=GH.exec(o);if(a)return this.path=o,this.href=o,this.pathname=a[1],a[2]?(this.search=a[2],this.query=e?QH.parse(this.search.substr(1)):this.search.substr(1)):e&&(this.search="",this.query={}),this}var l=jH.exec(o);if(l){var c=(l=l[0]).toLowerCase();this.protocol=c,o=o.substr(l.length)}if(n||l||o.match(/^\/\/[^@/]+@[^@/]+/)){var h="//"===o.substr(0,2);!h||l&&ZH[l]||(o=o.substr(2),this.slashes=!0)}if(!ZH[l]&&(h||l&&!JH[l])){for(var u,d,f=-1,p=0;p<YH.length;p++){-1!==(m=o.indexOf(YH[p]))&&(-1===f||m<f)&&(f=m)}-1!==(d=-1===f?o.lastIndexOf("@"):o.lastIndexOf("@",f))&&(u=o.slice(0,d),o=o.slice(d+1),this.auth=decodeURIComponent(u)),f=-1;for(p=0;p<$H.length;p++){var m;-1!==(m=o.indexOf($H[p]))&&(-1===f||m<f)&&(f=m)}-1===f&&(f=o.length),this.host=o.slice(0,f),o=o.slice(f),this.parseHost(),this.hostname=this.hostname||"";var g="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!g)for(var v=this.hostname.split(/\./),y=(p=0,v.length);p<y;p++){var b=v[p];if(b&&!b.match(XH)){for(var x="",w=0,E=b.length;w<E;w++)b.charCodeAt(w)>127?x+="x":x+=b[w];if(!x.match(XH)){var _=v.slice(0,p),S=v.slice(p+1),T=b.match(qH);T&&(_.push(T[1]),S.unshift(T[2])),S.length&&(o="/"+S.join(".")+o),this.hostname=_.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),g||(this.hostname=UH.toASCII(this.hostname));var k=this.port?":"+this.port:"",A=this.hostname||"";this.host=A+k,this.href+=this.host,g&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==o[0]&&(o="/"+o))}if(!KH[c])for(p=0,y=HH.length;p<y;p++){var C=HH[p];if(-1!==o.indexOf(C)){var R=encodeURIComponent(C);R===C&&(R=escape(C)),o=o.split(C).join(R)}}var M=o.indexOf("#");-1!==M&&(this.hash=o.substr(M),o=o.slice(0,M));var I=o.indexOf("?");if(-1!==I?(this.search=o.substr(I),this.query=o.substr(I+1),e&&(this.query=QH.parse(this.query)),o=o.slice(0,I)):e&&(this.search="",this.query={}),o&&(this.pathname=o),JH[c]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){k=this.pathname||"";var D=this.search||"";this.path=k+D}return this.href=this.format(),this},VH.prototype.format=function(){var t=this.auth||"";t&&(t=(t=encodeURIComponent(t)).replace(/%3A/i,":"),t+="@");var e=this.protocol||"",n=this.pathname||"",r=this.hash||"",i=!1,s="";this.host?i=t+this.host:this.hostname&&(i=t+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(i+=":"+this.port)),this.query&&"object"==typeof this.query&&Object.keys(this.query).length&&(s=QH.stringify(this.query,{arrayFormat:"repeat",addQueryPrefix:!1}));var o=this.search||s&&"?"+s||"";return e&&":"!==e.substr(-1)&&(e+=":"),this.slashes||(!e||JH[e])&&!1!==i?(i="//"+(i||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):i||(i=""),r&&"#"!==r.charAt(0)&&(r="#"+r),o&&"?"!==o.charAt(0)&&(o="?"+o),e+i+(n=n.replace(/[?#]/g,(function(t){return encodeURIComponent(t)})))+(o=o.replace("#","%23"))+r},VH.prototype.resolve=function(t){return this.resolveObject(t$(t,!1,!0)).format()},VH.prototype.resolveObject=function(t){if("string"==typeof t){var e=new VH;e.parse(t,!1,!0),t=e}for(var n=new VH,r=Object.keys(this),i=0;i<r.length;i++){var s=r[i];n[s]=this[s]}if(n.hash=t.hash,""===t.href)return n.href=n.format(),n;if(t.slashes&&!t.protocol){for(var o=Object.keys(t),a=0;a<o.length;a++){var l=o[a];"protocol"!==l&&(n[l]=t[l])}return JH[n.protocol]&&n.hostname&&!n.pathname&&(n.pathname="/",n.path=n.pathname),n.href=n.format(),n}if(t.protocol&&t.protocol!==n.protocol){if(!JH[t.protocol]){for(var c=Object.keys(t),h=0;h<c.length;h++){var u=c[h];n[u]=t[u]}return n.href=n.format(),n}if(n.protocol=t.protocol,t.host||ZH[t.protocol])n.pathname=t.pathname;else{for(var d=(t.pathname||"").split("/");d.length&&!(t.host=d.shift()););t.host||(t.host=""),t.hostname||(t.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=t.search,n.query=t.query,n.host=t.host||"",n.auth=t.auth,n.hostname=t.hostname||t.host,n.port=t.port,n.pathname||n.search){var f=n.pathname||"",p=n.search||"";n.path=f+p}return n.slashes=n.slashes||t.slashes,n.href=n.format(),n}var m=n.pathname&&"/"===n.pathname.charAt(0),g=t.host||t.pathname&&"/"===t.pathname.charAt(0),v=g||m||n.host&&t.pathname,y=v,b=n.pathname&&n.pathname.split("/")||[],x=(d=t.pathname&&t.pathname.split("/")||[],n.protocol&&!JH[n.protocol]);if(x&&(n.hostname="",n.port=null,n.host&&(""===b[0]?b[0]=n.host:b.unshift(n.host)),n.host="",t.protocol&&(t.hostname=null,t.port=null,t.host&&(""===d[0]?d[0]=t.host:d.unshift(t.host)),t.host=null),v=v&&(""===d[0]||""===b[0])),g)n.host=t.host||""===t.host?t.host:n.host,n.hostname=t.hostname||""===t.hostname?t.hostname:n.hostname,n.search=t.search,n.query=t.query,b=d;else if(d.length)b||(b=[]),b.pop(),b=b.concat(d),n.search=t.search,n.query=t.query;else if(null!=t.search){if(x)n.host=b.shift(),n.hostname=n.host,(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.hostname=T.shift(),n.host=n.hostname);return n.search=t.search,n.query=t.query,null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!b.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var w=b.slice(-1)[0],E=(n.host||t.host||b.length>1)&&("."===w||".."===w)||""===w,_=0,S=b.length;S>=0;S--)"."===(w=b[S])?b.splice(S,1):".."===w?(b.splice(S,1),_++):_&&(b.splice(S,1),_--);if(!v&&!y)for(;_--;_)b.unshift("..");!v||""===b[0]||b[0]&&"/"===b[0].charAt(0)||b.unshift(""),E&&"/"!==b.join("/").substr(-1)&&b.push("");var T,k=""===b[0]||b[0]&&"/"===b[0].charAt(0);x&&(n.hostname=k?"":b.length?b.shift():"",n.host=n.hostname,(T=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=T.shift(),n.hostname=T.shift(),n.host=n.hostname));return(v=v||n.host&&b.length)&&!k&&b.unshift(""),b.length>0?n.pathname=b.join("/"):(n.pathname=null,n.path=null),null===n.pathname&&null===n.search||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=t.auth||n.auth,n.slashes=n.slashes||t.slashes,n.href=n.format(),n},VH.prototype.parseHost=function(){var t=this.host,e=zH.exec(t);e&&(":"!==(e=e[0])&&(this.port=e.substr(1)),t=t.substr(0,t.length-e.length)),t&&(this.hostname=t)};const e$={parse:t$,format:function(t){return"string"==typeof t&&(t=t$(t)),t instanceof VH?t.format():VH.prototype.format.call(t)},resolve:function(t,e){return t$(t,!1,!0).resolve(e)}};function n$(t){if("string"!=typeof t)throw new TypeError(`Path must be a string. Received ${JSON.stringify(t)}`)}function r$(t){return t.split("?")[0].split("#")[0]}const i$={toPosix(t){return e="\\",n="/",t.replace(new RegExp(e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),"g"),n);var e,n},isUrl(t){return/^https?:/.test(this.toPosix(t))},isDataUrl:t=>/^data:([a-z]+\/[a-z0-9-+.]+(;[a-z0-9-.!#$%*+.{}|~`]+=[a-z0-9-.!#$%*+.{}()_|~`]+)*)?(;base64)?,([a-z0-9!$&',()*+;=\-._~:@\/?%\s<>]*?)$/i.test(t),hasProtocol(t){return/^[^/:]+:\//.test(this.toPosix(t))},getProtocol(t){n$(t),t=this.toPosix(t);let e="";const n=/^file:\/\/\//.exec(t),r=/^[^/:]+:\/\//.exec(t),i=/^[^/:]+:\//.exec(t);if(n||r||i){const s=(null==n?void 0:n[0])||(null==r?void 0:r[0])||(null==i?void 0:i[0]);e=s,t=t.slice(s.length)}return e},toAbsolute(t,e,n){if(this.isDataUrl(t))return t;const r=r$(this.toPosix(e??WW.ADAPTER.getBaseUrl())),i=r$(this.toPosix(n??this.rootname(r)));if(n$(t),(t=this.toPosix(t)).startsWith("/"))return i$.join(i,t.slice(1));return this.isAbsolute(t)?t:this.join(r,t)},normalize(t){if(n$(t=this.toPosix(t)),0===t.length)return".";let e="";const n=t.startsWith("/");this.hasProtocol(t)&&(e=this.rootname(t),t=t.slice(e.length));const r=t.endsWith("/");return(t=function(t,e){let n="",r=0,i=-1,s=0,o=-1;for(let a=0;a<=t.length;++a){if(a<t.length)o=t.charCodeAt(a);else{if(47===o)break;o=47}if(47===o){if(i===a-1||1===s);else if(i!==a-1&&2===s){if(n.length<2||2!==r||46!==n.charCodeAt(n.length-1)||46!==n.charCodeAt(n.length-2))if(n.length>2){const t=n.lastIndexOf("/");if(t!==n.length-1){-1===t?(n="",r=0):(n=n.slice(0,t),r=n.length-1-n.lastIndexOf("/")),i=a,s=0;continue}}else if(2===n.length||1===n.length){n="",r=0,i=a,s=0;continue}e&&(n.length>0?n+="/..":n="..",r=2)}else n.length>0?n+=`/${t.slice(i+1,a)}`:n=t.slice(i+1,a),r=a-i-1;i=a,s=0}else 46===o&&-1!==s?++s:s=-1}return n}(t,!1)).length>0&&r&&(t+="/"),n?`/${t}`:e+t},isAbsolute(t){return n$(t),t=this.toPosix(t),!!this.hasProtocol(t)||t.startsWith("/")},join(...t){if(0===t.length)return".";let e;for(let n=0;n<t.length;++n){const r=t[n];if(n$(r),r.length>0)if(void 0===e)e=r;else{const i=t[n-1]??"";this.extname(i)?e+=`/../${r}`:e+=`/${r}`}}return void 0===e?".":this.normalize(e)},dirname(t){if(n$(t),0===t.length)return".";let e=(t=this.toPosix(t)).charCodeAt(0);const n=47===e;let r=-1,i=!0;const s=this.getProtocol(t),o=t;for(let a=(t=t.slice(s.length)).length-1;a>=1;--a)if(e=t.charCodeAt(a),47===e){if(!i){r=a;break}}else i=!1;return-1===r?n?"/":this.isUrl(o)?s+t:s:n&&1===r?"//":s+t.slice(0,r)},rootname(t){n$(t);let e="";if(e=(t=this.toPosix(t)).startsWith("/")?"/":this.getProtocol(t),this.isUrl(t)){const n=t.indexOf("/",e.length);e=-1!==n?t.slice(0,n):t,e.endsWith("/")||(e+="/")}return e},basename(t,e){n$(t),e&&n$(e),t=r$(this.toPosix(t));let n,r=0,i=-1,s=!0;if(void 0!==e&&e.length>0&&e.length<=t.length){if(e.length===t.length&&e===t)return"";let o=e.length-1,a=-1;for(n=t.length-1;n>=0;--n){const l=t.charCodeAt(n);if(47===l){if(!s){r=n+1;break}}else-1===a&&(s=!1,a=n+1),o>=0&&(l===e.charCodeAt(o)?-1==--o&&(i=n):(o=-1,i=a))}return r===i?i=a:-1===i&&(i=t.length),t.slice(r,i)}for(n=t.length-1;n>=0;--n)if(47===t.charCodeAt(n)){if(!s){r=n+1;break}}else-1===i&&(s=!1,i=n+1);return-1===i?"":t.slice(r,i)},extname(t){n$(t);let e=-1,n=0,r=-1,i=!0,s=0;for(let o=(t=r$(this.toPosix(t))).length-1;o>=0;--o){const a=t.charCodeAt(o);if(47!==a)-1===r&&(i=!1,r=o+1),46===a?-1===e?e=o:1!==s&&(s=1):-1!==e&&(s=-1);else if(!i){n=o+1;break}}return-1===e||-1===r||0===s||1===s&&e===r-1&&e===n+1?"":t.slice(e,r)},parse(t){n$(t);const e={root:"",dir:"",base:"",ext:"",name:""};if(0===t.length)return e;let n=(t=r$(this.toPosix(t))).charCodeAt(0);const r=this.isAbsolute(t);let i;e.root=this.rootname(t),i=r||this.hasProtocol(t)?1:0;let s=-1,o=0,a=-1,l=!0,c=t.length-1,h=0;for(;c>=i;--c)if(n=t.charCodeAt(c),47!==n)-1===a&&(l=!1,a=c+1),46===n?-1===s?s=c:1!==h&&(h=1):-1!==s&&(h=-1);else if(!l){o=c+1;break}return-1===s||-1===a||0===h||1===h&&s===a-1&&s===o+1?-1!==a&&(e.base=e.name=0===o&&r?t.slice(1,a):t.slice(o,a)):(0===o&&r?(e.name=t.slice(1,s),e.base=t.slice(1,a)):(e.name=t.slice(o,s),e.base=t.slice(o,a)),e.ext=t.slice(s,a)),e.dir=this.dirname(t),e},sep:"/",delimiter:":"},s$={};function o$(t,e,n=3){if(s$[e])return;let r=(new Error).stack;void 0===r||(r=r.split("\n").splice(n).join("\n"),console.groupCollapsed),s$[e]=!0}let a$;var l$={aliceblue:"#f0f8ff",antiquewhite:"#faebd7",aqua:"#00ffff",aquamarine:"#7fffd4",azure:"#f0ffff",beige:"#f5f5dc",bisque:"#ffe4c4",black:"#000000",blanchedalmond:"#ffebcd",blue:"#0000ff",blueviolet:"#8a2be2",brown:"#a52a2a",burlywood:"#deb887",cadetblue:"#5f9ea0",chartreuse:"#7fff00",chocolate:"#d2691e",coral:"#ff7f50",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cyan:"#00ffff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",darkgreen:"#006400",darkgrey:"#a9a9a9",darkkhaki:"#bdb76b",darkmagenta:"#8b008b",darkolivegreen:"#556b2f",darkorange:"#ff8c00",darkorchid:"#9932cc",darkred:"#8b0000",darksalmon:"#e9967a",darkseagreen:"#8fbc8f",darkslateblue:"#483d8b",darkslategray:"#2f4f4f",darkslategrey:"#2f4f4f",darkturquoise:"#00ced1",darkviolet:"#9400d3",deeppink:"#ff1493",deepskyblue:"#00bfff",dimgray:"#696969",dimgrey:"#696969",dodgerblue:"#1e90ff",firebrick:"#b22222",floralwhite:"#fffaf0",forestgreen:"#228b22",fuchsia:"#ff00ff",gainsboro:"#dcdcdc",ghostwhite:"#f8f8ff",goldenrod:"#daa520",gold:"#ffd700",gray:"#808080",green:"#008000",greenyellow:"#adff2f",grey:"#808080",honeydew:"#f0fff0",hotpink:"#ff69b4",indianred:"#cd5c5c",indigo:"#4b0082",ivory:"#fffff0",khaki:"#f0e68c",lavenderblush:"#fff0f5",lavender:"#e6e6fa",lawngreen:"#7cfc00",lemonchiffon:"#fffacd",lightblue:"#add8e6",lightcoral:"#f08080",lightcyan:"#e0ffff",lightgoldenrodyellow:"#fafad2",lightgray:"#d3d3d3",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightpink:"#ffb6c1",lightsalmon:"#ffa07a",lightseagreen:"#20b2aa",lightskyblue:"#87cefa",lightslategray:"#778899",lightslategrey:"#778899",lightsteelblue:"#b0c4de",lightyellow:"#ffffe0",lime:"#00ff00",limegreen:"#32cd32",linen:"#faf0e6",magenta:"#ff00ff",maroon:"#800000",mediumaquamarine:"#66cdaa",mediumblue:"#0000cd",mediumorchid:"#ba55d3",mediumpurple:"#9370db",mediumseagreen:"#3cb371",mediumslateblue:"#7b68ee",mediumspringgreen:"#00fa9a",mediumturquoise:"#48d1cc",mediumvioletred:"#c71585",midnightblue:"#191970",mintcream:"#f5fffa",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",navajowhite:"#ffdead",navy:"#000080",oldlace:"#fdf5e6",olive:"#808000",olivedrab:"#6b8e23",orange:"#ffa500",orangered:"#ff4500",orchid:"#da70d6",palegoldenrod:"#eee8aa",palegreen:"#98fb98",paleturquoise:"#afeeee",palevioletred:"#db7093",papayawhip:"#ffefd5",peachpuff:"#ffdab9",peru:"#cd853f",pink:"#ffc0cb",plum:"#dda0dd",powderblue:"#b0e0e6",purple:"#800080",rebeccapurple:"#663399",red:"#ff0000",rosybrown:"#bc8f8f",royalblue:"#4169e1",saddlebrown:"#8b4513",salmon:"#fa8072",sandybrown:"#f4a460",seagreen:"#2e8b57",seashell:"#fff5ee",sienna:"#a0522d",silver:"#c0c0c0",skyblue:"#87ceeb",slateblue:"#6a5acd",slategray:"#708090",slategrey:"#708090",snow:"#fffafa",springgreen:"#00ff7f",steelblue:"#4682b4",tan:"#d2b48c",teal:"#008080",thistle:"#d8bfd8",tomato:"#ff6347",turquoise:"#40e0d0",violet:"#ee82ee",wheat:"#f5deb3",white:"#ffffff",whitesmoke:"#f5f5f5",yellow:"#ffff00",yellowgreen:"#9acd32"};function c$(t,e=[]){return e[0]=(t>>16&255)/255,e[1]=(t>>8&255)/255,e[2]=(255&t)/255,e}function h$(t){let e=t.toString(16);return e="000000".substring(0,6-e.length)+e,`#${e}`}function u$(t){if("string"==typeof t&&("#"===(t=l$[t.toLowerCase()]||t)[0]&&(t=t.slice(1)),3===t.length)){const[e,n,r]=t;t=e+e+n+n+r+r}return parseInt(t,16)}function d$(t){return(255*t[0]<<16)+(255*t[1]<<8)+(255*t[2]|0)}const f$=function(){const t=[],e=[];for(let r=0;r<32;r++)t[r]=r,e[r]=r;t[CW.NORMAL_NPM]=CW.NORMAL,t[CW.ADD_NPM]=CW.ADD,t[CW.SCREEN_NPM]=CW.SCREEN,e[CW.NORMAL]=CW.NORMAL_NPM,e[CW.ADD]=CW.ADD_NPM,e[CW.SCREEN]=CW.SCREEN_NPM;const n=[];return n.push(e),n.push(t),n}();function p$(t,e){return f$[e?1:0][t]}function m$(t,e){if(1===e)return(255*e<<24)+t;if(0===e)return 0;let n=t>>16&255,r=t>>8&255,i=255&t;return n=n*e+.5|0,r=r*e+.5|0,i=i*e+.5|0,(255*e<<24)+(n<<16)+(r<<8)+i}function g$(t,e,n,r){return(n=n||new Float32Array(4))[0]=(t>>16&255)/255,n[1]=(t>>8&255)/255,n[2]=(255&t)/255,(r||void 0===r)&&(n[0]*=e,n[1]*=e,n[2]*=e),n[3]=e,n}function v$(t){if(4===t.BYTES_PER_ELEMENT)return t instanceof Float32Array?"Float32Array":t instanceof Uint32Array?"Uint32Array":"Int32Array";if(2===t.BYTES_PER_ELEMENT){if(t instanceof Uint16Array)return"Uint16Array"}else if(1===t.BYTES_PER_ELEMENT&&t instanceof Uint8Array)return"Uint8Array";return null}function y$(t){return t+=0===t?1:0,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1}function b$(t){return!(t&t-1||!t)}function x$(t){let e=(t>65535?1:0)<<4,n=((t>>>=e)>255?1:0)<<3;return e|=n,n=((t>>>=n)>15?1:0)<<2,e|=n,n=((t>>>=n)>3?1:0)<<1,e|=n,e|(t>>>=n)>>1}function w$(t,e,n){const r=t.length;let i;if(e>=r||0===n)return;const s=r-(n=e+n>r?r-e:n);for(i=e;i<s;++i)t[i]=t[i+n];t.length=s}function E$(t){return 0===t?0:t<0?-1:1}let _$=0;function S$(){return++_$}const T$=class{constructor(t,e,n,r){this.left=t,this.top=e,this.right=n,this.bottom=r}get width(){return this.right-this.left}get height(){return this.bottom-this.top}isEmpty(){return this.left===this.right||this.top===this.bottom}};let k$=T$;k$.EMPTY=new T$(0,0,0,0);const A$={},C$=Object.create(null),R$=Object.create(null);class M${constructor(t,e,n){this._canvas=WW.ADAPTER.createCanvas(),this._context=this._canvas.getContext("2d"),this.resolution=n||WW.RESOLUTION,this.resize(t,e)}clear(){this._checkDestroyed(),this._context.setTransform(1,0,0,1,0,0),this._context.clearRect(0,0,this._canvas.width,this._canvas.height)}resize(t,e){this._checkDestroyed(),this._canvas.width=Math.round(t*this.resolution),this._canvas.height=Math.round(e*this.resolution)}destroy(){this._context=null,this._canvas=null}get width(){return this._checkDestroyed(),this._canvas.width}set width(t){this._checkDestroyed(),this._canvas.width=Math.round(t)}get height(){return this._checkDestroyed(),this._canvas.height}set height(t){this._checkDestroyed(),this._canvas.height=Math.round(t)}get canvas(){return this._checkDestroyed(),this._canvas}get context(){return this._checkDestroyed(),this._context}_checkDestroyed(){if(null===this._canvas)throw new TypeError("The CanvasRenderTarget has already been destroyed")}}function I$(t,e,n){for(let r=0,i=4*n*e;r<e;++r,i+=4)if(0!==t[i+3])return!1;return!0}function D$(t,e,n,r,i){const s=4*e;for(let o=r,a=r*s+4*n;o<=i;++o,a+=s)if(0!==t[a+3])return!1;return!0}function O$(t){const e=function(t){const{width:e,height:n}=t,r=t.getContext("2d",{willReadFrequently:!0});if(null===r)throw new TypeError("Failed to get canvas 2D context");const i=r.getImageData(0,0,e,n).data;let s=0,o=0,a=e-1,l=n-1;for(;o<n&&I$(i,e,o);)++o;if(o===n)return k$.EMPTY;for(;I$(i,e,l);)--l;for(;D$(i,e,s,o,l);)++s;for(;D$(i,e,a,o,l);)--a;return++a,++l,new k$(s,o,a,l)}(t),{width:n,height:r}=e;let i=null;if(!e.isEmpty()){const s=t.getContext("2d");if(null===s)throw new TypeError("Failed to get canvas 2D context");i=s.getImageData(e.left,e.top,n,r)}return{width:n,height:r,data:i}}let P$;function L$(t,e=1){var n;const r=null==(n=WW.RETINA_PREFIX)?void 0:n.exec(t);return r?parseFloat(r[1]):e}var F$=(t=>(t.Renderer="renderer",t.Application="application",t.RendererSystem="renderer-webgl-system",t.RendererPlugin="renderer-webgl-plugin",t.CanvasRendererSystem="renderer-canvas-system",t.CanvasRendererPlugin="renderer-canvas-plugin",t.Asset="asset",t.LoadParser="load-parser",t.ResolveParser="resolve-parser",t.CacheParser="cache-parser",t.DetectionParser="detection-parser",t))(F$||{});const N$=t=>{if("function"==typeof t||"object"==typeof t&&t.extension){if(!t.extension)throw new Error("Extension class must have an extension object");t={..."object"!=typeof t.extension?{type:t.extension}:t.extension,ref:t}}if("object"!=typeof t)throw new Error("Invalid extension type");return"string"==typeof(t={...t}).type&&(t.type=[t.type]),t},B$=(t,e)=>N$(t).priority??e,U$={_addHandlers:{},_removeHandlers:{},_queue:{},remove(...t){return t.map(N$).forEach((t=>{t.type.forEach((e=>{var n,r;return null==(r=(n=this._removeHandlers)[e])?void 0:r.call(n,t)}))})),this},add(...t){return t.map(N$).forEach((t=>{t.type.forEach((e=>{const n=this._addHandlers,r=this._queue;n[e]?n[e](t):(r[e]=r[e]||[],r[e].push(t))}))})),this},handle(t,e,n){const r=this._addHandlers,i=this._removeHandlers;if(r[t]||i[t])throw new Error(`Extension type ${t} already has a handler`);r[t]=e,i[t]=n;const s=this._queue;return s[t]&&(s[t].forEach((t=>e(t))),delete s[t]),this},handleByMap(t,e){return this.handle(t,(t=>{e[t.name]=t.ref}),(t=>{delete e[t.name]}))},handleByList(t,e,n=-1){return this.handle(t,(t=>{e.includes(t.ref)||(e.push(t.ref),e.sort(((t,e)=>B$(e,n)-B$(t,n))))}),(t=>{const n=e.indexOf(t.ref);-1!==n&&e.splice(n,1)}))}};class V${constructor(t){"number"==typeof t?this.rawBinaryData=new ArrayBuffer(t):t instanceof Uint8Array?this.rawBinaryData=t.buffer:this.rawBinaryData=t,this.uint32View=new Uint32Array(this.rawBinaryData),this.float32View=new Float32Array(this.rawBinaryData)}get int8View(){return this._int8View||(this._int8View=new Int8Array(this.rawBinaryData)),this._int8View}get uint8View(){return this._uint8View||(this._uint8View=new Uint8Array(this.rawBinaryData)),this._uint8View}get int16View(){return this._int16View||(this._int16View=new Int16Array(this.rawBinaryData)),this._int16View}get uint16View(){return this._uint16View||(this._uint16View=new Uint16Array(this.rawBinaryData)),this._uint16View}get int32View(){return this._int32View||(this._int32View=new Int32Array(this.rawBinaryData)),this._int32View}view(t){return this[`${t}View`]}destroy(){this.rawBinaryData=null,this._int8View=null,this._uint8View=null,this._int16View=null,this._uint16View=null,this._int32View=null,this.uint32View=null,this.float32View=null}static sizeOf(t){switch(t){case"int8":case"uint8":return 1;case"int16":case"uint16":return 2;case"int32":case"uint32":case"float32":return 4;default:throw new Error(`${t} isn't a valid view type`)}}}const j$=["precision mediump float;","void main(void){","float test = 0.1;","%forloop%","gl_FragColor = vec4(0.0);","}"].join("\n");function z$(t){let e="";for(let n=0;n<t;++n)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(test == ${n}.0){}`);return e}class G${constructor(){this.data=0,this.blendMode=CW.NORMAL,this.polygonOffset=0,this.blend=!0,this.depthMask=!0}get blend(){return!!(1&this.data)}set blend(t){!!(1&this.data)!==t&&(this.data^=1)}get offsets(){return!!(2&this.data)}set offsets(t){!!(2&this.data)!==t&&(this.data^=2)}get culling(){return!!(4&this.data)}set culling(t){!!(4&this.data)!==t&&(this.data^=4)}get depthTest(){return!!(8&this.data)}set depthTest(t){!!(8&this.data)!==t&&(this.data^=8)}get depthMask(){return!!(32&this.data)}set depthMask(t){!!(32&this.data)!==t&&(this.data^=32)}get clockwiseFrontFace(){return!!(16&this.data)}set clockwiseFrontFace(t){!!(16&this.data)!==t&&(this.data^=16)}get blendMode(){return this._blendMode}set blendMode(t){this.blend=t!==CW.NONE,this._blendMode=t}get polygonOffset(){return this._polygonOffset}set polygonOffset(t){this.offsets=!!t,this._polygonOffset=t}toString(){return`[@pixi/core:State blendMode=${this.blendMode} clockwiseFrontFace=${this.clockwiseFrontFace} culling=${this.culling} depthMask=${this.depthMask} polygonOffset=${this.polygonOffset}]`}static for2d(){const t=new G$;return t.depthTest=!1,t.blend=!0,t}}const W$=[];function H$(t,e){if(!t)return null;let n="";if("string"==typeof t){const e=/\.(\w{3,4})(?:$|\?|#)/i.exec(t);e&&(n=e[1].toLowerCase())}for(let r=W$.length-1;r>=0;--r){const i=W$[r];if(i.test&&i.test(t,n))return new i(t,e)}throw new Error("Unrecognized source type to auto-detect Resource")}class $${constructor(t){this.items=[],this._name=t,this._aliasCount=0}emit(t,e,n,r,i,s,o,a){if(arguments.length>8)throw new Error("max arguments reached");const{name:l,items:c}=this;this._aliasCount++;for(let h=0,u=c.length;h<u;h++)c[h][l](t,e,n,r,i,s,o,a);return c===this.items&&this._aliasCount--,this}ensureNonAliasedItems(){this._aliasCount>0&&this.items.length>1&&(this._aliasCount=0,this.items=this.items.slice(0))}add(t){return t[this._name]&&(this.ensureNonAliasedItems(),this.remove(t),this.items.push(t)),this}remove(t){const e=this.items.indexOf(t);return-1!==e&&(this.ensureNonAliasedItems(),this.items.splice(e,1)),this}contains(t){return this.items.includes(t)}removeAll(){return this.ensureNonAliasedItems(),this.items.length=0,this}destroy(){this.removeAll(),this.items=null,this._name=null}get empty(){return 0===this.items.length}get name(){return this._name}}Object.defineProperties($$.prototype,{dispatch:{value:$$.prototype.emit},run:{value:$$.prototype.emit}});class Y${constructor(t=0,e=0){this._width=t,this._height=e,this.destroyed=!1,this.internal=!1,this.onResize=new $$("setRealSize"),this.onUpdate=new $$("update"),this.onError=new $$("onError")}bind(t){this.onResize.add(t),this.onUpdate.add(t),this.onError.add(t),(this._width||this._height)&&this.onResize.emit(this._width,this._height)}unbind(t){this.onResize.remove(t),this.onUpdate.remove(t),this.onError.remove(t)}resize(t,e){t===this._width&&e===this._height||(this._width=t,this._height=e,this.onResize.emit(t,e))}get valid(){return!!this._width&&!!this._height}update(){this.destroyed||this.onUpdate.emit()}load(){return Promise.resolve(this)}get width(){return this._width}get height(){return this._height}style(t,e,n){return!1}dispose(){}destroy(){this.destroyed||(this.destroyed=!0,this.dispose(),this.onError.removeAll(),this.onError=null,this.onResize.removeAll(),this.onResize=null,this.onUpdate.removeAll(),this.onUpdate=null)}static test(t,e){return!1}}class X$ extends Y${constructor(t,e){const{width:n,height:r}=e||{};if(!n||!r)throw new Error("BufferResource width or height invalid");super(n,r),this.data=t}upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===NW.UNPACK);const i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0}dispose(){this.data=null}static test(t){return t instanceof Float32Array||t instanceof Uint8Array||t instanceof Uint32Array}}const q$={scaleMode:PW.NEAREST,format:MW.RGBA,alphaMode:NW.NPM},K$=class extends cH{constructor(t=null,e=null){super(),e=Object.assign({},K$.defaultOptions,e);const{alphaMode:n,mipmap:r,anisotropicLevel:i,scaleMode:s,width:o,height:a,wrapMode:l,format:c,type:h,target:u,resolution:d,resourceOptions:f}=e;!t||t instanceof Y$||((t=H$(t,f)).internal=!0),this.resolution=d||WW.RESOLUTION,this.width=Math.round((o||0)*this.resolution)/this.resolution,this.height=Math.round((a||0)*this.resolution)/this.resolution,this._mipmap=r,this.anisotropicLevel=i,this._wrapMode=l,this._scaleMode=s,this.format=c,this.type=h,this.target=u,this.alphaMode=n,this.uid=S$(),this.touched=0,this.isPowerOfTwo=!1,this._refreshPOT(),this._glTextures={},this.dirtyId=0,this.dirtyStyleId=0,this.cacheId=null,this.valid=o>0&&a>0,this.textureCacheIds=[],this.destroyed=!1,this.resource=null,this._batchEnabled=0,this._batchLocation=0,this.parentTextureArray=null,this.setResource(t)}get realWidth(){return Math.round(this.width*this.resolution)}get realHeight(){return Math.round(this.height*this.resolution)}get mipmap(){return this._mipmap}set mipmap(t){this._mipmap!==t&&(this._mipmap=t,this.dirtyStyleId++)}get scaleMode(){return this._scaleMode}set scaleMode(t){this._scaleMode!==t&&(this._scaleMode=t,this.dirtyStyleId++)}get wrapMode(){return this._wrapMode}set wrapMode(t){this._wrapMode!==t&&(this._wrapMode=t,this.dirtyStyleId++)}setStyle(t,e){let n;return void 0!==t&&t!==this.scaleMode&&(this.scaleMode=t,n=!0),void 0!==e&&e!==this.mipmap&&(this.mipmap=e,n=!0),n&&this.dirtyStyleId++,this}setSize(t,e,n){return n=n||this.resolution,this.setRealSize(t*n,e*n,n)}setRealSize(t,e,n){return this.resolution=n||this.resolution,this.width=Math.round(t)/this.resolution,this.height=Math.round(e)/this.resolution,this._refreshPOT(),this.update(),this}_refreshPOT(){this.isPowerOfTwo=b$(this.realWidth)&&b$(this.realHeight)}setResolution(t){const e=this.resolution;return e===t||(this.resolution=t,this.valid&&(this.width=Math.round(this.width*e)/t,this.height=Math.round(this.height*e)/t,this.emit("update",this)),this._refreshPOT()),this}setResource(t){if(this.resource===t)return this;if(this.resource)throw new Error("Resource can be set only once");return t.bind(this),this.resource=t,this}update(){this.valid?(this.dirtyId++,this.dirtyStyleId++,this.emit("update",this)):this.width>0&&this.height>0&&(this.valid=!0,this.emit("loaded",this),this.emit("update",this))}onError(t){this.emit("error",this,t)}destroy(){this.resource&&(this.resource.unbind(this),this.resource.internal&&this.resource.destroy(),this.resource=null),this.cacheId&&(delete R$[this.cacheId],delete C$[this.cacheId],this.cacheId=null),this.dispose(),K$.removeFromCache(this),this.textureCacheIds=null,this.destroyed=!0}dispose(){this.emit("dispose",this)}castToBaseTexture(){return this}static from(t,e,n=WW.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let i=null;if(r)i=t;else{if(!t._pixiId){const n=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${n}_${S$()}`}i=t._pixiId}let s=R$[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in BaseTextureCache.`);return s||(s=new K$(t,e),s.cacheId=i,K$.addToCache(s,i)),s}static fromBuffer(t,e,n,r){t=t||new Float32Array(e*n*4);const i=new X$(t,{width:e,height:n}),s=t instanceof Float32Array?DW.FLOAT:DW.UNSIGNED_BYTE;return new K$(i,Object.assign({},q$,r||{width:e,height:n,type:s}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),R$[e]&&R$[e],R$[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=R$[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete R$[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)delete R$[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}};let Z$=K$;Z$.defaultOptions={mipmap:FW.POW2,anisotropicLevel:0,scaleMode:PW.LINEAR,wrapMode:LW.CLAMP,alphaMode:NW.UNPACK,target:IW.TEXTURE_2D,format:MW.RGBA,type:DW.UNSIGNED_BYTE},Z$._globalBatch=0;class J${constructor(){this.texArray=null,this.blend=0,this.type=RW.TRIANGLES,this.start=0,this.size=0,this.data=null}}let Q$=0,tY=class t{constructor(t,e=!0,n=!1){this.data=t||new Float32Array(1),this._glBuffers={},this._updateID=0,this.index=n,this.static=e,this.id=Q$++,this.disposeRunner=new $$("disposeBuffer")}update(t){t instanceof Array&&(t=new Float32Array(t)),this.data=t||this.data,this._updateID++}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.data=null}set index(t){this.type=t?GW.ELEMENT_ARRAY_BUFFER:GW.ARRAY_BUFFER}get index(){return this.type===GW.ELEMENT_ARRAY_BUFFER}static from(e){return e instanceof Array&&(e=new Float32Array(e)),new t(e)}};class eY{constructor(t,e=0,n=!1,r=DW.FLOAT,i,s,o,a=1){this.buffer=t,this.size=e,this.normalized=n,this.type=r,this.stride=i,this.start=s,this.instance=o,this.divisor=a}destroy(){this.buffer=null}static from(t,e,n,r,i){return new eY(t,e,n,r,i)}}const nY={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array};const rY={5126:4,5123:2,5121:1};let iY=0;const sY={Float32Array:Float32Array,Uint32Array:Uint32Array,Int32Array:Int32Array,Uint8Array:Uint8Array,Uint16Array:Uint16Array};class oY{constructor(t=[],e={}){this.buffers=t,this.indexBuffer=null,this.attributes=e,this.glVertexArrayObjects={},this.id=iY++,this.instanced=!1,this.instanceCount=1,this.disposeRunner=new $$("disposeGeometry"),this.refCount=0}addAttribute(t,e,n=0,r=!1,i,s,o,a=!1){if(!e)throw new Error("You must pass a buffer when creating an attribute");e instanceof tY||(e instanceof Array&&(e=new Float32Array(e)),e=new tY(e));const l=t.split("|");if(l.length>1){for(let t=0;t<l.length;t++)this.addAttribute(l[t],e,n,r,i);return this}let c=this.buffers.indexOf(e);return-1===c&&(this.buffers.push(e),c=this.buffers.length-1),this.attributes[t]=new eY(c,n,r,i,s,o,a),this.instanced=this.instanced||a,this}getAttribute(t){return this.attributes[t]}getBuffer(t){return this.buffers[this.getAttribute(t).buffer]}addIndex(t){return t instanceof tY||(t instanceof Array&&(t=new Uint16Array(t)),t=new tY(t)),t.type=GW.ELEMENT_ARRAY_BUFFER,this.indexBuffer=t,this.buffers.includes(t)||this.buffers.push(t),this}getIndex(){return this.indexBuffer}interleave(){if(1===this.buffers.length||2===this.buffers.length&&this.indexBuffer)return this;const t=[],e=[],n=new tY;let r;for(r in this.attributes){const n=this.attributes[r],i=this.buffers[n.buffer];t.push(i.data),e.push(n.size*rY[n.type]/4),n.buffer=0}for(n.data=function(t,e){let n=0,r=0;const i={};for(let l=0;l<t.length;l++)r+=e[l],n+=t[l].length;const s=new ArrayBuffer(4*n);let o=null,a=0;for(let l=0;l<t.length;l++){const n=e[l],c=t[l],h=v$(c);i[h]||(i[h]=new nY[h](s)),o=i[h];for(let t=0;t<c.length;t++)o[(t/n|0)*r+a+t%n]=c[t];a+=n}return new Float32Array(s)}(t,e),r=0;r<this.buffers.length;r++)this.buffers[r]!==this.indexBuffer&&this.buffers[r].destroy();return this.buffers=[n],this.indexBuffer&&this.buffers.push(this.indexBuffer),this}getSize(){for(const t in this.attributes){const e=this.attributes[t];return this.buffers[e.buffer].data.length/(e.stride/4||e.size)}return 0}dispose(){this.disposeRunner.emit(this,!1)}destroy(){this.dispose(),this.buffers=null,this.indexBuffer=null,this.attributes=null}clone(){const t=new oY;for(let e=0;e<this.buffers.length;e++)t.buffers[e]=new tY(this.buffers[e].data.slice(0));for(const e in this.attributes){const n=this.attributes[e];t.attributes[e]=new eY(n.buffer,n.size,n.normalized,n.type,n.stride,n.start,n.instance)}return this.indexBuffer&&(t.indexBuffer=t.buffers[this.buffers.indexOf(this.indexBuffer)],t.indexBuffer.type=GW.ELEMENT_ARRAY_BUFFER),t}static merge(t){const e=new oY,n=[],r=[],i=[];let s;for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)r[t]=r[t]||0,r[t]+=s.buffers[t].data.length,i[t]=0}for(let o=0;o<s.buffers.length;o++)n[o]=new(sY[v$(s.buffers[o].data)])(r[o]),e.buffers[o]=new tY(n[o]);for(let o=0;o<t.length;o++){s=t[o];for(let t=0;t<s.buffers.length;t++)n[t].set(s.buffers[t].data,i[t]),i[t]+=s.buffers[t].data.length}if(e.attributes=s.attributes,s.indexBuffer){e.indexBuffer=e.buffers[s.buffers.indexOf(s.indexBuffer)],e.indexBuffer.type=GW.ELEMENT_ARRAY_BUFFER;let n=0,r=0,i=0,o=0;for(let t=0;t<s.buffers.length;t++)if(s.buffers[t]!==s.indexBuffer){o=t;break}for(const t in s.attributes){const e=s.attributes[t];(0|e.buffer)===o&&(r+=e.size*rY[e.type]/4)}for(let s=0;s<t.length;s++){const a=t[s].indexBuffer.data;for(let t=0;t<a.length;t++)e.indexBuffer.data[t+i]+=n;n+=t[s].buffers[o].data.length/r,i+=a.length}}return e}}class aY extends oY{constructor(t=!1){super(),this._buffer=new tY(null,t,!1),this._indexBuffer=new tY(null,t,!0),this.addAttribute("aVertexPosition",this._buffer,2,!1,DW.FLOAT).addAttribute("aTextureCoord",this._buffer,2,!1,DW.FLOAT).addAttribute("aColor",this._buffer,4,!0,DW.UNSIGNED_BYTE).addAttribute("aTextureId",this._buffer,1,!0,DW.FLOAT).addIndex(this._indexBuffer)}}const lY=2*Math.PI,cY=180/Math.PI,hY=Math.PI/180;var uY=(t=>(t[t.POLY=0]="POLY",t[t.RECT=1]="RECT",t[t.CIRC=2]="CIRC",t[t.ELIP=3]="ELIP",t[t.RREC=4]="RREC",t))(uY||{});class dY{constructor(t=0,e=0){this.x=0,this.y=0,this.x=t,this.y=e}clone(){return new dY(this.x,this.y)}copyFrom(t){return this.set(t.x,t.y),this}copyTo(t){return t.set(this.x,this.y),t}equals(t){return t.x===this.x&&t.y===this.y}set(t=0,e=t){return this.x=t,this.y=e,this}toString(){return`[@pixi/math:Point x=${this.x} y=${this.y}]`}}const fY=[new dY,new dY,new dY,new dY];class pY{constructor(t=0,e=0,n=0,r=0){this.x=Number(t),this.y=Number(e),this.width=Number(n),this.height=Number(r),this.type=uY.RECT}get left(){return this.x}get right(){return this.x+this.width}get top(){return this.y}get bottom(){return this.y+this.height}static get EMPTY(){return new pY(0,0,0,0)}clone(){return new pY(this.x,this.y,this.width,this.height)}copyFrom(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this}copyTo(t){return t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t}contains(t,e){return!(this.width<=0||this.height<=0)&&(t>=this.x&&t<this.x+this.width&&e>=this.y&&e<this.y+this.height)}intersects(t,e){if(!e){const e=this.x<t.x?t.x:this.x;if((this.right>t.right?t.right:this.right)<=e)return!1;const n=this.y<t.y?t.y:this.y;return(this.bottom>t.bottom?t.bottom:this.bottom)>n}const n=this.left,r=this.right,i=this.top,s=this.bottom;if(r<=n||s<=i)return!1;const o=fY[0].set(t.left,t.top),a=fY[1].set(t.left,t.bottom),l=fY[2].set(t.right,t.top),c=fY[3].set(t.right,t.bottom);if(l.x<=o.x||a.y<=o.y)return!1;const h=Math.sign(e.a*e.d-e.b*e.c);if(0===h)return!1;if(e.apply(o,o),e.apply(a,a),e.apply(l,l),e.apply(c,c),Math.max(o.x,a.x,l.x,c.x)<=n||Math.min(o.x,a.x,l.x,c.x)>=r||Math.max(o.y,a.y,l.y,c.y)<=i||Math.min(o.y,a.y,l.y,c.y)>=s)return!1;const u=h*(a.y-o.y),d=h*(o.x-a.x),f=u*n+d*i,p=u*r+d*i,m=u*n+d*s,g=u*r+d*s;if(Math.max(f,p,m,g)<=u*o.x+d*o.y||Math.min(f,p,m,g)>=u*c.x+d*c.y)return!1;const v=h*(o.y-l.y),y=h*(l.x-o.x),b=v*n+y*i,x=v*r+y*i,w=v*n+y*s,E=v*r+y*s;return!(Math.max(b,x,w,E)<=v*o.x+y*o.y||Math.min(b,x,w,E)>=v*c.x+y*c.y)}pad(t=0,e=t){return this.x-=t,this.y-=e,this.width+=2*t,this.height+=2*e,this}fit(t){const e=Math.max(this.x,t.x),n=Math.min(this.x+this.width,t.x+t.width),r=Math.max(this.y,t.y),i=Math.min(this.y+this.height,t.y+t.height);return this.x=e,this.width=Math.max(n-e,0),this.y=r,this.height=Math.max(i-r,0),this}ceil(t=1,e=.001){const n=Math.ceil((this.x+this.width-e)*t)/t,r=Math.ceil((this.y+this.height-e)*t)/t;return this.x=Math.floor((this.x+e)*t)/t,this.y=Math.floor((this.y+e)*t)/t,this.width=n-this.x,this.height=r-this.y,this}enlarge(t){const e=Math.min(this.x,t.x),n=Math.max(this.x+this.width,t.x+t.width),r=Math.min(this.y,t.y),i=Math.max(this.y+this.height,t.y+t.height);return this.x=e,this.width=n-e,this.y=r,this.height=i-r,this}toString(){return`[@pixi/math:Rectangle x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class mY{constructor(t=0,e=0,n=0){this.x=t,this.y=e,this.radius=n,this.type=uY.CIRC}clone(){return new mY(this.x,this.y,this.radius)}contains(t,e){if(this.radius<=0)return!1;const n=this.radius*this.radius;let r=this.x-t,i=this.y-e;return r*=r,i*=i,r+i<=n}getBounds(){return new pY(this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius)}toString(){return`[@pixi/math:Circle x=${this.x} y=${this.y} radius=${this.radius}]`}}class gY{constructor(t=0,e=0,n=0,r=0){this.x=t,this.y=e,this.width=n,this.height=r,this.type=uY.ELIP}clone(){return new gY(this.x,this.y,this.width,this.height)}contains(t,e){if(this.width<=0||this.height<=0)return!1;let n=(t-this.x)/this.width,r=(e-this.y)/this.height;return n*=n,r*=r,n+r<=1}getBounds(){return new pY(this.x-this.width,this.y-this.height,this.width,this.height)}toString(){return`[@pixi/math:Ellipse x=${this.x} y=${this.y} width=${this.width} height=${this.height}]`}}class vY{constructor(...t){let e=Array.isArray(t[0])?t[0]:t;if("number"!=typeof e[0]){const t=[];for(let n=0,r=e.length;n<r;n++)t.push(e[n].x,e[n].y);e=t}this.points=e,this.type=uY.POLY,this.closeStroke=!0}clone(){const t=this.points.slice(),e=new vY(t);return e.closeStroke=this.closeStroke,e}contains(t,e){let n=!1;const r=this.points.length/2;for(let i=0,s=r-1;i<r;s=i++){const r=this.points[2*i],o=this.points[2*i+1],a=this.points[2*s],l=this.points[2*s+1];o>e!=l>e&&t<(e-o)/(l-o)*(a-r)+r&&(n=!n)}return n}toString(){return`[@pixi/math:PolygoncloseStroke=${this.closeStroke}points=${this.points.reduce(((t,e)=>`${t}, ${e}`),"")}]`}}class yY{constructor(t=0,e=0,n=0,r=0,i=20){this.x=t,this.y=e,this.width=n,this.height=r,this.radius=i,this.type=uY.RREC}clone(){return new yY(this.x,this.y,this.width,this.height,this.radius)}contains(t,e){if(this.width<=0||this.height<=0)return!1;if(t>=this.x&&t<=this.x+this.width&&e>=this.y&&e<=this.y+this.height){const n=Math.max(0,Math.min(this.radius,Math.min(this.width,this.height)/2));if(e>=this.y+n&&e<=this.y+this.height-n||t>=this.x+n&&t<=this.x+this.width-n)return!0;let r=t-(this.x+n),i=e-(this.y+n);const s=n*n;if(r*r+i*i<=s)return!0;if(r=t-(this.x+this.width-n),r*r+i*i<=s)return!0;if(i=e-(this.y+this.height-n),r*r+i*i<=s)return!0;if(r=t-(this.x+n),r*r+i*i<=s)return!0}return!1}toString(){return`[@pixi/math:RoundedRectangle x=${this.x} y=${this.y}width=${this.width} height=${this.height} radius=${this.radius}]`}}class bY{constructor(t=1,e=0,n=0,r=1,i=0,s=0){this.array=null,this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s}fromArray(t){this.a=t[0],this.b=t[1],this.c=t[3],this.d=t[4],this.tx=t[2],this.ty=t[5]}set(t,e,n,r,i,s){return this.a=t,this.b=e,this.c=n,this.d=r,this.tx=i,this.ty=s,this}toArray(t,e){this.array||(this.array=new Float32Array(9));const n=e||this.array;return t?(n[0]=this.a,n[1]=this.b,n[2]=0,n[3]=this.c,n[4]=this.d,n[5]=0,n[6]=this.tx,n[7]=this.ty,n[8]=1):(n[0]=this.a,n[1]=this.c,n[2]=this.tx,n[3]=this.b,n[4]=this.d,n[5]=this.ty,n[6]=0,n[7]=0,n[8]=1),n}apply(t,e){e=e||new dY;const n=t.x,r=t.y;return e.x=this.a*n+this.c*r+this.tx,e.y=this.b*n+this.d*r+this.ty,e}applyInverse(t,e){e=e||new dY;const n=1/(this.a*this.d+this.c*-this.b),r=t.x,i=t.y;return e.x=this.d*n*r+-this.c*n*i+(this.ty*this.c-this.tx*this.d)*n,e.y=this.a*n*i+-this.b*n*r+(-this.ty*this.a+this.tx*this.b)*n,e}translate(t,e){return this.tx+=t,this.ty+=e,this}scale(t,e){return this.a*=t,this.d*=e,this.c*=t,this.b*=e,this.tx*=t,this.ty*=e,this}rotate(t){const e=Math.cos(t),n=Math.sin(t),r=this.a,i=this.c,s=this.tx;return this.a=r*e-this.b*n,this.b=r*n+this.b*e,this.c=i*e-this.d*n,this.d=i*n+this.d*e,this.tx=s*e-this.ty*n,this.ty=s*n+this.ty*e,this}append(t){const e=this.a,n=this.b,r=this.c,i=this.d;return this.a=t.a*e+t.b*r,this.b=t.a*n+t.b*i,this.c=t.c*e+t.d*r,this.d=t.c*n+t.d*i,this.tx=t.tx*e+t.ty*r+this.tx,this.ty=t.tx*n+t.ty*i+this.ty,this}setTransform(t,e,n,r,i,s,o,a,l){return this.a=Math.cos(o+l)*i,this.b=Math.sin(o+l)*i,this.c=-Math.sin(o-a)*s,this.d=Math.cos(o-a)*s,this.tx=t-(n*this.a+r*this.c),this.ty=e-(n*this.b+r*this.d),this}prepend(t){const e=this.tx;if(1!==t.a||0!==t.b||0!==t.c||1!==t.d){const e=this.a,n=this.c;this.a=e*t.a+this.b*t.c,this.b=e*t.b+this.b*t.d,this.c=n*t.a+this.d*t.c,this.d=n*t.b+this.d*t.d}return this.tx=e*t.a+this.ty*t.c+t.tx,this.ty=e*t.b+this.ty*t.d+t.ty,this}decompose(t){const e=this.a,n=this.b,r=this.c,i=this.d,s=t.pivot,o=-Math.atan2(-r,i),a=Math.atan2(n,e),l=Math.abs(o+a);return l<1e-5||Math.abs(lY-l)<1e-5?(t.rotation=a,t.skew.x=t.skew.y=0):(t.rotation=0,t.skew.x=o,t.skew.y=a),t.scale.x=Math.sqrt(e*e+n*n),t.scale.y=Math.sqrt(r*r+i*i),t.position.x=this.tx+(s.x*e+s.y*r),t.position.y=this.ty+(s.x*n+s.y*i),t}invert(){const t=this.a,e=this.b,n=this.c,r=this.d,i=this.tx,s=t*r-e*n;return this.a=r/s,this.b=-e/s,this.c=-n/s,this.d=t/s,this.tx=(n*this.ty-r*i)/s,this.ty=-(t*this.ty-e*i)/s,this}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0,this}clone(){const t=new bY;return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyTo(t){return t.a=this.a,t.b=this.b,t.c=this.c,t.d=this.d,t.tx=this.tx,t.ty=this.ty,t}copyFrom(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this}toString(){return`[@pixi/math:Matrix a=${this.a} b=${this.b} c=${this.c} d=${this.d} tx=${this.tx} ty=${this.ty}]`}static get IDENTITY(){return new bY}static get TEMP_MATRIX(){return new bY}}const xY=[1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1,0,1],wY=[0,1,1,1,0,-1,-1,-1,0,1,1,1,0,-1,-1,-1],EY=[0,-1,-1,-1,0,1,1,1,0,1,1,1,0,-1,-1,-1],_Y=[1,1,0,-1,-1,-1,0,1,-1,-1,0,1,1,1,0,-1],SY=[],TY=[],kY=Math.sign;!function(){for(let t=0;t<16;t++){const e=[];SY.push(e);for(let n=0;n<16;n++){const r=kY(xY[t]*xY[n]+EY[t]*wY[n]),i=kY(wY[t]*xY[n]+_Y[t]*wY[n]),s=kY(xY[t]*EY[n]+EY[t]*_Y[n]),o=kY(wY[t]*EY[n]+_Y[t]*_Y[n]);for(let t=0;t<16;t++)if(xY[t]===r&&wY[t]===i&&EY[t]===s&&_Y[t]===o){e.push(t);break}}}for(let t=0;t<16;t++){const e=new bY;e.set(xY[t],wY[t],EY[t],_Y[t],0,0),TY.push(e)}}();const AY={E:0,SE:1,S:2,SW:3,W:4,NW:5,N:6,NE:7,MIRROR_VERTICAL:8,MAIN_DIAGONAL:10,MIRROR_HORIZONTAL:12,REVERSE_DIAGONAL:14,uX:t=>xY[t],uY:t=>wY[t],vX:t=>EY[t],vY:t=>_Y[t],inv:t=>8&t?15&t:7&-t,add:(t,e)=>SY[t][e],sub:(t,e)=>SY[t][AY.inv(e)],rotate180:t=>4^t,isVertical:t=>2==(3&t),byDirection:(t,e)=>2*Math.abs(t)<=Math.abs(e)?e>=0?AY.S:AY.N:2*Math.abs(e)<=Math.abs(t)?t>0?AY.E:AY.W:e>0?t>0?AY.SE:AY.SW:t>0?AY.NE:AY.NW,matrixAppendRotationInv:(t,e,n=0,r=0)=>{const i=TY[AY.inv(e)];i.tx=n,i.ty=r,t.append(i)}};class CY{constructor(t,e,n=0,r=0){this._x=n,this._y=r,this.cb=t,this.scope=e}clone(t=this.cb,e=this.scope){return new CY(t,e,this._x,this._y)}set(t=0,e=t){return this._x===t&&this._y===e||(this._x=t,this._y=e,this.cb.call(this.scope)),this}copyFrom(t){return this._x===t.x&&this._y===t.y||(this._x=t.x,this._y=t.y,this.cb.call(this.scope)),this}copyTo(t){return t.set(this._x,this._y),t}equals(t){return t.x===this._x&&t.y===this._y}toString(){return`[@pixi/math:ObservablePoint x=0 y=0 scope=${this.scope}]`}get x(){return this._x}set x(t){this._x!==t&&(this._x=t,this.cb.call(this.scope))}get y(){return this._y}set y(t){this._y!==t&&(this._y=t,this.cb.call(this.scope))}}const RY=class{constructor(){this.worldTransform=new bY,this.localTransform=new bY,this.position=new CY(this.onChange,this,0,0),this.scale=new CY(this.onChange,this,1,1),this.pivot=new CY(this.onChange,this,0,0),this.skew=new CY(this.updateSkew,this,0,0),this._rotation=0,this._cx=1,this._sx=0,this._cy=0,this._sy=1,this._localID=0,this._currentLocalID=0,this._worldID=0,this._parentID=0}onChange(){this._localID++}updateSkew(){this._cx=Math.cos(this._rotation+this.skew.y),this._sx=Math.sin(this._rotation+this.skew.y),this._cy=-Math.sin(this._rotation-this.skew.x),this._sy=Math.cos(this._rotation-this.skew.x),this._localID++}toString(){return`[@pixi/math:Transform position=(${this.position.x}, ${this.position.y}) rotation=${this.rotation} scale=(${this.scale.x}, ${this.scale.y}) skew=(${this.skew.x}, ${this.skew.y}) ]`}updateLocalTransform(){const t=this.localTransform;this._localID!==this._currentLocalID&&(t.a=this._cx*this.scale.x,t.b=this._sx*this.scale.x,t.c=this._cy*this.scale.y,t.d=this._sy*this.scale.y,t.tx=this.position.x-(this.pivot.x*t.a+this.pivot.y*t.c),t.ty=this.position.y-(this.pivot.x*t.b+this.pivot.y*t.d),this._currentLocalID=this._localID,this._parentID=-1)}updateTransform(t){const e=this.localTransform;if(this._localID!==this._currentLocalID&&(e.a=this._cx*this.scale.x,e.b=this._sx*this.scale.x,e.c=this._cy*this.scale.y,e.d=this._sy*this.scale.y,e.tx=this.position.x-(this.pivot.x*e.a+this.pivot.y*e.c),e.ty=this.position.y-(this.pivot.x*e.b+this.pivot.y*e.d),this._currentLocalID=this._localID,this._parentID=-1),this._parentID!==t._worldID){const n=t.worldTransform,r=this.worldTransform;r.a=e.a*n.a+e.b*n.c,r.b=e.a*n.b+e.b*n.d,r.c=e.c*n.a+e.d*n.c,r.d=e.c*n.b+e.d*n.d,r.tx=e.tx*n.a+e.ty*n.c+n.tx,r.ty=e.tx*n.b+e.ty*n.d+n.ty,this._parentID=t._worldID,this._worldID++}}setFromMatrix(t){t.decompose(this),this._localID++}get rotation(){return this._rotation}set rotation(t){this._rotation!==t&&(this._rotation=t,this.updateSkew())}};let MY=RY;MY.IDENTITY=new RY;function IY(t,e,n){const r=t.createShader(e);return t.shaderSource(r,n),t.compileShader(r),r}function DY(t){const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=!1;return e}function OY(t,e){switch(t){case"float":case"int":case"uint":case"sampler2D":case"sampler2DArray":return 0;case"vec2":return new Float32Array(2*e);case"vec3":return new Float32Array(3*e);case"vec4":return new Float32Array(4*e);case"ivec2":return new Int32Array(2*e);case"ivec3":return new Int32Array(3*e);case"ivec4":return new Int32Array(4*e);case"uvec2":return new Uint32Array(2*e);case"uvec3":return new Uint32Array(3*e);case"uvec4":return new Uint32Array(4*e);case"bool":return!1;case"bvec2":return DY(2*e);case"bvec3":return DY(3*e);case"bvec4":return DY(4*e);case"mat2":return new Float32Array([1,0,0,1]);case"mat3":return new Float32Array([1,0,0,0,1,0,0,0,1]);case"mat4":return new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])}return null}const PY=[{test:t=>"float"===t.type&&1===t.size&&!t.isArray,code:t=>`\n            if(uv["${t}"] !== ud["${t}"].value)\n            {\n                ud["${t}"].value = uv["${t}"]\n                gl.uniform1f(ud["${t}"].location, uv["${t}"])\n            }\n            `},{test:(t,e)=>!("sampler2D"!==t.type&&"samplerCube"!==t.type&&"sampler2DArray"!==t.type||1!==t.size||t.isArray||null!=e&&void 0===e.castToBaseTexture),code:t=>`t = syncData.textureCount++;\n\n            renderer.texture.bind(uv["${t}"], t);\n\n            if(ud["${t}"].value !== t)\n            {\n                ud["${t}"].value = t;\n                gl.uniform1i(ud["${t}"].location, t);\n; // eslint-disable-line max-len\n            }`},{test:(t,e)=>"mat3"===t.type&&1===t.size&&!t.isArray&&void 0!==e.a,code:t=>`\n            gl.uniformMatrix3fv(ud["${t}"].location, false, uv["${t}"].toArray(true));\n            `,codeUbo:t=>`\n                var ${t}_matrix = uv.${t}.toArray(true);\n\n                data[offset] = ${t}_matrix[0];\n                data[offset+1] = ${t}_matrix[1];\n                data[offset+2] = ${t}_matrix[2];\n        \n                data[offset + 4] = ${t}_matrix[3];\n                data[offset + 5] = ${t}_matrix[4];\n                data[offset + 6] = ${t}_matrix[5];\n        \n                data[offset + 8] = ${t}_matrix[6];\n                data[offset + 9] = ${t}_matrix[7];\n                data[offset + 10] = ${t}_matrix[8];\n            `},{test:(t,e)=>"vec2"===t.type&&1===t.size&&!t.isArray&&void 0!==e.x,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    gl.uniform2f(ud["${t}"].location, v.x, v.y);\n                }`,codeUbo:t=>`\n                v = uv.${t};\n\n                data[offset] = v.x;\n                data[offset+1] = v.y;\n            `},{test:t=>"vec2"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    gl.uniform2f(ud["${t}"].location, v[0], v[1]);\n                }\n            `},{test:(t,e)=>"vec4"===t.type&&1===t.size&&!t.isArray&&void 0!==e.width,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v.x || cv[1] !== v.y || cv[2] !== v.width || cv[3] !== v.height)\n                {\n                    cv[0] = v.x;\n                    cv[1] = v.y;\n                    cv[2] = v.width;\n                    cv[3] = v.height;\n                    gl.uniform4f(ud["${t}"].location, v.x, v.y, v.width, v.height)\n                }`,codeUbo:t=>`\n                    v = uv.${t};\n\n                    data[offset] = v.x;\n                    data[offset+1] = v.y;\n                    data[offset+2] = v.width;\n                    data[offset+3] = v.height;\n                `},{test:t=>"vec4"===t.type&&1===t.size&&!t.isArray,code:t=>`\n                cv = ud["${t}"].value;\n                v = uv["${t}"];\n\n                if(cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n                {\n                    cv[0] = v[0];\n                    cv[1] = v[1];\n                    cv[2] = v[2];\n                    cv[3] = v[3];\n\n                    gl.uniform4f(ud["${t}"].location, v[0], v[1], v[2], v[3])\n                }`}],LY={float:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1f(location, v);\n    }",vec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2f(location, v[0], v[1])\n    }",vec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3f(location, v[0], v[1], v[2])\n    }",vec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4f(location, v[0], v[1], v[2], v[3]);\n    }",int:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",ivec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",ivec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",ivec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",uint:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1ui(location, v);\n    }",uvec2:"\n    if (cv[0] !== v[0] || cv[1] !== v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2ui(location, v[0], v[1]);\n    }",uvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3ui(location, v[0], v[1], v[2]);\n    }",uvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4ui(location, v[0], v[1], v[2], v[3]);\n    }",bool:"\n    if (cv !== v)\n    {\n        cu.value = v;\n        gl.uniform1i(location, v);\n    }",bvec2:"\n    if (cv[0] != v[0] || cv[1] != v[1])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n\n        gl.uniform2i(location, v[0], v[1]);\n    }",bvec3:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n\n        gl.uniform3i(location, v[0], v[1], v[2]);\n    }",bvec4:"\n    if (cv[0] !== v[0] || cv[1] !== v[1] || cv[2] !== v[2] || cv[3] !== v[3])\n    {\n        cv[0] = v[0];\n        cv[1] = v[1];\n        cv[2] = v[2];\n        cv[3] = v[3];\n\n        gl.uniform4i(location, v[0], v[1], v[2], v[3]);\n    }",mat2:"gl.uniformMatrix2fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",sampler2D:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",samplerCube:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }",sampler2DArray:"\n    if (cv !== v)\n    {\n        cu.value = v;\n\n        gl.uniform1i(location, v);\n    }"},FY={float:"gl.uniform1fv(location, v)",vec2:"gl.uniform2fv(location, v)",vec3:"gl.uniform3fv(location, v)",vec4:"gl.uniform4fv(location, v)",mat4:"gl.uniformMatrix4fv(location, false, v)",mat3:"gl.uniformMatrix3fv(location, false, v)",mat2:"gl.uniformMatrix2fv(location, false, v)",int:"gl.uniform1iv(location, v)",ivec2:"gl.uniform2iv(location, v)",ivec3:"gl.uniform3iv(location, v)",ivec4:"gl.uniform4iv(location, v)",uint:"gl.uniform1uiv(location, v)",uvec2:"gl.uniform2uiv(location, v)",uvec3:"gl.uniform3uiv(location, v)",uvec4:"gl.uniform4uiv(location, v)",bool:"gl.uniform1iv(location, v)",bvec2:"gl.uniform2iv(location, v)",bvec3:"gl.uniform3iv(location, v)",bvec4:"gl.uniform4iv(location, v)",sampler2D:"gl.uniform1iv(location, v)",samplerCube:"gl.uniform1iv(location, v)",sampler2DArray:"gl.uniform1iv(location, v)"};const NY={};let BY,UY=NY;function VY(){if(!BY){BY=VW.MEDIUM;const t=function(){if(UY===NY||(null==UY?void 0:UY.isContextLost())){const t=WW.ADAPTER.createCanvas();let e;WW.PREFER_ENV>=kW.WEBGL2&&(e=t.getContext("webgl2",{})),e||(e=t.getContext("webgl",{})||t.getContext("experimental-webgl",{}),e?e.getExtension("WEBGL_draw_buffers"):e=null),UY=e}return UY}();if(t&&t.getShaderPrecisionFormat){const e=t.getShaderPrecisionFormat(t.FRAGMENT_SHADER,t.HIGH_FLOAT);BY=e.precision?VW.HIGH:VW.MEDIUM}}return BY}function jY(t,e){const n=t.getShaderSource(e).split("\n").map(((t,e)=>`${e}: ${t}`)),r=t.getShaderInfoLog(e).split("\n"),i={},s=r.map((t=>parseFloat(t.replace(/^ERROR\: 0\:([\d]+)\:.*$/,"$1")))).filter((t=>!(!t||i[t])&&(i[t]=!0,!0))),o=[""];s.forEach((t=>{n[t-1]=`%c${n[t-1]}%c`,o.push("background: #FF0000; color:#FFFFFF; font-size: 10px","font-size: 10px")}));const a=n.join("\n");o[0]=a}const zY={float:1,vec2:2,vec3:3,vec4:4,int:1,ivec2:2,ivec3:3,ivec4:4,uint:1,uvec2:2,uvec3:3,uvec4:4,bool:1,bvec2:2,bvec3:3,bvec4:4,mat2:4,mat3:9,mat4:16,sampler2D:1};function GY(t){return zY[t]}let WY=null;const HY={FLOAT:"float",FLOAT_VEC2:"vec2",FLOAT_VEC3:"vec3",FLOAT_VEC4:"vec4",INT:"int",INT_VEC2:"ivec2",INT_VEC3:"ivec3",INT_VEC4:"ivec4",UNSIGNED_INT:"uint",UNSIGNED_INT_VEC2:"uvec2",UNSIGNED_INT_VEC3:"uvec3",UNSIGNED_INT_VEC4:"uvec4",BOOL:"bool",BOOL_VEC2:"bvec2",BOOL_VEC3:"bvec3",BOOL_VEC4:"bvec4",FLOAT_MAT2:"mat2",FLOAT_MAT3:"mat3",FLOAT_MAT4:"mat4",SAMPLER_2D:"sampler2D",INT_SAMPLER_2D:"sampler2D",UNSIGNED_INT_SAMPLER_2D:"sampler2D",SAMPLER_CUBE:"samplerCube",INT_SAMPLER_CUBE:"samplerCube",UNSIGNED_INT_SAMPLER_CUBE:"samplerCube",SAMPLER_2D_ARRAY:"sampler2DArray",INT_SAMPLER_2D_ARRAY:"sampler2DArray",UNSIGNED_INT_SAMPLER_2D_ARRAY:"sampler2DArray"};function $Y(t,e){if(!WY){const e=Object.keys(HY);WY={};for(let n=0;n<e.length;++n){const r=e[n];WY[t[r]]=HY[r]}}return WY[e]}function YY(t,e,n){if("precision"!==t.substring(0,9)){let r=e;return e===VW.HIGH&&n!==VW.HIGH&&(r=VW.MEDIUM),`precision ${r} float;\n${t}`}return n!==VW.HIGH&&"precision highp"===t.substring(0,15)?t.replace("precision highp","precision mediump"):t}let XY;let qY=0;const KY={},ZY=class{constructor(t,e,n="pixi-shader",r={}){this.extra={},this.id=qY++,this.vertexSrc=t||ZY.defaultVertexSrc,this.fragmentSrc=e||ZY.defaultFragmentSrc,this.vertexSrc=this.vertexSrc.trim(),this.fragmentSrc=this.fragmentSrc.trim(),this.extra=r,"#version"!==this.vertexSrc.substring(0,8)&&(n=n.replace(/\s+/g,"-"),KY[n]?(KY[n]++,n+=`-${KY[n]}`):KY[n]=1,this.vertexSrc=`#define SHADER_NAME ${n}\n${this.vertexSrc}`,this.fragmentSrc=`#define SHADER_NAME ${n}\n${this.fragmentSrc}`,this.vertexSrc=YY(this.vertexSrc,ZY.defaultVertexPrecision,VW.HIGH),this.fragmentSrc=YY(this.fragmentSrc,ZY.defaultFragmentPrecision,VY())),this.glPrograms={},this.syncUniforms=null}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void){\n   gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n   vTextureCoord = aTextureCoord;\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor *= texture2D(uSampler, vTextureCoord);\n}"}static from(t,e,n){const r=t+e;let i=A$[r];return i||(A$[r]=i=new ZY(t,e,n)),i}};let JY=ZY;JY.defaultVertexPrecision=VW.HIGH,JY.defaultFragmentPrecision=aH.apple.device?VW.HIGH:VW.MEDIUM;let QY=0;class tX{constructor(t,e,n){this.group=!0,this.syncUniforms={},this.dirtyId=0,this.id=QY++,this.static=!!e,this.ubo=!!n,t instanceof tY?(this.buffer=t,this.buffer.type=GW.UNIFORM_BUFFER,this.autoManage=!1,this.ubo=!0):(this.uniforms=t,this.ubo&&(this.buffer=new tY(new Float32Array(1)),this.buffer.type=GW.UNIFORM_BUFFER,this.autoManage=!0))}update(){this.dirtyId++,!this.autoManage&&this.buffer&&this.buffer.update()}add(t,e,n){if(this.ubo)throw new Error("[UniformGroup] uniform groups in ubo mode cannot be modified, or have uniform groups nested in them");this.uniforms[t]=new tX(e,n)}static from(t,e,n){return new tX(t,e,n)}static uboFrom(t,e){return new tX(t,e??!0,!0)}}class eX{constructor(t,e){this.uniformBindCount=0,this.program=t,this.uniformGroup=e?e instanceof tX?e:new tX(e):new tX({}),this.disposeRunner=new $$("disposeShader")}checkUniformExists(t,e){if(e.uniforms[t])return!0;for(const n in e.uniforms){const r=e.uniforms[n];if(r.group&&this.checkUniformExists(t,r))return!0}return!1}destroy(){this.uniformGroup=null,this.disposeRunner.emit(this),this.disposeRunner.destroy()}get uniforms(){return this.uniformGroup.uniforms}static from(t,e,n){const r=JY.from(t,e);return new eX(r,n)}}class nX{constructor(t,e){if(this.vertexSrc=t,this.fragTemplate=e,this.programCache={},this.defaultGroupCache={},!e.includes("%count%"))throw new Error('Fragment template must contain "%count%".');if(!e.includes("%forloop%"))throw new Error('Fragment template must contain "%forloop%".')}generateShader(t){if(!this.programCache[t]){const e=new Int32Array(t);for(let r=0;r<t;r++)e[r]=r;this.defaultGroupCache[t]=tX.from({uSamplers:e},!0);let n=this.fragTemplate;n=n.replace(/%count%/gi,`${t}`),n=n.replace(/%forloop%/gi,this.generateSampleSrc(t)),this.programCache[t]=new JY(this.vertexSrc,n)}const e={tint:new Float32Array([1,1,1,1]),translationMatrix:new bY,default:this.defaultGroupCache[t]};return new eX(this.programCache[t],e)}generateSampleSrc(t){let e="";e+="\n",e+="\n";for(let n=0;n<t;n++)n>0&&(e+="\nelse "),n<t-1&&(e+=`if(vTextureId < ${n}.5)`),e+="\n{",e+=`\n\tcolor = texture2D(uSamplers[${n}], vTextureCoord);`,e+="\n}";return e+="\n",e+="\n",e}}class rX{constructor(){this.elements=[],this.ids=[],this.count=0}clear(){for(let t=0;t<this.count;t++)this.elements[t]=null;this.count=0}}class iX{constructor(t){this.renderer=t}flush(){}destroy(){this.renderer=null}start(){}stop(){this.flush()}render(t){}}const sX=class extends iX{constructor(t){super(t),this.setShaderGenerator(),this.geometryClass=aY,this.vertexSize=6,this.state=G$.for2d(),this.size=4*sX.defaultBatchSize,this._vertexCount=0,this._indexCount=0,this._bufferedElements=[],this._bufferedTextures=[],this._bufferSize=0,this._shader=null,this._packedGeometries=[],this._packedGeometryPoolSize=2,this._flushId=0,this._aBuffers={},this._iBuffers={},this.maxTextures=1,this.renderer.on("prerender",this.onPrerender,this),t.runners.contextChange.add(this),this._dcIndex=0,this._aIndex=0,this._iIndex=0,this._attributeBuffer=null,this._indexBuffer=null,this._tempBoundTextures=[]}static get defaultMaxTextures(){return this._defaultMaxTextures=this._defaultMaxTextures??function(t){let e=!0;const n=WW.ADAPTER.getNavigator();if(aH.tablet||aH.phone){if(aH.apple.device){const t=n.userAgent.match(/OS (\d+)_(\d+)?/);t&&parseInt(t[1],10)<11&&(e=!1)}if(aH.android.device){const t=n.userAgent.match(/Android\s([0-9.]*)/);t&&parseInt(t[1],10)<7&&(e=!1)}}return e?t:4}(32),this._defaultMaxTextures}static set defaultMaxTextures(t){this._defaultMaxTextures=t}static get canUploadSameBuffer(){return this._canUploadSameBuffer=this._canUploadSameBuffer??!aH.apple.device,this._canUploadSameBuffer}static set canUploadSameBuffer(t){this._canUploadSameBuffer=t}get MAX_TEXTURES(){return o$(0,"BatchRenderer#MAX_TEXTURES renamed to BatchRenderer#maxTextures"),this.maxTextures}static get defaultVertexSrc(){return"precision highp float;\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\nattribute float aTextureId;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform vec4 tint;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\n\nvoid main(void){\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vTextureId = aTextureId;\n    vColor = aColor * tint;\n}\n"}static get defaultFragmentTemplate(){return"varying vec2 vTextureCoord;\nvarying vec4 vColor;\nvarying float vTextureId;\nuniform sampler2D uSamplers[%count%];\n\nvoid main(void){\n    vec4 color;\n    %forloop%\n    gl_FragColor = color * vColor;\n}\n"}setShaderGenerator({vertex:t=sX.defaultVertexSrc,fragment:e=sX.defaultFragmentTemplate}={}){this.shaderGenerator=new nX(t,e)}contextChange(){const t=this.renderer.gl;WW.PREFER_ENV===kW.WEBGL_LEGACY?this.maxTextures=1:(this.maxTextures=Math.min(t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),sX.defaultMaxTextures),this.maxTextures=function(t,e){if(0===t)throw new Error("Invalid value of `0` passed to `checkMaxIfStatementsInShader`");const n=e.createShader(e.FRAGMENT_SHADER);for(;;){const r=j$.replace(/%forloop%/gi,z$(t));if(e.shaderSource(n,r),e.compileShader(n),e.getShaderParameter(n,e.COMPILE_STATUS))break;t=t/2|0}return t}(this.maxTextures,t)),this._shader=this.shaderGenerator.generateShader(this.maxTextures);for(let e=0;e<this._packedGeometryPoolSize;e++)this._packedGeometries[e]=new this.geometryClass;this.initFlushBuffers()}initFlushBuffers(){const{_drawCallPool:t,_textureArrayPool:e}=sX,n=this.size/4,r=Math.floor(n/this.maxTextures)+1;for(;t.length<n;)t.push(new J$);for(;e.length<r;)e.push(new rX);for(let i=0;i<this.maxTextures;i++)this._tempBoundTextures[i]=null}onPrerender(){this._flushId=0}render(t){t._texture.valid&&(this._vertexCount+t.vertexData.length/2>this.size&&this.flush(),this._vertexCount+=t.vertexData.length/2,this._indexCount+=t.indices.length,this._bufferedTextures[this._bufferSize]=t._texture.baseTexture,this._bufferedElements[this._bufferSize++]=t)}buildTexturesAndDrawCalls(){const{_bufferedTextures:t,maxTextures:e}=this,n=sX._textureArrayPool,r=this.renderer.batch,i=this._tempBoundTextures,s=this.renderer.textureGC.count;let o=++Z$._globalBatch,a=0,l=n[0],c=0;r.copyBoundTextures(i,e);for(let h=0;h<this._bufferSize;++h){const u=t[h];t[h]=null,u._batchEnabled!==o&&(l.count>=e&&(r.boundArray(l,i,o,e),this.buildDrawCalls(l,c,h),c=h,l=n[++a],++o),u._batchEnabled=o,u.touched=s,l.elements[l.count++]=u)}l.count>0&&(r.boundArray(l,i,o,e),this.buildDrawCalls(l,c,this._bufferSize),++a,++o);for(let h=0;h<i.length;h++)i[h]=null;Z$._globalBatch=o}buildDrawCalls(t,e,n){const{_bufferedElements:r,_attributeBuffer:i,_indexBuffer:s,vertexSize:o}=this,a=sX._drawCallPool;let l=this._dcIndex,c=this._aIndex,h=this._iIndex,u=a[l];u.start=this._iIndex,u.texArray=t;for(let d=e;d<n;++d){const n=r[d],f=n._texture.baseTexture,p=f$[f.alphaMode?1:0][n.blendMode];r[d]=null,e<d&&u.blend!==p&&(u.size=h-u.start,e=d,u=a[++l],u.texArray=t,u.start=h),this.packInterleavedGeometry(n,i,s,c,h),c+=n.vertexData.length/2*o,h+=n.indices.length,u.blend=p}e<n&&(u.size=h-u.start,++l),this._dcIndex=l,this._aIndex=c,this._iIndex=h}bindAndClearTexArray(t){const e=this.renderer.texture;for(let n=0;n<t.count;n++)e.bind(t.elements[n],t.ids[n]),t.elements[n]=null;t.count=0}updateGeometry(){const{_packedGeometries:t,_attributeBuffer:e,_indexBuffer:n}=this;sX.canUploadSameBuffer?(t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.updateBuffers()):(this._packedGeometryPoolSize<=this._flushId&&(this._packedGeometryPoolSize++,t[this._flushId]=new this.geometryClass),t[this._flushId]._buffer.update(e.rawBinaryData),t[this._flushId]._indexBuffer.update(n),this.renderer.geometry.bind(t[this._flushId]),this.renderer.geometry.updateBuffers(),this._flushId++)}drawBatches(){const t=this._dcIndex,{gl:e,state:n}=this.renderer,r=sX._drawCallPool;let i=null;for(let s=0;s<t;s++){const{texArray:t,type:o,size:a,start:l,blend:c}=r[s];i!==t&&(i=t,this.bindAndClearTexArray(t)),this.state.blendMode=c,n.set(this.state),e.drawElements(o,a,e.UNSIGNED_SHORT,2*l)}}flush(){0!==this._vertexCount&&(this._attributeBuffer=this.getAttributeBuffer(this._vertexCount),this._indexBuffer=this.getIndexBuffer(this._indexCount),this._aIndex=0,this._iIndex=0,this._dcIndex=0,this.buildTexturesAndDrawCalls(),this.updateGeometry(),this.drawBatches(),this._bufferSize=0,this._vertexCount=0,this._indexCount=0)}start(){this.renderer.state.set(this.state),this.renderer.texture.ensureSamplerType(this.maxTextures),this.renderer.shader.bind(this._shader),sX.canUploadSameBuffer&&this.renderer.geometry.bind(this._packedGeometries[this._flushId])}stop(){this.flush()}destroy(){for(let t=0;t<this._packedGeometryPoolSize;t++)this._packedGeometries[t]&&this._packedGeometries[t].destroy();this.renderer.off("prerender",this.onPrerender,this),this._aBuffers=null,this._iBuffers=null,this._packedGeometries=null,this._attributeBuffer=null,this._indexBuffer=null,this._shader&&(this._shader.destroy(),this._shader=null),super.destroy()}getAttributeBuffer(t){const e=y$(Math.ceil(t/8)),n=x$(e),r=8*e;this._aBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._aBuffers[r];return i||(this._aBuffers[r]=i=new V$(r*this.vertexSize*4)),i}getIndexBuffer(t){const e=y$(Math.ceil(t/12)),n=x$(e),r=12*e;this._iBuffers.length<=n&&(this._iBuffers.length=n+1);let i=this._iBuffers[n];return i||(this._iBuffers[n]=i=new Uint16Array(r)),i}packInterleavedGeometry(t,e,n,r,i){const{uint32View:s,float32View:o}=e,a=r/this.vertexSize,l=t.uvs,c=t.indices,h=t.vertexData,u=t._texture.baseTexture._batchLocation,d=Math.min(t.worldAlpha,1),f=d<1&&t._texture.baseTexture.alphaMode?m$(t._tintRGB,d):t._tintRGB+(255*d<<24);for(let p=0;p<h.length;p+=2)o[r++]=h[p],o[r++]=h[p+1],o[r++]=l[p],o[r++]=l[p+1],s[r++]=f,o[r++]=u;for(let p=0;p<c.length;p++)n[i++]=a+c[p]}};let oX=sX;oX.defaultBatchSize=4096,oX.extension={name:"batch",type:F$.RendererPlugin},oX._drawCallPool=[],oX._textureArrayPool=[],U$.add(oX);const aX=class extends eX{constructor(t,e,n){super(JY.from(t||aX.defaultVertexSrc,e||aX.defaultFragmentSrc),n),this.padding=0,this.resolution=aX.defaultResolution,this.multisample=aX.defaultMultisample,this.enabled=!0,this.autoFit=!0,this.state=new G$}apply(t,e,n,r,i){t.applyFilter(this,e,n,r)}get blendMode(){return this.state.blendMode}set blendMode(t){this.state.blendMode=t}get resolution(){return this._resolution}set resolution(t){this._resolution=t}static get defaultVertexSrc(){return"attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n"}static get defaultFragmentSrc(){return"varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n   gl_FragColor = texture2D(uSampler, vTextureCoord);\n}\n"}};let lX=aX;lX.defaultResolution=1,lX.defaultMultisample=zW.NONE;class cX{constructor(){this.clearBeforeRender=!0,this._backgroundColor=0,this._backgroundColorRgba=[0,0,0,1],this._backgroundColorString="#000000",this.color=this._backgroundColor,this.alpha=1}init(t){this.clearBeforeRender=t.clearBeforeRender,t.color&&(this.color="string"==typeof t.color?u$(t.color):t.color),this.alpha=t.alpha}get color(){return this._backgroundColor}set color(t){this._backgroundColor=t,this._backgroundColorString=h$(t),c$(t,this._backgroundColorRgba)}get alpha(){return this._backgroundColorRgba[3]}set alpha(t){this._backgroundColorRgba[3]=t}get colorRgba(){return this._backgroundColorRgba}get colorString(){return this._backgroundColorString}destroy(){}}cX.extension={type:[F$.RendererSystem,F$.CanvasRendererSystem],name:"background"},U$.add(cX);class hX{constructor(t){this.renderer=t,this.emptyRenderer=new iX(t),this.currentRenderer=this.emptyRenderer}setObjectRenderer(t){this.currentRenderer!==t&&(this.currentRenderer.stop(),this.currentRenderer=t,this.currentRenderer.start())}flush(){this.setObjectRenderer(this.emptyRenderer)}reset(){this.setObjectRenderer(this.emptyRenderer)}copyBoundTextures(t,e){const{boundTextures:n}=this.renderer.texture;for(let r=e-1;r>=0;--r)t[r]=n[r]||null,t[r]&&(t[r]._batchLocation=r)}boundArray(t,e,n,r){const{elements:i,ids:s,count:o}=t;let a=0;for(let l=0;l<o;l++){const t=i[l],o=t._batchLocation;if(o>=0&&o<r&&e[o]===t)s[l]=o;else for(;a<r;){const r=e[a];if(!r||r._batchEnabled!==n||r._batchLocation!==a){s[l]=a,t._batchLocation=a,e[a]=t;break}a++}}}destroy(){this.renderer=null}}hX.extension={type:F$.RendererSystem,name:"batch"},U$.add(hX);let uX=0;class dX{constructor(t){this.renderer=t,this.webGLVersion=1,this.extensions={},this.supports={uint32Indices:!1},this.handleContextLost=this.handleContextLost.bind(this),this.handleContextRestored=this.handleContextRestored.bind(this)}get isLost(){return!this.gl||this.gl.isContextLost()}contextChange(t){this.gl=t,this.renderer.gl=t,this.renderer.CONTEXT_UID=uX++}init(t){if(t.context)this.initFromContext(t.context);else{const e=this.renderer.background.alpha<1,n=t.premultipliedAlpha;this.preserveDrawingBuffer=t.preserveDrawingBuffer,this.useContextAlpha=t.useContextAlpha,this.powerPreference=t.powerPreference,this.initFromOptions({alpha:e,premultipliedAlpha:n,antialias:t.antialias,stencil:!0,preserveDrawingBuffer:t.preserveDrawingBuffer,powerPreference:t.powerPreference})}}initFromContext(t){this.gl=t,this.validateContext(t),this.renderer.gl=t,this.renderer.CONTEXT_UID=uX++,this.renderer.runners.contextChange.emit(t);const e=this.renderer.view;void 0!==e.addEventListener&&(e.addEventListener("webglcontextlost",this.handleContextLost,!1),e.addEventListener("webglcontextrestored",this.handleContextRestored,!1))}initFromOptions(t){const e=this.createContext(this.renderer.view,t);this.initFromContext(e)}createContext(t,e){let n;if(WW.PREFER_ENV>=kW.WEBGL2&&(n=t.getContext("webgl2",e)),n)this.webGLVersion=2;else if(this.webGLVersion=1,n=t.getContext("webgl",e)||t.getContext("experimental-webgl",e),!n)throw new Error("This browser does not support WebGL. Try using the canvas renderer");return this.gl=n,this.getExtensions(),this.gl}getExtensions(){const{gl:t}=this,e={loseContext:t.getExtension("WEBGL_lose_context"),anisotropicFiltering:t.getExtension("EXT_texture_filter_anisotropic"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),s3tc:t.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:t.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:t.getExtension("WEBGL_compressed_texture_etc"),etc1:t.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:t.getExtension("WEBGL_compressed_texture_pvrtc")||t.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:t.getExtension("WEBGL_compressed_texture_atc"),astc:t.getExtension("WEBGL_compressed_texture_astc")};1===this.webGLVersion?Object.assign(this.extensions,e,{drawBuffers:t.getExtension("WEBGL_draw_buffers"),depthTexture:t.getExtension("WEBGL_depth_texture"),vertexArrayObject:t.getExtension("OES_vertex_array_object")||t.getExtension("MOZ_OES_vertex_array_object")||t.getExtension("WEBKIT_OES_vertex_array_object"),uint32ElementIndex:t.getExtension("OES_element_index_uint"),floatTexture:t.getExtension("OES_texture_float"),floatTextureLinear:t.getExtension("OES_texture_float_linear"),textureHalfFloat:t.getExtension("OES_texture_half_float"),textureHalfFloatLinear:t.getExtension("OES_texture_half_float_linear")}):2===this.webGLVersion&&Object.assign(this.extensions,e,{colorBufferFloat:t.getExtension("EXT_color_buffer_float")})}handleContextLost(t){t.preventDefault(),setTimeout((()=>{this.gl.isContextLost()&&this.extensions.loseContext&&this.extensions.loseContext.restoreContext()}),0)}handleContextRestored(){this.renderer.runners.contextChange.emit(this.gl)}destroy(){const t=this.renderer.view;this.renderer=null,void 0!==t.removeEventListener&&(t.removeEventListener("webglcontextlost",this.handleContextLost),t.removeEventListener("webglcontextrestored",this.handleContextRestored)),this.gl.useProgram(null),this.extensions.loseContext&&this.extensions.loseContext.loseContext()}postrender(){this.renderer.objectRenderer.renderingToScreen&&this.gl.flush()}validateContext(t){const e=t.getContextAttributes(),n="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext;n&&(this.webGLVersion=2),e&&e.stencil;const r=n||!!t.getExtension("OES_element_index_uint");this.supports.uint32Indices=r}}dX.extension={type:F$.RendererSystem,name:"context"},U$.add(dX);class fX extends X${upload(t,e,n){const r=t.gl;r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===NW.UNPACK);const i=e.realWidth,s=e.realHeight;return n.width===i&&n.height===s?r.texSubImage2D(e.target,0,0,0,i,s,e.format,n.type,this.data):(n.width=i,n.height=s,r.texImage2D(e.target,0,n.internalFormat,i,s,0,e.format,n.type,this.data)),!0}}class pX{constructor(t,e){this.width=Math.round(t||100),this.height=Math.round(e||100),this.stencil=!1,this.depth=!1,this.dirtyId=0,this.dirtyFormat=0,this.dirtySize=0,this.depthTexture=null,this.colorTextures=[],this.glFramebuffers={},this.disposeRunner=new $$("disposeFramebuffer"),this.multisample=zW.NONE}get colorTexture(){return this.colorTextures[0]}addColorTexture(t=0,e){return this.colorTextures[t]=e||new Z$(null,{scaleMode:PW.NEAREST,resolution:1,mipmap:FW.OFF,width:this.width,height:this.height}),this.dirtyId++,this.dirtyFormat++,this}addDepthTexture(t){return this.depthTexture=t||new Z$(new fX(null,{width:this.width,height:this.height}),{scaleMode:PW.NEAREST,resolution:1,width:this.width,height:this.height,mipmap:FW.OFF,format:MW.DEPTH_COMPONENT,type:DW.UNSIGNED_SHORT}),this.dirtyId++,this.dirtyFormat++,this}enableDepth(){return this.depth=!0,this.dirtyId++,this.dirtyFormat++,this}enableStencil(){return this.stencil=!0,this.dirtyId++,this.dirtyFormat++,this}resize(t,e){if(t=Math.round(t),e=Math.round(e),t!==this.width||e!==this.height){this.width=t,this.height=e,this.dirtyId++,this.dirtySize++;for(let n=0;n<this.colorTextures.length;n++){const r=this.colorTextures[n],i=r.resolution;r.setSize(t/i,e/i)}if(this.depthTexture){const n=this.depthTexture.resolution;this.depthTexture.setSize(t/n,e/n)}}}dispose(){this.disposeRunner.emit(this,!1)}destroyDepthTexture(){this.depthTexture&&(this.depthTexture.destroy(),this.depthTexture=null,++this.dirtyId,++this.dirtyFormat)}}class mX extends Z${constructor(t={}){if("number"==typeof t){t={width:arguments[0],height:arguments[1],scaleMode:arguments[2],resolution:arguments[3]}}t.width=t.width||100,t.height=t.height||100,t.multisample??(t.multisample=zW.NONE),super(null,t),this.mipmap=FW.OFF,this.valid=!0,this.clearColor=[0,0,0,0],this.framebuffer=new pX(this.realWidth,this.realHeight).addColorTexture(0,this),this.framebuffer.multisample=t.multisample,this.maskStack=[],this.filterStack=[{}]}resize(t,e){this.framebuffer.resize(t*this.resolution,e*this.resolution),this.setRealSize(this.framebuffer.width,this.framebuffer.height)}dispose(){this.framebuffer.dispose(),super.dispose()}destroy(){super.destroy(),this.framebuffer.destroyDepthTexture(),this.framebuffer=null}}class gX extends Y${constructor(t){const e=t;super(e.naturalWidth||e.videoWidth||e.width,e.naturalHeight||e.videoHeight||e.height),this.source=t,this.noSubImage=!1}static crossOrigin(t,e,n){void 0!==n||e.startsWith("data:")?!1!==n&&(t.crossOrigin="string"==typeof n?n:"anonymous"):t.crossOrigin=function(t,e=globalThis.location){if(t.startsWith("data:"))return"";e=e||globalThis.location,P$||(P$=document.createElement("a")),P$.href=t;const n=e$.parse(P$.href),r=!n.port&&""===e.port||n.port===e.port;return n.hostname===e.hostname&&r&&n.protocol===e.protocol?"":"anonymous"}(e)}upload(t,e,n,r){const i=t.gl,s=e.realWidth,o=e.realHeight;if(r=r||this.source,"undefined"!=typeof HTMLImageElement&&r instanceof HTMLImageElement){if(!r.complete||0===r.naturalWidth)return!1}else if("undefined"!=typeof HTMLVideoElement&&r instanceof HTMLVideoElement&&r.readyState<=1&&0===r.buffered.length)return!1;return i.pixelStorei(i.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.alphaMode===NW.UNPACK),this.noSubImage||e.target!==i.TEXTURE_2D||n.width!==s||n.height!==o?(n.width=s,n.height=o,i.texImage2D(e.target,0,n.internalFormat,e.format,n.type,r)):i.texSubImage2D(i.TEXTURE_2D,0,0,0,e.format,n.type,r),!0}update(){if(this.destroyed)return;const t=this.source,e=t.naturalWidth||t.videoWidth||t.width,n=t.naturalHeight||t.videoHeight||t.height;this.resize(e,n),super.update()}dispose(){this.source=null}}class vX extends gX{constructor(t,e){if(e=e||{},"string"==typeof t){const n=new Image;gX.crossOrigin(n,t,e.crossorigin),n.src=t,t=n}super(t),!t.complete&&this._width&&this._height&&(this._width=0,this._height=0),this.url=t.src,this._process=null,this.preserveBitmap=!1,this.createBitmap=(e.createBitmap??WW.CREATE_IMAGE_BITMAP)&&!!globalThis.createImageBitmap,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this.bitmap=null,this._load=null,!1!==e.autoLoad&&this.load()}load(t){return this._load||(void 0!==t&&(this.createBitmap=t),this._load=new Promise(((t,e)=>{const n=this.source;this.url=n.src;const r=()=>{this.destroyed||(n.onload=null,n.onerror=null,this.resize(n.width,n.height),this._load=null,this.createBitmap?t(this.process()):t(this))};n.complete&&n.src?r():(n.onload=r,n.onerror=t=>{e(t),this.onError.emit(t)})}))),this._load}process(){const t=this.source;if(null!==this._process)return this._process;if(null!==this.bitmap||!globalThis.createImageBitmap)return Promise.resolve(this);const e=globalThis.createImageBitmap,n=!t.crossOrigin||"anonymous"===t.crossOrigin;return this._process=fetch(t.src,{mode:n?"cors":"no-cors"}).then((t=>t.blob())).then((n=>e(n,0,0,t.width,t.height,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===NW.UNPACK?"premultiply":"none"}))).then((t=>this.destroyed?Promise.reject():(this.bitmap=t,this.update(),this._process=null,Promise.resolve(this)))),this._process}upload(t,e,n){if("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),!this.createBitmap)return super.upload(t,e,n);if(!this.bitmap&&(this.process(),!this.bitmap))return!1;if(super.upload(t,e,n,this.bitmap),!this.preserveBitmap){let t=!0;const r=e._glTextures;for(const i in r){const s=r[i];if(s!==n&&s.dirtyId!==e.dirtyId){t=!1;break}}t&&(this.bitmap.close&&this.bitmap.close(),this.bitmap=null)}return!0}dispose(){this.source.onload=null,this.source.onerror=null,super.dispose(),this.bitmap&&(this.bitmap.close(),this.bitmap=null),this._process=null,this._load=null}static test(t){return"undefined"!=typeof HTMLImageElement&&("string"==typeof t||t instanceof HTMLImageElement)}}class yX{constructor(){this.x0=0,this.y0=0,this.x1=1,this.y1=0,this.x2=1,this.y2=1,this.x3=0,this.y3=1,this.uvsFloat32=new Float32Array(8)}set(t,e,n){const r=e.width,i=e.height;if(n){const e=t.width/2/r,s=t.height/2/i,o=t.x/r+e,a=t.y/i+s;n=AY.add(n,AY.NW),this.x0=o+e*AY.uX(n),this.y0=a+s*AY.uY(n),n=AY.add(n,2),this.x1=o+e*AY.uX(n),this.y1=a+s*AY.uY(n),n=AY.add(n,2),this.x2=o+e*AY.uX(n),this.y2=a+s*AY.uY(n),n=AY.add(n,2),this.x3=o+e*AY.uX(n),this.y3=a+s*AY.uY(n)}else this.x0=t.x/r,this.y0=t.y/i,this.x1=(t.x+t.width)/r,this.y1=t.y/i,this.x2=(t.x+t.width)/r,this.y2=(t.y+t.height)/i,this.x3=t.x/r,this.y3=(t.y+t.height)/i;this.uvsFloat32[0]=this.x0,this.uvsFloat32[1]=this.y0,this.uvsFloat32[2]=this.x1,this.uvsFloat32[3]=this.y1,this.uvsFloat32[4]=this.x2,this.uvsFloat32[5]=this.y2,this.uvsFloat32[6]=this.x3,this.uvsFloat32[7]=this.y3}toString(){return`[@pixi/core:TextureUvs x0=${this.x0} y0=${this.y0} x1=${this.x1} y1=${this.y1} x2=${this.x2} y2=${this.y2} x3=${this.x3} y3=${this.y3}]`}}const bX=new yX;function xX(t){t.destroy=function(){},t.on=function(){},t.once=function(){},t.emit=function(){}}class wX extends cH{constructor(t,e,n,r,i,s){if(super(),this.noFrame=!1,e||(this.noFrame=!0,e=new pY(0,0,1,1)),t instanceof wX&&(t=t.baseTexture),this.baseTexture=t,this._frame=e,this.trim=r,this.valid=!1,this._uvs=bX,this.uvMatrix=null,this.orig=n||e,this._rotate=Number(i||0),!0===i)this._rotate=2;else if(this._rotate%2!=0)throw new Error("attempt to use diamond-shaped UVs. If you are sure, set rotation manually");this.defaultAnchor=s?new dY(s.x,s.y):new dY(0,0),this._updateID=0,this.textureCacheIds=[],t.valid?this.noFrame?t.valid&&this.onBaseTextureUpdated(t):this.frame=e:t.once("loaded",this.onBaseTextureUpdated,this),this.noFrame&&t.on("update",this.onBaseTextureUpdated,this)}update(){this.baseTexture.resource&&this.baseTexture.resource.update()}onBaseTextureUpdated(t){if(this.noFrame){if(!this.baseTexture.valid)return;this._frame.width=t.width,this._frame.height=t.height,this.valid=!0,this.updateUvs()}else this.frame=this._frame;this.emit("update",this)}destroy(t){if(this.baseTexture){if(t){const{resource:t}=this.baseTexture;(null==t?void 0:t.url)&&C$[t.url]&&wX.removeFromCache(t.url),this.baseTexture.destroy()}this.baseTexture.off("loaded",this.onBaseTextureUpdated,this),this.baseTexture.off("update",this.onBaseTextureUpdated,this),this.baseTexture=null}this._frame=null,this._uvs=null,this.trim=null,this.orig=null,this.valid=!1,wX.removeFromCache(this),this.textureCacheIds=null}clone(){var t;const e=this._frame.clone(),n=this._frame===this.orig?e:this.orig.clone(),r=new wX(this.baseTexture,!this.noFrame&&e,n,null==(t=this.trim)?void 0:t.clone(),this.rotate,this.defaultAnchor);return this.noFrame&&(r._frame=e),r}updateUvs(){this._uvs===bX&&(this._uvs=new yX),this._uvs.set(this._frame,this.baseTexture,this.rotate),this._updateID++}static from(t,e={},n=WW.STRICT_TEXTURE_CACHE){const r="string"==typeof t;let i=null;if(r)i=t;else if(t instanceof Z$){if(!t.cacheId){const n=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t.cacheId=`${n}-${S$()}`,Z$.addToCache(t,t.cacheId)}i=t.cacheId}else{if(!t._pixiId){const n=(null==e?void 0:e.pixiIdPrefix)||"pixiid";t._pixiId=`${n}_${S$()}`}i=t._pixiId}let s=C$[i];if(r&&n&&!s)throw new Error(`The cacheId "${i}" does not exist in TextureCache.`);return s||t instanceof Z$?!s&&t instanceof Z$&&(s=new wX(t),wX.addToCache(s,i)):(e.resolution||(e.resolution=L$(t)),s=new wX(new Z$(t,e)),s.baseTexture.cacheId=i,Z$.addToCache(s.baseTexture,i),wX.addToCache(s,i)),s}static fromURL(t,e){const n=Object.assign({autoLoad:!1},null==e?void 0:e.resourceOptions),r=wX.from(t,Object.assign({resourceOptions:n},e),!1),i=r.baseTexture.resource;return r.baseTexture.valid?Promise.resolve(r):i.load().then((()=>Promise.resolve(r)))}static fromBuffer(t,e,n,r){return new wX(Z$.fromBuffer(t,e,n,r))}static fromLoader(t,e,n,r){const i=new Z$(t,Object.assign({scaleMode:Z$.defaultOptions.scaleMode,resolution:L$(e)},r)),{resource:s}=i;s instanceof vX&&(s.url=e);const o=new wX(i);return n||(n=e),Z$.addToCache(o.baseTexture,n),wX.addToCache(o,n),n!==e&&(Z$.addToCache(o.baseTexture,e),wX.addToCache(o,e)),o.baseTexture.valid?Promise.resolve(o):new Promise((t=>{o.baseTexture.once("loaded",(()=>t(o)))}))}static addToCache(t,e){e&&(t.textureCacheIds.includes(e)||t.textureCacheIds.push(e),C$[e]&&C$[e],C$[e]=t)}static removeFromCache(t){if("string"==typeof t){const e=C$[t];if(e){const n=e.textureCacheIds.indexOf(t);return n>-1&&e.textureCacheIds.splice(n,1),delete C$[t],e}}else if(null==t?void 0:t.textureCacheIds){for(let e=0;e<t.textureCacheIds.length;++e)C$[t.textureCacheIds[e]]===t&&delete C$[t.textureCacheIds[e]];return t.textureCacheIds.length=0,t}return null}get resolution(){return this.baseTexture.resolution}get frame(){return this._frame}set frame(t){this._frame=t,this.noFrame=!1;const{x:e,y:n,width:r,height:i}=t,s=e+r>this.baseTexture.width,o=n+i>this.baseTexture.height;if(s||o){const t=s&&o?"and":"or",a=`X: ${e} + ${r} = ${e+r} > ${this.baseTexture.width}`,l=`Y: ${n} + ${i} = ${n+i} > ${this.baseTexture.height}`;throw new Error(`Texture Error: frame does not fit inside the base Texture dimensions: ${a} ${t} ${l}`)}this.valid=r&&i&&this.baseTexture.valid,this.trim||this.rotate||(this.orig=t),this.valid&&this.updateUvs()}get rotate(){return this._rotate}set rotate(t){this._rotate=t,this.valid&&this.updateUvs()}get width(){return this.orig.width}get height(){return this.orig.height}castToBaseTexture(){return this.baseTexture}static get EMPTY(){return wX._EMPTY||(wX._EMPTY=new wX(new Z$),xX(wX._EMPTY),xX(wX._EMPTY.baseTexture)),wX._EMPTY}static get WHITE(){if(!wX._WHITE){const t=WW.ADAPTER.createCanvas(16,16),e=t.getContext("2d");t.width=16,t.height=16,e.fillStyle="white",e.fillRect(0,0,16,16),wX._WHITE=new wX(Z$.from(t)),xX(wX._WHITE),xX(wX._WHITE.baseTexture)}return wX._WHITE}}class EX extends wX{constructor(t,e){super(t,e),this.valid=!0,this.filterFrame=null,this.filterPoolKey=null,this.updateUvs()}get framebuffer(){return this.baseTexture.framebuffer}get multisample(){return this.framebuffer.multisample}set multisample(t){this.framebuffer.multisample=t}resize(t,e,n=!0){const r=this.baseTexture.resolution,i=Math.round(t*r)/r,s=Math.round(e*r)/r;this.valid=i>0&&s>0,this._frame.width=this.orig.width=i,this._frame.height=this.orig.height=s,n&&this.baseTexture.resize(i,s),this.updateUvs()}setResolution(t){const{baseTexture:e}=this;e.resolution!==t&&(e.setResolution(t),this.resize(e.width,e.height,!1))}static create(t){return new EX(new mX(t))}}class _X{constructor(t){this.texturePool={},this.textureOptions=t||{},this.enableFullScreen=!1,this._pixelsWidth=0,this._pixelsHeight=0}createTexture(t,e,n=zW.NONE){const r=new mX(Object.assign({width:t,height:e,resolution:1,multisample:n},this.textureOptions));return new EX(r)}getOptimalTexture(t,e,n=1,r=zW.NONE){let i;t=Math.ceil(t*n-1e-6),e=Math.ceil(e*n-1e-6),this.enableFullScreen&&t===this._pixelsWidth&&e===this._pixelsHeight?i=r>1?-r:-1:(i=((65535&(t=y$(t)))<<16|65535&(e=y$(e)))>>>0,r>1&&(i+=4294967296*r)),this.texturePool[i]||(this.texturePool[i]=[]);let s=this.texturePool[i].pop();return s||(s=this.createTexture(t,e,r)),s.filterPoolKey=i,s.setResolution(n),s}getFilterTexture(t,e,n){const r=this.getOptimalTexture(t.width,t.height,e||t.resolution,n||zW.NONE);return r.filterFrame=t.filterFrame,r}returnTexture(t){const e=t.filterPoolKey;t.filterFrame=null,this.texturePool[e].push(t)}returnFilterTexture(t){this.returnTexture(t)}clear(t){if(t=!1!==t)for(const e in this.texturePool){const t=this.texturePool[e];if(t)for(let e=0;e<t.length;e++)t[e].destroy(!0)}this.texturePool={}}setScreenSize(t){if(t.width!==this._pixelsWidth||t.height!==this._pixelsHeight){this.enableFullScreen=t.width>0&&t.height>0;for(const t in this.texturePool){if(!(Number(t)<0))continue;const e=this.texturePool[t];if(e)for(let t=0;t<e.length;t++)e[t].destroy(!0);this.texturePool[t]=[]}this._pixelsWidth=t.width,this._pixelsHeight=t.height}}}_X.SCREEN_KEY=-1;class SX extends oY{constructor(){super(),this.addAttribute("aVertexPosition",new Float32Array([0,0,1,0,1,1,0,1])).addIndex([0,1,3,2])}}class TX extends oY{constructor(){super(),this.vertices=new Float32Array([-1,-1,1,-1,1,1,-1,1]),this.uvs=new Float32Array([0,0,1,0,1,1,0,1]),this.vertexBuffer=new tY(this.vertices),this.uvBuffer=new tY(this.uvs),this.addAttribute("aVertexPosition",this.vertexBuffer).addAttribute("aTextureCoord",this.uvBuffer).addIndex([0,1,2,0,2,3])}map(t,e){let n=0,r=0;return this.uvs[0]=n,this.uvs[1]=r,this.uvs[2]=n+e.width/t.width,this.uvs[3]=r,this.uvs[4]=n+e.width/t.width,this.uvs[5]=r+e.height/t.height,this.uvs[6]=n,this.uvs[7]=r+e.height/t.height,n=e.x,r=e.y,this.vertices[0]=n,this.vertices[1]=r,this.vertices[2]=n+e.width,this.vertices[3]=r,this.vertices[4]=n+e.width,this.vertices[5]=r+e.height,this.vertices[6]=n,this.vertices[7]=r+e.height,this.invalidate(),this}invalidate(){return this.vertexBuffer._updateID++,this.uvBuffer._updateID++,this}}class kX{constructor(){this.renderTexture=null,this.target=null,this.legacy=!1,this.resolution=1,this.multisample=zW.NONE,this.sourceFrame=new pY,this.destinationFrame=new pY,this.bindingSourceFrame=new pY,this.bindingDestinationFrame=new pY,this.filters=[],this.transform=null}clear(){this.target=null,this.filters=null,this.renderTexture=null}}const AX=[new dY,new dY,new dY,new dY],CX=new bY;class RX{constructor(t){this.renderer=t,this.defaultFilterStack=[{}],this.texturePool=new _X,this.statePool=[],this.quad=new SX,this.quadUv=new TX,this.tempRect=new pY,this.activeState={},this.globalUniforms=new tX({outputFrame:new pY,inputSize:new Float32Array(4),inputPixel:new Float32Array(4),inputClamp:new Float32Array(4),resolution:1,filterArea:new Float32Array(4),filterClamp:new Float32Array(4)},!0),this.forceClear=!1,this.useMaxPadding=!1}init(){this.texturePool.setScreenSize(this.renderer.view)}push(t,e){const n=this.renderer,r=this.defaultFilterStack,i=this.statePool.pop()||new kX,s=this.renderer.renderTexture;let o=e[0].resolution,a=e[0].multisample,l=e[0].padding,c=e[0].autoFit,h=e[0].legacy??!0;for(let f=1;f<e.length;f++){const t=e[f];o=Math.min(o,t.resolution),a=Math.min(a,t.multisample),l=this.useMaxPadding?Math.max(l,t.padding):l+t.padding,c=c&&t.autoFit,h=h||(t.legacy??!0)}1===r.length&&(this.defaultFilterStack[0].renderTexture=s.current),r.push(i),i.resolution=o,i.multisample=a,i.legacy=h,i.target=t,i.sourceFrame.copyFrom(t.filterArea||t.getBounds(!0)),i.sourceFrame.pad(l);const u=this.tempRect.copyFrom(s.sourceFrame);n.projection.transform&&this.transformAABB(CX.copyFrom(n.projection.transform).invert(),u),c?(i.sourceFrame.fit(u),(i.sourceFrame.width<=0||i.sourceFrame.height<=0)&&(i.sourceFrame.width=0,i.sourceFrame.height=0)):i.sourceFrame.intersects(u)||(i.sourceFrame.width=0,i.sourceFrame.height=0),this.roundFrame(i.sourceFrame,s.current?s.current.resolution:n.resolution,s.sourceFrame,s.destinationFrame,n.projection.transform),i.renderTexture=this.getOptimalFilterTexture(i.sourceFrame.width,i.sourceFrame.height,o,a),i.filters=e,i.destinationFrame.width=i.renderTexture.width,i.destinationFrame.height=i.renderTexture.height;const d=this.tempRect;d.x=0,d.y=0,d.width=i.sourceFrame.width,d.height=i.sourceFrame.height,i.renderTexture.filterFrame=i.sourceFrame,i.bindingSourceFrame.copyFrom(s.sourceFrame),i.bindingDestinationFrame.copyFrom(s.destinationFrame),i.transform=n.projection.transform,n.projection.transform=null,s.bind(i.renderTexture,i.sourceFrame,d),n.framebuffer.clear(0,0,0,0)}pop(){const t=this.defaultFilterStack,e=t.pop(),n=e.filters;this.activeState=e;const r=this.globalUniforms.uniforms;r.outputFrame=e.sourceFrame,r.resolution=e.resolution;const i=r.inputSize,s=r.inputPixel,o=r.inputClamp;if(i[0]=e.destinationFrame.width,i[1]=e.destinationFrame.height,i[2]=1/i[0],i[3]=1/i[1],s[0]=Math.round(i[0]*e.resolution),s[1]=Math.round(i[1]*e.resolution),s[2]=1/s[0],s[3]=1/s[1],o[0]=.5*s[2],o[1]=.5*s[3],o[2]=e.sourceFrame.width*i[2]-.5*s[2],o[3]=e.sourceFrame.height*i[3]-.5*s[3],e.legacy){const t=r.filterArea;t[0]=e.destinationFrame.width,t[1]=e.destinationFrame.height,t[2]=e.sourceFrame.x,t[3]=e.sourceFrame.y,r.filterClamp=r.inputClamp}this.globalUniforms.update();const a=t[t.length-1];if(this.renderer.framebuffer.blit(),1===n.length)n[0].apply(this,e.renderTexture,a.renderTexture,BW.BLEND,e),this.returnFilterTexture(e.renderTexture);else{let t=e.renderTexture,r=this.getOptimalFilterTexture(t.width,t.height,e.resolution);r.filterFrame=t.filterFrame;let i=0;for(i=0;i<n.length-1;++i){1===i&&e.multisample>1&&(r=this.getOptimalFilterTexture(t.width,t.height,e.resolution),r.filterFrame=t.filterFrame),n[i].apply(this,t,r,BW.CLEAR,e);const s=t;t=r,r=s}n[i].apply(this,t,a.renderTexture,BW.BLEND,e),i>1&&e.multisample>1&&this.returnFilterTexture(e.renderTexture),this.returnFilterTexture(t),this.returnFilterTexture(r)}e.clear(),this.statePool.push(e)}bindAndClear(t,e=BW.CLEAR){const{renderTexture:n,state:r}=this.renderer;if(t===this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?this.renderer.projection.transform=this.activeState.transform:this.renderer.projection.transform=null,null==t?void 0:t.filterFrame){const e=this.tempRect;e.x=0,e.y=0,e.width=t.filterFrame.width,e.height=t.filterFrame.height,n.bind(t,t.filterFrame,e)}else t!==this.defaultFilterStack[this.defaultFilterStack.length-1].renderTexture?n.bind(t):this.renderer.renderTexture.bind(t,this.activeState.bindingSourceFrame,this.activeState.bindingDestinationFrame);const i=1&r.stateId||this.forceClear;(e===BW.CLEAR||e===BW.BLIT&&i)&&this.renderer.framebuffer.clear(0,0,0,0)}applyFilter(t,e,n,r){const i=this.renderer;i.state.set(t.state),this.bindAndClear(n,r),t.uniforms.uSampler=e,t.uniforms.filterGlobals=this.globalUniforms,i.shader.bind(t),t.legacy=!!t.program.attributeData.aTextureCoord,t.legacy?(this.quadUv.map(e._frame,e.filterFrame),i.geometry.bind(this.quadUv),i.geometry.draw(RW.TRIANGLES)):(i.geometry.bind(this.quad),i.geometry.draw(RW.TRIANGLE_STRIP))}calculateSpriteMatrix(t,e){const{sourceFrame:n,destinationFrame:r}=this.activeState,{orig:i}=e._texture,s=t.set(r.width,0,0,r.height,n.x,n.y),o=e.worldTransform.copyTo(bY.TEMP_MATRIX);return o.invert(),s.prepend(o),s.scale(1/i.width,1/i.height),s.translate(e.anchor.x,e.anchor.y),s}destroy(){this.renderer=null,this.texturePool.clear(!1)}getOptimalFilterTexture(t,e,n=1,r=zW.NONE){return this.texturePool.getOptimalTexture(t,e,n,r)}getFilterTexture(t,e,n){if("number"==typeof t){const n=t;t=e,e=n}t=t||this.activeState.renderTexture;const r=this.texturePool.getOptimalTexture(t.width,t.height,e||t.resolution,n||zW.NONE);return r.filterFrame=t.filterFrame,r}returnFilterTexture(t){this.texturePool.returnTexture(t)}emptyPool(){this.texturePool.clear(!0)}resize(){this.texturePool.setScreenSize(this.renderer.view)}transformAABB(t,e){const n=AX[0],r=AX[1],i=AX[2],s=AX[3];n.set(e.left,e.top),r.set(e.left,e.bottom),i.set(e.right,e.top),s.set(e.right,e.bottom),t.apply(n,n),t.apply(r,r),t.apply(i,i),t.apply(s,s);const o=Math.min(n.x,r.x,i.x,s.x),a=Math.min(n.y,r.y,i.y,s.y),l=Math.max(n.x,r.x,i.x,s.x),c=Math.max(n.y,r.y,i.y,s.y);e.x=o,e.y=a,e.width=l-o,e.height=c-a}roundFrame(t,e,n,r,i){if(!(t.width<=0||t.height<=0||n.width<=0||n.height<=0)){if(i){const{a:t,b:e,c:n,d:r}=i;if((Math.abs(e)>1e-4||Math.abs(n)>1e-4)&&(Math.abs(t)>1e-4||Math.abs(r)>1e-4))return}(i=i?CX.copyFrom(i):CX.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.transformAABB(i,t),t.ceil(e),this.transformAABB(i.invert(),t)}}}RX.extension={type:F$.RendererSystem,name:"filter"},U$.add(RX);class MX{constructor(t){this.framebuffer=t,this.stencil=null,this.dirtyId=-1,this.dirtyFormat=-1,this.dirtySize=-1,this.multisample=zW.NONE,this.msaaBuffer=null,this.blitFramebuffer=null,this.mipLevel=0}}const IX=new pY;class DX{constructor(t){this.renderer=t,this.managedFramebuffers=[],this.unknownFramebuffer=new pX(10,10),this.msaaSamples=null}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.current=this.unknownFramebuffer,this.viewport=new pY,this.hasMRT=!0,this.writeDepthTexture=!0,1===this.renderer.context.webGLVersion){let e=this.renderer.context.extensions.drawBuffers,n=this.renderer.context.extensions.depthTexture;WW.PREFER_ENV===kW.WEBGL_LEGACY&&(e=null,n=null),e?t.drawBuffers=t=>e.drawBuffersWEBGL(t):(this.hasMRT=!1,t.drawBuffers=()=>{}),n||(this.writeDepthTexture=!1)}else this.msaaSamples=t.getInternalformatParameter(t.RENDERBUFFER,t.RGBA8,t.SAMPLES)}bind(t,e,n=0){const{gl:r}=this;if(t){const i=t.glFramebuffers[this.CONTEXT_UID]||this.initFramebuffer(t);this.current!==t&&(this.current=t,r.bindFramebuffer(r.FRAMEBUFFER,i.framebuffer)),i.mipLevel!==n&&(t.dirtyId++,t.dirtyFormat++,i.mipLevel=n),i.dirtyId!==t.dirtyId&&(i.dirtyId=t.dirtyId,i.dirtyFormat!==t.dirtyFormat?(i.dirtyFormat=t.dirtyFormat,i.dirtySize=t.dirtySize,this.updateFramebuffer(t,n)):i.dirtySize!==t.dirtySize&&(i.dirtySize=t.dirtySize,this.resizeFramebuffer(t)));for(let e=0;e<t.colorTextures.length;e++){const n=t.colorTextures[e];this.renderer.texture.unbind(n.parentTextureArray||n)}if(t.depthTexture&&this.renderer.texture.unbind(t.depthTexture),e){const t=e.width>>n,r=e.height>>n,i=t/e.width;this.setViewport(e.x*i,e.y*i,t,r)}else{const e=t.width>>n,r=t.height>>n;this.setViewport(0,0,e,r)}}else this.current&&(this.current=null,r.bindFramebuffer(r.FRAMEBUFFER,null)),e?this.setViewport(e.x,e.y,e.width,e.height):this.setViewport(0,0,this.renderer.width,this.renderer.height)}setViewport(t,e,n,r){const i=this.viewport;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),i.width===n&&i.height===r&&i.x===t&&i.y===e||(i.x=t,i.y=e,i.width=n,i.height=r,this.gl.viewport(t,e,n,r))}get size(){return this.current?{x:0,y:0,width:this.current.width,height:this.current.height}:{x:0,y:0,width:this.renderer.width,height:this.renderer.height}}clear(t,e,n,r,i=AW.COLOR|AW.DEPTH){const{gl:s}=this;s.clearColor(t,e,n,r),s.clear(i)}initFramebuffer(t){const{gl:e}=this,n=new MX(e.createFramebuffer());return n.multisample=this.detectSamples(t.multisample),t.glFramebuffers[this.CONTEXT_UID]=n,this.managedFramebuffers.push(t),t.disposeRunner.add(this),n}resizeFramebuffer(t){const{gl:e}=this,n=t.glFramebuffers[this.CONTEXT_UID];n.stencil&&(e.bindRenderbuffer(e.RENDERBUFFER,n.stencil),n.msaaBuffer?e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,e.DEPTH24_STENCIL8,t.width,t.height):e.renderbufferStorage(e.RENDERBUFFER,e.DEPTH_STENCIL,t.width,t.height));const r=t.colorTextures;let i=r.length;e.drawBuffers||(i=Math.min(i,1));for(let s=0;s<i;s++){const i=r[s],o=i.parentTextureArray||i;this.renderer.texture.bind(o,0),0===s&&n.msaaBuffer&&(e.bindRenderbuffer(e.RENDERBUFFER,n.msaaBuffer),e.renderbufferStorageMultisample(e.RENDERBUFFER,n.multisample,o._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height))}t.depthTexture&&this.writeDepthTexture&&this.renderer.texture.bind(t.depthTexture,0)}updateFramebuffer(t,e){const{gl:n}=this,r=t.glFramebuffers[this.CONTEXT_UID],i=t.colorTextures;let s=i.length;n.drawBuffers||(s=Math.min(s,1)),r.multisample>1&&this.canMultisampleFramebuffer(t)?r.msaaBuffer=r.msaaBuffer||n.createRenderbuffer():r.msaaBuffer&&(n.deleteRenderbuffer(r.msaaBuffer),r.msaaBuffer=null,r.blitFramebuffer&&(r.blitFramebuffer.dispose(),r.blitFramebuffer=null));const o=[];for(let a=0;a<s;a++){const s=i[a],l=s.parentTextureArray||s;this.renderer.texture.bind(l,0),0===a&&r.msaaBuffer?(n.bindRenderbuffer(n.RENDERBUFFER,r.msaaBuffer),n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,l._glTextures[this.CONTEXT_UID].internalFormat,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.RENDERBUFFER,r.msaaBuffer)):(n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0+a,s.target,l._glTextures[this.CONTEXT_UID].texture,e),o.push(n.COLOR_ATTACHMENT0+a))}if(o.length>1&&n.drawBuffers(o),t.depthTexture){if(this.writeDepthTexture){const r=t.depthTexture;this.renderer.texture.bind(r,0),n.framebufferTexture2D(n.FRAMEBUFFER,n.DEPTH_ATTACHMENT,n.TEXTURE_2D,r._glTextures[this.CONTEXT_UID].texture,e)}}!t.stencil&&!t.depth||t.depthTexture&&this.writeDepthTexture?r.stencil&&(n.deleteRenderbuffer(r.stencil),r.stencil=null):(r.stencil=r.stencil||n.createRenderbuffer(),n.bindRenderbuffer(n.RENDERBUFFER,r.stencil),r.msaaBuffer?n.renderbufferStorageMultisample(n.RENDERBUFFER,r.multisample,n.DEPTH24_STENCIL8,t.width,t.height):n.renderbufferStorage(n.RENDERBUFFER,n.DEPTH_STENCIL,t.width,t.height),n.framebufferRenderbuffer(n.FRAMEBUFFER,n.DEPTH_STENCIL_ATTACHMENT,n.RENDERBUFFER,r.stencil))}canMultisampleFramebuffer(t){return 1!==this.renderer.context.webGLVersion&&t.colorTextures.length<=1&&!t.depthTexture}detectSamples(t){const{msaaSamples:e}=this;let n=zW.NONE;if(t<=1||null===e)return n;for(let r=0;r<e.length;r++)if(e[r]<=t){n=e[r];break}return 1===n&&(n=zW.NONE),n}blit(t,e,n){const{current:r,renderer:i,gl:s,CONTEXT_UID:o}=this;if(2!==i.context.webGLVersion)return;if(!r)return;const a=r.glFramebuffers[o];if(!a)return;if(!t){if(!a.msaaBuffer)return;const e=r.colorTextures[0];if(!e)return;a.blitFramebuffer||(a.blitFramebuffer=new pX(r.width,r.height),a.blitFramebuffer.addColorTexture(0,e)),(t=a.blitFramebuffer).colorTextures[0]!==e&&(t.colorTextures[0]=e,t.dirtyId++,t.dirtyFormat++),t.width===r.width&&t.height===r.height||(t.width=r.width,t.height=r.height,t.dirtyId++,t.dirtySize++)}e||((e=IX).width=r.width,e.height=r.height),n||(n=e);const l=e.width===n.width&&e.height===n.height;this.bind(t),s.bindFramebuffer(s.READ_FRAMEBUFFER,a.framebuffer),s.blitFramebuffer(e.left,e.top,e.right,e.bottom,n.left,n.top,n.right,n.bottom,s.COLOR_BUFFER_BIT,l?s.NEAREST:s.LINEAR)}disposeFramebuffer(t,e){const n=t.glFramebuffers[this.CONTEXT_UID],r=this.gl;if(!n)return;delete t.glFramebuffers[this.CONTEXT_UID];const i=this.managedFramebuffers.indexOf(t);i>=0&&this.managedFramebuffers.splice(i,1),t.disposeRunner.remove(this),e||(r.deleteFramebuffer(n.framebuffer),n.msaaBuffer&&r.deleteRenderbuffer(n.msaaBuffer),n.stencil&&r.deleteRenderbuffer(n.stencil)),n.blitFramebuffer&&n.blitFramebuffer.dispose()}disposeAll(t){const e=this.managedFramebuffers;this.managedFramebuffers=[];for(let n=0;n<e.length;n++)this.disposeFramebuffer(e[n],t)}forceStencil(){const t=this.current;if(!t)return;const e=t.glFramebuffers[this.CONTEXT_UID];if(!e||e.stencil)return;t.stencil=!0;const n=t.width,r=t.height,i=this.gl,s=i.createRenderbuffer();i.bindRenderbuffer(i.RENDERBUFFER,s),e.msaaBuffer?i.renderbufferStorageMultisample(i.RENDERBUFFER,e.multisample,i.DEPTH24_STENCIL8,n,r):i.renderbufferStorage(i.RENDERBUFFER,i.DEPTH_STENCIL,n,r),e.stencil=s,i.framebufferRenderbuffer(i.FRAMEBUFFER,i.DEPTH_STENCIL_ATTACHMENT,i.RENDERBUFFER,s)}reset(){this.current=this.unknownFramebuffer,this.viewport=new pY}destroy(){this.renderer=null}}DX.extension={type:F$.RendererSystem,name:"framebuffer"},U$.add(DX);const OX={5126:4,5123:2,5121:1};class PX{constructor(t){this.renderer=t,this._activeGeometry=null,this._activeVao=null,this.hasVao=!0,this.hasInstance=!0,this.canUseUInt32ElementIndex=!1,this.managedGeometries={}}contextChange(){this.disposeAll(!0);const t=this.gl=this.renderer.gl,e=this.renderer.context;if(this.CONTEXT_UID=this.renderer.CONTEXT_UID,2!==e.webGLVersion){let e=this.renderer.context.extensions.vertexArrayObject;WW.PREFER_ENV===kW.WEBGL_LEGACY&&(e=null),e?(t.createVertexArray=()=>e.createVertexArrayOES(),t.bindVertexArray=t=>e.bindVertexArrayOES(t),t.deleteVertexArray=t=>e.deleteVertexArrayOES(t)):(this.hasVao=!1,t.createVertexArray=()=>null,t.bindVertexArray=()=>null,t.deleteVertexArray=()=>null)}if(2!==e.webGLVersion){const e=t.getExtension("ANGLE_instanced_arrays");e?(t.vertexAttribDivisor=(t,n)=>e.vertexAttribDivisorANGLE(t,n),t.drawElementsInstanced=(t,n,r,i,s)=>e.drawElementsInstancedANGLE(t,n,r,i,s),t.drawArraysInstanced=(t,n,r,i)=>e.drawArraysInstancedANGLE(t,n,r,i)):this.hasInstance=!1}this.canUseUInt32ElementIndex=2===e.webGLVersion||!!e.extensions.uint32ElementIndex}bind(t,e){e=e||this.renderer.shader.shader;const{gl:n}=this;let r=t.glVertexArrayObjects[this.CONTEXT_UID],i=!1;r||(this.managedGeometries[t.id]=t,t.disposeRunner.add(this),t.glVertexArrayObjects[this.CONTEXT_UID]=r={},i=!0);const s=r[e.program.id]||this.initGeometryVao(t,e,i);this._activeGeometry=t,this._activeVao!==s&&(this._activeVao=s,this.hasVao?n.bindVertexArray(s):this.activateVao(t,e.program)),this.updateBuffers()}reset(){this.unbind()}updateBuffers(){const t=this._activeGeometry,e=this.renderer.buffer;for(let n=0;n<t.buffers.length;n++){const r=t.buffers[n];e.update(r)}}checkCompatibility(t,e){const n=t.attributes,r=e.attributeData;for(const i in r)if(!n[i])throw new Error(`shader and geometry incompatible, geometry missing the "${i}" attribute`)}getSignature(t,e){const n=t.attributes,r=e.attributeData,i=["g",t.id];for(const s in n)r[s]&&i.push(s,r[s].location);return i.join("-")}initGeometryVao(t,e,n=!0){const r=this.gl,i=this.CONTEXT_UID,s=this.renderer.buffer,o=e.program;o.glPrograms[i]||this.renderer.shader.generateProgram(e),this.checkCompatibility(t,o);const a=this.getSignature(t,o),l=t.glVertexArrayObjects[this.CONTEXT_UID];let c=l[a];if(c)return l[o.id]=c,c;const h=t.buffers,u=t.attributes,d={},f={};for(const p in h)d[p]=0,f[p]=0;for(const p in u)!u[p].size&&o.attributeData[p]?u[p].size=o.attributeData[p].size:u[p].size,d[u[p].buffer]+=u[p].size*OX[u[p].type];for(const p in u){const t=u[p],e=t.size;void 0===t.stride&&(d[t.buffer]===e*OX[t.type]?t.stride=0:t.stride=d[t.buffer]),void 0===t.start&&(t.start=f[t.buffer],f[t.buffer]+=e*OX[t.type])}c=r.createVertexArray(),r.bindVertexArray(c);for(let p=0;p<h.length;p++){const t=h[p];s.bind(t),n&&t._glBuffers[i].refCount++}return this.activateVao(t,o),l[o.id]=c,l[a]=c,r.bindVertexArray(null),s.unbind(GW.ARRAY_BUFFER),c}disposeGeometry(t,e){var n;if(!this.managedGeometries[t.id])return;delete this.managedGeometries[t.id];const r=t.glVertexArrayObjects[this.CONTEXT_UID],i=this.gl,s=t.buffers,o=null==(n=this.renderer)?void 0:n.buffer;if(t.disposeRunner.remove(this),r){if(o)for(let t=0;t<s.length;t++){const n=s[t]._glBuffers[this.CONTEXT_UID];n&&(n.refCount--,0!==n.refCount||e||o.dispose(s[t],e))}if(!e)for(const t in r)if("g"===t[0]){const e=r[t];this._activeVao===e&&this.unbind(),i.deleteVertexArray(e)}delete t.glVertexArrayObjects[this.CONTEXT_UID]}}disposeAll(t){const e=Object.keys(this.managedGeometries);for(let n=0;n<e.length;n++)this.disposeGeometry(this.managedGeometries[e[n]],t)}activateVao(t,e){const n=this.gl,r=this.CONTEXT_UID,i=this.renderer.buffer,s=t.buffers,o=t.attributes;t.indexBuffer&&i.bind(t.indexBuffer);let a=null;for(const l in o){const t=o[l],c=s[t.buffer],h=c._glBuffers[r];if(e.attributeData[l]){a!==h&&(i.bind(c),a=h);const r=e.attributeData[l].location;if(n.enableVertexAttribArray(r),n.vertexAttribPointer(r,t.size,t.type||n.FLOAT,t.normalized,t.stride,t.start),t.instance){if(!this.hasInstance)throw new Error("geometry error, GPU Instancing is not supported on this device");n.vertexAttribDivisor(r,t.divisor)}}}}draw(t,e,n,r){const{gl:i}=this,s=this._activeGeometry;if(s.indexBuffer){const o=s.indexBuffer.data.BYTES_PER_ELEMENT,a=2===o?i.UNSIGNED_SHORT:i.UNSIGNED_INT;(2===o||4===o&&this.canUseUInt32ElementIndex)&&(s.instanced?i.drawElementsInstanced(t,e||s.indexBuffer.data.length,a,(n||0)*o,r||1):i.drawElements(t,e||s.indexBuffer.data.length,a,(n||0)*o))}else s.instanced?i.drawArraysInstanced(t,n,e||s.getSize(),r||1):i.drawArrays(t,n,e||s.getSize());return this}unbind(){this.gl.bindVertexArray(null),this._activeVao=null,this._activeGeometry=null}destroy(){this.renderer=null}}PX.extension={type:F$.RendererSystem,name:"geometry"},U$.add(PX);const LX=new bY;class FX{constructor(t,e){this._texture=t,this.mapCoord=new bY,this.uClampFrame=new Float32Array(4),this.uClampOffset=new Float32Array(2),this._textureID=-1,this._updateID=0,this.clampOffset=0,this.clampMargin=void 0===e?.5:e,this.isSimple=!1}get texture(){return this._texture}set texture(t){this._texture=t,this._textureID=-1}multiplyUvs(t,e){void 0===e&&(e=t);const n=this.mapCoord;for(let r=0;r<t.length;r+=2){const i=t[r],s=t[r+1];e[r]=i*n.a+s*n.c+n.tx,e[r+1]=i*n.b+s*n.d+n.ty}return e}update(t){const e=this._texture;if(!e||!e.valid)return!1;if(!t&&this._textureID===e._updateID)return!1;this._textureID=e._updateID,this._updateID++;const n=e._uvs;this.mapCoord.set(n.x1-n.x0,n.y1-n.y0,n.x3-n.x0,n.y3-n.y0,n.x0,n.y0);const r=e.orig,i=e.trim;i&&(LX.set(r.width/i.width,0,0,r.height/i.height,-i.x/i.width,-i.y/i.height),this.mapCoord.append(LX));const s=e.baseTexture,o=this.uClampFrame,a=this.clampMargin/s.resolution,l=this.clampOffset;return o[0]=(e._frame.x+a+l)/s.width,o[1]=(e._frame.y+a+l)/s.height,o[2]=(e._frame.x+e._frame.width-a+l)/s.width,o[3]=(e._frame.y+e._frame.height-a+l)/s.height,this.uClampOffset[0]=l/s.realWidth,this.uClampOffset[1]=l/s.realHeight,this.isSimple=e._frame.width===s.width&&e._frame.height===s.height&&0===e.rotate,!0}}class NX extends lX{constructor(t,e,n){let r=null;"string"!=typeof t&&void 0===e&&void 0===n&&(r=t,t=void 0,e=void 0,n=void 0),super(t||"attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 otherMatrix;\n\nvarying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vMaskCoord = ( otherMatrix * vec3( aTextureCoord, 1.0)  ).xy;\n}\n",e||"varying vec2 vMaskCoord;\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform sampler2D mask;\nuniform float alpha;\nuniform float npmAlpha;\nuniform vec4 maskClamp;\n\nvoid main(void)\n{\n    float clip = step(3.5,\n        step(maskClamp.x, vMaskCoord.x) +\n        step(maskClamp.y, vMaskCoord.y) +\n        step(vMaskCoord.x, maskClamp.z) +\n        step(vMaskCoord.y, maskClamp.w));\n\n    vec4 original = texture2D(uSampler, vTextureCoord);\n    vec4 masky = texture2D(mask, vMaskCoord);\n    float alphaMul = 1.0 - npmAlpha * (1.0 - masky.a);\n\n    original *= (alphaMul * masky.r * alpha * clip);\n\n    gl_FragColor = original;\n}\n",n),this.maskSprite=r,this.maskMatrix=new bY}get maskSprite(){return this._maskSprite}set maskSprite(t){this._maskSprite=t,this._maskSprite&&(this._maskSprite.renderable=!1)}apply(t,e,n,r){const i=this._maskSprite,s=i._texture;s.valid&&(s.uvMatrix||(s.uvMatrix=new FX(s,0)),s.uvMatrix.update(),this.uniforms.npmAlpha=s.baseTexture.alphaMode?0:1,this.uniforms.mask=s,this.uniforms.otherMatrix=t.calculateSpriteMatrix(this.maskMatrix,i).prepend(s.uvMatrix.mapCoord),this.uniforms.alpha=i.worldAlpha,this.uniforms.maskClamp=s.uvMatrix.uClampFrame,t.applyFilter(this,e,n,r))}}class BX{constructor(t=null){this.type=jW.NONE,this.autoDetect=!0,this.maskObject=t||null,this.pooled=!1,this.isMaskData=!0,this.resolution=null,this.multisample=lX.defaultMultisample,this.enabled=!0,this.colorMask=15,this._filters=null,this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null,this._scissorRectLocal=null,this._colorMask=15,this._target=null}get filter(){return this._filters?this._filters[0]:null}set filter(t){t?this._filters?this._filters[0]=t:this._filters=[t]:this._filters=null}reset(){this.pooled&&(this.maskObject=null,this.type=jW.NONE,this.autoDetect=!0),this._target=null,this._scissorRectLocal=null}copyCountersOrReset(t){t?(this._stencilCounter=t._stencilCounter,this._scissorCounter=t._scissorCounter,this._scissorRect=t._scissorRect):(this._stencilCounter=0,this._scissorCounter=0,this._scissorRect=null)}}class UX{constructor(t){this.renderer=t,this.enableScissor=!0,this.alphaMaskPool=[],this.maskDataPool=[],this.maskStack=[],this.alphaMaskIndex=0}setMaskStack(t){this.maskStack=t,this.renderer.scissor.setMaskStack(t),this.renderer.stencil.setMaskStack(t)}push(t,e){let n=e;if(!n.isMaskData){const t=this.maskDataPool.pop()||new BX;t.pooled=!0,t.maskObject=e,n=t}const r=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null;if(n.copyCountersOrReset(r),n._colorMask=r?r._colorMask:15,n.autoDetect&&this.detect(n),n._target=t,n.type!==jW.SPRITE&&this.maskStack.push(n),n.enabled)switch(n.type){case jW.SCISSOR:this.renderer.scissor.push(n);break;case jW.STENCIL:this.renderer.stencil.push(n);break;case jW.SPRITE:n.copyCountersOrReset(null),this.pushSpriteMask(n);break;case jW.COLOR:this.pushColorMask(n)}n.type===jW.SPRITE&&this.maskStack.push(n)}pop(t){const e=this.maskStack.pop();if(e&&e._target===t){if(e.enabled)switch(e.type){case jW.SCISSOR:this.renderer.scissor.pop(e);break;case jW.STENCIL:this.renderer.stencil.pop(e.maskObject);break;case jW.SPRITE:this.popSpriteMask(e);break;case jW.COLOR:this.popColorMask(e)}if(e.reset(),e.pooled&&this.maskDataPool.push(e),0!==this.maskStack.length){const t=this.maskStack[this.maskStack.length-1];t.type===jW.SPRITE&&t._filters&&(t._filters[0].maskSprite=t.maskObject)}}}detect(t){const e=t.maskObject;e?e.isSprite?t.type=jW.SPRITE:this.enableScissor&&this.renderer.scissor.testScissor(t)?t.type=jW.SCISSOR:t.type=jW.STENCIL:t.type=jW.COLOR}pushSpriteMask(t){const{maskObject:e}=t,n=t._target;let r=t._filters;r||(r=this.alphaMaskPool[this.alphaMaskIndex],r||(r=this.alphaMaskPool[this.alphaMaskIndex]=[new NX]));const i=this.renderer,s=i.renderTexture;let o,a;if(s.current){const e=s.current;o=t.resolution||e.resolution,a=t.multisample??e.multisample}else o=t.resolution||i.resolution,a=t.multisample??i.multisample;r[0].resolution=o,r[0].multisample=a,r[0].maskSprite=e;const l=n.filterArea;n.filterArea=e.getBounds(!0),i.filter.push(n,r),n.filterArea=l,t._filters||this.alphaMaskIndex++}popSpriteMask(t){this.renderer.filter.pop(),t._filters?t._filters[0].maskSprite=null:(this.alphaMaskIndex--,this.alphaMaskPool[this.alphaMaskIndex][0].maskSprite=null)}pushColorMask(t){const e=t._colorMask,n=t._colorMask=e&t.colorMask;n!==e&&this.renderer.gl.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))}popColorMask(t){const e=t._colorMask,n=this.maskStack.length>0?this.maskStack[this.maskStack.length-1]._colorMask:15;n!==e&&this.renderer.gl.colorMask(0!=(1&n),0!=(2&n),0!=(4&n),0!=(8&n))}destroy(){this.renderer=null}}UX.extension={type:F$.RendererSystem,name:"mask"},U$.add(UX);class VX{constructor(t){this.renderer=t,this.maskStack=[],this.glConst=0}getStackLength(){return this.maskStack.length}setMaskStack(t){const{gl:e}=this.renderer,n=this.getStackLength();this.maskStack=t;const r=this.getStackLength();r!==n&&(0===r?e.disable(this.glConst):(e.enable(this.glConst),this._useCurrent()))}_useCurrent(){}destroy(){this.renderer=null,this.maskStack=null}}const jX=new bY,zX=[],GX=class extends VX{constructor(t){super(t),this.glConst=WW.ADAPTER.getWebGLRenderingContext().SCISSOR_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._scissorCounter:0}calcScissorRect(t){if(t._scissorRectLocal)return;const e=t._scissorRect,{maskObject:n}=t,{renderer:r}=this,i=r.renderTexture,s=n.getBounds(!0,zX.pop()??new pY);this.roundFrameToPixels(s,i.current?i.current.resolution:r.resolution,i.sourceFrame,i.destinationFrame,r.projection.transform),e&&s.fit(e),t._scissorRectLocal=s}static isMatrixRotated(t){if(!t)return!1;const{a:e,b:n,c:r,d:i}=t;return(Math.abs(n)>1e-4||Math.abs(r)>1e-4)&&(Math.abs(e)>1e-4||Math.abs(i)>1e-4)}testScissor(t){const{maskObject:e}=t;if(!e.isFastRect||!e.isFastRect())return!1;if(GX.isMatrixRotated(e.worldTransform))return!1;if(GX.isMatrixRotated(this.renderer.projection.transform))return!1;this.calcScissorRect(t);const n=t._scissorRectLocal;return n.width>0&&n.height>0}roundFrameToPixels(t,e,n,r,i){GX.isMatrixRotated(i)||((i=i?jX.copyFrom(i):jX.identity()).translate(-n.x,-n.y).scale(r.width/n.width,r.height/n.height).translate(r.x,r.y),this.renderer.filter.transformAABB(i,t),t.fit(r),t.x=Math.round(t.x*e),t.y=Math.round(t.y*e),t.width=Math.round(t.width*e),t.height=Math.round(t.height*e))}push(t){t._scissorRectLocal||this.calcScissorRect(t);const{gl:e}=this.renderer;t._scissorRect||e.enable(e.SCISSOR_TEST),t._scissorCounter++,t._scissorRect=t._scissorRectLocal,this._useCurrent()}pop(t){const{gl:e}=this.renderer;t&&zX.push(t._scissorRectLocal),this.getStackLength()>0?this._useCurrent():e.disable(e.SCISSOR_TEST)}_useCurrent(){const t=this.maskStack[this.maskStack.length-1]._scissorRect;let e;e=this.renderer.renderTexture.current?t.y:this.renderer.height-t.height-t.y,this.renderer.gl.scissor(t.x,e,t.width,t.height)}};let WX=GX;WX.extension={type:F$.RendererSystem,name:"scissor"},U$.add(WX);class HX extends VX{constructor(t){super(t),this.glConst=WW.ADAPTER.getWebGLRenderingContext().STENCIL_TEST}getStackLength(){const t=this.maskStack[this.maskStack.length-1];return t?t._stencilCounter:0}push(t){const e=t.maskObject,{gl:n}=this.renderer,r=t._stencilCounter;0===r&&(this.renderer.framebuffer.forceStencil(),n.clearStencil(0),n.clear(n.STENCIL_BUFFER_BIT),n.enable(n.STENCIL_TEST)),t._stencilCounter++;const i=t._colorMask;0!==i&&(t._colorMask=0,n.colorMask(!1,!1,!1,!1)),n.stencilFunc(n.EQUAL,r,4294967295),n.stencilOp(n.KEEP,n.KEEP,n.INCR),e.renderable=!0,e.render(this.renderer),this.renderer.batch.flush(),e.renderable=!1,0!==i&&(t._colorMask=i,n.colorMask(0!=(1&i),0!=(2&i),0!=(4&i),0!=(8&i))),this._useCurrent()}pop(t){const e=this.renderer.gl;if(0===this.getStackLength())e.disable(e.STENCIL_TEST);else{const n=0!==this.maskStack.length?this.maskStack[this.maskStack.length-1]:null,r=n?n._colorMask:15;0!==r&&(n._colorMask=0,e.colorMask(!1,!1,!1,!1)),e.stencilOp(e.KEEP,e.KEEP,e.DECR),t.renderable=!0,t.render(this.renderer),this.renderer.batch.flush(),t.renderable=!1,0!==r&&(n._colorMask=r,e.colorMask(0!=(1&r),0!=(2&r),0!=(4&r),0!=(8&r))),this._useCurrent()}}_useCurrent(){const t=this.renderer.gl;t.stencilFunc(t.EQUAL,this.getStackLength(),4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP)}}HX.extension={type:F$.RendererSystem,name:"stencil"},U$.add(HX);class $X{constructor(t){this.renderer=t,this.plugins={},Object.defineProperties(this.plugins,{extract:{enumerable:!1,get:()=>(o$(0,"renderer.plugins.extract has moved to renderer.extract"),t.extract)},prepare:{enumerable:!1,get:()=>(o$(0,"renderer.plugins.prepare has moved to renderer.prepare"),t.prepare)},interaction:{enumerable:!1,get:()=>(o$(0,"renderer.plugins.interaction has been deprecated, use renderer.events"),t.events)}})}init(t){for(const e in t)this.plugins[e]=new t[e](this.renderer)}destroy(){for(const t in this.plugins)this.plugins[t].destroy(),this.plugins[t]=null}}$X.extension={type:[F$.RendererSystem,F$.CanvasRendererSystem],name:"_plugin"},U$.add($X);class YX{constructor(t){this.renderer=t,this.destinationFrame=null,this.sourceFrame=null,this.defaultFrame=null,this.projectionMatrix=new bY,this.transform=null}update(t,e,n,r){this.destinationFrame=t||this.destinationFrame||this.defaultFrame,this.sourceFrame=e||this.sourceFrame||t,this.calculateProjection(this.destinationFrame,this.sourceFrame,n,r),this.transform&&this.projectionMatrix.append(this.transform);const i=this.renderer;i.globalUniforms.uniforms.projectionMatrix=this.projectionMatrix,i.globalUniforms.update(),i.shader.shader&&i.shader.syncUniformGroup(i.shader.shader.uniforms.globals)}calculateProjection(t,e,n,r){const i=this.projectionMatrix,s=r?-1:1;i.identity(),i.a=1/e.width*2,i.d=s*(1/e.height*2),i.tx=-1-e.x*i.a,i.ty=-s-e.y*i.d}setTransform(t){}destroy(){this.renderer=null}}YX.extension={type:F$.RendererSystem,name:"projection"},U$.add(YX);const XX=new MY;class qX{constructor(t){this.renderer=t,this._tempMatrix=new bY}generateTexture(t,e){const{region:n,...r}=e||{},i=n||t.getLocalBounds(null,!0);0===i.width&&(i.width=1),0===i.height&&(i.height=1);const s=EX.create({width:i.width,height:i.height,...r});this._tempMatrix.tx=-i.x,this._tempMatrix.ty=-i.y;const o=t.transform;return t.transform=XX,this.renderer.render(t,{renderTexture:s,transform:this._tempMatrix,skipUpdateTransform:!!t.parent,blit:!0}),t.transform=o,s}destroy(){}}qX.extension={type:[F$.RendererSystem,F$.CanvasRendererSystem],name:"textureGenerator"},U$.add(qX);const KX=new pY,ZX=new pY;class JX{constructor(t){this.renderer=t,this.defaultMaskStack=[],this.current=null,this.sourceFrame=new pY,this.destinationFrame=new pY,this.viewportFrame=new pY}bind(t=null,e,n){const r=this.renderer;let i,s,o;this.current=t,t?(i=t.baseTexture,o=i.resolution,e||(KX.width=t.frame.width,KX.height=t.frame.height,e=KX),n||(ZX.x=t.frame.x,ZX.y=t.frame.y,ZX.width=e.width,ZX.height=e.height,n=ZX),s=i.framebuffer):(o=r.resolution,e||(KX.width=r._view.screen.width,KX.height=r._view.screen.height,e=KX),n||((n=KX).width=e.width,n.height=e.height));const a=this.viewportFrame;a.x=n.x*o,a.y=n.y*o,a.width=n.width*o,a.height=n.height*o,t||(a.y=r.view.height-(a.y+a.height)),a.ceil(),this.renderer.framebuffer.bind(s,a),this.renderer.projection.update(n,e,o,!s),t?this.renderer.mask.setMaskStack(i.maskStack):this.renderer.mask.setMaskStack(this.defaultMaskStack),this.sourceFrame.copyFrom(e),this.destinationFrame.copyFrom(n)}clear(t,e){t=this.current?t||this.current.baseTexture.clearColor:t||this.renderer.background.colorRgba;const n=this.destinationFrame,r=this.current?this.current.baseTexture:this.renderer._view.screen,i=n.width!==r.width||n.height!==r.height;if(i){let{x:t,y:e,width:n,height:r}=this.viewportFrame;t=Math.round(t),e=Math.round(e),n=Math.round(n),r=Math.round(r),this.renderer.gl.enable(this.renderer.gl.SCISSOR_TEST),this.renderer.gl.scissor(t,e,n,r)}this.renderer.framebuffer.clear(t[0],t[1],t[2],t[3],e),i&&this.renderer.scissor.pop()}resize(){this.bind(null)}reset(){this.bind(null)}destroy(){this.renderer=null}}JX.extension={type:F$.RendererSystem,name:"renderTexture"},U$.add(JX);class QX{constructor(t,e){this.program=t,this.uniformData=e,this.uniformGroups={},this.uniformDirtyGroups={},this.uniformBufferBindings={}}destroy(){this.uniformData=null,this.uniformGroups=null,this.uniformDirtyGroups=null,this.uniformBufferBindings=null,this.program=null}}function tq(t,e){var n;const r=IY(t,t.VERTEX_SHADER,e.vertexSrc),i=IY(t,t.FRAGMENT_SHADER,e.fragmentSrc),s=t.createProgram();t.attachShader(s,r),t.attachShader(s,i);const o=null==(n=e.extra)?void 0:n.transformFeedbackVaryings;if(o&&("function"!=typeof t.transformFeedbackVaryings||t.transformFeedbackVaryings(s,o.names,"separate"===o.bufferMode?t.SEPARATE_ATTRIBS:t.INTERLEAVED_ATTRIBS)),t.linkProgram(s),t.getProgramParameter(s,t.LINK_STATUS)||function(t,e,n,r){t.getProgramParameter(e,t.LINK_STATUS)||(t.getShaderParameter(n,t.COMPILE_STATUS)||jY(t,n),t.getShaderParameter(r,t.COMPILE_STATUS)||jY(t,r),t.getProgramInfoLog(e))}(t,s,r,i),e.attributeData=function(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_ATTRIBUTES);for(let i=0;i<r;i++){const r=e.getActiveAttrib(t,i);if(r.name.startsWith("gl_"))continue;const s=$Y(e,r.type),o={type:s,name:r.name,size:GY(s),location:e.getAttribLocation(t,r.name)};n[r.name]=o}return n}(s,t),e.uniformData=function(t,e){const n={},r=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<r;i++){const r=e.getActiveUniform(t,i),s=r.name.replace(/\[.*?\]$/,""),o=!!r.name.match(/\[.*?\]$/),a=$Y(e,r.type);n[s]={name:s,index:i,type:a,size:r.size,isArray:o,value:OY(a,r.size)}}return n}(s,t),!/^[ \t]*#[ \t]*version[ \t]+300[ \t]+es[ \t]*$/m.test(e.vertexSrc)){const n=Object.keys(e.attributeData);n.sort(((t,e)=>t>e?1:-1));for(let r=0;r<n.length;r++)e.attributeData[n[r]].location=r,t.bindAttribLocation(s,r,n[r]);t.linkProgram(s)}t.deleteShader(r),t.deleteShader(i);const a={};for(const l in e.uniformData){const n=e.uniformData[l];a[l]={location:t.getUniformLocation(s,l),value:OY(n.type,n.size)}}return new QX(s,a)}function eq(t,e,n,r,i){n.buffer.update(i)}const nq={float:"\n        data[offset] = v;\n    ",vec2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n    ",vec3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n    ",vec4:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n        data[offset+3] = v[3];\n    ",mat2:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n\n        data[offset+4] = v[2];\n        data[offset+5] = v[3];\n    ",mat3:"\n        data[offset] = v[0];\n        data[offset+1] = v[1];\n        data[offset+2] = v[2];\n\n        data[offset + 4] = v[3];\n        data[offset + 5] = v[4];\n        data[offset + 6] = v[5];\n\n        data[offset + 8] = v[6];\n        data[offset + 9] = v[7];\n        data[offset + 10] = v[8];\n    ",mat4:"\n        for(var i = 0; i < 16; i++)\n        {\n            data[offset + i] = v[i];\n        }\n    "},rq={float:4,vec2:8,vec3:12,vec4:16,int:4,ivec2:8,ivec3:12,ivec4:16,uint:4,uvec2:8,uvec3:12,uvec4:16,bool:4,bvec2:8,bvec3:12,bvec4:16,mat2:32,mat3:48,mat4:64};function iq(t,e){if(!t.autoManage)return{size:0,syncFunc:eq};const n=function(t,e){const n=[];for(const r in t)e[r]&&n.push(e[r]);return n.sort(((t,e)=>t.index-e.index)),n}(t.uniforms,e),{uboElements:r,size:i}=function(t){const e=t.map((t=>({data:t,offset:0,dataLen:0,dirty:0})));let n=0,r=0,i=0;for(let s=0;s<e.length;s++){const t=e[s];if(n=rq[t.data.type],t.data.size>1&&(n=Math.max(n,16)*t.data.size),t.dataLen=n,r%n!=0&&r<16){const t=r%n%16;r+=t,i+=t}r+n>16?(i=16*Math.ceil(i/16),t.offset=i,i+=n,r=n):(t.offset=i,r+=n,i+=n)}return i=16*Math.ceil(i/16),{uboElements:e,size:i}}(n),s=["\n    var v = null;\n    var v2 = null;\n    var cv = null;\n    var t = 0;\n    var gl = renderer.gl\n    var index = 0;\n    var data = buffer.data;\n    "];for(let o=0;o<r.length;o++){const e=r[o],n=t.uniforms[e.data.name],i=e.data.name;let a=!1;for(let t=0;t<PY.length;t++){const r=PY[t];if(r.codeUbo&&r.test(e.data,n)){s.push(`offset = ${e.offset/4};`,PY[t].codeUbo(e.data.name,n)),a=!0;break}}if(!a)if(e.data.size>1){const t=GY(e.data.type),n=Math.max(rq[e.data.type]/16,1),r=t/n,o=(4-r%4)%4;s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n\n                t = 0;\n\n                for(var i=0; i < ${e.data.size*n}; i++)\n                {\n                    for(var j = 0; j < ${r}; j++)\n                    {\n                        data[offset++] = v[t++];\n                    }\n                    offset += ${o};\n                }\n\n                `)}else{const t=nq[e.data.type];s.push(`\n                cv = ud.${i}.value;\n                v = uv.${i};\n                offset = ${e.offset/4};\n                ${t};\n                `)}}return s.push("\n       renderer.buffer.update(buffer);\n    "),{size:i,syncFunc:new Function("ud","uv","renderer","syncData","buffer",s.join("\n"))}}let sq=0;const oq={textureCount:0,uboCount:0};class aq{constructor(t){this.destroyed=!1,this.renderer=t,this.systemCheck(),this.gl=null,this.shader=null,this.program=null,this.cache={},this._uboCache={},this.id=sq++}systemCheck(){if(!function(){if("boolean"==typeof XY)return XY;try{const t=new Function("param1","param2","param3","return param1[param2] === param3;");XY=!0===t({a:"b"},"a","b")}catch(Ni){XY=!1}return XY}())throw new Error("Current environment does not allow unsafe-eval, please use @pixi/unsafe-eval module to enable support.")}contextChange(t){this.gl=t,this.reset()}bind(t,e){t.disposeRunner.add(this),t.uniforms.globals=this.renderer.globalUniforms;const n=t.program,r=n.glPrograms[this.renderer.CONTEXT_UID]||this.generateProgram(t);return this.shader=t,this.program!==n&&(this.program=n,this.gl.useProgram(r.program)),e||(oq.textureCount=0,oq.uboCount=0,this.syncUniformGroup(t.uniformGroup,oq)),r}setUniforms(t){const e=this.shader.program,n=e.glPrograms[this.renderer.CONTEXT_UID];e.syncUniforms(n.uniformData,t,this.renderer)}syncUniformGroup(t,e){const n=this.getGlProgram();t.static&&t.dirtyId===n.uniformDirtyGroups[t.id]||(n.uniformDirtyGroups[t.id]=t.dirtyId,this.syncUniforms(t,n,e))}syncUniforms(t,e,n){(t.syncUniforms[this.shader.program.id]||this.createSyncGroups(t))(e.uniformData,t.uniforms,this.renderer,n)}createSyncGroups(t){const e=this.getSignature(t,this.shader.program.uniformData,"u");return this.cache[e]||(this.cache[e]=function(t,e){var n;const r=["\n        var v = null;\n        var cv = null;\n        var cu = null;\n        var t = 0;\n        var gl = renderer.gl;\n    "];for(const i in t.uniforms){const s=e[i];if(!s){(null==(n=t.uniforms[i])?void 0:n.group)&&(t.uniforms[i].ubo?r.push(`\n                        renderer.shader.syncUniformBufferGroup(uv.${i}, '${i}');\n                    `):r.push(`\n                        renderer.shader.syncUniformGroup(uv.${i}, syncData);\n                    `));continue}const o=t.uniforms[i];let a=!1;for(let t=0;t<PY.length;t++)if(PY[t].test(s,o)){r.push(PY[t].code(i,o)),a=!0;break}if(!a){const t=(1!==s.size||s.isArray?FY:LY)[s.type].replace("location",`ud["${i}"].location`);r.push(`\n            cu = ud["${i}"];\n            cv = cu.value;\n            v = uv["${i}"];\n            ${t};`)}}return new Function("ud","uv","renderer","syncData",r.join("\n"))}(t,this.shader.program.uniformData)),t.syncUniforms[this.shader.program.id]=this.cache[e],t.syncUniforms[this.shader.program.id]}syncUniformBufferGroup(t,e){const n=this.getGlProgram();if(!t.static||0!==t.dirtyId||!n.uniformGroups[t.id]){t.dirtyId=0;const r=n.uniformGroups[t.id]||this.createSyncBufferGroup(t,n,e);t.buffer.update(),r(n.uniformData,t.uniforms,this.renderer,oq,t.buffer)}this.renderer.buffer.bindBufferBase(t.buffer,n.uniformBufferBindings[e])}createSyncBufferGroup(t,e,n){const{gl:r}=this.renderer;this.renderer.buffer.bind(t.buffer);const i=this.gl.getUniformBlockIndex(e.program,n);e.uniformBufferBindings[n]=this.shader.uniformBindCount,r.uniformBlockBinding(e.program,i,this.shader.uniformBindCount),this.shader.uniformBindCount++;const s=this.getSignature(t,this.shader.program.uniformData,"ubo");let o=this._uboCache[s];if(o||(o=this._uboCache[s]=iq(t,this.shader.program.uniformData)),t.autoManage){const e=new Float32Array(o.size/4);t.buffer.update(e)}return e.uniformGroups[t.id]=o.syncFunc,e.uniformGroups[t.id]}getSignature(t,e,n){const r=t.uniforms,i=[`${n}-`];for(const s in r)i.push(s),e[s]&&i.push(e[s].type);return i.join("-")}getGlProgram(){return this.shader?this.shader.program.glPrograms[this.renderer.CONTEXT_UID]:null}generateProgram(t){const e=this.gl,n=t.program,r=tq(e,n);return n.glPrograms[this.renderer.CONTEXT_UID]=r,r}reset(){this.program=null,this.shader=null}disposeShader(t){this.shader===t&&(this.shader=null)}destroy(){this.renderer=null,this.destroyed=!0}}aq.extension={type:F$.RendererSystem,name:"shader"},U$.add(aq);class lq{constructor(t){this.renderer=t}run(t){const e=this.renderer;e.emitWithCustomOptions(e.runners.init,t),t.hello,e.resize(this.renderer.screen.width,this.renderer.screen.height)}destroy(){}}lq.extension={type:[F$.RendererSystem,F$.CanvasRendererSystem],name:"startup"},U$.add(lq);const cq=class{constructor(){this.gl=null,this.stateId=0,this.polygonOffset=0,this.blendMode=CW.NONE,this._blendEq=!1,this.map=[],this.map[0]=this.setBlend,this.map[1]=this.setOffset,this.map[2]=this.setCullFace,this.map[3]=this.setDepthTest,this.map[4]=this.setFrontFace,this.map[5]=this.setDepthMask,this.checks=[],this.defaultState=new G$,this.defaultState.blend=!0}contextChange(t){this.gl=t,this.blendModes=function(t,e=[]){return e[CW.NORMAL]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.ADD]=[t.ONE,t.ONE],e[CW.MULTIPLY]=[t.DST_COLOR,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.SCREEN]=[t.ONE,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.OVERLAY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.DARKEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.LIGHTEN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.COLOR_DODGE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.COLOR_BURN]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.HARD_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.SOFT_LIGHT]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.DIFFERENCE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.EXCLUSION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.HUE]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.SATURATION]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.COLOR]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.LUMINOSITY]=[t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.NONE]=[0,0],e[CW.NORMAL_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.ADD_NPM]=[t.SRC_ALPHA,t.ONE,t.ONE,t.ONE],e[CW.SCREEN_NPM]=[t.SRC_ALPHA,t.ONE_MINUS_SRC_COLOR,t.ONE,t.ONE_MINUS_SRC_ALPHA],e[CW.SRC_IN]=[t.DST_ALPHA,t.ZERO],e[CW.SRC_OUT]=[t.ONE_MINUS_DST_ALPHA,t.ZERO],e[CW.SRC_ATOP]=[t.DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[CW.DST_OVER]=[t.ONE_MINUS_DST_ALPHA,t.ONE],e[CW.DST_IN]=[t.ZERO,t.SRC_ALPHA],e[CW.DST_OUT]=[t.ZERO,t.ONE_MINUS_SRC_ALPHA],e[CW.DST_ATOP]=[t.ONE_MINUS_DST_ALPHA,t.SRC_ALPHA],e[CW.XOR]=[t.ONE_MINUS_DST_ALPHA,t.ONE_MINUS_SRC_ALPHA],e[CW.SUBTRACT]=[t.ONE,t.ONE,t.ONE,t.ONE,t.FUNC_REVERSE_SUBTRACT,t.FUNC_ADD],e}(t),this.set(this.defaultState),this.reset()}set(t){if(t=t||this.defaultState,this.stateId!==t.data){let e=this.stateId^t.data,n=0;for(;e;)1&e&&this.map[n].call(this,!!(t.data&1<<n)),e>>=1,n++;this.stateId=t.data}for(let e=0;e<this.checks.length;e++)this.checks[e](this,t)}forceState(t){t=t||this.defaultState;for(let e=0;e<this.map.length;e++)this.map[e].call(this,!!(t.data&1<<e));for(let e=0;e<this.checks.length;e++)this.checks[e](this,t);this.stateId=t.data}setBlend(t){this.updateCheck(cq.checkBlendMode,t),this.gl[t?"enable":"disable"](this.gl.BLEND)}setOffset(t){this.updateCheck(cq.checkPolygonOffset,t),this.gl[t?"enable":"disable"](this.gl.POLYGON_OFFSET_FILL)}setDepthTest(t){this.gl[t?"enable":"disable"](this.gl.DEPTH_TEST)}setDepthMask(t){this.gl.depthMask(t)}setCullFace(t){this.gl[t?"enable":"disable"](this.gl.CULL_FACE)}setFrontFace(t){this.gl.frontFace(this.gl[t?"CW":"CCW"])}setBlendMode(t){if(t===this.blendMode)return;this.blendMode=t;const e=this.blendModes[t],n=this.gl;2===e.length?n.blendFunc(e[0],e[1]):n.blendFuncSeparate(e[0],e[1],e[2],e[3]),6===e.length?(this._blendEq=!0,n.blendEquationSeparate(e[4],e[5])):this._blendEq&&(this._blendEq=!1,n.blendEquationSeparate(n.FUNC_ADD,n.FUNC_ADD))}setPolygonOffset(t,e){this.gl.polygonOffset(t,e)}reset(){this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!1),this.forceState(this.defaultState),this._blendEq=!0,this.blendMode=-1,this.setBlendMode(0)}updateCheck(t,e){const n=this.checks.indexOf(t);e&&-1===n?this.checks.push(t):e||-1===n||this.checks.splice(n,1)}static checkBlendMode(t,e){t.setBlendMode(e.blendMode)}static checkPolygonOffset(t,e){t.setPolygonOffset(1,e.polygonOffset)}destroy(){this.gl=null}};let hq=cq;hq.extension={type:F$.RendererSystem,name:"state"},U$.add(hq);class uq extends cH{constructor(){super(...arguments),this.runners={},this._systemsHash={}}setup(t){this.addRunners(...t.runners);const e=(t.priority??[]).filter((e=>t.systems[e])),n=[...e,...Object.keys(t.systems).filter((t=>!e.includes(t)))];for(const r of n)this.addSystem(t.systems[r],r)}addRunners(...t){t.forEach((t=>{this.runners[t]=new $$(t)}))}addSystem(t,e){const n=new t(this);if(this[e])throw new Error(`Whoops! The name "${e}" is already in use`);this[e]=n,this._systemsHash[e]=n;for(const r in this.runners)this.runners[r].add(n);return this}emitWithCustomOptions(t,e){const n=Object.keys(this._systemsHash);t.items.forEach((r=>{const i=n.find((t=>this._systemsHash[t]===r));r[t.name](e[i])}))}destroy(){Object.values(this.runners).forEach((t=>{t.destroy()})),this._systemsHash={}}}const dq=class{constructor(t){this.renderer=t,this.count=0,this.checkCount=0,this.maxIdle=dq.defaultMaxIdle,this.checkCountMax=dq.defaultCheckCountMax,this.mode=dq.defaultMode}postrender(){this.renderer.objectRenderer.renderingToScreen&&(this.count++,this.mode!==UW.MANUAL&&(this.checkCount++,this.checkCount>this.checkCountMax&&(this.checkCount=0,this.run())))}run(){const t=this.renderer.texture,e=t.managedTextures;let n=!1;for(let r=0;r<e.length;r++){const i=e[r];!i.framebuffer&&this.count-i.touched>this.maxIdle&&(t.destroyTexture(i,!0),e[r]=null,n=!0)}if(n){let t=0;for(let n=0;n<e.length;n++)null!==e[n]&&(e[t++]=e[n]);e.length=t}}unload(t){const e=this.renderer.texture,n=t._texture;n&&!n.framebuffer&&e.destroyTexture(n);for(let r=t.children.length-1;r>=0;r--)this.unload(t.children[r])}destroy(){this.renderer=null}};let fq=dq;fq.defaultMode=UW.AUTO,fq.defaultMaxIdle=3600,fq.defaultCheckCountMax=600,fq.extension={type:F$.RendererSystem,name:"textureGC"},U$.add(fq);class pq{constructor(t){this.texture=t,this.width=-1,this.height=-1,this.dirtyId=-1,this.dirtyStyleId=-1,this.mipmap=!1,this.wrapMode=33071,this.type=DW.UNSIGNED_BYTE,this.internalFormat=MW.RGBA,this.samplerType=0}}class mq{constructor(t){this.renderer=t,this.boundTextures=[],this.currentLocation=-1,this.managedTextures=[],this._unknownBoundTextures=!1,this.unknownTexture=new Z$,this.hasIntegerTextures=!1}contextChange(){const t=this.gl=this.renderer.gl;this.CONTEXT_UID=this.renderer.CONTEXT_UID,this.webGLVersion=this.renderer.context.webGLVersion,this.internalFormats=function(t){let e;return e="WebGL2RenderingContext"in globalThis&&t instanceof globalThis.WebGL2RenderingContext?{[DW.UNSIGNED_BYTE]:{[MW.RGBA]:t.RGBA8,[MW.RGB]:t.RGB8,[MW.RG]:t.RG8,[MW.RED]:t.R8,[MW.RGBA_INTEGER]:t.RGBA8UI,[MW.RGB_INTEGER]:t.RGB8UI,[MW.RG_INTEGER]:t.RG8UI,[MW.RED_INTEGER]:t.R8UI,[MW.ALPHA]:t.ALPHA,[MW.LUMINANCE]:t.LUMINANCE,[MW.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[DW.BYTE]:{[MW.RGBA]:t.RGBA8_SNORM,[MW.RGB]:t.RGB8_SNORM,[MW.RG]:t.RG8_SNORM,[MW.RED]:t.R8_SNORM,[MW.RGBA_INTEGER]:t.RGBA8I,[MW.RGB_INTEGER]:t.RGB8I,[MW.RG_INTEGER]:t.RG8I,[MW.RED_INTEGER]:t.R8I},[DW.UNSIGNED_SHORT]:{[MW.RGBA_INTEGER]:t.RGBA16UI,[MW.RGB_INTEGER]:t.RGB16UI,[MW.RG_INTEGER]:t.RG16UI,[MW.RED_INTEGER]:t.R16UI,[MW.DEPTH_COMPONENT]:t.DEPTH_COMPONENT16},[DW.SHORT]:{[MW.RGBA_INTEGER]:t.RGBA16I,[MW.RGB_INTEGER]:t.RGB16I,[MW.RG_INTEGER]:t.RG16I,[MW.RED_INTEGER]:t.R16I},[DW.UNSIGNED_INT]:{[MW.RGBA_INTEGER]:t.RGBA32UI,[MW.RGB_INTEGER]:t.RGB32UI,[MW.RG_INTEGER]:t.RG32UI,[MW.RED_INTEGER]:t.R32UI,[MW.DEPTH_COMPONENT]:t.DEPTH_COMPONENT24},[DW.INT]:{[MW.RGBA_INTEGER]:t.RGBA32I,[MW.RGB_INTEGER]:t.RGB32I,[MW.RG_INTEGER]:t.RG32I,[MW.RED_INTEGER]:t.R32I},[DW.FLOAT]:{[MW.RGBA]:t.RGBA32F,[MW.RGB]:t.RGB32F,[MW.RG]:t.RG32F,[MW.RED]:t.R32F,[MW.DEPTH_COMPONENT]:t.DEPTH_COMPONENT32F},[DW.HALF_FLOAT]:{[MW.RGBA]:t.RGBA16F,[MW.RGB]:t.RGB16F,[MW.RG]:t.RG16F,[MW.RED]:t.R16F},[DW.UNSIGNED_SHORT_5_6_5]:{[MW.RGB]:t.RGB565},[DW.UNSIGNED_SHORT_4_4_4_4]:{[MW.RGBA]:t.RGBA4},[DW.UNSIGNED_SHORT_5_5_5_1]:{[MW.RGBA]:t.RGB5_A1},[DW.UNSIGNED_INT_2_10_10_10_REV]:{[MW.RGBA]:t.RGB10_A2,[MW.RGBA_INTEGER]:t.RGB10_A2UI},[DW.UNSIGNED_INT_10F_11F_11F_REV]:{[MW.RGB]:t.R11F_G11F_B10F},[DW.UNSIGNED_INT_5_9_9_9_REV]:{[MW.RGB]:t.RGB9_E5},[DW.UNSIGNED_INT_24_8]:{[MW.DEPTH_STENCIL]:t.DEPTH24_STENCIL8},[DW.FLOAT_32_UNSIGNED_INT_24_8_REV]:{[MW.DEPTH_STENCIL]:t.DEPTH32F_STENCIL8}}:{[DW.UNSIGNED_BYTE]:{[MW.RGBA]:t.RGBA,[MW.RGB]:t.RGB,[MW.ALPHA]:t.ALPHA,[MW.LUMINANCE]:t.LUMINANCE,[MW.LUMINANCE_ALPHA]:t.LUMINANCE_ALPHA},[DW.UNSIGNED_SHORT_5_6_5]:{[MW.RGB]:t.RGB},[DW.UNSIGNED_SHORT_4_4_4_4]:{[MW.RGBA]:t.RGBA},[DW.UNSIGNED_SHORT_5_5_5_1]:{[MW.RGBA]:t.RGBA}},e}(t);const e=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS);this.boundTextures.length=e;for(let r=0;r<e;r++)this.boundTextures[r]=null;this.emptyTextures={};const n=new pq(t.createTexture());t.bindTexture(t.TEXTURE_2D,n.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,new Uint8Array(4)),this.emptyTextures[t.TEXTURE_2D]=n,this.emptyTextures[t.TEXTURE_CUBE_MAP]=new pq(t.createTexture()),t.bindTexture(t.TEXTURE_CUBE_MAP,this.emptyTextures[t.TEXTURE_CUBE_MAP].texture);for(let r=0;r<6;r++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+r,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR);for(let r=0;r<this.boundTextures.length;r++)this.bind(null,r)}bind(t,e=0){const{gl:n}=this;if((null==(t=null==t?void 0:t.castToBaseTexture())?void 0:t.valid)&&!t.parentTextureArray){t.touched=this.renderer.textureGC.count;const r=t._glTextures[this.CONTEXT_UID]||this.initTexture(t);this.boundTextures[e]!==t&&(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(t.target,r.texture)),r.dirtyId!==t.dirtyId?(this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),this.updateTexture(t)):r.dirtyStyleId!==t.dirtyStyleId&&this.updateTextureStyle(t),this.boundTextures[e]=t}else this.currentLocation!==e&&(this.currentLocation=e,n.activeTexture(n.TEXTURE0+e)),n.bindTexture(n.TEXTURE_2D,this.emptyTextures[n.TEXTURE_2D].texture),this.boundTextures[e]=null}reset(){this._unknownBoundTextures=!0,this.hasIntegerTextures=!1,this.currentLocation=-1;for(let t=0;t<this.boundTextures.length;t++)this.boundTextures[t]=this.unknownTexture}unbind(t){const{gl:e,boundTextures:n}=this;if(this._unknownBoundTextures){this._unknownBoundTextures=!1;for(let t=0;t<n.length;t++)n[t]===this.unknownTexture&&this.bind(null,t)}for(let r=0;r<n.length;r++)n[r]===t&&(this.currentLocation!==r&&(e.activeTexture(e.TEXTURE0+r),this.currentLocation=r),e.bindTexture(t.target,this.emptyTextures[t.target].texture),n[r]=null)}ensureSamplerType(t){const{boundTextures:e,hasIntegerTextures:n,CONTEXT_UID:r}=this;if(n)for(let i=t-1;i>=0;--i){const t=e[i];if(t){t._glTextures[r].samplerType!==OW.FLOAT&&this.renderer.texture.unbind(t)}}}initTexture(t){const e=new pq(this.gl.createTexture());return e.dirtyId=-1,t._glTextures[this.CONTEXT_UID]=e,this.managedTextures.push(t),t.on("dispose",this.destroyTexture,this),e}initTextureType(t,e){var n;e.internalFormat=(null==(n=this.internalFormats[t.type])?void 0:n[t.format])??t.format,2===this.webGLVersion&&t.type===DW.HALF_FLOAT?e.type=this.gl.HALF_FLOAT:e.type=t.type}updateTexture(t){var e;const n=t._glTextures[this.CONTEXT_UID];if(!n)return;const r=this.renderer;if(this.initTextureType(t,n),null==(e=t.resource)?void 0:e.upload(r,t,n))n.samplerType!==OW.FLOAT&&(this.hasIntegerTextures=!0);else{const e=t.realWidth,i=t.realHeight,s=r.gl;(n.width!==e||n.height!==i||n.dirtyId<0)&&(n.width=e,n.height=i,s.texImage2D(t.target,0,n.internalFormat,e,i,0,t.format,n.type,null))}t.dirtyStyleId!==n.dirtyStyleId&&this.updateTextureStyle(t),n.dirtyId=t.dirtyId}destroyTexture(t,e){const{gl:n}=this;if((t=t.castToBaseTexture())._glTextures[this.CONTEXT_UID]&&(this.unbind(t),n.deleteTexture(t._glTextures[this.CONTEXT_UID].texture),t.off("dispose",this.destroyTexture,this),delete t._glTextures[this.CONTEXT_UID],!e)){const e=this.managedTextures.indexOf(t);-1!==e&&w$(this.managedTextures,e,1)}}updateTextureStyle(t){var e;const n=t._glTextures[this.CONTEXT_UID];n&&(t.mipmap!==FW.POW2&&2===this.webGLVersion||t.isPowerOfTwo?n.mipmap=t.mipmap>=1:n.mipmap=!1,2===this.webGLVersion||t.isPowerOfTwo?n.wrapMode=t.wrapMode:n.wrapMode=LW.CLAMP,(null==(e=t.resource)?void 0:e.style(this.renderer,t,n))||this.setStyle(t,n),n.dirtyStyleId=t.dirtyStyleId)}setStyle(t,e){const n=this.gl;if(e.mipmap&&t.mipmap!==FW.ON_MANUAL&&n.generateMipmap(t.target),n.texParameteri(t.target,n.TEXTURE_WRAP_S,e.wrapMode),n.texParameteri(t.target,n.TEXTURE_WRAP_T,e.wrapMode),e.mipmap){n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===PW.LINEAR?n.LINEAR_MIPMAP_LINEAR:n.NEAREST_MIPMAP_NEAREST);const e=this.renderer.context.extensions.anisotropicFiltering;if(e&&t.anisotropicLevel>0&&t.scaleMode===PW.LINEAR){const r=Math.min(t.anisotropicLevel,n.getParameter(e.MAX_TEXTURE_MAX_ANISOTROPY_EXT));n.texParameterf(t.target,e.TEXTURE_MAX_ANISOTROPY_EXT,r)}}else n.texParameteri(t.target,n.TEXTURE_MIN_FILTER,t.scaleMode===PW.LINEAR?n.LINEAR:n.NEAREST);n.texParameteri(t.target,n.TEXTURE_MAG_FILTER,t.scaleMode===PW.LINEAR?n.LINEAR:n.NEAREST)}destroy(){this.renderer=null}}mq.extension={type:F$.RendererSystem,name:"texture"},U$.add(mq);class gq{constructor(t){this.renderer=t}contextChange(){this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glTransformFeedbacks[n]||this.createGLTransformFeedback(t);e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,r)}unbind(){const{gl:t}=this;t.bindTransformFeedback(t.TRANSFORM_FEEDBACK,null)}beginTransformFeedback(t,e){const{gl:n,renderer:r}=this;e&&r.shader.bind(e),n.beginTransformFeedback(t)}endTransformFeedback(){const{gl:t}=this;t.endTransformFeedback()}createGLTransformFeedback(t){const{gl:e,renderer:n,CONTEXT_UID:r}=this,i=e.createTransformFeedback();t._glTransformFeedbacks[r]=i,e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,i);for(let s=0;s<t.buffers.length;s++){const i=t.buffers[s];i&&(n.buffer.update(i),i._glBuffers[r].refCount++,e.bindBufferBase(e.TRANSFORM_FEEDBACK_BUFFER,s,i._glBuffers[r].buffer||null))}return e.bindTransformFeedback(e.TRANSFORM_FEEDBACK,null),t.disposeRunner.add(this),i}disposeTransformFeedback(t,e){const n=t._glTransformFeedbacks[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this);const i=this.renderer.buffer;if(i)for(let s=0;s<t.buffers.length;s++){const n=t.buffers[s];if(!n)continue;const r=n._glBuffers[this.CONTEXT_UID];r&&(r.refCount--,0!==r.refCount||e||i.dispose(n,e))}n&&(e||r.deleteTransformFeedback(n),delete t._glTransformFeedbacks[this.CONTEXT_UID])}destroy(){this.renderer=null}}gq.extension={type:F$.RendererSystem,name:"transformFeedback"},U$.add(gq);class vq{constructor(t){this.renderer=t}init(t){this.screen=new pY(0,0,t.width,t.height),this.element=t.view||WW.ADAPTER.createCanvas(),this.resolution=t.resolution||WW.RESOLUTION,this.autoDensity=!!t.autoDensity}resizeView(t,e){this.element.width=Math.round(t*this.resolution),this.element.height=Math.round(e*this.resolution);const n=this.element.width/this.resolution,r=this.element.height/this.resolution;this.screen.width=n,this.screen.height=r,this.autoDensity&&(this.element.style.width=`${n}px`,this.element.style.height=`${r}px`),this.renderer.emit("resize",n,r),this.renderer.runners.resize.emit(this.screen.width,this.screen.height)}destroy(t){var e;t&&(null==(e=this.element.parentNode)||e.removeChild(this.element)),this.renderer=null,this.element=null,this.screen=null}}vq.extension={type:[F$.RendererSystem,F$.CanvasRendererSystem],name:"_view"},U$.add(vq),WW.PREFER_ENV=kW.WEBGL2,WW.STRICT_TEXTURE_CACHE=!1,Object.defineProperties(WW,{WRAP_MODE:{get:()=>Z$.defaultOptions.wrapMode,set(t){o$(0,"settings.WRAP_MODE is deprecated, use BaseTexture.defaultOptions.wrapMode"),Z$.defaultOptions.wrapMode=t}},SCALE_MODE:{get:()=>Z$.defaultOptions.scaleMode,set(t){o$(0,"settings.SCALE_MODE is deprecated, use BaseTexture.defaultOptions.scaleMode"),Z$.defaultOptions.scaleMode=t}},MIPMAP_TEXTURES:{get:()=>Z$.defaultOptions.mipmap,set(t){o$(0,"settings.MIPMAP_TEXTURES is deprecated, use BaseTexture.defaultOptions.mipmap"),Z$.defaultOptions.mipmap=t}},ANISOTROPIC_LEVEL:{get:()=>Z$.defaultOptions.anisotropicLevel,set(t){o$(0,"settings.ANISOTROPIC_LEVEL is deprecated, use BaseTexture.defaultOptions.anisotropicLevel"),Z$.defaultOptions.anisotropicLevel=t}},FILTER_RESOLUTION:{get:()=>(o$(0,"settings.FILTER_RESOLUTION is deprecated, use Filter.defaultResolution"),lX.defaultResolution),set(t){lX.defaultResolution=t}},FILTER_MULTISAMPLE:{get:()=>(o$(0,"settings.FILTER_MULTISAMPLE is deprecated, use Filter.defaultMultisample"),lX.defaultMultisample),set(t){lX.defaultMultisample=t}},SPRITE_MAX_TEXTURES:{get:()=>oX.defaultMaxTextures,set(t){o$(0,"settings.SPRITE_MAX_TEXTURES is deprecated, use BatchRenderer.defaultMaxTextures"),oX.defaultMaxTextures=t}},SPRITE_BATCH_SIZE:{get:()=>oX.defaultBatchSize,set(t){o$(0,"settings.SPRITE_BATCH_SIZE is deprecated, use BatchRenderer.defaultBatchSize"),oX.defaultBatchSize=t}},CAN_UPLOAD_SAME_BUFFER:{get:()=>oX.canUploadSameBuffer,set(t){o$(0,"settings.CAN_UPLOAD_SAME_BUFFER is deprecated, use BatchRenderer.canUploadSameBuffer"),oX.canUploadSameBuffer=t}},GC_MODE:{get:()=>fq.defaultMode,set(t){o$(0,"settings.GC_MODE is deprecated, use TextureGCSystem.defaultMode"),fq.defaultMode=t}},GC_MAX_IDLE:{get:()=>fq.defaultMaxIdle,set(t){o$(0,"settings.GC_MAX_IDLE is deprecated, use TextureGCSystem.defaultMaxIdle"),fq.defaultMaxIdle=t}},GC_MAX_CHECK_COUNT:{get:()=>fq.defaultCheckCountMax,set(t){o$(0,"settings.GC_MAX_CHECK_COUNT is deprecated, use TextureGCSystem.defaultCheckCountMax"),fq.defaultCheckCountMax=t}},PRECISION_VERTEX:{get:()=>JY.defaultVertexPrecision,set(t){o$(0,"settings.PRECISION_VERTEX is deprecated, use Program.defaultVertexPrecision"),JY.defaultVertexPrecision=t}},PRECISION_FRAGMENT:{get:()=>JY.defaultFragmentPrecision,set(t){o$(0,"settings.PRECISION_FRAGMENT is deprecated, use Program.defaultFragmentPrecision"),JY.defaultFragmentPrecision=t}}});var yq=(t=>(t[t.HIGH=25]="HIGH",t[t.NORMAL=0]="NORMAL",t[t.LOW=-25]="LOW",t[t.UTILITY=-50]="UTILITY",t))(yq||{});class bq{constructor(t,e=null,n=0,r=!1){this.next=null,this.previous=null,this._destroyed=!1,this.fn=t,this.context=e,this.priority=n,this.once=r}match(t,e=null){return this.fn===t&&this.context===e}emit(t){this.fn&&(this.context?this.fn.call(this.context,t):this.fn(t));const e=this.next;return this.once&&this.destroy(!0),this._destroyed&&(this.next=null),e}connect(t){this.previous=t,t.next&&(t.next.previous=this),this.next=t.next,t.next=this}destroy(t=!1){this._destroyed=!0,this.fn=null,this.context=null,this.previous&&(this.previous.next=this.next),this.next&&(this.next.previous=this.previous);const e=this.next;return this.next=t?null:e,this.previous=null,e}}const xq=class{constructor(){this.autoStart=!1,this.deltaTime=1,this.lastTime=-1,this.speed=1,this.started=!1,this._requestId=null,this._maxElapsedMS=100,this._minElapsedMS=0,this._protected=!1,this._lastFrame=-1,this._head=new bq(null,null,1/0),this.deltaMS=1/xq.targetFPMS,this.elapsedMS=1/xq.targetFPMS,this._tick=t=>{this._requestId=null,this.started&&(this.update(t),this.started&&null===this._requestId&&this._head.next&&(this._requestId=requestAnimationFrame(this._tick)))}}_requestIfNeeded(){null===this._requestId&&this._head.next&&(this.lastTime=performance.now(),this._lastFrame=this.lastTime,this._requestId=requestAnimationFrame(this._tick))}_cancelIfNeeded(){null!==this._requestId&&(cancelAnimationFrame(this._requestId),this._requestId=null)}_startIfPossible(){this.started?this._requestIfNeeded():this.autoStart&&this.start()}add(t,e,n=yq.NORMAL){return this._addListener(new bq(t,e,n))}addOnce(t,e,n=yq.NORMAL){return this._addListener(new bq(t,e,n,!0))}_addListener(t){let e=this._head.next,n=this._head;if(e){for(;e;){if(t.priority>e.priority){t.connect(n);break}n=e,e=e.next}t.previous||t.connect(n)}else t.connect(n);return this._startIfPossible(),this}remove(t,e){let n=this._head.next;for(;n;)n=n.match(t,e)?n.destroy():n.next;return this._head.next||this._cancelIfNeeded(),this}get count(){if(!this._head)return 0;let t=0,e=this._head;for(;e=e.next;)t++;return t}start(){this.started||(this.started=!0,this._requestIfNeeded())}stop(){this.started&&(this.started=!1,this._cancelIfNeeded())}destroy(){if(!this._protected){this.stop();let t=this._head.next;for(;t;)t=t.destroy(!0);this._head.destroy(),this._head=null}}update(t=performance.now()){let e;if(t>this.lastTime){if(e=this.elapsedMS=t-this.lastTime,e>this._maxElapsedMS&&(e=this._maxElapsedMS),e*=this.speed,this._minElapsedMS){const e=t-this._lastFrame|0;if(e<this._minElapsedMS)return;this._lastFrame=t-e%this._minElapsedMS}this.deltaMS=e,this.deltaTime=this.deltaMS*xq.targetFPMS;const n=this._head;let r=n.next;for(;r;)r=r.emit(this.deltaTime);n.next||this._cancelIfNeeded()}else this.deltaTime=this.deltaMS=this.elapsedMS=0;this.lastTime=t}get FPS(){return 1e3/this.elapsedMS}get minFPS(){return 1e3/this._maxElapsedMS}set minFPS(t){const e=Math.min(this.maxFPS,t),n=Math.min(Math.max(0,e)/1e3,xq.targetFPMS);this._maxElapsedMS=1/n}get maxFPS(){return this._minElapsedMS?Math.round(1e3/this._minElapsedMS):0}set maxFPS(t){if(0===t)this._minElapsedMS=0;else{const e=Math.max(this.minFPS,t);this._minElapsedMS=1/(e/1e3)}}static get shared(){if(!xq._shared){const t=xq._shared=new xq;t.autoStart=!0,t._protected=!0}return xq._shared}static get system(){if(!xq._system){const t=xq._system=new xq;t.autoStart=!0,t._protected=!0}return xq._system}};let wq=xq;wq.targetFPMS=.06,Object.defineProperties(WW,{TARGET_FPMS:{get:()=>wq.targetFPMS,set(t){o$(0,"settings.TARGET_FPMS is deprecated, use Ticker.targetFPMS"),wq.targetFPMS=t}}});class Eq{static init(t){t=Object.assign({autoStart:!0,sharedTicker:!1},t),Object.defineProperty(this,"ticker",{set(t){this._ticker&&this._ticker.remove(this.render,this),this._ticker=t,t&&t.add(this.render,this,yq.LOW)},get(){return this._ticker}}),this.stop=()=>{this._ticker.stop()},this.start=()=>{this._ticker.start()},this._ticker=null,this.ticker=t.sharedTicker?wq.shared:new wq,t.autoStart&&this.start()}static destroy(){if(this._ticker){const t=this._ticker;this.ticker=null,t.destroy()}}}Eq.extension=F$.Application,U$.add(Eq);const _q=[];U$.handleByList(F$.Renderer,_q);const Sq="attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n    gl_Position = filterVertexPosition();\n    vTextureCoord = filterTextureCoord();\n}\n";class Tq{constructor(t){this.renderer=t}contextChange(t){let e;if(1===this.renderer.context.webGLVersion){const n=t.getParameter(t.FRAMEBUFFER_BINDING);t.bindFramebuffer(t.FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.FRAMEBUFFER,n)}else{const n=t.getParameter(t.DRAW_FRAMEBUFFER_BINDING);t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null),e=t.getParameter(t.SAMPLES),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,n)}e>=zW.HIGH?this.multisample=zW.HIGH:e>=zW.MEDIUM?this.multisample=zW.MEDIUM:e>=zW.LOW?this.multisample=zW.LOW:this.multisample=zW.NONE}destroy(){}}Tq.extension={type:F$.RendererSystem,name:"_multisample"},U$.add(Tq);class kq{constructor(t){this.buffer=t||null,this.updateID=-1,this.byteLength=-1,this.refCount=0}}class Aq{constructor(t){this.renderer=t,this.managedBuffers={},this.boundBufferBases={}}destroy(){this.renderer=null}contextChange(){this.disposeAll(!0),this.gl=this.renderer.gl,this.CONTEXT_UID=this.renderer.CONTEXT_UID}bind(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);e.bindBuffer(t.type,r.buffer)}unbind(t){const{gl:e}=this;e.bindBuffer(t,null)}bindBufferBase(t,e){const{gl:n,CONTEXT_UID:r}=this;if(this.boundBufferBases[e]!==t){const i=t._glBuffers[r]||this.createGLBuffer(t);this.boundBufferBases[e]=t,n.bindBufferBase(n.UNIFORM_BUFFER,e,i.buffer)}}bindBufferRange(t,e,n){const{gl:r,CONTEXT_UID:i}=this;n=n||0;const s=t._glBuffers[i]||this.createGLBuffer(t);r.bindBufferRange(r.UNIFORM_BUFFER,e||0,s.buffer,256*n,256)}update(t){const{gl:e,CONTEXT_UID:n}=this,r=t._glBuffers[n]||this.createGLBuffer(t);if(t._updateID!==r.updateID)if(r.updateID=t._updateID,e.bindBuffer(t.type,r.buffer),r.byteLength>=t.data.byteLength)e.bufferSubData(t.type,0,t.data);else{const n=t.static?e.STATIC_DRAW:e.DYNAMIC_DRAW;r.byteLength=t.data.byteLength,e.bufferData(t.type,t.data,n)}}dispose(t,e){if(!this.managedBuffers[t.id])return;delete this.managedBuffers[t.id];const n=t._glBuffers[this.CONTEXT_UID],r=this.gl;t.disposeRunner.remove(this),n&&(e||r.deleteBuffer(n.buffer),delete t._glBuffers[this.CONTEXT_UID])}disposeAll(t){const e=Object.keys(this.managedBuffers);for(let n=0;n<e.length;n++)this.dispose(this.managedBuffers[e[n]],t)}createGLBuffer(t){const{CONTEXT_UID:e,gl:n}=this;return t._glBuffers[e]=new kq(n.createBuffer()),this.managedBuffers[t.id]=t,t.disposeRunner.add(this),t._glBuffers[e]}}Aq.extension={type:F$.RendererSystem,name:"buffer"},U$.add(Aq);class Cq{constructor(t){this.renderer=t}render(t,e){const n=this.renderer;let r,i,s,o;if(e&&(r=e.renderTexture,i=e.clear,s=e.transform,o=e.skipUpdateTransform),this.renderingToScreen=!r,n.runners.prerender.emit(),n.emit("prerender"),n.projection.transform=s,!n.context.isLost){if(r||(this.lastObjectRendered=t),!o){const e=t.enableTempParent();t.updateTransform(),t.disableTempParent(e)}n.renderTexture.bind(r),n.batch.currentRenderer.start(),(i??n.background.clearBeforeRender)&&n.renderTexture.clear(),t.render(n),n.batch.currentRenderer.flush(),r&&(e.blit&&n.framebuffer.blit(),r.baseTexture.update()),n.runners.postrender.emit(),n.projection.transform=null,n.emit("postrender")}}destroy(){this.renderer=null,this.lastObjectRendered=null}}Cq.extension={type:F$.RendererSystem,name:"objectRenderer"},U$.add(Cq);const Rq=class extends uq{constructor(t){super(),t=Object.assign({},WW.RENDER_OPTIONS,t),this.gl=null,this.CONTEXT_UID=0,this.globalUniforms=new tX({projectionMatrix:new bY},!0);const e={runners:["init","destroy","contextChange","resolutionChange","reset","update","postrender","prerender","resize"],systems:Rq.__systems,priority:["_view","textureGenerator","background","_plugin","startup","context","state","texture","buffer","geometry","framebuffer","transformFeedback","mask","scissor","stencil","projection","textureGC","filter","renderTexture","batch","objectRenderer","_multisample"]};this.setup(e),"useContextAlpha"in t&&(o$(0,"options.useContextAlpha is deprecated, use options.premultipliedAlpha and options.backgroundAlpha instead"),t.premultipliedAlpha=t.useContextAlpha&&"notMultiplied"!==t.useContextAlpha,t.backgroundAlpha=!1===t.useContextAlpha?1:t.backgroundAlpha);const n={hello:t.hello,_plugin:Rq.__plugins,background:{alpha:t.backgroundAlpha,color:t.background??t.backgroundColor,clearBeforeRender:t.clearBeforeRender},_view:{height:t.height,width:t.width,autoDensity:t.autoDensity,resolution:t.resolution,view:t.view},context:{antialias:t.antialias,context:t.context,powerPreference:t.powerPreference,premultipliedAlpha:t.premultipliedAlpha,preserveDrawingBuffer:t.preserveDrawingBuffer}};this.options=t,this.startup.run(n)}static test(t){return!(null==t?void 0:t.forceCanvas)&&(void 0===a$&&(a$=function(){var t;const e={stencil:!0,failIfMajorPerformanceCaveat:WW.FAIL_IF_MAJOR_PERFORMANCE_CAVEAT};try{if(!WW.ADAPTER.getWebGLRenderingContext())return!1;const n=WW.ADAPTER.createCanvas();let r=n.getContext("webgl",e)||n.getContext("experimental-webgl",e);const i=!!(null==(t=null==r?void 0:r.getContextAttributes())?void 0:t.stencil);if(r){const t=r.getExtension("WEBGL_lose_context");t&&t.loseContext()}return r=null,i}catch(Ni){return!1}}()),a$)}render(t,e){this.objectRenderer.render(t,e)}resize(t,e){this._view.resizeView(t,e)}reset(){return this.runners.reset.emit(),this}clear(){this.renderTexture.bind(),this.renderTexture.clear()}destroy(t=!1){this.runners.destroy.items.reverse(),this.emitWithCustomOptions(this.runners.destroy,{_view:t}),super.destroy()}get plugins(){return this._plugin.plugins}get multisample(){return this._multisample.multisample}get width(){return this._view.element.width}get height(){return this._view.element.height}get resolution(){return this._view.resolution}set resolution(t){this._view.resolution=t,this.runners.resolutionChange.emit(t)}get autoDensity(){return this._view.autoDensity}get view(){return this._view.element}get screen(){return this._view.screen}get lastObjectRendered(){return this.objectRenderer.lastObjectRendered}get renderingToScreen(){return this.objectRenderer.renderingToScreen}get rendererLogId(){return`WebGL ${this.context.webGLVersion}`}get clearBeforeRender(){return o$(0,"renderer.clearBeforeRender has been deprecated, please use renderer.background.clearBeforeRender instead."),this.background.clearBeforeRender}get useContextAlpha(){return o$(0,"renderer.useContextAlpha has been deprecated, please use renderer.context.premultipliedAlpha instead."),this.context.useContextAlpha}get preserveDrawingBuffer(){return o$(0,"renderer.preserveDrawingBuffer has been deprecated, we cannot truly know this unless pixi created the context"),this.context.preserveDrawingBuffer}get backgroundColor(){return o$(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color}set backgroundColor(t){o$(0,"renderer.backgroundColor has been deprecated, use renderer.background.color instead."),this.background.color=t}get backgroundAlpha(){return o$(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.color}set backgroundAlpha(t){o$(0,"renderer.backgroundAlpha has been deprecated, use renderer.background.alpha instead."),this.background.alpha=t}get powerPreference(){return o$(0,"renderer.powerPreference has been deprecated, we can only know this if pixi creates the context"),this.context.powerPreference}generateTexture(t,e){return this.textureGenerator.generateTexture(t,e)}};let Mq=Rq;Mq.extension={type:F$.Renderer,priority:1},Mq.__plugins={},Mq.__systems={},U$.handleByMap(F$.RendererPlugin,Mq.__plugins),U$.handleByMap(F$.RendererSystem,Mq.__systems),U$.add(Mq);class Iq extends Y${constructor(t,e){const{width:n,height:r}=e||{};super(n,r),this.items=[],this.itemDirtyIds=[];for(let i=0;i<t;i++){const t=new Z$;this.items.push(t),this.itemDirtyIds.push(-2)}this.length=t,this._load=null,this.baseTexture=null}initFromArray(t,e){for(let n=0;n<this.length;n++)t[n]&&(t[n].castToBaseTexture?this.addBaseTextureAt(t[n].castToBaseTexture(),n):t[n]instanceof Y$?this.addResourceAt(t[n],n):this.addResourceAt(H$(t[n],e),n))}dispose(){for(let t=0,e=this.length;t<e;t++)this.items[t].destroy();this.items=null,this.itemDirtyIds=null,this._load=null}addResourceAt(t,e){if(!this.items[e])throw new Error(`Index ${e} is out of bounds`);return t.valid&&!this.valid&&this.resize(t.width,t.height),this.items[e].setResource(t),this}bind(t){if(null!==this.baseTexture)throw new Error("Only one base texture per TextureArray is allowed");super.bind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=t,this.items[e].on("update",t.update,t)}unbind(t){super.unbind(t);for(let e=0;e<this.length;e++)this.items[e].parentTextureArray=null,this.items[e].off("update",t.update,t)}load(){if(this._load)return this._load;const t=this.items.map((t=>t.resource)).filter((t=>t)).map((t=>t.load()));return this._load=Promise.all(t).then((()=>{const{realWidth:t,realHeight:e}=this.items[0];return this.resize(t,e),Promise.resolve(this)})),this._load}}const Dq=class extends Iq{constructor(t,e){const{width:n,height:r,autoLoad:i,linkBaseTexture:s}=e||{};if(t&&t.length!==Dq.SIDES)throw new Error(`Invalid length. Got ${t.length}, expected 6`);super(6,{width:n,height:r});for(let o=0;o<Dq.SIDES;o++)this.items[o].target=IW.TEXTURE_CUBE_MAP_POSITIVE_X+o;this.linkBaseTexture=!1!==s,t&&this.initFromArray(t,e),!1!==i&&this.load()}bind(t){super.bind(t),t.target=IW.TEXTURE_CUBE_MAP}addBaseTextureAt(t,e,n){if(void 0===n&&(n=this.linkBaseTexture),!this.items[e])throw new Error(`Index ${e} is out of bounds`);if(!this.linkBaseTexture||t.parentTextureArray||Object.keys(t._glTextures).length>0){if(!t.resource)throw new Error("CubeResource does not support copying of renderTexture.");this.addResourceAt(t.resource,e)}else t.target=IW.TEXTURE_CUBE_MAP_POSITIVE_X+e,t.parentTextureArray=this.baseTexture,this.items[e]=t;return t.valid&&!this.valid&&this.resize(t.realWidth,t.realHeight),this.items[e]=t,this}upload(t,e,n){const r=this.itemDirtyIds;for(let i=0;i<Dq.SIDES;i++){const s=this.items[i];(r[i]<s.dirtyId||n.dirtyId<e.dirtyId)&&(s.valid&&s.resource?(s.resource.upload(t,s,n),r[i]=s.dirtyId):r[i]<-1&&(t.gl.texImage2D(s.target,0,n.internalFormat,e.realWidth,e.realHeight,0,e.format,n.type,null),r[i]=-1))}return!0}static test(t){return Array.isArray(t)&&t.length===Dq.SIDES}};let Oq=Dq;Oq.SIDES=6;class Pq extends gX{constructor(t,e){let n,r;e=e||{},"string"==typeof t?(n=Pq.EMPTY,r=t):(n=t,r=null),super(n),this.url=r,this.crossOrigin=e.crossOrigin??!0,this.alphaMode="number"==typeof e.alphaMode?e.alphaMode:null,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((async(t,e)=>{if(null!==this.url)try{const e=await WW.ADAPTER.fetch(this.url,{mode:this.crossOrigin?"cors":"no-cors"});if(this.destroyed)return;const n=await e.blob();if(this.destroyed)return;const r=await createImageBitmap(n,{premultiplyAlpha:null===this.alphaMode||this.alphaMode===NW.UNPACK?"premultiply":"none"});if(this.destroyed)return;this.source=r,this.update(),t(this)}catch(Ni){if(this.destroyed)return;e(Ni),this.onError.emit(Ni)}else t(this)}))),this._load}upload(t,e,n){return this.source instanceof ImageBitmap?("number"==typeof this.alphaMode&&(e.alphaMode=this.alphaMode),super.upload(t,e,n)):(this.load(),!1)}dispose(){this.source instanceof ImageBitmap&&this.source.close(),super.dispose(),this._load=null}static test(t){return!!globalThis.createImageBitmap&&"undefined"!=typeof ImageBitmap&&("string"==typeof t||t instanceof ImageBitmap)}static get EMPTY(){return Pq._EMPTY=Pq._EMPTY??WW.ADAPTER.createCanvas(0,0),Pq._EMPTY}}const Lq=class extends gX{constructor(t,e){e=e||{},super(WW.ADAPTER.createCanvas()),this._width=0,this._height=0,this.svg=t,this.scale=e.scale||1,this._overrideWidth=e.width,this._overrideHeight=e.height,this._resolve=null,this._crossorigin=e.crossorigin,this._load=null,!1!==e.autoLoad&&this.load()}load(){return this._load||(this._load=new Promise((t=>{if(this._resolve=()=>{this.resize(this.source.width,this.source.height),t(this)},Lq.SVG_XML.test(this.svg.trim())){if(!btoa)throw new Error("Your browser doesn't support base64 conversions.");this.svg=`data:image/svg+xml;base64,${btoa(unescape(encodeURIComponent(this.svg)))}`}this._loadSvg()}))),this._load}_loadSvg(){const t=new Image;gX.crossOrigin(t,this.svg,this._crossorigin),t.src=this.svg,t.onerror=e=>{this._resolve&&(t.onerror=null,this.onError.emit(e))},t.onload=()=>{if(!this._resolve)return;const e=t.width,n=t.height;if(!e||!n)throw new Error("The SVG image must have width and height defined (in pixels), canvas API needs them.");let r=e*this.scale,i=n*this.scale;(this._overrideWidth||this._overrideHeight)&&(r=this._overrideWidth||this._overrideHeight/n*e,i=this._overrideHeight||this._overrideWidth/e*n),r=Math.round(r),i=Math.round(i);const s=this.source;s.width=r,s.height=i,s._pixiId=`canvas_${S$()}`,s.getContext("2d").drawImage(t,0,0,e,n,0,0,r,i),this._resolve(),this._resolve=null}}static getSize(t){const e=Lq.SVG_SIZE.exec(t),n={};return e&&(n[e[1]]=Math.round(parseFloat(e[3])),n[e[5]]=Math.round(parseFloat(e[7]))),n}dispose(){super.dispose(),this._resolve=null,this._crossorigin=null}static test(t,e){return"svg"===e||"string"==typeof t&&t.startsWith("data:image/svg+xml")||"string"==typeof t&&Lq.SVG_XML.test(t)}};let Fq=Lq;Fq.SVG_XML=/^(<\?xml[^?]+\?>)?\s*(<!--[^(-->)]*-->)?\s*\<svg/m,Fq.SVG_SIZE=/<svg[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*(?:\s(width|height)=('|")(\d*(?:\.\d+)?)(?:px)?('|"))[^>]*>/i;const Nq=class extends gX{constructor(t,e){if(e=e||{},!(t instanceof HTMLVideoElement)){const n=document.createElement("video");n.setAttribute("preload","auto"),n.setAttribute("webkit-playsinline",""),n.setAttribute("playsinline",""),"string"==typeof t&&(t=[t]);const r=t[0].src||t[0];gX.crossOrigin(n,r,e.crossorigin);for(let e=0;e<t.length;++e){const r=document.createElement("source");let{src:i,mime:s}=t[e];i=i||t[e];const o=i.split("?").shift().toLowerCase(),a=o.slice(o.lastIndexOf(".")+1);s=s||Nq.MIME_TYPES[a]||`video/${a}`,r.src=i,r.type=s,n.appendChild(r)}t=n}super(t),this.noSubImage=!0,this._autoUpdate=!0,this._isConnectedToTicker=!1,this._updateFPS=e.updateFPS||0,this._msToNextUpdate=0,this.autoPlay=!1!==e.autoPlay,this._load=null,this._resolve=null,this._onCanPlay=this._onCanPlay.bind(this),this._onError=this._onError.bind(this),!1!==e.autoLoad&&this.load()}update(t=0){if(!this.destroyed){const t=wq.shared.elapsedMS*this.source.playbackRate;this._msToNextUpdate=Math.floor(this._msToNextUpdate-t),(!this._updateFPS||this._msToNextUpdate<=0)&&(super.update(),this._msToNextUpdate=this._updateFPS?Math.floor(1e3/this._updateFPS):0)}}load(){if(this._load)return this._load;const t=this.source;return(t.readyState===t.HAVE_ENOUGH_DATA||t.readyState===t.HAVE_FUTURE_DATA)&&t.width&&t.height&&(t.complete=!0),t.addEventListener("play",this._onPlayStart.bind(this)),t.addEventListener("pause",this._onPlayStop.bind(this)),this._isSourceReady()?this._onCanPlay():(t.addEventListener("canplay",this._onCanPlay),t.addEventListener("canplaythrough",this._onCanPlay),t.addEventListener("error",this._onError,!0)),this._load=new Promise((e=>{this.valid?e(this):(this._resolve=e,t.load())})),this._load}_onError(t){this.source.removeEventListener("error",this._onError,!0),this.onError.emit(t)}_isSourcePlaying(){const t=this.source;return!t.paused&&!t.ended&&this._isSourceReady()}_isSourceReady(){return this.source.readyState>2}_onPlayStart(){this.valid||this._onCanPlay(),this.autoUpdate&&!this._isConnectedToTicker&&(wq.shared.add(this.update,this),this._isConnectedToTicker=!0)}_onPlayStop(){this._isConnectedToTicker&&(wq.shared.remove(this.update,this),this._isConnectedToTicker=!1)}_onCanPlay(){const t=this.source;t.removeEventListener("canplay",this._onCanPlay),t.removeEventListener("canplaythrough",this._onCanPlay);const e=this.valid;this.resize(t.videoWidth,t.videoHeight),!e&&this._resolve&&(this._resolve(this),this._resolve=null),this._isSourcePlaying()?this._onPlayStart():this.autoPlay&&t.play()}dispose(){this._isConnectedToTicker&&(wq.shared.remove(this.update,this),this._isConnectedToTicker=!1);const t=this.source;t&&(t.removeEventListener("error",this._onError,!0),t.pause(),t.src="",t.load()),super.dispose()}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,!this._autoUpdate&&this._isConnectedToTicker?(wq.shared.remove(this.update,this),this._isConnectedToTicker=!1):this._autoUpdate&&!this._isConnectedToTicker&&this._isSourcePlaying()&&(wq.shared.add(this.update,this),this._isConnectedToTicker=!0))}get updateFPS(){return this._updateFPS}set updateFPS(t){t!==this._updateFPS&&(this._updateFPS=t)}static test(t,e){return globalThis.HTMLVideoElement&&t instanceof HTMLVideoElement||Nq.TYPES.includes(e)}};let Bq=Nq;Bq.TYPES=["mp4","m4v","webm","ogg","ogv","h264","avi","mov"],Bq.MIME_TYPES={ogv:"video/ogg",mov:"video/quicktime",m4v:"video/mp4"},W$.push(Pq,vX,class extends gX{constructor(t){super(t)}static test(t){const{OffscreenCanvas:e}=globalThis;return!!(e&&t instanceof e)||globalThis.HTMLCanvasElement&&t instanceof HTMLCanvasElement}},Bq,Fq,X$,Oq,class extends Iq{constructor(t,e){const{width:n,height:r}=e||{};let i,s;Array.isArray(t)?(i=t,s=t.length):s=t,super(s,{width:n,height:r}),i&&this.initFromArray(i,e)}addBaseTextureAt(t,e){if(!t.resource)throw new Error("ArrayResource does not support RenderTexture");return this.addResourceAt(t.resource,e),this}bind(t){super.bind(t),t.target=IW.TEXTURE_2D_ARRAY}upload(t,e,n){const{length:r,itemDirtyIds:i,items:s}=this,{gl:o}=t;n.dirtyId<0&&o.texImage3D(o.TEXTURE_2D_ARRAY,0,n.internalFormat,this._width,this._height,r,0,e.format,n.type,null);for(let a=0;a<r;a++){const t=s[a];i[a]<t.dirtyId&&(i[a]=t.dirtyId,t.valid&&o.texSubImage3D(o.TEXTURE_2D_ARRAY,0,0,0,a,t.resource.width,t.resource.height,1,e.format,n.type,t.resource.source))}return!0}});class Uq{constructor(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0,this.rect=null,this.updateID=-1}isEmpty(){return this.minX>this.maxX||this.minY>this.maxY}clear(){this.minX=1/0,this.minY=1/0,this.maxX=-1/0,this.maxY=-1/0}getRectangle(t){return this.minX>this.maxX||this.minY>this.maxY?pY.EMPTY:((t=t||new pY(0,0,1,1)).x=this.minX,t.y=this.minY,t.width=this.maxX-this.minX,t.height=this.maxY-this.minY,t)}addPoint(t){this.minX=Math.min(this.minX,t.x),this.maxX=Math.max(this.maxX,t.x),this.minY=Math.min(this.minY,t.y),this.maxY=Math.max(this.maxY,t.y)}addPointMatrix(t,e){const{a:n,b:r,c:i,d:s,tx:o,ty:a}=t,l=n*e.x+i*e.y+o,c=r*e.x+s*e.y+a;this.minX=Math.min(this.minX,l),this.maxX=Math.max(this.maxX,l),this.minY=Math.min(this.minY,c),this.maxY=Math.max(this.maxY,c)}addQuad(t){let e=this.minX,n=this.minY,r=this.maxX,i=this.maxY,s=t[0],o=t[1];e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[2],o=t[3],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[4],o=t[5],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,s=t[6],o=t[7],e=s<e?s:e,n=o<n?o:n,r=s>r?s:r,i=o>i?o:i,this.minX=e,this.minY=n,this.maxX=r,this.maxY=i}addFrame(t,e,n,r,i){this.addFrameMatrix(t.worldTransform,e,n,r,i)}addFrameMatrix(t,e,n,r,i){const s=t.a,o=t.b,a=t.c,l=t.d,c=t.tx,h=t.ty;let u=this.minX,d=this.minY,f=this.maxX,p=this.maxY,m=s*e+a*n+c,g=o*e+l*n+h;u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*n+c,g=o*r+l*n+h,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*e+a*i+c,g=o*e+l*i+h,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,m=s*r+a*i+c,g=o*r+l*i+h,u=m<u?m:u,d=g<d?g:d,f=m>f?m:f,p=g>p?g:p,this.minX=u,this.minY=d,this.maxX=f,this.maxY=p}addVertexData(t,e,n){let r=this.minX,i=this.minY,s=this.maxX,o=this.maxY;for(let a=e;a<n;a+=2){const e=t[a],n=t[a+1];r=e<r?e:r,i=n<i?n:i,s=e>s?e:s,o=n>o?n:o}this.minX=r,this.minY=i,this.maxX=s,this.maxY=o}addVertices(t,e,n,r){this.addVerticesMatrix(t.worldTransform,e,n,r)}addVerticesMatrix(t,e,n,r,i=0,s=i){const o=t.a,a=t.b,l=t.c,c=t.d,h=t.tx,u=t.ty;let d=this.minX,f=this.minY,p=this.maxX,m=this.maxY;for(let g=n;g<r;g+=2){const t=e[g],n=e[g+1],r=o*t+l*n+h,v=c*n+a*t+u;d=Math.min(d,r-i),p=Math.max(p,r+i),f=Math.min(f,v-s),m=Math.max(m,v+s)}this.minX=d,this.minY=f,this.maxX=p,this.maxY=m}addBounds(t){const e=this.minX,n=this.minY,r=this.maxX,i=this.maxY;this.minX=t.minX<e?t.minX:e,this.minY=t.minY<n?t.minY:n,this.maxX=t.maxX>r?t.maxX:r,this.maxY=t.maxY>i?t.maxY:i}addBoundsMask(t,e){const n=t.minX>e.minX?t.minX:e.minX,r=t.minY>e.minY?t.minY:e.minY,i=t.maxX<e.maxX?t.maxX:e.maxX,s=t.maxY<e.maxY?t.maxY:e.maxY;if(n<=i&&r<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=n<t?n:t,this.minY=r<e?r:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}addBoundsMatrix(t,e){this.addFrameMatrix(e,t.minX,t.minY,t.maxX,t.maxY)}addBoundsArea(t,e){const n=t.minX>e.x?t.minX:e.x,r=t.minY>e.y?t.minY:e.y,i=t.maxX<e.x+e.width?t.maxX:e.x+e.width,s=t.maxY<e.y+e.height?t.maxY:e.y+e.height;if(n<=i&&r<=s){const t=this.minX,e=this.minY,o=this.maxX,a=this.maxY;this.minX=n<t?n:t,this.minY=r<e?r:e,this.maxX=i>o?i:o,this.maxY=s>a?s:a}}pad(t=0,e=t){this.isEmpty()||(this.minX-=t,this.maxX+=t,this.minY-=e,this.maxY+=e)}addFramePad(t,e,n,r,i,s){t-=i,e-=s,n+=i,r+=s,this.minX=this.minX<t?this.minX:t,this.maxX=this.maxX>n?this.maxX:n,this.minY=this.minY<e?this.minY:e,this.maxY=this.maxY>r?this.maxY:r}}class Vq extends cH{constructor(){super(),this.tempDisplayObjectParent=null,this.transform=new MY,this.alpha=1,this.visible=!0,this.renderable=!0,this.cullable=!1,this.cullArea=null,this.parent=null,this.worldAlpha=1,this._lastSortedIndex=0,this._zIndex=0,this.filterArea=null,this.filters=null,this._enabledFilters=null,this._bounds=new Uq,this._localBounds=null,this._boundsID=0,this._boundsRect=null,this._localBoundsRect=null,this._mask=null,this._maskRefCount=0,this._destroyed=!1,this.isSprite=!1,this.isMask=!1}static mixin(t){const e=Object.keys(t);for(let n=0;n<e.length;++n){const r=e[n];Object.defineProperty(Vq.prototype,r,Object.getOwnPropertyDescriptor(t,r))}}get destroyed(){return this._destroyed}_recursivePostUpdateTransform(){this.parent?(this.parent._recursivePostUpdateTransform(),this.transform.updateTransform(this.parent.transform)):this.transform.updateTransform(this._tempDisplayObjectParent.transform)}updateTransform(){this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha}getBounds(t,e){return t||(this.parent?(this._recursivePostUpdateTransform(),this.updateTransform()):(this.parent=this._tempDisplayObjectParent,this.updateTransform(),this.parent=null)),this._bounds.updateID!==this._boundsID&&(this.calculateBounds(),this._bounds.updateID=this._boundsID),e||(this._boundsRect||(this._boundsRect=new pY),e=this._boundsRect),this._bounds.getRectangle(e)}getLocalBounds(t){t||(this._localBoundsRect||(this._localBoundsRect=new pY),t=this._localBoundsRect),this._localBounds||(this._localBounds=new Uq);const e=this.transform,n=this.parent;this.parent=null,this.transform=this._tempDisplayObjectParent.transform;const r=this._bounds,i=this._boundsID;this._bounds=this._localBounds;const s=this.getBounds(!1,t);return this.parent=n,this.transform=e,this._bounds=r,this._bounds.updateID+=this._boundsID-i,s}toGlobal(t,e,n=!1){return n||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.apply(t,e)}toLocal(t,e,n,r){return e&&(t=e.toGlobal(t,n,r)),r||(this._recursivePostUpdateTransform(),this.parent?this.displayObjectUpdateTransform():(this.parent=this._tempDisplayObjectParent,this.displayObjectUpdateTransform(),this.parent=null)),this.worldTransform.applyInverse(t,n)}setParent(t){if(!t||!t.addChild)throw new Error("setParent: Argument must be a Container");return t.addChild(this),t}removeFromParent(){var t;null==(t=this.parent)||t.removeChild(this)}setTransform(t=0,e=0,n=1,r=1,i=0,s=0,o=0,a=0,l=0){return this.position.x=t,this.position.y=e,this.scale.x=n||1,this.scale.y=r||1,this.rotation=i,this.skew.x=s,this.skew.y=o,this.pivot.x=a,this.pivot.y=l,this}destroy(t){this.removeFromParent(),this._destroyed=!0,this.transform=null,this.parent=null,this._bounds=null,this.mask=null,this.cullArea=null,this.filters=null,this.filterArea=null,this.hitArea=null,this.interactive=!1,this.interactiveChildren=!1,this.emit("destroyed"),this.removeAllListeners()}get _tempDisplayObjectParent(){return null===this.tempDisplayObjectParent&&(this.tempDisplayObjectParent=new jq),this.tempDisplayObjectParent}enableTempParent(){const t=this.parent;return this.parent=this._tempDisplayObjectParent,t}disableTempParent(t){this.parent=t}get x(){return this.position.x}set x(t){this.transform.position.x=t}get y(){return this.position.y}set y(t){this.transform.position.y=t}get worldTransform(){return this.transform.worldTransform}get localTransform(){return this.transform.localTransform}get position(){return this.transform.position}set position(t){this.transform.position.copyFrom(t)}get scale(){return this.transform.scale}set scale(t){this.transform.scale.copyFrom(t)}get pivot(){return this.transform.pivot}set pivot(t){this.transform.pivot.copyFrom(t)}get skew(){return this.transform.skew}set skew(t){this.transform.skew.copyFrom(t)}get rotation(){return this.transform.rotation}set rotation(t){this.transform.rotation=t}get angle(){return this.transform.rotation*cY}set angle(t){this.transform.rotation=t*hY}get zIndex(){return this._zIndex}set zIndex(t){this._zIndex=t,this.parent&&(this.parent.sortDirty=!0)}get worldVisible(){let t=this;do{if(!t.visible)return!1;t=t.parent}while(t);return!0}get mask(){return this._mask}set mask(t){if(this._mask!==t){if(this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(t._maskRefCount--,0===t._maskRefCount&&(t.renderable=!0,t.isMask=!1))}if(this._mask=t,this._mask){const t=this._mask.isMaskData?this._mask.maskObject:this._mask;t&&(0===t._maskRefCount&&(t.renderable=!1,t.isMask=!0),t._maskRefCount++)}}}}class jq extends Vq{constructor(){super(...arguments),this.sortDirty=null}}Vq.prototype.displayObjectUpdateTransform=Vq.prototype.updateTransform;const zq=new bY;function Gq(t,e){return t.zIndex===e.zIndex?t._lastSortedIndex-e._lastSortedIndex:t.zIndex-e.zIndex}const Wq=class extends Vq{constructor(){super(),this.children=[],this.sortableChildren=Wq.defaultSortableChildren,this.sortDirty=!1}onChildrenChange(t){}addChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.addChild(t[e]);else{const e=t[0];e.parent&&e.parent.removeChild(e),e.parent=this,this.sortDirty=!0,e.transform._parentID=-1,this.children.push(e),this._boundsID++,this.onChildrenChange(this.children.length-1),this.emit("childAdded",e,this,this.children.length-1),e.emit("added",this)}return t[0]}addChildAt(t,e){if(e<0||e>this.children.length)throw new Error(`${t}addChildAt: The index ${e} supplied is out of bounds ${this.children.length}`);return t.parent&&t.parent.removeChild(t),t.parent=this,this.sortDirty=!0,t.transform._parentID=-1,this.children.splice(e,0,t),this._boundsID++,this.onChildrenChange(e),t.emit("added",this),this.emit("childAdded",t,this,e),t}swapChildren(t,e){if(t===e)return;const n=this.getChildIndex(t),r=this.getChildIndex(e);this.children[n]=e,this.children[r]=t,this.onChildrenChange(n<r?n:r)}getChildIndex(t){const e=this.children.indexOf(t);if(-1===e)throw new Error("The supplied DisplayObject must be a child of the caller");return e}setChildIndex(t,e){if(e<0||e>=this.children.length)throw new Error(`The index ${e} supplied is out of bounds ${this.children.length}`);const n=this.getChildIndex(t);w$(this.children,n,1),this.children.splice(e,0,t),this.onChildrenChange(e)}getChildAt(t){if(t<0||t>=this.children.length)throw new Error(`getChildAt: Index (${t}) does not exist.`);return this.children[t]}removeChild(...t){if(t.length>1)for(let e=0;e<t.length;e++)this.removeChild(t[e]);else{const e=t[0],n=this.children.indexOf(e);if(-1===n)return null;e.parent=null,e.transform._parentID=-1,w$(this.children,n,1),this._boundsID++,this.onChildrenChange(n),e.emit("removed",this),this.emit("childRemoved",e,this,n)}return t[0]}removeChildAt(t){const e=this.getChildAt(t);return e.parent=null,e.transform._parentID=-1,w$(this.children,t,1),this._boundsID++,this.onChildrenChange(t),e.emit("removed",this),this.emit("childRemoved",e,this,t),e}removeChildren(t=0,e=this.children.length){const n=t,r=e-n;let i;if(r>0&&r<=e){i=this.children.splice(n,r);for(let t=0;t<i.length;++t)i[t].parent=null,i[t].transform&&(i[t].transform._parentID=-1);this._boundsID++,this.onChildrenChange(t);for(let t=0;t<i.length;++t)i[t].emit("removed",this),this.emit("childRemoved",i[t],this,t);return i}if(0===r&&0===this.children.length)return[];throw new RangeError("removeChildren: numeric values are outside the acceptable range.")}sortChildren(){let t=!1;for(let e=0,n=this.children.length;e<n;++e){const n=this.children[e];n._lastSortedIndex=e,t||0===n.zIndex||(t=!0)}t&&this.children.length>1&&this.children.sort(Gq),this.sortDirty=!1}updateTransform(){this.sortableChildren&&this.sortDirty&&this.sortChildren(),this._boundsID++,this.transform.updateTransform(this.parent.transform),this.worldAlpha=this.alpha*this.parent.worldAlpha;for(let t=0,e=this.children.length;t<e;++t){const e=this.children[t];e.visible&&e.updateTransform()}}calculateBounds(){this._bounds.clear(),this._calculateBounds();for(let t=0;t<this.children.length;t++){const e=this.children[t];if(e.visible&&e.renderable)if(e.calculateBounds(),e._mask){const t=e._mask.isMaskData?e._mask.maskObject:e._mask;t?(t.calculateBounds(),this._bounds.addBoundsMask(e._bounds,t._bounds)):this._bounds.addBounds(e._bounds)}else e.filterArea?this._bounds.addBoundsArea(e._bounds,e.filterArea):this._bounds.addBounds(e._bounds)}this._bounds.updateID=this._boundsID}getLocalBounds(t,e=!1){const n=super.getLocalBounds(t);if(!e)for(let r=0,i=this.children.length;r<i;++r){const t=this.children[r];t.visible&&t.updateTransform()}return n}_calculateBounds(){}_renderWithCulling(t){const e=t.renderTexture.sourceFrame;if(!(e.width>0&&e.height>0))return;let n,r;this.cullArea?(n=this.cullArea,r=this.worldTransform):this._render!==Wq.prototype._render&&(n=this.getBounds(!0));const i=t.projection.transform;if(i&&(r?(r=zq.copyFrom(r),r.prepend(i)):r=i),n&&e.intersects(n,r))this._render(t);else if(this.cullArea)return;for(let s=0,o=this.children.length;s<o;++s){const e=this.children[s],n=e.cullable;e.cullable=n||!this.cullArea,e.render(t),e.cullable=n}}render(t){var e;if(this.visible&&!(this.worldAlpha<=0)&&this.renderable)if(this._mask||(null==(e=this.filters)?void 0:e.length))this.renderAdvanced(t);else if(this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}}renderAdvanced(t){var e,n,r;const i=this.filters,s=this._mask;if(i){this._enabledFilters||(this._enabledFilters=[]),this._enabledFilters.length=0;for(let t=0;t<i.length;t++)i[t].enabled&&this._enabledFilters.push(i[t])}const o=i&&(null==(e=this._enabledFilters)?void 0:e.length)||s&&(!s.isMaskData||s.enabled&&(s.autoDetect||s.type!==jW.NONE));if(o&&t.batch.flush(),i&&(null==(n=this._enabledFilters)?void 0:n.length)&&t.filter.push(this,this._enabledFilters),s&&t.mask.push(this,this._mask),this.cullable)this._renderWithCulling(t);else{this._render(t);for(let e=0,n=this.children.length;e<n;++e)this.children[e].render(t)}o&&t.batch.flush(),s&&t.mask.pop(this),i&&(null==(r=this._enabledFilters)?void 0:r.length)&&t.filter.pop()}_render(t){}destroy(t){super.destroy(),this.sortDirty=!1;const e="boolean"==typeof t?t:null==t?void 0:t.children,n=this.removeChildren(0,this.children.length);if(e)for(let r=0;r<n.length;++r)n[r].destroy(t)}get width(){return this.scale.x*this.getLocalBounds().width}set width(t){const e=this.getLocalBounds().width;this.scale.x=0!==e?t/e:1,this._width=t}get height(){return this.scale.y*this.getLocalBounds().height}set height(t){const e=this.getLocalBounds().height;this.scale.y=0!==e?t/e:1,this._height=t}};let Hq=Wq;Hq.defaultSortableChildren=!1,Hq.prototype.containerUpdateTransform=Hq.prototype.updateTransform,Object.defineProperties(WW,{SORTABLE_CHILDREN:{get:()=>Hq.defaultSortableChildren,set(t){o$(0,"settings.SORTABLE_CHILDREN is deprecated, use Container.defaultSortableChildren"),Hq.defaultSortableChildren=t}}});const $q=new dY,Yq=new Uint16Array([0,1,2,0,2,3]);class Xq extends Hq{constructor(t){super(),this._anchor=new CY(this._onAnchorUpdate,this,t?t.defaultAnchor.x:0,t?t.defaultAnchor.y:0),this._texture=null,this._width=0,this._height=0,this._tint=null,this._tintRGB=null,this.tint=16777215,this.blendMode=CW.NORMAL,this._cachedTint=16777215,this.uvs=null,this.texture=t||wX.EMPTY,this.vertexData=new Float32Array(8),this.vertexTrimmedData=null,this._transformID=-1,this._textureID=-1,this._transformTrimmedID=-1,this._textureTrimmedID=-1,this.indices=Yq,this.pluginName="batch",this.isSprite=!0,this._roundPixels=WW.ROUND_PIXELS}_onTextureUpdate(){this._textureID=-1,this._textureTrimmedID=-1,this._cachedTint=16777215,this._width&&(this.scale.x=E$(this.scale.x)*this._width/this._texture.orig.width),this._height&&(this.scale.y=E$(this.scale.y)*this._height/this._texture.orig.height)}_onAnchorUpdate(){this._transformID=-1,this._transformTrimmedID=-1}calculateVertices(){const t=this._texture;if(this._transformID===this.transform._worldID&&this._textureID===t._updateID)return;this._textureID!==t._updateID&&(this.uvs=this._texture._uvs.uvsFloat32),this._transformID=this.transform._worldID,this._textureID=t._updateID;const e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=this.vertexData,c=t.trim,h=t.orig,u=this._anchor;let d=0,f=0,p=0,m=0;if(c?(f=c.x-u._x*h.width,d=f+c.width,m=c.y-u._y*h.height,p=m+c.height):(f=-u._x*h.width,d=f+h.width,m=-u._y*h.height,p=m+h.height),l[0]=n*f+i*m+o,l[1]=s*m+r*f+a,l[2]=n*d+i*m+o,l[3]=s*m+r*d+a,l[4]=n*d+i*p+o,l[5]=s*p+r*d+a,l[6]=n*f+i*p+o,l[7]=s*p+r*f+a,this._roundPixels){const t=WW.RESOLUTION;for(let e=0;e<l.length;++e)l[e]=Math.round(l[e]*t)/t}}calculateTrimmedVertices(){if(this.vertexTrimmedData){if(this._transformTrimmedID===this.transform._worldID&&this._textureTrimmedID===this._texture._updateID)return}else this.vertexTrimmedData=new Float32Array(8);this._transformTrimmedID=this.transform._worldID,this._textureTrimmedID=this._texture._updateID;const t=this._texture,e=this.vertexTrimmedData,n=t.orig,r=this._anchor,i=this.transform.worldTransform,s=i.a,o=i.b,a=i.c,l=i.d,c=i.tx,h=i.ty,u=-r._x*n.width,d=u+n.width,f=-r._y*n.height,p=f+n.height;e[0]=s*u+a*f+c,e[1]=l*f+o*u+h,e[2]=s*d+a*f+c,e[3]=l*f+o*d+h,e[4]=s*d+a*p+c,e[5]=l*p+o*d+h,e[6]=s*u+a*p+c,e[7]=l*p+o*u+h}_render(t){this.calculateVertices(),t.batch.setObjectRenderer(t.plugins[this.pluginName]),t.plugins[this.pluginName].render(this)}_calculateBounds(){const t=this._texture.trim,e=this._texture.orig;!t||t.width===e.width&&t.height===e.height?(this.calculateVertices(),this._bounds.addQuad(this.vertexData)):(this.calculateTrimmedVertices(),this._bounds.addQuad(this.vertexTrimmedData))}getLocalBounds(t){return 0===this.children.length?(this._localBounds||(this._localBounds=new Uq),this._localBounds.minX=this._texture.orig.width*-this._anchor._x,this._localBounds.minY=this._texture.orig.height*-this._anchor._y,this._localBounds.maxX=this._texture.orig.width*(1-this._anchor._x),this._localBounds.maxY=this._texture.orig.height*(1-this._anchor._y),t||(this._localBoundsRect||(this._localBoundsRect=new pY),t=this._localBoundsRect),this._localBounds.getRectangle(t)):super.getLocalBounds.call(this,t)}containsPoint(t){this.worldTransform.applyInverse(t,$q);const e=this._texture.orig.width,n=this._texture.orig.height,r=-e*this.anchor.x;let i=0;return $q.x>=r&&$q.x<r+e&&(i=-n*this.anchor.y,$q.y>=i&&$q.y<i+n)}destroy(t){super.destroy(t),this._texture.off("update",this._onTextureUpdate,this),this._anchor=null;if("boolean"==typeof t?t:null==t?void 0:t.texture){const e="boolean"==typeof t?t:null==t?void 0:t.baseTexture;this._texture.destroy(!!e)}this._texture=null}static from(t,e){const n=t instanceof wX?t:wX.from(t,e);return new Xq(n)}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get width(){return Math.abs(this.scale.x)*this._texture.orig.width}set width(t){const e=E$(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return Math.abs(this.scale.y)*this._texture.orig.height}set height(t){const e=E$(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get anchor(){return this._anchor}set anchor(t){this._anchor.copyFrom(t)}get tint(){return this._tint}set tint(t){this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16)}get texture(){return this._texture}set texture(t){this._texture!==t&&(this._texture&&this._texture.off("update",this._onTextureUpdate,this),this._texture=t||wX.EMPTY,this._cachedTint=16777215,this._textureID=-1,this._textureTrimmedID=-1,t&&(t.baseTexture.valid?this._onTextureUpdate():t.once("update",this._onTextureUpdate,this)))}}const qq=new bY;Vq.prototype._cacheAsBitmap=!1,Vq.prototype._cacheData=null,Vq.prototype._cacheAsBitmapResolution=null,Vq.prototype._cacheAsBitmapMultisample=null;class Kq{constructor(){this.textureCacheId=null,this.originalRender=null,this.originalRenderCanvas=null,this.originalCalculateBounds=null,this.originalGetLocalBounds=null,this.originalUpdateTransform=null,this.originalDestroy=null,this.originalMask=null,this.originalFilterArea=null,this.originalContainsPoint=null,this.sprite=null}}Object.defineProperties(Vq.prototype,{cacheAsBitmapResolution:{get(){return this._cacheAsBitmapResolution},set(t){t!==this._cacheAsBitmapResolution&&(this._cacheAsBitmapResolution=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmapMultisample:{get(){return this._cacheAsBitmapMultisample},set(t){t!==this._cacheAsBitmapMultisample&&(this._cacheAsBitmapMultisample=t,this.cacheAsBitmap&&(this.cacheAsBitmap=!1,this.cacheAsBitmap=!0))}},cacheAsBitmap:{get(){return this._cacheAsBitmap},set(t){if(this._cacheAsBitmap===t)return;let e;this._cacheAsBitmap=t,t?(this._cacheData||(this._cacheData=new Kq),e=this._cacheData,e.originalRender=this.render,e.originalRenderCanvas=this.renderCanvas,e.originalUpdateTransform=this.updateTransform,e.originalCalculateBounds=this.calculateBounds,e.originalGetLocalBounds=this.getLocalBounds,e.originalDestroy=this.destroy,e.originalContainsPoint=this.containsPoint,e.originalMask=this._mask,e.originalFilterArea=this.filterArea,this.render=this._renderCached,this.renderCanvas=this._renderCachedCanvas,this.destroy=this._cacheAsBitmapDestroy):(e=this._cacheData,e.sprite&&this._destroyCachedDisplayObject(),this.render=e.originalRender,this.renderCanvas=e.originalRenderCanvas,this.calculateBounds=e.originalCalculateBounds,this.getLocalBounds=e.originalGetLocalBounds,this.destroy=e.originalDestroy,this.updateTransform=e.originalUpdateTransform,this.containsPoint=e.originalContainsPoint,this._mask=e.originalMask,this.filterArea=e.originalFilterArea)}}}),Vq.prototype._renderCached=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObject(t),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._render(t))},Vq.prototype._initCachedDisplayObject=function(t){var e,n;if(null==(e=this._cacheData)?void 0:e.sprite)return;const r=this.alpha;this.alpha=1,t.batch.flush();const i=this.getLocalBounds(null,!0).clone();if(null==(n=this.filters)?void 0:n.length){const t=this.filters[0].padding;i.pad(t)}i.ceil(WW.RESOLUTION);const s=t.renderTexture.current,o=t.renderTexture.sourceFrame.clone(),a=t.renderTexture.destinationFrame.clone(),l=t.projection.transform,c=EX.create({width:i.width,height:i.height,resolution:this.cacheAsBitmapResolution||t.resolution,multisample:this.cacheAsBitmapMultisample??t.multisample}),h=`cacheAsBitmap_${S$()}`;this._cacheData.textureCacheId=h,Z$.addToCache(c.baseTexture,h),wX.addToCache(c,h);const u=this.transform.localTransform.copyTo(qq).invert().translate(-i.x,-i.y);this.render=this._cacheData.originalRender,t.render(this,{renderTexture:c,clear:!0,transform:u,skipUpdateTransform:!1}),t.framebuffer.blit(),t.projection.transform=l,t.renderTexture.bind(s,o,a),this.render=this._renderCached,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const d=new Xq(c);d.transform.worldTransform=this.transform.worldTransform,d.anchor.x=-i.x/i.width,d.anchor.y=-i.y/i.height,d.alpha=r,d._bounds=this._bounds,this._cacheData.sprite=d,this.transform._parentID=-1,this.parent?this.updateTransform():(this.enableTempParent(),this.updateTransform(),this.disableTempParent(null)),this.containsPoint=d.containsPoint.bind(d)},Vq.prototype._renderCachedCanvas=function(t){!this.visible||this.worldAlpha<=0||!this.renderable||(this._initCachedDisplayObjectCanvas(t),this._cacheData.sprite.worldAlpha=this.worldAlpha,this._cacheData.sprite._renderCanvas(t))},Vq.prototype._initCachedDisplayObjectCanvas=function(t){var e;if(null==(e=this._cacheData)?void 0:e.sprite)return;const n=this.getLocalBounds(null,!0),r=this.alpha;this.alpha=1;const i=t.canvasContext.activeContext,s=t._projTransform;n.ceil(WW.RESOLUTION);const o=EX.create({width:n.width,height:n.height}),a=`cacheAsBitmap_${S$()}`;this._cacheData.textureCacheId=a,Z$.addToCache(o.baseTexture,a),wX.addToCache(o,a);const l=qq;this.transform.localTransform.copyTo(l),l.invert(),l.tx-=n.x,l.ty-=n.y,this.renderCanvas=this._cacheData.originalRenderCanvas,t.render(this,{renderTexture:o,clear:!0,transform:l,skipUpdateTransform:!1}),t.canvasContext.activeContext=i,t._projTransform=s,this.renderCanvas=this._renderCachedCanvas,this.updateTransform=this.displayObjectUpdateTransform,this.calculateBounds=this._calculateCachedBounds,this.getLocalBounds=this._getCachedLocalBounds,this._mask=null,this.filterArea=null,this.alpha=r;const c=new Xq(o);c.transform.worldTransform=this.transform.worldTransform,c.anchor.x=-n.x/n.width,c.anchor.y=-n.y/n.height,c.alpha=r,c._bounds=this._bounds,this._cacheData.sprite=c,this.transform._parentID=-1,this.parent?this.updateTransform():(this.parent=t._tempDisplayObjectParent,this.updateTransform(),this.parent=null),this.containsPoint=c.containsPoint.bind(c)},Vq.prototype._calculateCachedBounds=function(){this._bounds.clear(),this._cacheData.sprite.transform._worldID=this.transform._worldID,this._cacheData.sprite._calculateBounds(),this._bounds.updateID=this._boundsID},Vq.prototype._getCachedLocalBounds=function(){return this._cacheData.sprite.getLocalBounds(null)},Vq.prototype._destroyCachedDisplayObject=function(){this._cacheData.sprite._texture.destroy(!0),this._cacheData.sprite=null,Z$.removeFromCache(this._cacheData.textureCacheId),wX.removeFromCache(this._cacheData.textureCacheId),this._cacheData.textureCacheId=null},Vq.prototype._cacheAsBitmapDestroy=function(t){this.cacheAsBitmap=!1,this.destroy(t)},Vq.prototype.name=null,Hq.prototype.getChildByName=function(t,e){for(let n=0,r=this.children.length;n<r;n++)if(this.children[n].name===t)return this.children[n];if(e)for(let n=0,r=this.children.length;n<r;n++){const e=this.children[n];if(!e.getChildByName)continue;const r=e.getChildByName(t,!0);if(r)return r}return null},Vq.prototype.getGlobalPosition=function(t=new dY,e=!1){return this.parent?this.parent.toGlobal(this.position,t,e):(t.x=this.position.x,t.y=this.position.y),t};const Zq={5:[.153388,.221461,.250301],7:[.071303,.131514,.189879,.214607],9:[.028532,.067234,.124009,.179044,.20236],11:[.0093,.028002,.065984,.121703,.175713,.198596],13:[.002406,.009255,.027867,.065666,.121117,.174868,.197641],15:[489e-6,.002403,.009246,.02784,.065602,.120999,.174697,.197448]},Jq=["varying vec2 vBlurTexCoords[%size%];","uniform sampler2D uSampler;","void main(void)","{","    gl_FragColor = vec4(0.0);","    %blur%","}"].join("\n");class Qq extends lX{constructor(t,e=8,n=4,r=lX.defaultResolution,i=5){const s=function(t,e){const n=Math.ceil(t/2);let r,i="\n    attribute vec2 aVertexPosition;\n\n    uniform mat3 projectionMatrix;\n\n    uniform float strength;\n\n    varying vec2 vBlurTexCoords[%size%];\n\n    uniform vec4 inputSize;\n    uniform vec4 outputFrame;\n\n    vec4 filterVertexPosition( void )\n    {\n        vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n        return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n    }\n\n    vec2 filterTextureCoord( void )\n    {\n        return aVertexPosition * (outputFrame.zw * inputSize.zw);\n    }\n\n    void main(void)\n    {\n        gl_Position = filterVertexPosition();\n\n        vec2 textureCoord = filterTextureCoord();\n        %blur%\n    }",s="";r=e?"vBlurTexCoords[%index%] =  textureCoord + vec2(%sampleIndex% * strength, 0.0);":"vBlurTexCoords[%index%] =  textureCoord + vec2(0.0, %sampleIndex% * strength);";for(let o=0;o<t;o++){let t=r.replace("%index%",o.toString());t=t.replace("%sampleIndex%",o-(n-1)+".0"),s+=t,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i,t),o=function(t){const e=Zq[t],n=e.length;let r,i=Jq,s="";for(let o=0;o<t;o++){let i="gl_FragColor += texture2D(uSampler, vBlurTexCoords[%index%]) * %value%;".replace("%index%",o.toString());r=o,o>=n&&(r=t-o-1),i=i.replace("%value%",e[r].toString()),s+=i,s+="\n"}return i=i.replace("%blur%",s),i=i.replace("%size%",t.toString()),i}(i);super(s,o),this.horizontal=t,this.resolution=r,this._quality=0,this.quality=n,this.blur=e}apply(t,e,n,r){if(n?this.horizontal?this.uniforms.strength=1/n.width*(n.width/e.width):this.uniforms.strength=1/n.height*(n.height/e.height):this.horizontal?this.uniforms.strength=1/t.renderer.width*(t.renderer.width/e.width):this.uniforms.strength=1/t.renderer.height*(t.renderer.height/e.height),this.uniforms.strength*=this.strength,this.uniforms.strength/=this.passes,1===this.passes)t.applyFilter(this,e,n,r);else{const i=t.getFilterTexture(),s=t.renderer;let o=e,a=i;this.state.blend=!1,t.applyFilter(this,o,a,BW.CLEAR);for(let e=1;e<this.passes-1;e++){t.bindAndClear(o,BW.BLIT),this.uniforms.uSampler=a;const e=a;a=o,o=e,s.shader.bind(this),s.geometry.draw(5)}this.state.blend=!0,t.applyFilter(this,a,n,r),t.returnFilterTexture(i)}}get blur(){return this.strength}set blur(t){this.padding=1+2*Math.abs(t),this.strength=t}get quality(){return this._quality}set quality(t){this._quality=t,this.passes=t}}class tK extends lX{constructor(){const t={m:new Float32Array([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0]),uAlpha:1};super(Sq,"varying vec2 vTextureCoord;\nuniform sampler2D uSampler;\nuniform float m[20];\nuniform float uAlpha;\n\nvoid main(void)\n{\n    vec4 c = texture2D(uSampler, vTextureCoord);\n\n    if (uAlpha == 0.0) {\n        gl_FragColor = c;\n        return;\n    }\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (c.a > 0.0) {\n      c.rgb /= c.a;\n    }\n\n    vec4 result;\n\n    result.r = (m[0] * c.r);\n        result.r += (m[1] * c.g);\n        result.r += (m[2] * c.b);\n        result.r += (m[3] * c.a);\n        result.r += m[4];\n\n    result.g = (m[5] * c.r);\n        result.g += (m[6] * c.g);\n        result.g += (m[7] * c.b);\n        result.g += (m[8] * c.a);\n        result.g += m[9];\n\n    result.b = (m[10] * c.r);\n       result.b += (m[11] * c.g);\n       result.b += (m[12] * c.b);\n       result.b += (m[13] * c.a);\n       result.b += m[14];\n\n    result.a = (m[15] * c.r);\n       result.a += (m[16] * c.g);\n       result.a += (m[17] * c.b);\n       result.a += (m[18] * c.a);\n       result.a += m[19];\n\n    vec3 rgb = mix(c.rgb, result.rgb, uAlpha);\n\n    // Premultiply alpha again.\n    rgb *= result.a;\n\n    gl_FragColor = vec4(rgb, result.a);\n}\n",t),this.alpha=1}_loadMatrix(t,e=!1){let n=t;e&&(this._multiply(n,this.uniforms.m,t),n=this._colorMatrix(n)),this.uniforms.m=n}_multiply(t,e,n){return t[0]=e[0]*n[0]+e[1]*n[5]+e[2]*n[10]+e[3]*n[15],t[1]=e[0]*n[1]+e[1]*n[6]+e[2]*n[11]+e[3]*n[16],t[2]=e[0]*n[2]+e[1]*n[7]+e[2]*n[12]+e[3]*n[17],t[3]=e[0]*n[3]+e[1]*n[8]+e[2]*n[13]+e[3]*n[18],t[4]=e[0]*n[4]+e[1]*n[9]+e[2]*n[14]+e[3]*n[19]+e[4],t[5]=e[5]*n[0]+e[6]*n[5]+e[7]*n[10]+e[8]*n[15],t[6]=e[5]*n[1]+e[6]*n[6]+e[7]*n[11]+e[8]*n[16],t[7]=e[5]*n[2]+e[6]*n[7]+e[7]*n[12]+e[8]*n[17],t[8]=e[5]*n[3]+e[6]*n[8]+e[7]*n[13]+e[8]*n[18],t[9]=e[5]*n[4]+e[6]*n[9]+e[7]*n[14]+e[8]*n[19]+e[9],t[10]=e[10]*n[0]+e[11]*n[5]+e[12]*n[10]+e[13]*n[15],t[11]=e[10]*n[1]+e[11]*n[6]+e[12]*n[11]+e[13]*n[16],t[12]=e[10]*n[2]+e[11]*n[7]+e[12]*n[12]+e[13]*n[17],t[13]=e[10]*n[3]+e[11]*n[8]+e[12]*n[13]+e[13]*n[18],t[14]=e[10]*n[4]+e[11]*n[9]+e[12]*n[14]+e[13]*n[19]+e[14],t[15]=e[15]*n[0]+e[16]*n[5]+e[17]*n[10]+e[18]*n[15],t[16]=e[15]*n[1]+e[16]*n[6]+e[17]*n[11]+e[18]*n[16],t[17]=e[15]*n[2]+e[16]*n[7]+e[17]*n[12]+e[18]*n[17],t[18]=e[15]*n[3]+e[16]*n[8]+e[17]*n[13]+e[18]*n[18],t[19]=e[15]*n[4]+e[16]*n[9]+e[17]*n[14]+e[18]*n[19]+e[19],t}_colorMatrix(t){const e=new Float32Array(t);return e[4]/=255,e[9]/=255,e[14]/=255,e[19]/=255,e}brightness(t,e){const n=[t,0,0,0,0,0,t,0,0,0,0,0,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}tint(t,e){const n=[(t>>16&255)/255,0,0,0,0,0,(t>>8&255)/255,0,0,0,0,0,(255&t)/255,0,0,0,0,0,1,0];this._loadMatrix(n,e)}greyscale(t,e){const n=[t,t,t,0,0,t,t,t,0,0,t,t,t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}blackAndWhite(t){this._loadMatrix([.3,.6,.1,0,0,.3,.6,.1,0,0,.3,.6,.1,0,0,0,0,0,1,0],t)}hue(t,e){t=(t||0)/180*Math.PI;const n=Math.cos(t),r=Math.sin(t),i=1/3,s=(0,Math.sqrt)(i),o=[n+(1-n)*i,i*(1-n)-s*r,i*(1-n)+s*r,0,0,i*(1-n)+s*r,n+i*(1-n),i*(1-n)-s*r,0,0,i*(1-n)-s*r,i*(1-n)+s*r,n+i*(1-n),0,0,0,0,0,1,0];this._loadMatrix(o,e)}contrast(t,e){const n=(t||0)+1,r=-.5*(n-1),i=[n,0,0,0,r,0,n,0,0,r,0,0,n,0,r,0,0,0,1,0];this._loadMatrix(i,e)}saturate(t=0,e){const n=2*t/3+1,r=-.5*(n-1),i=[n,r,r,0,0,r,n,r,0,0,r,r,n,0,0,0,0,0,1,0];this._loadMatrix(i,e)}desaturate(){this.saturate(-1)}negative(t){this._loadMatrix([-1,0,0,1,0,0,-1,0,1,0,0,0,-1,1,0,0,0,0,1,0],t)}sepia(t){this._loadMatrix([.393,.7689999,.18899999,0,0,.349,.6859999,.16799999,0,0,.272,.5339999,.13099999,0,0,0,0,0,1,0],t)}technicolor(t){this._loadMatrix([1.9125277891456083,-.8545344976951645,-.09155508482755585,0,11.793603434377337,-.3087833385928097,1.7658908555458428,-.10601743074722245,0,-70.35205161461398,-.231103377548616,-.7501899197440212,1.847597816108189,0,30.950940869491138,0,0,0,1,0],t)}polaroid(t){this._loadMatrix([1.438,-.062,-.062,0,0,-.122,1.378,-.122,0,0,-.016,-.016,1.483,0,0,0,0,0,1,0],t)}toBGR(t){this._loadMatrix([0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,1,0],t)}kodachrome(t){this._loadMatrix([1.1285582396593525,-.3967382283601348,-.03992559172921793,0,63.72958762196502,-.16404339962244616,1.0835251566291304,-.05498805115633132,0,24.732407896706203,-.16786010706155763,-.5603416277695248,1.6014850761964943,0,35.62982807460946,0,0,0,1,0],t)}browni(t){this._loadMatrix([.5997023498159715,.34553243048391263,-.2708298674538042,0,47.43192855600873,-.037703249837783157,.8609577587992641,.15059552388459913,0,-36.96841498319127,.24113635128153335,-.07441037908422492,.44972182064877153,0,-7.562075277591283,0,0,0,1,0],t)}vintage(t){this._loadMatrix([.6279345635605994,.3202183420819367,-.03965408211312453,0,9.651285835294123,.02578397704808868,.6441188644374771,.03259127616149294,0,7.462829176470591,.0466055556782719,-.0851232987247891,.5241648018700465,0,5.159190588235296,0,0,0,1,0],t)}colorTone(t,e,n,r,i){const s=((n=n||16770432)>>16&255)/255,o=(n>>8&255)/255,a=(255&n)/255,l=((r=r||3375104)>>16&255)/255,c=(r>>8&255)/255,h=(255&r)/255,u=[.3,.59,.11,0,0,s,o,a,t=t||.2,0,l,c,h,e=e||.15,0,s-l,o-c,a-h,0,0];this._loadMatrix(u,i)}night(t,e){const n=[-2*(t=t||.1),-t,0,0,0,-t,0,t,0,0,0,t,2*t,0,0,0,0,0,1,0];this._loadMatrix(n,e)}predator(t,e){const n=[11.224130630493164*t,-4.794486999511719*t,-2.8746118545532227*t,0*t,.40342438220977783*t,-3.6330697536468506*t,9.193157196044922*t,-2.951810836791992*t,0*t,-1.316135048866272*t,-3.2184197902679443*t,-4.2375030517578125*t,7.476448059082031*t,0*t,.8044459223747253*t,0,0,0,1,0];this._loadMatrix(n,e)}lsd(t){this._loadMatrix([2,-.4,.5,0,0,-.5,2,-.4,0,0,-.4,-.5,3,0,0,0,0,0,1,0],t)}reset(){this._loadMatrix([1,0,0,0,0,0,1,0,0,0,0,0,1,0,0,0,0,0,1,0],!1)}get matrix(){return this.uniforms.m}set matrix(t){this.uniforms.m=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}}tK.prototype.grayscale=tK.prototype.greyscale;const eK={AlphaFilter:class extends lX{constructor(t=1){super("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n    vTextureCoord = aTextureCoord;\n}","varying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform float uAlpha;\n\nvoid main(void)\n{\n   gl_FragColor = texture2D(uSampler, vTextureCoord) * uAlpha;\n}\n",{uAlpha:1}),this.alpha=t}get alpha(){return this.uniforms.uAlpha}set alpha(t){this.uniforms.uAlpha=t}},BlurFilter:class extends lX{constructor(t=8,e=4,n=lX.defaultResolution,r=5){super(),this.blurXFilter=new Qq(!0,t,e,n,r),this.blurYFilter=new Qq(!1,t,e,n,r),this.resolution=n,this.quality=e,this.blur=t,this.repeatEdgePixels=!1}apply(t,e,n,r){const i=Math.abs(this.blurXFilter.strength),s=Math.abs(this.blurYFilter.strength);if(i&&s){const i=t.getFilterTexture();this.blurXFilter.apply(t,e,i,BW.CLEAR),this.blurYFilter.apply(t,i,n,r),t.returnFilterTexture(i)}else s?this.blurYFilter.apply(t,e,n,r):this.blurXFilter.apply(t,e,n,r)}updatePadding(){this._repeatEdgePixels?this.padding=0:this.padding=2*Math.max(Math.abs(this.blurXFilter.strength),Math.abs(this.blurYFilter.strength))}get blur(){return this.blurXFilter.blur}set blur(t){this.blurXFilter.blur=this.blurYFilter.blur=t,this.updatePadding()}get quality(){return this.blurXFilter.quality}set quality(t){this.blurXFilter.quality=this.blurYFilter.quality=t}get blurX(){return this.blurXFilter.blur}set blurX(t){this.blurXFilter.blur=t,this.updatePadding()}get blurY(){return this.blurYFilter.blur}set blurY(t){this.blurYFilter.blur=t,this.updatePadding()}get blendMode(){return this.blurYFilter.blendMode}set blendMode(t){this.blurYFilter.blendMode=t}get repeatEdgePixels(){return this._repeatEdgePixels}set repeatEdgePixels(t){this._repeatEdgePixels=t,this.updatePadding()}},BlurFilterPass:Qq,ColorMatrixFilter:tK,DisplacementFilter:class extends lX{constructor(t,e){const n=new bY;t.renderable=!1,super("attribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\nuniform mat3 filterMatrix;\n\nvarying vec2 vTextureCoord;\nvarying vec2 vFilterCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvec2 filterTextureCoord( void )\n{\n    return aVertexPosition * (outputFrame.zw * inputSize.zw);\n}\n\nvoid main(void)\n{\n\tgl_Position = filterVertexPosition();\n\tvTextureCoord = filterTextureCoord();\n\tvFilterCoord = ( filterMatrix * vec3( vTextureCoord, 1.0)  ).xy;\n}\n","varying vec2 vFilterCoord;\nvarying vec2 vTextureCoord;\n\nuniform vec2 scale;\nuniform mat2 rotation;\nuniform sampler2D uSampler;\nuniform sampler2D mapSampler;\n\nuniform highp vec4 inputSize;\nuniform vec4 inputClamp;\n\nvoid main(void)\n{\n  vec4 map =  texture2D(mapSampler, vFilterCoord);\n\n  map -= 0.5;\n  map.xy = scale * inputSize.zw * (rotation * map.xy);\n\n  gl_FragColor = texture2D(uSampler, clamp(vec2(vTextureCoord.x + map.x, vTextureCoord.y + map.y), inputClamp.xy, inputClamp.zw));\n}\n",{mapSampler:t._texture,filterMatrix:n,scale:{x:1,y:1},rotation:new Float32Array([1,0,0,1])}),this.maskSprite=t,this.maskMatrix=n,null==e&&(e=20),this.scale=new dY(e,e)}apply(t,e,n,r){this.uniforms.filterMatrix=t.calculateSpriteMatrix(this.maskMatrix,this.maskSprite),this.uniforms.scale.x=this.scale.x,this.uniforms.scale.y=this.scale.y;const i=this.maskSprite.worldTransform,s=Math.sqrt(i.a*i.a+i.b*i.b),o=Math.sqrt(i.c*i.c+i.d*i.d);0!==s&&0!==o&&(this.uniforms.rotation[0]=i.a/s,this.uniforms.rotation[1]=i.b/s,this.uniforms.rotation[2]=i.c/o,this.uniforms.rotation[3]=i.d/o),t.applyFilter(this,e,n,r)}get map(){return this.uniforms.mapSampler}set map(t){this.uniforms.mapSampler=t}},FXAAFilter:class extends lX{constructor(){super("\nattribute vec2 aVertexPosition;\n\nuniform mat3 projectionMatrix;\n\nvarying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\n\nuniform vec4 inputSize;\nuniform vec4 outputFrame;\n\nvec4 filterVertexPosition( void )\n{\n    vec2 position = aVertexPosition * max(outputFrame.zw, vec2(0.)) + outputFrame.xy;\n\n    return vec4((projectionMatrix * vec3(position, 1.0)).xy, 0.0, 1.0);\n}\n\nvoid texcoords(vec2 fragCoord, vec2 inverseVP,\n               out vec2 v_rgbNW, out vec2 v_rgbNE,\n               out vec2 v_rgbSW, out vec2 v_rgbSE,\n               out vec2 v_rgbM) {\n    v_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\n    v_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\n    v_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\n    v_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\n    v_rgbM = vec2(fragCoord * inverseVP);\n}\n\nvoid main(void) {\n\n   gl_Position = filterVertexPosition();\n\n   vFragCoord = aVertexPosition * outputFrame.zw;\n\n   texcoords(vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n}\n",'varying vec2 v_rgbNW;\nvarying vec2 v_rgbNE;\nvarying vec2 v_rgbSW;\nvarying vec2 v_rgbSE;\nvarying vec2 v_rgbM;\n\nvarying vec2 vFragCoord;\nuniform sampler2D uSampler;\nuniform highp vec4 inputSize;\n\n\n/**\n Basic FXAA implementation based on the code on geeks3d.com with the\n modification that the texture2DLod stuff was removed since it\'s\n unsupported by WebGL.\n\n --\n\n From:\n https://github.com/mitsuhiko/webgl-meincraft\n\n Copyright (c) 2011 by Armin Ronacher.\n\n Some rights reserved.\n\n Redistribution and use in source and binary forms, with or without\n modification, are permitted provided that the following conditions are\n met:\n\n * Redistributions of source code must retain the above copyright\n notice, this list of conditions and the following disclaimer.\n\n * Redistributions in binary form must reproduce the above\n copyright notice, this list of conditions and the following\n disclaimer in the documentation and/or other materials provided\n with the distribution.\n\n * The names of the contributors may not be used to endorse or\n promote products derived from this software without specific\n prior written permission.\n\n THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS\n "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT\n LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR\n A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT\n OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,\n SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT\n LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,\n DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY\n THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE\n OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n */\n\n#ifndef FXAA_REDUCE_MIN\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#endif\n#ifndef FXAA_REDUCE_MUL\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#endif\n#ifndef FXAA_SPAN_MAX\n#define FXAA_SPAN_MAX     8.0\n#endif\n\n//optimized version for mobile, where dependent\n//texture reads can be a bottleneck\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 inverseVP,\n          vec2 v_rgbNW, vec2 v_rgbNE,\n          vec2 v_rgbSW, vec2 v_rgbSE,\n          vec2 v_rgbM) {\n    vec4 color;\n    vec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\n    vec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\n    vec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\n    vec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\n    vec4 texColor = texture2D(tex, v_rgbM);\n    vec3 rgbM  = texColor.xyz;\n    vec3 luma = vec3(0.299, 0.587, 0.114);\n    float lumaNW = dot(rgbNW, luma);\n    float lumaNE = dot(rgbNE, luma);\n    float lumaSW = dot(rgbSW, luma);\n    float lumaSE = dot(rgbSE, luma);\n    float lumaM  = dot(rgbM,  luma);\n    float lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\n    float lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\n\n    mediump vec2 dir;\n    dir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\n    dir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\n\n    float dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n                          (0.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n\n    float rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\n    dir = min(vec2(FXAA_SPAN_MAX, FXAA_SPAN_MAX),\n              max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX),\n                  dir * rcpDirMin)) * inverseVP;\n\n    vec3 rgbA = 0.5 * (\n                       texture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\n                       texture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\n    vec3 rgbB = rgbA * 0.5 + 0.25 * (\n                                     texture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\n                                     texture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\n\n    float lumaB = dot(rgbB, luma);\n    if ((lumaB < lumaMin) || (lumaB > lumaMax))\n        color = vec4(rgbA, texColor.a);\n    else\n        color = vec4(rgbB, texColor.a);\n    return color;\n}\n\nvoid main() {\n\n      vec4 color;\n\n      color = fxaa(uSampler, vFragCoord, inputSize.zw, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n\n      gl_FragColor = color;\n}\n')}},NoiseFilter:class extends lX{constructor(t=.5,e=Math.random()){super(Sq,"precision highp float;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform float uNoise;\nuniform float uSeed;\nuniform sampler2D uSampler;\n\nfloat rand(vec2 co)\n{\n    return fract(sin(dot(co.xy, vec2(12.9898, 78.233))) * 43758.5453);\n}\n\nvoid main()\n{\n    vec4 color = texture2D(uSampler, vTextureCoord);\n    float randomValue = rand(gl_FragCoord.xy * uSeed);\n    float diff = (randomValue - 0.5) * uNoise;\n\n    // Un-premultiply alpha before applying the color matrix. See issue #3539.\n    if (color.a > 0.0) {\n        color.rgb /= color.a;\n    }\n\n    color.r += diff;\n    color.g += diff;\n    color.b += diff;\n\n    // Premultiply alpha again.\n    color.rgb *= color.a;\n\n    gl_FragColor = color;\n}\n",{uNoise:0,uSeed:0}),this.noise=t,this.seed=e}get noise(){return this.uniforms.uNoise}set noise(t){this.uniforms.uNoise=t}get seed(){return this.uniforms.uSeed}set seed(t){this.uniforms.uSeed=t}}};Object.entries(eK).forEach((([t,e])=>{Object.defineProperty(eK,t,{get:()=>(o$(0,`filters.${t} has moved to ${t}`),e)})}));class nK{constructor(t){this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.composed=!1,this.defaultPrevented=!1,this.eventPhase=nK.prototype.NONE,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.layer=new dY,this.page=new dY,this.AT_TARGET=1,this.BUBBLING_PHASE=2,this.CAPTURING_PHASE=3,this.NONE=0,this.manager=t}get layerX(){return this.layer.x}get layerY(){return this.layer.y}get pageX(){return this.page.x}get pageY(){return this.page.y}get data(){return this}composedPath(){return!this.manager||this.path&&this.path[this.path.length-1]===this.target||(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path}initEvent(t,e,n){throw new Error("initEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}initUIEvent(t,e,n,r,i){throw new Error("initUIEvent() is a legacy DOM API. It is not implemented in the Federated Events API.")}preventDefault(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0}stopImmediatePropagation(){this.propagationImmediatelyStopped=!0}stopPropagation(){this.propagationStopped=!0}}class rK extends nK{constructor(){super(...arguments),this.client=new dY,this.movement=new dY,this.offset=new dY,this.global=new dY,this.screen=new dY}get clientX(){return this.client.x}get clientY(){return this.client.y}get x(){return this.clientX}get y(){return this.clientY}get movementX(){return this.movement.x}get movementY(){return this.movement.y}get offsetX(){return this.offset.x}get offsetY(){return this.offset.y}get globalX(){return this.global.x}get globalY(){return this.global.y}get screenX(){return this.screen.x}get screenY(){return this.screen.y}getModifierState(t){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(t)}initMouseEvent(t,e,n,r,i,s,o,a,l,c,h,u,d,f,p){throw new Error("Method not implemented.")}}class iK extends rK{constructor(){super(...arguments),this.width=0,this.height=0,this.isPrimary=!1}getCoalescedEvents(){return"pointermove"===this.type||"mousemove"===this.type||"touchmove"===this.type?[this]:[]}getPredictedEvents(){throw new Error("getPredictedEvents is not supported!")}}class sK extends rK{constructor(){super(...arguments),this.DOM_DELTA_LINE=0,this.DOM_DELTA_PAGE=1,this.DOM_DELTA_PIXEL=2}}const oK=new dY,aK=new dY;class lK{constructor(t){this.dispatch=new cH,this.moveOnAll=!1,this.mappingState={trackingData:{}},this.eventPool=new Map,this.rootTarget=t,this.hitPruneFn=this.hitPruneFn.bind(this),this.hitTestFn=this.hitTestFn.bind(this),this.mapPointerDown=this.mapPointerDown.bind(this),this.mapPointerMove=this.mapPointerMove.bind(this),this.mapPointerOut=this.mapPointerOut.bind(this),this.mapPointerOver=this.mapPointerOver.bind(this),this.mapPointerUp=this.mapPointerUp.bind(this),this.mapPointerUpOutside=this.mapPointerUpOutside.bind(this),this.mapWheel=this.mapWheel.bind(this),this.mappingTable={},this.addEventMapping("pointerdown",this.mapPointerDown),this.addEventMapping("pointermove",this.mapPointerMove),this.addEventMapping("pointerout",this.mapPointerOut),this.addEventMapping("pointerleave",this.mapPointerOut),this.addEventMapping("pointerover",this.mapPointerOver),this.addEventMapping("pointerup",this.mapPointerUp),this.addEventMapping("pointerupoutside",this.mapPointerUpOutside),this.addEventMapping("wheel",this.mapWheel)}addEventMapping(t,e){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:e,priority:0}),this.mappingTable[t].sort(((t,e)=>t.priority-e.priority))}dispatchEvent(t,e){t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,e),this.dispatch.emit(e||t.type,t)}mapEvent(t){if(!this.rootTarget)return;const e=this.mappingTable[t.type];if(e)for(let n=0,r=e.length;n<r;n++)e[n].fn(t)}hitTest(t,e){const n=this.hitTestRecursive(this.rootTarget,this.rootTarget.interactive,oK.set(t,e),this.hitTestFn,this.hitPruneFn);return n&&n[0]}propagate(t,e){if(!t.target)return;const n=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(let r=0,i=n.length-1;r<i;r++)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,e),!t.propagationStopped&&!t.propagationImmediatelyStopped){t.eventPhase=t.BUBBLING_PHASE;for(let r=n.length-2;r>=0;r--)if(t.currentTarget=n[r],this.notifyTarget(t,e),t.propagationStopped||t.propagationImmediatelyStopped)return}}all(t,e,n=this.rootTarget){t.eventPhase=t.BUBBLING_PHASE;const r=n.children;if(r)for(let i=0;i<r.length;i++)this.all(t,e,r[i]);t.currentTarget=n,this.notifyTarget(t,e)}propagationPath(t){const e=[t];for(let n=0;n<2048&&t!==this.rootTarget;n++){if(!t.parent)throw new Error("Cannot find propagation path to disconnected target");e.push(t.parent),t=t.parent}return e.reverse(),e}hitTestRecursive(t,e,n,r,i){if(!t||!t.visible)return null;if(i(t,n))return null;if(t.interactiveChildren&&t.children){const s=t.children;for(let o=s.length-1;o>=0;o--){const a=s[o],l=this.hitTestRecursive(a,e||a.interactive,n,r,i);if(l){if(l.length>0&&!l[l.length-1].parent)continue;return(l.length>0||t.interactive)&&l.push(t),l}}}return e&&r(t,n)?t.interactive?[t]:[]:null}hitPruneFn(t,e){var n;if(t.hitArea&&(t.worldTransform.applyInverse(e,aK),!t.hitArea.contains(aK.x,aK.y)))return!0;if(t._mask){const r=t._mask.isMaskData?t._mask.maskObject:t._mask;if(r&&!(null==(n=r.containsPoint)?void 0:n.call(r,e)))return!0}return!1}hitTestFn(t,e){return!!t.hitArea||!!t.containsPoint&&t.containsPoint(e)}notifyTarget(t,e){var n,r;const i=`on${e=e??t.type}`;null==(r=(n=t.currentTarget)[i])||r.call(n,t);const s=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?`${e}capture`:e;this.notifyListeners(t,s),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,e)}mapPointerDown(t){if(!(t instanceof iK))return;const e=this.createPointerEvent(t);if(this.dispatchEvent(e,"pointerdown"),"touch"===e.pointerType)this.dispatchEvent(e,"touchstart");else if("mouse"===e.pointerType||"pen"===e.pointerType){const t=2===e.button;this.dispatchEvent(e,t?"rightdown":"mousedown")}this.trackingData(t.pointerId).pressTargetsByButton[t.button]=e.composedPath(),this.freeEvent(e)}mapPointerMove(t){var e,n;if(!(t instanceof iK))return;const r=this.createPointerEvent(t),i="mouse"===r.pointerType||"pen"===r.pointerType,s=this.trackingData(t.pointerId),o=this.findMountedTarget(s.overTargets);if((null==(e=s.overTargets)?void 0:e.length)>0&&o!==r.target){const e="mousemove"===t.type?"mouseout":"pointerout",n=this.createPointerEvent(t,e,o);if(this.dispatchEvent(n,"pointerout"),i&&this.dispatchEvent(n,"mouseout"),!r.composedPath().includes(o)){const e=this.createPointerEvent(t,"pointerleave",o);for(e.eventPhase=e.AT_TARGET;e.target&&!r.composedPath().includes(e.target);)e.currentTarget=e.target,this.notifyTarget(e),i&&this.notifyTarget(e,"mouseleave"),e.target=e.target.parent;this.freeEvent(e)}this.freeEvent(n)}if(o!==r.target){const e="mousemove"===t.type?"mouseover":"pointerover",n=this.clonePointerEvent(r,e);this.dispatchEvent(n,"pointerover"),i&&this.dispatchEvent(n,"mouseover");let s=null==o?void 0:o.parent;for(;s&&s!==this.rootTarget.parent&&s!==r.target;)s=s.parent;if(!s||s===this.rootTarget.parent){const t=this.clonePointerEvent(r,"pointerenter");for(t.eventPhase=t.AT_TARGET;t.target&&t.target!==o&&t.target!==this.rootTarget.parent;)t.currentTarget=t.target,this.notifyTarget(t),i&&this.notifyTarget(t,"mouseenter"),t.target=t.target.parent;this.freeEvent(t)}this.freeEvent(n)}const a=this.moveOnAll?"all":"dispatchEvent";this[a](r,"pointermove"),this.all(r,"globalpointermove"),"touch"===r.pointerType&&(this[a](r,"touchmove"),this.all(r,"globaltouchmove")),i&&(this[a](r,"mousemove"),this.all(r,"globalmousemove"),this.cursor=null==(n=r.target)?void 0:n.cursor),s.overTargets=r.composedPath(),this.freeEvent(r)}mapPointerOver(t){var e;if(!(t instanceof iK))return;const n=this.trackingData(t.pointerId),r=this.createPointerEvent(t),i="mouse"===r.pointerType||"pen"===r.pointerType;this.dispatchEvent(r,"pointerover"),i&&this.dispatchEvent(r,"mouseover"),"mouse"===r.pointerType&&(this.cursor=null==(e=r.target)?void 0:e.cursor);const s=this.clonePointerEvent(r,"pointerenter");for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),i&&this.notifyTarget(s,"mouseenter"),s.target=s.target.parent;n.overTargets=r.composedPath(),this.freeEvent(r),this.freeEvent(s)}mapPointerOut(t){if(!(t instanceof iK))return;const e=this.trackingData(t.pointerId);if(e.overTargets){const n="mouse"===t.pointerType||"pen"===t.pointerType,r=this.findMountedTarget(e.overTargets),i=this.createPointerEvent(t,"pointerout",r);this.dispatchEvent(i),n&&this.dispatchEvent(i,"mouseout");const s=this.createPointerEvent(t,"pointerleave",r);for(s.eventPhase=s.AT_TARGET;s.target&&s.target!==this.rootTarget.parent;)s.currentTarget=s.target,this.notifyTarget(s),n&&this.notifyTarget(s,"mouseleave"),s.target=s.target.parent;e.overTargets=null,this.freeEvent(i),this.freeEvent(s)}this.cursor=null}mapPointerUp(t){if(!(t instanceof iK))return;const e=performance.now(),n=this.createPointerEvent(t);if(this.dispatchEvent(n,"pointerup"),"touch"===n.pointerType)this.dispatchEvent(n,"touchend");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.dispatchEvent(n,t?"rightup":"mouseup")}const r=this.trackingData(t.pointerId),i=this.findMountedTarget(r.pressTargetsByButton[t.button]);let s=i;if(i&&!n.composedPath().includes(i)){let e=i;for(;e&&!n.composedPath().includes(e);){if(n.currentTarget=e,this.notifyTarget(n,"pointerupoutside"),"touch"===n.pointerType)this.notifyTarget(n,"touchendoutside");else if("mouse"===n.pointerType||"pen"===n.pointerType){const t=2===n.button;this.notifyTarget(n,t?"rightupoutside":"mouseupoutside")}e=e.parent}delete r.pressTargetsByButton[t.button],s=e}if(s){const i=this.clonePointerEvent(n,"click");i.target=s,i.path=null,r.clicksByButton[t.button]||(r.clicksByButton[t.button]={clickCount:0,target:i.target,timeStamp:e});const o=r.clicksByButton[t.button];o.target===i.target&&e-o.timeStamp<200?++o.clickCount:o.clickCount=1,o.target=i.target,o.timeStamp=e,i.detail=o.clickCount,"mouse"===i.pointerType?this.dispatchEvent(i,"click"):"touch"===i.pointerType&&this.dispatchEvent(i,"tap"),this.dispatchEvent(i,"pointertap"),this.freeEvent(i)}this.freeEvent(n)}mapPointerUpOutside(t){if(!(t instanceof iK))return;const e=this.trackingData(t.pointerId),n=this.findMountedTarget(e.pressTargetsByButton[t.button]),r=this.createPointerEvent(t);if(n){let i=n;for(;i;)r.currentTarget=i,this.notifyTarget(r,"pointerupoutside"),"touch"===r.pointerType?this.notifyTarget(r,"touchendoutside"):"mouse"!==r.pointerType&&"pen"!==r.pointerType||this.notifyTarget(r,2===r.button?"rightupoutside":"mouseupoutside"),i=i.parent;delete e.pressTargetsByButton[t.button]}this.freeEvent(r)}mapWheel(t){if(!(t instanceof sK))return;const e=this.createWheelEvent(t);this.dispatchEvent(e),this.freeEvent(e)}findMountedTarget(t){if(!t)return null;let e=t[0];for(let n=1;n<t.length&&t[n].parent===e;n++)e=t[n];return e}createPointerEvent(t,e,n){const r=this.allocateEvent(iK);return this.copyPointerData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t,r.target=n??this.hitTest(r.global.x,r.global.y),"string"==typeof e&&(r.type=e),r}createWheelEvent(t){const e=this.allocateEvent(sK);return this.copyWheelData(t,e),this.copyMouseData(t,e),this.copyData(t,e),e.nativeEvent=t.nativeEvent,e.originalEvent=t,e.target=this.hitTest(e.global.x,e.global.y),e}clonePointerEvent(t,e){const n=this.allocateEvent(iK);return n.nativeEvent=t.nativeEvent,n.originalEvent=t.originalEvent,this.copyPointerData(t,n),this.copyMouseData(t,n),this.copyData(t,n),n.target=t.target,n.path=t.composedPath().slice(),n.type=e??n.type,n}copyWheelData(t,e){e.deltaMode=t.deltaMode,e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ}copyPointerData(t,e){t instanceof iK&&e instanceof iK&&(e.pointerId=t.pointerId,e.width=t.width,e.height=t.height,e.isPrimary=t.isPrimary,e.pointerType=t.pointerType,e.pressure=t.pressure,e.tangentialPressure=t.tangentialPressure,e.tiltX=t.tiltX,e.tiltY=t.tiltY,e.twist=t.twist)}copyMouseData(t,e){t instanceof rK&&e instanceof rK&&(e.altKey=t.altKey,e.button=t.button,e.buttons=t.buttons,e.client.copyFrom(t.client),e.ctrlKey=t.ctrlKey,e.metaKey=t.metaKey,e.movement.copyFrom(t.movement),e.screen.copyFrom(t.screen),e.global.copyFrom(t.global))}copyData(t,e){e.isTrusted=t.isTrusted,e.srcElement=t.srcElement,e.timeStamp=performance.now(),e.type=t.type,e.detail=t.detail,e.view=t.view,e.which=t.which,e.layer.copyFrom(t.layer),e.page.copyFrom(t.page)}trackingData(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]}allocateEvent(t){this.eventPool.has(t)||this.eventPool.set(t,[]);const e=this.eventPool.get(t).pop()||new t(this);return e.eventPhase=e.NONE,e.currentTarget=null,e.path=null,e.target=null,e}freeEvent(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");const e=t.constructor;this.eventPool.has(e)||this.eventPool.set(e,[]),this.eventPool.get(e).push(t)}notifyListeners(t,e){const n=t.currentTarget._events[e];if(n)if("fn"in n)n.fn.call(n.context,t);else for(let r=0,i=n.length;r<i&&!t.propagationImmediatelyStopped;r++)n[r].fn.call(n[r].context,t)}}const cK={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};class hK{constructor(t){this.supportsTouchEvents="ontouchstart"in globalThis,this.supportsPointerEvents=!!globalThis.PointerEvent,this.domElement=null,this.resolution=1,this.renderer=t,this.rootBoundary=new lK(null),this.autoPreventDefault=!0,this.eventsAdded=!1,this.rootPointerEvent=new iK(null),this.rootWheelEvent=new sK(null),this.cursorStyles={default:"inherit",pointer:"pointer"},this.onPointerDown=this.onPointerDown.bind(this),this.onPointerMove=this.onPointerMove.bind(this),this.onPointerUp=this.onPointerUp.bind(this),this.onPointerOverOut=this.onPointerOverOut.bind(this),this.onWheel=this.onWheel.bind(this)}init(){const{view:t,resolution:e}=this.renderer;this.setTargetElement(t),this.resolution=e}resolutionChange(t){this.resolution=t}destroy(){this.setTargetElement(null),this.renderer=null}setCursor(t){t=t||"default";let e=!0;if(globalThis.OffscreenCanvas&&this.domElement instanceof OffscreenCanvas&&(e=!1),this.currentCursor===t)return;this.currentCursor=t;const n=this.cursorStyles[t];if(n)switch(typeof n){case"string":e&&(this.domElement.style.cursor=n);break;case"function":n(t);break;case"object":e&&Object.assign(this.domElement.style,n)}else e&&"string"==typeof t&&!Object.prototype.hasOwnProperty.call(this.cursorStyles,t)&&(this.domElement.style.cursor=t)}onPointerDown(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);if(this.autoPreventDefault&&e[0].isNormalized){(t.cancelable||!("cancelable"in t))&&t.preventDefault()}for(let n=0,r=e.length;n<r;n++){const t=e[n],r=this.bootstrapEvent(this.rootPointerEvent,t);this.rootBoundary.mapEvent(r)}this.setCursor(this.rootBoundary.cursor)}onPointerMove(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const t=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerUp(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;let e=t.target;t.composedPath&&t.composedPath().length>0&&(e=t.composedPath()[0]);const n=e!==this.domElement?"outside":"",r=this.normalizeToPointerData(t);for(let i=0,s=r.length;i<s;i++){const t=this.bootstrapEvent(this.rootPointerEvent,r[i]);t.type+=n,this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onPointerOverOut(t){if(this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.supportsTouchEvents&&"touch"===t.pointerType)return;const e=this.normalizeToPointerData(t);for(let n=0,r=e.length;n<r;n++){const t=this.bootstrapEvent(this.rootPointerEvent,e[n]);this.rootBoundary.mapEvent(t)}this.setCursor(this.rootBoundary.cursor)}onWheel(t){const e=this.normalizeWheelEvent(t);this.rootBoundary.rootTarget=this.renderer.lastObjectRendered,this.rootBoundary.mapEvent(e)}setTargetElement(t){this.removeEvents(),this.domElement=t,this.addEvents()}addEvents(){if(this.eventsAdded||!this.domElement)return;const t=this.domElement.style;t&&(globalThis.navigator.msPointerEnabled?(t.msContentZooming="none",t.msTouchAction="none"):this.supportsPointerEvents&&(t.touchAction="none")),this.supportsPointerEvents?(globalThis.document.addEventListener("pointermove",this.onPointerMove,!0),this.domElement.addEventListener("pointerdown",this.onPointerDown,!0),this.domElement.addEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.addEventListener("pointerover",this.onPointerOverOut,!0),globalThis.addEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.addEventListener("mousemove",this.onPointerMove,!0),this.domElement.addEventListener("mousedown",this.onPointerDown,!0),this.domElement.addEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.addEventListener("mouseover",this.onPointerOverOut,!0),globalThis.addEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.addEventListener("touchstart",this.onPointerDown,!0),this.domElement.addEventListener("touchend",this.onPointerUp,!0),this.domElement.addEventListener("touchmove",this.onPointerMove,!0)),this.domElement.addEventListener("wheel",this.onWheel,{passive:!0,capture:!0}),this.eventsAdded=!0}removeEvents(){if(!this.eventsAdded||!this.domElement)return;const t=this.domElement.style;globalThis.navigator.msPointerEnabled?(t.msContentZooming="",t.msTouchAction=""):this.supportsPointerEvents&&(t.touchAction=""),this.supportsPointerEvents?(globalThis.document.removeEventListener("pointermove",this.onPointerMove,!0),this.domElement.removeEventListener("pointerdown",this.onPointerDown,!0),this.domElement.removeEventListener("pointerleave",this.onPointerOverOut,!0),this.domElement.removeEventListener("pointerover",this.onPointerOverOut,!0),globalThis.removeEventListener("pointerup",this.onPointerUp,!0)):(globalThis.document.removeEventListener("mousemove",this.onPointerMove,!0),this.domElement.removeEventListener("mousedown",this.onPointerDown,!0),this.domElement.removeEventListener("mouseout",this.onPointerOverOut,!0),this.domElement.removeEventListener("mouseover",this.onPointerOverOut,!0),globalThis.removeEventListener("mouseup",this.onPointerUp,!0)),this.supportsTouchEvents&&(this.domElement.removeEventListener("touchstart",this.onPointerDown,!0),this.domElement.removeEventListener("touchend",this.onPointerUp,!0),this.domElement.removeEventListener("touchmove",this.onPointerMove,!0)),this.domElement.removeEventListener("wheel",this.onWheel,!0),this.domElement=null,this.eventsAdded=!1}mapPositionToPoint(t,e,n){let r;r=this.domElement.parentElement?this.domElement.getBoundingClientRect():{x:0,y:0,width:this.domElement.width,height:this.domElement.height,left:0,top:0};const i=1/this.resolution;t.x=(e-r.left)*(this.domElement.width/r.width)*i,t.y=(n-r.top)*(this.domElement.height/r.height)*i}normalizeToPointerData(t){const e=[];if(this.supportsTouchEvents&&t instanceof TouchEvent)for(let n=0,r=t.changedTouches.length;n<r;n++){const r=t.changedTouches[n];void 0===r.button&&(r.button=0),void 0===r.buttons&&(r.buttons=1),void 0===r.isPrimary&&(r.isPrimary=1===t.touches.length&&"touchstart"===t.type),void 0===r.width&&(r.width=r.radiusX||1),void 0===r.height&&(r.height=r.radiusY||1),void 0===r.tiltX&&(r.tiltX=0),void 0===r.tiltY&&(r.tiltY=0),void 0===r.pointerType&&(r.pointerType="touch"),void 0===r.pointerId&&(r.pointerId=r.identifier||0),void 0===r.pressure&&(r.pressure=r.force||.5),void 0===r.twist&&(r.twist=0),void 0===r.tangentialPressure&&(r.tangentialPressure=0),void 0===r.layerX&&(r.layerX=r.offsetX=r.clientX),void 0===r.layerY&&(r.layerY=r.offsetY=r.clientY),r.isNormalized=!0,r.type=t.type,e.push(r)}else if(globalThis.MouseEvent&&(!(t instanceof MouseEvent)||this.supportsPointerEvents&&t instanceof globalThis.PointerEvent))e.push(t);else{const n=t;void 0===n.isPrimary&&(n.isPrimary=!0),void 0===n.width&&(n.width=1),void 0===n.height&&(n.height=1),void 0===n.tiltX&&(n.tiltX=0),void 0===n.tiltY&&(n.tiltY=0),void 0===n.pointerType&&(n.pointerType="mouse"),void 0===n.pointerId&&(n.pointerId=1),void 0===n.pressure&&(n.pressure=.5),void 0===n.twist&&(n.twist=0),void 0===n.tangentialPressure&&(n.tangentialPressure=0),n.isNormalized=!0,e.push(n)}return e}normalizeWheelEvent(t){const e=this.rootWheelEvent;return this.transferMouseData(e,t),e.deltaX=t.deltaX,e.deltaY=t.deltaY,e.deltaZ=t.deltaZ,e.deltaMode=t.deltaMode,this.mapPositionToPoint(e.screen,t.clientX,t.clientY),e.global.copyFrom(e.screen),e.offset.copyFrom(e.screen),e.nativeEvent=t,e.type=t.type,e}bootstrapEvent(t,e){return t.originalEvent=null,t.nativeEvent=e,t.pointerId=e.pointerId,t.width=e.width,t.height=e.height,t.isPrimary=e.isPrimary,t.pointerType=e.pointerType,t.pressure=e.pressure,t.tangentialPressure=e.tangentialPressure,t.tiltX=e.tiltX,t.tiltY=e.tiltY,t.twist=e.twist,this.transferMouseData(t,e),this.mapPositionToPoint(t.screen,e.clientX,e.clientY),t.global.copyFrom(t.screen),t.offset.copyFrom(t.screen),t.isTrusted=e.isTrusted,"pointerleave"===t.type&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=cK[t.type]||t.type),t}transferMouseData(t,e){t.isTrusted=e.isTrusted,t.srcElement=e.srcElement,t.timeStamp=performance.now(),t.type=e.type,t.altKey=e.altKey,t.button=e.button,t.buttons=e.buttons,t.client.x=e.clientX,t.client.y=e.clientY,t.ctrlKey=e.ctrlKey,t.metaKey=e.metaKey,t.movement.x=e.movementX,t.movement.y=e.movementY,t.page.x=e.pageX,t.page.y=e.pageY,t.relatedTarget=null,t.shiftKey=e.shiftKey}}hK.extension={name:"events",type:[F$.RendererSystem,F$.CanvasRendererSystem]},U$.add(hK);const uK={onclick:null,onmousedown:null,onmouseenter:null,onmouseleave:null,onmousemove:null,onglobalmousemove:null,onmouseout:null,onmouseover:null,onmouseup:null,onmouseupoutside:null,onpointercancel:null,onpointerdown:null,onpointerenter:null,onpointerleave:null,onpointermove:null,onglobalpointermove:null,onpointerout:null,onpointerover:null,onpointertap:null,onpointerup:null,onpointerupoutside:null,onrightclick:null,onrightdown:null,onrightup:null,onrightupoutside:null,ontap:null,ontouchcancel:null,ontouchend:null,ontouchendoutside:null,ontouchmove:null,onglobaltouchmove:null,ontouchstart:null,onwheel:null,interactive:!1,interactiveChildren:!0,hitArea:null,addEventListener(t,e,n){const r="function"==typeof e?void 0:e;t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.on(t,e,r)},removeEventListener(t,e,n){const r="function"==typeof e?void 0:e;t="boolean"==typeof n&&n||"object"==typeof n&&n.capture?`${t}capture`:t,e="function"==typeof e?e:e.handleEvent,this.off(t,e,r)},dispatchEvent(t){if(!(t instanceof nK))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");return t.defaultPrevented=!1,t.path=null,t.target=this,t.manager.dispatchEvent(t),!t.defaultPrevented}};Vq.mixin(uK);Vq.mixin({accessible:!1,accessibleTitle:null,accessibleHint:null,tabIndex:0,_accessibleActive:!1,_accessibleDiv:null,accessibleType:"button",accessiblePointerEvents:"auto",accessibleChildren:!0,renderId:-1});class dK{constructor(t){this.debug=!1,this._isActive=!1,this._isMobileAccessibility=!1,this.pool=[],this.renderId=0,this.children=[],this.androidUpdateCount=0,this.androidUpdateFrequency=500,this._hookDiv=null,(aH.tablet||aH.phone)&&this.createTouchHook();const e=document.createElement("div");e.style.width="100px",e.style.height="100px",e.style.position="absolute",e.style.top="0px",e.style.left="0px",e.style.zIndex=2..toString(),this.div=e,this.renderer=t,this._onKeyDown=this._onKeyDown.bind(this),this._onMouseMove=this._onMouseMove.bind(this),globalThis.addEventListener("keydown",this._onKeyDown,!1)}get isActive(){return this._isActive}get isMobileAccessibility(){return this._isMobileAccessibility}createTouchHook(){const t=document.createElement("button");t.style.width="1px",t.style.height="1px",t.style.position="absolute",t.style.top="-1000px",t.style.left="-1000px",t.style.zIndex=2..toString(),t.style.backgroundColor="#FF0000",t.title="select to enable accessibility for this content",t.addEventListener("focus",(()=>{this._isMobileAccessibility=!0,this.activate(),this.destroyTouchHook()})),document.body.appendChild(t),this._hookDiv=t}destroyTouchHook(){this._hookDiv&&(document.body.removeChild(this._hookDiv),this._hookDiv=null)}activate(){var t;this._isActive||(this._isActive=!0,globalThis.document.addEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown,!1),this.renderer.on("postrender",this.update,this),null==(t=this.renderer.view.parentNode)||t.appendChild(this.div))}deactivate(){var t;this._isActive&&!this._isMobileAccessibility&&(this._isActive=!1,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.addEventListener("keydown",this._onKeyDown,!1),this.renderer.off("postrender",this.update),null==(t=this.div.parentNode)||t.removeChild(this.div))}updateAccessibleObjects(t){if(!t.visible||!t.accessibleChildren)return;t.accessible&&t.interactive&&(t._accessibleActive||this.addChild(t),t.renderId=this.renderId);const e=t.children;if(e)for(let n=0;n<e.length;n++)this.updateAccessibleObjects(e[n])}update(){const t=performance.now();if(aH.android.device&&t<this.androidUpdateCount)return;if(this.androidUpdateCount=t+this.androidUpdateFrequency,!this.renderer.renderingToScreen)return;this.renderer.lastObjectRendered&&this.updateAccessibleObjects(this.renderer.lastObjectRendered);const{x:e,y:n,width:r,height:i}=this.renderer.view.getBoundingClientRect(),{width:s,height:o,resolution:a}=this.renderer,l=r/s*a,c=i/o*a;let h=this.div;h.style.left=`${e}px`,h.style.top=`${n}px`,h.style.width=`${s}px`,h.style.height=`${o}px`;for(let u=0;u<this.children.length;u++){const t=this.children[u];if(t.renderId!==this.renderId)t._accessibleActive=!1,w$(this.children,u,1),this.div.removeChild(t._accessibleDiv),this.pool.push(t._accessibleDiv),t._accessibleDiv=null,u--;else{h=t._accessibleDiv;let e=t.hitArea;const n=t.worldTransform;t.hitArea?(h.style.left=(n.tx+e.x*n.a)*l+"px",h.style.top=(n.ty+e.y*n.d)*c+"px",h.style.width=e.width*n.a*l+"px",h.style.height=e.height*n.d*c+"px"):(e=t.getBounds(),this.capHitArea(e),h.style.left=e.x*l+"px",h.style.top=e.y*c+"px",h.style.width=e.width*l+"px",h.style.height=e.height*c+"px",h.title!==t.accessibleTitle&&null!==t.accessibleTitle&&(h.title=t.accessibleTitle),h.getAttribute("aria-label")!==t.accessibleHint&&null!==t.accessibleHint&&h.setAttribute("aria-label",t.accessibleHint)),t.accessibleTitle===h.title&&t.tabIndex===h.tabIndex||(h.title=t.accessibleTitle,h.tabIndex=t.tabIndex,this.debug&&this.updateDebugHTML(h))}}this.renderId++}updateDebugHTML(t){t.innerHTML=`type: ${t.type}</br> title : ${t.title}</br> tabIndex: ${t.tabIndex}`}capHitArea(t){t.x<0&&(t.width+=t.x,t.x=0),t.y<0&&(t.height+=t.y,t.y=0);const{width:e,height:n}=this.renderer;t.x+t.width>e&&(t.width=e-t.x),t.y+t.height>n&&(t.height=n-t.y)}addChild(t){let e=this.pool.pop();e||(e=document.createElement("button"),e.style.width="100px",e.style.height="100px",e.style.backgroundColor=this.debug?"rgba(255,255,255,0.5)":"transparent",e.style.position="absolute",e.style.zIndex=2..toString(),e.style.borderStyle="none",navigator.userAgent.toLowerCase().includes("chrome")?e.setAttribute("aria-live","off"):e.setAttribute("aria-live","polite"),navigator.userAgent.match(/rv:.*Gecko\//)?e.setAttribute("aria-relevant","additions"):e.setAttribute("aria-relevant","text"),e.addEventListener("click",this._onClick.bind(this)),e.addEventListener("focus",this._onFocus.bind(this)),e.addEventListener("focusout",this._onFocusOut.bind(this))),e.style.pointerEvents=t.accessiblePointerEvents,e.type=t.accessibleType,t.accessibleTitle&&null!==t.accessibleTitle?e.title=t.accessibleTitle:t.accessibleHint&&null!==t.accessibleHint||(e.title=`displayObject ${t.tabIndex}`),t.accessibleHint&&null!==t.accessibleHint&&e.setAttribute("aria-label",t.accessibleHint),this.debug&&this.updateDebugHTML(e),t._accessibleActive=!0,t._accessibleDiv=e,e.displayObject=t,this.children.push(t),this.div.appendChild(t._accessibleDiv),t._accessibleDiv.tabIndex=t.tabIndex}_dispatchEvent(t,e){const{displayObject:n}=t.target,r=this.renderer.events.rootBoundary,i=Object.assign(new nK(r),{target:n});r.rootTarget=this.renderer.lastObjectRendered,e.forEach((t=>r.dispatchEvent(i,t)))}_onClick(t){this._dispatchEvent(t,["click","pointertap","tap"])}_onFocus(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","assertive"),this._dispatchEvent(t,["mouseover"])}_onFocusOut(t){t.target.getAttribute("aria-live")||t.target.setAttribute("aria-live","polite"),this._dispatchEvent(t,["mouseout"])}_onKeyDown(t){9===t.keyCode&&this.activate()}_onMouseMove(t){0===t.movementX&&0===t.movementY||this.deactivate()}destroy(){this.destroyTouchHook(),this.div=null,globalThis.document.removeEventListener("mousemove",this._onMouseMove,!0),globalThis.removeEventListener("keydown",this._onKeyDown),this.pool=null,this.children=null,this.renderer=null}}dK.extension={name:"accessibility",type:[F$.RendererPlugin,F$.CanvasRendererPlugin]},U$.add(dK);const fK=class{constructor(t){this.stage=new Hq,t=Object.assign({forceCanvas:!1},t),this.renderer=function(t){for(const e of _q)if(e.test(t))return new e(t);throw new Error("Unable to auto-detect a suitable renderer.")}(t),fK._plugins.forEach((e=>{e.init.call(this,t)}))}render(){this.renderer.render(this.stage)}get view(){return this.renderer.view}get screen(){return this.renderer.screen}destroy(t,e){const n=fK._plugins.slice(0);n.reverse(),n.forEach((t=>{t.destroy.call(this)})),this.stage.destroy(e),this.stage=null,this.renderer.destroy(t),this.renderer=null}};let pK=fK;pK._plugins=[],U$.handleByList(F$.Application,pK._plugins);class mK{static init(t){Object.defineProperty(this,"resizeTo",{set(t){globalThis.removeEventListener("resize",this.queueResize),this._resizeTo=t,t&&(globalThis.addEventListener("resize",this.queueResize),this.resize())},get(){return this._resizeTo}}),this.queueResize=()=>{this._resizeTo&&(this.cancelResize(),this._resizeId=requestAnimationFrame((()=>this.resize())))},this.cancelResize=()=>{this._resizeId&&(cancelAnimationFrame(this._resizeId),this._resizeId=null)},this.resize=()=>{if(!this._resizeTo)return;let t,e;if(this.cancelResize(),this._resizeTo===globalThis.window)t=globalThis.innerWidth,e=globalThis.innerHeight;else{const{clientWidth:n,clientHeight:r}=this._resizeTo;t=n,e=r}this.renderer.resize(t,e),this.render()},this._resizeId=null,this._resizeTo=null,this.resizeTo=t.resizeTo||null}static destroy(){globalThis.removeEventListener("resize",this.queueResize),this.cancelResize(),this.cancelResize=null,this.queueResize=null,this.resizeTo=null,this.resize=null}}mK.extension=F$.Application,U$.add(mK);const gK={loader:F$.LoadParser,resolver:F$.ResolveParser,cache:F$.CacheParser,detection:F$.DetectionParser};U$.handle(F$.Asset,(t=>{const e=t.ref;Object.entries(gK).filter((([t])=>!!e[t])).forEach((([t,n])=>U$.add(Object.assign(e[t],{extension:e[t].extension??n}))))}),(t=>{const e=t.ref;Object.keys(gK).filter((t=>!!e[t])).forEach((t=>U$.remove(e[t])))}));class vK{constructor(t,e=!1){this._loader=t,this._assetList=[],this._isLoading=!1,this._maxConcurrent=1,this.verbose=e}add(t){t.forEach((t=>{this._assetList.push(t)})),this.verbose,this._isActive&&!this._isLoading&&this._next()}async _next(){if(this._assetList.length&&this._isActive){this._isLoading=!0;const t=[],e=Math.min(this._assetList.length,this._maxConcurrent);for(let n=0;n<e;n++)t.push(this._assetList.pop());await this._loader.load(t),this._isLoading=!1,this._next()}}get active(){return this._isActive}set active(t){this._isActive!==t&&(this._isActive=t,t&&!this._isLoading&&this._next())}}function yK(t,e){if(Array.isArray(e)){for(const n of e)if(t.startsWith(`data:${n}`))return!0;return!1}return t.startsWith(`data:${e}`)}function bK(t,e){const n=t.split("?")[0],r=i$.extname(n).toLowerCase();return Array.isArray(e)?e.includes(r):r===e}const xK=(t,e)=>(Array.isArray(t)||(t=[t]),e?t.map((t=>"string"==typeof t?e(t):t)):t),wK=(t,e)=>{const n=e.split("?")[1];return n&&(t+=`?${n}`),t};function EK(t,e,n,r,i){const s=e[n];for(let o=0;o<s.length;o++){const a=s[o];n<e.length-1?EK(t.replace(r[n],a),e,n+1,r,i):i.push(t.replace(r[n],a))}}function _K(t){const e=t.match(/\{(.*?)\}/g),n=[];if(e){const r=[];e.forEach((t=>{const e=t.substring(1,t.length-1).split(",");r.push(e)})),EK(t,r,0,e,n)}else n.push(t);return n}const SK=t=>!Array.isArray(t);const TK=new class{constructor(){this._parsers=[],this._cache=new Map,this._cacheMap=new Map}reset(){this._cacheMap.clear(),this._cache.clear()}has(t){return this._cache.has(t)}get(t){const e=this._cache.get(t);return e}set(t,e){const n=xK(t);let r;for(let o=0;o<this.parsers.length;o++){const t=this.parsers[o];if(t.test(e)){r=t.getCacheableAssets(n,e);break}}r||(r={},n.forEach((t=>{r[t]=e})));const i=Object.keys(r),s={cacheKeys:i,keys:n};if(n.forEach((t=>{this._cacheMap.set(t,s)})),i.forEach((t=>{this._cache.has(t)&&this._cache.get(t),this._cache.set(t,r[t])})),e instanceof wX){const t=e;n.forEach((e=>{t.baseTexture!==wX.EMPTY.baseTexture&&Z$.addToCache(t.baseTexture,e),wX.addToCache(t,e)}))}}remove(t){if(this._cacheMap.get(t),!this._cacheMap.has(t))return;const e=this._cacheMap.get(t);e.cacheKeys.forEach((t=>{this._cache.delete(t)})),e.keys.forEach((t=>{this._cacheMap.delete(t)}))}get parsers(){return this._parsers}};class kK{constructor(){this._parsers=[],this.promiseCache={}}reset(){this.promiseCache={}}_getLoadPromiseAndParser(t,e){const n={promise:null,parser:null};return n.promise=(async()=>{var r,i;let s=null;for(let o=0;o<this.parsers.length;o++){const i=this.parsers[o];if(i.load&&(null==(r=i.test)?void 0:r.call(i,t,e,this))){s=await i.load(t,e,this),n.parser=i;break}}if(!n.parser)return null;for(let t=0;t<this.parsers.length;t++){const r=this.parsers[t];r.parse&&r.parse&&await(null==(i=r.testParse)?void 0:i.call(r,s,e,this))&&(s=await r.parse(s,e,this)||s,n.parser=r)}return s})(),n}async load(t,e){let n=0;const r={},i=SK(t),s=xK(t,(t=>({src:t}))),o=s.length,a=s.map((async t=>{const i=i$.toAbsolute(t.src);if(!r[t.src])try{this.promiseCache[i]||(this.promiseCache[i]=this._getLoadPromiseAndParser(i,t)),r[t.src]=await this.promiseCache[i].promise,e&&e(++n/o)}catch(Ni){throw delete this.promiseCache[i],delete r[t.src],new Error(`[Loader.load] Failed to load ${i}.\n${Ni}`)}}));return await Promise.all(a),i?r[s[0].src]:r}async unload(t){const e=xK(t,(t=>({src:t}))).map((async t=>{var e,n;const r=i$.toAbsolute(t.src),i=this.promiseCache[r];if(i){const s=await i.promise;null==(n=null==(e=i.parser)?void 0:e.unload)||n.call(e,s,t,this),delete this.promiseCache[r]}}));await Promise.all(e)}get parsers(){return this._parsers}}var AK=(t=>(t[t.Low=0]="Low",t[t.Normal=1]="Normal",t[t.High=2]="High",t))(AK||{});const CK={extension:{type:F$.LoadParser,priority:AK.Low},test:t=>".json"===i$.extname(t).toLowerCase(),async load(t){const e=await WW.ADAPTER.fetch(t);return await e.json()}};U$.add(CK);const RK={extension:{type:F$.LoadParser,priority:AK.Low},test:t=>".txt"===i$.extname(t).toLowerCase(),async load(t){const e=await WW.ADAPTER.fetch(t);return await e.text()}};U$.add(RK);const MK=["normal","bold","100","200","300","400","500","600","700","800","900"],IK=[".ttf",".otf",".woff",".woff2"],DK=["font/ttf","font/otf","font/woff","font/woff2"];const OK={extension:{type:F$.LoadParser,priority:AK.Low},test:t=>yK(t,DK)||bK(t,IK),async load(t,e){var n,r,i;const s=WW.ADAPTER.getFontFaceSet();if(s){const o=[],a=(null==(n=e.data)?void 0:n.family)??function(t){const e=i$.extname(t);return i$.basename(t,e).replace(/(-|_)/g," ").toLowerCase().split(" ").map((t=>t.charAt(0).toUpperCase()+t.slice(1))).join(" ")}(t),l=(null==(i=null==(r=e.data)?void 0:r.weights)?void 0:i.filter((t=>MK.includes(t))))??["normal"],c=e.data??{};for(let e=0;e<l.length;e++){const n=l[e],r=new FontFace(a,`url(${encodeURI(t)})`,{...c,weight:n});await r.load(),s.add(r),o.push(r)}return 1===o.length?o[0]:o}return null},unload(t){(Array.isArray(t)?t:[t]).forEach((t=>WW.ADAPTER.getFontFaceSet().delete(t)))}};U$.add(OK);let PK,LK=0;const FK={id:"checkImageBitmap",code:"\n    async function checkImageBitmap()\n    {\n        try\n        {\n            if (typeof createImageBitmap !== 'function') return false;\n\n            const response = await fetch('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR42mP8/x8AAwMCAO+ip1sAAAAASUVORK5CYII=');\n            const imageBlob =  await response.blob();\n            const imageBitmap = await createImageBitmap(imageBlob);\n\n            return imageBitmap.width === 1 && imageBitmap.height === 1;\n        }\n        catch (e)\n        {\n            return false;\n        }\n    }\n    checkImageBitmap().then((result) => { self.postMessage(result); });\n    "},NK={id:"loadImageBitmap",code:"\n    async function loadImageBitmap(url)\n    {\n        const response = await fetch(url);\n\n        if (!response.ok)\n        {\n            throw new Error(`[WorkerManager.loadImageBitmap] Failed to fetch ${url}: `\n                + `${response.status} ${response.statusText}`);\n        }\n\n        const imageBlob =  await response.blob();\n        const imageBitmap = await createImageBitmap(imageBlob);\n\n        return imageBitmap;\n    }\n    self.onmessage = async (event) =>\n    {\n        try\n        {\n            const imageBitmap = await loadImageBitmap(event.data.data[0]);\n\n            self.postMessage({\n                data: imageBitmap,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            }, [imageBitmap]);\n        }\n        catch(e)\n        {\n            self.postMessage({\n                error: e,\n                uuid: event.data.uuid,\n                id: event.data.id,\n            });\n        }\n    };"};let BK;const UK=new class{constructor(){this._initialized=!1,this._createdWorkers=0,this.workerPool=[],this.queue=[],this.resolveHash={}}isImageBitmapSupported(){return void 0!==this._isImageBitmapSupported||(this._isImageBitmapSupported=new Promise((t=>{const e=URL.createObjectURL(new Blob([FK.code],{type:"application/javascript"})),n=new Worker(e);n.addEventListener("message",(r=>{n.terminate(),URL.revokeObjectURL(e),t(r.data)}))}))),this._isImageBitmapSupported}loadImageBitmap(t){return this._run("loadImageBitmap",[t])}async _initWorkers(){this._initialized||(this._initialized=!0)}getWorker(){void 0===PK&&(PK=navigator.hardwareConcurrency||4);let t=this.workerPool.pop();return!t&&this._createdWorkers<PK&&(BK||(BK=URL.createObjectURL(new Blob([NK.code],{type:"application/javascript"}))),this._createdWorkers++,t=new Worker(BK),t.addEventListener("message",(t=>{this.complete(t.data),this.returnWorker(t.target),this.next()}))),t}returnWorker(t){this.workerPool.push(t)}complete(t){void 0!==t.error?this.resolveHash[t.uuid].reject(t.error):this.resolveHash[t.uuid].resolve(t.data),this.resolveHash[t.uuid]=null}async _run(t,e){await this._initWorkers();const n=new Promise(((n,r)=>{this.queue.push({id:t,arguments:e,resolve:n,reject:r})}));return this.next(),n}next(){if(!this.queue.length)return;const t=this.getWorker();if(!t)return;const e=this.queue.pop(),n=e.id;this.resolveHash[LK]={resolve:e.resolve,reject:e.reject},t.postMessage({data:e.arguments,uuid:LK++,id:n})}};function VK(t,e,n){const r=new wX(t);return r.baseTexture.on("dispose",(()=>{delete e.promiseCache[n]})),r}const jK=[".jpeg",".jpg",".png",".webp",".avif"],zK=["image/jpeg","image/png","image/webp","image/avif"];const GK={extension:{type:F$.LoadParser,priority:AK.High},config:{preferWorkers:!0},test:t=>yK(t,zK)||bK(t,jK),async load(t,e,n){let r=null;r=globalThis.createImageBitmap?this.config.preferWorkers&&await UK.isImageBitmapSupported()?await UK.loadImageBitmap(t):await async function(t){const e=await WW.ADAPTER.fetch(t);if(!e.ok)throw new Error(`[loadImageBitmap] Failed to fetch ${t}: ${e.status} ${e.statusText}`);const n=await e.blob();return await createImageBitmap(n)}(t):await new Promise((e=>{r=new Image,r.crossOrigin="anonymous",r.src=t,r.complete?e(r):r.onload=()=>{e(r)}}));const i=new Z$(r,{resolution:L$(t),...e.data});return i.resource.src=t,VK(i,n,t)},unload(t){t.destroy(!0)}};U$.add(GK);const WK={extension:{type:F$.LoadParser,priority:AK.High},test:t=>".svg"===i$.extname(t).toLowerCase(),testParse:async t=>Fq.test(t),async parse(t,e,n){var r,i,s;const o=new Fq(t,null==(r=null==e?void 0:e.data)?void 0:r.resourceOptions),a=new Z$(o,{resolution:L$(t),...null==e?void 0:e.data});a.resource.src=t;const l=VK(a,n,t);return(null==(s=null==(i=null==e?void 0:e.data)?void 0:i.resourceOptions)?void 0:s.autoLoad)||await o.load(),l},load:async(t,e)=>(await WW.ADAPTER.fetch(t)).text(),unload:GK.unload};U$.add(WK);class HK{constructor(){this._defaultBundleIdentifierOptions={connector:"-",createBundleAssetId:(t,e)=>`${t}${this._bundleIdConnector}${e}`,extractAssetIdFromBundle:(t,e)=>e.replace(`${t}${this._bundleIdConnector}`,"")},this._bundleIdConnector=this._defaultBundleIdentifierOptions.connector,this._createBundleAssetId=this._defaultBundleIdentifierOptions.createBundleAssetId,this._extractAssetIdFromBundle=this._defaultBundleIdentifierOptions.extractAssetIdFromBundle,this._assetMap={},this._preferredOrder=[],this._parsers=[],this._resolverHash={},this._bundles={}}setBundleIdentifier(t){if(this._bundleIdConnector=t.connector??this._bundleIdConnector,this._createBundleAssetId=t.createBundleAssetId??this._createBundleAssetId,this._extractAssetIdFromBundle=t.extractAssetIdFromBundle??this._extractAssetIdFromBundle,"bar"!==this._extractAssetIdFromBundle("foo",this._createBundleAssetId("foo","bar")))throw new Error("[Resolver] GenerateBundleAssetId are not working correctly")}prefer(...t){t.forEach((t=>{this._preferredOrder.push(t),t.priority||(t.priority=Object.keys(t.params))})),this._resolverHash={}}set basePath(t){this._basePath=t}get basePath(){return this._basePath}set rootPath(t){this._rootPath=t}get rootPath(){return this._rootPath}get parsers(){return this._parsers}reset(){this.setBundleIdentifier(this._defaultBundleIdentifierOptions),this._assetMap={},this._preferredOrder=[],this._resolverHash={},this._rootPath=null,this._basePath=null,this._manifest=null,this._bundles={},this._defaultSearchParams=null}setDefaultSearchParams(t){if("string"==typeof t)this._defaultSearchParams=t;else{const e=t;this._defaultSearchParams=Object.keys(e).map((t=>`${encodeURIComponent(t)}=${encodeURIComponent(e[t])}`)).join("&")}}addManifest(t){this._manifest,this._manifest=t,t.bundles.forEach((t=>{this.addBundle(t.name,t.assets)}))}addBundle(t,e){const n=[];Array.isArray(e)?e.forEach((e=>{if("string"==typeof e.name){const r=this._createBundleAssetId(t,e.name);n.push(r),this.add([e.name,r],e.srcs,e.data)}else{const r=e.name.map((e=>this._createBundleAssetId(t,e)));r.forEach((t=>{n.push(t)})),this.add([...e.name,...r],e.srcs)}})):Object.keys(e).forEach((r=>{n.push(this._createBundleAssetId(t,r)),this.add([r,this._createBundleAssetId(t,r)],e[r])})),this._bundles[t]=n}add(t,e,n){const r=xK(t);r.forEach((t=>{this.hasKey(t)})),Array.isArray(e)||(e="string"==typeof e?_K(e):[e]);const i=e.map((t=>{let e=t;if("string"==typeof t){let n=!1;for(let r=0;r<this._parsers.length;r++){const i=this._parsers[r];if(i.test(t)){e=i.parse(t),n=!0;break}}n||(e={src:t})}return e.format||(e.format=e.src.split(".").pop()),e.alias||(e.alias=r),(this._basePath||this._rootPath)&&(e.src=i$.toAbsolute(e.src,this._basePath,this._rootPath)),e.src=this._appendDefaultSearchParams(e.src),e.data=e.data??n,e}));r.forEach((t=>{this._assetMap[t]=i}))}resolveBundle(t){const e=SK(t);t=xK(t);const n={};return t.forEach((t=>{const e=this._bundles[t];if(e){const r=this.resolve(e),i={};for(const e in r){const n=r[e];i[this._extractAssetIdFromBundle(t,e)]=n}n[t]=i}})),e?n[t[0]]:n}resolveUrl(t){const e=this.resolve(t);if("string"!=typeof t){const t={};for(const n in e)t[n]=e[n].src;return t}return e.src}resolve(t){const e=SK(t);t=xK(t);const n={};return t.forEach((t=>{if(!this._resolverHash[t])if(this._assetMap[t]){let e=this._assetMap[t];const n=this._getPreferredOrder(e),r=e[0];null==n||n.priority.forEach((t=>{n.params[t].forEach((n=>{const r=e.filter((e=>!!e[t]&&e[t]===n));r.length&&(e=r)}))})),this._resolverHash[t]=e[0]??r}else{let e=t;(this._basePath||this._rootPath)&&(e=i$.toAbsolute(e,this._basePath,this._rootPath)),e=this._appendDefaultSearchParams(e),this._resolverHash[t]={src:e}}n[t]=this._resolverHash[t]})),e?n[t[0]]:n}hasKey(t){return!!this._assetMap[t]}hasBundle(t){return!!this._bundles[t]}_getPreferredOrder(t){for(let e=0;e<t.length;e++){const e=t[0],n=this._preferredOrder.find((t=>t.params.format.includes(e.format)));if(n)return n}return this._preferredOrder[0]}_appendDefaultSearchParams(t){if(!this._defaultSearchParams)return t;return`${t}${/\?/.test(t)?"&":"?"}${this._defaultSearchParams}`}}const $K=new class{constructor(){this._detections=[],this._initialized=!1,this.resolver=new HK,this.loader=new kK,this.cache=TK,this._backgroundLoader=new vK(this.loader),this._backgroundLoader.active=!0,this.reset()}async init(t={}){var e,n,r;if(this._initialized)return;if(this._initialized=!0,t.defaultSearchParams&&this.resolver.setDefaultSearchParams(t.defaultSearchParams),t.basePath&&(this.resolver.basePath=t.basePath),t.bundleIdentifier&&this.resolver.setBundleIdentifier(t.bundleIdentifier),t.manifest){let e=t.manifest;"string"==typeof e&&(e=await this.load(e)),this.resolver.addManifest(e)}const i=(null==(e=t.texturePreference)?void 0:e.resolution)??1,s="number"==typeof i?[i]:i;let o=[];if(null==(n=t.texturePreference)?void 0:n.format){const e=null==(r=t.texturePreference)?void 0:r.format;o="string"==typeof e?[e]:e;for(const t of this._detections)await t.test()||(o=await t.remove(o))}else for(const a of this._detections)await a.test()&&(o=await a.add(o));this.resolver.prefer({params:{format:o,resolution:s}})}add(t,e,n){this.resolver.add(t,e,n)}async load(t,e){this._initialized||await this.init();const n=SK(t),r=xK(t).map((t=>"string"!=typeof t?(this.resolver.add(t.src,t),t.src):(this.resolver.hasKey(t)||this.resolver.add(t,t),t))),i=this.resolver.resolve(r),s=await this._mapLoadToResolve(i,e);return n?s[r[0]]:s}addBundle(t,e){this.resolver.addBundle(t,e)}async loadBundle(t,e){this._initialized||await this.init();let n=!1;"string"==typeof t&&(n=!0,t=[t]);const r=this.resolver.resolveBundle(t),i={},s=Object.keys(r);let o=0,a=0;const l=()=>{null==e||e(++o/a)},c=s.map((t=>{const e=r[t];return a+=Object.keys(e).length,this._mapLoadToResolve(e,l).then((e=>{i[t]=e}))}));return await Promise.all(c),n?i[t[0]]:i}async backgroundLoad(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolve(t);this._backgroundLoader.add(Object.values(e))}async backgroundLoadBundle(t){this._initialized||await this.init(),"string"==typeof t&&(t=[t]);const e=this.resolver.resolveBundle(t);Object.values(e).forEach((t=>{this._backgroundLoader.add(Object.values(t))}))}reset(){this.resolver.reset(),this.loader.reset(),this.cache.reset(),this._initialized=!1}get(t){if("string"==typeof t)return TK.get(t);const e={};for(let n=0;n<t.length;n++)e[n]=TK.get(t[n]);return e}async _mapLoadToResolve(t,e){const n=Object.values(t),r=Object.keys(t);this._backgroundLoader.active=!1;const i=await this.loader.load(n,e);this._backgroundLoader.active=!0;const s={};return n.forEach(((t,e)=>{const n=i[t.src],o=[t.src];t.alias&&o.push(...t.alias),s[r[e]]=n,TK.set(o,n)})),s}async unload(t){this._initialized||await this.init();const e=xK(t).map((t=>"string"!=typeof t?t.src:t)),n=this.resolver.resolve(e);await this._unloadFromResolved(n)}async unloadBundle(t){this._initialized||await this.init(),t=xK(t);const e=this.resolver.resolveBundle(t),n=Object.keys(e).map((t=>this._unloadFromResolved(e[t])));await Promise.all(n)}async _unloadFromResolved(t){const e=Object.values(t);e.forEach((t=>{TK.remove(t.src)})),await this.loader.unload(e)}get detections(){return this._detections}get preferWorkers(){return GK.config.preferWorkers}set preferWorkers(t){GK.config.preferWorkers=t}};U$.handleByList(F$.LoadParser,$K.loader.parsers).handleByList(F$.ResolveParser,$K.resolver.parsers).handleByList(F$.CacheParser,$K.cache.parsers).handleByList(F$.DetectionParser,$K.detections);const YK={extension:F$.CacheParser,test:t=>Array.isArray(t)&&t.every((t=>t instanceof wX)),getCacheableAssets:(t,e)=>{const n={};return t.forEach((t=>{e.forEach(((e,r)=>{n[t+(0===r?"":r+1)]=e}))})),n}};U$.add(YK);const XK={extension:{type:F$.DetectionParser,priority:1},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await WW.ADAPTER.fetch("data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"avif"],remove:async t=>t.filter((t=>"avif"!==t))};U$.add(XK);const qK={extension:{type:F$.DetectionParser,priority:0},test:async()=>{if(!globalThis.createImageBitmap)return!1;const t=await WW.ADAPTER.fetch("data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAAAAAAfQ//73v/+BiOh/AAA=").then((t=>t.blob()));return createImageBitmap(t).then((()=>!0),(()=>!1))},add:async t=>[...t,"webp"],remove:async t=>t.filter((t=>"webp"!==t))};U$.add(qK);const KK=["png","jpg","jpeg"],ZK={extension:{type:F$.DetectionParser,priority:-1},test:()=>Promise.resolve(!0),add:async t=>[...t,...KK],remove:async t=>t.filter((t=>!KK.includes(t)))};U$.add(ZK);const JK={extension:F$.ResolveParser,test:GK.test,parse:t=>{var e;return{resolution:parseFloat((null==(e=WW.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:t.split(".").pop(),src:t}}};U$.add(JK);var QK=(t=>(t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",t[t.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t))(QK||{});const tZ={33776:.5,33777:.5,33778:1,33779:1,35916:.5,35917:.5,35918:1,35919:1,37488:.5,37489:.5,37490:1,37491:1,37492:.5,37496:1,37493:.5,37497:1,37494:.5,37495:.5,35840:.5,35842:.5,35841:.25,35843:.25,36196:.5,35986:.5,35986:1,34798:1,37808:1};let eZ,nZ;function rZ(){nZ={s3tc:eZ.getExtension("WEBGL_compressed_texture_s3tc"),s3tc_sRGB:eZ.getExtension("WEBGL_compressed_texture_s3tc_srgb"),etc:eZ.getExtension("WEBGL_compressed_texture_etc"),etc1:eZ.getExtension("WEBGL_compressed_texture_etc1"),pvrtc:eZ.getExtension("WEBGL_compressed_texture_pvrtc")||eZ.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc"),atc:eZ.getExtension("WEBGL_compressed_texture_atc"),astc:eZ.getExtension("WEBGL_compressed_texture_astc")}}const iZ={extension:{type:F$.DetectionParser,priority:2},test:async()=>{const t=WW.ADAPTER.createCanvas().getContext("webgl");return!!t&&(eZ=t,!0)},add:async t=>{nZ||rZ();const e=[];for(const n in nZ){nZ[n]&&e.push(n)}return[...e,...t]},remove:async t=>(nZ||rZ(),t.filter((t=>!(t in nZ))))};U$.add(iZ);class sZ extends X${constructor(t,e={width:1,height:1,autoLoad:!0}){let n,r;"string"==typeof t?(n=t,r=new Uint8Array):(n=null,r=t),super(r,e),this.origin=n,this.buffer=r?new V$(r):null,this.origin&&!1!==e.autoLoad&&this.load(),(null==r?void 0:r.length)&&(this.loaded=!0,this.onBlobLoaded(this.buffer.rawBinaryData))}onBlobLoaded(t){}async load(){const t=await fetch(this.origin),e=await t.blob(),n=await e.arrayBuffer();return this.data=new Uint32Array(n),this.buffer=new V$(n),this.loaded=!0,this.onBlobLoaded(n),this.update(),this}}class oZ extends sZ{constructor(t,e){super(t,e),this.format=e.format,this.levels=e.levels||1,this._width=e.width,this._height=e.height,this._extension=oZ._formatToExtension(this.format),(e.levelBuffers||this.buffer)&&(this._levelBuffers=e.levelBuffers||oZ._createLevelBuffers(t instanceof Uint8Array?t:this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height))}upload(t,e,n){const r=t.gl;if(!t.context.extensions[this._extension])throw new Error(`${this._extension} textures are not supported on the current machine`);if(!this._levelBuffers)return!1;for(let i=0,s=this.levels;i<s;i++){const{levelID:t,levelWidth:e,levelHeight:n,levelBuffer:s}=this._levelBuffers[i];r.compressedTexImage2D(r.TEXTURE_2D,t,this.format,e,n,0,s)}return!0}onBlobLoaded(){this._levelBuffers=oZ._createLevelBuffers(this.buffer.uint8View,this.format,this.levels,4,4,this.width,this.height)}static _formatToExtension(t){if(t>=33776&&t<=33779)return"s3tc";if(t>=37488&&t<=37497)return"etc";if(t>=35840&&t<=35843)return"pvrtc";if(t>=36196)return"etc1";if(t>=35986&&t<=34798)return"atc";throw new Error("Invalid (compressed) texture format given!")}static _createLevelBuffers(t,e,n,r,i,s,o){const a=new Array(n);let l=t.byteOffset,c=s,h=o,u=c+r-1&~(r-1),d=h+i-1&~(i-1),f=u*d*tZ[e];for(let p=0;p<n;p++)a[p]={levelID:p,levelWidth:n>1?c:u,levelHeight:n>1?h:d,levelBuffer:new Uint8Array(t.buffer,l,f)},l+=f,c=c>>1||1,h=h>>1||1,u=c+r-1&~(r-1),d=h+i-1&~(i-1),f=u*d*tZ[e];return a}}const aZ=124,lZ=3,cZ=4,hZ=7,uZ=19,dZ=2,fZ=0,pZ=1,mZ=2,gZ=3,vZ={827611204:QK.COMPRESSED_RGBA_S3TC_DXT1_EXT,861165636:QK.COMPRESSED_RGBA_S3TC_DXT3_EXT,894720068:QK.COMPRESSED_RGBA_S3TC_DXT5_EXT},yZ={70:QK.COMPRESSED_RGBA_S3TC_DXT1_EXT,71:QK.COMPRESSED_RGBA_S3TC_DXT1_EXT,73:QK.COMPRESSED_RGBA_S3TC_DXT3_EXT,74:QK.COMPRESSED_RGBA_S3TC_DXT3_EXT,76:QK.COMPRESSED_RGBA_S3TC_DXT5_EXT,77:QK.COMPRESSED_RGBA_S3TC_DXT5_EXT,72:QK.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT,75:QK.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT,78:QK.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT};const bZ=[171,75,84,88,32,49,49,187,13,10,26,10],xZ=12,wZ=16,EZ=24,_Z=28,SZ=36,TZ=40,kZ=44,AZ=48,CZ=52,RZ=56,MZ=60,IZ=64,DZ={[DW.UNSIGNED_BYTE]:1,[DW.UNSIGNED_SHORT]:2,[DW.INT]:4,[DW.UNSIGNED_INT]:4,[DW.FLOAT]:4,[DW.HALF_FLOAT]:8},OZ={[MW.RGBA]:4,[MW.RGB]:3,[MW.RG]:2,[MW.RED]:1,[MW.LUMINANCE]:1,[MW.LUMINANCE_ALPHA]:2,[MW.ALPHA]:1},PZ={[DW.UNSIGNED_SHORT_4_4_4_4]:2,[DW.UNSIGNED_SHORT_5_5_5_1]:2,[DW.UNSIGNED_SHORT_5_6_5]:2};function LZ(t,e,n=!1){const r=new DataView(e);if(!function(t,e){for(let n=0;n<bZ.length;n++)if(e.getUint8(n)!==bZ[n])return!1;return!0}(0,r))return null;const i=67305985===r.getUint32(xZ,!0),s=r.getUint32(wZ,i),o=r.getUint32(EZ,i),a=r.getUint32(_Z,i),l=r.getUint32(SZ,i),c=r.getUint32(TZ,i)||1,h=r.getUint32(kZ,i)||1,u=r.getUint32(AZ,i)||1,d=r.getUint32(CZ,i),f=r.getUint32(RZ,i),p=r.getUint32(MZ,i);if(0===c||1!==h)throw new Error("Only 2D textures are supported");if(1!==d)throw new Error("CubeTextures are not supported by KTXLoader yet!");if(1!==u)throw new Error("WebGL does not support array textures");const m=l+3&-4,g=c+3&-4,v=new Array(u);let y,b=l*c;if(0===s&&(b=m*g),y=0!==s?DZ[s]?DZ[s]*OZ[o]:PZ[s]:tZ[a],void 0===y)throw new Error("Unable to resolve the pixel format stored in the *.ktx file!");const x=n?function(t,e,n){const r=new Map;let i=0;for(;i<e;){const s=t.getUint32(IZ+i,n),o=IZ+i+4,a=3-(s+3)%4;if(0===s||s>e-i)break;let l=0;for(;l<s&&0!==t.getUint8(o+l);l++);if(-1===l)break;const c=(new TextDecoder).decode(new Uint8Array(t.buffer,o,l)),h=new DataView(t.buffer,o+l+1,s-l-1);r.set(c,h),i+=4+s+a}return r}(r,p,i):null;let w=b*y,E=l,_=c,S=m,T=g,k=IZ+p;for(let A=0;A<f;A++){const t=r.getUint32(k,i);let n=k+4;for(let r=0;r<u;r++){let t=v[r];t||(t=v[r]=new Array(f)),t[A]={levelID:A,levelWidth:f>1||0!==s?E:S,levelHeight:f>1||0!==s?_:T,levelBuffer:new Uint8Array(e,n,w)},n+=w}k+=t+4,k=k%4!=0?k+4-k%4:k,E=E>>1||1,_=_>>1||1,S=E+4-1&-4,T=_+4-1&-4,w=S*T*y}return 0!==s?{uncompressed:v.map((t=>{let e=t[0].levelBuffer,n=!1;return s===DW.FLOAT?e=new Float32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4):s===DW.UNSIGNED_INT?(n=!0,e=new Uint32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)):s===DW.INT&&(n=!0,e=new Int32Array(t[0].levelBuffer.buffer,t[0].levelBuffer.byteOffset,t[0].levelBuffer.byteLength/4)),{resource:new X$(e,{width:t[0].levelWidth,height:t[0].levelHeight}),type:s,format:n?FZ(o):o}})),kvData:x}:{compressed:v.map((t=>new oZ(null,{format:a,width:l,height:c,levels:f,levelBuffers:t}))),kvData:x}}function FZ(t){switch(t){case MW.RGBA:return MW.RGBA_INTEGER;case MW.RGB:return MW.RGB_INTEGER;case MW.RG:return MW.RG_INTEGER;case MW.RED:return MW.RED_INTEGER;default:return t}}const NZ={extension:{type:F$.LoadParser,priority:AK.High},test:t=>bK(t,".dds"),async load(t,e,n){const r=await WW.ADAPTER.fetch(t),i=function(t){const e=new Uint32Array(t);if(542327876!==e[0])throw new Error("Invalid DDS file magic word");const n=new Uint32Array(t,0,aZ/Uint32Array.BYTES_PER_ELEMENT),r=n[lZ],i=n[cZ],s=n[hZ],o=new Uint32Array(t,uZ*Uint32Array.BYTES_PER_ELEMENT,32/Uint32Array.BYTES_PER_ELEMENT),a=o[1];if(4&a){const n=o[dZ];if(808540228!==n){const e=vZ[n],o=new Uint8Array(t,128);return[new oZ(o,{format:e,width:i,height:r,levels:s})]}const a=128,l=new Uint32Array(e.buffer,a,20/Uint32Array.BYTES_PER_ELEMENT),c=l[fZ],h=l[pZ],u=l[mZ],d=l[gZ],f=yZ[c];if(void 0===f)throw new Error(`DDSParser cannot parse texture data with DXGI format ${c}`);if(4===u)throw new Error("DDSParser does not support cubemap textures");if(6===h)throw new Error("DDSParser does not supported 3D texture data");const p=new Array,m=148;if(1===d)p.push(new Uint8Array(t,m));else{const e=tZ[f];let n=0,o=i,a=r;for(let t=0;t<s;t++)n+=Math.max(1,o+3&-4)*Math.max(1,a+3&-4)*e,o>>>=1,a>>>=1;let l=m;for(let r=0;r<d;r++)p.push(new Uint8Array(t,l,n)),l+=n}return p.map((t=>new oZ(t,{format:f,width:i,height:r,levels:s})))}if(64&a)throw new Error("DDSParser does not support uncompressed texture data.");if(512&a)throw new Error("DDSParser does not supported YUV uncompressed texture data.");if(131072&a)throw new Error("DDSParser does not support single-channel (lumninance) texture data!");if(2&a)throw new Error("DDSParser does not support single-channel (alpha) texture data!");throw new Error("DDSParser failed to load a texture file due to an unknown reason!")}(await r.arrayBuffer()),s=i.map((r=>VK(new Z$(r,{mipmap:FW.OFF,alphaMode:NW.NO_PREMULTIPLIED_ALPHA,resolution:L$(t),...e.data}),n,t)));return 1===s.length?s[0]:s},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};U$.add(NZ);const BZ={extension:{type:F$.LoadParser,priority:AK.High},test:t=>bK(t,".ktx"),async load(t,e,n){const r=await WW.ADAPTER.fetch(t),i=await r.arrayBuffer(),{compressed:s,uncompressed:o,kvData:a}=LZ(0,i),l=s??o,c={mipmap:FW.OFF,alphaMode:NW.NO_PREMULTIPLIED_ALPHA,resolution:L$(t),...e.data},h=l.map((e=>{l===o&&Object.assign(c,{type:e.type,format:e.format});const r=new Z$(e,c);return r.ktxKeyValueData=a,VK(r,n,t)}));return 1===h.length?h[0]:h},unload(t){Array.isArray(t)?t.forEach((t=>t.destroy(!0))):t.destroy(!0)}};U$.add(BZ);const UZ={extension:F$.ResolveParser,test:t=>{const e=t.split("?")[0].split(".").pop();return["basis","ktx","dds"].includes(e)},parse:t=>{var e,n;if("ktx"===t.split("?")[0].split(".").pop()){const n=[".s3tc.ktx",".s3tc_sRGB.ktx",".etc.ktx",".etc1.ktx",".pvrt.ktx",".atc.ktx",".astc.ktx"];if(n.some((e=>t.endsWith(e))))return{resolution:parseFloat((null==(e=WW.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:n.find((e=>t.endsWith(e))),src:t}}return{resolution:parseFloat((null==(n=WW.RETINA_PREFIX.exec(t))?void 0:n[1])??"1"),format:t.split(".").pop(),src:t}}};U$.add(UZ);const VZ=new pY,jZ=class{constructor(t){this.renderer=t}async image(t,e,n){const r=new Image;return r.src=await this.base64(t,e,n),r}async base64(t,e,n){const r=this.canvas(t);if(void 0!==r.toDataURL)return r.toDataURL(e,n);if(void 0!==r.convertToBlob){const t=await r.convertToBlob({type:e,quality:n});return await new Promise((e=>{const n=new FileReader;n.onload=()=>e(n.result),n.readAsDataURL(t)}))}throw new Error("Extract.base64() requires ICanvas.toDataURL or ICanvas.convertToBlob to be implemented")}canvas(t,e){const{pixels:n,width:r,height:i,flipY:s}=this._rawPixels(t,e);let o=new M$(r,i,1);const a=o.context.getImageData(0,0,r,i);if(jZ.arrayPostDivide(n,a.data),o.context.putImageData(a,0,0),s){const t=new M$(o.width,o.height,1);t.context.scale(1,-1),t.context.drawImage(o.canvas,0,-i),o.destroy(),o=t}return o.canvas}pixels(t,e){const{pixels:n}=this._rawPixels(t,e);return jZ.arrayPostDivide(n,n),n}_rawPixels(t,e){const n=this.renderer;let r,i,s=!1,o=!1;if(t)if(t instanceof EX)i=t;else{const e=n.context.webGLVersion>=2?n.multisample:zW.NONE;if(i=this.renderer.generateTexture(t,{multisample:e}),e!==zW.NONE){const t=EX.create({width:i.width,height:i.height});n.framebuffer.bind(i.framebuffer),n.framebuffer.blit(t.framebuffer),n.framebuffer.bind(null),i.destroy(!0),i=t}o=!0}i?(r=i.baseTexture.resolution,e=e??i.frame,s=!1,n.renderTexture.bind(i)):(r=n.resolution,e||((e=VZ).width=n.width,e.height=n.height),s=!0,n.renderTexture.bind(null));const a=Math.round(e.width*r),l=Math.round(e.height*r),c=new Uint8Array(4*a*l),h=n.gl;return h.readPixels(Math.round(e.x*r),Math.round(e.y*r),a,l,h.RGBA,h.UNSIGNED_BYTE,c),o&&i.destroy(!0),{pixels:c,width:a,height:l,flipY:s}}destroy(){this.renderer=null}static arrayPostDivide(t,e){for(let n=0;n<t.length;n+=4){const r=e[n+3]=t[n+3];0!==r?(e[n]=Math.round(Math.min(255*t[n]/r,255)),e[n+1]=Math.round(Math.min(255*t[n+1]/r,255)),e[n+2]=Math.round(Math.min(255*t[n+2]/r,255))):(e[n]=t[n],e[n+1]=t[n+1],e[n+2]=t[n+2])}}};let zZ=jZ;zZ.extension={name:"extract",type:F$.RendererSystem},U$.add(zZ);const GZ={build(t){const e=t.points;let n,r,i,s,o,a;if(t.type===uY.CIRC){const e=t.shape;n=e.x,r=e.y,o=a=e.radius,i=s=0}else if(t.type===uY.ELIP){const e=t.shape;n=e.x,r=e.y,o=e.width,a=e.height,i=s=0}else{const e=t.shape,l=e.width/2,c=e.height/2;n=e.x+l,r=e.y+c,o=a=Math.max(0,Math.min(e.radius,Math.min(l,c))),i=l-o,s=c-a}if(!(o>=0&&a>=0&&i>=0&&s>=0))return void(e.length=0);const l=Math.ceil(2.3*Math.sqrt(o+a)),c=8*l+(i?4:0)+(s?4:0);if(e.length=c,0===c)return;if(0===l)return e.length=8,e[0]=e[6]=n+i,e[1]=e[3]=r+s,e[2]=e[4]=n-i,void(e[5]=e[7]=r-s);let h=0,u=4*l+(i?2:0)+2,d=u,f=c;{const t=i+o,a=s,l=n+t,c=n-t,p=r+a;if(e[h++]=l,e[h++]=p,e[--u]=p,e[--u]=c,s){const t=r-a;e[d++]=c,e[d++]=t,e[--f]=t,e[--f]=l}}for(let p=1;p<l;p++){const t=Math.PI/2*(p/l),c=i+Math.cos(t)*o,m=s+Math.sin(t)*a,g=n+c,v=n-c,y=r+m,b=r-m;e[h++]=g,e[h++]=y,e[--u]=y,e[--u]=v,e[d++]=v,e[d++]=b,e[--f]=b,e[--f]=g}{const t=s+a,o=n+i,l=n-i,c=r+t,u=r-t;e[h++]=o,e[h++]=c,e[--f]=u,e[--f]=o,i&&(e[h++]=l,e[h++]=c,e[--f]=u,e[--f]=l)}},triangulate(t,e){const n=t.points,r=e.points,i=e.indices;if(0===n.length)return;let s=r.length/2;const o=s;let a,l;if(t.type!==uY.RREC){const e=t.shape;a=e.x,l=e.y}else{const e=t.shape;a=e.x+e.width/2,l=e.y+e.height/2}const c=t.matrix;r.push(t.matrix?c.a*a+c.c*l+c.tx:a,t.matrix?c.b*a+c.d*l+c.ty:l),s++,r.push(n[0],n[1]);for(let h=2;h<n.length;h+=2)r.push(n[h],n[h+1]),i.push(s++,o,s);i.push(o+1,o,s)}};function WZ(t,e=!1){const n=t.length;if(n<6)return;let r=0;for(let i=0,s=t[n-2],o=t[n-1];i<n;i+=2){const e=t[i],n=t[i+1];r+=(e-s)*(n+o),s=e,o=n}if(!e&&r>0||e&&r<=0){const e=n/2;for(let r=e+e%2;r<n;r+=2){const e=n-r-2,i=n-r-1,s=r,o=r+1;[t[e],t[s]]=[t[s],t[e]],[t[i],t[o]]=[t[o],t[i]]}}}const HZ={build(t){t.points=t.shape.points.slice()},triangulate(t,e){let n=t.points;const r=t.holes,i=e.points,s=e.indices;if(n.length>=6){WZ(n,!1);const t=[];for(let i=0;i<r.length;i++){const e=r[i];WZ(e.points,!0),t.push(n.length/2),n=n.concat(e.points)}const e=NH(n,t,2);if(!e)return;const o=i.length/2;for(let n=0;n<e.length;n+=3)s.push(e[n]+o),s.push(e[n+1]+o),s.push(e[n+2]+o);for(let r=0;r<n.length;r++)i.push(n[r])}}},$Z={build(t){const e=t.shape,n=e.x,r=e.y,i=e.width,s=e.height,o=t.points;o.length=0,i>=0&&s>=0&&o.push(n,r,n+i,r,n+i,r+s,n,r+s)},triangulate(t,e){const n=t.points,r=e.points;if(0===n.length)return;const i=r.length/2;r.push(n[0],n[1],n[2],n[3],n[6],n[7],n[4],n[5]),e.indices.push(i,i+1,i+2,i+1,i+2,i+3)}},YZ={build(t){GZ.build(t)},triangulate(t,e){GZ.triangulate(t,e)}};var XZ=(t=>(t.MITER="miter",t.BEVEL="bevel",t.ROUND="round",t))(XZ||{}),qZ=(t=>(t.BUTT="butt",t.ROUND="round",t.SQUARE="square",t))(qZ||{});const KZ={adaptive:!0,maxLength:10,minSegments:8,maxSegments:2048,epsilon:1e-4,_segmentsCount(t,e=20){if(!this.adaptive||!t||isNaN(t))return e;let n=Math.ceil(t/this.maxLength);return n<this.minSegments?n=this.minSegments:n>this.maxSegments&&(n=this.maxSegments),n}};class ZZ{static curveTo(t,e,n,r,i,s){const o=s[s.length-2],a=s[s.length-1]-e,l=o-t,c=r-e,h=n-t,u=Math.abs(a*h-l*c);if(u<1e-8||0===i)return s[s.length-2]===t&&s[s.length-1]===e||s.push(t,e),null;const d=a*a+l*l,f=c*c+h*h,p=a*c+l*h,m=i*Math.sqrt(d)/u,g=i*Math.sqrt(f)/u,v=m*p/d,y=g*p/f,b=m*h+g*l,x=m*c+g*a,w=l*(g+v),E=a*(g+v),_=h*(m+y),S=c*(m+y);return{cx:b+t,cy:x+e,radius:i,startAngle:Math.atan2(E-x,w-b),endAngle:Math.atan2(S-x,_-b),anticlockwise:l*c>h*a}}static arc(t,e,n,r,i,s,o,a,l){const c=o-s,h=KZ._segmentsCount(Math.abs(c)*i,40*Math.ceil(Math.abs(c)/lY)),u=c/(2*h),d=2*u,f=Math.cos(u),p=Math.sin(u),m=h-1,g=m%1/m;for(let v=0;v<=m;++v){const t=u+s+d*(v+g*v),e=Math.cos(t),o=-Math.sin(t);l.push((f*e+p*o)*i+n,(f*-o+p*e)*i+r)}}}class JZ{constructor(){this.reset()}begin(t,e,n){this.reset(),this.style=t,this.start=e,this.attribStart=n}end(t,e){this.attribSize=e-this.attribStart,this.size=t-this.start}reset(){this.style=null,this.size=0,this.start=0,this.attribStart=0,this.attribSize=0}}class QZ{static curveLength(t,e,n,r,i,s,o,a){let l=0,c=0,h=0,u=0,d=0,f=0,p=0,m=0,g=0,v=0,y=0,b=t,x=e;for(let w=1;w<=10;++w)c=w/10,h=c*c,u=h*c,d=1-c,f=d*d,p=f*d,m=p*t+3*f*c*n+3*d*h*i+u*o,g=p*e+3*f*c*r+3*d*h*s+u*a,v=b-m,y=x-g,b=m,x=g,l+=Math.sqrt(v*v+y*y);return l}static curveTo(t,e,n,r,i,s,o){const a=o[o.length-2],l=o[o.length-1];o.length-=2;const c=KZ._segmentsCount(QZ.curveLength(a,l,t,e,n,r,i,s));let h=0,u=0,d=0,f=0,p=0;o.push(a,l);for(let m=1,g=0;m<=c;++m)g=m/c,h=1-g,u=h*h,d=u*h,f=g*g,p=f*g,o.push(d*a+3*u*g*t+3*h*f*n+p*i,d*l+3*u*g*e+3*h*f*r+p*s)}}function tJ(t,e,n,r,i,s,o,a){let l,c;o?(l=r,c=-n):(l=-r,c=n);const h=t-n*i+l,u=e-r*i+c,d=t+n*s+l,f=e+r*s+c;return a.push(h,u),a.push(d,f),2}function eJ(t,e,n,r,i,s,o,a){const l=n-t,c=r-e;let h=Math.atan2(l,c),u=Math.atan2(i-t,s-e);a&&h<u?h+=2*Math.PI:!a&&h>u&&(u+=2*Math.PI);let d=h;const f=u-h,p=Math.abs(f),m=Math.sqrt(l*l+c*c),g=1+(15*p*Math.sqrt(m)/Math.PI>>0),v=f/g;if(d+=v,a){o.push(t,e),o.push(n,r);for(let n=1,r=d;n<g;n++,r+=v)o.push(t,e),o.push(t+Math.sin(r)*m,e+Math.cos(r)*m);o.push(t,e),o.push(i,s)}else{o.push(n,r),o.push(t,e);for(let n=1,r=d;n<g;n++,r+=v)o.push(t+Math.sin(r)*m,e+Math.cos(r)*m),o.push(t,e);o.push(i,s),o.push(t,e)}return 2*g}function nJ(t,e){t.lineStyle.native?function(t,e){let n=0;const r=t.shape,i=t.points||r.points,s=r.type!==uY.POLY||r.closeStroke;if(0===i.length)return;const o=e.points,a=e.indices,l=i.length/2,c=o.length/2;let h=c;for(o.push(i[0],i[1]),n=1;n<l;n++)o.push(i[2*n],i[2*n+1]),a.push(h,h+1),h++;s&&a.push(h,c)}(t,e):function(t,e){const n=t.shape;let r=t.points||n.points.slice();const i=e.closePointEps;if(0===r.length)return;const s=t.lineStyle,o=new dY(r[0],r[1]),a=new dY(r[r.length-2],r[r.length-1]),l=n.type!==uY.POLY||n.closeStroke,c=Math.abs(o.x-a.x)<i&&Math.abs(o.y-a.y)<i;if(l){r=r.slice(),c&&(r.pop(),r.pop(),a.set(r[r.length-2],r[r.length-1]));const t=.5*(o.x+a.x),e=.5*(a.y+o.y);r.unshift(t,e),r.push(t,e)}const h=e.points,u=r.length/2;let d=r.length;const f=h.length/2,p=s.width/2,m=p*p,g=s.miterLimit*s.miterLimit;let v=r[0],y=r[1],b=r[2],x=r[3],w=0,E=0,_=-(y-x),S=v-b,T=0,k=0,A=Math.sqrt(_*_+S*S);_/=A,S/=A,_*=p,S*=p;const C=s.alignment,R=2*(1-C),M=2*C;l||(s.cap===qZ.ROUND?d+=eJ(v-_*(R-M)*.5,y-S*(R-M)*.5,v-_*R,y-S*R,v+_*M,y+S*M,h,!0)+2:s.cap===qZ.SQUARE&&(d+=tJ(v,y,_,S,R,M,!0,h))),h.push(v-_*R,y-S*R),h.push(v+_*M,y+S*M);for(let O=1;O<u-1;++O){v=r[2*(O-1)],y=r[2*(O-1)+1],b=r[2*O],x=r[2*O+1],w=r[2*(O+1)],E=r[2*(O+1)+1],_=-(y-x),S=v-b,A=Math.sqrt(_*_+S*S),_/=A,S/=A,_*=p,S*=p,T=-(x-E),k=b-w,A=Math.sqrt(T*T+k*k),T/=A,k/=A,T*=p,k*=p;const t=b-v,e=y-x,n=b-w,i=E-x,o=t*n+e*i,a=e*n-i*t,l=a<0;if(Math.abs(a)<.001*Math.abs(o)){h.push(b-_*R,x-S*R),h.push(b+_*M,x+S*M),o>=0&&(s.join===XZ.ROUND?d+=eJ(b,x,b-_*R,x-S*R,b-T*R,x-k*R,h,!1)+4:d+=2,h.push(b-T*M,x-k*M),h.push(b+T*R,x+k*R));continue}const c=(-_+v)*(-S+x)-(-_+b)*(-S+y),u=(-T+w)*(-k+x)-(-T+b)*(-k+E),f=(t*u-n*c)/a,C=(i*c-e*u)/a,I=(f-b)*(f-b)+(C-x)*(C-x),D=b+(f-b)*R,P=x+(C-x)*R,L=b-(f-b)*M,F=x-(C-x)*M,N=l?R:M;I<=Math.min(t*t+e*e,n*n+i*i)+N*N*m?s.join===XZ.BEVEL||I/m>g?(l?(h.push(D,P),h.push(b+_*M,x+S*M),h.push(D,P),h.push(b+T*M,x+k*M)):(h.push(b-_*R,x-S*R),h.push(L,F),h.push(b-T*R,x-k*R),h.push(L,F)),d+=2):s.join===XZ.ROUND?l?(h.push(D,P),h.push(b+_*M,x+S*M),d+=eJ(b,x,b+_*M,x+S*M,b+T*M,x+k*M,h,!0)+4,h.push(D,P),h.push(b+T*M,x+k*M)):(h.push(b-_*R,x-S*R),h.push(L,F),d+=eJ(b,x,b-_*R,x-S*R,b-T*R,x-k*R,h,!1)+4,h.push(b-T*R,x-k*R),h.push(L,F)):(h.push(D,P),h.push(L,F)):(h.push(b-_*R,x-S*R),h.push(b+_*M,x+S*M),s.join===XZ.ROUND?d+=l?eJ(b,x,b+_*M,x+S*M,b+T*M,x+k*M,h,!0)+2:eJ(b,x,b-_*R,x-S*R,b-T*R,x-k*R,h,!1)+2:s.join===XZ.MITER&&I/m<=g&&(l?(h.push(L,F),h.push(L,F)):(h.push(D,P),h.push(D,P)),d+=2),h.push(b-T*R,x-k*R),h.push(b+T*M,x+k*M),d+=2)}v=r[2*(u-2)],y=r[2*(u-2)+1],b=r[2*(u-1)],x=r[2*(u-1)+1],_=-(y-x),S=v-b,A=Math.sqrt(_*_+S*S),_/=A,S/=A,_*=p,S*=p,h.push(b-_*R,x-S*R),h.push(b+_*M,x+S*M),l||(s.cap===qZ.ROUND?d+=eJ(b-_*(R-M)*.5,x-S*(R-M)*.5,b-_*R,x-S*R,b+_*M,x+S*M,h,!1)+2:s.cap===qZ.SQUARE&&(d+=tJ(b,x,_,S,R,M,!1,h)));const I=e.indices,D=KZ.epsilon*KZ.epsilon;for(let O=f;O<d+f-2;++O)v=h[2*O],y=h[2*O+1],b=h[2*(O+1)],x=h[2*(O+1)+1],w=h[2*(O+2)],E=h[2*(O+2)+1],Math.abs(v*(x-E)+b*(E-y)+w*(y-x))<D||I.push(O,O+1,O+2)}(t,e)}class rJ{static curveLength(t,e,n,r,i,s){const o=t-2*n+i,a=e-2*r+s,l=2*n-2*t,c=2*r-2*e,h=4*(o*o+a*a),u=4*(o*l+a*c),d=l*l+c*c,f=2*Math.sqrt(h+u+d),p=Math.sqrt(h),m=2*h*p,g=2*Math.sqrt(d),v=u/p;return(m*f+p*u*(f-g)+(4*d*h-u*u)*Math.log((2*p+v+f)/(v+g)))/(4*m)}static curveTo(t,e,n,r,i){const s=i[i.length-2],o=i[i.length-1],a=KZ._segmentsCount(rJ.curveLength(s,o,t,e,n,r));let l=0,c=0;for(let h=1;h<=a;++h){const u=h/a;l=s+(t-s)*u,c=o+(e-o)*u,i.push(l+(t+(n-t)*u-l)*u,c+(e+(r-e)*u-c)*u)}}}const iJ={[uY.POLY]:HZ,[uY.CIRC]:GZ,[uY.ELIP]:GZ,[uY.RECT]:$Z,[uY.RREC]:YZ},sJ=[],oJ=[];class aJ{constructor(t,e=null,n=null,r=null){this.points=[],this.holes=[],this.shape=t,this.lineStyle=n,this.fillStyle=e,this.matrix=r,this.type=t.type}clone(){return new aJ(this.shape,this.fillStyle,this.lineStyle,this.matrix)}destroy(){this.shape=null,this.holes.length=0,this.holes=null,this.points.length=0,this.points=null,this.lineStyle=null,this.fillStyle=null}}const lJ=new dY,cJ=class extends aY{constructor(){super(),this.closePointEps=1e-4,this.boundsPadding=0,this.uvsFloat32=null,this.indicesUint16=null,this.batchable=!1,this.points=[],this.colors=[],this.uvs=[],this.indices=[],this.textureIds=[],this.graphicsData=[],this.drawCalls=[],this.batchDirty=-1,this.batches=[],this.dirty=0,this.cacheDirty=-1,this.clearDirty=0,this.shapeIndex=0,this._bounds=new Uq,this.boundsDirty=-1}get bounds(){return this.updateBatches(),this.boundsDirty!==this.dirty&&(this.boundsDirty=this.dirty,this.calculateBounds()),this._bounds}invalidate(){this.boundsDirty=-1,this.dirty++,this.batchDirty++,this.shapeIndex=0,this.points.length=0,this.colors.length=0,this.uvs.length=0,this.indices.length=0,this.textureIds.length=0;for(let t=0;t<this.drawCalls.length;t++)this.drawCalls[t].texArray.clear(),oJ.push(this.drawCalls[t]);this.drawCalls.length=0;for(let t=0;t<this.batches.length;t++){const e=this.batches[t];e.reset(),sJ.push(e)}this.batches.length=0}clear(){return this.graphicsData.length>0&&(this.invalidate(),this.clearDirty++,this.graphicsData.length=0),this}drawShape(t,e=null,n=null,r=null){const i=new aJ(t,e,n,r);return this.graphicsData.push(i),this.dirty++,this}drawHole(t,e=null){if(!this.graphicsData.length)return null;const n=new aJ(t,null,null,e),r=this.graphicsData[this.graphicsData.length-1];return n.lineStyle=r.lineStyle,r.holes.push(n),this.dirty++,this}destroy(){super.destroy();for(let t=0;t<this.graphicsData.length;++t)this.graphicsData[t].destroy();this.points.length=0,this.points=null,this.colors.length=0,this.colors=null,this.uvs.length=0,this.uvs=null,this.indices.length=0,this.indices=null,this.indexBuffer.destroy(),this.indexBuffer=null,this.graphicsData.length=0,this.graphicsData=null,this.drawCalls.length=0,this.drawCalls=null,this.batches.length=0,this.batches=null,this._bounds=null}containsPoint(t){const e=this.graphicsData;for(let n=0;n<e.length;++n){const r=e[n];if(r.fillStyle.visible&&(r.shape&&(r.matrix?r.matrix.applyInverse(t,lJ):lJ.copyFrom(t),r.shape.contains(lJ.x,lJ.y)))){let t=!1;if(r.holes)for(let e=0;e<r.holes.length;e++){if(r.holes[e].shape.contains(lJ.x,lJ.y)){t=!0;break}}if(!t)return!0}}return!1}updateBatches(){if(!this.graphicsData.length)return void(this.batchable=!0);if(!this.validateBatching())return;this.cacheDirty=this.dirty;const t=this.uvs,e=this.graphicsData;let n=null,r=null;this.batches.length>0&&(n=this.batches[this.batches.length-1],r=n.style);for(let a=this.shapeIndex;a<e.length;a++){this.shapeIndex++;const i=e[a],s=i.fillStyle,o=i.lineStyle;iJ[i.type].build(i),i.matrix&&this.transformPoints(i.points,i.matrix),(s.visible||o.visible)&&this.processHoles(i.holes);for(let e=0;e<2;e++){const a=0===e?s:o;if(!a.visible)continue;const l=a.texture.baseTexture,c=this.indices.length,h=this.points.length/2;l.wrapMode=LW.REPEAT,0===e?this.processFill(i):this.processLine(i);const u=this.points.length/2-h;0!==u&&(n&&!this._compareStyles(r,a)&&(n.end(c,h),n=null),n||(n=sJ.pop()||new JZ,n.begin(a,c,h),this.batches.push(n),r=a),this.addUvs(this.points,t,a.texture,h,u,a.matrix))}}const i=this.indices.length,s=this.points.length/2;if(n&&n.end(i,s),0===this.batches.length)return void(this.batchable=!0);const o=s>65535;this.indicesUint16&&this.indices.length===this.indicesUint16.length&&o===this.indicesUint16.BYTES_PER_ELEMENT>2?this.indicesUint16.set(this.indices):this.indicesUint16=o?new Uint32Array(this.indices):new Uint16Array(this.indices),this.batchable=this.isBatchable(),this.batchable?this.packBatches():this.buildDrawCalls()}_compareStyles(t,e){return!(!t||!e)&&(t.texture.baseTexture===e.texture.baseTexture&&(t.color+t.alpha===e.color+e.alpha&&!!t.native==!!e.native))}validateBatching(){if(this.dirty===this.cacheDirty||!this.graphicsData.length)return!1;for(let t=0,e=this.graphicsData.length;t<e;t++){const e=this.graphicsData[t],n=e.fillStyle,r=e.lineStyle;if(n&&!n.texture.baseTexture.valid)return!1;if(r&&!r.texture.baseTexture.valid)return!1}return!0}packBatches(){this.batchDirty++,this.uvsFloat32=new Float32Array(this.uvs);const t=this.batches;for(let e=0,n=t.length;e<n;e++){const n=t[e];for(let t=0;t<n.size;t++){const e=n.start+t;this.indicesUint16[e]=this.indicesUint16[e]-n.attribStart}}}isBatchable(){if(this.points.length>131070)return!1;const t=this.batches;for(let e=0;e<t.length;e++)if(t[e].style.native)return!1;return this.points.length<2*cJ.BATCHABLE_SIZE}buildDrawCalls(){let t=++Z$._globalBatch;for(let h=0;h<this.drawCalls.length;h++)this.drawCalls[h].texArray.clear(),oJ.push(this.drawCalls[h]);this.drawCalls.length=0;const e=this.colors,n=this.textureIds;let r=oJ.pop();r||(r=new J$,r.texArray=new rX),r.texArray.count=0,r.start=0,r.size=0,r.type=RW.TRIANGLES;let i=0,s=null,o=0,a=!1,l=RW.TRIANGLES,c=0;this.drawCalls.push(r);for(let h=0;h<this.batches.length;h++){const u=this.batches[h],d=8,f=u.style,p=f.texture.baseTexture;a!==!!f.native&&(a=!!f.native,l=a?RW.LINES:RW.TRIANGLES,s=null,i=d,t++),s!==p&&(s=p,p._batchEnabled!==t&&(i===d&&(t++,i=0,r.size>0&&(r=oJ.pop(),r||(r=new J$,r.texArray=new rX),this.drawCalls.push(r)),r.start=c,r.size=0,r.texArray.count=0,r.type=l),p.touched=1,p._batchEnabled=t,p._batchLocation=i,p.wrapMode=LW.REPEAT,r.texArray.elements[r.texArray.count++]=p,i++)),r.size+=u.size,c+=u.size,o=p._batchLocation,this.addColors(e,f.color,f.alpha,u.attribSize,u.attribStart),this.addTextureIds(n,o,u.attribSize,u.attribStart)}Z$._globalBatch=t,this.packAttributes()}packAttributes(){const t=this.points,e=this.uvs,n=this.colors,r=this.textureIds,i=new ArrayBuffer(3*t.length*4),s=new Float32Array(i),o=new Uint32Array(i);let a=0;for(let l=0;l<t.length/2;l++)s[a++]=t[2*l],s[a++]=t[2*l+1],s[a++]=e[2*l],s[a++]=e[2*l+1],o[a++]=n[l],s[a++]=r[l];this._buffer.update(i),this._indexBuffer.update(this.indicesUint16)}processFill(t){if(t.holes.length)HZ.triangulate(t,this);else{iJ[t.type].triangulate(t,this)}}processLine(t){nJ(t,this);for(let e=0;e<t.holes.length;e++)nJ(t.holes[e],this)}processHoles(t){for(let e=0;e<t.length;e++){const n=t[e];iJ[n.type].build(n),n.matrix&&this.transformPoints(n.points,n.matrix)}}calculateBounds(){const t=this._bounds;t.clear(),t.addVertexData(this.points,0,this.points.length),t.pad(this.boundsPadding,this.boundsPadding)}transformPoints(t,e){for(let n=0;n<t.length/2;n++){const r=t[2*n],i=t[2*n+1];t[2*n]=e.a*r+e.c*i+e.tx,t[2*n+1]=e.b*r+e.d*i+e.ty}}addColors(t,e,n,r,i=0){const s=m$((e>>16)+(65280&e)+((255&e)<<16),n);t.length=Math.max(t.length,i+r);for(let o=0;o<r;o++)t[i+o]=s}addTextureIds(t,e,n,r=0){t.length=Math.max(t.length,r+n);for(let i=0;i<n;i++)t[r+i]=e}addUvs(t,e,n,r,i,s=null){let o=0;const a=e.length,l=n.frame;for(;o<i;){let n=t[2*(r+o)],i=t[2*(r+o)+1];if(s){const t=s.a*n+s.c*i+s.tx;i=s.b*n+s.d*i+s.ty,n=t}o++,e.push(n/l.width,i/l.height)}const c=n.baseTexture;(l.width<c.width||l.height<c.height)&&this.adjustUvs(e,n,a,i)}adjustUvs(t,e,n,r){const i=e.baseTexture,s=1e-6,o=n+2*r,a=e.frame,l=a.width/i.width,c=a.height/i.height;let h=a.x/a.width,u=a.y/a.height,d=Math.floor(t[n]+s),f=Math.floor(t[n+1]+s);for(let p=n+2;p<o;p+=2)d=Math.min(d,Math.floor(t[p]+s)),f=Math.min(f,Math.floor(t[p+1]+s));h-=d,u-=f;for(let p=n;p<o;p+=2)t[p]=(t[p]+h)*l,t[p+1]=(t[p+1]+u)*c}};let hJ=cJ;hJ.BATCHABLE_SIZE=100;class uJ{constructor(){this.color=16777215,this.alpha=1,this.texture=wX.WHITE,this.matrix=null,this.visible=!1,this.reset()}clone(){const t=new uJ;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t}reset(){this.color=16777215,this.alpha=1,this.texture=wX.WHITE,this.matrix=null,this.visible=!1}destroy(){this.texture=null,this.matrix=null}}class dJ extends uJ{constructor(){super(...arguments),this.width=0,this.alignment=.5,this.native=!1,this.cap=qZ.BUTT,this.join=XZ.MITER,this.miterLimit=10}clone(){const t=new dJ;return t.color=this.color,t.alpha=this.alpha,t.texture=this.texture,t.matrix=this.matrix,t.visible=this.visible,t.width=this.width,t.alignment=this.alignment,t.native=this.native,t.cap=this.cap,t.join=this.join,t.miterLimit=this.miterLimit,t}reset(){super.reset(),this.color=0,this.alignment=.5,this.width=0,this.native=!1}}const fJ=new Float32Array(3),pJ={},mJ=class extends Hq{constructor(t=null){super(),this.shader=null,this.pluginName="batch",this.currentPath=null,this.batches=[],this.batchTint=-1,this.batchDirty=-1,this.vertexData=null,this._fillStyle=new uJ,this._lineStyle=new dJ,this._matrix=null,this._holeMode=!1,this.state=G$.for2d(),this._geometry=t||new hJ,this._geometry.refCount++,this._transformID=-1,this.tint=16777215,this.blendMode=CW.NORMAL}get geometry(){return this._geometry}clone(){return this.finishPoly(),new mJ(this._geometry)}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}get tint(){return this._tint}set tint(t){this._tint=t}get fill(){return this._fillStyle}get line(){return this._lineStyle}lineStyle(t=null,e=0,n=1,r=.5,i=!1){return"number"==typeof t&&(t={width:t,color:e,alpha:n,alignment:r,native:i}),this.lineTextureStyle(t)}lineTextureStyle(t){t=Object.assign({width:0,texture:wX.WHITE,color:(null==t?void 0:t.texture)?16777215:0,alpha:1,matrix:null,alignment:.5,native:!1,cap:qZ.BUTT,join:XZ.MITER,miterLimit:10},t),this.currentPath&&this.startPoly();const e=t.width>0&&t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._lineStyle,{visible:e},t)):this._lineStyle.reset(),this}startPoly(){if(this.currentPath){const t=this.currentPath.points,e=this.currentPath.points.length;e>2&&(this.drawShape(this.currentPath),this.currentPath=new vY,this.currentPath.closeStroke=!1,this.currentPath.points.push(t[e-2],t[e-1]))}else this.currentPath=new vY,this.currentPath.closeStroke=!1}finishPoly(){this.currentPath&&(this.currentPath.points.length>2?(this.drawShape(this.currentPath),this.currentPath=null):this.currentPath.points.length=0)}moveTo(t,e){return this.startPoly(),this.currentPath.points[0]=t,this.currentPath.points[1]=e,this}lineTo(t,e){this.currentPath||this.moveTo(0,0);const n=this.currentPath.points,r=n[n.length-2],i=n[n.length-1];return r===t&&i===e||n.push(t,e),this}_initCurve(t=0,e=0){this.currentPath?0===this.currentPath.points.length&&(this.currentPath.points=[t,e]):this.moveTo(t,e)}quadraticCurveTo(t,e,n,r){this._initCurve();const i=this.currentPath.points;return 0===i.length&&this.moveTo(0,0),rJ.curveTo(t,e,n,r,i),this}bezierCurveTo(t,e,n,r,i,s){return this._initCurve(),QZ.curveTo(t,e,n,r,i,s,this.currentPath.points),this}arcTo(t,e,n,r,i){this._initCurve(t,e);const s=this.currentPath.points,o=ZZ.curveTo(t,e,n,r,i,s);if(o){const{cx:t,cy:e,radius:n,startAngle:r,endAngle:i,anticlockwise:s}=o;this.arc(t,e,n,r,i,s)}return this}arc(t,e,n,r,i,s=!1){if(r===i)return this;!s&&i<=r?i+=lY:s&&r<=i&&(r+=lY);if(0===i-r)return this;const o=t+Math.cos(r)*n,a=e+Math.sin(r)*n,l=this._geometry.closePointEps;let c=this.currentPath?this.currentPath.points:null;if(c){const t=Math.abs(c[c.length-2]-o),e=Math.abs(c[c.length-1]-a);t<l&&e<l||c.push(o,a)}else this.moveTo(o,a),c=this.currentPath.points;return ZZ.arc(o,a,t,e,n,r,i,s,c),this}beginFill(t=0,e=1){return this.beginTextureFill({texture:wX.WHITE,color:t,alpha:e})}beginTextureFill(t){t=Object.assign({texture:wX.WHITE,color:16777215,alpha:1,matrix:null},t),this.currentPath&&this.startPoly();const e=t.alpha>0;return e?(t.matrix&&(t.matrix=t.matrix.clone(),t.matrix.invert()),Object.assign(this._fillStyle,{visible:e},t)):this._fillStyle.reset(),this}endFill(){return this.finishPoly(),this._fillStyle.reset(),this}drawRect(t,e,n,r){return this.drawShape(new pY(t,e,n,r))}drawRoundedRect(t,e,n,r,i){return this.drawShape(new yY(t,e,n,r,i))}drawCircle(t,e,n){return this.drawShape(new mY(t,e,n))}drawEllipse(t,e,n,r){return this.drawShape(new gY(t,e,n,r))}drawPolygon(...t){let e,n=!0;const r=t[0];r.points?(n=r.closeStroke,e=r.points):e=Array.isArray(t[0])?t[0]:t;const i=new vY(e);return i.closeStroke=n,this.drawShape(i),this}drawShape(t){return this._holeMode?this._geometry.drawHole(t,this._matrix):this._geometry.drawShape(t,this._fillStyle.clone(),this._lineStyle.clone(),this._matrix),this}clear(){return this._geometry.clear(),this._lineStyle.reset(),this._fillStyle.reset(),this._boundsID++,this._matrix=null,this._holeMode=!1,this.currentPath=null,this}isFastRect(){const t=this._geometry.graphicsData;return!(1!==t.length||t[0].shape.type!==uY.RECT||t[0].matrix||t[0].holes.length||t[0].lineStyle.visible&&t[0].lineStyle.width)}_render(t){this.finishPoly();const e=this._geometry;e.updateBatches(),e.batchable?(this.batchDirty!==e.batchDirty&&this._populateBatches(),this._renderBatched(t)):(t.batch.flush(),this._renderDirect(t))}_populateBatches(){const t=this._geometry,e=this.blendMode,n=t.batches.length;this.batchTint=-1,this._transformID=-1,this.batchDirty=t.batchDirty,this.batches.length=n,this.vertexData=new Float32Array(t.points);for(let r=0;r<n;r++){const n=t.batches[r],i=n.style.color,s=new Float32Array(this.vertexData.buffer,4*n.attribStart*2,2*n.attribSize),o=new Float32Array(t.uvsFloat32.buffer,4*n.attribStart*2,2*n.attribSize),a={vertexData:s,blendMode:e,indices:new Uint16Array(t.indicesUint16.buffer,2*n.start,n.size),uvs:o,_batchRGB:c$(i),_tintRGB:i,_texture:n.style.texture,alpha:n.style.alpha,worldAlpha:1};this.batches[r]=a}}_renderBatched(t){if(this.batches.length){t.batch.setObjectRenderer(t.plugins[this.pluginName]),this.calculateVertices(),this.calculateTints();for(let e=0,n=this.batches.length;e<n;e++){const n=this.batches[e];n.worldAlpha=this.worldAlpha*n.alpha,t.plugins[this.pluginName].render(n)}}}_renderDirect(t){const e=this._resolveDirectShader(t),n=this._geometry,r=this.tint,i=this.worldAlpha,s=e.uniforms,o=n.drawCalls;s.translationMatrix=this.transform.worldTransform,s.tint[0]=(r>>16&255)/255*i,s.tint[1]=(r>>8&255)/255*i,s.tint[2]=(255&r)/255*i,s.tint[3]=i,t.shader.bind(e),t.geometry.bind(n,e),t.state.set(this.state);for(let a=0,l=o.length;a<l;a++)this._renderDrawCallDirect(t,n.drawCalls[a])}_renderDrawCallDirect(t,e){const{texArray:n,type:r,size:i,start:s}=e,o=n.count;for(let a=0;a<o;a++)t.texture.bind(n.elements[a],a);t.geometry.draw(r,i,s)}_resolveDirectShader(t){let e=this.shader;const n=this.pluginName;if(!e){if(!pJ[n]){const{maxTextures:e}=t.plugins[n],r=new Int32Array(e);for(let t=0;t<e;t++)r[t]=t;const i={tint:new Float32Array([1,1,1,1]),translationMatrix:new bY,default:tX.from({uSamplers:r},!0)},s=t.plugins[n]._shader.program;pJ[n]=new eX(s,i)}e=pJ[n]}return e}_calculateBounds(){this.finishPoly();const t=this._geometry;if(!t.graphicsData.length)return;const{minX:e,minY:n,maxX:r,maxY:i}=t.bounds;this._bounds.addFrame(this.transform,e,n,r,i)}containsPoint(t){return this.worldTransform.applyInverse(t,mJ._TEMP_POINT),this._geometry.containsPoint(mJ._TEMP_POINT)}calculateTints(){if(this.batchTint!==this.tint){this.batchTint=this.tint;const t=c$(this.tint,fJ);for(let e=0;e<this.batches.length;e++){const n=this.batches[e],r=n._batchRGB,i=(t[0]*r[0]*255<<16)+(t[1]*r[1]*255<<8)+(0|t[2]*r[2]*255);n._tintRGB=(i>>16)+(65280&i)+((255&i)<<16)}}}calculateVertices(){const t=this.transform._worldID;if(this._transformID===t)return;this._transformID=t;const e=this.transform.worldTransform,n=e.a,r=e.b,i=e.c,s=e.d,o=e.tx,a=e.ty,l=this._geometry.points,c=this.vertexData;let h=0;for(let u=0;u<l.length;u+=2){const t=l[u],e=l[u+1];c[h++]=n*t+i*e+o,c[h++]=s*e+r*t+a}}closePath(){const t=this.currentPath;return t&&(t.closeStroke=!0,this.finishPoly()),this}setMatrix(t){return this._matrix=t,this}beginHole(){return this.finishPoly(),this._holeMode=!0,this}endHole(){return this.finishPoly(),this._holeMode=!1,this}destroy(t){this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose(),this._matrix=null,this.currentPath=null,this._lineStyle.destroy(),this._lineStyle=null,this._fillStyle.destroy(),this._fillStyle=null,this._geometry=null,this.shader=null,this.vertexData=null,this.batches.length=0,this.batches=null,super.destroy(t)}};let gJ=mJ;gJ.curves=KZ,gJ._TEMP_POINT=new dY;class vJ{constructor(t,e){this.uvBuffer=t,this.uvMatrix=e,this.data=null,this._bufferUpdateId=-1,this._textureUpdateId=-1,this._updateID=0}update(t){if(!t&&this._bufferUpdateId===this.uvBuffer._updateID&&this._textureUpdateId===this.uvMatrix._updateID)return;this._bufferUpdateId=this.uvBuffer._updateID,this._textureUpdateId=this.uvMatrix._updateID;const e=this.uvBuffer.data;this.data&&this.data.length===e.length||(this.data=new Float32Array(e.length)),this.uvMatrix.multiplyUvs(e,this.data),this._updateID++}}const yJ=new dY,bJ=new vY,xJ=class extends Hq{constructor(t,e,n,r=RW.TRIANGLES){super(),this.geometry=t,this.shader=e,this.state=n||G$.for2d(),this.drawMode=r,this.start=0,this.size=0,this.uvs=null,this.indices=null,this.vertexData=new Float32Array(1),this.vertexDirty=-1,this._transformID=-1,this._roundPixels=WW.ROUND_PIXELS,this.batchUvs=null}get geometry(){return this._geometry}set geometry(t){this._geometry!==t&&(this._geometry&&(this._geometry.refCount--,0===this._geometry.refCount&&this._geometry.dispose()),this._geometry=t,this._geometry&&this._geometry.refCount++,this.vertexDirty=-1)}get uvBuffer(){return this.geometry.buffers[1]}get verticesBuffer(){return this.geometry.buffers[0]}set material(t){this.shader=t}get material(){return this.shader}set blendMode(t){this.state.blendMode=t}get blendMode(){return this.state.blendMode}set roundPixels(t){this._roundPixels!==t&&(this._transformID=-1),this._roundPixels=t}get roundPixels(){return this._roundPixels}get tint(){return"tint"in this.shader?this.shader.tint:null}set tint(t){this.shader.tint=t}get texture(){return"texture"in this.shader?this.shader.texture:null}set texture(t){this.shader.texture=t}_render(t){const e=this.geometry.buffers[0].data;this.shader.batchable&&this.drawMode===RW.TRIANGLES&&e.length<2*xJ.BATCHABLE_SIZE?this._renderToBatch(t):this._renderDefault(t)}_renderDefault(t){const e=this.shader;e.alpha=this.worldAlpha,e.update&&e.update(),t.batch.flush(),e.uniforms.translationMatrix=this.transform.worldTransform.toArray(!0),t.shader.bind(e),t.state.set(this.state),t.geometry.bind(this.geometry,e),t.geometry.draw(this.drawMode,this.size,this.start,this.geometry.instanceCount)}_renderToBatch(t){const e=this.geometry,n=this.shader;n.uvMatrix&&(n.uvMatrix.update(),this.calculateUvs()),this.calculateVertices(),this.indices=e.indexBuffer.data,this._tintRGB=n._tintRGB,this._texture=n.texture;const r=this.material.pluginName;t.batch.setObjectRenderer(t.plugins[r]),t.plugins[r].render(this)}calculateVertices(){const t=this.geometry.buffers[0],e=t.data,n=t._updateID;if(n===this.vertexDirty&&this._transformID===this.transform._worldID)return;this._transformID=this.transform._worldID,this.vertexData.length!==e.length&&(this.vertexData=new Float32Array(e.length));const r=this.transform.worldTransform,i=r.a,s=r.b,o=r.c,a=r.d,l=r.tx,c=r.ty,h=this.vertexData;for(let u=0;u<h.length/2;u++){const t=e[2*u],n=e[2*u+1];h[2*u]=i*t+o*n+l,h[2*u+1]=s*t+a*n+c}if(this._roundPixels){const t=WW.RESOLUTION;for(let e=0;e<h.length;++e)h[e]=Math.round(h[e]*t)/t}this.vertexDirty=n}calculateUvs(){const t=this.geometry.buffers[1],e=this.shader;e.uvMatrix.isSimple?this.uvs=t.data:(this.batchUvs||(this.batchUvs=new vJ(t,e.uvMatrix)),this.batchUvs.update(),this.uvs=this.batchUvs.data)}_calculateBounds(){this.calculateVertices(),this._bounds.addVertexData(this.vertexData,0,this.vertexData.length)}containsPoint(t){if(!this.getBounds().contains(t.x,t.y))return!1;this.worldTransform.applyInverse(t,yJ);const e=this.geometry.getBuffer("aVertexPosition").data,n=bJ.points,r=this.geometry.getIndex().data,i=r.length,s=4===this.drawMode?3:1;for(let o=0;o+2<i;o+=s){const t=2*r[o],i=2*r[o+1],s=2*r[o+2];if(n[0]=e[t],n[1]=e[t+1],n[2]=e[i],n[3]=e[i+1],n[4]=e[s],n[5]=e[s+1],bJ.contains(yJ.x,yJ.y))return!0}return!1}destroy(t){super.destroy(t),this._cachedTexture&&(this._cachedTexture.destroy(),this._cachedTexture=null),this.geometry=null,this.shader=null,this.state=null,this.uvs=null,this.indices=null,this.vertexData=null}};let wJ=xJ;wJ.BATCHABLE_SIZE=100;class EJ extends oY{constructor(t,e,n){super();const r=new tY(t),i=new tY(e,!0),s=new tY(n,!0,!0);this.addAttribute("aVertexPosition",r,2,!1,DW.FLOAT).addAttribute("aTextureCoord",i,2,!1,DW.FLOAT).addIndex(s),this._updateId=-1}get vertexDirtyId(){return this.buffers[0]._updateID}}class _J extends eX{constructor(t,e){const n={uSampler:t,alpha:1,uTextureMatrix:bY.IDENTITY,uColor:new Float32Array([1,1,1,1])};(e=Object.assign({tint:16777215,alpha:1,pluginName:"batch"},e)).uniforms&&Object.assign(n,e.uniforms),super(e.program||JY.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTextureMatrix;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\n}\n","varying vec2 vTextureCoord;\nuniform vec4 uColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void)\n{\n    gl_FragColor = texture2D(uSampler, vTextureCoord) * uColor;\n}\n"),n),this._colorDirty=!1,this.uvMatrix=new FX(t),this.batchable=void 0===e.program,this.pluginName=e.pluginName,this.tint=e.tint,this.alpha=e.alpha}get texture(){return this.uniforms.uSampler}set texture(t){this.uniforms.uSampler!==t&&(!this.uniforms.uSampler.baseTexture.alphaMode!=!t.baseTexture.alphaMode&&(this._colorDirty=!0),this.uniforms.uSampler=t,this.uvMatrix.texture=t)}set alpha(t){t!==this._alpha&&(this._alpha=t,this._colorDirty=!0)}get alpha(){return this._alpha}set tint(t){t!==this._tint&&(this._tint=t,this._tintRGB=(t>>16)+(65280&t)+((255&t)<<16),this._colorDirty=!0)}get tint(){return this._tint}update(){if(this._colorDirty){this._colorDirty=!1;const t=this.texture.baseTexture;g$(this._tint,this._alpha,this.uniforms.uColor,t.alphaMode)}this.uvMatrix.update()&&(this.uniforms.uTextureMatrix=this.uvMatrix.mapCoord)}}class SJ extends wJ{constructor(t=wX.EMPTY,e,n,r,i){const s=new EJ(e,n,r);s.getBuffer("aVertexPosition").static=!1;super(s,new _J(t),null,i),this.autoUpdate=!0}get vertices(){return this.geometry.getBuffer("aVertexPosition").data}set vertices(t){this.geometry.getBuffer("aVertexPosition").data=t}_render(t){this.autoUpdate&&this.geometry.getBuffer("aVertexPosition").update(),super._render(t)}}class TJ{constructor(t,e,n){this.geometry=new oY,this.indexBuffer=null,this.size=n,this.dynamicProperties=[],this.staticProperties=[];for(let r=0;r<t.length;++r){let n=t[r];n={attributeName:n.attributeName,size:n.size,uploadFunction:n.uploadFunction,type:n.type||DW.FLOAT,offset:n.offset},e[r]?this.dynamicProperties.push(n):this.staticProperties.push(n)}this.staticStride=0,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.dynamicStride=0,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this._updateID=0,this.initBuffers()}initBuffers(){const t=this.geometry;let e=0;this.indexBuffer=new tY(function(t,e=null){const n=6*t;if((e=e||new Uint16Array(n)).length!==n)throw new Error(`Out buffer length is incorrect, got ${e.length} and expected ${n}`);for(let r=0,i=0;r<n;r+=6,i+=4)e[r+0]=i+0,e[r+1]=i+1,e[r+2]=i+2,e[r+3]=i+0,e[r+4]=i+2,e[r+5]=i+3;return e}(this.size),!0,!0),t.addIndex(this.indexBuffer),this.dynamicStride=0;for(let s=0;s<this.dynamicProperties.length;++s){const t=this.dynamicProperties[s];t.offset=e,e+=t.size,this.dynamicStride+=t.size}const n=new ArrayBuffer(this.size*this.dynamicStride*4*4);this.dynamicData=new Float32Array(n),this.dynamicDataUint32=new Uint32Array(n),this.dynamicBuffer=new tY(this.dynamicData,!1,!1);let r=0;this.staticStride=0;for(let s=0;s<this.staticProperties.length;++s){const t=this.staticProperties[s];t.offset=r,r+=t.size,this.staticStride+=t.size}const i=new ArrayBuffer(this.size*this.staticStride*4*4);this.staticData=new Float32Array(i),this.staticDataUint32=new Uint32Array(i),this.staticBuffer=new tY(this.staticData,!0,!1);for(let s=0;s<this.dynamicProperties.length;++s){const e=this.dynamicProperties[s];t.addAttribute(e.attributeName,this.dynamicBuffer,0,e.type===DW.UNSIGNED_BYTE,e.type,4*this.dynamicStride,4*e.offset)}for(let s=0;s<this.staticProperties.length;++s){const e=this.staticProperties[s];t.addAttribute(e.attributeName,this.staticBuffer,0,e.type===DW.UNSIGNED_BYTE,e.type,4*this.staticStride,4*e.offset)}}uploadDynamic(t,e,n){for(let r=0;r<this.dynamicProperties.length;r++){const i=this.dynamicProperties[r];i.uploadFunction(t,e,n,i.type===DW.UNSIGNED_BYTE?this.dynamicDataUint32:this.dynamicData,this.dynamicStride,i.offset)}this.dynamicBuffer._updateID++}uploadStatic(t,e,n){for(let r=0;r<this.staticProperties.length;r++){const i=this.staticProperties[r];i.uploadFunction(t,e,n,i.type===DW.UNSIGNED_BYTE?this.staticDataUint32:this.staticData,this.staticStride,i.offset)}this.staticBuffer._updateID++}destroy(){this.indexBuffer=null,this.dynamicProperties=null,this.dynamicBuffer=null,this.dynamicData=null,this.dynamicDataUint32=null,this.staticProperties=null,this.staticBuffer=null,this.staticData=null,this.staticDataUint32=null,this.geometry.destroy()}}class kJ extends iX{constructor(t){super(t),this.shader=null,this.properties=null,this.tempMatrix=new bY,this.properties=[{attributeName:"aVertexPosition",size:2,uploadFunction:this.uploadVertices,offset:0},{attributeName:"aPositionCoord",size:2,uploadFunction:this.uploadPosition,offset:0},{attributeName:"aRotation",size:1,uploadFunction:this.uploadRotation,offset:0},{attributeName:"aTextureCoord",size:2,uploadFunction:this.uploadUvs,offset:0},{attributeName:"aColor",size:1,type:DW.UNSIGNED_BYTE,uploadFunction:this.uploadTint,offset:0}],this.shader=eX.from("attribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\nattribute vec4 aColor;\n\nattribute vec2 aPositionCoord;\nattribute float aRotation;\n\nuniform mat3 translationMatrix;\nuniform vec4 uColor;\n\nvarying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nvoid main(void){\n    float x = (aVertexPosition.x) * cos(aRotation) - (aVertexPosition.y) * sin(aRotation);\n    float y = (aVertexPosition.x) * sin(aRotation) + (aVertexPosition.y) * cos(aRotation);\n\n    vec2 v = vec2(x, y);\n    v = v + aPositionCoord;\n\n    gl_Position = vec4((translationMatrix * vec3(v, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = aTextureCoord;\n    vColor = aColor * uColor;\n}\n","varying vec2 vTextureCoord;\nvarying vec4 vColor;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    vec4 color = texture2D(uSampler, vTextureCoord) * vColor;\n    gl_FragColor = color;\n}",{}),this.state=G$.for2d()}render(t){const e=t.children,n=t._maxSize,r=t._batchSize,i=this.renderer;let s=e.length;if(0===s)return;s>n&&!t.autoResize&&(s=n);let o=t._buffers;o||(o=t._buffers=this.generateBuffers(t));const a=e[0]._texture.baseTexture,l=a.alphaMode>0;this.state.blendMode=p$(t.blendMode,l),i.state.set(this.state);const c=i.gl,h=t.worldTransform.copyTo(this.tempMatrix);var u,d,f,p;h.prepend(i.globalUniforms.uniforms.projectionMatrix),this.shader.uniforms.translationMatrix=h.toArray(!0),this.shader.uniforms.uColor=(u=t.tintRgb,d=t.worldAlpha,f=this.shader.uniforms.uColor,p=l,f=f||new Float32Array(4),p||void 0===p?(f[0]=u[0]*d,f[1]=u[1]*d,f[2]=u[2]*d):(f[0]=u[0],f[1]=u[1],f[2]=u[2]),f[3]=d,f),this.shader.uniforms.uSampler=a,this.renderer.shader.bind(this.shader);let m=!1;for(let g=0,v=0;g<s;g+=r,v+=1){let n=s-g;n>r&&(n=r),v>=o.length&&o.push(this._generateOneMoreBuffer(t));const a=o[v];a.uploadDynamic(e,g,n);const l=t._bufferUpdateIDs[v]||0;m=m||a._updateID<l,m&&(a._updateID=t._updateID,a.uploadStatic(e,g,n)),i.geometry.bind(a.geometry),c.drawElements(c.TRIANGLES,6*n,c.UNSIGNED_SHORT,0)}}generateBuffers(t){const e=[],n=t._maxSize,r=t._batchSize,i=t._properties;for(let s=0;s<n;s+=r)e.push(new TJ(this.properties,i,r));return e}_generateOneMoreBuffer(t){const e=t._batchSize,n=t._properties;return new TJ(this.properties,n,e)}uploadVertices(t,e,n,r,i,s){let o=0,a=0,l=0,c=0;for(let h=0;h<n;++h){const n=t[e+h],u=n._texture,d=n.scale.x,f=n.scale.y,p=u.trim,m=u.orig;p?(a=p.x-n.anchor.x*m.width,o=a+p.width,c=p.y-n.anchor.y*m.height,l=c+p.height):(o=m.width*(1-n.anchor.x),a=m.width*-n.anchor.x,l=m.height*(1-n.anchor.y),c=m.height*-n.anchor.y),r[s]=a*d,r[s+1]=c*f,r[s+i]=o*d,r[s+i+1]=c*f,r[s+2*i]=o*d,r[s+2*i+1]=l*f,r[s+3*i]=a*d,r[s+3*i+1]=l*f,s+=4*i}}uploadPosition(t,e,n,r,i,s){for(let o=0;o<n;o++){const n=t[e+o].position;r[s]=n.x,r[s+1]=n.y,r[s+i]=n.x,r[s+i+1]=n.y,r[s+2*i]=n.x,r[s+2*i+1]=n.y,r[s+3*i]=n.x,r[s+3*i+1]=n.y,s+=4*i}}uploadRotation(t,e,n,r,i,s){for(let o=0;o<n;o++){const n=t[e+o].rotation;r[s]=n,r[s+i]=n,r[s+2*i]=n,r[s+3*i]=n,s+=4*i}}uploadUvs(t,e,n,r,i,s){for(let o=0;o<n;++o){const n=t[e+o]._texture._uvs;n?(r[s]=n.x0,r[s+1]=n.y0,r[s+i]=n.x1,r[s+i+1]=n.y1,r[s+2*i]=n.x2,r[s+2*i+1]=n.y2,r[s+3*i]=n.x3,r[s+3*i+1]=n.y3,s+=4*i):(r[s]=0,r[s+1]=0,r[s+i]=0,r[s+i+1]=0,r[s+2*i]=0,r[s+2*i+1]=0,r[s+3*i]=0,r[s+3*i+1]=0,s+=4*i)}}uploadTint(t,e,n,r,i,s){for(let o=0;o<n;++o){const n=t[e+o],a=n._texture.baseTexture.alphaMode>0,l=n.alpha,c=l<1&&a?m$(n._tintRGB,l):n._tintRGB+(255*l<<24);r[s]=c,r[s+i]=c,r[s+2*i]=c,r[s+3*i]=c,s+=4*i}}destroy(){super.destroy(),this.shader&&(this.shader.destroy(),this.shader=null),this.tempMatrix=null}}kJ.extension={name:"particle",type:F$.RendererPlugin},U$.add(kJ);var AJ=(t=>(t[t.LINEAR_VERTICAL=0]="LINEAR_VERTICAL",t[t.LINEAR_HORIZONTAL=1]="LINEAR_HORIZONTAL",t))(AJ||{});const CJ={willReadFrequently:!0},RJ=class{static get experimentalLetterSpacingSupported(){let t=RJ._experimentalLetterSpacingSupported;if(void 0!==t){const e=WW.ADAPTER.getCanvasRenderingContext2D().prototype;t=RJ._experimentalLetterSpacingSupported="letterSpacing"in e||"textLetterSpacing"in e}return t}constructor(t,e,n,r,i,s,o,a,l){this.text=t,this.style=e,this.width=n,this.height=r,this.lines=i,this.lineWidths=s,this.lineHeight=o,this.maxLineWidth=a,this.fontProperties=l}static measureText(t,e,n,r=RJ._canvas){n=null==n?e.wordWrap:n;const i=e.toFontString(),s=RJ.measureFont(i);0===s.fontSize&&(s.fontSize=e.fontSize,s.ascent=e.fontSize);const o=r.getContext("2d",CJ);o.font=i;const a=(n?RJ.wordWrap(t,e,r):t).split(/(?:\r\n|\r|\n)/),l=new Array(a.length);let c=0;for(let f=0;f<a.length;f++){const t=RJ._measureText(a[f],e.letterSpacing,o);l[f]=t,c=Math.max(c,t)}let h=c+e.strokeThickness;e.dropShadow&&(h+=e.dropShadowDistance);const u=e.lineHeight||s.fontSize+e.strokeThickness;let d=Math.max(u,s.fontSize+2*e.strokeThickness)+(a.length-1)*(u+e.leading);return e.dropShadow&&(d+=e.dropShadowDistance),new RJ(t,e,h,d,a,l,u+e.leading,c,s)}static _measureText(t,e,n){let r=!1;RJ.experimentalLetterSpacingSupported&&(RJ.experimentalLetterSpacing?(n.letterSpacing=`${e}px`,n.textLetterSpacing=`${e}px`,r=!0):(n.letterSpacing="0px",n.textLetterSpacing="0px"));let i=n.measureText(t).width;return i>0&&(r?i-=e:i+=(RJ.graphemeSegmenter(t).length-1)*e),i}static wordWrap(t,e,n=RJ._canvas){const r=n.getContext("2d",CJ);let i=0,s="",o="";const a=Object.create(null),{letterSpacing:l,whiteSpace:c}=e,h=RJ.collapseSpaces(c),u=RJ.collapseNewlines(c);let d=!h;const f=e.wordWrapWidth+l,p=RJ.tokenize(t);for(let m=0;m<p.length;m++){let t=p[m];if(RJ.isNewline(t)){if(!u){o+=RJ.addLine(s),d=!h,s="",i=0;continue}t=" "}if(h){const e=RJ.isBreakingSpace(t),n=RJ.isBreakingSpace(s[s.length-1]);if(e&&n)continue}const n=RJ.getFromCache(t,l,a,r);if(n>f)if(""!==s&&(o+=RJ.addLine(s),s="",i=0),RJ.canBreakWords(t,e.breakWords)){const n=RJ.wordWrapSplit(t);for(let c=0;c<n.length;c++){let h=n[c],u=h,p=1;for(;n[c+p];){const r=n[c+p];if(RJ.canBreakChars(u,r,t,c,e.breakWords))break;h+=r,u=r,p++}c+=p-1;const m=RJ.getFromCache(h,l,a,r);m+i>f&&(o+=RJ.addLine(s),d=!1,s="",i=0),s+=h,i+=m}}else{s.length>0&&(o+=RJ.addLine(s),s="",i=0);const e=m===p.length-1;o+=RJ.addLine(t,!e),d=!1,s="",i=0}else n+i>f&&(d=!1,o+=RJ.addLine(s),s="",i=0),(s.length>0||!RJ.isBreakingSpace(t)||d)&&(s+=t,i+=n)}return o+=RJ.addLine(s,!1),o}static addLine(t,e=!0){return t=RJ.trimRight(t),t=e?`${t}\n`:t}static getFromCache(t,e,n,r){let i=n[t];return"number"!=typeof i&&(i=RJ._measureText(t,e,r)+e,n[t]=i),i}static collapseSpaces(t){return"normal"===t||"pre-line"===t}static collapseNewlines(t){return"normal"===t}static trimRight(t){if("string"!=typeof t)return"";for(let e=t.length-1;e>=0;e--){const n=t[e];if(!RJ.isBreakingSpace(n))break;t=t.slice(0,-1)}return t}static isNewline(t){return"string"==typeof t&&RJ._newlines.includes(t.charCodeAt(0))}static isBreakingSpace(t,e){return"string"==typeof t&&RJ._breakingSpaces.includes(t.charCodeAt(0))}static tokenize(t){const e=[];let n="";if("string"!=typeof t)return e;for(let r=0;r<t.length;r++){const i=t[r],s=t[r+1];RJ.isBreakingSpace(i,s)||RJ.isNewline(i)?(""!==n&&(e.push(n),n=""),e.push(i)):n+=i}return""!==n&&e.push(n),e}static canBreakWords(t,e){return e}static canBreakChars(t,e,n,r,i){return!0}static wordWrapSplit(t){return RJ.graphemeSegmenter(t)}static measureFont(t){if(RJ._fonts[t])return RJ._fonts[t];const e={ascent:0,descent:0,fontSize:0},n=RJ._canvas,r=RJ._context;r.font=t;const i=RJ.METRICS_STRING+RJ.BASELINE_SYMBOL,s=Math.ceil(r.measureText(i).width);let o=Math.ceil(r.measureText(RJ.BASELINE_SYMBOL).width);const a=Math.ceil(RJ.HEIGHT_MULTIPLIER*o);if(o=o*RJ.BASELINE_MULTIPLIER|0,0===s||0===a)return RJ._fonts[t]=e,e;n.width=s,n.height=a,r.fillStyle="#f00",r.fillRect(0,0,s,a),r.font=t,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(i,0,o);const l=r.getImageData(0,0,s,a).data,c=l.length,h=4*s;let u=0,d=0,f=!1;for(u=0;u<o;++u){for(let t=0;t<h;t+=4)if(255!==l[d+t]){f=!0;break}if(f)break;d+=h}for(e.ascent=o-u,d=c-h,f=!1,u=a;u>o;--u){for(let t=0;t<h;t+=4)if(255!==l[d+t]){f=!0;break}if(f)break;d-=h}return e.descent=u-o,e.fontSize=e.ascent+e.descent,RJ._fonts[t]=e,e}static clearMetrics(t=""){t?delete RJ._fonts[t]:RJ._fonts={}}static get _canvas(){if(!RJ.__canvas){let e;try{const t=new OffscreenCanvas(0,0),n=t.getContext("2d",CJ);if(null==n?void 0:n.measureText)return RJ.__canvas=t,t;e=WW.ADAPTER.createCanvas()}catch(t){e=WW.ADAPTER.createCanvas()}e.width=e.height=10,RJ.__canvas=e}return RJ.__canvas}static get _context(){return RJ.__context||(RJ.__context=RJ._canvas.getContext("2d",CJ)),RJ.__context}};let MJ=RJ;MJ.METRICS_STRING="|ÉqÅ",MJ.BASELINE_SYMBOL="M",MJ.BASELINE_MULTIPLIER=1.4,MJ.HEIGHT_MULTIPLIER=2,MJ.graphemeSegmenter=(()=>{if("function"==typeof(null==Intl?void 0:Intl.Segmenter)){const t=new Intl.Segmenter;return e=>[...t.segment(e)].map((t=>t.segment))}return t=>[...t]})(),MJ.experimentalLetterSpacing=!1,MJ._fonts={},MJ._newlines=[10,13],MJ._breakingSpaces=[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288];const IJ=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],DJ=class{constructor(t){this.styleID=0,this.reset(),FJ(this,t,t)}clone(){const t={};return FJ(t,this,DJ.defaultStyle),new DJ(t)}reset(){FJ(this,DJ.defaultStyle,DJ.defaultStyle)}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.styleID++)}get breakWords(){return this._breakWords}set breakWords(t){this._breakWords!==t&&(this._breakWords=t,this.styleID++)}get dropShadow(){return this._dropShadow}set dropShadow(t){this._dropShadow!==t&&(this._dropShadow=t,this.styleID++)}get dropShadowAlpha(){return this._dropShadowAlpha}set dropShadowAlpha(t){this._dropShadowAlpha!==t&&(this._dropShadowAlpha=t,this.styleID++)}get dropShadowAngle(){return this._dropShadowAngle}set dropShadowAngle(t){this._dropShadowAngle!==t&&(this._dropShadowAngle=t,this.styleID++)}get dropShadowBlur(){return this._dropShadowBlur}set dropShadowBlur(t){this._dropShadowBlur!==t&&(this._dropShadowBlur=t,this.styleID++)}get dropShadowColor(){return this._dropShadowColor}set dropShadowColor(t){const e=LJ(t);this._dropShadowColor!==e&&(this._dropShadowColor=e,this.styleID++)}get dropShadowDistance(){return this._dropShadowDistance}set dropShadowDistance(t){this._dropShadowDistance!==t&&(this._dropShadowDistance=t,this.styleID++)}get fill(){return this._fill}set fill(t){const e=LJ(t);this._fill!==e&&(this._fill=e,this.styleID++)}get fillGradientType(){return this._fillGradientType}set fillGradientType(t){this._fillGradientType!==t&&(this._fillGradientType=t,this.styleID++)}get fillGradientStops(){return this._fillGradientStops}set fillGradientStops(t){(function(t,e){if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0})(this._fillGradientStops,t)||(this._fillGradientStops=t,this.styleID++)}get fontFamily(){return this._fontFamily}set fontFamily(t){this.fontFamily!==t&&(this._fontFamily=t,this.styleID++)}get fontSize(){return this._fontSize}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.styleID++)}get fontStyle(){return this._fontStyle}set fontStyle(t){this._fontStyle!==t&&(this._fontStyle=t,this.styleID++)}get fontVariant(){return this._fontVariant}set fontVariant(t){this._fontVariant!==t&&(this._fontVariant=t,this.styleID++)}get fontWeight(){return this._fontWeight}set fontWeight(t){this._fontWeight!==t&&(this._fontWeight=t,this.styleID++)}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.styleID++)}get lineHeight(){return this._lineHeight}set lineHeight(t){this._lineHeight!==t&&(this._lineHeight=t,this.styleID++)}get leading(){return this._leading}set leading(t){this._leading!==t&&(this._leading=t,this.styleID++)}get lineJoin(){return this._lineJoin}set lineJoin(t){this._lineJoin!==t&&(this._lineJoin=t,this.styleID++)}get miterLimit(){return this._miterLimit}set miterLimit(t){this._miterLimit!==t&&(this._miterLimit=t,this.styleID++)}get padding(){return this._padding}set padding(t){this._padding!==t&&(this._padding=t,this.styleID++)}get stroke(){return this._stroke}set stroke(t){const e=LJ(t);this._stroke!==e&&(this._stroke=e,this.styleID++)}get strokeThickness(){return this._strokeThickness}set strokeThickness(t){this._strokeThickness!==t&&(this._strokeThickness=t,this.styleID++)}get textBaseline(){return this._textBaseline}set textBaseline(t){this._textBaseline!==t&&(this._textBaseline=t,this.styleID++)}get trim(){return this._trim}set trim(t){this._trim!==t&&(this._trim=t,this.styleID++)}get whiteSpace(){return this._whiteSpace}set whiteSpace(t){this._whiteSpace!==t&&(this._whiteSpace=t,this.styleID++)}get wordWrap(){return this._wordWrap}set wordWrap(t){this._wordWrap!==t&&(this._wordWrap=t,this.styleID++)}get wordWrapWidth(){return this._wordWrapWidth}set wordWrapWidth(t){this._wordWrapWidth!==t&&(this._wordWrapWidth=t,this.styleID++)}toFontString(){const t="number"==typeof this.fontSize?`${this.fontSize}px`:this.fontSize;let e=this.fontFamily;Array.isArray(this.fontFamily)||(e=this.fontFamily.split(","));for(let n=e.length-1;n>=0;n--){let t=e[n].trim();/([\"\'])[^\'\"]+\1/.test(t)||IJ.includes(t)||(t=`"${t}"`),e[n]=t}return`${this.fontStyle} ${this.fontVariant} ${this.fontWeight} ${t} ${e.join(",")}`}};let OJ=DJ;function PJ(t){return"number"==typeof t?h$(t):("string"==typeof t&&t.startsWith("0x")&&(t=t.replace("0x","#")),t)}function LJ(t){if(Array.isArray(t)){for(let e=0;e<t.length;++e)t[e]=PJ(t[e]);return t}return PJ(t)}function FJ(t,e,n){for(const r in n)Array.isArray(e[r])?t[r]=e[r].slice():t[r]=e[r]}OJ.defaultStyle={align:"left",breakWords:!1,dropShadow:!1,dropShadowAlpha:1,dropShadowAngle:Math.PI/6,dropShadowBlur:0,dropShadowColor:"black",dropShadowDistance:5,fill:"black",fillGradientType:AJ.LINEAR_VERTICAL,fillGradientStops:[],fontFamily:"Arial",fontSize:26,fontStyle:"normal",fontVariant:"normal",fontWeight:"normal",leading:0,letterSpacing:0,lineHeight:0,lineJoin:"miter",miterLimit:10,padding:0,stroke:"black",strokeThickness:0,textBaseline:"alphabetic",trim:!1,whiteSpace:"pre",wordWrap:!1,wordWrapWidth:100};const NJ={texture:!0,children:!1,baseTexture:!0},BJ=class extends Xq{constructor(t,e,n){let r=!1;n||(n=WW.ADAPTER.createCanvas(),r=!0),n.width=3,n.height=3;const i=wX.from(n);i.orig=new pY,i.trim=new pY,super(i),this._ownCanvas=r,this.canvas=n,this.context=n.getContext("2d",{willReadFrequently:!0}),this._resolution=BJ.defaultResolution??WW.RESOLUTION,this._autoResolution=BJ.defaultAutoResolution,this._text=null,this._style=null,this._styleListener=null,this._font="",this.text=t,this.style=e,this.localStyleID=-1}static get experimentalLetterSpacing(){return MJ.experimentalLetterSpacing}static set experimentalLetterSpacing(t){o$(0,"Text.experimentalLetterSpacing is deprecated, use TextMetrics.experimentalLetterSpacing"),MJ.experimentalLetterSpacing=t}updateText(t){const e=this._style;if(this.localStyleID!==e.styleID&&(this.dirty=!0,this.localStyleID=e.styleID),!this.dirty&&t)return;this._font=this._style.toFontString();const n=this.context,r=MJ.measureText(this._text||" ",this._style,this._style.wordWrap,this.canvas),i=r.width,s=r.height,o=r.lines,a=r.lineHeight,l=r.lineWidths,c=r.maxLineWidth,h=r.fontProperties;let u,d;this.canvas.width=Math.ceil(Math.ceil(Math.max(1,i)+2*e.padding)*this._resolution),this.canvas.height=Math.ceil(Math.ceil(Math.max(1,s)+2*e.padding)*this._resolution),n.scale(this._resolution,this._resolution),n.clearRect(0,0,this.canvas.width,this.canvas.height),n.font=this._font,n.lineWidth=e.strokeThickness,n.textBaseline=e.textBaseline,n.lineJoin=e.lineJoin,n.miterLimit=e.miterLimit;const f=e.dropShadow?2:1;for(let p=0;p<f;++p){const t=e.dropShadow&&0===p,i=t?Math.ceil(Math.max(1,s)+2*e.padding):0,f=i*this._resolution;if(t){n.fillStyle="black",n.strokeStyle="black";const t=e.dropShadowColor,r=c$("number"==typeof t?t:u$(t)),i=e.dropShadowBlur*this._resolution,s=e.dropShadowDistance*this._resolution;n.shadowColor=`rgba(${255*r[0]},${255*r[1]},${255*r[2]},${e.dropShadowAlpha})`,n.shadowBlur=i,n.shadowOffsetX=Math.cos(e.dropShadowAngle)*s,n.shadowOffsetY=Math.sin(e.dropShadowAngle)*s+f}else n.fillStyle=this._generateFillStyle(e,o,r),n.strokeStyle=e.stroke,n.shadowColor="black",n.shadowBlur=0,n.shadowOffsetX=0,n.shadowOffsetY=0;let m=(a-h.fontSize)/2;a-h.fontSize<0&&(m=0);for(let n=0;n<o.length;n++)u=e.strokeThickness/2,d=e.strokeThickness/2+n*a+h.ascent+m,"right"===e.align?u+=c-l[n]:"center"===e.align&&(u+=(c-l[n])/2),e.stroke&&e.strokeThickness&&this.drawLetterSpacing(o[n],u+e.padding,d+e.padding-i,!0),e.fill&&this.drawLetterSpacing(o[n],u+e.padding,d+e.padding-i)}this.updateTexture()}drawLetterSpacing(t,e,n,r=!1){const i=this._style.letterSpacing;let s=!1;if(MJ.experimentalLetterSpacingSupported&&(MJ.experimentalLetterSpacing?(this.context.letterSpacing=`${i}px`,this.context.textLetterSpacing=`${i}px`,s=!0):(this.context.letterSpacing="0px",this.context.textLetterSpacing="0px")),0===i||s)return void(r?this.context.strokeText(t,e,n):this.context.fillText(t,e,n));let o=e;const a=MJ.graphemeSegmenter(t);let l=this.context.measureText(t).width,c=0;for(let h=0;h<a.length;++h){const t=a[h];r?this.context.strokeText(t,o,n):this.context.fillText(t,o,n);let e="";for(let n=h+1;n<a.length;++n)e+=a[n];c=this.context.measureText(e).width,o+=l-c+i,l=c}}updateTexture(){const t=this.canvas;if(this._style.trim){const e=O$(t);e.data&&(t.width=e.width,t.height=e.height,this.context.putImageData(e.data,0,0))}const e=this._texture,n=this._style,r=n.trim?0:n.padding,i=e.baseTexture;e.trim.width=e._frame.width=t.width/this._resolution,e.trim.height=e._frame.height=t.height/this._resolution,e.trim.x=-r,e.trim.y=-r,e.orig.width=e._frame.width-2*r,e.orig.height=e._frame.height-2*r,this._onTextureUpdate(),i.setRealSize(t.width,t.height,this._resolution),e.updateUvs(),this.dirty=!1}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0),this.updateText(!0),super._render(t)}updateTransform(){this.updateText(!0),super.updateTransform()}getBounds(t,e){return this.updateText(!0),-1===this._textureID&&(t=!1),super.getBounds(t,e)}getLocalBounds(t){return this.updateText(!0),super.getLocalBounds.call(this,t)}_calculateBounds(){this.calculateVertices(),this._bounds.addQuad(this.vertexData)}_generateFillStyle(t,e,n){const r=t.fill;if(!Array.isArray(r))return r;if(1===r.length)return r[0];let i;const s=t.dropShadow?t.dropShadowDistance:0,o=t.padding||0,a=this.canvas.width/this._resolution-s-2*o,l=this.canvas.height/this._resolution-s-2*o,c=r.slice(),h=t.fillGradientStops.slice();if(!h.length){const t=c.length+1;for(let e=1;e<t;++e)h.push(e/t)}if(c.unshift(r[0]),h.unshift(0),c.push(r[r.length-1]),h.push(1),t.fillGradientType===AJ.LINEAR_VERTICAL){i=this.context.createLinearGradient(a/2,o,a/2,l+o);const r=n.fontProperties.fontSize+t.strokeThickness;for(let t=0;t<e.length;t++){const s=n.lineHeight*(t-1)+r,o=n.lineHeight*t;let a=o;t>0&&s>o&&(a=(o+s)/2);const u=o+r,d=n.lineHeight*(t+1);let f=u;t+1<e.length&&d<u&&(f=(u+d)/2);const p=(f-a)/l;for(let t=0;t<c.length;t++){let e=0;e="number"==typeof h[t]?h[t]:t/c.length;let n=Math.min(1,Math.max(0,a/l+e*p));n=Number(n.toFixed(5)),i.addColorStop(n,c[t])}}}else{i=this.context.createLinearGradient(o,l/2,a+o,l/2);const t=c.length+1;let e=1;for(let n=0;n<c.length;n++){let r;r="number"==typeof h[n]?h[n]:e/t,i.addColorStop(r,c[n]),e++}}return i}destroy(t){"boolean"==typeof t&&(t={children:t}),t=Object.assign({},NJ,t),super.destroy(t),this._ownCanvas&&(this.canvas.height=this.canvas.width=0),this.context=null,this.canvas=null,this._style=null}get width(){return this.updateText(!0),Math.abs(this.scale.x)*this._texture.orig.width}set width(t){this.updateText(!0);const e=E$(this.scale.x)||1;this.scale.x=e*t/this._texture.orig.width,this._width=t}get height(){return this.updateText(!0),Math.abs(this.scale.y)*this._texture.orig.height}set height(t){this.updateText(!0);const e=E$(this.scale.y)||1;this.scale.y=e*t/this._texture.orig.height,this._height=t}get style(){return this._style}set style(t){t=t||{},this._style=t instanceof OJ?t:new OJ(t),this.localStyleID=-1,this.dirty=!0}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}};let UJ=BJ;UJ.defaultAutoResolution=!0;class VJ{constructor(t){this.maxItemsPerFrame=t,this.itemsLeft=0}beginFrame(){this.itemsLeft=this.maxItemsPerFrame}allowedToUpload(){return this.itemsLeft-- >0}}function jJ(t,e){var n;let r=!1;if(null==(n=null==t?void 0:t._textures)?void 0:n.length)for(let i=0;i<t._textures.length;i++)if(t._textures[i]instanceof wX){const n=t._textures[i].baseTexture;e.includes(n)||(e.push(n),r=!0)}return r}function zJ(t,e){if(t.baseTexture instanceof Z$){const n=t.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function GJ(t,e){if(t._texture&&t._texture instanceof wX){const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function WJ(t,e){return e instanceof UJ&&(e.updateText(!0),!0)}function HJ(t,e){if(e instanceof OJ){const t=e.toFontString();return MJ.measureFont(t),!0}return!1}function $J(t,e){if(t instanceof UJ){e.includes(t.style)||e.push(t.style),e.includes(t)||e.push(t);const n=t._texture.baseTexture;return e.includes(n)||e.push(n),!0}return!1}function YJ(t,e){return t instanceof OJ&&(e.includes(t)||e.push(t),!0)}const XJ=class{constructor(t){this.limiter=new VJ(XJ.uploadsPerFrame),this.renderer=t,this.uploadHookHelper=null,this.queue=[],this.addHooks=[],this.uploadHooks=[],this.completes=[],this.ticking=!1,this.delayedTick=()=>{this.queue&&this.prepareItems()},this.registerFindHook($J),this.registerFindHook(YJ),this.registerFindHook(jJ),this.registerFindHook(zJ),this.registerFindHook(GJ),this.registerUploadHook(WJ),this.registerUploadHook(HJ)}upload(t){return new Promise((e=>{t&&this.add(t),this.queue.length?(this.completes.push(e),this.ticking||(this.ticking=!0,wq.system.addOnce(this.tick,this,yq.UTILITY))):e()}))}tick(){setTimeout(this.delayedTick,0)}prepareItems(){for(this.limiter.beginFrame();this.queue.length&&this.limiter.allowedToUpload();){const t=this.queue[0];let e=!1;if(t&&!t._destroyed)for(let n=0,r=this.uploadHooks.length;n<r;n++)if(this.uploadHooks[n](this.uploadHookHelper,t)){this.queue.shift(),e=!0;break}e||this.queue.shift()}if(this.queue.length)wq.system.addOnce(this.tick,this,yq.UTILITY);else{this.ticking=!1;const t=this.completes.slice(0);this.completes.length=0;for(let e=0,n=t.length;e<n;e++)t[e]()}}registerFindHook(t){return t&&this.addHooks.push(t),this}registerUploadHook(t){return t&&this.uploadHooks.push(t),this}add(t){for(let e=0,n=this.addHooks.length;e<n&&!this.addHooks[e](t,this.queue);e++);if(t instanceof Hq)for(let e=t.children.length-1;e>=0;e--)this.add(t.children[e]);return this}destroy(){this.ticking&&wq.system.remove(this.tick,this),this.ticking=!1,this.addHooks=null,this.uploadHooks=null,this.renderer=null,this.completes=null,this.queue=null,this.limiter=null,this.uploadHookHelper=null}};let qJ=XJ;function KJ(t,e){return e instanceof Z$&&(e._glTextures[t.CONTEXT_UID]||t.texture.bind(e),!0)}function ZJ(t,e){if(!(e instanceof gJ))return!1;const{geometry:n}=e;e.finishPoly(),n.updateBatches();const{batches:r}=n;for(let i=0;i<r.length;i++){const{texture:e}=r[i].style;e&&KJ(t,e.baseTexture)}return n.batchable||t.geometry.bind(n,e._resolveDirectShader(t)),!0}function JJ(t,e){return t instanceof gJ&&(e.push(t),!0)}qJ.uploadsPerFrame=4,Object.defineProperties(WW,{UPLOADS_PER_FRAME:{get:()=>qJ.uploadsPerFrame,set(t){o$(0,"settings.UPLOADS_PER_FRAME is deprecated, use prepare.BasePrepare.uploadsPerFrame"),qJ.uploadsPerFrame=t}}});class QJ extends qJ{constructor(t){super(t),this.uploadHookHelper=this.renderer,this.registerFindHook(JJ),this.registerUploadHook(KJ),this.registerUploadHook(ZJ)}}QJ.extension={name:"prepare",type:F$.RendererSystem},U$.add(QJ);var tQ="#version 100\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nattribute vec2 aVertexPosition;\nattribute vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nvarying vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n";const eQ=new bY;class nQ extends iX{constructor(t){super(t),t.runners.contextChange.add(this),this.quad=new TX,this.state=G$.for2d()}contextChange(){const t=this.renderer,e={globals:t.globalUniforms};this.simpleShader=eX.from(tQ,"#version 100\n#define SHADER_NAME Tiling-Sprite-Simple-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\n\nvoid main(void)\n{\n    vec4 texSample = texture2D(uSampler, vTextureCoord);\n    gl_FragColor = texSample * uColor;\n}\n",e),this.shader=t.context.webGLVersion>1?eX.from("#version 300 es\n#define SHADER_NAME Tiling-Sprite-300\n\nprecision lowp float;\n\nin vec2 aVertexPosition;\nin vec2 aTextureCoord;\n\nuniform mat3 projectionMatrix;\nuniform mat3 translationMatrix;\nuniform mat3 uTransform;\n\nout vec2 vTextureCoord;\n\nvoid main(void)\n{\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\n\n    vTextureCoord = (uTransform * vec3(aTextureCoord, 1.0)).xy;\n}\n","#version 300 es\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nin vec2 vTextureCoord;\n\nout vec4 fragmentColor;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    vec4 texSample = texture(uSampler, coord, unclamped == coord ? 0.0f : -32.0f);// lod-bias very negative to force lod 0\n\n    fragmentColor = texSample * uColor;\n}\n",e):eX.from(tQ,"#version 100\n#ifdef GL_EXT_shader_texture_lod\n    #extension GL_EXT_shader_texture_lod : enable\n#endif\n#define SHADER_NAME Tiling-Sprite-100\n\nprecision lowp float;\n\nvarying vec2 vTextureCoord;\n\nuniform sampler2D uSampler;\nuniform vec4 uColor;\nuniform mat3 uMapCoord;\nuniform vec4 uClampFrame;\nuniform vec2 uClampOffset;\n\nvoid main(void)\n{\n    vec2 coord = vTextureCoord + ceil(uClampOffset - vTextureCoord);\n    coord = (uMapCoord * vec3(coord, 1.0)).xy;\n    vec2 unclamped = coord;\n    coord = clamp(coord, uClampFrame.xy, uClampFrame.zw);\n\n    #ifdef GL_EXT_shader_texture_lod\n        vec4 texSample = unclamped == coord\n            ? texture2D(uSampler, coord) \n            : texture2DLodEXT(uSampler, coord, 0);\n    #else\n        vec4 texSample = texture2D(uSampler, coord);\n    #endif\n\n    gl_FragColor = texSample * uColor;\n}\n",e)}render(t){const e=this.renderer,n=this.quad;let r=n.vertices;r[0]=r[6]=t._width*-t.anchor.x,r[1]=r[3]=t._height*-t.anchor.y,r[2]=r[4]=t._width*(1-t.anchor.x),r[5]=r[7]=t._height*(1-t.anchor.y);const i=t.uvRespectAnchor?t.anchor.x:0,s=t.uvRespectAnchor?t.anchor.y:0;r=n.uvs,r[0]=r[6]=-i,r[1]=r[3]=-s,r[2]=r[4]=1-i,r[5]=r[7]=1-s,n.invalidate();const o=t._texture,a=o.baseTexture,l=a.alphaMode>0,c=t.tileTransform.localTransform,h=t.uvMatrix;let u=a.isPowerOfTwo&&o.frame.width===a.width&&o.frame.height===a.height;u&&(a._glTextures[e.CONTEXT_UID]?u=a.wrapMode!==LW.CLAMP:a.wrapMode===LW.CLAMP&&(a.wrapMode=LW.REPEAT));const d=u?this.simpleShader:this.shader,f=o.width,p=o.height,m=t._width,g=t._height;eQ.set(c.a*f/m,c.b*f/g,c.c*p/m,c.d*p/g,c.tx/m,c.ty/g),eQ.invert(),u?eQ.prepend(h.mapCoord):(d.uniforms.uMapCoord=h.mapCoord.toArray(!0),d.uniforms.uClampFrame=h.uClampFrame,d.uniforms.uClampOffset=h.uClampOffset),d.uniforms.uTransform=eQ.toArray(!0),d.uniforms.uColor=g$(t.tint,t.worldAlpha,d.uniforms.uColor,l),d.uniforms.translationMatrix=t.transform.worldTransform.toArray(!0),d.uniforms.uSampler=o,e.shader.bind(d),e.geometry.bind(n),this.state.blendMode=p$(t.blendMode,l),e.state.set(this.state),e.geometry.draw(this.renderer.gl.TRIANGLES,6,0)}}nQ.extension={name:"tilingSprite",type:F$.RendererPlugin},U$.add(nQ);const rQ=class{constructor(t,e,n=null){this.linkedSheets=[],this._texture=t instanceof wX?t:null,this.baseTexture=t instanceof Z$?t:this._texture.baseTexture,this.textures={},this.animations={},this.data=e;const r=this.baseTexture.resource;this.resolution=this._updateResolution(n||(r?r.url:null)),this._frames=this.data.frames,this._frameKeys=Object.keys(this._frames),this._batchIndex=0,this._callback=null}_updateResolution(t=null){const{scale:e}=this.data.meta;let n=L$(t,null);return null===n&&(n=parseFloat(e??"1")),1!==n&&this.baseTexture.setResolution(n),n}parse(){return new Promise((t=>{this._callback=t,this._batchIndex=0,this._frameKeys.length<=rQ.BATCH_SIZE?(this._processFrames(0),this._processAnimations(),this._parseComplete()):this._nextBatch()}))}_processFrames(t){let e=t;const n=rQ.BATCH_SIZE;for(;e-t<n&&e<this._frameKeys.length;){const t=this._frameKeys[e],n=this._frames[t],r=n.frame;if(r){let e=null,i=null;const s=!1!==n.trimmed&&n.sourceSize?n.sourceSize:n.frame,o=new pY(0,0,Math.floor(s.w)/this.resolution,Math.floor(s.h)/this.resolution);e=n.rotated?new pY(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.h)/this.resolution,Math.floor(r.w)/this.resolution):new pY(Math.floor(r.x)/this.resolution,Math.floor(r.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution),!1!==n.trimmed&&n.spriteSourceSize&&(i=new pY(Math.floor(n.spriteSourceSize.x)/this.resolution,Math.floor(n.spriteSourceSize.y)/this.resolution,Math.floor(r.w)/this.resolution,Math.floor(r.h)/this.resolution)),this.textures[t]=new wX(this.baseTexture,e,o,i,n.rotated?2:0,n.anchor),wX.addToCache(this.textures[t],t)}e++}}_processAnimations(){const t=this.data.animations||{};for(const e in t){this.animations[e]=[];for(let n=0;n<t[e].length;n++){const r=t[e][n];this.animations[e].push(this.textures[r])}}}_parseComplete(){const t=this._callback;this._callback=null,this._batchIndex=0,t.call(this,this.textures)}_nextBatch(){this._processFrames(this._batchIndex*rQ.BATCH_SIZE),this._batchIndex++,setTimeout((()=>{this._batchIndex*rQ.BATCH_SIZE<this._frameKeys.length?this._nextBatch():(this._processAnimations(),this._parseComplete())}),0)}destroy(t=!1){var e;for(const n in this.textures)this.textures[n].destroy();this._frames=null,this._frameKeys=null,this.data=null,this.textures=null,t&&(null==(e=this._texture)||e.destroy(),this.baseTexture.destroy()),this._texture=null,this.baseTexture=null,this.linkedSheets=[]}};let iQ=rQ;iQ.BATCH_SIZE=1e3;const sQ=["jpg","png","jpeg","avif","webp"];function oQ(t,e,n){const r={};if(t.forEach((t=>{r[t]=e})),Object.keys(e.textures).forEach((t=>{r[t]=e.textures[t]})),!n){const n=i$.dirname(t[0]);e.linkedSheets.forEach(((t,i)=>{const s=oQ([`${n}/${e.data.meta.related_multi_packs[i]}`],t,!0);Object.assign(r,s)}))}return r}const aQ={extension:F$.Asset,cache:{test:t=>t instanceof iQ,getCacheableAssets:(t,e)=>oQ(t,e,!1)},resolver:{test:t=>{const e=t.split("?")[0].split("."),n=e.pop(),r=e.pop();return"json"===n&&sQ.includes(r)},parse:t=>{var e;const n=t.split(".");return{resolution:parseFloat((null==(e=WW.RETINA_PREFIX.exec(t))?void 0:e[1])??"1"),format:n[n.length-2],src:t}}},loader:{extension:{type:F$.LoadParser,priority:AK.Normal},testParse:async(t,e)=>".json"===i$.extname(e.src).toLowerCase()&&!!t.frames,async parse(t,e,n){var r,i;let s=i$.dirname(e.src);s&&s.lastIndexOf("/")!==s.length-1&&(s+="/");let o=s+t.meta.image;o=wK(o,e.src);const a=(await n.load([o]))[o],l=new iQ(a.baseTexture,t,e.src);await l.parse();const c=null==(r=null==t?void 0:t.meta)?void 0:r.related_multi_packs;if(Array.isArray(c)){const t=[];for(const o of c){if("string"!=typeof o)continue;let r=s+o;(null==(i=e.data)?void 0:i.ignoreMultiPack)||(r=wK(r,e.src),t.push(n.load({src:r,data:{ignoreMultiPack:!0}})))}const r=await Promise.all(t);l.linkedSheets=r,r.forEach((t=>{t.linkedSheets=[l].concat(l.linkedSheets.filter((e=>e!==t)))}))}return l},unload(t){t.destroy(!0)}}};U$.add(aQ);class lQ{constructor(){this.info=[],this.common=[],this.page=[],this.char=[],this.kerning=[],this.distanceField=[]}}class cQ{static test(t){return"string"==typeof t&&t.startsWith("info face=")}static parse(t){const e=t.match(/^[a-z]+\s+.+$/gm),n={info:[],common:[],page:[],char:[],chars:[],kerning:[],kernings:[],distanceField:[]};for(const i in e){const t=e[i].match(/^[a-z]+/gm)[0],r=e[i].match(/[a-zA-Z]+=([^\s"']+|"([^"]*)")/gm),s={};for(const e in r){const t=r[e].split("="),n=t[0],i=t[1].replace(/"/gm,""),o=parseFloat(i),a=isNaN(o)?i:o;s[n]=a}n[t].push(s)}const r=new lQ;return n.info.forEach((t=>r.info.push({face:t.face,size:parseInt(t.size,10)}))),n.common.forEach((t=>r.common.push({lineHeight:parseInt(t.lineHeight,10)}))),n.page.forEach((t=>r.page.push({id:parseInt(t.id,10),file:t.file}))),n.char.forEach((t=>r.char.push({id:parseInt(t.id,10),page:parseInt(t.page,10),x:parseInt(t.x,10),y:parseInt(t.y,10),width:parseInt(t.width,10),height:parseInt(t.height,10),xoffset:parseInt(t.xoffset,10),yoffset:parseInt(t.yoffset,10),xadvance:parseInt(t.xadvance,10)}))),n.kerning.forEach((t=>r.kerning.push({first:parseInt(t.first,10),second:parseInt(t.second,10),amount:parseInt(t.amount,10)}))),n.distanceField.forEach((t=>r.distanceField.push({distanceRange:parseInt(t.distanceRange,10),fieldType:t.fieldType}))),r}}class hQ{static test(t){const e=t;return"getElementsByTagName"in e&&e.getElementsByTagName("page").length&&null!==e.getElementsByTagName("info")[0].getAttribute("face")}static parse(t){const e=new lQ,n=t.getElementsByTagName("info"),r=t.getElementsByTagName("common"),i=t.getElementsByTagName("page"),s=t.getElementsByTagName("char"),o=t.getElementsByTagName("kerning"),a=t.getElementsByTagName("distanceField");for(let l=0;l<n.length;l++)e.info.push({face:n[l].getAttribute("face"),size:parseInt(n[l].getAttribute("size"),10)});for(let l=0;l<r.length;l++)e.common.push({lineHeight:parseInt(r[l].getAttribute("lineHeight"),10)});for(let l=0;l<i.length;l++)e.page.push({id:parseInt(i[l].getAttribute("id"),10)||0,file:i[l].getAttribute("file")});for(let l=0;l<s.length;l++){const t=s[l];e.char.push({id:parseInt(t.getAttribute("id"),10),page:parseInt(t.getAttribute("page"),10)||0,x:parseInt(t.getAttribute("x"),10),y:parseInt(t.getAttribute("y"),10),width:parseInt(t.getAttribute("width"),10),height:parseInt(t.getAttribute("height"),10),xoffset:parseInt(t.getAttribute("xoffset"),10),yoffset:parseInt(t.getAttribute("yoffset"),10),xadvance:parseInt(t.getAttribute("xadvance"),10)})}for(let l=0;l<o.length;l++)e.kerning.push({first:parseInt(o[l].getAttribute("first"),10),second:parseInt(o[l].getAttribute("second"),10),amount:parseInt(o[l].getAttribute("amount"),10)});for(let l=0;l<a.length;l++)e.distanceField.push({fieldType:a[l].getAttribute("fieldType"),distanceRange:parseInt(a[l].getAttribute("distanceRange"),10)});return e}}class uQ{static test(t){return!("string"!=typeof t||!t.includes("<font>"))&&hQ.test(WW.ADAPTER.parseXML(t))}static parse(t){return hQ.parse(WW.ADAPTER.parseXML(t))}}const dQ=[cQ,hQ,uQ];function fQ(t,e,n,r,i,s,o){const a=n.text,l=n.fontProperties;e.translate(r,i),e.scale(s,s);const c=o.strokeThickness/2,h=-o.strokeThickness/2;if(e.font=o.toFontString(),e.lineWidth=o.strokeThickness,e.textBaseline=o.textBaseline,e.lineJoin=o.lineJoin,e.miterLimit=o.miterLimit,e.fillStyle=function(t,e,n,r,i,s){const o=n.fill;if(!Array.isArray(o))return o;if(1===o.length)return o[0];let a;const l=n.dropShadow?n.dropShadowDistance:0,c=n.padding||0,h=t.width/r-l-2*c,u=t.height/r-l-2*c,d=o.slice(),f=n.fillGradientStops.slice();if(!f.length){const t=d.length+1;for(let e=1;e<t;++e)f.push(e/t)}if(d.unshift(o[0]),f.unshift(0),d.push(o[o.length-1]),f.push(1),n.fillGradientType===AJ.LINEAR_VERTICAL){a=e.createLinearGradient(h/2,c,h/2,u+c);let t=0;const r=(s.fontProperties.fontSize+n.strokeThickness)/u;for(let e=0;e<i.length;e++){const n=s.lineHeight*e;for(let e=0;e<d.length;e++){let i=0;i="number"==typeof f[e]?f[e]:e/d.length;const s=n/u+i*r;let o=Math.max(t,s);o=Math.min(o,1),a.addColorStop(o,d[e]),t=o}}}else{a=e.createLinearGradient(c,u/2,h+c,u/2);const t=d.length+1;let n=1;for(let e=0;e<d.length;e++){let r;r="number"==typeof f[e]?f[e]:n/t,a.addColorStop(r,d[e]),n++}}return a}(t,e,o,s,[a],n),e.strokeStyle=o.stroke,o.dropShadow){const t=o.dropShadowColor,n=c$("number"==typeof t?t:u$(t)),r=o.dropShadowBlur*s,i=o.dropShadowDistance*s;e.shadowColor=`rgba(${255*n[0]},${255*n[1]},${255*n[2]},${o.dropShadowAlpha})`,e.shadowBlur=r,e.shadowOffsetX=Math.cos(o.dropShadowAngle)*i,e.shadowOffsetY=Math.sin(o.dropShadowAngle)*i}else e.shadowColor="black",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0;o.stroke&&o.strokeThickness&&e.strokeText(a,c,h+n.lineHeight-l.descent),o.fill&&e.fillText(a,c,h+n.lineHeight-l.descent),e.setTransform(1,0,0,1,0,0),e.fillStyle="rgba(0, 0, 0, 0)"}function pQ(t){return t.codePointAt?t.codePointAt(0):t.charCodeAt(0)}function mQ(t){return Array.from?Array.from(t):t.split("")}const gQ=class{constructor(t,e,n){var r;const[i]=t.info,[s]=t.common,[o]=t.page,[a]=t.distanceField,l=L$(o.file),c={};this._ownsTextures=n,this.font=i.face,this.size=i.size,this.lineHeight=s.lineHeight/l,this.chars={},this.pageTextures=c;for(let h=0;h<t.page.length;h++){const{id:n,file:r}=t.page[h];c[n]=e instanceof Array?e[h]:e[r],(null==a?void 0:a.fieldType)&&"none"!==a.fieldType&&(c[n].baseTexture.alphaMode=NW.NO_PREMULTIPLIED_ALPHA,c[n].baseTexture.mipmap=FW.OFF)}for(let h=0;h<t.char.length;h++){const{id:e,page:n}=t.char[h];let{x:r,y:i,width:s,height:o,xoffset:a,yoffset:u,xadvance:d}=t.char[h];r/=l,i/=l,s/=l,o/=l,a/=l,u/=l,d/=l;const f=new pY(r+c[n].frame.x/l,i+c[n].frame.y/l,s,o);this.chars[e]={xOffset:a,yOffset:u,xAdvance:d,kerning:{},texture:new wX(c[n].baseTexture,f),page:n}}for(let h=0;h<t.kerning.length;h++){let{first:e,second:n,amount:r}=t.kerning[h];e/=l,n/=l,r/=l,this.chars[n]&&(this.chars[n].kerning[e]=r)}this.distanceFieldRange=null==a?void 0:a.distanceRange,this.distanceFieldType=(null==(r=null==a?void 0:a.fieldType)?void 0:r.toLowerCase())??"none"}destroy(){for(const t in this.chars)this.chars[t].texture.destroy(),this.chars[t].texture=null;for(const t in this.pageTextures)this._ownsTextures&&this.pageTextures[t].destroy(!0),this.pageTextures[t]=null;this.chars=null,this.pageTextures=null}static install(t,e,n){let r;if(t instanceof lQ)r=t;else{const e=function(t){for(let e=0;e<dQ.length;e++)if(dQ[e].test(t))return dQ[e];return null}(t);if(!e)throw new Error("Unrecognized data format for font.");r=e.parse(t)}e instanceof wX&&(e=[e]);const i=new gQ(r,e,n);return gQ.available[i.font]=i,i}static uninstall(t){const e=gQ.available[t];if(!e)throw new Error(`No font found named '${t}'`);e.destroy(),delete gQ.available[t]}static from(t,e,n){if(!t)throw new Error("[BitmapFont] Property `name` is required.");const{chars:r,padding:i,resolution:s,textureWidth:o,textureHeight:a,...l}=Object.assign({},gQ.defaultOptions,n),c=function(t){"string"==typeof t&&(t=[t]);const e=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];if(Array.isArray(r)){if(2!==r.length)throw new Error(`[BitmapFont]: Invalid character range length, expecting 2 got ${r.length}.`);const t=r[0].charCodeAt(0),n=r[1].charCodeAt(0);if(n<t)throw new Error("[BitmapFont]: Invalid character range.");for(let r=t,i=n;r<=i;r++)e.push(String.fromCharCode(r))}else e.push(...mQ(r))}if(0===e.length)throw new Error("[BitmapFont]: Empty set when resolving characters.");return e}(r),h=e instanceof OJ?e:new OJ(e),u=o,d=new lQ;d.info[0]={face:h.fontFamily,size:h.fontSize},d.common[0]={lineHeight:h.fontSize};let f,p,m,g=0,v=0,y=0;const b=[];for(let w=0;w<c.length;w++){f||(f=WW.ADAPTER.createCanvas(),f.width=o,f.height=a,p=f.getContext("2d"),m=new Z$(f,{resolution:s,...l}),b.push(new wX(m)),d.page.push({id:b.length-1,file:""}));const t=c[w],e=MJ.measureText(t,h,!1,f),n=e.width,r=Math.ceil(e.height),x=Math.ceil(("italic"===h.fontStyle?2:1)*n);if(v>=a-r*s){if(0===v)throw new Error(`[BitmapFont] textureHeight ${a}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${t}')`);--w,f=null,p=null,m=null,v=0,g=0,y=0;continue}if(y=Math.max(r+e.fontProperties.descent,y),x*s+g>=u){if(0===g)throw new Error(`[BitmapFont] textureWidth ${o}px is too small (fontFamily: '${h.fontFamily}', fontSize: ${h.fontSize}px, char: '${t}')`);--w,v+=y*s,v=Math.ceil(v),g=0,y=0;continue}fQ(f,p,e,g,v,s,h);const E=pQ(e.text);d.char.push({id:E,page:b.length-1,x:g/s,y:v/s,width:x,height:r,xoffset:0,yoffset:0,xadvance:n-(h.dropShadow?h.dropShadowDistance:0)-(h.stroke?h.strokeThickness:0)}),g+=(x+2*i)*s,g=Math.ceil(g)}for(let w=0,E=c.length;w<E;w++){const t=c[w];for(let e=0;e<E;e++){const n=c[e],r=p.measureText(t).width,i=p.measureText(n).width,s=p.measureText(t+n).width-(r+i);s&&d.kerning.push({first:pQ(t),second:pQ(n),amount:s})}}const x=new gQ(d,b,!0);return void 0!==gQ.available[t]&&gQ.uninstall(t),gQ.available[t]=x,x}};let vQ=gQ;vQ.ALPHA=[["a","z"],["A","Z"]," "],vQ.NUMERIC=[["0","9"]],vQ.ALPHANUMERIC=[["a","z"],["A","Z"],["0","9"]," "],vQ.ASCII=[[" ","~"]],vQ.defaultOptions={resolution:1,textureWidth:512,textureHeight:512,padding:4,chars:gQ.ALPHANUMERIC},vQ.available={};const yQ=[],bQ=[],xQ=[],wQ=class extends Hq{constructor(t,e={}){super(),this._tint=16777215;const{align:n,tint:r,maxWidth:i,letterSpacing:s,fontName:o,fontSize:a}=Object.assign({},wQ.styleDefaults,e);if(!vQ.available[o])throw new Error(`Missing BitmapFont "${o}"`);this._activePagesMeshData=[],this._textWidth=0,this._textHeight=0,this._align=n,this._tint=r,this._font=void 0,this._fontName=o,this._fontSize=a,this.text=t,this._maxWidth=i,this._maxLineHeight=0,this._letterSpacing=s,this._anchor=new CY((()=>{this.dirty=!0}),this,0,0),this._roundPixels=WW.ROUND_PIXELS,this.dirty=!0,this._resolution=WW.RESOLUTION,this._autoResolution=!0,this._textureCache={}}updateText(){var t;const e=vQ.available[this._fontName],n=this.fontSize,r=n/e.size,i=new dY,s=[],o=[],a=[],l=mQ(this._text.replace(/(?:\r\n|\r)/g,"\n")||" "),c=this._maxWidth*e.size/n,h="none"===e.distanceFieldType?yQ:bQ;let u=null,d=0,f=0,p=0,m=-1,g=0,v=0,y=0,b=0;for(let k=0;k<l.length;k++){const t=l[k],n=pQ(t);if(/(?:\s)/.test(t)&&(m=k,g=d,b++),"\r"===t||"\n"===t){o.push(d),a.push(-1),f=Math.max(f,d),++p,++v,i.x=0,i.y+=e.lineHeight,u=null,b=0;continue}const r=e.chars[n];if(!r)continue;u&&r.kerning[u]&&(i.x+=r.kerning[u]);const h=xQ.pop()||{texture:wX.EMPTY,line:0,charCode:0,prevSpaces:0,position:new dY};h.texture=r.texture,h.line=p,h.charCode=n,h.position.x=Math.round(i.x+r.xOffset+this._letterSpacing/2),h.position.y=Math.round(i.y+r.yOffset),h.prevSpaces=b,s.push(h),d=h.position.x+Math.max(r.xAdvance-r.xOffset,r.texture.orig.width),i.x+=r.xAdvance+this._letterSpacing,y=Math.max(y,r.yOffset+r.texture.height),u=n,-1!==m&&c>0&&i.x>c&&(++v,w$(s,1+m-v,1+k-m),k=m,m=-1,o.push(g),a.push(s.length>0?s[s.length-1].prevSpaces:0),f=Math.max(f,g),p++,i.x=0,i.y+=e.lineHeight,u=null,b=0)}const x=l[l.length-1];"\r"!==x&&"\n"!==x&&(/(?:\s)/.test(x)&&(d=g),o.push(d),f=Math.max(f,d),a.push(-1));const w=[];for(let k=0;k<=p;k++){let t=0;"right"===this._align?t=f-o[k]:"center"===this._align?t=(f-o[k])/2:"justify"===this._align&&(t=a[k]<0?0:(f-o[k])/a[k]),w.push(t)}const E=s.length,_={},S=[],T=this._activePagesMeshData;h.push(...T);for(let k=0;k<E;k++){const t=s[k].texture,n=t.baseTexture.uid;if(!_[n]){let r=h.pop();if(!r){const t=new EJ;let n,i;"none"===e.distanceFieldType?(n=new _J(wX.EMPTY),i=CW.NORMAL):(n=new _J(wX.EMPTY,{program:JY.from("// Mesh material default fragment\r\nattribute vec2 aVertexPosition;\r\nattribute vec2 aTextureCoord;\r\n\r\nuniform mat3 projectionMatrix;\r\nuniform mat3 translationMatrix;\r\nuniform mat3 uTextureMatrix;\r\n\r\nvarying vec2 vTextureCoord;\r\n\r\nvoid main(void)\r\n{\r\n    gl_Position = vec4((projectionMatrix * translationMatrix * vec3(aVertexPosition, 1.0)).xy, 0.0, 1.0);\r\n\r\n    vTextureCoord = (uTextureMatrix * vec3(aTextureCoord, 1.0)).xy;\r\n}\r\n","// Pixi texture info\r\nvarying vec2 vTextureCoord;\r\nuniform sampler2D uSampler;\r\n\r\n// Tint\r\nuniform vec4 uColor;\r\n\r\n// on 2D applications fwidth is screenScale / glyphAtlasScale * distanceFieldRange\r\nuniform float uFWidth;\r\n\r\nvoid main(void) {\r\n\r\n  // To stack MSDF and SDF we need a non-pre-multiplied-alpha texture.\r\n  vec4 texColor = texture2D(uSampler, vTextureCoord);\r\n\r\n  // MSDF\r\n  float median = texColor.r + texColor.g + texColor.b -\r\n                  min(texColor.r, min(texColor.g, texColor.b)) -\r\n                  max(texColor.r, max(texColor.g, texColor.b));\r\n  // SDF\r\n  median = min(median, texColor.a);\r\n\r\n  float screenPxDistance = uFWidth * (median - 0.5);\r\n  float alpha = clamp(screenPxDistance + 0.5, 0.0, 1.0);\r\n  if (median < 0.01) {\r\n    alpha = 0.0;\r\n  } else if (median > 0.99) {\r\n    alpha = 1.0;\r\n  }\r\n\r\n  // NPM Textures, NPM outputs\r\n  gl_FragColor = vec4(uColor.rgb, uColor.a * alpha);\r\n\r\n}\r\n"),uniforms:{uFWidth:0}}),i=CW.NORMAL_NPM);const s=new wJ(t,n);s.blendMode=i,r={index:0,indexCount:0,vertexCount:0,uvsCount:0,total:0,mesh:s,vertices:null,uvs:null,indices:null}}r.index=0,r.indexCount=0,r.vertexCount=0,r.uvsCount=0,r.total=0;const{_textureCache:i}=this;i[n]=i[n]||new wX(t.baseTexture),r.mesh.texture=i[n],r.mesh.tint=this._tint,S.push(r),_[n]=r}_[n].total++}for(let k=0;k<T.length;k++)S.includes(T[k])||this.removeChild(T[k].mesh);for(let k=0;k<S.length;k++)S[k].mesh.parent!==this&&this.addChild(S[k].mesh);this._activePagesMeshData=S;for(const k in _){const e=_[k],n=e.total;if(!((null==(t=e.indices)?void 0:t.length)>6*n)||e.vertices.length<2*wJ.BATCHABLE_SIZE)e.vertices=new Float32Array(8*n),e.uvs=new Float32Array(8*n),e.indices=new Uint16Array(6*n);else{const t=e.total,n=e.vertices;for(let e=4*t*2;e<n.length;e++)n[e]=0}e.mesh.size=6*n}for(let k=0;k<E;k++){const t=s[k];let e=t.position.x+w[t.line]*("justify"===this._align?t.prevSpaces:1);this._roundPixels&&(e=Math.round(e));const n=e*r,i=t.position.y*r,o=t.texture,a=_[o.baseTexture.uid],l=o.frame,c=o._uvs,h=a.index++;a.indices[6*h+0]=0+4*h,a.indices[6*h+1]=1+4*h,a.indices[6*h+2]=2+4*h,a.indices[6*h+3]=0+4*h,a.indices[6*h+4]=2+4*h,a.indices[6*h+5]=3+4*h,a.vertices[8*h+0]=n,a.vertices[8*h+1]=i,a.vertices[8*h+2]=n+l.width*r,a.vertices[8*h+3]=i,a.vertices[8*h+4]=n+l.width*r,a.vertices[8*h+5]=i+l.height*r,a.vertices[8*h+6]=n,a.vertices[8*h+7]=i+l.height*r,a.uvs[8*h+0]=c.x0,a.uvs[8*h+1]=c.y0,a.uvs[8*h+2]=c.x1,a.uvs[8*h+3]=c.y1,a.uvs[8*h+4]=c.x2,a.uvs[8*h+5]=c.y2,a.uvs[8*h+6]=c.x3,a.uvs[8*h+7]=c.y3}this._textWidth=f*r,this._textHeight=(i.y+e.lineHeight)*r;for(const k in _){const t=_[k];if(0!==this.anchor.x||0!==this.anchor.y){let e=0;const n=this._textWidth*this.anchor.x,r=this._textHeight*this.anchor.y;for(let i=0;i<t.total;i++)t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r,t.vertices[e++]-=n,t.vertices[e++]-=r}this._maxLineHeight=y*r;const e=t.mesh.geometry.getBuffer("aVertexPosition"),n=t.mesh.geometry.getBuffer("aTextureCoord"),i=t.mesh.geometry.getIndex();e.data=t.vertices,n.data=t.uvs,i.data=t.indices,e.update(),n.update(),i.update()}for(let k=0;k<s.length;k++)xQ.push(s[k]);this._font=e,this.dirty=!1}updateTransform(){this.validate(),this.containerUpdateTransform()}_render(t){this._autoResolution&&this._resolution!==t.resolution&&(this._resolution=t.resolution,this.dirty=!0);const{distanceFieldRange:e,distanceFieldType:n,size:r}=vQ.available[this._fontName];if("none"!==n){const{a:n,b:i,c:s,d:o}=this.worldTransform,a=Math.sqrt(n*n+i*i),l=Math.sqrt(s*s+o*o),c=(Math.abs(a)+Math.abs(l))/2,h=this.fontSize/r,u=t._view.resolution;for(const t of this._activePagesMeshData)t.mesh.shader.uniforms.uFWidth=c*e*h*u}super._render(t)}getLocalBounds(){return this.validate(),super.getLocalBounds()}validate(){const t=vQ.available[this._fontName];if(!t)throw new Error(`Missing BitmapFont "${this._fontName}"`);this._font!==t&&(this.dirty=!0),this.dirty&&this.updateText()}get tint(){return this._tint}set tint(t){if(this._tint!==t){this._tint=t;for(let e=0;e<this._activePagesMeshData.length;e++)this._activePagesMeshData[e].mesh.tint=t}}get align(){return this._align}set align(t){this._align!==t&&(this._align=t,this.dirty=!0)}get fontName(){return this._fontName}set fontName(t){if(!vQ.available[t])throw new Error(`Missing BitmapFont "${t}"`);this._fontName!==t&&(this._fontName=t,this.dirty=!0)}get fontSize(){return this._fontSize??vQ.available[this._fontName].size}set fontSize(t){this._fontSize!==t&&(this._fontSize=t,this.dirty=!0)}get anchor(){return this._anchor}set anchor(t){"number"==typeof t?this._anchor.set(t):this._anchor.copyFrom(t)}get text(){return this._text}set text(t){t=String(null==t?"":t),this._text!==t&&(this._text=t,this.dirty=!0)}get maxWidth(){return this._maxWidth}set maxWidth(t){this._maxWidth!==t&&(this._maxWidth=t,this.dirty=!0)}get maxLineHeight(){return this.validate(),this._maxLineHeight}get textWidth(){return this.validate(),this._textWidth}get letterSpacing(){return this._letterSpacing}set letterSpacing(t){this._letterSpacing!==t&&(this._letterSpacing=t,this.dirty=!0)}get roundPixels(){return this._roundPixels}set roundPixels(t){t!==this._roundPixels&&(this._roundPixels=t,this.dirty=!0)}get textHeight(){return this.validate(),this._textHeight}get resolution(){return this._resolution}set resolution(t){this._autoResolution=!1,this._resolution!==t&&(this._resolution=t,this.dirty=!0)}destroy(t){const{_textureCache:e}=this,n="none"===vQ.available[this._fontName].distanceFieldType?yQ:bQ;n.push(...this._activePagesMeshData);for(const r of this._activePagesMeshData)this.removeChild(r.mesh);this._activePagesMeshData=[],n.filter((t=>e[t.mesh.texture.baseTexture.uid])).forEach((t=>{t.mesh.texture=wX.EMPTY}));for(const r in e){e[r].destroy(),delete e[r]}this._font=null,this._textureCache=null,super.destroy(t)}};wQ.styleDefaults={align:"left",tint:16777215,maxWidth:0,letterSpacing:0};const EQ=[".xml",".fnt"],_Q={extension:{type:F$.LoadParser,priority:AK.Normal},test:t=>EQ.includes(i$.extname(t).toLowerCase()),testParse:async t=>cQ.test(t)||uQ.test(t),async parse(t,e,n){const r=cQ.test(t)?cQ.parse(t):uQ.parse(t),{src:i}=e,{page:s}=r,o=[];for(let c=0;c<s.length;++c){const t=s[c].file;let e=i$.join(i$.dirname(i),t);e=wK(e,i),o.push(e)}const a=await n.load(o),l=o.map((t=>a[t]));return vQ.install(r,l,!0)},load:async(t,e)=>(await WW.ADAPTER.fetch(t)).text(),unload(t){t.destroy()}};U$.add(_Q);const SQ={vec3(t,e,n,r){(n[0]!==r[0]||n[1]!==r[1]||n[2]!==r[2])&&(n[0]=r[0],n[1]=r[1],n[2]=r[2],t.uniform3f(e,r[0],r[1],r[2]))},int(t,e,n,r){t.uniform1i(e,r)},ivec2(t,e,n,r){t.uniform2i(e,r[0],r[1])},ivec3(t,e,n,r){t.uniform3i(e,r[0],r[1],r[2])},ivec4(t,e,n,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},uint(t,e,n,r){t.uniform1ui(e,r)},uvec2(t,e,n,r){t.uniform2ui(e,r[0],r[1])},uvec3(t,e,n,r){t.uniform3ui(e,r[0],r[1],r[2])},uvec4(t,e,n,r){t.uniform4ui(e,r[0],r[1],r[2],r[3])},bvec2(t,e,n,r){t.uniform2i(e,r[0],r[1])},bvec3(t,e,n,r){t.uniform3i(e,r[0],r[1],r[2])},bvec4(t,e,n,r){t.uniform4i(e,r[0],r[1],r[2],r[3])},mat2(t,e,n,r){t.uniformMatrix2fv(e,!1,r)},mat4(t,e,n,r){t.uniformMatrix4fv(e,!1,r)}},TQ={float(t,e,n,r){t.uniform1fv(e,r)},vec2(t,e,n,r){t.uniform2fv(e,r)},vec3(t,e,n,r){t.uniform3fv(e,r)},vec4(t,e,n,r){t.uniform4fv(e,r)},int(t,e,n,r){t.uniform1iv(e,r)},ivec2(t,e,n,r){t.uniform2iv(e,r)},ivec3(t,e,n,r){t.uniform3iv(e,r)},ivec4(t,e,n,r){t.uniform4iv(e,r)},uint(t,e,n,r){t.uniform1uiv(e,r)},uvec2(t,e,n,r){t.uniform2uiv(e,r)},uvec3(t,e,n,r){t.uniform3uiv(e,r)},uvec4(t,e,n,r){t.uniform4uiv(e,r)},bool(t,e,n,r){t.uniform1iv(e,r)},bvec2(t,e,n,r){t.uniform2iv(e,r)},bvec3(t,e,n,r){t.uniform3iv(e,r)},bvec4(t,e,n,r){t.uniform4iv(e,r)},sampler2D(t,e,n,r){t.uniform1iv(e,r)},samplerCube(t,e,n,r){t.uniform1iv(e,r)},sampler2DArray(t,e,n,r){t.uniform1iv(e,r)}};Object.assign(aq.prototype,{systemCheck(){},syncUniforms(t,e){const{shader:n,renderer:r}=this;!function(t,e,n,r,i){let s=0,o=null,a=null;const l=i.gl;for(const c in t.uniforms){const h=e[c],u=r[c],d=n[c],f=t.uniforms[c];h?"float"!==h.type||1!==h.size||h.isArray?"bool"!==h.type||1!==h.size||h.isArray?"sampler2D"!==h.type&&"samplerCube"!==h.type&&"sampler2DArray"!==h.type||1!==h.size||h.isArray?"mat3"!==h.type||1!==h.size||h.isArray?"vec2"!==h.type||1!==h.size||h.isArray?"vec4"!==h.type||1!==h.size||h.isArray?(1!==h.size||h.isArray?TQ:SQ)[h.type].call(null,l,d.location,d.value,u):void 0!==f.width?(a=d.value,o=u,(a[0]!==o.x||a[1]!==o.y||a[2]!==o.width||a[3]!==o.height)&&(a[0]=o.x,a[1]=o.y,a[2]=o.width,a[3]=o.height,l.uniform4f(d.location,o.x,o.y,o.width,o.height))):(a=d.value,o=u,(a[0]!==o[0]||a[1]!==o[1]||a[2]!==o[2]||a[3]!==o[3])&&(a[0]=o[0],a[1]=o[1],a[2]=o[2],a[3]=o[3],l.uniform4f(d.location,o[0],o[1],o[2],o[3]))):void 0!==f.x?(a=d.value,o=u,(a[0]!==o.x||a[1]!==o.y)&&(a[0]=o.x,a[1]=o.y,l.uniform2f(d.location,o.x,o.y))):(a=d.value,o=u,(a[0]!==o[0]||a[1]!==o[1])&&(a[0]=o[0],a[1]=o[1],l.uniform2f(d.location,o[0],o[1]))):void 0!==f.a?l.uniformMatrix3fv(d.location,!1,u.toArray(!0)):l.uniformMatrix3fv(d.location,!1,u):(i.texture.bind(u,s),d.value!==s&&(d.value=s,l.uniform1i(d.location,s)),s++):u!==d.value&&(d.value=u,l.uniform1i(d.location,Number(u))):u!==d.value&&(d.value=u,l.uniform1f(d.location,u)):!0===f.group&&i.shader.syncUniformGroup(u)}}(t,n.program.uniformData,e.uniformData,t.uniforms,r)}});var kQ=(t=>(t[t.Region=0]="Region",t[t.BoundingBox=1]="BoundingBox",t[t.Mesh=2]="Mesh",t[t.LinkedMesh=3]="LinkedMesh",t[t.Path=4]="Path",t[t.Point=5]="Point",t[t.Clipping=6]="Clipping",t))(kQ||{});class AQ{constructor(t,e=new Array,n=0,r=new DataView(t.buffer)){this.strings=e,this.index=n,this.buffer=r}readByte(){return this.buffer.getInt8(this.index++)}readUnsignedByte(){return this.buffer.getUint8(this.index++)}readShort(){const t=this.buffer.getInt16(this.index);return this.index+=2,t}readInt32(){const t=this.buffer.getInt32(this.index);return this.index+=4,t}readInt(t){let e=this.readByte(),n=127&e;return 0!=(128&e)&&(e=this.readByte(),n|=(127&e)<<7,0!=(128&e)&&(e=this.readByte(),n|=(127&e)<<14,0!=(128&e)&&(e=this.readByte(),n|=(127&e)<<21,0!=(128&e)&&(e=this.readByte(),n|=(127&e)<<28)))),t?n:n>>>1^-(1&n)}readStringRef(){const t=this.readInt(!0);return 0==t?null:this.strings[t-1]}readString(){let t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;let e="";for(let n=0;n<t;){const t=this.readUnsignedByte();switch(t>>4){case 12:case 13:e+=String.fromCharCode((31&t)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&t)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(t),n++}}return e}readFloat(){const t=this.buffer.getFloat32(this.index);return this.index+=4,t}readBoolean(){return 0!=this.readByte()}}var CQ=(t=>(t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add",t))(CQ||{}),RQ=(t=>(t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut",t))(RQ||{}),MQ=(t=>(t[t.Fixed=0]="Fixed",t[t.Percent=1]="Percent",t))(MQ||{}),IQ=(t=>(t[t.Tangent=0]="Tangent",t[t.Chain=1]="Chain",t[t.ChainScale=2]="ChainScale",t))(IQ||{}),DQ=(t=>(t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection",t))(DQ||{});function OQ(t){switch(t.toLowerCase()){case"nearest":return PQ.Nearest;case"linear":return PQ.Linear;case"mipmap":return PQ.MipMap;case"mipmapnearestnearest":return PQ.MipMapNearestNearest;case"mipmaplinearnearest":return PQ.MipMapLinearNearest;case"mipmapnearestlinear":return PQ.MipMapNearestLinear;case"mipmaplinearlinear":return PQ.MipMapLinearLinear;default:throw new Error(`Unknown texture filter ${t}`)}}var PQ=(t=>(t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear",t))(PQ||{}),LQ=(t=>(t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat",t))(LQ||{});class FQ{constructor(){this.size=null,this.names=null,this.values=null,this.renderObject=null}get width(){const t=this.texture;return t.trim?t.trim.width:t.orig.width}get height(){const t=this.texture;return t.trim?t.trim.height:t.orig.height}get u(){return this.texture._uvs.x0}get v(){return this.texture._uvs.y0}get u2(){return this.texture._uvs.x2}get v2(){return this.texture._uvs.y2}get offsetX(){const t=this.texture;return t.trim?t.trim.x:0}get offsetY(){return this.spineOffsetY}get pixiOffsetY(){const t=this.texture;return t.trim?t.trim.y:0}get spineOffsetY(){const t=this.texture;return this.originalHeight-this.height-(t.trim?t.trim.y:0)}get originalWidth(){return this.texture.orig.width}get originalHeight(){return this.texture.orig.height}get x(){return this.texture.frame.x}get y(){return this.texture.frame.y}get rotate(){return 0!==this.texture.rotate}get degrees(){return(360-45*this.texture.rotate)%360}}class NQ{constructor(){this.x=0,this.y=0,this.width=0,this.height=0,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0,this.rotate=0,this.index=0}}class BQ{constructor(t,e,n){this.pages=new Array,this.regions=new Array,t&&this.addSpineAtlas(t,e,n)}addTexture(t,e){const n=this.pages;let r=null;for(let s=0;s<n.length;s++)if(n[s].baseTexture===e.baseTexture){r=n[s];break}if(null===r){r=new VQ,r.name="texturePage";const t=e.baseTexture;r.width=t.realWidth,r.height=t.realHeight,r.baseTexture=t,r.minFilter=r.magFilter=PQ.Nearest,r.uWrap=LQ.ClampToEdge,r.vWrap=LQ.ClampToEdge,n.push(r)}const i=new jQ;return i.name=t,i.page=r,i.texture=e,i.index=-1,this.regions.push(i),i}addTextureHash(t,e){for(const n in t)t.hasOwnProperty(n)&&this.addTexture(e&&-1!==n.indexOf(".")?n.substr(0,n.lastIndexOf(".")):n,t[n])}addSpineAtlas(t,e,n){return this.load(t,e,n)}load(t,e,n){if(null==e)throw new Error("textureLoader cannot be null.");const r=new UQ(t),i=new Array(4);let s=null;const o={};let a=null;o.size=()=>{s.width=parseInt(i[1]),s.height=parseInt(i[2])},o.format=()=>{},o.filter=()=>{s.minFilter=OQ(i[1]),s.magFilter=OQ(i[2])},o.repeat=()=>{-1!=i[1].indexOf("x")&&(s.uWrap=LQ.Repeat),-1!=i[1].indexOf("y")&&(s.vWrap=LQ.Repeat)},o.pma=()=>{s.pma="true"==i[1]};const l={xy:()=>{a.x=parseInt(i[1]),a.y=parseInt(i[2])},size:()=>{a.width=parseInt(i[1]),a.height=parseInt(i[2])},bounds:()=>{a.x=parseInt(i[1]),a.y=parseInt(i[2]),a.width=parseInt(i[3]),a.height=parseInt(i[4])},offset:()=>{a.offsetX=parseInt(i[1]),a.offsetY=parseInt(i[2])},orig:()=>{a.originalWidth=parseInt(i[1]),a.originalHeight=parseInt(i[2])},offsets:()=>{a.offsetX=parseInt(i[1]),a.offsetY=parseInt(i[2]),a.originalWidth=parseInt(i[3]),a.originalHeight=parseInt(i[4])},rotate:()=>{const t=i[1];let e=0;e="true"==t.toLocaleLowerCase()?6:"false"==t.toLocaleLowerCase()?0:(720-parseFloat(t))%360/45,a.rotate=e},index:()=>{a.index=parseInt(i[1])}};let c=r.readLine();for(;null!=c&&0==c.trim().length;)c=r.readLine();for(;null!=c&&0!=c.trim().length&&0!=r.readEntry(i,c);)c=r.readLine();const h=()=>{for(;;){if(null==c)return n&&n(this);if(0==c.trim().length)s=null,c=r.readLine();else{if(null===s){for(s=new VQ,s.name=c.trim();0!=r.readEntry(i,c=r.readLine());){const t=o[i[0]];t&&t()}this.pages.push(s),e(s.name,(t=>{if(null===t)return this.pages.splice(this.pages.indexOf(s),1),n&&n(null);s.baseTexture=t,s.pma&&(t.alphaMode=NW.PMA),t.valid||t.setSize(s.width,s.height),s.setFilters(),s.width&&s.height||(s.width=t.realWidth,s.height=t.realHeight,!s.width||s.height),h()}));break}{a=new NQ;const t=new jQ;t.name=c,t.page=s;let e=null,n=null;for(;;){const t=r.readEntry(i,c=r.readLine());if(0==t)break;const s=l[i[0]];if(s)s();else{null==e&&(e=[],n=[]),e.push(i[0]);const r=[];for(let e=0;e<t;e++)r.push(parseInt(i[e+1]));n.push(r)}}0==a.originalWidth&&0==a.originalHeight&&(a.originalWidth=a.width,a.originalHeight=a.height);const o=s.baseTexture.resolution;a.x/=o,a.y/=o,a.width/=o,a.height/=o,a.originalWidth/=o,a.originalHeight/=o,a.offsetX/=o,a.offsetY/=o;const h=a.rotate%4!=0,u=new pY(a.x,a.y,h?a.height:a.width,h?a.width:a.height),d=new pY(0,0,a.originalWidth,a.originalHeight),f=new pY(a.offsetX,a.originalHeight-a.height-a.offsetY,a.width,a.height);t.texture=new wX(t.page.baseTexture,u,d,f,a.rotate),t.index=a.index,t.texture.updateUvs(),this.regions.push(t)}}}};h()}findRegion(t){for(let e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null}dispose(){for(let t=0;t<this.pages.length;t++)this.pages[t].baseTexture.dispose()}}class UQ{constructor(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}readLine(){return this.index>=this.lines.length?null:this.lines[this.index++]}readEntry(t,e){if(null==e)return 0;if(0==(e=e.trim()).length)return 0;const n=e.indexOf(":");if(-1==n)return 0;t[0]=e.substr(0,n).trim();for(let r=1,i=n+1;;r++){const n=e.indexOf(",",i);if(-1==n)return t[r]=e.substr(i).trim(),r;if(t[r]=e.substr(i,n-i).trim(),i=n+1,4==r)return 4}}}class VQ{constructor(){this.minFilter=PQ.Nearest,this.magFilter=PQ.Nearest,this.uWrap=LQ.ClampToEdge,this.vWrap=LQ.ClampToEdge}setFilters(){const t=this.baseTexture,e=this.minFilter;e==PQ.Linear?t.scaleMode=PW.LINEAR:this.minFilter==PQ.Nearest?t.scaleMode=PW.NEAREST:(t.mipmap=FW.POW2,e==PQ.MipMapNearestNearest?t.scaleMode=PW.NEAREST:t.scaleMode=PW.LINEAR)}}class jQ extends FQ{}class zQ{constructor(){this.array=new Array}add(t){const e=this.contains(t);return this.array[0|t]=0|t,!e}contains(t){return null!=this.array[0|t]}remove(t){this.array[0|t]=void 0}clear(){this.array.length=0}}class GQ{constructor(){this.entries={},this.size=0}add(t){const e=this.entries[t];return this.entries[t]=!0,!e&&(this.size++,!0)}addAll(t){const e=this.size;for(let n=0,r=t.length;n<r;n++)this.add(t[n]);return e!=this.size}contains(t){return this.entries[t]}clear(){this.entries={},this.size=0}}const WQ=class{constructor(t=0,e=0,n=0,r=0){this.r=t,this.g=e,this.b=n,this.a=r}set(t,e,n,r){return this.r=t,this.g=e,this.b=n,this.a=r,this.clamp()}setFromColor(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this}setFromString(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=8!=t.length?1:parseInt(t.substr(6,2),16)/255,this}add(t,e,n,r){return this.r+=t,this.g+=e,this.b+=n,this.a+=r,this.clamp()}clamp(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this}static rgba8888ToColor(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255}static rgb888ToColor(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255}static fromString(t){return(new WQ).setFromString(t)}};let HQ=WQ;HQ.WHITE=new WQ(1,1,1,1),HQ.RED=new WQ(1,0,0,1),HQ.GREEN=new WQ(0,1,0,1),HQ.BLUE=new WQ(0,0,1,1),HQ.MAGENTA=new WQ(1,0,1,1);const $Q=class{static clamp(t,e,n){return t<e?e:t>n?n:t}static cosDeg(t){return Math.cos(t*$Q.degRad)}static sinDeg(t){return Math.sin(t*$Q.degRad)}static signum(t){return Math.sign(t)}static toInt(t){return t>0?Math.floor(t):Math.ceil(t)}static cbrt(t){const e=Math.pow(Math.abs(t),1/3);return t<0?-e:e}static randomTriangular(t,e){return $Q.randomTriangularWith(t,e,.5*(t+e))}static randomTriangularWith(t,e,n){const r=Math.random(),i=e-t;return r<=(n-t)/i?t+Math.sqrt(r*i*(n-t)):e-Math.sqrt((1-r)*i*(e-n))}static isPowerOfTwo(t){return t&&0==(t&t-1)}};let YQ=$Q;YQ.PI=3.1415927,YQ.PI2=2*$Q.PI,YQ.radiansToDegrees=180/$Q.PI,YQ.radDeg=$Q.radiansToDegrees,YQ.degreesToRadians=$Q.PI/180,YQ.degRad=$Q.degreesToRadians;class XQ{apply(t,e,n){return t+(e-t)*this.applyInternal(n)}}class qQ extends XQ{constructor(t){super(),this.power=2,this.power=t}applyInternal(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1}}class KQ extends qQ{applyInternal(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1}}const ZQ=class{static arrayCopy(t,e,n,r,i){for(let s=e,o=r;s<e+i;s++,o++)n[o]=t[s]}static arrayFill(t,e,n,r){for(let i=e;i<n;i++)t[i]=r}static setArraySize(t,e,n=0){const r=t.length;if(r==e)return t;if(t.length=e,r<e)for(let i=r;i<e;i++)t[i]=n;return t}static ensureArrayCapacity(t,e,n=0){return t.length>=e?t:ZQ.setArraySize(t,e,n)}static newArray(t,e){const n=new Array(t);for(let r=0;r<t;r++)n[r]=e;return n}static newFloatArray(t){if(ZQ.SUPPORTS_TYPED_ARRAYS)return new Float32Array(t);const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=0;return e}static newShortArray(t){if(ZQ.SUPPORTS_TYPED_ARRAYS)return new Int16Array(t);const e=new Array(t);for(let n=0;n<e.length;n++)e[n]=0;return e}static toFloatArray(t){return ZQ.SUPPORTS_TYPED_ARRAYS?new Float32Array(t):t}static toSinglePrecision(t){return ZQ.SUPPORTS_TYPED_ARRAYS?Math.fround(t):t}static webkit602BugfixHelper(t,e){}static contains(t,e,n=!0){for(let r=0;r<t.length;r++)if(t[r]==e)return!0;return!1}static enumValue(t,e){return t[e[0].toUpperCase()+e.slice(1)]}};let JQ=ZQ;JQ.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array;class QQ{constructor(t){this.items=new Array,this.instantiator=t}obtain(){return this.items.length>0?this.items.pop():this.instantiator()}free(t){t.reset&&t.reset(),this.items.push(t)}freeAll(t){for(let e=0;e<t.length;e++)this.free(t[e])}clear(){this.items.length=0}}class t0{constructor(t=0,e=0){this.x=t,this.y=e}set(t,e){return this.x=t,this.y=e,this}length(){const t=this.x,e=this.y;return Math.sqrt(t*t+e*e)}normalize(){const t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this}}class e0{constructor(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new QQ((()=>JQ.newFloatArray(16)))}update(t,e){if(!t)throw new Error("skeleton cannot be null.");const n=this.boundingBoxes,r=this.polygons,i=this.polygonPool,s=t.slots,o=s.length;n.length=0,i.freeAll(r),r.length=0;for(let a=0;a<o;a++){const t=s[a];if(!t.bone.active)continue;const e=t.getAttachment();if(null!=e&&e.type===kQ.BoundingBox){const s=e;n.push(s);let o=i.obtain();o.length!=s.worldVerticesLength&&(o=JQ.newFloatArray(s.worldVerticesLength)),r.push(o),s.computeWorldVertices(t,0,s.worldVerticesLength,o,0,2)}}e?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)}aabbCompute(){let t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,r=Number.NEGATIVE_INFINITY;const i=this.polygons;for(let s=0,o=i.length;s<o;s++){const o=i[s],a=o;for(let i=0,s=o.length;i<s;i+=2){const s=a[i],o=a[i+1];t=Math.min(t,s),e=Math.min(e,o),n=Math.max(n,s),r=Math.max(r,o)}}this.minX=t,this.minY=e,this.maxX=n,this.maxY=r}aabbContainsPoint(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY}aabbIntersectsSegment(t,e,n,r){const i=this.minX,s=this.minY,o=this.maxX,a=this.maxY;if(t<=i&&n<=i||e<=s&&r<=s||t>=o&&n>=o||e>=a&&r>=a)return!1;const l=(r-e)/(n-t);let c=l*(i-t)+e;if(c>s&&c<a)return!0;if(c=l*(o-t)+e,c>s&&c<a)return!0;let h=(s-e)/l+t;return h>i&&h<o||(h=(a-e)/l+t,h>i&&h<o)}aabbIntersectsSkeleton(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY}containsPoint(t,e){const n=this.polygons;for(let r=0,i=n.length;r<i;r++)if(this.containsPointPolygon(n[r],t,e))return this.boundingBoxes[r];return null}containsPointPolygon(t,e,n){const r=t,i=t.length;let s=i-2,o=!1;for(let a=0;a<i;a+=2){const t=r[a+1],i=r[s+1];if(t<n&&i>=n||i<n&&t>=n){const l=r[a];l+(n-t)/(i-t)*(r[s]-l)<e&&(o=!o)}s=a}return o}intersectsSegment(t,e,n,r){const i=this.polygons;for(let s=0,o=i.length;s<o;s++)if(this.intersectsSegmentPolygon(i[s],t,e,n,r))return this.boundingBoxes[s];return null}intersectsSegmentPolygon(t,e,n,r,i){const s=t,o=t.length,a=e-r,l=n-i,c=e*i-n*r;let h=s[o-2],u=s[o-1];for(let d=0;d<o;d+=2){const t=s[d],o=s[d+1],f=h*o-u*t,p=h-t,m=u-o,g=a*m-l*p,v=(c*p-a*f)/g;if((v>=h&&v<=t||v>=t&&v<=h)&&(v>=e&&v<=r||v>=r&&v<=e)){const t=(c*m-l*f)/g;if((t>=u&&t<=o||t>=o&&t<=u)&&(t>=n&&t<=i||t>=i&&t<=n))return!0}h=t,u=o}return!1}getPolygon(t){if(!t)throw new Error("boundingBox cannot be null.");const e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]}getWidth(){return this.maxX-this.minX}getHeight(){return this.maxY-this.minY}}const n0=0,r0=[0,0,0];class i0 extends Xq{constructor(){super(...arguments),this.region=null,this.attachment=null}}class s0 extends SJ{constructor(t,e,n,r,i){super(t,e,n,r,i),this.region=null,this.attachment=null}}const o0=class extends Hq{constructor(t){if(super(),!t)throw new Error("The spineData param is required.");if("string"==typeof t)throw new Error('spineData param cant be string. Please use spine.Spine.fromAtlas("YOUR_RESOURCE_NAME") from now on.');this.spineData=t,this.createSkeleton(t),this.slotContainers=[],this.tempClipContainers=[];for(let e=0,n=this.skeleton.slots.length;e<n;e++){const t=this.skeleton.slots[e],n=t.getAttachment(),r=this.newContainer();if(this.slotContainers.push(r),this.addChild(r),this.tempClipContainers.push(null),n)if(n.type===kQ.Region){const e=n.name,i=this.createSprite(t,n,e);t.currentSprite=i,t.currentSpriteName=e,r.addChild(i)}else if(n.type===kQ.Mesh){const e=this.createMesh(t,n);t.currentMesh=e,t.currentMeshId=n.id,t.currentMeshName=n.name,r.addChild(e)}else n.type===kQ.Clipping&&(this.createGraphics(t,n),r.addChild(t.clippingContainer),r.addChild(t.currentGraphics))}this.tintRgb=new Float32Array([1,1,1]),this.autoUpdate=!0,this.visible=!0}get debug(){return this._debug}set debug(t){var e;t!=this._debug&&(null==(e=this._debug)||e.unregisterSpine(this),null==t||t.registerSpine(this),this._debug=t)}get autoUpdate(){return this._autoUpdate}set autoUpdate(t){t!==this._autoUpdate&&(this._autoUpdate=t,this.updateTransform=t?o0.prototype.autoUpdateTransform:Hq.prototype.updateTransform)}get tint(){return d$(this.tintRgb)}set tint(t){this.tintRgb=c$(t,this.tintRgb)}get delayLimit(){return(void 0!==this.localDelayLimit?this.localDelayLimit:n0)||Number.MAX_VALUE}update(t){var e;const n=this.delayLimit;if(t>n&&(t=n),this.state.update(t),this.state.apply(this.skeleton),!this.skeleton)return;this.skeleton.updateWorldTransform();const r=this.skeleton.slots,i=this.color;let s=null,o=null;i?(s=i.light,o=i.dark):s=this.tintRgb;for(let h=0,u=r.length;h<u;h++){const t=r[h],e=t.getAttachment(),n=this.slotContainers[h];if(!e){n.visible=!1;continue}let i=null;e.sequence&&e.sequence.apply(t,e);let a=e.region;const l=e.color;switch(null!=e&&e.type){case kQ.Region:if(n.transform.setFromMatrix(t.bone.matrix),a=e.region,t.currentMesh&&(t.currentMesh.visible=!1,t.currentMesh=null,t.currentMeshId=void 0,t.currentMeshName=void 0),!a){t.currentSprite&&(t.currentSprite.renderable=!1);break}if(!t.currentSpriteName||t.currentSpriteName!==e.name){const r=e.name;if(t.currentSprite&&(t.currentSprite.visible=!1),t.sprites=t.sprites||{},void 0!==t.sprites[r])t.sprites[r].visible=!0;else{const i=this.createSprite(t,e,r);n.addChild(i)}t.currentSprite=t.sprites[r],t.currentSpriteName=r}t.currentSprite.renderable=!0,t.hackRegion||this.setSpriteRegion(e,t.currentSprite,a),t.currentSprite.color?i=t.currentSprite.color:(r0[0]=s[0]*t.color.r*l.r,r0[1]=s[1]*t.color.g*l.g,r0[2]=s[2]*t.color.b*l.b,t.currentSprite.tint=d$(r0)),t.currentSprite.blendMode=t.blendMode;break;case kQ.Mesh:if(t.currentSprite){t.currentSprite.visible=!1,t.currentSprite=null,t.currentSpriteName=void 0;const e=new MY;e._parentID=-1,e._worldID=n.transform._worldID,n.transform=e}if(!a){t.currentMesh&&(t.currentMesh.renderable=!1);break}const r=e.id;if(void 0===t.currentMeshId||t.currentMeshId!==r){const i=r;if(t.currentMesh&&(t.currentMesh.visible=!1),t.meshes=t.meshes||{},void 0!==t.meshes[i])t.meshes[i].visible=!0;else{const r=this.createMesh(t,e);n.addChild(r)}t.currentMesh=t.meshes[i],t.currentMeshName=e.name,t.currentMeshId=i}t.currentMesh.renderable=!0,e.computeWorldVerticesOld(t,t.currentMesh.vertices),t.currentMesh.color?i=t.currentMesh.color:(r0[0]=s[0]*t.color.r*l.r,r0[1]=s[1]*t.color.g*l.g,r0[2]=s[2]*t.color.b*l.b,t.currentMesh.tint=d$(r0)),t.currentMesh.blendMode=t.blendMode,t.hackRegion||this.setMeshRegion(e,t.currentMesh,a);break;case kQ.Clipping:t.currentGraphics||(this.createGraphics(t,e),n.addChild(t.clippingContainer),n.addChild(t.currentGraphics)),this.updateGraphics(t,e),n.alpha=1,n.visible=!0;continue;default:n.visible=!1;continue}if(n.visible=!0,i){let e=t.color.r*l.r,n=t.color.g*l.g,r=t.color.b*l.b;i.setLight(s[0]*e+o[0]*(1-e),s[1]*n+o[1]*(1-n),s[2]*r+o[2]*(1-r)),t.darkColor?(e=t.darkColor.r,n=t.darkColor.g,r=t.darkColor.b):(e=0,n=0,r=0),i.setDark(s[0]*e+o[0]*(1-e),s[1]*n+o[1]*(1-n),s[2]*r+o[2]*(1-r))}n.alpha=t.color.a}const a=this.skeleton.drawOrder;let l=null,c=null;for(let h=0,u=a.length;h<u;h++){const t=r[a[h].data.index],e=this.slotContainers[a[h].data.index];if(c||null!==e.parent&&e.parent!==this&&(e.parent.removeChild(e),e.parent=this),t.currentGraphics&&t.getAttachment())c=t.clippingContainer,l=t.getAttachment(),c.children.length=0,this.children[h]=e,l.endSlot===t.data&&(l.endSlot=null);else if(c){let n=this.tempClipContainers[h];n||(n=this.tempClipContainers[h]=this.newContainer(),n.visible=!1),this.children[h]=n,e.parent=null,c.addChild(e),l.endSlot==t.data&&(c.renderable=!0,c=null,l=null)}else this.children[h]=e}null==(e=this._debug)||e.renderDebug(this)}setSpriteRegion(t,e,n){e.attachment===t&&e.region===n||(e.region=n,e.attachment=t,e.texture=n.texture,e.rotation=t.rotation*YQ.degRad,e.position.x=t.x,e.position.y=t.y,e.alpha=t.color.a,n.size?(e.scale.x=n.size.width/n.originalWidth,e.scale.y=-n.size.height/n.originalHeight):(e.scale.x=t.scaleX*t.width/n.originalWidth,e.scale.y=-t.scaleY*t.height/n.originalHeight))}setMeshRegion(t,e,n){e.attachment===t&&e.region===n||(e.region=n,e.attachment=t,e.texture=n.texture,n.texture.updateUvs(),e.uvBuffer.update(t.regionUVs))}autoUpdateTransform(){{this.lastTime=this.lastTime||Date.now();const t=.001*(Date.now()-this.lastTime);this.lastTime=Date.now(),this.update(t)}Hq.prototype.updateTransform.call(this)}createSprite(t,e,n){let r=e.region;t.hackAttachment===e&&(r=t.hackRegion);const i=r?r.texture:null,s=this.newSprite(i);return s.anchor.set(.5),r&&this.setSpriteRegion(e,s,e.region),t.sprites=t.sprites||{},t.sprites[n]=s,s}createMesh(t,e){let n=e.region;t.hackAttachment===e&&(n=t.hackRegion,t.hackAttachment=null,t.hackRegion=null);const r=this.newMesh(n?n.texture:null,new Float32Array(e.regionUVs.length),e.regionUVs,new Uint16Array(e.triangles),RW.TRIANGLES);return void 0!==r._canvasPadding&&(r._canvasPadding=1.5),r.alpha=e.color.a,r.region=e.region,n&&this.setMeshRegion(e,r,n),t.meshes=t.meshes||{},t.meshes[e.id]=r,r}createGraphics(t,e){const n=this.newGraphics(),r=new vY([]);return n.clear(),n.beginFill(16777215,1),n.drawPolygon(r),n.renderable=!1,t.currentGraphics=n,t.clippingContainer=this.newContainer(),t.clippingContainer.mask=t.currentGraphics,n}updateGraphics(t,e){const n=t.currentGraphics.geometry,r=n.graphicsData[0].shape.points,i=e.worldVerticesLength;r.length=i,e.computeWorldVertices(t,0,i,r,0,2),n.invalidate()}hackTextureBySlotIndex(t,e=null,n=null){const r=this.skeleton.slots[t];if(!r)return!1;const i=r.getAttachment();let s=i.region;return e?(s=new FQ,s.texture=e,s.size=n,r.hackRegion=s,r.hackAttachment=i):(r.hackRegion=null,r.hackAttachment=null),r.currentSprite?this.setSpriteRegion(i,r.currentSprite,s):r.currentMesh&&this.setMeshRegion(i,r.currentMesh,s),!0}hackTextureBySlotName(t,e=null,n=null){const r=this.skeleton.findSlotIndex(t);return-1!=r&&this.hackTextureBySlotIndex(r,e,n)}hackTextureAttachment(t,e,n,r=null){const i=this.skeleton.findSlotIndex(t),s=this.skeleton.getAttachmentByName(t,e);s.region.texture=n;const o=this.skeleton.slots[i];if(!o)return!1;const a=o.getAttachment();if(e===a.name){let t=s.region;return n?(t=new FQ,t.texture=n,t.size=r,o.hackRegion=t,o.hackAttachment=a):(o.hackRegion=null,o.hackAttachment=null),o.currentSprite&&o.currentSprite.region!=t?(this.setSpriteRegion(a,o.currentSprite,t),o.currentSprite.region=t):o.currentMesh&&o.currentMesh.region!=t&&this.setMeshRegion(a,o.currentMesh,t),!0}return!1}newContainer(){return new Hq}newSprite(t){return new i0(t)}newGraphics(){return new gJ}newMesh(t,e,n,r,i){return new s0(t,e,n,r,i)}transformHack(){return 1}hackAttachmentGroups(t,e,n){if(!t)return;const r=[],i=[];for(let s=0,o=this.skeleton.slots.length;s<o;s++){const o=this.skeleton.slots[s],a=o.currentSpriteName||o.currentMeshName||"",l=o.currentSprite||o.currentMesh;a.endsWith(t)?(l.parentGroup=e,i.push(l)):n&&l&&(l.parentGroup=n,r.push(l))}return[r,i]}destroy(t){this.debug=null;for(let e=0,n=this.skeleton.slots.length;e<n;e++){const n=this.skeleton.slots[e];for(const e in n.meshes)n.meshes[e].destroy(t);n.meshes=null;for(const e in n.sprites)n.sprites[e].destroy(t);n.sprites=null}for(let e=0,n=this.slotContainers.length;e<n;e++)this.slotContainers[e].destroy(t);this.spineData=null,this.skeleton=null,this.slotContainers=null,this.stateData=null,this.state=null,this.tempClipContainers=null,super.destroy(t)}};let a0=o0;a0.clippingPolygon=[],Object.defineProperty(a0.prototype,"visible",{get(){return this._visible},set(t){t!==this._visible&&(this._visible=t,t&&(this.lastTime=0))}});const l0={extension:F$.Asset,loader:{extension:{type:F$.LoadParser,priority:AK.Normal},test:t=>bK(t,".atlas"),async load(t){const e=await WW.ADAPTER.fetch(t);return await e.text()},testParse(t,e){const n=bK(e.src,".atlas"),r="string"==typeof t;return Promise.resolve(n&&r)},async parse(t,e,n){const r=e.data;let i=i$.dirname(e.src);i&&i.lastIndexOf("/")!==i.length-1&&(i+="/");let s=null,o=null;const a=new Promise(((t,e)=>{s=t,o=e}));let l;const c=t=>{t||o("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),s(l)};if(r.image||r.images){const e=Object.assign(r.image?{default:r.image}:{},r.images);l=new BQ(t,((t,n)=>{const r=e[t]||e.default;r&&r.baseTexture?n(r.baseTexture):n(r)}),c)}else l=new BQ(t,c0(n,i,r.imageMetadata),c);return await a},unload(t){t.dispose()}}},c0=(t,e,n)=>async(r,i)=>{const s=i$.normalize([...e.split(i$.sep),r].join(i$.sep));i((await t.load({src:s,data:n})).baseTexture)};function h0(t){return t.hasOwnProperty("bones")}U$.add(l0);class u0{constructor(){}installLoader(){const t=this,e={extension:F$.Asset,loader:{extension:{type:F$.LoadParser,priority:AK.Normal},test:t=>bK(t,".skel"),async load(t){const e=await WW.ADAPTER.fetch(t);return await e.arrayBuffer()},testParse(t,e){var n;const r=bK(e.src,".json")&&h0(t),i=bK(e.src,".skel")&&t instanceof ArrayBuffer;const s=!1===(null==(n=e.data)?void 0:n.spineAtlas);return Promise.resolve(r&&!s||i)},async parse(e,n,r){const i=i$.extname(n.src).toLowerCase(),s=i$.basename(n.src,i);let o=i$.dirname(n.src);o&&o.lastIndexOf("/")!==o.length-1&&(o+="/");let a=null,l=e;bK(n.src,".json")&&h0(e)?a=t.createJsonParser():(a=t.createBinaryParser(),l=new Uint8Array(e));const c=n.data||{},h=(null==c?void 0:c.spineSkeletonScale)??null;h&&(a.scale=h);const u=c.spineAtlas;if(u&&u.pages)return t.parseData(a,u,l);const d=c.atlasRawData;if(d){let e=null,n=null;const i=new Promise(((t,r)=>{e=t,n=r})),s=new BQ(d,c0(r,o,c.imageMetadata),(t=>{t||n("Something went terribly wrong loading a spine .atlas file\nMost likely your texture failed to load."),e(s)})),h=await i;return t.parseData(a,h,l)}let f=c.spineAtlasFile;f||(f=`${o+s}.atlas`);const p=await r.load({src:f,data:c,alias:c.spineAtlasAlias});return t.parseData(a,p,l)}}};return U$.add(e),e}}let d0=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const f0=class extends d0{constructor(t){super(t),this.id=(65535&f0.nextID++)<<11,this.worldVerticesLength=0,this.deformAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,n,r,i,s){n=i+(n>>1)*s;const o=t.bone.skeleton,a=t.deform;let l=this.vertices;const c=this.bones;if(null==c){a.length>0&&(l=a);const o=t.bone.matrix,c=o.tx,h=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,a=i;a<n;t+=2,a+=s){const e=l[t],n=l[t+1];r[a]=e*u+n*d+c,r[a+1]=e*f+n*p+h}return}let h=0,u=0;for(let f=0;f<e;f+=2){const t=c[h];h+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let f=i,p=3*u;f<n;f+=s){let t=0,e=0,n=c[h++];for(n+=h;h<n;h++,p+=3){const n=d[c[h]].matrix,r=l[p],i=l[p+1],s=l[p+2];t+=(r*n.a+i*n.c+n.tx)*s,e+=(r*n.b+i*n.d+n.ty)*s}r[f]=t,r[f+1]=e}else{const t=a;for(let e=i,o=3*u,a=u<<1;e<n;e+=s){let n=0,i=0,s=c[h++];for(s+=h;h<s;h++,o+=3,a+=2){const e=d[c[h]].matrix,r=l[o]+t[a],s=l[o+1]+t[a+1],u=l[o+2];n+=(r*e.a+s*e.c+e.tx)*u,i+=(r*e.b+s*e.d+e.ty)*u}r[e]=n,r[e+1]=i}}}copyTo(t){null!=this.bones?(t.bones=new Array(this.bones.length),JQ.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,null!=this.vertices?(t.vertices=JQ.newFloatArray(this.vertices.length),JQ.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)):t.vertices=null,t.worldVerticesLength=this.worldVerticesLength,t.deformAttachment=this.deformAttachment}};let p0=f0;p0.nextID=0;let m0=class t extends p0{constructor(t){super(t),this.type=kQ.BoundingBox,this.color=new HQ(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.color.setFromColor(this.color),e}},g0=class t extends p0{constructor(t){super(t),this.type=kQ.Clipping,this.color=new HQ(.2275,.2275,.8078,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.endSlot=this.endSlot,e.color.setFromColor(this.color),e}},v0=class t extends p0{constructor(t){super(t),this.type=kQ.Mesh,this.color=new HQ(1,1,1,1),this.tempColor=new HQ(0,0,0,0)}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(null!=this.parentMesh)return this.newLinkedMesh();const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Float32Array(this.regionUVs.length),JQ.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.triangles=new Array(this.triangles.length),JQ.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),JQ.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e}newLinkedMesh(){const e=new t(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),e.deformAttachment=this.deformAttachment,e.setParentMesh(null!=this.parentMesh?this.parentMesh:this),e}},y0=class t extends p0{constructor(t){super(t),this.type=kQ.Path,this.closed=!1,this.constantSpeed=!1,this.color=new HQ(1,1,1,1)}copy(){const e=new t(this.name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),JQ.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e}},b0=class t extends p0{constructor(t){super(t),this.type=kQ.Point,this.color=new HQ(.38,.94,0,1)}computeWorldPosition(t,e){const n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,n=YQ.cosDeg(this.rotation),r=YQ.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*YQ.radDeg}copy(){const e=new t(this.name);return e.x=this.x,e.y=this.y,e.rotation=this.rotation,e.color.setFromColor(this.color),e}},x0=class{constructor(t,e){if(this.deform=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new HQ,this.darkColor=null==t.darkColor?null:new HQ,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const w0=class extends d0{constructor(t){super(t),this.type=kQ.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new HQ(1,1,1,1),this.offset=JQ.newFloatArray(8),this.uvs=JQ.newFloatArray(8),this.tempColor=new HQ(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,i=n+this.region.width*t,s=r+this.region.height*e,o=this.rotation*Math.PI/180,a=Math.cos(o),l=Math.sin(o),c=n*a+this.x,h=n*l,u=r*a+this.y,d=r*l,f=i*a+this.x,p=i*l,m=s*a+this.y,g=s*l,v=this.offset;v[w0.OX1]=c-d,v[w0.OY1]=u+h,v[w0.OX2]=c-g,v[w0.OY2]=m+h,v[w0.OX3]=f-g,v[w0.OY3]=m+p,v[w0.OX4]=f-d,v[w0.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,n,r){const i=this.offset,s=t instanceof x0?t.bone.matrix:t.matrix,o=s.tx,a=s.ty,l=s.a,c=s.c,h=s.b,u=s.d;let d=0,f=0;d=i[w0.OX1],f=i[w0.OY1],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[w0.OX2],f=i[w0.OY2],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[w0.OX3],f=i[w0.OY3],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[w0.OX4],f=i[w0.OY4],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a}copy(){const t=new w0(this.name);return t.region=this.region,t.rendererObject=this.rendererObject,t.path=this.path,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,JQ.arrayCopy(this.uvs,0,t.uvs,0,8),JQ.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t}};let E0=w0;E0.OX1=0,E0.OY1=1,E0.OX2=2,E0.OY2=3,E0.OX3=4,E0.OY3=5,E0.OX4=6,E0.OY4=7,E0.X1=0,E0.Y1=1,E0.C1R=2,E0.C1G=3,E0.C1B=4,E0.C1A=5,E0.U1=6,E0.V1=7,E0.X2=8,E0.Y2=9,E0.C2R=10,E0.C2G=11,E0.C2B=12,E0.C2A=13,E0.U2=14,E0.V2=15,E0.X3=16,E0.Y3=17,E0.C3R=18,E0.C3G=19,E0.C3B=20,E0.C3A=21,E0.U3=22,E0.V3=23,E0.X4=24,E0.Y4=25,E0.C4R=26,E0.C4G=27,E0.C4B=28,E0.C4A=29,E0.U4=30,E0.V4=31;const _0=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,n,r){const i=this.angle*YQ.degreesToRadians,s=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(s*s+o*o);if(a<this.radius){const e=_0.interpolation.apply(0,i,(this.radius-a)/this.radius),n=Math.cos(e),r=Math.sin(e);t.x=n*s-r*o+this.worldX,t.y=r*s+n*o+this.worldY}}end(){}};let S0=_0;S0.interpolation=new KQ(2);let T0=class{constructor(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(let r=0;r<e.length;r++)this.timelineIds[e[r].getPropertyId()]=!0;this.duration=n}hasTimeline(t){return 1==this.timelineIds[t]}apply(t,e,n,r,i,s,o,a){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));const l=this.timelines;for(let c=0,h=l.length;c<h;c++)l[c].apply(t,e,n,i,s,o,a)}static binarySearch(t,e,n=1){let r=0,i=t.length/n-2;if(0==i)return n;let s=i>>>1;for(;;){if(t[(s+1)*n]<=e?r=s+1:i=s,r==i)return(r+1)*n;s=r+i>>>1}}static linearSearch(t,e,n){for(let r=0,i=t.length-n;r<=i;r+=n)if(t[r]>e)return r;return-1}};var k0=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(k0||{});const A0=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=JQ.newFloatArray((t-1)*A0.BEZIER_SIZE)}getFrameCount(){return this.curves.length/A0.BEZIER_SIZE+1}setLinear(t){this.curves[t*A0.BEZIER_SIZE]=A0.LINEAR}setStepped(t){this.curves[t*A0.BEZIER_SIZE]=A0.STEPPED}getCurveType(t){const e=t*A0.BEZIER_SIZE;if(e==this.curves.length)return A0.LINEAR;const n=this.curves[e];return n==A0.LINEAR?A0.LINEAR:n==A0.STEPPED?A0.STEPPED:A0.BEZIER}setCurve(t,e,n,r,i){const s=.03*(2*-e+r),o=.03*(2*-n+i),a=.006*(3*(e-r)+1),l=.006*(3*(n-i)+1);let c=2*s+a,h=2*o+l,u=.3*e+s+.16666667*a,d=.3*n+o+.16666667*l,f=t*A0.BEZIER_SIZE;const p=this.curves;p[f++]=A0.BEZIER;let m=u,g=d;for(let v=f+A0.BEZIER_SIZE-1;f<v;f+=2)p[f]=m,p[f+1]=g,u+=c,d+=h,c+=a,h+=l,m+=u,g+=d}getCurvePercent(t,e){e=YQ.clamp(e,0,1);const n=this.curves;let r=t*A0.BEZIER_SIZE;const i=n[r];if(i==A0.LINEAR)return e;if(i==A0.STEPPED)return 0;r++;let s=0;for(let a=r,l=r+A0.BEZIER_SIZE-1;r<l;r+=2)if(s=n[r],s>=e){let t,i;return r==a?(t=0,i=0):(t=n[r-2],i=n[r-1]),i+(n[r+1]-i)*(e-t)/(s-t)}const o=n[r-1];return o+(1-o)*(e-s)/(1-s)}};let C0=A0;C0.LINEAR=0,C0.STEPPED=1,C0.BEZIER=2,C0.BEZIER_SIZE=19;const R0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+R0.ROTATION]=n}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(n<a[0]){switch(s){case CQ.setup:return void(l.rotation=l.data.rotation);case CQ.first:const t=l.data.rotation-l.rotation;l.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*i}return}if(n>=a[a.length-R0.ENTRIES]){let t=a[a.length+R0.PREV_ROTATION];switch(s){case CQ.setup:l.rotation=l.data.rotation+t*i;break;case CQ.first:case CQ.replace:t+=l.data.rotation-l.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case CQ.add:l.rotation+=t*i}return}const c=T0.binarySearch(a,n,R0.ENTRIES),h=a[c+R0.PREV_ROTATION],u=a[c],d=this.getCurvePercent((c>>1)-1,1-(n-u)/(a[c+R0.PREV_TIME]-u));let f=a[c+R0.ROTATION]-h;switch(f=h+(f-360*(16384-(16384.499999999996-f/360|0)))*d,s){case CQ.setup:l.rotation=l.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*i;break;case CQ.first:case CQ.replace:f+=l.data.rotation-l.rotation;case CQ.add:l.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*i}}};let M0=R0;M0.ENTRIES=2,M0.PREV_TIME=-2,M0.PREV_ROTATION=-1,M0.ROTATION=1;const I0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*I0.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,n,r){t*=I0.ENTRIES,this.frames[t]=e,this.frames[t+I0.X]=n,this.frames[t+I0.Y]=r}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.bones[this.boneIndex];if(!l.active)return;if(n<a[0]){switch(s){case CQ.setup:return l.x=l.data.x,void(l.y=l.data.y);case CQ.first:l.x+=(l.data.x-l.x)*i,l.y+=(l.data.y-l.y)*i}return}let c=0,h=0;if(n>=a[a.length-I0.ENTRIES])c=a[a.length+I0.PREV_X],h=a[a.length+I0.PREV_Y];else{const t=T0.binarySearch(a,n,I0.ENTRIES);c=a[t+I0.PREV_X],h=a[t+I0.PREV_Y];const e=a[t],r=this.getCurvePercent(t/I0.ENTRIES-1,1-(n-e)/(a[t+I0.PREV_TIME]-e));c+=(a[t+I0.X]-c)*r,h+=(a[t+I0.Y]-h)*r}switch(s){case CQ.setup:l.x=l.data.x+c*i,l.y=l.data.y+h*i;break;case CQ.first:case CQ.replace:l.x+=(l.data.x+c-l.x)*i,l.y+=(l.data.y+h-l.y)*i;break;case CQ.add:l.x+=c*i,l.y+=h*i}}};let D0=I0;D0.ENTRIES=3,D0.PREV_TIME=-3,D0.PREV_X=-2,D0.PREV_Y=-1,D0.X=1,D0.Y=2;let O0=class t extends D0{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.bones[this.boneIndex];if(!c.active)return;if(r<l[0]){switch(o){case CQ.setup:return c.scaleX=c.data.scaleX,void(c.scaleY=c.data.scaleY);case CQ.first:c.scaleX+=(c.data.scaleX-c.scaleX)*s,c.scaleY+=(c.data.scaleY-c.scaleY)*s}return}let h=0,u=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_X]*c.data.scaleX,u=l[l.length+t.PREV_Y]*c.data.scaleY;else{const e=T0.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_X],u=l[e+t.PREV_Y];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h=(h+(l[e+t.X]-h)*i)*c.data.scaleX,u=(u+(l[e+t.Y]-u)*i)*c.data.scaleY}if(1==s)o==CQ.add?(c.scaleX+=h-c.data.scaleX,c.scaleY+=u-c.data.scaleY):(c.scaleX=h,c.scaleY=u);else{let t=0,e=0;if(a==RQ.mixOut)switch(o){case CQ.setup:t=c.data.scaleX,e=c.data.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-t)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-e)*s;break;case CQ.first:case CQ.replace:t=c.scaleX,e=c.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-t)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-e)*s;break;case CQ.add:t=c.scaleX,e=c.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-c.data.scaleX)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-c.data.scaleY)*s}else switch(o){case CQ.setup:t=Math.abs(c.data.scaleX)*YQ.signum(h),e=Math.abs(c.data.scaleY)*YQ.signum(u),c.scaleX=t+(h-t)*s,c.scaleY=e+(u-e)*s;break;case CQ.first:case CQ.replace:t=Math.abs(c.scaleX)*YQ.signum(h),e=Math.abs(c.scaleY)*YQ.signum(u),c.scaleX=t+(h-t)*s,c.scaleY=e+(u-e)*s;break;case CQ.add:t=YQ.signum(h),e=YQ.signum(u),c.scaleX=Math.abs(c.scaleX)*t+(h-Math.abs(c.data.scaleX)*t)*s,c.scaleY=Math.abs(c.scaleY)*e+(u-Math.abs(c.data.scaleY)*e)*s}}}},P0=class t extends D0{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.bones[this.boneIndex];if(!c.active)return;if(r<l[0]){switch(o){case CQ.setup:return c.shearX=c.data.shearX,void(c.shearY=c.data.shearY);case CQ.first:c.shearX+=(c.data.shearX-c.shearX)*s,c.shearY+=(c.data.shearY-c.shearY)*s}return}let h=0,u=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_X],u=l[l.length+t.PREV_Y];else{const e=T0.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_X],u=l[e+t.PREV_Y];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h+=(l[e+t.X]-h)*i,u+=(l[e+t.Y]-u)*i}switch(o){case CQ.setup:c.shearX=c.data.shearX+h*s,c.shearY=c.data.shearY+u*s;break;case CQ.first:case CQ.replace:c.shearX+=(c.data.shearX+h-c.shearX)*s,c.shearY+=(c.data.shearY+u-c.shearY)*s;break;case CQ.add:c.shearX+=h*s,c.shearY+=u*s}}};const L0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*L0.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,n,r,i,s){t*=L0.ENTRIES,this.frames[t]=e,this.frames[t+L0.R]=n,this.frames[t+L0.G]=r,this.frames[t+L0.B]=i,this.frames[t+L0.A]=s}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return void a.color.setFromColor(a.data.color);case CQ.first:const t=a.color,e=a.data.color;t.add((e.r-t.r)*i,(e.g-t.g)*i,(e.b-t.b)*i,(e.a-t.a)*i)}return}let c=0,h=0,u=0,d=0;if(n>=l[l.length-L0.ENTRIES]){const t=l.length;c=l[t+L0.PREV_R],h=l[t+L0.PREV_G],u=l[t+L0.PREV_B],d=l[t+L0.PREV_A]}else{const t=T0.binarySearch(l,n,L0.ENTRIES);c=l[t+L0.PREV_R],h=l[t+L0.PREV_G],u=l[t+L0.PREV_B],d=l[t+L0.PREV_A];const e=l[t],r=this.getCurvePercent(t/L0.ENTRIES-1,1-(n-e)/(l[t+L0.PREV_TIME]-e));c+=(l[t+L0.R]-c)*r,h+=(l[t+L0.G]-h)*r,u+=(l[t+L0.B]-u)*r,d+=(l[t+L0.A]-d)*r}if(1==i)a.color.set(c,h,u,d);else{const t=a.color;s==CQ.setup&&t.setFromColor(a.data.color),t.add((c-t.r)*i,(h-t.g)*i,(u-t.b)*i,(d-t.a)*i)}}};let F0=L0;F0.ENTRIES=5,F0.PREV_TIME=-5,F0.PREV_R=-4,F0.PREV_G=-3,F0.PREV_B=-2,F0.PREV_A=-1,F0.R=1,F0.G=2,F0.B=3,F0.A=4;const N0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*N0.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,n,r,i,s,o,a,l){t*=N0.ENTRIES,this.frames[t]=e,this.frames[t+N0.R]=n,this.frames[t+N0.G]=r,this.frames[t+N0.B]=i,this.frames[t+N0.A]=s,this.frames[t+N0.R2]=o,this.frames[t+N0.G2]=a,this.frames[t+N0.B2]=l}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.color.setFromColor(a.data.color),void a.darkColor.setFromColor(a.data.darkColor);case CQ.first:const t=a.color,e=a.darkColor,n=a.data.color,r=a.data.darkColor;t.add((n.r-t.r)*i,(n.g-t.g)*i,(n.b-t.b)*i,(n.a-t.a)*i),e.add((r.r-e.r)*i,(r.g-e.g)*i,(r.b-e.b)*i,0)}return}let c=0,h=0,u=0,d=0,f=0,p=0,m=0;if(n>=l[l.length-N0.ENTRIES]){const t=l.length;c=l[t+N0.PREV_R],h=l[t+N0.PREV_G],u=l[t+N0.PREV_B],d=l[t+N0.PREV_A],f=l[t+N0.PREV_R2],p=l[t+N0.PREV_G2],m=l[t+N0.PREV_B2]}else{const t=T0.binarySearch(l,n,N0.ENTRIES);c=l[t+N0.PREV_R],h=l[t+N0.PREV_G],u=l[t+N0.PREV_B],d=l[t+N0.PREV_A],f=l[t+N0.PREV_R2],p=l[t+N0.PREV_G2],m=l[t+N0.PREV_B2];const e=l[t],r=this.getCurvePercent(t/N0.ENTRIES-1,1-(n-e)/(l[t+N0.PREV_TIME]-e));c+=(l[t+N0.R]-c)*r,h+=(l[t+N0.G]-h)*r,u+=(l[t+N0.B]-u)*r,d+=(l[t+N0.A]-d)*r,f+=(l[t+N0.R2]-f)*r,p+=(l[t+N0.G2]-p)*r,m+=(l[t+N0.B2]-m)*r}if(1==i)a.color.set(c,h,u,d),a.darkColor.set(f,p,m,1);else{const t=a.color,e=a.darkColor;s==CQ.setup&&(t.setFromColor(a.data.color),e.setFromColor(a.data.darkColor)),t.add((c-t.r)*i,(h-t.g)*i,(u-t.b)*i,(d-t.a)*i),e.add((f-e.r)*i,(p-e.g)*i,(m-e.b)*i,0)}}};let B0=N0;B0.ENTRIES=8,B0.PREV_TIME=-8,B0.PREV_R=-7,B0.PREV_G=-6,B0.PREV_B=-5,B0.PREV_A=-4,B0.PREV_R2=-3,B0.PREV_G2=-2,B0.PREV_B2=-1,B0.R=1,B0.G=2,B0.B=3,B0.A=4,B0.R2=5,B0.G2=6,B0.B2=7;let U0=class{constructor(t){this.frames=JQ.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;if(o==RQ.mixOut)return void(s==CQ.setup&&this.setAttachment(t,a,a.data.attachmentName));const l=this.frames;if(n<l[0])return void(s!=CQ.setup&&s!=CQ.first||this.setAttachment(t,a,a.data.attachmentName));let c=0;c=n>=l[l.length-1]?l.length-1:T0.binarySearch(l,n,1)-1;const h=this.attachmentNames[c];t.slots[this.slotIndex].setAttachment(null==h?null:t.getAttachment(this.slotIndex,h))}setAttachment(t,e,n){e.setAttachment(null==n?null:t.getAttachment(this.slotIndex,n))}},V0=null,j0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t),this.frameVertices=new Array(t),null==V0&&(V0=JQ.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,n){this.frames[t]=e,this.frameVertices[t]=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=a.getAttachment();if(!(l instanceof p0)||l.deformAttachment!=this.attachment)return;const c=a.deform;0==c.length&&(s=CQ.setup);const h=this.frameVertices,u=h[0].length,d=this.frames;if(n<d[0]){const t=l;switch(s){case CQ.setup:return void(c.length=0);case CQ.first:if(1==i){c.length=0;break}const e=JQ.setArraySize(c,u);if(null==t.bones){const n=t.vertices;for(let t=0;t<u;t++)e[t]+=(n[t]-e[t])*i}else{i=1-i;for(let t=0;t<u;t++)e[t]*=i}}return}const f=JQ.setArraySize(c,u);if(n>=d[d.length-1]){const t=h[d.length-1];if(1==i)if(s==CQ.add){const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-n[e]}else for(let n=0;n<u;n++)f[n]+=t[n]}else JQ.arrayCopy(t,0,f,0,u);else switch(s){case CQ.setup:{const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++){const r=n[e];f[e]=r+(t[e]-r)*i}}else for(let n=0;n<u;n++)f[n]=t[n]*i;break}case CQ.first:case CQ.replace:for(let n=0;n<u;n++)f[n]+=(t[n]-f[n])*i;break;case CQ.add:const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-n[e])*i}else for(let n=0;n<u;n++)f[n]+=t[n]*i}return}const p=T0.binarySearch(d,n),m=h[p-1],g=h[p],v=d[p],y=this.getCurvePercent(p-1,1-(n-v)/(d[p-1]-v));if(1==i)if(s==CQ.add){const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];f[t]+=n+(g[t]-n)*y-e[t]}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=t+(g[e]-t)*y}}else for(let b=0;b<u;b++){const t=m[b];f[b]=t+(g[b]-t)*y}else switch(s){case CQ.setup:{const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t],r=e[t];f[t]=r+(n+(g[t]-n)*y-r)*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]=(t+(g[e]-t)*y)*i}break}case CQ.first:case CQ.replace:for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*y-f[e])*i}break;case CQ.add:const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];f[t]+=(n+(g[t]-n)*y-e[t])*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*y)*i}}}},z0=class{constructor(t){this.frames=JQ.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,n,r,i,s,o){if(null==r)return;const a=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,o),e=-1;else if(e>=a[l-1])return;if(n<a[0])return;let c=0;if(e<a[0])c=0;else{c=T0.binarySearch(a,e);const t=a[c];for(;c>0&&a[c-1]==t;)c--}for(;c<l&&n>=a[c];c++)r.push(this.events[c])}},G0=class{constructor(t){this.frames=JQ.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.drawOrders[t]=n}apply(t,e,n,r,i,s,o){const a=t.drawOrder,l=t.slots;if(o==RQ.mixOut&&s==CQ.setup)return void JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const c=this.frames;if(n<c[0])return void(s!=CQ.setup&&s!=CQ.first||JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let h=0;h=n>=c[c.length-1]?c.length-1:T0.binarySearch(c,n)-1;const u=this.drawOrders[h];if(null==u)JQ.arrayCopy(l,0,a,0,l.length);else for(let d=0,f=u.length;d<f;d++)a[d]=l[u[d]]}};const W0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*W0.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,n,r,i,s,o){t*=W0.ENTRIES,this.frames[t]=e,this.frames[t+W0.MIX]=n,this.frames[t+W0.SOFTNESS]=r,this.frames[t+W0.BEND_DIRECTION]=i,this.frames[t+W0.COMPRESS]=s?1:0,this.frames[t+W0.STRETCH]=o?1:0}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(!l.active)return;if(n<a[0]){switch(s){case CQ.setup:return l.mix=l.data.mix,l.softness=l.data.softness,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case CQ.first:l.mix+=(l.data.mix-l.mix)*i,l.softness+=(l.data.softness-l.softness)*i,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}return}if(n>=a[a.length-W0.ENTRIES])return void(s==CQ.setup?(l.mix=l.data.mix+(a[a.length+W0.PREV_MIX]-l.data.mix)*i,l.softness=l.data.softness+(a[a.length+W0.PREV_SOFTNESS]-l.data.softness)*i,o==RQ.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[a.length+W0.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+W0.PREV_COMPRESS],l.stretch=0!=a[a.length+W0.PREV_STRETCH])):(l.mix+=(a[a.length+W0.PREV_MIX]-l.mix)*i,l.softness+=(a[a.length+W0.PREV_SOFTNESS]-l.softness)*i,o==RQ.mixIn&&(l.bendDirection=a[a.length+W0.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+W0.PREV_COMPRESS],l.stretch=0!=a[a.length+W0.PREV_STRETCH])));const c=T0.binarySearch(a,n,W0.ENTRIES),h=a[c+W0.PREV_MIX],u=a[c+W0.PREV_SOFTNESS],d=a[c],f=this.getCurvePercent(c/W0.ENTRIES-1,1-(n-d)/(a[c+W0.PREV_TIME]-d));s==CQ.setup?(l.mix=l.data.mix+(h+(a[c+W0.MIX]-h)*f-l.data.mix)*i,l.softness=l.data.softness+(u+(a[c+W0.SOFTNESS]-u)*f-l.data.softness)*i,o==RQ.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[c+W0.PREV_BEND_DIRECTION],l.compress=0!=a[c+W0.PREV_COMPRESS],l.stretch=0!=a[c+W0.PREV_STRETCH])):(l.mix+=(h+(a[c+W0.MIX]-h)*f-l.mix)*i,l.softness+=(u+(a[c+W0.SOFTNESS]-u)*f-l.softness)*i,o==RQ.mixIn&&(l.bendDirection=a[c+W0.PREV_BEND_DIRECTION],l.compress=0!=a[c+W0.PREV_COMPRESS],l.stretch=0!=a[c+W0.PREV_STRETCH]))}};let H0=W0;H0.ENTRIES=6,H0.PREV_TIME=-6,H0.PREV_MIX=-5,H0.PREV_SOFTNESS=-4,H0.PREV_BEND_DIRECTION=-3,H0.PREV_COMPRESS=-2,H0.PREV_STRETCH=-1,H0.MIX=1,H0.SOFTNESS=2,H0.BEND_DIRECTION=3,H0.COMPRESS=4,H0.STRETCH=5;const $0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*$0.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,n,r,i,s){t*=$0.ENTRIES,this.frames[t]=e,this.frames[t+$0.ROTATE]=n,this.frames[t+$0.TRANSLATE]=r,this.frames[t+$0.SCALE]=i,this.frames[t+$0.SHEAR]=s}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(!l.active)return;if(n<a[0]){const t=l.data;switch(s){case CQ.setup:return l.rotateMix=t.rotateMix,l.translateMix=t.translateMix,l.scaleMix=t.scaleMix,void(l.shearMix=t.shearMix);case CQ.first:l.rotateMix+=(t.rotateMix-l.rotateMix)*i,l.translateMix+=(t.translateMix-l.translateMix)*i,l.scaleMix+=(t.scaleMix-l.scaleMix)*i,l.shearMix+=(t.shearMix-l.shearMix)*i}return}let c=0,h=0,u=0,d=0;if(n>=a[a.length-$0.ENTRIES]){const t=a.length;c=a[t+$0.PREV_ROTATE],h=a[t+$0.PREV_TRANSLATE],u=a[t+$0.PREV_SCALE],d=a[t+$0.PREV_SHEAR]}else{const t=T0.binarySearch(a,n,$0.ENTRIES);c=a[t+$0.PREV_ROTATE],h=a[t+$0.PREV_TRANSLATE],u=a[t+$0.PREV_SCALE],d=a[t+$0.PREV_SHEAR];const e=a[t],r=this.getCurvePercent(t/$0.ENTRIES-1,1-(n-e)/(a[t+$0.PREV_TIME]-e));c+=(a[t+$0.ROTATE]-c)*r,h+=(a[t+$0.TRANSLATE]-h)*r,u+=(a[t+$0.SCALE]-u)*r,d+=(a[t+$0.SHEAR]-d)*r}if(s==CQ.setup){const t=l.data;l.rotateMix=t.rotateMix+(c-t.rotateMix)*i,l.translateMix=t.translateMix+(h-t.translateMix)*i,l.scaleMix=t.scaleMix+(u-t.scaleMix)*i,l.shearMix=t.shearMix+(d-t.shearMix)*i}else l.rotateMix+=(c-l.rotateMix)*i,l.translateMix+=(h-l.translateMix)*i,l.scaleMix+=(u-l.scaleMix)*i,l.shearMix+=(d-l.shearMix)*i}};let Y0=$0;Y0.ENTRIES=5,Y0.PREV_TIME=-5,Y0.PREV_ROTATE=-4,Y0.PREV_TRANSLATE=-3,Y0.PREV_SCALE=-2,Y0.PREV_SHEAR=-1,Y0.ROTATE=1,Y0.TRANSLATE=2,Y0.SCALE=3,Y0.SHEAR=4;const X0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*X0.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,n){t*=X0.ENTRIES,this.frames[t]=e,this.frames[t+X0.VALUE]=n}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(n<a[0]){switch(s){case CQ.setup:return void(l.position=l.data.position);case CQ.first:l.position+=(l.data.position-l.position)*i}return}let c=0;if(n>=a[a.length-X0.ENTRIES])c=a[a.length+X0.PREV_VALUE];else{const t=T0.binarySearch(a,n,X0.ENTRIES);c=a[t+X0.PREV_VALUE];const e=a[t],r=this.getCurvePercent(t/X0.ENTRIES-1,1-(n-e)/(a[t+X0.PREV_TIME]-e));c+=(a[t+X0.VALUE]-c)*r}s==CQ.setup?l.position=l.data.position+(c-l.data.position)*i:l.position+=(c-l.position)*i}};let q0=X0;q0.ENTRIES=2,q0.PREV_TIME=-2,q0.PREV_VALUE=-1,q0.VALUE=1;let K0=class t extends q0{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.pathConstraints[this.pathConstraintIndex];if(!c.active)return;if(r<l[0]){switch(o){case CQ.setup:return void(c.spacing=c.data.spacing);case CQ.first:c.spacing+=(c.data.spacing-c.spacing)*s}return}let h=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_VALUE];else{const e=T0.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_VALUE];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h+=(l[e+t.VALUE]-h)*i}o==CQ.setup?c.spacing=c.data.spacing+(h-c.data.spacing)*s:c.spacing+=(h-c.spacing)*s}};const Z0=class extends C0{constructor(t){super(t),this.frames=JQ.newFloatArray(t*Z0.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,n,r){t*=Z0.ENTRIES,this.frames[t]=e,this.frames[t+Z0.ROTATE]=n,this.frames[t+Z0.TRANSLATE]=r}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(!l.active)return;if(n<a[0]){switch(s){case CQ.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case CQ.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*i,l.translateMix+=(l.data.translateMix-l.translateMix)*i}return}let c=0,h=0;if(n>=a[a.length-Z0.ENTRIES])c=a[a.length+Z0.PREV_ROTATE],h=a[a.length+Z0.PREV_TRANSLATE];else{const t=T0.binarySearch(a,n,Z0.ENTRIES);c=a[t+Z0.PREV_ROTATE],h=a[t+Z0.PREV_TRANSLATE];const e=a[t],r=this.getCurvePercent(t/Z0.ENTRIES-1,1-(n-e)/(a[t+Z0.PREV_TIME]-e));c+=(a[t+Z0.ROTATE]-c)*r,h+=(a[t+Z0.TRANSLATE]-h)*r}s==CQ.setup?(l.rotateMix=l.data.rotateMix+(c-l.data.rotateMix)*i,l.translateMix=l.data.translateMix+(h-l.data.translateMix)*i):(l.rotateMix+=(c-l.rotateMix)*i,l.translateMix+=(h-l.translateMix)*i)}};let J0=Z0;J0.ENTRIES=3,J0.PREV_TIME=-3,J0.PREV_ROTATE=-2,J0.PREV_TRANSLATE=-1,J0.ROTATE=1,J0.TRANSLATE=2;const Q0=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new i1(this),this.propertyIDs=new zQ,this.animationsChanged=!1,this.trackEntryPool=new QQ((()=>new n1)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(null==r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let i=t*r.timeScale;if(r.delay>0){if(r.delay-=i,r.delay>0)continue;i=-r.delay,r.delay=0}let s=r.next;if(null!=s){const e=r.trackLast-s.delay;if(e>=0){for(s.delay=0,s.trackTime+=0==r.timeScale?0:(e/r.timeScale+t)*s.timeScale,r.trackTime+=i,this.setCurrent(n,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[n]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const n=t.mixingFrom;if(null==n)return!0;const r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,n=this.tracks;let r=!1;for(let o=0,a=n.length;o<a;o++){const i=n[o];if(null==i||i.delay>0)continue;r=!0;const s=0==o?CQ.first:i.mixBlend;let a=i.alpha;null!=i.mixingFrom?a*=this.applyMixingFrom(i,t,s):i.trackTime>=i.trackEnd&&null==i.next&&(a=0);const l=i.animationLast,c=i.getAnimationTime(),h=i.animation.timelines.length,u=i.animation.timelines;if(0==o&&1==a||s==CQ.add)for(let n=0;n<h;n++){const r=u[n];r instanceof U0?this.applyAttachmentTimeline(r,t,c,s,!0):r.apply(t,l,c,e,a,s,RQ.mixIn)}else{const n=i.timelineMode,r=0==i.timelinesRotation.length;r&&JQ.setArraySize(i.timelinesRotation,h<<1,null);const o=i.timelinesRotation;for(let i=0;i<h;i++){const h=u[i],d=n[i]==Q0.SUBSEQUENT?s:CQ.setup;h instanceof M0?this.applyRotateTimeline(h,t,c,a,d,o,i<<1,r):h instanceof U0?this.applyAttachmentTimeline(h,t,c,s,!0):h.apply(t,l,c,e,a,d,RQ.mixIn)}}this.queueEvents(i,c),e.length=0,i.nextAnimationLast=c,i.nextTrackLast=i.trackTime}const i=this.unkeyedState+Q0.SETUP,s=t.slots;for(let o=0,a=t.slots.length;o<a;o++){const e=s[o];if(e.attachmentState==i){const n=e.data.attachmentName;e.setAttachment(null==n?null:t.getAttachment(e.data.index,n))}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,n){const r=t.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,e,n);let i=0;0==t.mixDuration?(i=1,n==CQ.first&&(n=CQ.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),n!=CQ.first&&(n=r.mixBlend));const s=i<r.eventThreshold?this.events:null,o=i<r.attachmentThreshold,a=i<r.drawOrderThreshold,l=r.animationLast,c=r.getAnimationTime(),h=r.animation.timelines.length,u=r.animation.timelines,d=r.alpha*t.interruptAlpha,f=d*(1-i);if(n==CQ.add)for(let p=0;p<h;p++)u[p].apply(e,l,c,s,f,n,RQ.mixOut);else{const t=r.timelineMode,i=r.timelineHoldMix,p=0==r.timelinesRotation.length;p&&JQ.setArraySize(r.timelinesRotation,h<<1,null);const m=r.timelinesRotation;r.totalAlpha=0;for(let g=0;g<h;g++){const h=u[g];let v,y=RQ.mixOut,b=0;switch(t[g]){case Q0.SUBSEQUENT:if(!a&&h instanceof G0)continue;v=n,b=f;break;case Q0.FIRST:v=CQ.setup,b=f;break;case Q0.HOLD_SUBSEQUENT:v=n,b=d;break;case Q0.HOLD_FIRST:v=CQ.setup,b=d;break;default:v=CQ.setup;const t=i[g];b=d*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=b,h instanceof M0?this.applyRotateTimeline(h,e,c,b,v,m,g<<1,p):h instanceof U0?this.applyAttachmentTimeline(h,e,c,v,o):(a&&h instanceof G0&&v==CQ.setup&&(y=RQ.mixIn),h.apply(e,l,c,s,b,v,y))}}return t.mixDuration>0&&this.queueEvents(r,c),this.events.length=0,r.nextAnimationLast=c,r.nextTrackLast=r.trackTime,i}applyAttachmentTimeline(t,e,n,r,i){const s=e.slots[t.slotIndex];if(!s.bone.active)return;const o=t.frames;if(n<o[0])r!=CQ.setup&&r!=CQ.first||this.setAttachment(e,s,s.data.attachmentName,i);else{let r;r=n>=o[o.length-1]?o.length-1:T0.binarySearch(o,n)-1,this.setAttachment(e,s,t.attachmentNames[r],i)}s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+Q0.SETUP)}setAttachment(t,e,n,r){e.setAttachment(null==n?null:t.getAttachment(e.data.index,n)),r&&(e.attachmentState=this.unkeyedState+Q0.CURRENT)}applyRotateTimeline(t,e,n,r,i,s,o,a){if(a&&(s[o]=0),1==r)return void t.apply(e,0,n,null,1,i,RQ.mixIn);const l=t,c=l.frames,h=e.bones[l.boneIndex];if(!h.active)return;let u=0,d=0;if(n<c[0])switch(i){case CQ.setup:h.rotation=h.data.rotation;default:return;case CQ.first:u=h.rotation,d=h.data.rotation}else if(u=i==CQ.setup?h.data.rotation:h.rotation,n>=c[c.length-M0.ENTRIES])d=h.data.rotation+c[c.length+M0.PREV_ROTATION];else{const t=T0.binarySearch(c,n,M0.ENTRIES),e=c[t+M0.PREV_ROTATION],r=c[t],i=l.getCurvePercent((t>>1)-1,1-(n-r)/(c[t+M0.PREV_TIME]-r));d=c[t+M0.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*i+h.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=s[o];else{let t=0,e=0;a?(t=0,e=p):(t=s[o],e=s[o+1]);const n=p>0;let r=t>=0;YQ.signum(e)!=YQ.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*YQ.signum(t)),r=n),f=p+t-t%360,r!=n&&(f+=360*YQ.signum(t)),s[o]=f}s[o+1]=p,u+=f*r,h.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,o=this.events;let a=0;const l=o.length;for(;a<l;a++){const e=o[a];if(e.time<s)break;e.time>r||this.queue.event(t,e)}let c=!1;for(c=t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r,c&&this.queue.complete(t);a<l;a++){o[a].time<n||this.queue.event(t,o[a])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let n=e;for(;;){const t=n.mixingFrom;if(null==t)break;this.queue.end(t),n.mixingFrom=null,n.mixingTo=null,n=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,n){const r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,n){const r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,n)}setAnimationWith(t,e,n){if(null==e)throw new Error("animation cannot be null.");let r=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,r=!1):this.disposeNext(i));const s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s}addAnimation(t,e,n,r){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,n,r)}addAnimationWith(t,e,n,r){if(null==e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;const s=this.trackEntry(t,e,n,i);if(null==i)this.setCurrent(t,s,!0),this.queue.drain();else if(i.next=s,r<=0){const t=i.animationEnd-i.animationStart;0!=t?(i.loop?r+=t*(1+(i.trackTime/t|0)):r+=Math.max(t,i.trackTime),r-=this.data.getMix(i.animation,e)):r=i.trackTime}return s.delay=r,s}setEmptyAnimation(t,e){const n=this.setAnimationWith(t,Q0.emptyAnimation,!1);return n.mixDuration=e,n.trackEnd=e,n}addEmptyAnimation(t,e,n){n<=0&&(n-=e);const r=this.addAnimationWith(t,Q0.emptyAnimation,!1,n);return r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,r=this.tracks.length;n<r;n++){const e=this.tracks[n];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(JQ.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,n,r){const i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==r?0:this.data.getMix(r.animation,e),i.mixBlend=CQ.replace,i}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==CQ.add||this.computeHold(e),e=e.mixingTo}while(null!=e)}}}computeHold(t){const e=t.mixingTo,n=t.animation.timelines,r=t.animation.timelines.length,i=JQ.setArraySize(t.timelineMode,r);t.timelineHoldMix.length=0;const s=JQ.setArraySize(t.timelineHoldMix,r),o=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let a=0;a<r;a++)i[a]=o.add(n[a].getPropertyId())?Q0.HOLD_FIRST:Q0.HOLD_SUBSEQUENT;else t:for(let a=0;a<r;a++){const r=n[a],l=r.getPropertyId();if(o.add(l))if(null==e||r instanceof U0||r instanceof G0||r instanceof z0||!e.animation.hasTimeline(l))i[a]=Q0.FIRST;else{for(let n=e.mixingTo;null!=n;n=n.mixingTo)if(!n.animation.hasTimeline(l)){if(t.mixDuration>0){i[a]=Q0.HOLD_MIX,s[a]=n;continue t}break}i[a]=Q0.HOLD_FIRST}else i[a]=Q0.SUBSEQUENT}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,n){Q0.deprecatedWarning1||(Q0.deprecatedWarning1=!0),this.setAnimation(t,e,n)}addAnimationByName(t,e,n,r){Q0.deprecatedWarning2||(Q0.deprecatedWarning2=!0),this.addAnimation(t,e,n,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return Q0.deprecatedWarning3||(Q0.deprecatedWarning3=!0),this.hasAnimation(t)}};let t1=Q0;t1.emptyAnimation=new T0("<empty>",[],0),t1.SUBSEQUENT=0,t1.FIRST=1,t1.HOLD_SUBSEQUENT=2,t1.HOLD_FIRST=3,t1.HOLD_MIX=4,t1.SETUP=1,t1.CURRENT=2,t1.deprecatedWarning1=!1,t1.deprecatedWarning2=!1,t1.deprecatedWarning3=!1;const e1=class{constructor(){this.mixBlend=CQ.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return e1.deprecatedWarning1||(e1.deprecatedWarning1=!0),this.trackTime}set time(t){e1.deprecatedWarning1||(e1.deprecatedWarning1=!0),this.trackTime=t}get endTime(){return e1.deprecatedWarning2||(e1.deprecatedWarning2=!0),this.trackTime}set endTime(t){e1.deprecatedWarning2||(e1.deprecatedWarning2=!0),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let n1=e1;n1.deprecatedWarning1=!1,n1.deprecatedWarning2=!1;const r1=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(s1.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(s1.interrupt),this.objects.push(t)}end(t){this.objects.push(s1.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(s1.dispose),this.objects.push(t)}complete(t){this.objects.push(s1.complete),this.objects.push(t)}event(t,e){this.objects.push(s1.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return r1.deprecatedWarning1||(r1.deprecatedWarning1=!0),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let n=0;n<t.length;n+=2){const r=t[n],i=t[n+1];switch(r){case s1.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case s1.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(i);break;case s1.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case s1.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(i);this.animState.trackEntryPool.free(i);break;case s1.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(i);const r=YQ.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,r),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,r);break;case s1.event:const s=t[2+n++];null!=i.listener&&i.listener.event&&i.listener.event(i,s);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(i,s);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,s),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,s)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let i1=r1;i1.deprecatedWarning1=!1;var s1=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(s1||{});const o1=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,n){const r=this.skeletonData.findAnimation(t);if(null==r)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,i,n)}setMixByName(t,e,n){o1.deprecatedWarning1||(o1.deprecatedWarning1=!0),this.setMix(t,e,n)}setMixWith(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=n}getMix(t,e){const n=`${t.name}.${e.name}`,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r}};let a1=o1;a1.deprecatedWarning1=!1;let l1=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,n){const r=this.atlas.findRegion(n);if(null==r)throw new Error(`Region not found in atlas: ${n} (region attachment: ${e})`);const i=new E0(e);return i.region=r,i}newMeshAttachment(t,e,n){const r=this.atlas.findRegion(n);if(null==r)throw new Error(`Region not found in atlas: ${n} (mesh attachment: ${e})`);const i=new v0(e);return i.region=r,i}newBoundingBoxAttachment(t,e){return new m0(e)}newPathAttachment(t,e){return new y0(e)}newPointAttachment(t,e){return new b0(e)}newClippingAttachment(t,e){return new g0(e)}},c1=class{constructor(t,e,n){if(this.matrix=new bY,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,n,r,i,s,o){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=o,this.appliedValid=!0;const a=this.parent,l=this.matrix,c=this.skeleton.scaleX,h=-this.skeleton.scaleY;if(null==a){const a=this.skeleton,u=n+90+o;return l.a=YQ.cosDeg(n+s)*r*c,l.c=YQ.cosDeg(u)*i*c,l.b=YQ.sinDeg(n+s)*r*h,l.d=YQ.sinDeg(u)*i*h,l.tx=t*c+a.x,void(l.ty=e*h+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(l.tx=u*t+d*e+a.matrix.tx,l.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case DQ.Normal:{const t=n+90+o,e=YQ.cosDeg(n+s)*r,a=YQ.cosDeg(t)*i,c=YQ.sinDeg(n+s)*r,h=YQ.sinDeg(t)*i;return l.a=u*e+d*c,l.c=u*a+d*h,l.b=f*e+p*c,void(l.d=f*a+p*h)}case DQ.OnlyTranslation:{const t=n+90+o;l.a=YQ.cosDeg(n+s)*r,l.c=YQ.cosDeg(t)*i,l.b=YQ.sinDeg(n+s)*r,l.d=YQ.sinDeg(t)*i;break}case DQ.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=this.skeleton.scaleX,f/=this.skeleton.scaleY,d=f*t,p=u*t,e=Math.atan2(f,u)*YQ.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*YQ.radDeg);const a=n+s-e,c=n+o-e+90,h=YQ.cosDeg(a)*r,m=YQ.cosDeg(c)*i,g=YQ.sinDeg(a)*r,v=YQ.sinDeg(c)*i;l.a=u*h-d*g,l.c=u*m-d*v,l.b=f*h+p*g,l.d=f*m+p*v;break}case DQ.NoScale:case DQ.NoScaleOrReflection:{const t=YQ.cosDeg(n),e=YQ.sinDeg(n);let a=(u*t+d*e)/c,m=(f*t+p*e)/h,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==DQ.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const v=Math.PI/2+Math.atan2(m,a),y=Math.cos(v)*g,b=Math.sin(v)*g,x=YQ.cosDeg(s)*r,w=YQ.cosDeg(90+o)*i,E=YQ.sinDeg(s)*r,_=YQ.sinDeg(90+o)*i;l.a=a*x+y*E,l.c=a*w+y*_,l.b=m*x+b*E,l.d=m*w+b*_;break}}l.a*=c,l.c*=c,l.b*=h,l.d*=h}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*YQ.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*YQ.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*YQ.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*YQ.radDeg);const n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;const o=r*n.d,a=r*n.a,l=r*n.c,c=r*n.b,h=o*e.a-l*e.b,u=o*e.c-l*e.d,d=a*e.b-c*e.a,f=a*e.d-c*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(h*h+d*d),this.ascaleX>1e-4){const t=h*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(h*u+d*f,t)*YQ.radDeg,this.arotation=Math.atan2(d,h)*YQ.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*YQ.radDeg}worldToLocal(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=1/(n*s-r*i),a=t.x-e.tx,l=t.y-e.ty;return t.x=a*s*o-l*r*o,t.y=l*n*o-a*i*o,t}localToWorld(t){const e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*YQ.radDeg}localToWorldRotation(t){const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*YQ.radDeg}rotateWorld(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=YQ.cosDeg(t),a=YQ.sinDeg(t);e.a=o*n-a*i,e.c=o*r-a*s,e.b=a*n+o*i,e.d=a*r+o*s,this.appliedValid=!1}},h1=class{constructor(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=DQ.Normal,this.skinRequired=!1,this.color=new HQ,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n}},u1=class{constructor(t,e,n){this.name=t,this.order=e,this.skinRequired=n}},d1=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},f1=class{constructor(t){this.name=t}},p1=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}}apply1(t,e,n,r,i,s,o){t.appliedValid||t.updateAppliedTransform();const a=t.parent.matrix,l=a.a;let c=a.c;const h=a.b;let u=a.d,d=-t.ashearX-t.arotation,f=0,p=0;switch(t.data.transformMode){case DQ.OnlyTranslation:f=e-t.worldX,p=n-t.worldY;break;case DQ.NoRotationOrReflection:const r=Math.abs(l*u-c*h)/(l*l+h*h),i=l/t.skeleton.scaleX,s=h/t.skeleton.scaleY;c=-s*r*t.skeleton.scaleX,u=i*r*t.skeleton.scaleY,d+=Math.atan2(s,i)*YQ.radDeg;default:const o=e-a.tx,m=n-a.ty,g=l*u-c*h;f=(o*u-m*c)/g-t.ax,p=(m*l-o*h)/g-t.ay}d+=Math.atan2(p,f)*YQ.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let m=t.ascaleX,g=t.ascaleY;if(r||i){switch(t.data.transformMode){case DQ.NoScale:case DQ.NoScaleOrReflection:f=e-t.worldX,p=n-t.worldY}const a=t.data.length*m,l=Math.sqrt(f*f+p*p);if(r&&l<a||i&&l>a&&a>1e-4){const t=(l/a-1)*o+1;m*=t,s&&(g*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*o,m,g,t.ashearX,t.ashearY)}apply2(t,e,n,r,i,s,o,a){if(0==a)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const l=t.ax,c=t.ay;let h=t.ascaleX,u=h,d=t.ascaleY,f=e.ascaleX;const p=t.matrix;let m=0,g=0,v=0;h<0?(h=-h,m=180,v=-1):(m=0,v=1),d<0&&(d=-d,v=-v),f<0?(f=-f,g=180):g=0;const y=e.ax;let b=0,x=0,w=0,E=p.a,_=p.c,S=p.b,T=p.d;const k=Math.abs(h-d)<=1e-4;k?(b=e.ay,x=E*y+_*b+p.tx,w=S*y+T*b+p.ty):(b=0,x=E*y+p.tx,w=S*y+p.ty);const A=t.parent.matrix;E=A.a,_=A.c,S=A.b,T=A.d;const C=1/(E*T-_*S);let R=x-A.tx,M=w-A.ty;const I=(R*T-M*_)*C-l,D=(M*E-R*S)*C-c,O=Math.sqrt(I*I+D*D);let P,L,F=e.data.length*f;if(O<1e-4)return this.apply1(t,n,r,!1,s,!1,a),void e.updateWorldTransformWith(y,b,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);R=n-A.tx,M=r-A.ty;let N=(R*T-M*_)*C-l,B=(M*E-R*S)*C-c,U=N*N+B*B;if(0!=o){o*=h*(f+1)/2;const t=Math.sqrt(U),e=t-O-F*h+o;if(e>0){let n=Math.min(1,e/(2*o))-1;n=(e-o*(1-n*n))/t,N-=n*N,B-=n*B,U=N*N+B*B}}t:if(k){F*=h;let t=(U-O*O-F*F)/(2*O*F);t<-1?t=-1:t>1&&(t=1,s&&(u*=(Math.sqrt(U)/(O+F)-1)*a+1)),L=Math.acos(t)*i,E=O+F*t,_=F*Math.sin(L),P=Math.atan2(B*E-N*_,N*E+B*_)}else{E=h*F,_=d*F;const t=E*E,e=_*_,n=Math.atan2(B,N);S=e*O*O+t*U-t*e;const r=-2*e*O,s=e-t;if(T=r*r-4*s*S,T>=0){let t=Math.sqrt(T);r<0&&(t=-t),t=-(r+t)/2;const e=t/s,o=S/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=U){M=Math.sqrt(U-a*a)*i,P=n-Math.atan2(M,a),L=Math.atan2(M/d,(a-O)/h);break t}}let o=YQ.PI,a=O-E,l=a*a,c=0,u=0,f=O+E,p=f*f,m=0;S=-E*O/(t-e),S>=-1&&S<=1&&(S=Math.acos(S),R=E*Math.cos(S)+O,M=_*Math.sin(S),T=R*R+M*M,T<l&&(o=S,l=T,a=R,c=M),T>p&&(u=S,p=T,f=R,m=M)),U<=(l+p)/2?(P=n-Math.atan2(c*i,a),L=o*i):(P=n-Math.atan2(m*i,f),L=u*i)}const V=Math.atan2(b,y)*v;let j=t.arotation;P=(P-V)*YQ.radDeg+m-j,P>180?P-=360:P<-180&&(P+=360),t.updateWorldTransformWith(l,c,j+P*a,u,t.ascaleY,0,0),j=e.arotation,L=((L+V)*YQ.radDeg-e.ashearX)*v+g-j,L>180?L-=360:L<-180&&(L+=360),e.updateWorldTransformWith(y,b,j+L*a,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},m1=class extends u1{constructor(t){super(t,0,!1),this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}},g1=class extends u1{constructor(t){super(t,0,!1),this.bones=new Array}};var v1=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(v1||{});const y1=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}isActive(){return this.active}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof y0))return;const e=this.rotateMix,n=this.translateMix,r=e>0;if(!(n>0)&&!r)return;const i=this.data,s=i.spacingMode,o=s==v1.Length,a=i.rotateMode,l=a==IQ.Tangent,c=a==IQ.ChainScale,h=this.bones.length,u=l?h:h+1,d=this.bones,f=JQ.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(c||o){c&&(p=JQ.setArraySize(this.lengths,h));for(let t=0,e=u-1;t<e;){const e=d[t],n=e.data.length;if(n<y1.epsilon)c&&(p[t]=0),f[++t]=0;else{const r=n*e.matrix.a,i=n*e.matrix.b,s=Math.sqrt(r*r+i*i);c&&(p[t]=s),f[++t]=(o?n+m:m)*s/n}}}else for(let w=1;w<u;w++)f[w]=m;const g=this.computeWorldPositions(t,u,l,i.positionMode==MQ.Percent,s==v1.Percent);let v=g[0],y=g[1],b=i.offsetRotation,x=!1;if(0==b)x=a==IQ.Chain;else{x=!1;const t=this.target.bone.matrix;b*=t.a*t.d-t.b*t.c>0?YQ.degRad:-YQ.degRad}for(let w=0,E=3;w<h;w++,E+=3){const t=d[w],i=t.matrix;i.tx+=(v-i.tx)*n,i.ty+=(y-i.ty)*n;const s=g[E],o=g[E+1],a=s-v,h=o-y;if(c){const t=p[w];if(0!=t){const n=(Math.sqrt(a*a+h*h)/t-1)*e+1;i.a*=n,i.b*=n}}if(v=s,y=o,r){const n=i.a,r=i.c,s=i.b,o=i.d;let c=0,u=0,d=0;if(l&&(c=l?g[E-1]:0==f[w+1]?g[E+2]:Math.atan2(h,a)),c-=Math.atan2(s,n),x){u=Math.cos(c),d=Math.sin(c);const r=t.data.length;v+=(r*(u*n-d*s)-a)*e,y+=(r*(d*n+u*s)-h)*e}else c+=b;c>YQ.PI?c-=YQ.PI2:c<-YQ.PI&&(c+=YQ.PI2),c*=e,u=Math.cos(c),d=Math.sin(c),i.a=u*n-d*s,i.c=u*r-d*o,i.b=d*n+u*s,i.d=d*r+u*o}t.appliedValid=!1}}computeWorldPositions(t,e,n,r,i){const s=this.target;let o=this.position;const a=this.spaces,l=JQ.setArraySize(this.positions,3*e+2);let c=null;const h=t.closed;let u=t.worldVerticesLength,d=u/6,f=y1.NONE;if(!t.constantSpeed){const p=t.lengths;d-=h?1:2;const m=p[d];if(r&&(o*=m),i)for(let t=0;t<e;t++)a[t]*=m;c=JQ.setArraySize(this.world,8);for(let r=0,i=0,g=0;r<e;r++,i+=3){const e=a[r];o+=e;let v=o;if(h)v%=m,v<0&&(v+=m),g=0;else{if(v<0){f!=y1.BEFORE&&(f=y1.BEFORE,t.computeWorldVertices(s,2,4,c,0,2)),this.addBeforePosition(v,c,0,l,i);continue}if(v>m){f!=y1.AFTER&&(f=y1.AFTER,t.computeWorldVertices(s,u-6,4,c,0,2)),this.addAfterPosition(v-m,c,0,l,i);continue}}for(;;g++){const t=p[g];if(!(v>t)){if(0==g)v/=t;else{const e=p[g-1];v=(v-e)/(t-e)}break}}g!=f&&(f=g,h&&g==d?(t.computeWorldVertices(s,u-4,4,c,0,2),t.computeWorldVertices(s,0,4,c,4,2)):t.computeWorldVertices(s,6*g+2,8,c,0,2)),this.addCurvePosition(v,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],l,i,n||r>0&&0==e)}return l}h?(u+=2,c=JQ.setArraySize(this.world,u),t.computeWorldVertices(s,2,u-4,c,0,2),t.computeWorldVertices(s,0,2,c,u-4,2),c[u-2]=c[0],c[u-1]=c[1]):(d--,u-=4,c=JQ.setArraySize(this.world,u),t.computeWorldVertices(s,2,u,c,0,2));const p=JQ.setArraySize(this.curves,d);let m=0,g=c[0],v=c[1],y=0,b=0,x=0,w=0,E=0,_=0,S=0,T=0,k=0,A=0,C=0,R=0,M=0,I=0;for(let P=0,L=2;P<d;P++,L+=6)y=c[L],b=c[L+1],x=c[L+2],w=c[L+3],E=c[L+4],_=c[L+5],S=.1875*(g-2*y+x),T=.1875*(v-2*b+w),k=.09375*(3*(y-x)-g+E),A=.09375*(3*(b-w)-v+_),C=2*S+k,R=2*T+A,M=.75*(y-g)+S+.16666667*k,I=.75*(b-v)+T+.16666667*A,m+=Math.sqrt(M*M+I*I),M+=C,I+=R,C+=k,R+=A,m+=Math.sqrt(M*M+I*I),M+=C,I+=R,m+=Math.sqrt(M*M+I*I),M+=C+k,I+=R+A,m+=Math.sqrt(M*M+I*I),p[P]=m,g=E,v=_;if(r&&(o*=m),i)for(let P=0;P<e;P++)a[P]*=m;const D=this.segments;let O=0;for(let P=0,L=0,F=0,N=0;P<e;P++,L+=3){const t=a[P];o+=t;let e=o;if(h)e%=m,e<0&&(e+=m),F=0;else{if(e<0){this.addBeforePosition(e,c,0,l,L);continue}if(e>m){this.addAfterPosition(e-m,c,u-4,l,L);continue}}for(;;F++){const t=p[F];if(!(e>t)){if(0==F)e/=t;else{const n=p[F-1];e=(e-n)/(t-n)}break}}if(F!=f){f=F;let t=6*F;for(g=c[t],v=c[t+1],y=c[t+2],b=c[t+3],x=c[t+4],w=c[t+5],E=c[t+6],_=c[t+7],S=.03*(g-2*y+x),T=.03*(v-2*b+w),k=.006*(3*(y-x)-g+E),A=.006*(3*(b-w)-v+_),C=2*S+k,R=2*T+A,M=.3*(y-g)+S+.16666667*k,I=.3*(b-v)+T+.16666667*A,O=Math.sqrt(M*M+I*I),D[0]=O,t=1;t<8;t++)M+=C,I+=R,C+=k,R+=A,O+=Math.sqrt(M*M+I*I),D[t]=O;M+=C,I+=R,O+=Math.sqrt(M*M+I*I),D[8]=O,M+=C+k,I+=R+A,O+=Math.sqrt(M*M+I*I),D[9]=O,N=0}for(e*=O;;N++){const t=D[N];if(!(e>t)){if(0==N)e/=t;else{const n=D[N-1];e=N+(e-n)/(t-n)}break}}this.addCurvePosition(.1*e,g,v,y,b,x,w,E,_,l,L,n||P>0&&0==t)}return l}addBeforePosition(t,e,n,r,i){const s=e[n],o=e[n+1],a=e[n+2]-s,l=e[n+3]-o,c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addAfterPosition(t,e,n,r,i){const s=e[n+2],o=e[n+3],a=s-e[n],l=o-e[n+1],c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addCurvePosition(t,e,n,r,i,s,o,a,l,c,h,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,v=p*t,y=3*v,b=p*y,x=y*t,w=e*g+r*b+s*x+a*f,E=n*g+i*b+o*x+l*f;c[h]=w,c[h+1]=E,u&&(c[h+2]=Math.atan2(E-(n*m+i*v*2+o*d),w-(e*m+r*v*2+s*d)))}};let b1=y1;b1.NONE=-1,b1.BEFORE=-2,b1.AFTER=-3,b1.epsilon=1e-5;let x1=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}isActive(){return this.active}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,o=s.a,a=s.c,l=s.b,c=s.d,h=o*c-a*l>0?YQ.degRad:-YQ.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,f=this.bones;for(let p=0,m=f.length;p<m;p++){const s=f[p];let h=!1;const m=s.matrix;if(0!=t){const e=m.a,n=m.c,r=m.b,i=m.d;let s=Math.atan2(l,o)-Math.atan2(r,e)+u;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const a=Math.cos(s),c=Math.sin(s);m.a=a*e-c*r,m.c=a*n-c*i,m.b=c*e+a*r,m.d=c*n+a*i,h=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,h=!0}if(n>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(o*o+l*l);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*n)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(a*a+c*c),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*n)/t),m.c*=t,m.d*=t,h=!0}if(r>0){const t=m.c,e=m.d,n=Math.atan2(e,t);let i=Math.atan2(c,a)-Math.atan2(l,o)-(n-Math.atan2(m.b,m.a));i>YQ.PI?i-=YQ.PI2:i<-YQ.PI&&(i+=YQ.PI2),i=n+(i+d)*r;const s=Math.sqrt(t*t+e*e);m.c=Math.cos(i)*s,m.d=Math.sin(i)*s,h=!0}h&&(s.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,o=s.a,a=s.c,l=s.b,c=s.d,h=o*c-a*l>0?YQ.degRad:-YQ.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,f=this.bones;for(let p=0,m=f.length;p<m;p++){const s=f[p];let h=!1;const m=s.matrix;if(0!=t){const e=m.a,n=m.c,r=m.b,i=m.d;let s=Math.atan2(l,o)+u;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const a=Math.cos(s),c=Math.sin(s);m.a=a*e-c*r,m.c=a*n-c*i,m.b=c*e+a*r,m.d=c*n+a*i,h=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,h=!0}if(n>0){let t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleX)*n+1;m.a*=t,m.b*=t,t=(Math.sqrt(a*a+c*c)-1+this.data.offsetScaleY)*n+1,m.c*=t,m.d*=t,h=!0}if(r>0){let t=Math.atan2(c,a)-Math.atan2(l,o);t>YQ.PI?t-=YQ.PI2:t<-YQ.PI&&(t+=YQ.PI2);const e=m.c,n=m.d;t=Math.atan2(n,e)+(t-YQ.PI/2+d)*r;const i=Math.sqrt(e*e+n*n);m.c=Math.cos(t)*i,m.d=Math.sin(t)*i,h=!0}h&&(s.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const s=this.bones;for(let o=0,a=s.length;o<a;o++){const a=s[o];a.appliedValid||a.updateAppliedTransform();let l=a.arotation;if(0!=t){let e=i.arotation-l+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),l+=e*t}let c=a.ax,h=a.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,h+=(i.ay-h+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;n>0&&(u>1e-5&&(u=(u+(i.ascaleX-u+this.data.offsetScaleX)*n)/u),d>1e-5&&(d=(d+(i.ascaleY-d+this.data.offsetScaleY)*n)/d));const f=a.ashearY;if(r>0){let t=i.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),a.shearY+=t*r}a.updateWorldTransformWith(c,h,l,u,d,a.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const s=this.bones;for(let o=0,a=s.length;o<a;o++){const a=s[o];a.appliedValid||a.updateAppliedTransform();let l=a.arotation;0!=t&&(l+=(i.arotation+this.data.offsetRotation)*t);let c=a.ax,h=a.ay;0!=e&&(c+=(i.ax+this.data.offsetX)*e,h+=(i.ay+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;n>0&&(u>1e-5&&(u*=(i.ascaleX-1+this.data.offsetScaleX)*n+1),d>1e-5&&(d*=(i.ascaleY-1+this.data.offsetScaleY)*n+1));let f=a.ashearY;r>0&&(f+=(i.ashearY+this.data.offsetShearY)*r),a.updateWorldTransformWith(c,h,l,u,d,a.ashearX,f)}}};const w1=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const n=t.bones[e];let r;if(null==n.parent)r=new c1(n,this,null);else{const t=this.bones[n.parent.index];r=new c1(n,this,t),t.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const n=t.slots[e],r=this.bones[n.boneData.index],i=new x0(n,r);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const n=t.ikConstraints[e];this.ikConstraints.push(new p1(n,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const n=t.transformConstraints[e];this.transformConstraints.push(new x1(n,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const n=t.pathConstraints[e];this.pathConstraints.push(new b1(n,this))}this.color=new HQ(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let l=0,c=t.length;l<c;l++){const e=t[l];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(null!=this.skin){const t=this.skin.bones;for(let e=0,n=this.skin.bones.length;e<n;e++){let n=this.bones[t[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(null!=n)}}const e=this.ikConstraints,n=this.transformConstraints,r=this.pathConstraints,i=e.length,s=n.length,o=r.length,a=i+s+o;t:for(let l=0;l<a;l++){for(let t=0;t<i;t++){const n=e[t];if(n.data.order==l){this.sortIkConstraint(n);continue t}}for(let t=0;t<s;t++){const e=n[t];if(e.data.order==l){this.sortTransformConstraint(e);continue t}}for(let t=0;t<o;t++){const e=r[t];if(e.data.order==l){this.sortPathConstraint(e);continue t}}}for(let l=0,c=t.length;l<c;l++)this.sortBone(t[l])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const n=t.bones,r=n[0];if(this.sortBone(r),n.length>1){const t=n[n.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(r.children),n[n.length-1].sorted=!0}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||null!=this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,n=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(let a=0,l=this.data.skins.length;a<l;a++)this.sortPathConstraintAttachment(this.data.skins[a],n,r);const i=e.getAttachment();i instanceof y0&&this.sortPathConstraintAttachmentWith(i,r);const s=t.bones,o=s.length;for(let a=0;a<o;a++)this.sortBone(s[a]);this._updateCache.push(t);for(let a=0;a<o;a++)this.sortReset(s[a].children);for(let a=0;a<o;a++)s[a].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||null!=this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,n=e.length;if(t.data.local)for(let r=0;r<n;r++){const t=e[r];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<n;r++)this.sortReset(e[r].children);for(let r=0;r<n;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,n){const r=t.attachments[e];if(r)for(const i in r)this.sortPathConstraintAttachmentWith(r[i],n)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof y0))return;const n=t.bones;if(null==n)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<n.length;){const r=n[e++];for(let i=e+r;e<i;e++){const r=n[e];this.sortBone(t[r])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}updateWorldTransform(){const t=this.updateCacheReset;for(let n=0,r=t.length;n<r;n++){const e=t[n];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let n=0,r=e.length;n<r;n++)e[n].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,s=t.length;i<s;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,s=e.length;i<s;i++){const t=e[i];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const n=this.transformConstraints;for(let i=0,s=n.length;i<s;i++){const t=n[i],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const r=this.pathConstraints;for(let i=0,s=r.length;i<s;i++){const t=r[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;JQ.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n],i=r.data.attachmentName;if(null!=i){const e=t.getAttachment(n,i);null!=e&&r.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const n=this.slots;for(let r=0,i=n.length;r<i;r++){const i=n[r];if(i.data.name==t){let n=null;if(null!=e&&(n=this.getAttachment(r,e),null==n))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(n)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}getBounds(t,e,n=new Array(2)){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const r=this.drawOrder;let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let l=0,c=r.length;l<c;l++){const t=r[l];if(!t.bone.active)continue;let e=0,c=null;const h=t.getAttachment();if(h instanceof E0)e=8,c=JQ.setArraySize(n,e,0),h.computeWorldVertices(t.bone,c,0,2);else if(h instanceof v0){const r=h;e=r.worldVerticesLength,c=JQ.setArraySize(n,e,0),r.computeWorldVertices(t,0,e,c,0,2)}if(null!=c)for(let n=0,r=c.length;n<r;n+=2){const t=c[n],e=c[n+1];i=Math.min(i,t),s=Math.min(s,e),o=Math.max(o,t),a=Math.max(a,e)}}t.set(i,s),e.set(o-i,a-s)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){w1.deprecatedWarning1||(w1.deprecatedWarning1=!0),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){w1.deprecatedWarning1||(w1.deprecatedWarning1=!0),this.scaleY=t?1:-1}};let E1=w1;E1.deprecatedWarning1=!1;let _1=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}},S1=class{constructor(t,e,n){if(this.color=new HQ(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n}},T1=class extends u1{constructor(t){super(t,0,!1),this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}},k1=class{constructor(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n}},A1=class{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,n){if(null==n)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n}addSkin(t){for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let n=0;n<t.constraints.length;n++){const e=t.constraints[n];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let n=0;n<e.length;n++){const t=e[n];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let n=0;n<t.constraints.length;n++){const e=t.constraints[n];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let n=0;n<e.length;n++){const t=e[n];null!=t.attachment&&(t.attachment instanceof v0?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const n=this.attachments[t];return n?n[e]:null}removeAttachment(t,e){const n=this.attachments[t];n&&(n[e]=null)}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const n=this.attachments[e];if(n)for(const r in n){const i=n[r];i&&t.push(new k1(e,r,i))}}return t}getAttachmentsForSlot(t,e){const n=this.attachments[t];if(n)for(const r in n){const i=n[r];i&&e.push(new k1(t,r,i))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let n=0;for(let r=0;r<t.slots.length;r++){const i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){const t=e.attachments[n];for(const e in t){if(s==t[e]){const t=this.getAttachment(n,e);null!=t&&i.setAttachment(t);break}}}n++}}};const C1=class{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,n=new _1;n.name="";const r=new AQ(t);if(n.hash=r.readString(),n.version=r.readString(),"3.8.75"===n.version){}n.x=r.readFloat(),n.y=r.readFloat(),n.width=r.readFloat(),n.height=r.readFloat();const i=r.readBoolean();i&&(n.fps=r.readFloat(),n.imagesPath=r.readString(),n.audioPath=r.readString());let s=0;s=r.readInt(!0);for(let a=0;a<s;a++)r.strings.push(r.readString());s=r.readInt(!0);for(let a=0;a<s;a++){const t=r.readString(),s=0==a?null:n.bones[r.readInt(!0)],o=new h1(a,t,s);o.rotation=r.readFloat(),o.x=r.readFloat()*e,o.y=r.readFloat()*e,o.scaleX=r.readFloat(),o.scaleY=r.readFloat(),o.shearX=r.readFloat(),o.shearY=r.readFloat(),o.length=r.readFloat()*e,o.transformMode=C1.TransformModeValues[r.readInt(!0)],o.skinRequired=r.readBoolean(),i&&HQ.rgba8888ToColor(o.color,r.readInt32()),n.bones.push(o)}s=r.readInt(!0);for(let a=0;a<s;a++){const t=r.readString(),e=n.bones[r.readInt(!0)],i=new S1(a,t,e);HQ.rgba8888ToColor(i.color,r.readInt32());const s=r.readInt32();-1!=s&&HQ.rgb888ToColor(i.darkColor=new HQ,s),i.attachmentName=r.readStringRef(),i.blendMode=C1.BlendModeValues[r.readInt(!0)],n.slots.push(i)}s=r.readInt(!0);for(let a,l=0;l<s;l++){const t=new m1(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),a=r.readInt(!0);for(let e=0;e<a;e++)t.bones.push(n.bones[r.readInt(!0)]);t.target=n.bones[r.readInt(!0)],t.mix=r.readFloat(),t.softness=r.readFloat()*e,t.bendDirection=r.readByte(),t.compress=r.readBoolean(),t.stretch=r.readBoolean(),t.uniform=r.readBoolean(),n.ikConstraints.push(t)}s=r.readInt(!0);for(let a,l=0;l<s;l++){const t=new T1(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),a=r.readInt(!0);for(let e=0;e<a;e++)t.bones.push(n.bones[r.readInt(!0)]);t.target=n.bones[r.readInt(!0)],t.local=r.readBoolean(),t.relative=r.readBoolean(),t.offsetRotation=r.readFloat(),t.offsetX=r.readFloat()*e,t.offsetY=r.readFloat()*e,t.offsetScaleX=r.readFloat(),t.offsetScaleY=r.readFloat(),t.offsetShearY=r.readFloat(),t.rotateMix=r.readFloat(),t.translateMix=r.readFloat(),t.scaleMix=r.readFloat(),t.shearMix=r.readFloat(),n.transformConstraints.push(t)}s=r.readInt(!0);for(let a,l=0;l<s;l++){const t=new g1(r.readString());t.order=r.readInt(!0),t.skinRequired=r.readBoolean(),a=r.readInt(!0);for(let e=0;e<a;e++)t.bones.push(n.bones[r.readInt(!0)]);t.target=n.slots[r.readInt(!0)],t.positionMode=C1.PositionModeValues[r.readInt(!0)],t.spacingMode=C1.SpacingModeValues[r.readInt(!0)],t.rotateMode=C1.RotateModeValues[r.readInt(!0)],t.offsetRotation=r.readFloat(),t.position=r.readFloat(),t.positionMode==MQ.Fixed&&(t.position*=e),t.spacing=r.readFloat(),t.spacingMode!=v1.Length&&t.spacingMode!=v1.Fixed||(t.spacing*=e),t.rotateMix=r.readFloat(),t.translateMix=r.readFloat(),n.pathConstraints.push(t)}const o=this.readSkin(r,n,!0,i);null!=o&&(n.defaultSkin=o,n.skins.push(o));{let t=n.skins.length;for(JQ.setArraySize(n.skins,s=t+r.readInt(!0));t<s;t++)n.skins[t]=this.readSkin(r,n,!1,i)}s=this.linkedMeshes.length;for(let a=0;a<s;a++){const t=this.linkedMeshes[a],e=null==t.skin?n.defaultSkin:n.findSkin(t.skin);if(null==e)throw new Error(`Skin not found: ${t.skin}`);const r=e.getAttachment(t.slotIndex,t.parent);if(null==r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.deformAttachment=t.inheritDeform?r:t.mesh,t.mesh.setParentMesh(r)}this.linkedMeshes.length=0,s=r.readInt(!0);for(let a=0;a<s;a++){const t=new f1(r.readStringRef());t.intValue=r.readInt(!1),t.floatValue=r.readFloat(),t.stringValue=r.readString(),t.audioPath=r.readString(),null!=t.audioPath&&(t.volume=r.readFloat(),t.balance=r.readFloat()),n.events.push(t)}s=r.readInt(!0);for(let a=0;a<s;a++)n.animations.push(this.readAnimation(r,r.readString(),n));return n}readSkin(t,e,n,r){let i=null,s=0;if(n){if(s=t.readInt(!0),0==s)return null;i=new A1("default")}else{i=new A1(t.readStringRef()),i.bones.length=t.readInt(!0);for(let n=0,r=i.bones.length;n<r;n++)i.bones[n]=e.bones[t.readInt(!0)];for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let n=0,r=t.readInt(!0);n<r;n++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(let o=0;o<s;o++){const n=t.readInt(!0);for(let s=0,o=t.readInt(!0);s<o;s++){const s=t.readStringRef(),o=this.readAttachment(t,e,i,n,s,r);null!=o&&i.setAttachment(n,s,o)}}return i}readAttachment(t,e,n,r,i,s){const o=this.scale;let a=t.readStringRef();null==a&&(a=i);const l=t.readByte();switch(C1.AttachmentTypeValues[l]){case kQ.Region:{let e=t.readStringRef();const r=t.readFloat(),i=t.readFloat(),s=t.readFloat(),l=t.readFloat(),c=t.readFloat(),h=t.readFloat(),u=t.readFloat(),d=t.readInt32();null==e&&(e=a);const f=this.attachmentLoader.newRegionAttachment(n,a,e);return null==f?null:(f.path=e,f.x=i*o,f.y=s*o,f.scaleX=l,f.scaleY=c,f.rotation=r,f.width=h*o,f.height=u*o,HQ.rgba8888ToColor(f.color,d),f)}case kQ.BoundingBox:{const e=t.readInt(!0),r=this.readVertices(t,e),i=s?t.readInt32():0,o=this.attachmentLoader.newBoundingBoxAttachment(n,a);return null==o?null:(o.worldVerticesLength=e<<1,o.vertices=r.vertices,o.bones=r.bones,s&&HQ.rgba8888ToColor(o.color,i),o)}case kQ.Mesh:{let e=t.readStringRef();const r=t.readInt32(),i=t.readInt(!0),l=this.readFloatArray(t,i<<1,1),c=this.readShortArray(t),h=this.readVertices(t,i),u=t.readInt(!0);let d=null,f=0,p=0;s&&(d=this.readShortArray(t),f=t.readFloat(),p=t.readFloat()),null==e&&(e=a);const m=this.attachmentLoader.newMeshAttachment(n,a,e);return null==m?null:(m.path=e,HQ.rgba8888ToColor(m.color,r),m.bones=h.bones,m.vertices=h.vertices,m.worldVerticesLength=i<<1,m.triangles=c,m.regionUVs=new Float32Array(l),m.hullLength=u<<1,s&&(m.edges=d,m.width=f*o,m.height=p*o),m)}case kQ.LinkedMesh:{let e=t.readStringRef();const i=t.readInt32(),l=t.readStringRef(),c=t.readStringRef(),h=t.readBoolean();let u=0,d=0;s&&(u=t.readFloat(),d=t.readFloat()),null==e&&(e=a);const f=this.attachmentLoader.newMeshAttachment(n,a,e);return null==f?null:(f.path=e,HQ.rgba8888ToColor(f.color,i),s&&(f.width=u*o,f.height=d*o),this.linkedMeshes.push(new M1(f,l,r,c,h)),f)}case kQ.Path:{const e=t.readBoolean(),r=t.readBoolean(),i=t.readInt(!0),l=this.readVertices(t,i),c=JQ.newArray(i/3,0);for(let n=0,s=c.length;n<s;n++)c[n]=t.readFloat()*o;const h=s?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(n,a);return null==u?null:(u.closed=e,u.constantSpeed=r,u.worldVerticesLength=i<<1,u.vertices=l.vertices,u.bones=l.bones,u.lengths=c,s&&HQ.rgba8888ToColor(u.color,h),u)}case kQ.Point:{const e=t.readFloat(),r=t.readFloat(),i=t.readFloat(),l=s?t.readInt32():0,c=this.attachmentLoader.newPointAttachment(n,a);return null==c?null:(c.x=r*o,c.y=i*o,c.rotation=e,s&&HQ.rgba8888ToColor(c.color,l),c)}case kQ.Clipping:{const r=t.readInt(!0),i=t.readInt(!0),o=this.readVertices(t,i),l=s?t.readInt32():0,c=this.attachmentLoader.newClippingAttachment(n,a);return null==c?null:(c.endSlot=e.slots[r],c.worldVerticesLength=i<<1,c.vertices=o.vertices,c.bones=o.bones,s&&HQ.rgba8888ToColor(c.color,l),c)}}return null}readVertices(t,e){const n=e<<1,r=new I1,i=this.scale;if(!t.readBoolean())return r.vertices=this.readFloatArray(t,n,i),r;const s=new Array,o=new Array;for(let a=0;a<e;a++){const e=t.readInt(!0);o.push(e);for(let n=0;n<e;n++)o.push(t.readInt(!0)),s.push(t.readFloat()*i),s.push(t.readFloat()*i),s.push(t.readFloat())}return r.vertices=JQ.toFloatArray(s),r.bones=o,r}readFloatArray(t,e,n){const r=new Array(e);if(1==n)for(let i=0;i<e;i++)r[i]=t.readFloat();else for(let i=0;i<e;i++)r[i]=t.readFloat()*n;return r}readShortArray(t){const e=t.readInt(!0),n=new Array(e);for(let r=0;r<e;r++)n[r]=t.readShort();return n}readAnimation(t,e,n){const r=new Array,i=this.scale;let s=0;const o=new HQ,a=new HQ;for(let h=0,u=t.readInt(!0);h<u;h++){const e=t.readInt(!0);for(let n=0,i=t.readInt(!0);n<i;n++){const n=t.readByte(),i=t.readInt(!0);switch(n){case C1.SLOT_ATTACHMENT:{const n=new U0(i);n.slotIndex=e;for(let e=0;e<i;e++)n.setFrame(e,t.readFloat(),t.readStringRef());r.push(n),s=Math.max(s,n.frames[i-1]);break}case C1.SLOT_COLOR:{const n=new F0(i);n.slotIndex=e;for(let e=0;e<i;e++){const r=t.readFloat();HQ.rgba8888ToColor(o,t.readInt32()),n.setFrame(e,r,o.r,o.g,o.b,o.a),e<i-1&&this.readCurve(t,e,n)}r.push(n),s=Math.max(s,n.frames[(i-1)*F0.ENTRIES]);break}case C1.SLOT_TWO_COLOR:{const n=new B0(i);n.slotIndex=e;for(let e=0;e<i;e++){const r=t.readFloat();HQ.rgba8888ToColor(o,t.readInt32()),HQ.rgb888ToColor(a,t.readInt32()),n.setFrame(e,r,o.r,o.g,o.b,o.a,a.r,a.g,a.b),e<i-1&&this.readCurve(t,e,n)}r.push(n),s=Math.max(s,n.frames[(i-1)*B0.ENTRIES]);break}}}}for(let h=0,u=t.readInt(!0);h<u;h++){const e=t.readInt(!0);for(let n=0,o=t.readInt(!0);n<o;n++){const n=t.readByte(),o=t.readInt(!0);switch(n){case C1.BONE_ROTATE:{const n=new M0(o);n.boneIndex=e;for(let e=0;e<o;e++)n.setFrame(e,t.readFloat(),t.readFloat()),e<o-1&&this.readCurve(t,e,n);r.push(n),s=Math.max(s,n.frames[(o-1)*M0.ENTRIES]);break}case C1.BONE_TRANSLATE:case C1.BONE_SCALE:case C1.BONE_SHEAR:{let a,l=1;n==C1.BONE_SCALE?a=new O0(o):n==C1.BONE_SHEAR?a=new P0(o):(a=new D0(o),l=i),a.boneIndex=e;for(let e=0;e<o;e++)a.setFrame(e,t.readFloat(),t.readFloat()*l,t.readFloat()*l),e<o-1&&this.readCurve(t,e,a);r.push(a),s=Math.max(s,a.frames[(o-1)*D0.ENTRIES]);break}}}}for(let h=0,u=t.readInt(!0);h<u;h++){const e=t.readInt(!0),n=t.readInt(!0),o=new H0(n);o.ikConstraintIndex=e;for(let r=0;r<n;r++)o.setFrame(r,t.readFloat(),t.readFloat(),t.readFloat()*i,t.readByte(),t.readBoolean(),t.readBoolean()),r<n-1&&this.readCurve(t,r,o);r.push(o),s=Math.max(s,o.frames[(n-1)*H0.ENTRIES])}for(let h=0,u=t.readInt(!0);h<u;h++){const e=t.readInt(!0),n=t.readInt(!0),i=new Y0(n);i.transformConstraintIndex=e;for(let r=0;r<n;r++)i.setFrame(r,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat()),r<n-1&&this.readCurve(t,r,i);r.push(i),s=Math.max(s,i.frames[(n-1)*Y0.ENTRIES])}for(let h=0,u=t.readInt(!0);h<u;h++){const e=t.readInt(!0),o=n.pathConstraints[e];for(let n=0,a=t.readInt(!0);n<a;n++){const n=t.readByte(),a=t.readInt(!0);switch(n){case C1.PATH_POSITION:case C1.PATH_SPACING:{let l,c=1;n==C1.PATH_SPACING?(l=new K0(a),o.spacingMode!=v1.Length&&o.spacingMode!=v1.Fixed||(c=i)):(l=new q0(a),o.positionMode==MQ.Fixed&&(c=i)),l.pathConstraintIndex=e;for(let e=0;e<a;e++)l.setFrame(e,t.readFloat(),t.readFloat()*c),e<a-1&&this.readCurve(t,e,l);r.push(l),s=Math.max(s,l.frames[(a-1)*q0.ENTRIES]);break}case C1.PATH_MIX:{const n=new J0(a);n.pathConstraintIndex=e;for(let e=0;e<a;e++)n.setFrame(e,t.readFloat(),t.readFloat(),t.readFloat()),e<a-1&&this.readCurve(t,e,n);r.push(n),s=Math.max(s,n.frames[(a-1)*J0.ENTRIES]);break}}}}for(let h=0,u=t.readInt(!0);h<u;h++){const e=n.skins[t.readInt(!0)];for(let n=0,o=t.readInt(!0);n<o;n++){const n=t.readInt(!0);for(let o=0,a=t.readInt(!0);o<a;o++){const o=e.getAttachment(n,t.readStringRef()),a=null!=o.bones,l=o.vertices,c=a?l.length/3*2:l.length,h=t.readInt(!0),u=new j0(h);u.slotIndex=n,u.attachment=o;for(let e=0;e<h;e++){const n=t.readFloat();let r,s=t.readInt(!0);if(0==s)r=a?JQ.newFloatArray(c):l;else{r=JQ.newFloatArray(c);const e=t.readInt(!0);if(s+=e,1==i)for(let n=e;n<s;n++)r[n]=t.readFloat();else for(let n=e;n<s;n++)r[n]=t.readFloat()*i;if(!a)for(let t=0,n=r.length;t<n;t++)r[t]+=l[t]}u.setFrame(e,n,r),e<h-1&&this.readCurve(t,e,u)}r.push(u),s=Math.max(s,u.frames[h-1])}}}const l=t.readInt(!0);if(l>0){const e=new G0(l),i=n.slots.length;for(let n=0;n<l;n++){const r=t.readFloat(),s=t.readInt(!0),o=JQ.newArray(i,0);for(let t=i-1;t>=0;t--)o[t]=-1;const a=JQ.newArray(i-s,0);let l=0,c=0;for(let e=0;e<s;e++){const e=t.readInt(!0);for(;l!=e;)a[c++]=l++;o[l+t.readInt(!0)]=l++}for(;l<i;)a[c++]=l++;for(let t=i-1;t>=0;t--)-1==o[t]&&(o[t]=a[--c]);e.setFrame(n,r,o)}r.push(e),s=Math.max(s,e.frames[l-1])}const c=t.readInt(!0);if(c>0){const e=new z0(c);for(let r=0;r<c;r++){const i=t.readFloat(),s=n.events[t.readInt(!0)],o=new d1(i,s);o.intValue=t.readInt(!1),o.floatValue=t.readFloat(),o.stringValue=t.readBoolean()?t.readString():s.stringValue,null!=o.data.audioPath&&(o.volume=t.readFloat(),o.balance=t.readFloat()),e.setFrame(r,o)}r.push(e),s=Math.max(s,e.frames[c-1])}return new T0(e,r,s)}readCurve(t,e,n){switch(t.readByte()){case C1.CURVE_STEPPED:n.setStepped(e);break;case C1.CURVE_BEZIER:this.setCurve(n,e,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}}setCurve(t,e,n,r,i,s){t.setCurve(e,n,r,i,s)}};let R1=C1;R1.AttachmentTypeValues=[0,1,2,3,4,5,6],R1.TransformModeValues=[DQ.Normal,DQ.OnlyTranslation,DQ.NoRotationOrReflection,DQ.NoScale,DQ.NoScaleOrReflection],R1.PositionModeValues=[MQ.Fixed,MQ.Percent],R1.SpacingModeValues=[v1.Length,v1.Fixed,v1.Percent],R1.RotateModeValues=[IQ.Tangent,IQ.Chain,IQ.ChainScale],R1.BlendModeValues=[CW.NORMAL,CW.ADD,CW.MULTIPLY,CW.SCREEN],R1.BONE_ROTATE=0,R1.BONE_TRANSLATE=1,R1.BONE_SCALE=2,R1.BONE_SHEAR=3,R1.SLOT_ATTACHMENT=0,R1.SLOT_COLOR=1,R1.SLOT_TWO_COLOR=2,R1.PATH_POSITION=0,R1.PATH_SPACING=1,R1.PATH_MIX=2,R1.CURVE_LINEAR=0,R1.CURVE_STEPPED=1,R1.CURVE_BEZIER=2;let M1=class{constructor(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i}},I1=class{constructor(t=null,e=null){this.bones=t,this.vertices=e}},D1=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const n=this.scale,r=new _1,i="string"==typeof e?JSON.parse(e):e,s=i.skeleton;if(null!=s){if(r.hash=s.hash,r.version=s.spine,"3.8"!==r.version.substr(0,3)){s.spine}if("3.8.75"===r.version){}r.x=s.x,r.y=s.y,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images}if(i.bones)for(let o=0;o<i.bones.length;o++){const e=i.bones[o];let s=null;const a=this.getValue(e,"parent",null);if(null!=a&&(s=r.findBone(a),null==s))throw new Error(`Parent bone not found: ${a}`);const l=new h1(r.bones.length,e.name,s);l.length=this.getValue(e,"length",0)*n,l.x=this.getValue(e,"x",0)*n,l.y=this.getValue(e,"y",0)*n,l.rotation=this.getValue(e,"rotation",0),l.scaleX=this.getValue(e,"scaleX",1),l.scaleY=this.getValue(e,"scaleY",1),l.shearX=this.getValue(e,"shearX",0),l.shearY=this.getValue(e,"shearY",0),l.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),l.skinRequired=this.getValue(e,"skin",!1),r.bones.push(l)}if(i.slots)for(let o=0;o<i.slots.length;o++){const e=i.slots[o],n=e.name,s=e.bone,a=r.findBone(s);if(null==a)throw new Error(`Slot bone not found: ${s}`);const l=new S1(r.slots.length,n,a),c=this.getValue(e,"color",null);null!=c&&l.color.setFromString(c);const h=this.getValue(e,"dark",null);null!=h&&(l.darkColor=new HQ(1,1,1,1),l.darkColor.setFromString(h)),l.attachmentName=this.getValue(e,"attachment",null),l.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(l)}if(i.ik)for(let t=0;t<i.ik.length;t++){const e=i.ik[t],s=new m1(e.name);s.order=this.getValue(e,"order",0),s.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`IK bone not found: ${n}`);s.bones.push(i)}const o=e.target;if(s.target=r.findBone(o),null==s.target)throw new Error(`IK target bone not found: ${o}`);s.mix=this.getValue(e,"mix",1),s.softness=this.getValue(e,"softness",0)*n,s.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,s.compress=this.getValue(e,"compress",!1),s.stretch=this.getValue(e,"stretch",!1),s.uniform=this.getValue(e,"uniform",!1),r.ikConstraints.push(s)}if(i.transform)for(let t=0;t<i.transform.length;t++){const e=i.transform[t],s=new T1(e.name);s.order=this.getValue(e,"order",0),s.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`Transform constraint bone not found: ${n}`);s.bones.push(i)}const o=e.target;if(s.target=r.findBone(o),null==s.target)throw new Error(`Transform constraint target bone not found: ${o}`);s.local=this.getValue(e,"local",!1),s.relative=this.getValue(e,"relative",!1),s.offsetRotation=this.getValue(e,"rotation",0),s.offsetX=this.getValue(e,"x",0)*n,s.offsetY=this.getValue(e,"y",0)*n,s.offsetScaleX=this.getValue(e,"scaleX",0),s.offsetScaleY=this.getValue(e,"scaleY",0),s.offsetShearY=this.getValue(e,"shearY",0),s.rotateMix=this.getValue(e,"rotateMix",1),s.translateMix=this.getValue(e,"translateMix",1),s.scaleMix=this.getValue(e,"scaleMix",1),s.shearMix=this.getValue(e,"shearMix",1),r.transformConstraints.push(s)}if(i.path)for(let o=0;o<i.path.length;o++){const e=i.path[o],s=new g1(e.name);s.order=this.getValue(e,"order",0),s.skinRequired=this.getValue(e,"skin",!1);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`Transform constraint bone not found: ${n}`);s.bones.push(i)}const a=e.target;if(s.target=r.findSlot(a),null==s.target)throw new Error(`Path target slot not found: ${a}`);s.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),s.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),s.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),s.offsetRotation=this.getValue(e,"rotation",0),s.position=this.getValue(e,"position",0),s.positionMode==MQ.Fixed&&(s.position*=n),s.spacing=this.getValue(e,"spacing",0),s.spacingMode!=v1.Length&&s.spacingMode!=v1.Fixed||(s.spacing*=n),s.rotateMix=this.getValue(e,"rotateMix",1),s.translateMix=this.getValue(e,"translateMix",1),r.pathConstraints.push(s)}if(i.skins)for(let t=0;t<i.skins.length;t++){const e=i.skins[t],n=new A1(e.name);if(e.bones)for(let i=0;i<e.bones.length;i++){const s=r.findBone(e.bones[i]);if(null==s)throw new Error(`Skin bone not found: ${e.bones[t]}`);n.bones.push(s)}if(e.ik)for(let i=0;i<e.ik.length;i++){const s=r.findIkConstraint(e.ik[i]);if(null==s)throw new Error(`Skin IK constraint not found: ${e.ik[t]}`);n.constraints.push(s)}if(e.transform)for(let i=0;i<e.transform.length;i++){const s=r.findTransformConstraint(e.transform[i]);if(null==s)throw new Error(`Skin transform constraint not found: ${e.transform[t]}`);n.constraints.push(s)}if(e.path)for(let i=0;i<e.path.length;i++){const s=r.findPathConstraint(e.path[i]);if(null==s)throw new Error(`Skin path constraint not found: ${e.path[t]}`);n.constraints.push(s)}for(const t in e.attachments){const i=r.findSlot(t);if(null==i)throw new Error(`Slot not found: ${t}`);const s=e.attachments[t];for(const t in s){const e=this.readAttachment(s[t],n,i.index,t,r);null!=e&&n.setAttachment(i.index,t,e)}}r.skins.push(n),"default"==n.name&&(r.defaultSkin=n)}for(let t=0,o=this.linkedMeshes.length;t<o;t++){const e=this.linkedMeshes[t],n=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==n)throw new Error(`Skin not found: ${e.skin}`);const i=n.getAttachment(e.slotIndex,e.parent);if(null==i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.deformAttachment=e.inheritDeform?i:e.mesh,e.mesh.setParentMesh(i)}if(this.linkedMeshes.length=0,i.events)for(const t in i.events){const e=i.events[t],n=new f1(t);n.intValue=this.getValue(e,"int",0),n.floatValue=this.getValue(e,"float",0),n.stringValue=this.getValue(e,"string",""),n.audioPath=this.getValue(e,"audio",null),null!=n.audioPath&&(n.volume=this.getValue(e,"volume",1),n.balance=this.getValue(e,"balance",0)),r.events.push(n)}if(i.animations)for(const t in i.animations){const e=i.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,n,r,i){const s=this.scale;r=this.getValue(t,"name",r);switch(this.getValue(t,"type","region")){case"region":{const n=this.getValue(t,"path",r),i=this.attachmentLoader.newRegionAttachment(e,r,n);if(null==i)return null;i.path=n,i.x=this.getValue(t,"x",0)*s,i.y=this.getValue(t,"y",0)*s,i.scaleX=this.getValue(t,"scaleX",1),i.scaleY=this.getValue(t,"scaleY",1),i.rotation=this.getValue(t,"rotation",0),i.width=t.width*s,i.height=t.height*s;const o=this.getValue(t,"color",null);return null!=o&&i.color.setFromString(o),i}case"boundingbox":{const n=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(null==n)return null;this.readVertices(t,n,t.vertexCount<<1);const i=this.getValue(t,"color",null);return null!=i&&n.color.setFromString(i),n}case"mesh":case"linkedmesh":{const i=this.getValue(t,"path",r),o=this.attachmentLoader.newMeshAttachment(e,r,i);if(null==o)return null;o.path=i;const a=this.getValue(t,"color",null);null!=a&&o.color.setFromString(a),o.width=this.getValue(t,"width",0)*s,o.height=this.getValue(t,"height",0)*s;const l=this.getValue(t,"parent",null);if(null!=l)return this.linkedMeshes.push(new O1(o,this.getValue(t,"skin",null),n,l,this.getValue(t,"deform",!0))),o;const c=t.uvs;return this.readVertices(t,o,c.length),o.triangles=t.triangles,o.regionUVs=new Float32Array(c),o.edges=this.getValue(t,"edges",null),o.hullLength=2*this.getValue(t,"hull",0),o}case"path":{const n=this.attachmentLoader.newPathAttachment(e,r);if(null==n)return null;n.closed=this.getValue(t,"closed",!1),n.constantSpeed=this.getValue(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,n,i<<1);const o=JQ.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*s;n.lengths=o;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"point":{const n=this.attachmentLoader.newPointAttachment(e,r);if(null==n)return null;n.x=this.getValue(t,"x",0)*s,n.y=this.getValue(t,"y",0)*s,n.rotation=this.getValue(t,"rotation",0);const i=this.getValue(t,"color",null);return null!=i&&n.color.setFromString(i),n}case"clipping":{const n=this.attachmentLoader.newClippingAttachment(e,r);if(null==n)return null;const s=this.getValue(t,"end",null);if(null!=s){const t=i.findSlot(s);if(null==t)throw new Error(`Clipping end slot not found: ${s}`);n.endSlot=t}const o=t.vertexCount;this.readVertices(t,n,o<<1);const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}}return null}readVertices(t,e,n){const r=this.scale;e.worldVerticesLength=n;const i=t.vertices;if(n==i.length){const t=JQ.toFloatArray(i);if(1!=r)for(let e=0,n=i.length;e<n;e++)t[e]*=r;return void(e.vertices=t)}const s=new Array,o=new Array;for(let a=0,l=i.length;a<l;){const t=i[a++];o.push(t);for(let e=a+4*t;a<e;a+=4)o.push(i[a]),s.push(i[a+1]*r),s.push(i[a+2]*r),s.push(i[a+3])}e.bones=o,e.vertices=JQ.toFloatArray(s)}readAnimation(t,e,n){const r=this.scale,i=new Array;let s=0;if(t.slots)for(const a in t.slots){const e=t.slots[a],r=n.findSlotIndex(a);if(-1==r)throw new Error(`Slot not found: ${a}`);for(const t in e){const n=e[t];if("attachment"==t){const t=new U0(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e++,this.getValue(i,"time",0),i.name)}i.push(t),s=Math.max(s,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new F0(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r],s=new HQ;s.setFromString(i.color||"ffffffff"),t.setFrame(e,this.getValue(i,"time",0),s.r,s.g,s.b,s.a),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*F0.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${a})`);{const t=new B0(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r],s=new HQ,o=new HQ;s.setFromString(i.light),o.setFromString(i.dark),t.setFrame(e,this.getValue(i,"time",0),s.r,s.g,s.b,s.a,o.r,o.g,o.b),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*B0.ENTRIES])}}}}if(t.bones)for(const a in t.bones){const e=t.bones[a],o=n.findBoneIndex(a);if(-1==o)throw new Error(`Bone not found: ${a}`);for(const t in e){const n=e[t];if("rotate"===t){const t=new M0(n.length);t.boneIndex=o;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e,this.getValue(i,"time",0),this.getValue(i,"angle",0)),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*M0.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${a})`);{let e=null,a=1,l=0;"scale"===t?(e=new O0(n.length),l=1):"shear"===t?e=new P0(n.length):(e=new D0(n.length),a=r),e.boneIndex=o;let c=0;for(let t=0;t<n.length;t++){const r=n[t],i=this.getValue(r,"x",l),s=this.getValue(r,"y",l);e.setFrame(c,this.getValue(r,"time",0),i*a,s*a),this.readCurve(r,e,c),c++}i.push(e),s=Math.max(s,e.frames[(e.getFrameCount()-1)*D0.ENTRIES])}}}}if(t.ik)for(const a in t.ik){const e=t.ik[a],o=n.findIkConstraint(a),l=new H0(e.length);l.ikConstraintIndex=n.ikConstraints.indexOf(o);let c=0;for(let t=0;t<e.length;t++){const n=e[t];l.setFrame(c,this.getValue(n,"time",0),this.getValue(n,"mix",1),this.getValue(n,"softness",0)*r,this.getValue(n,"bendPositive",!0)?1:-1,this.getValue(n,"compress",!1),this.getValue(n,"stretch",!1)),this.readCurve(n,l,c),c++}i.push(l),s=Math.max(s,l.frames[(l.getFrameCount()-1)*H0.ENTRIES])}if(t.transform)for(const a in t.transform){const e=t.transform[a],r=n.findTransformConstraint(a),o=new Y0(e.length);o.transformConstraintIndex=n.transformConstraints.indexOf(r);let l=0;for(let t=0;t<e.length;t++){const n=e[t];o.setFrame(l,this.getValue(n,"time",0),this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1),this.getValue(n,"scaleMix",1),this.getValue(n,"shearMix",1)),this.readCurve(n,o,l),l++}i.push(o),s=Math.max(s,o.frames[(o.getFrameCount()-1)*Y0.ENTRIES])}if(t.path)for(const a in t.path){const e=t.path[a],o=n.findPathConstraintIndex(a);if(-1==o)throw new Error(`Path constraint not found: ${a}`);const l=n.pathConstraints[o];for(const t in e){const n=e[t];if("position"===t||"spacing"===t){let e=null,a=1;"spacing"===t?(e=new K0(n.length),l.spacingMode!=v1.Length&&l.spacingMode!=v1.Fixed||(a=r)):(e=new q0(n.length),l.positionMode==MQ.Fixed&&(a=r)),e.pathConstraintIndex=o;let c=0;for(let r=0;r<n.length;r++){const i=n[r];e.setFrame(c,this.getValue(i,"time",0),this.getValue(i,t,0)*a),this.readCurve(i,e,c),c++}i.push(e),s=Math.max(s,e.frames[(e.getFrameCount()-1)*q0.ENTRIES])}else if("mix"===t){const t=new J0(n.length);t.pathConstraintIndex=o;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e,this.getValue(i,"time",0),this.getValue(i,"rotateMix",1),this.getValue(i,"translateMix",1)),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*J0.ENTRIES])}}}if(t.deform)for(const a in t.deform){const e=t.deform[a],o=n.findSkin(a);if(null!=o)for(const t in e){const a=e[t],l=n.findSlotIndex(t);if(-1==l)throw new Error(`Slot not found: ${a.name}`);for(const t in a){const e=a[t],n=o.getAttachment(l,t);if(null==n)throw new Error(`Deform attachment not found: ${e.name}`);const c=null!=n.bones,h=n.vertices,u=c?h.length/3*2:h.length,d=new j0(e.length);d.slotIndex=l,d.attachment=n;let f=0;for(let t=0;t<e.length;t++){const n=e[t];let i;const s=this.getValue(n,"vertices",null);if(null==s)i=c?JQ.newFloatArray(u):h;else{i=JQ.newFloatArray(u);const t=this.getValue(n,"offset",0);if(JQ.arrayCopy(s,0,i,t,s.length),1!=r)for(let e=t,n=e+s.length;e<n;e++)i[e]*=r;if(!c)for(let e=0;e<u;e++)i[e]+=h[e]}d.setFrame(f,this.getValue(n,"time",0),i),this.readCurve(n,d,f),f++}i.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}}}let o=t.drawOrder;if(null==o&&(o=t.draworder),null!=o){const t=new G0(o.length),e=n.slots.length;let r=0;for(let i=0;i<o.length;i++){const s=o[i];let a=null;const l=this.getValue(s,"offsets",null);if(null!=l){a=JQ.newArray(e,-1);const t=JQ.newArray(e-l.length,0);let r=0,i=0;for(let e=0;e<l.length;e++){const s=l[e],o=n.findSlotIndex(s.slot);if(-1==o)throw new Error(`Slot not found: ${s.slot}`);for(;r!=o;)t[i++]=r++;a[r+s.offset]=r++}for(;r<e;)t[i++]=r++;for(let n=e-1;n>=0;n--)-1==a[n]&&(a[n]=t[--i])}t.setFrame(r++,this.getValue(s,"time",0),a)}i.push(t),s=Math.max(s,t.frames[t.getFrameCount()-1])}if(t.events){const e=new z0(t.events.length);let r=0;for(let i=0;i<t.events.length;i++){const s=t.events[i],o=n.findEvent(s.name);if(null==o)throw new Error(`Event not found: ${s.name}`);const a=new d1(JQ.toSinglePrecision(this.getValue(s,"time",0)),o);a.intValue=this.getValue(s,"int",o.intValue),a.floatValue=this.getValue(s,"float",o.floatValue),a.stringValue=this.getValue(s,"string",o.stringValue),null!=a.data.audioPath&&(a.volume=this.getValue(s,"volume",1),a.balance=this.getValue(s,"balance",0)),e.setFrame(r++,a)}i.push(e),s=Math.max(s,e.frames[e.getFrameCount()-1])}if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new T0(e,i,s))}readCurve(t,e,n){if(t.hasOwnProperty("curve"))if("stepped"===t.curve)e.setStepped(n);else{const r=t.curve;e.setCurve(n,r,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1))}}getValue(t,e,n){return void 0!==t[e]?t[e]:n}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return CW.NORMAL;if("additive"==t)return CW.ADD;if("multiply"==t)return CW.MULTIPLY;if("screen"==t)return CW.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return MQ.Fixed;if("percent"==t)return MQ.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return v1.Length;if("fixed"==t)return v1.Fixed;if("percent"==t)return v1.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return IQ.Tangent;if("chain"==t)return IQ.Chain;if("chainscale"==t)return IQ.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return DQ.Normal;if("onlytranslation"==t)return DQ.OnlyTranslation;if("norotationorreflection"==t)return DQ.NoRotationOrReflection;if("noscale"==t)return DQ.NoScale;if("noscaleorreflection"==t)return DQ.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},O1=class{constructor(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritDeform=i}};const P1=Object.freeze(Object.defineProperty({__proto__:null,Animation:T0,AnimationState:t1,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:a1,AtlasAttachmentLoader:l1,Attachment:d0,AttachmentTimeline:U0,Bone:c1,BoneData:h1,BoundingBoxAttachment:m0,ClippingAttachment:g0,ColorTimeline:F0,ConstraintData:u1,CurveTimeline:C0,DeformTimeline:j0,DrawOrderTimeline:G0,Event:d1,EventData:f1,EventQueue:i1,EventTimeline:z0,EventType:s1,IkConstraint:p1,IkConstraintData:m1,IkConstraintTimeline:H0,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,n,r){t.x+=YQ.randomTriangular(-this.jitterX,this.jitterY),t.y+=YQ.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:v0,PathAttachment:y0,PathConstraint:b1,PathConstraintData:g1,PathConstraintMixTimeline:J0,PathConstraintPositionTimeline:q0,PathConstraintSpacingTimeline:K0,PointAttachment:b0,RegionAttachment:E0,RotateTimeline:M0,ScaleTimeline:O0,ShearTimeline:P0,Skeleton:E1,SkeletonBinary:R1,SkeletonBounds:class extends e0{},SkeletonData:_1,SkeletonJson:D1,Skin:A1,SkinEntry:k1,Slot:x0,SlotData:S1,SpacingMode:v1,Spine:class extends a0{createSkeleton(t){this.skeleton=new E1(t),this.skeleton.updateWorldTransform(),this.stateData=new a1(t),this.state=new t1(this.stateData)}},SwirlEffect:S0,TimelineType:k0,TrackEntry:n1,TransformConstraint:x1,TransformConstraintData:T1,TransformConstraintTimeline:Y0,TranslateTimeline:D0,TwoColorTimeline:B0,VertexAttachment:p0},Symbol.toStringTag,{value:"Module"}));let L1=class{constructor(t){if(null==t)throw new Error("name cannot be null.");this.name=t}};const F1=class extends L1{constructor(t){super(t),this.id=(65535&F1.nextID++)<<11,this.worldVerticesLength=0}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,n,r,i,s){n=i+(n>>1)*s;const o=t.bone.skeleton,a=t.attachmentVertices;let l=this.vertices;const c=this.bones;if(null==c){a.length>0&&(l=a);const o=t.bone.matrix,c=o.tx,h=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,a=i;a<n;t+=2,a+=s){const e=l[t],n=l[t+1];r[a]=e*u+n*d+c,r[a+1]=e*f+n*p+h}return}let h=0,u=0;for(let f=0;f<e;f+=2){const t=c[h];h+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let f=i,p=3*u;f<n;f+=s){let t=0,e=0,n=c[h++];for(n+=h;h<n;h++,p+=3){const n=d[c[h]].matrix,r=l[p],i=l[p+1],s=l[p+2];t+=(r*n.a+i*n.c+n.tx)*s,e+=(r*n.b+i*n.d+n.ty)*s}r[f]=t,r[f+1]=e}else{const t=a;for(let e=i,o=3*u,a=u<<1;e<n;e+=s){let n=0,i=0,s=c[h++];for(s+=h;h<s;h++,o+=3,a+=2){const e=d[c[h]].matrix,r=l[o]+t[a],s=l[o+1]+t[a+1],u=l[o+2];n+=(r*e.a+s*e.c+e.tx)*u,i+=(r*e.b+s*e.d+e.ty)*u}r[e]=n,r[e+1]=i}}}applyDeform(t){return this==t}};let N1=F1;N1.nextID=0;let B1=class extends N1{constructor(t){super(t),this.type=kQ.BoundingBox,this.color=new HQ(1,1,1,1)}},U1=class extends N1{constructor(t){super(t),this.type=kQ.Clipping,this.color=new HQ(.2275,.2275,.8078,1)}},V1=class extends N1{constructor(t){super(t),this.type=kQ.Mesh,this.color=new HQ(1,1,1,1),this.inheritDeform=!1,this.tempColor=new HQ(0,0,0,0)}applyDeform(t){return this==t||this.inheritDeform&&this.parentMesh==t}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}},j1=class extends N1{constructor(t){super(t),this.type=kQ.Path,this.closed=!1,this.constantSpeed=!1,this.color=new HQ(1,1,1,1)}},z1=class extends N1{constructor(t){super(t),this.type=kQ.Point,this.color=new HQ(.38,.94,0,1)}computeWorldPosition(t,e){const n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,n=YQ.cosDeg(this.rotation),r=YQ.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*YQ.radDeg}},G1=class{constructor(t,e){if(this.attachmentVertices=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new HQ,this.darkColor=null==t.darkColor?null:new HQ,this.setToSetupPose(),this.blendMode=this.data.blendMode}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.attachmentVertices.length=0)}setAttachmentTime(t){this.attachmentTime=this.bone.skeleton.time-t}getAttachmentTime(){return this.bone.skeleton.time-this.attachmentTime}setToSetupPose(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))}};const W1=class extends L1{constructor(t){super(t),this.type=kQ.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new HQ(1,1,1,1),this.offset=JQ.newFloatArray(8),this.uvs=JQ.newFloatArray(8),this.tempColor=new HQ(1,1,1,1)}updateOffset(){const t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,n=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,i=n+this.region.width*t,s=r+this.region.height*e,o=this.rotation*Math.PI/180,a=Math.cos(o),l=Math.sin(o),c=n*a+this.x,h=n*l,u=r*a+this.y,d=r*l,f=i*a+this.x,p=i*l,m=s*a+this.y,g=s*l,v=this.offset;v[W1.OX1]=c-d,v[W1.OY1]=u+h,v[W1.OX2]=c-g,v[W1.OY2]=m+h,v[W1.OX3]=f-g,v[W1.OY3]=m+p,v[W1.OX4]=f-d,v[W1.OY4]=u+p}setRegion(t){this.region=t;const e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)}computeWorldVertices(t,e,n,r){const i=this.offset,s=t instanceof G1?t.bone.matrix:t.matrix,o=s.tx,a=s.ty,l=s.a,c=s.c,h=s.b,u=s.d;let d=0,f=0;d=i[W1.OX1],f=i[W1.OY1],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[W1.OX2],f=i[W1.OY2],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[W1.OX3],f=i[W1.OY3],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a,n+=r,d=i[W1.OX4],f=i[W1.OY4],e[n]=d*l+f*c+o,e[n+1]=d*h+f*u+a}};let H1=W1;H1.OX1=0,H1.OY1=1,H1.OX2=2,H1.OY2=3,H1.OX3=4,H1.OY3=5,H1.OX4=6,H1.OY4=7,H1.X1=0,H1.Y1=1,H1.C1R=2,H1.C1G=3,H1.C1B=4,H1.C1A=5,H1.U1=6,H1.V1=7,H1.X2=8,H1.Y2=9,H1.C2R=10,H1.C2G=11,H1.C2B=12,H1.C2A=13,H1.U2=14,H1.V2=15,H1.X3=16,H1.Y3=17,H1.C3R=18,H1.C3G=19,H1.C3B=20,H1.C3A=21,H1.U3=22,H1.V3=23,H1.X4=24,H1.Y4=25,H1.C4R=26,H1.C4G=27,H1.C4B=28,H1.C4A=29,H1.U4=30,H1.V4=31;const $1=class{constructor(t){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t}begin(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY}transform(t,e,n,r){const i=this.angle*YQ.degreesToRadians,s=t.x-this.worldX,o=t.y-this.worldY,a=Math.sqrt(s*s+o*o);if(a<this.radius){const e=$1.interpolation.apply(0,i,(this.radius-a)/this.radius),n=Math.cos(e),r=Math.sin(e);t.x=n*s-r*o+this.worldX,t.y=r*s+n*o+this.worldY}}end(){}};let Y1=$1;Y1.interpolation=new KQ(2);let X1=class{constructor(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.duration=n}apply(t,e,n,r,i,s,o,a){if(null==t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));const l=this.timelines;for(let c=0,h=l.length;c<h;c++)l[c].apply(t,e,n,i,s,o,a)}static binarySearch(t,e,n=1){let r=0,i=t.length/n-2;if(0==i)return n;let s=i>>>1;for(;;){if(t[(s+1)*n]<=e?r=s+1:i=s,r==i)return(r+1)*n;s=r+i>>>1}}static linearSearch(t,e,n){for(let r=0,i=t.length-n;r<=i;r+=n)if(t[r]>e)return r;return-1}};var q1=(t=>(t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor",t))(q1||{});const K1=class{constructor(t){if(t<=0)throw new Error(`frameCount must be > 0: ${t}`);this.curves=JQ.newFloatArray((t-1)*K1.BEZIER_SIZE)}getFrameCount(){return this.curves.length/K1.BEZIER_SIZE+1}setLinear(t){this.curves[t*K1.BEZIER_SIZE]=K1.LINEAR}setStepped(t){this.curves[t*K1.BEZIER_SIZE]=K1.STEPPED}getCurveType(t){const e=t*K1.BEZIER_SIZE;if(e==this.curves.length)return K1.LINEAR;const n=this.curves[e];return n==K1.LINEAR?K1.LINEAR:n==K1.STEPPED?K1.STEPPED:K1.BEZIER}setCurve(t,e,n,r,i){const s=.03*(2*-e+r),o=.03*(2*-n+i),a=.006*(3*(e-r)+1),l=.006*(3*(n-i)+1);let c=2*s+a,h=2*o+l,u=.3*e+s+.16666667*a,d=.3*n+o+.16666667*l,f=t*K1.BEZIER_SIZE;const p=this.curves;p[f++]=K1.BEZIER;let m=u,g=d;for(let v=f+K1.BEZIER_SIZE-1;f<v;f+=2)p[f]=m,p[f+1]=g,u+=c,d+=h,c+=a,h+=l,m+=u,g+=d}getCurvePercent(t,e){e=YQ.clamp(e,0,1);const n=this.curves;let r=t*K1.BEZIER_SIZE;const i=n[r];if(i==K1.LINEAR)return e;if(i==K1.STEPPED)return 0;r++;let s=0;for(let a=r,l=r+K1.BEZIER_SIZE-1;r<l;r+=2)if(s=n[r],s>=e){let t,i;return r==a?(t=0,i=0):(t=n[r-2],i=n[r-1]),i+(n[r+1]-i)*(e-t)/(s-t)}const o=n[r-1];return o+(1-o)*(e-s)/(1-s)}};let Z1=K1;Z1.LINEAR=0,Z1.STEPPED=1,Z1.BEZIER=2,Z1.BEZIER_SIZE=19;const J1=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t<<1)}getPropertyId(){return 0+this.boneIndex}setFrame(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+J1.ROTATION]=n}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.bones[this.boneIndex];if(n<a[0]){switch(s){case CQ.setup:return void(l.rotation=l.data.rotation);case CQ.first:const t=l.data.rotation-l.rotation;l.rotation+=(t-360*(16384-(16384.499999999996-t/360|0)))*i}return}if(n>=a[a.length-J1.ENTRIES]){let t=a[a.length+J1.PREV_ROTATION];switch(s){case CQ.setup:l.rotation=l.data.rotation+t*i;break;case CQ.first:case CQ.replace:t+=l.data.rotation-l.rotation,t-=360*(16384-(16384.499999999996-t/360|0));case CQ.add:l.rotation+=t*i}return}const c=X1.binarySearch(a,n,J1.ENTRIES),h=a[c+J1.PREV_ROTATION],u=a[c],d=this.getCurvePercent((c>>1)-1,1-(n-u)/(a[c+J1.PREV_TIME]-u));let f=a[c+J1.ROTATION]-h;switch(f=h+(f-360*(16384-(16384.499999999996-f/360|0)))*d,s){case CQ.setup:l.rotation=l.data.rotation+(f-360*(16384-(16384.499999999996-f/360|0)))*i;break;case CQ.first:case CQ.replace:f+=l.data.rotation-l.rotation;case CQ.add:l.rotation+=(f-360*(16384-(16384.499999999996-f/360|0)))*i}}};let Q1=J1;Q1.ENTRIES=2,Q1.PREV_TIME=-2,Q1.PREV_ROTATION=-1,Q1.ROTATION=1;const t2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*t2.ENTRIES)}getPropertyId(){return(1<<24)+this.boneIndex}setFrame(t,e,n,r){t*=t2.ENTRIES,this.frames[t]=e,this.frames[t+t2.X]=n,this.frames[t+t2.Y]=r}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.bones[this.boneIndex];if(n<a[0]){switch(s){case CQ.setup:return l.x=l.data.x,void(l.y=l.data.y);case CQ.first:l.x+=(l.data.x-l.x)*i,l.y+=(l.data.y-l.y)*i}return}let c=0,h=0;if(n>=a[a.length-t2.ENTRIES])c=a[a.length+t2.PREV_X],h=a[a.length+t2.PREV_Y];else{const t=X1.binarySearch(a,n,t2.ENTRIES);c=a[t+t2.PREV_X],h=a[t+t2.PREV_Y];const e=a[t],r=this.getCurvePercent(t/t2.ENTRIES-1,1-(n-e)/(a[t+t2.PREV_TIME]-e));c+=(a[t+t2.X]-c)*r,h+=(a[t+t2.Y]-h)*r}switch(s){case CQ.setup:l.x=l.data.x+c*i,l.y=l.data.y+h*i;break;case CQ.first:case CQ.replace:l.x+=(l.data.x+c-l.x)*i,l.y+=(l.data.y+h-l.y)*i;break;case CQ.add:l.x+=c*i,l.y+=h*i}}};let e2=t2;e2.ENTRIES=3,e2.PREV_TIME=-3,e2.PREV_X=-2,e2.PREV_Y=-1,e2.X=1,e2.Y=2;let n2=class t extends e2{constructor(t){super(t)}getPropertyId(){return(2<<24)+this.boneIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.bones[this.boneIndex];if(r<l[0]){switch(o){case CQ.setup:return c.scaleX=c.data.scaleX,void(c.scaleY=c.data.scaleY);case CQ.first:c.scaleX+=(c.data.scaleX-c.scaleX)*s,c.scaleY+=(c.data.scaleY-c.scaleY)*s}return}let h=0,u=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_X]*c.data.scaleX,u=l[l.length+t.PREV_Y]*c.data.scaleY;else{const e=X1.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_X],u=l[e+t.PREV_Y];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h=(h+(l[e+t.X]-h)*i)*c.data.scaleX,u=(u+(l[e+t.Y]-u)*i)*c.data.scaleY}if(1==s)o==CQ.add?(c.scaleX+=h-c.data.scaleX,c.scaleY+=u-c.data.scaleY):(c.scaleX=h,c.scaleY=u);else{let t=0,e=0;if(a==RQ.mixOut)switch(o){case CQ.setup:t=c.data.scaleX,e=c.data.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-t)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-e)*s;break;case CQ.first:case CQ.replace:t=c.scaleX,e=c.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-t)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-e)*s;break;case CQ.add:t=c.scaleX,e=c.scaleY,c.scaleX=t+(Math.abs(h)*YQ.signum(t)-c.data.scaleX)*s,c.scaleY=e+(Math.abs(u)*YQ.signum(e)-c.data.scaleY)*s}else switch(o){case CQ.setup:t=Math.abs(c.data.scaleX)*YQ.signum(h),e=Math.abs(c.data.scaleY)*YQ.signum(u),c.scaleX=t+(h-t)*s,c.scaleY=e+(u-e)*s;break;case CQ.first:case CQ.replace:t=Math.abs(c.scaleX)*YQ.signum(h),e=Math.abs(c.scaleY)*YQ.signum(u),c.scaleX=t+(h-t)*s,c.scaleY=e+(u-e)*s;break;case CQ.add:t=YQ.signum(h),e=YQ.signum(u),c.scaleX=Math.abs(c.scaleX)*t+(h-Math.abs(c.data.scaleX)*t)*s,c.scaleY=Math.abs(c.scaleY)*e+(u-Math.abs(c.data.scaleY)*e)*s}}}},r2=class t extends e2{constructor(t){super(t)}getPropertyId(){return(3<<24)+this.boneIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.bones[this.boneIndex];if(r<l[0]){switch(o){case CQ.setup:return c.shearX=c.data.shearX,void(c.shearY=c.data.shearY);case CQ.first:c.shearX+=(c.data.shearX-c.shearX)*s,c.shearY+=(c.data.shearY-c.shearY)*s}return}let h=0,u=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_X],u=l[l.length+t.PREV_Y];else{const e=X1.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_X],u=l[e+t.PREV_Y];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h+=(l[e+t.X]-h)*i,u+=(l[e+t.Y]-u)*i}switch(o){case CQ.setup:c.shearX=c.data.shearX+h*s,c.shearY=c.data.shearY+u*s;break;case CQ.first:case CQ.replace:c.shearX+=(c.data.shearX+h-c.shearX)*s,c.shearY+=(c.data.shearY+u-c.shearY)*s;break;case CQ.add:c.shearX+=h*s,c.shearY+=u*s}}};const i2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*i2.ENTRIES)}getPropertyId(){return(5<<24)+this.slotIndex}setFrame(t,e,n,r,i,s){t*=i2.ENTRIES,this.frames[t]=e,this.frames[t+i2.R]=n,this.frames[t+i2.G]=r,this.frames[t+i2.B]=i,this.frames[t+i2.A]=s}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex],l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return void a.color.setFromColor(a.data.color);case CQ.first:const t=a.color,e=a.data.color;t.add((e.r-t.r)*i,(e.g-t.g)*i,(e.b-t.b)*i,(e.a-t.a)*i)}return}let c=0,h=0,u=0,d=0;if(n>=l[l.length-i2.ENTRIES]){const t=l.length;c=l[t+i2.PREV_R],h=l[t+i2.PREV_G],u=l[t+i2.PREV_B],d=l[t+i2.PREV_A]}else{const t=X1.binarySearch(l,n,i2.ENTRIES);c=l[t+i2.PREV_R],h=l[t+i2.PREV_G],u=l[t+i2.PREV_B],d=l[t+i2.PREV_A];const e=l[t],r=this.getCurvePercent(t/i2.ENTRIES-1,1-(n-e)/(l[t+i2.PREV_TIME]-e));c+=(l[t+i2.R]-c)*r,h+=(l[t+i2.G]-h)*r,u+=(l[t+i2.B]-u)*r,d+=(l[t+i2.A]-d)*r}if(1==i)a.color.set(c,h,u,d);else{const t=a.color;s==CQ.setup&&t.setFromColor(a.data.color),t.add((c-t.r)*i,(h-t.g)*i,(u-t.b)*i,(d-t.a)*i)}}};let s2=i2;s2.ENTRIES=5,s2.PREV_TIME=-5,s2.PREV_R=-4,s2.PREV_G=-3,s2.PREV_B=-2,s2.PREV_A=-1,s2.R=1,s2.G=2,s2.B=3,s2.A=4;const o2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*o2.ENTRIES)}getPropertyId(){return(14<<24)+this.slotIndex}setFrame(t,e,n,r,i,s,o,a,l){t*=o2.ENTRIES,this.frames[t]=e,this.frames[t+o2.R]=n,this.frames[t+o2.G]=r,this.frames[t+o2.B]=i,this.frames[t+o2.A]=s,this.frames[t+o2.R2]=o,this.frames[t+o2.G2]=a,this.frames[t+o2.B2]=l}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex],l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.color.setFromColor(a.data.color),void a.darkColor.setFromColor(a.data.darkColor);case CQ.first:const t=a.color,e=a.darkColor,n=a.data.color,r=a.data.darkColor;t.add((n.r-t.r)*i,(n.g-t.g)*i,(n.b-t.b)*i,(n.a-t.a)*i),e.add((r.r-e.r)*i,(r.g-e.g)*i,(r.b-e.b)*i,0)}return}let c=0,h=0,u=0,d=0,f=0,p=0,m=0;if(n>=l[l.length-o2.ENTRIES]){const t=l.length;c=l[t+o2.PREV_R],h=l[t+o2.PREV_G],u=l[t+o2.PREV_B],d=l[t+o2.PREV_A],f=l[t+o2.PREV_R2],p=l[t+o2.PREV_G2],m=l[t+o2.PREV_B2]}else{const t=X1.binarySearch(l,n,o2.ENTRIES);c=l[t+o2.PREV_R],h=l[t+o2.PREV_G],u=l[t+o2.PREV_B],d=l[t+o2.PREV_A],f=l[t+o2.PREV_R2],p=l[t+o2.PREV_G2],m=l[t+o2.PREV_B2];const e=l[t],r=this.getCurvePercent(t/o2.ENTRIES-1,1-(n-e)/(l[t+o2.PREV_TIME]-e));c+=(l[t+o2.R]-c)*r,h+=(l[t+o2.G]-h)*r,u+=(l[t+o2.B]-u)*r,d+=(l[t+o2.A]-d)*r,f+=(l[t+o2.R2]-f)*r,p+=(l[t+o2.G2]-p)*r,m+=(l[t+o2.B2]-m)*r}if(1==i)a.color.set(c,h,u,d),a.darkColor.set(f,p,m,1);else{const t=a.color,e=a.darkColor;s==CQ.setup&&(t.setFromColor(a.data.color),e.setFromColor(a.data.darkColor)),t.add((c-t.r)*i,(h-t.g)*i,(u-t.b)*i,(d-t.a)*i),e.add((f-e.r)*i,(p-e.g)*i,(m-e.b)*i,0)}}};let a2=o2;a2.ENTRIES=8,a2.PREV_TIME=-8,a2.PREV_R=-7,a2.PREV_G=-6,a2.PREV_B=-5,a2.PREV_A=-4,a2.PREV_R2=-3,a2.PREV_G2=-2,a2.PREV_B2=-1,a2.R=1,a2.G=2,a2.B=3,a2.A=4,a2.R2=5,a2.G2=6,a2.B2=7;let l2=class{constructor(t){this.frames=JQ.newFloatArray(t),this.attachmentNames=new Array(t)}getPropertyId(){return(4<<24)+this.slotIndex}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(o==RQ.mixOut&&s==CQ.setup){const e=a.data.attachmentName;return void a.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}const l=this.frames;if(n<l[0]){if(s==CQ.setup||s==CQ.first){const e=a.data.attachmentName;a.setAttachment(null==e?null:t.getAttachment(this.slotIndex,e))}return}let c=0;c=n>=l[l.length-1]?l.length-1:X1.binarySearch(l,n,1)-1;const h=this.attachmentNames[c];t.slots[this.slotIndex].setAttachment(null==h?null:t.getAttachment(this.slotIndex,h))}},c2=null,h2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t),this.frameVertices=new Array(t),null==c2&&(c2=JQ.newFloatArray(64))}getPropertyId(){return(6<<27)+Number(this.attachment.id)+this.slotIndex}setFrame(t,e,n){this.frames[t]=e,this.frameVertices[t]=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex],l=a.getAttachment();if(!(l instanceof N1&&l.applyDeform(this.attachment)))return;const c=a.attachmentVertices;0==c.length&&(s=CQ.setup);const h=this.frameVertices,u=h[0].length,d=this.frames;if(n<d[0]){const t=l;switch(s){case CQ.setup:return void(c.length=0);case CQ.first:if(1==i){c.length=0;break}const e=JQ.setArraySize(c,u);if(null==t.bones){const n=t.vertices;for(let t=0;t<u;t++)e[t]+=(n[t]-e[t])*i}else{i=1-i;for(let t=0;t<u;t++)e[t]*=i}}return}const f=JQ.setArraySize(c,u);if(n>=d[d.length-1]){const t=h[d.length-1];if(1==i)if(s==CQ.add){const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++)f[e]+=t[e]-n[e]}else for(let n=0;n<u;n++)f[n]+=t[n]}else JQ.arrayCopy(t,0,f,0,u);else switch(s){case CQ.setup:{const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++){const r=n[e];f[e]=r+(t[e]-r)*i}}else for(let n=0;n<u;n++)f[n]=t[n]*i;break}case CQ.first:case CQ.replace:for(let n=0;n<u;n++)f[n]+=(t[n]-f[n])*i;case CQ.add:const e=l;if(null==e.bones){const n=e.vertices;for(let e=0;e<u;e++)f[e]+=(t[e]-n[e])*i}else for(let n=0;n<u;n++)f[n]+=t[n]*i}return}const p=X1.binarySearch(d,n),m=h[p-1],g=h[p],v=d[p],y=this.getCurvePercent(p-1,1-(n-v)/(d[p-1]-v));if(1==i)if(s==CQ.add){const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];f[t]+=n+(g[t]-n)*y-e[t]}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=t+(g[e]-t)*y}}else for(let b=0;b<u;b++){const t=m[b];f[b]=t+(g[b]-t)*y}else switch(s){case CQ.setup:{const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t],r=e[t];f[t]=r+(n+(g[t]-n)*y-r)*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]=(t+(g[e]-t)*y)*i}break}case CQ.first:case CQ.replace:for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*y-f[e])*i}break;case CQ.add:const t=l;if(null==t.bones){const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];f[t]+=(n+(g[t]-n)*y-e[t])*i}}else for(let e=0;e<u;e++){const t=m[e];f[e]+=(t+(g[e]-t)*y)*i}}}},u2=class{constructor(t){this.frames=JQ.newFloatArray(t),this.events=new Array(t)}getPropertyId(){return 7<<24}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,n,r,i,s,o){if(null==r)return;const a=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,o),e=-1;else if(e>=a[l-1])return;if(n<a[0])return;let c=0;if(e<a[0])c=0;else{c=X1.binarySearch(a,e);const t=a[c];for(;c>0&&a[c-1]==t;)c--}for(;c<l&&n>=a[c];c++)r.push(this.events[c])}},d2=class{constructor(t){this.frames=JQ.newFloatArray(t),this.drawOrders=new Array(t)}getPropertyId(){return 8<<24}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.drawOrders[t]=n}apply(t,e,n,r,i,s,o){const a=t.drawOrder,l=t.slots;if(o==RQ.mixOut&&s==CQ.setup)return void JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length);const c=this.frames;if(n<c[0])return void(s!=CQ.setup&&s!=CQ.first||JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));let h=0;h=n>=c[c.length-1]?c.length-1:X1.binarySearch(c,n)-1;const u=this.drawOrders[h];if(null==u)JQ.arrayCopy(l,0,a,0,l.length);else for(let d=0,f=u.length;d<f;d++)a[d]=l[u[d]]}};const f2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*f2.ENTRIES)}getPropertyId(){return(9<<24)+this.ikConstraintIndex}setFrame(t,e,n,r,i,s){t*=f2.ENTRIES,this.frames[t]=e,this.frames[t+f2.MIX]=n,this.frames[t+f2.BEND_DIRECTION]=r,this.frames[t+f2.COMPRESS]=i?1:0,this.frames[t+f2.STRETCH]=s?1:0}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.ikConstraints[this.ikConstraintIndex];if(n<a[0]){switch(s){case CQ.setup:return l.mix=l.data.mix,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,void(l.stretch=l.data.stretch);case CQ.first:l.mix+=(l.data.mix-l.mix)*i,l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch}return}if(n>=a[a.length-f2.ENTRIES])return void(s==CQ.setup?(l.mix=l.data.mix+(a[a.length+f2.PREV_MIX]-l.data.mix)*i,o==RQ.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[a.length+f2.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+f2.PREV_COMPRESS],l.stretch=0!=a[a.length+f2.PREV_STRETCH])):(l.mix+=(a[a.length+f2.PREV_MIX]-l.mix)*i,o==RQ.mixIn&&(l.bendDirection=a[a.length+f2.PREV_BEND_DIRECTION],l.compress=0!=a[a.length+f2.PREV_COMPRESS],l.stretch=0!=a[a.length+f2.PREV_STRETCH])));const c=X1.binarySearch(a,n,f2.ENTRIES),h=a[c+f2.PREV_MIX],u=a[c],d=this.getCurvePercent(c/f2.ENTRIES-1,1-(n-u)/(a[c+f2.PREV_TIME]-u));s==CQ.setup?(l.mix=l.data.mix+(h+(a[c+f2.MIX]-h)*d-l.data.mix)*i,o==RQ.mixOut?(l.bendDirection=l.data.bendDirection,l.compress=l.data.compress,l.stretch=l.data.stretch):(l.bendDirection=a[c+f2.PREV_BEND_DIRECTION],l.compress=0!=a[c+f2.PREV_COMPRESS],l.stretch=0!=a[c+f2.PREV_STRETCH])):(l.mix+=(h+(a[c+f2.MIX]-h)*d-l.mix)*i,o==RQ.mixIn&&(l.bendDirection=a[c+f2.PREV_BEND_DIRECTION],l.compress=0!=a[c+f2.PREV_COMPRESS],l.stretch=0!=a[c+f2.PREV_STRETCH]))}};let p2=f2;p2.ENTRIES=5,p2.PREV_TIME=-5,p2.PREV_MIX=-4,p2.PREV_BEND_DIRECTION=-3,p2.PREV_COMPRESS=-2,p2.PREV_STRETCH=-1,p2.MIX=1,p2.BEND_DIRECTION=2,p2.COMPRESS=3,p2.STRETCH=4;const m2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*m2.ENTRIES)}getPropertyId(){return(10<<24)+this.transformConstraintIndex}setFrame(t,e,n,r,i,s){t*=m2.ENTRIES,this.frames[t]=e,this.frames[t+m2.ROTATE]=n,this.frames[t+m2.TRANSLATE]=r,this.frames[t+m2.SCALE]=i,this.frames[t+m2.SHEAR]=s}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.transformConstraints[this.transformConstraintIndex];if(n<a[0]){const t=l.data;switch(s){case CQ.setup:return l.rotateMix=t.rotateMix,l.translateMix=t.translateMix,l.scaleMix=t.scaleMix,void(l.shearMix=t.shearMix);case CQ.first:l.rotateMix+=(t.rotateMix-l.rotateMix)*i,l.translateMix+=(t.translateMix-l.translateMix)*i,l.scaleMix+=(t.scaleMix-l.scaleMix)*i,l.shearMix+=(t.shearMix-l.shearMix)*i}return}let c=0,h=0,u=0,d=0;if(n>=a[a.length-m2.ENTRIES]){const t=a.length;c=a[t+m2.PREV_ROTATE],h=a[t+m2.PREV_TRANSLATE],u=a[t+m2.PREV_SCALE],d=a[t+m2.PREV_SHEAR]}else{const t=X1.binarySearch(a,n,m2.ENTRIES);c=a[t+m2.PREV_ROTATE],h=a[t+m2.PREV_TRANSLATE],u=a[t+m2.PREV_SCALE],d=a[t+m2.PREV_SHEAR];const e=a[t],r=this.getCurvePercent(t/m2.ENTRIES-1,1-(n-e)/(a[t+m2.PREV_TIME]-e));c+=(a[t+m2.ROTATE]-c)*r,h+=(a[t+m2.TRANSLATE]-h)*r,u+=(a[t+m2.SCALE]-u)*r,d+=(a[t+m2.SHEAR]-d)*r}if(s==CQ.setup){const t=l.data;l.rotateMix=t.rotateMix+(c-t.rotateMix)*i,l.translateMix=t.translateMix+(h-t.translateMix)*i,l.scaleMix=t.scaleMix+(u-t.scaleMix)*i,l.shearMix=t.shearMix+(d-t.shearMix)*i}else l.rotateMix+=(c-l.rotateMix)*i,l.translateMix+=(h-l.translateMix)*i,l.scaleMix+=(u-l.scaleMix)*i,l.shearMix+=(d-l.shearMix)*i}};let g2=m2;g2.ENTRIES=5,g2.PREV_TIME=-5,g2.PREV_ROTATE=-4,g2.PREV_TRANSLATE=-3,g2.PREV_SCALE=-2,g2.PREV_SHEAR=-1,g2.ROTATE=1,g2.TRANSLATE=2,g2.SCALE=3,g2.SHEAR=4;const v2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*v2.ENTRIES)}getPropertyId(){return(11<<24)+this.pathConstraintIndex}setFrame(t,e,n){t*=v2.ENTRIES,this.frames[t]=e,this.frames[t+v2.VALUE]=n}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(n<a[0]){switch(s){case CQ.setup:return void(l.position=l.data.position);case CQ.first:l.position+=(l.data.position-l.position)*i}return}let c=0;if(n>=a[a.length-v2.ENTRIES])c=a[a.length+v2.PREV_VALUE];else{const t=X1.binarySearch(a,n,v2.ENTRIES);c=a[t+v2.PREV_VALUE];const e=a[t],r=this.getCurvePercent(t/v2.ENTRIES-1,1-(n-e)/(a[t+v2.PREV_TIME]-e));c+=(a[t+v2.VALUE]-c)*r}s==CQ.setup?l.position=l.data.position+(c-l.data.position)*i:l.position+=(c-l.position)*i}};let y2=v2;y2.ENTRIES=2,y2.PREV_TIME=-2,y2.PREV_VALUE=-1,y2.VALUE=1;let b2=class t extends y2{constructor(t){super(t)}getPropertyId(){return(12<<24)+this.pathConstraintIndex}apply(e,n,r,i,s,o,a){const l=this.frames,c=e.pathConstraints[this.pathConstraintIndex];if(r<l[0]){switch(o){case CQ.setup:return void(c.spacing=c.data.spacing);case CQ.first:c.spacing+=(c.data.spacing-c.spacing)*s}return}let h=0;if(r>=l[l.length-t.ENTRIES])h=l[l.length+t.PREV_VALUE];else{const e=X1.binarySearch(l,r,t.ENTRIES);h=l[e+t.PREV_VALUE];const n=l[e],i=this.getCurvePercent(e/t.ENTRIES-1,1-(r-n)/(l[e+t.PREV_TIME]-n));h+=(l[e+t.VALUE]-h)*i}o==CQ.setup?c.spacing=c.data.spacing+(h-c.data.spacing)*s:c.spacing+=(h-c.spacing)*s}};const x2=class extends Z1{constructor(t){super(t),this.frames=JQ.newFloatArray(t*x2.ENTRIES)}getPropertyId(){return(13<<24)+this.pathConstraintIndex}setFrame(t,e,n,r){t*=x2.ENTRIES,this.frames[t]=e,this.frames[t+x2.ROTATE]=n,this.frames[t+x2.TRANSLATE]=r}apply(t,e,n,r,i,s,o){const a=this.frames,l=t.pathConstraints[this.pathConstraintIndex];if(n<a[0]){switch(s){case CQ.setup:return l.rotateMix=l.data.rotateMix,void(l.translateMix=l.data.translateMix);case CQ.first:l.rotateMix+=(l.data.rotateMix-l.rotateMix)*i,l.translateMix+=(l.data.translateMix-l.translateMix)*i}return}let c=0,h=0;if(n>=a[a.length-x2.ENTRIES])c=a[a.length+x2.PREV_ROTATE],h=a[a.length+x2.PREV_TRANSLATE];else{const t=X1.binarySearch(a,n,x2.ENTRIES);c=a[t+x2.PREV_ROTATE],h=a[t+x2.PREV_TRANSLATE];const e=a[t],r=this.getCurvePercent(t/x2.ENTRIES-1,1-(n-e)/(a[t+x2.PREV_TIME]-e));c+=(a[t+x2.ROTATE]-c)*r,h+=(a[t+x2.TRANSLATE]-h)*r}s==CQ.setup?(l.rotateMix=l.data.rotateMix+(c-l.data.rotateMix)*i,l.translateMix=l.data.translateMix+(h-l.data.translateMix)*i):(l.rotateMix+=(c-l.rotateMix)*i,l.translateMix+=(h-l.translateMix)*i)}};let w2=x2;w2.ENTRIES=3,w2.PREV_TIME=-3,w2.PREV_ROTATE=-2,w2.PREV_TRANSLATE=-1,w2.ROTATE=1,w2.TRANSLATE=2;const E2=class{constructor(t){this.tracks=new Array,this.events=new Array,this.listeners=new Array,this.queue=new A2(this),this.propertyIDs=new zQ,this.animationsChanged=!1,this.timeScale=1,this.trackEntryPool=new QQ((()=>new T2)),this.data=t}update(t){t*=this.timeScale;const e=this.tracks;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(null==r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let i=t*r.timeScale;if(r.delay>0){if(r.delay-=i,r.delay>0)continue;i=-r.delay,r.delay=0}let s=r.next;if(null!=s){const e=r.trackLast-s.delay;if(e>=0){for(s.delay=0,s.trackTime=0==r.timeScale?0:(e/r.timeScale+t)*s.timeScale,r.trackTime+=i,this.setCurrent(n,s,!0);null!=s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[n]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,null!=t&&(t.mixingTo=null);null!=t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const n=t.mixingFrom;if(null==n)return!0;const r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)}apply(t){if(null==t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,n=this.tracks;let r=!1;for(let i=0,s=n.length;i<s;i++){const s=n[i];if(null==s||s.delay>0)continue;r=!0;const o=0==i?CQ.first:s.mixBlend;let a=s.alpha;null!=s.mixingFrom?a*=this.applyMixingFrom(s,t,o):s.trackTime>=s.trackEnd&&null==s.next&&(a=0);const l=s.animationLast,c=s.getAnimationTime(),h=s.animation.timelines.length,u=s.animation.timelines;if(0==i&&1==a||o==CQ.add)for(let n=0;n<h;n++)u[n].apply(t,l,c,e,a,o,RQ.mixIn);else{const n=s.timelineMode,r=0==s.timelinesRotation.length;r&&JQ.setArraySize(s.timelinesRotation,h<<1,null);const i=s.timelinesRotation;for(let s=0;s<h;s++){const h=u[s],d=n[s]==E2.SUBSEQUENT?o:CQ.setup;h instanceof Q1?this.applyRotateTimeline(h,t,c,a,d,i,s<<1,r):h.apply(t,l,c,e,a,d,RQ.mixIn)}}this.queueEvents(s,c),e.length=0,s.nextAnimationLast=c,s.nextTrackLast=s.trackTime}return this.queue.drain(),r}applyMixingFrom(t,e,n){const r=t.mixingFrom;null!=r.mixingFrom&&this.applyMixingFrom(r,e,n);let i=0;0==t.mixDuration?(i=1,n==CQ.first&&(n=CQ.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),n!=CQ.first&&(n=r.mixBlend));const s=i<r.eventThreshold?this.events:null,o=i<r.attachmentThreshold,a=i<r.drawOrderThreshold,l=r.animationLast,c=r.getAnimationTime(),h=r.animation.timelines.length,u=r.animation.timelines,d=r.alpha*t.interruptAlpha,f=d*(1-i);if(n==CQ.add)for(let p=0;p<h;p++)u[p].apply(e,l,c,s,f,n,RQ.mixOut);else{const t=r.timelineMode,i=r.timelineHoldMix,p=0==r.timelinesRotation.length;p&&JQ.setArraySize(r.timelinesRotation,h<<1,null);const m=r.timelinesRotation;r.totalAlpha=0;for(let g=0;g<h;g++){const h=u[g];let v,y=RQ.mixOut,b=0;switch(t[g]){case E2.SUBSEQUENT:if(!o&&h instanceof l2)continue;if(!a&&h instanceof d2)continue;v=n,b=f;break;case E2.FIRST:v=CQ.setup,b=f;break;case E2.HOLD:v=CQ.setup,b=d;break;default:v=CQ.setup;const t=i[g];b=d*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=b,h instanceof Q1?this.applyRotateTimeline(h,e,c,b,v,m,g<<1,p):(v==CQ.setup&&(h instanceof l2?o&&(y=RQ.mixOut):h instanceof d2&&a&&(y=RQ.mixOut)),h.apply(e,l,c,s,b,v,y))}}return t.mixDuration>0&&this.queueEvents(r,c),this.events.length=0,r.nextAnimationLast=c,r.nextTrackLast=r.trackTime,i}applyRotateTimeline(t,e,n,r,i,s,o,a){if(a&&(s[o]=0),1==r)return void t.apply(e,0,n,null,1,i,RQ.mixIn);const l=t,c=l.frames,h=e.bones[l.boneIndex];let u=0,d=0;if(n<c[0])switch(i){case CQ.setup:h.rotation=h.data.rotation;default:return;case CQ.first:u=h.rotation,d=h.data.rotation}else if(u=i==CQ.setup?h.data.rotation:h.rotation,n>=c[c.length-Q1.ENTRIES])d=h.data.rotation+c[c.length+Q1.PREV_ROTATION];else{const t=X1.binarySearch(c,n,Q1.ENTRIES),e=c[t+Q1.PREV_ROTATION],r=c[t],i=l.getCurvePercent((t>>1)-1,1-(n-r)/(c[t+Q1.PREV_TIME]-r));d=c[t+Q1.ROTATION]-e,d-=360*(16384-(16384.499999999996-d/360|0)),d=e+d*i+h.data.rotation,d-=360*(16384-(16384.499999999996-d/360|0))}let f=0,p=d-u;if(p-=360*(16384-(16384.499999999996-p/360|0)),0==p)f=s[o];else{let t=0,e=0;a?(t=0,e=p):(t=s[o],e=s[o+1]);const n=p>0;let r=t>=0;YQ.signum(e)!=YQ.signum(p)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*YQ.signum(t)),r=n),f=p+t-t%360,r!=n&&(f+=360*YQ.signum(t)),s[o]=f}s[o+1]=p,u+=f*r,h.rotation=u-360*(16384-(16384.499999999996-u/360|0))}queueEvents(t,e){const n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,o=this.events;let a=0;const l=o.length;for(;a<l;a++){const e=o[a];if(e.time<s)break;e.time>r||this.queue.event(t,e)}let c=!1;for(c=t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r,c&&this.queue.complete(t);a<l;a++){o[a].time<n||this.queue.event(t,o[a])}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(null==e)return;this.queue.end(e),this.disposeNext(e);let n=e;for(;;){const t=n.mixingFrom;if(null==t)break;this.queue.end(t),n.mixingFrom=null,n.mixingTo=null,n=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,n){const r=this.expandToIndex(t);this.tracks[t]=e,null!=r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,null!=r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,n){const r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,n)}setAnimationWith(t,e,n){if(null==e)throw new Error("animation cannot be null.");let r=!0,i=this.expandToIndex(t);null!=i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.disposeNext(i),i=i.mixingFrom,r=!1):this.disposeNext(i));const s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s}addAnimation(t,e,n,r){const i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,n,r)}addAnimationWith(t,e,n,r){if(null==e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(null!=i)for(;null!=i.next;)i=i.next;const s=this.trackEntry(t,e,n,i);if(null==i)this.setCurrent(t,s,!0),this.queue.drain();else if(i.next=s,r<=0){const t=i.animationEnd-i.animationStart;0!=t?(i.loop?r+=t*(1+(i.trackTime/t|0)):r+=Math.max(t,i.trackTime),r-=this.data.getMix(i.animation,e)):r=i.trackTime}return s.delay=r,s}setEmptyAnimation(t,e){const n=this.setAnimationWith(t,E2.emptyAnimation,!1);return n.mixDuration=e,n.trackEnd=e,n}addEmptyAnimation(t,e,n){n<=0&&(n-=e);const r=this.addAnimationWith(t,E2.emptyAnimation,!1,n);return r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,r=this.tracks.length;n<r;n++){const e=this.tracks[n];null!=e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(JQ.ensureArrayCapacity(this.tracks,t-this.tracks.length+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,n,r){const i=this.trackEntryPool.obtain();return i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.interruptAlpha=1,i.mixTime=0,i.mixDuration=null==r?0:this.data.getMix(r.animation,e),i}disposeNext(t){let e=t.next;for(;null!=e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();for(let t=0,e=this.tracks.length;t<e;t++){let e=this.tracks[t];if(null!=e){for(;null!=e.mixingFrom;)e=e.mixingFrom;do{null!=e.mixingFrom&&e.mixBlend==CQ.add||this.setTimelineModes(e),e=e.mixingTo}while(null!=e)}}}setTimelineModes(t){const e=t.mixingTo,n=t.animation.timelines,r=t.animation.timelines.length,i=JQ.setArraySize(t.timelineMode,r);t.timelineHoldMix.length=0;const s=JQ.setArraySize(t.timelineHoldMix,r),o=this.propertyIDs;if(null!=e&&e.holdPrevious)for(let a=0;a<r;a++)o.add(n[a].getPropertyId()),i[a]=E2.HOLD;else t:for(let a=0;a<r;a++){const r=n[a].getPropertyId();if(o.add(r))if(null!=e&&this.hasTimeline(e,r)){for(let n=e.mixingTo;null!=n;n=n.mixingTo)if(!this.hasTimeline(n,r)){if(t.mixDuration>0){i[a]=E2.HOLD_MIX,s[a]=n;continue t}break}i[a]=E2.HOLD}else i[a]=E2.FIRST;else i[a]=E2.SUBSEQUENT}}hasTimeline(t,e){const n=t.animation.timelines;for(let r=0,i=n.length;r<i;r++)if(n[r].getPropertyId()==e)return!0;return!1}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,n){E2.deprecatedWarning1||(E2.deprecatedWarning1=!0),this.setAnimation(t,e,n)}addAnimationByName(t,e,n,r){E2.deprecatedWarning2||(E2.deprecatedWarning2=!0),this.addAnimation(t,e,n,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return E2.deprecatedWarning3||(E2.deprecatedWarning3=!0),this.hasAnimation(t)}};let _2=E2;_2.emptyAnimation=new X1("<empty>",[],0),_2.SUBSEQUENT=0,_2.FIRST=1,_2.HOLD=2,_2.HOLD_MIX=3,_2.deprecatedWarning1=!1,_2.deprecatedWarning2=!1,_2.deprecatedWarning3=!1;const S2=class{constructor(){this.mixBlend=CQ.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}get time(){return S2.deprecatedWarning1||(S2.deprecatedWarning1=!0),this.trackTime}set time(t){S2.deprecatedWarning1||(S2.deprecatedWarning1=!0),this.trackTime=t}get endTime(){return S2.deprecatedWarning2||(S2.deprecatedWarning2=!0),this.trackTime}set endTime(t){S2.deprecatedWarning2||(S2.deprecatedWarning2=!0),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let T2=S2;T2.deprecatedWarning1=!1,T2.deprecatedWarning2=!1;const k2=class{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(C2.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(C2.interrupt),this.objects.push(t)}end(t){this.objects.push(C2.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(C2.dispose),this.objects.push(t)}complete(t){this.objects.push(C2.complete),this.objects.push(t)}event(t,e){this.objects.push(C2.event),this.objects.push(t),this.objects.push(e)}deprecateStuff(){return k2.deprecatedWarning1||(k2.deprecatedWarning1=!0),!0}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let n=0;n<t.length;n+=2){const r=t[n],i=t[n+1];switch(r){case C2.start:null!=i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++)e[t].start&&e[t].start(i);i.onStart&&this.deprecateStuff()&&i.onStart(i.trackIndex),this.animState.onStart&&this.deprecateStuff()&&this.deprecateStuff&&this.animState.onStart(i.trackIndex);break;case C2.interrupt:null!=i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++)e[t].interrupt&&e[t].interrupt(i);break;case C2.end:null!=i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++)e[t].end&&e[t].end(i);i.onEnd&&this.deprecateStuff()&&i.onEnd(i.trackIndex),this.animState.onEnd&&this.deprecateStuff()&&this.animState.onEnd(i.trackIndex);case C2.dispose:null!=i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++)e[t].dispose&&e[t].dispose(i);this.animState.trackEntryPool.free(i);break;case C2.complete:null!=i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++)e[t].complete&&e[t].complete(i);const r=YQ.toInt(i.loopsCount());i.onComplete&&this.deprecateStuff()&&i.onComplete(i.trackIndex,r),this.animState.onComplete&&this.deprecateStuff()&&this.animState.onComplete(i.trackIndex,r);break;case C2.event:const s=t[2+n++];null!=i.listener&&i.listener.event&&i.listener.event(i,s);for(let t=0;t<e.length;t++)e[t].event&&e[t].event(i,s);i.onEvent&&this.deprecateStuff()&&i.onEvent(i.trackIndex,s),this.animState.onEvent&&this.deprecateStuff()&&this.animState.onEvent(i.trackIndex,s)}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}};let A2=k2;A2.deprecatedWarning1=!1;var C2=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(C2||{});const R2=class{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,n){const r=this.skeletonData.findAnimation(t);if(null==r)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(null==i)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,i,n)}setMixByName(t,e,n){R2.deprecatedWarning1||(R2.deprecatedWarning1=!0),this.setMix(t,e,n)}setMixWith(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=n}getMix(t,e){const n=`${t.name}.${e.name}`,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r}};let M2=R2;M2.deprecatedWarning1=!1;let I2=class{constructor(t){this.atlas=t}newRegionAttachment(t,e,n){const r=this.atlas.findRegion(n);if(null==r)throw new Error(`Region not found in atlas: ${n} (region attachment: ${e})`);const i=new H1(e);return i.region=r,i}newMeshAttachment(t,e,n){const r=this.atlas.findRegion(n);if(null==r)throw new Error(`Region not found in atlas: ${n} (mesh attachment: ${e})`);const i=new V1(e);return i.region=r,i}newBoundingBoxAttachment(t,e){return new B1(e)}newPathAttachment(t,e){return new j1(e)}newPointAttachment(t,e){return new z1(e)}newClippingAttachment(t,e){return new U1(e)}},D2=class{constructor(t,e,n){if(this.matrix=new bY,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.sorted=!1,this.active=!0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}update(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,n,r,i,s,o){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=o,this.appliedValid=!0;const a=this.parent,l=this.matrix,c=this.skeleton.scaleX,h=-this.skeleton.scaleY;if(null==a){const a=this.skeleton,u=n+90+o;return l.a=YQ.cosDeg(n+s)*r*c,l.c=YQ.cosDeg(u)*i*c,l.b=YQ.sinDeg(n+s)*r*h,l.d=YQ.sinDeg(u)*i*h,l.tx=t*c+a.x,void(l.ty=e*h+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(l.tx=u*t+d*e+a.matrix.tx,l.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case DQ.Normal:{const t=n+90+o,e=YQ.cosDeg(n+s)*r,a=YQ.cosDeg(t)*i,c=YQ.sinDeg(n+s)*r,h=YQ.sinDeg(t)*i;return l.a=u*e+d*c,l.c=u*a+d*h,l.b=f*e+p*c,void(l.d=f*a+p*h)}case DQ.OnlyTranslation:{const t=n+90+o;l.a=YQ.cosDeg(n+s)*r,l.c=YQ.cosDeg(t)*i,l.b=YQ.sinDeg(n+s)*r,l.d=YQ.sinDeg(t)*i;break}case DQ.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,d=f*t,p=u*t,e=Math.atan2(f,u)*YQ.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*YQ.radDeg);const a=n+s-e,c=n+o-e+90,h=YQ.cosDeg(a)*r,m=YQ.cosDeg(c)*i,g=YQ.sinDeg(a)*r,v=YQ.sinDeg(c)*i;l.a=u*h-d*g,l.c=u*m-d*v,l.b=f*h+p*g,l.d=f*m+p*v;break}case DQ.NoScale:case DQ.NoScaleOrReflection:{const t=YQ.cosDeg(n),e=YQ.sinDeg(n);let a=(u*t+d*e)/c,m=(f*t+p*e)/h,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==DQ.NoScale&&u*p-d*f<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY>0)&&(g=-g);const v=Math.PI/2+Math.atan2(m,a),y=Math.cos(v)*g,b=Math.sin(v)*g,x=YQ.cosDeg(s)*r,w=YQ.cosDeg(90+o)*i,E=YQ.sinDeg(s)*r,_=YQ.sinDeg(90+o)*i;l.a=a*x+y*E,l.c=a*w+y*_,l.b=m*x+b*E,l.d=m*w+b*_;break}}l.a*=c,l.c*=c,l.b*=h,l.d*=h}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*YQ.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*YQ.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.c*t.c)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.b*t.b+t.d*t.d)}updateAppliedTransform(){this.appliedValid=!0;const t=this.parent,e=this.matrix;if(null==t)return this.ax=e.tx,this.ay=e.ty,this.arotation=Math.atan2(e.b,e.a)*YQ.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*YQ.radDeg);const n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;const o=r*n.d,a=r*n.a,l=r*n.c,c=r*n.b,h=o*e.a-l*e.b,u=o*e.c-l*e.d,d=a*e.b-c*e.a,f=a*e.d-c*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(h*h+d*d),this.ascaleX>1e-4){const t=h*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(h*u+d*f,t)*YQ.radDeg,this.arotation=Math.atan2(d,h)*YQ.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*YQ.radDeg}worldToLocal(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=1/(n*s-r*i),a=t.x-e.tx,l=t.y-e.ty;return t.x=a*s*o-l*r*o,t.y=l*n*o-a*i*o,t}localToWorld(t){const e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*YQ.radDeg}localToWorldRotation(t){const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*YQ.radDeg}rotateWorld(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=YQ.cosDeg(t),a=YQ.sinDeg(t);e.a=o*n-a*i,e.c=o*r-a*s,e.b=a*n+o*i,e.d=a*r+o*s,this.appliedValid=!1}},O2=class{constructor(t,e,n){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=DQ.Normal,t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n}},P2=class{constructor(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}},L2=class{constructor(t){this.name=t}},F2=class{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}getOrder(){return this.data.order}apply(){this.update()}update(){const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.mix)}}apply1(t,e,n,r,i,s,o){t.appliedValid||t.updateAppliedTransform();const a=t.parent.matrix,l=1/(a.a*a.d-a.b*a.c),c=e-a.tx,h=n-a.ty,u=(c*a.d-h*a.c)*l-t.ax,d=(h*a.a-c*a.b)*l-t.ay;let f=Math.atan2(d,u)*YQ.radDeg-t.ashearX-t.arotation;t.ascaleX<0&&(f+=180),f>180?f-=360:f<-180&&(f+=360);let p=t.ascaleX,m=t.ascaleY;if(r||i){const e=t.data.length*p,n=Math.sqrt(u*u+d*d);if(r&&n<e||i&&n>e&&e>1e-4){const t=(n/e-1)*o+1;p*=t,s&&(m*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+f*o,p,m,t.ashearX,t.ashearY)}apply2(t,e,n,r,i,s,o){if(0==o)return void e.updateWorldTransform();t.appliedValid||t.updateAppliedTransform(),e.appliedValid||e.updateAppliedTransform();const a=t.ax,l=t.ay;let c=t.ascaleX,h=c,u=t.ascaleY,d=e.ascaleX;const f=t.matrix;let p=0,m=0,g=0;c<0?(c=-c,p=180,g=-1):(p=0,g=1),u<0&&(u=-u,g=-g),d<0?(d=-d,m=180):m=0;const v=e.ax;let y=0,b=0,x=0,w=f.a,E=f.c,_=f.b,S=f.d;const T=Math.abs(c-u)<=1e-4;T?(y=e.ay,b=w*v+E*y+f.tx,x=_*v+S*y+f.ty):(y=0,b=w*v+f.tx,x=_*v+f.ty);const k=t.parent.matrix;w=k.a,E=k.c,_=k.b,S=k.d;const A=1/(w*S-E*_);let C=n-k.tx,R=r-k.ty;const M=(C*S-R*E)*A-a,I=(R*w-C*_)*A-l,D=M*M+I*I;C=b-k.tx,R=x-k.ty;const O=(C*S-R*E)*A-a,P=(R*w-C*_)*A-l,L=Math.sqrt(O*O+P*P);let F=e.data.length*d,N=0,B=0;t:if(T){F*=c;let t=(D-L*L-F*F)/(2*L*F);t<-1?t=-1:t>1&&(t=1,s&&L+F>1e-4&&(h*=(Math.sqrt(D)/(L+F)-1)*o+1)),B=Math.acos(t)*i,w=L+F*t,E=F*Math.sin(B),N=Math.atan2(I*w-M*E,M*w+I*E)}else{w=c*F,E=u*F;const t=w*w,e=E*E,n=Math.atan2(I,M);_=e*L*L+t*D-t*e;const r=-2*e*L,s=e-t;if(S=r*r-4*s*_,S>=0){let t=Math.sqrt(S);r<0&&(t=-t),t=-(r+t)/2;const e=t/s,o=_/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=D){R=Math.sqrt(D-a*a)*i,N=n-Math.atan2(R,a),B=Math.atan2(R/u,(a-L)/c);break t}}let o=YQ.PI,a=L-w,l=a*a,h=0,d=0,f=L+w,p=f*f,m=0;_=-w*L/(t-e),_>=-1&&_<=1&&(_=Math.acos(_),C=w*Math.cos(_)+L,R=E*Math.sin(_),S=C*C+R*R,S<l&&(o=_,l=S,a=C,h=R),S>p&&(d=_,p=S,f=C,m=R)),D<=(l+p)/2?(N=n-Math.atan2(h*i,a),B=o*i):(N=n-Math.atan2(m*i,f),B=d*i)}const U=Math.atan2(y,v)*g;let V=t.arotation;N=(N-U)*YQ.radDeg+p-V,N>180?N-=360:N<-180&&(N+=360),t.updateWorldTransformWith(a,l,V+N*o,h,t.ascaleY,0,0),V=e.arotation,B=((B+U)*YQ.radDeg-e.ashearX)*g+m-V,B>180?B-=360:B<-180&&(B+=360),e.updateWorldTransformWith(v,y,V+B*o,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}},N2=class{constructor(t){this.order=0,this.bones=new Array,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.name=t}},B2=class{constructor(t){this.order=0,this.bones=new Array,this.name=t}};var U2=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t))(U2||{});const V2=class{constructor(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let n=0,r=t.bones.length;n<r;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}apply(){this.update()}update(){const t=this.target.getAttachment();if(!(t instanceof j1))return;const e=this.rotateMix,n=this.translateMix,r=e>0;if(!(n>0)&&!r)return;const i=this.data,s=i.spacingMode,o=s==U2.Length,a=i.rotateMode,l=a==IQ.Tangent,c=a==IQ.ChainScale,h=this.bones.length,u=l?h:h+1,d=this.bones,f=JQ.setArraySize(this.spaces,u);let p=null;const m=this.spacing;if(c||o){c&&(p=JQ.setArraySize(this.lengths,h));for(let t=0,e=u-1;t<e;){const e=d[t],n=e.data.length;if(n<V2.epsilon)c&&(p[t]=0),f[++t]=0;else{const r=n*e.matrix.a,i=n*e.matrix.b,s=Math.sqrt(r*r+i*i);c&&(p[t]=s),f[++t]=(o?n+m:m)*s/n}}}else for(let w=1;w<u;w++)f[w]=m;const g=this.computeWorldPositions(t,u,l,i.positionMode==MQ.Percent,s==U2.Percent);let v=g[0],y=g[1],b=i.offsetRotation,x=!1;if(0==b)x=a==IQ.Chain;else{x=!1;const t=this.target.bone.matrix;b*=t.a*t.d-t.b*t.c>0?YQ.degRad:-YQ.degRad}for(let w=0,E=3;w<h;w++,E+=3){const t=d[w],i=t.matrix;i.tx+=(v-i.tx)*n,i.ty+=(y-i.ty)*n;const s=g[E],o=g[E+1],a=s-v,h=o-y;if(c){const t=p[w];if(0!=t){const n=(Math.sqrt(a*a+h*h)/t-1)*e+1;i.a*=n,i.b*=n}}if(v=s,y=o,r){const n=i.a,r=i.c,s=i.b,o=i.d;let c=0,u=0,d=0;if(l&&(c=l?g[E-1]:0==f[w+1]?g[E+2]:Math.atan2(h,a)),c-=Math.atan2(s,n),x){u=Math.cos(c),d=Math.sin(c);const r=t.data.length;v+=(r*(u*n-d*s)-a)*e,y+=(r*(d*n+u*s)-h)*e}else c+=b;c>YQ.PI?c-=YQ.PI2:c<-YQ.PI&&(c+=YQ.PI2),c*=e,u=Math.cos(c),d=Math.sin(c),i.a=u*n-d*s,i.c=u*r-d*o,i.b=d*n+u*s,i.d=d*r+u*o}t.appliedValid=!1}}computeWorldPositions(t,e,n,r,i){const s=this.target;let o=this.position;const a=this.spaces,l=JQ.setArraySize(this.positions,3*e+2);let c=null;const h=t.closed;let u=t.worldVerticesLength,d=u/6,f=V2.NONE;if(!t.constantSpeed){const p=t.lengths;d-=h?1:2;const m=p[d];if(r&&(o*=m),i)for(let t=0;t<e;t++)a[t]*=m;c=JQ.setArraySize(this.world,8);for(let r=0,i=0,g=0;r<e;r++,i+=3){const e=a[r];o+=e;let v=o;if(h)v%=m,v<0&&(v+=m),g=0;else{if(v<0){f!=V2.BEFORE&&(f=V2.BEFORE,t.computeWorldVertices(s,2,4,c,0,2)),this.addBeforePosition(v,c,0,l,i);continue}if(v>m){f!=V2.AFTER&&(f=V2.AFTER,t.computeWorldVertices(s,u-6,4,c,0,2)),this.addAfterPosition(v-m,c,0,l,i);continue}}for(;;g++){const t=p[g];if(!(v>t)){if(0==g)v/=t;else{const e=p[g-1];v=(v-e)/(t-e)}break}}g!=f&&(f=g,h&&g==d?(t.computeWorldVertices(s,u-4,4,c,0,2),t.computeWorldVertices(s,0,4,c,4,2)):t.computeWorldVertices(s,6*g+2,8,c,0,2)),this.addCurvePosition(v,c[0],c[1],c[2],c[3],c[4],c[5],c[6],c[7],l,i,n||r>0&&0==e)}return l}h?(u+=2,c=JQ.setArraySize(this.world,u),t.computeWorldVertices(s,2,u-4,c,0,2),t.computeWorldVertices(s,0,2,c,u-4,2),c[u-2]=c[0],c[u-1]=c[1]):(d--,u-=4,c=JQ.setArraySize(this.world,u),t.computeWorldVertices(s,2,u,c,0,2));const p=JQ.setArraySize(this.curves,d);let m=0,g=c[0],v=c[1],y=0,b=0,x=0,w=0,E=0,_=0,S=0,T=0,k=0,A=0,C=0,R=0,M=0,I=0;for(let P=0,L=2;P<d;P++,L+=6)y=c[L],b=c[L+1],x=c[L+2],w=c[L+3],E=c[L+4],_=c[L+5],S=.1875*(g-2*y+x),T=.1875*(v-2*b+w),k=.09375*(3*(y-x)-g+E),A=.09375*(3*(b-w)-v+_),C=2*S+k,R=2*T+A,M=.75*(y-g)+S+.16666667*k,I=.75*(b-v)+T+.16666667*A,m+=Math.sqrt(M*M+I*I),M+=C,I+=R,C+=k,R+=A,m+=Math.sqrt(M*M+I*I),M+=C,I+=R,m+=Math.sqrt(M*M+I*I),M+=C+k,I+=R+A,m+=Math.sqrt(M*M+I*I),p[P]=m,g=E,v=_;if(r&&(o*=m),i)for(let P=0;P<e;P++)a[P]*=m;const D=this.segments;let O=0;for(let P=0,L=0,F=0,N=0;P<e;P++,L+=3){const t=a[P];o+=t;let e=o;if(h)e%=m,e<0&&(e+=m),F=0;else{if(e<0){this.addBeforePosition(e,c,0,l,L);continue}if(e>m){this.addAfterPosition(e-m,c,u-4,l,L);continue}}for(;;F++){const t=p[F];if(!(e>t)){if(0==F)e/=t;else{const n=p[F-1];e=(e-n)/(t-n)}break}}if(F!=f){f=F;let t=6*F;for(g=c[t],v=c[t+1],y=c[t+2],b=c[t+3],x=c[t+4],w=c[t+5],E=c[t+6],_=c[t+7],S=.03*(g-2*y+x),T=.03*(v-2*b+w),k=.006*(3*(y-x)-g+E),A=.006*(3*(b-w)-v+_),C=2*S+k,R=2*T+A,M=.3*(y-g)+S+.16666667*k,I=.3*(b-v)+T+.16666667*A,O=Math.sqrt(M*M+I*I),D[0]=O,t=1;t<8;t++)M+=C,I+=R,C+=k,R+=A,O+=Math.sqrt(M*M+I*I),D[t]=O;M+=C,I+=R,O+=Math.sqrt(M*M+I*I),D[8]=O,M+=C+k,I+=R+A,O+=Math.sqrt(M*M+I*I),D[9]=O,N=0}for(e*=O;;N++){const t=D[N];if(!(e>t)){if(0==N)e/=t;else{const n=D[N-1];e=N+(e-n)/(t-n)}break}}this.addCurvePosition(.1*e,g,v,y,b,x,w,E,_,l,L,n||P>0&&0==t)}return l}addBeforePosition(t,e,n,r,i){const s=e[n],o=e[n+1],a=e[n+2]-s,l=e[n+3]-o,c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addAfterPosition(t,e,n,r,i){const s=e[n+2],o=e[n+3],a=s-e[n],l=o-e[n+1],c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addCurvePosition(t,e,n,r,i,s,o,a,l,c,h,u){(0==t||isNaN(t))&&(t=1e-4);const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,v=p*t,y=3*v,b=p*y,x=y*t,w=e*g+r*b+s*x+a*f,E=n*g+i*b+o*x+l*f;c[h]=w,c[h+1]=E,u&&(c[h+2]=Math.atan2(E-(n*m+i*v*2+o*d),w-(e*m+r*v*2+s*d)))}getOrder(){return this.data.order}};let j2=V2;j2.NONE=-1,j2.BEFORE=-2,j2.AFTER=-3,j2.epsilon=1e-5;let z2=class{constructor(t,e){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t0,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix,this.scaleMix=t.scaleMix,this.shearMix=t.shearMix,this.bones=new Array;for(let n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}apply(){this.update()}update(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()}applyAbsoluteWorld(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,o=s.a,a=s.c,l=s.b,c=s.d,h=o*c-a*l>0?YQ.degRad:-YQ.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,f=this.bones;for(let p=0,m=f.length;p<m;p++){const s=f[p];let h=!1;const m=s.matrix;if(0!=t){const e=m.a,n=m.c,r=m.b,i=m.d;let s=Math.atan2(l,o)-Math.atan2(r,e)+u;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const a=Math.cos(s),c=Math.sin(s);m.a=a*e-c*r,m.c=a*n-c*i,m.b=c*e+a*r,m.d=c*n+a*i,h=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=(t.x-m.tx)*e,m.ty+=(t.y-m.ty)*e,h=!0}if(n>0){let t=Math.sqrt(m.a*m.a+m.b*m.b),e=Math.sqrt(o*o+l*l);t>1e-5&&(t=(t+(e-t+this.data.offsetScaleX)*n)/t),m.a*=t,m.b*=t,t=Math.sqrt(m.c*m.c+m.d*m.d),e=Math.sqrt(a*a+c*c),t>1e-5&&(t=(t+(e-t+this.data.offsetScaleY)*n)/t),m.c*=t,m.d*=t,h=!0}if(r>0){const t=m.c,e=m.d,n=Math.atan2(e,t);let i=Math.atan2(c,a)-Math.atan2(l,o)-(n-Math.atan2(m.b,m.a));i>YQ.PI?i-=YQ.PI2:i<-YQ.PI&&(i+=YQ.PI2),i=n+(i+d)*r;const s=Math.sqrt(t*t+e*e);m.c=Math.cos(i)*s,m.d=Math.sin(i)*s,h=!0}h&&(s.appliedValid=!1)}}applyRelativeWorld(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target,s=i.matrix,o=s.a,a=s.c,l=s.b,c=s.d,h=o*c-a*l>0?YQ.degRad:-YQ.degRad,u=this.data.offsetRotation*h,d=this.data.offsetShearY*h,f=this.bones;for(let p=0,m=f.length;p<m;p++){const s=f[p];let h=!1;const m=s.matrix;if(0!=t){const e=m.a,n=m.c,r=m.b,i=m.d;let s=Math.atan2(l,o)+u;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const a=Math.cos(s),c=Math.sin(s);m.a=a*e-c*r,m.c=a*n-c*i,m.b=c*e+a*r,m.d=c*n+a*i,h=!0}if(0!=e){const t=this.temp;i.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),m.tx+=t.x*e,m.ty+=t.y*e,h=!0}if(n>0){let t=(Math.sqrt(o*o+l*l)-1+this.data.offsetScaleX)*n+1;m.a*=t,m.b*=t,t=(Math.sqrt(a*a+c*c)-1+this.data.offsetScaleY)*n+1,m.c*=t,m.d*=t,h=!0}if(r>0){let t=Math.atan2(c,a)-Math.atan2(l,o);t>YQ.PI?t-=YQ.PI2:t<-YQ.PI&&(t+=YQ.PI2);const e=m.c,n=m.d;t=Math.atan2(n,e)+(t-YQ.PI/2+d)*r;const i=Math.sqrt(e*e+n*n);m.c=Math.cos(t)*i,m.d=Math.sin(t)*i,h=!0}h&&(s.appliedValid=!1)}}applyAbsoluteLocal(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const s=this.bones;for(let o=0,a=s.length;o<a;o++){const a=s[o];a.appliedValid||a.updateAppliedTransform();let l=a.arotation;if(0!=t){let e=i.arotation-l+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),l+=e*t}let c=a.ax,h=a.ay;0!=e&&(c+=(i.ax-c+this.data.offsetX)*e,h+=(i.ay-h+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;n>0&&(u>1e-5&&(u=(u+(i.ascaleX-u+this.data.offsetScaleX)*n)/u),d>1e-5&&(d=(d+(i.ascaleY-d+this.data.offsetScaleY)*n)/d));const f=a.ashearY;if(r>0){let t=i.ashearY-f+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),a.shearY+=t*r}a.updateWorldTransformWith(c,h,l,u,d,a.ashearX,f)}}applyRelativeLocal(){const t=this.rotateMix,e=this.translateMix,n=this.scaleMix,r=this.shearMix,i=this.target;i.appliedValid||i.updateAppliedTransform();const s=this.bones;for(let o=0,a=s.length;o<a;o++){const a=s[o];a.appliedValid||a.updateAppliedTransform();let l=a.arotation;0!=t&&(l+=(i.arotation+this.data.offsetRotation)*t);let c=a.ax,h=a.ay;0!=e&&(c+=(i.ax+this.data.offsetX)*e,h+=(i.ay+this.data.offsetY)*e);let u=a.ascaleX,d=a.ascaleY;n>0&&(u>1e-5&&(u*=(i.ascaleX-1+this.data.offsetScaleX)*n+1),d>1e-5&&(d*=(i.ascaleY-1+this.data.offsetScaleY)*n+1));let f=a.ashearY;r>0&&(f+=(i.ashearY+this.data.offsetShearY)*r),a.updateWorldTransformWith(c,h,l,u,d,a.ashearX,f)}}getOrder(){return this.data.order}};const G2=class{constructor(t){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const n=t.bones[e];let r;if(null==n.parent)r=new D2(n,this,null);else{const t=this.bones[n.parent.index];r=new D2(n,this,t),t.children.push(r)}this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const n=t.slots[e],r=this.bones[n.boneData.index],i=new G1(n,r);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const n=t.ikConstraints[e];this.ikConstraints.push(new F2(n,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const n=t.transformConstraints[e];this.transformConstraints.push(new z2(n,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const n=t.pathConstraints[e];this.pathConstraints.push(new j2(n,this))}this.color=new HQ(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0,this.updateCacheReset.length=0;const t=this.bones;for(let l=0,c=t.length;l<c;l++)t[l].sorted=!1;const e=this.ikConstraints,n=this.transformConstraints,r=this.pathConstraints,i=e.length,s=n.length,o=r.length,a=i+s+o;t:for(let l=0;l<a;l++){for(let t=0;t<i;t++){const n=e[t];if(n.data.order==l){this.sortIkConstraint(n);continue t}}for(let t=0;t<s;t++){const e=n[t];if(e.data.order==l){this.sortTransformConstraint(e);continue t}}for(let t=0;t<o;t++){const e=r[t];if(e.data.order==l){this.sortPathConstraint(e);continue t}}}for(let l=0,c=t.length;l<c;l++)this.sortBone(t[l])}sortIkConstraint(t){const e=t.target;this.sortBone(e);const n=t.bones,r=n[0];if(this.sortBone(r),n.length>1){const t=n[n.length-1];this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}this._updateCache.push(t),this.sortReset(r.children),n[n.length-1].sorted=!0}sortPathConstraint(t){const e=t.target,n=e.data.index,r=e.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(let a=0,l=this.data.skins.length;a<l;a++)this.sortPathConstraintAttachment(this.data.skins[a],n,r);const i=e.getAttachment();i instanceof j1&&this.sortPathConstraintAttachmentWith(i,r);const s=t.bones,o=s.length;for(let a=0;a<o;a++)this.sortBone(s[a]);this._updateCache.push(t);for(let a=0;a<o;a++)this.sortReset(s[a].children);for(let a=0;a<o;a++)s[a].sorted=!0}sortTransformConstraint(t){this.sortBone(t.target);const e=t.bones,n=e.length;if(t.data.local)for(let r=0;r<n;r++){const t=e[r];this.sortBone(t.parent),this._updateCache.indexOf(t)>-1||this.updateCacheReset.push(t)}else for(let r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<n;r++)this.sortReset(e[r].children);for(let r=0;r<n;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,n){const r=t.attachments[e];if(r)for(const i in r)this.sortPathConstraintAttachmentWith(r[i],n)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof j1))return;const n=t.bones;if(null==n)this.sortBone(e);else{const t=this.bones;let e=0;for(;e<n.length;){const r=n[e++];for(let i=e+r;e<i;e++){const r=n[e];this.sortBone(t[r])}}}}sortBone(t){if(t.sorted)return;const e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];n.sorted&&this.sortReset(n.children),n.sorted=!1}}updateWorldTransform(){const t=this.updateCacheReset;for(let n=0,r=t.length;n<r;n++){const e=t[n];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY,e.appliedValid=!0}const e=this._updateCache;for(let n=0,r=e.length;n<r;n++)e[n].update()}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,s=t.length;i<s;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,s=e.length;i<s;i++){const t=e[i];t.bendDirection=t.data.bendDirection,t.mix=t.data.mix}const n=this.transformConstraints;for(let i=0,s=n.length;i<s;i++){const t=n[i],e=t.data;t.rotateMix=e.rotateMix,t.translateMix=e.translateMix,t.scaleMix=e.scaleMix,t.shearMix=e.shearMix}const r=this.pathConstraints;for(let i=0,s=r.length;i<s;i++){const t=r[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.rotateMix=e.rotateMix,t.translateMix=e.translateMix}}setSlotsToSetupPose(){const t=this.slots;JQ.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(null==e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n],i=r.data.attachmentName;if(null!=i){const e=t.getAttachment(n,i);null!=e&&r.setAttachment(e)}}}this.skin=t}getAttachmentByName(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)}getAttachment(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){const n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(null==t)throw new Error("slotName cannot be null.");const n=this.slots;for(let r=0,i=n.length;r<i;r++){const i=n[r];if(i.data.name==t){let n=null;if(null!=e&&(n=this.getAttachment(r,e),null==n))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(n)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}getBounds(t,e,n){if(null==t)throw new Error("offset cannot be null.");if(null==e)throw new Error("size cannot be null.");const r=this.drawOrder;let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let l=0,c=r.length;l<c;l++){const t=r[l];let e=0,c=null;const h=t.getAttachment();if(h instanceof H1)e=8,c=JQ.setArraySize(n,e,0),h.computeWorldVertices(t.bone,c,0,2);else if(h instanceof V1){const r=h;e=r.worldVerticesLength,c=JQ.setArraySize(n,e,0),r.computeWorldVertices(t,0,e,c,0,2)}if(null!=c)for(let n=0,r=c.length;n<r;n+=2){const t=c[n],e=c[n+1];i=Math.min(i,t),s=Math.min(s,e),o=Math.max(o,t),a=Math.max(a,e)}}t.set(i,s),e.set(o-i,a-s)}update(t){this.time+=t}get flipX(){return-1==this.scaleX}set flipX(t){G2.deprecatedWarning1||(G2.deprecatedWarning1=!0),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){G2.deprecatedWarning1||(G2.deprecatedWarning1=!0),this.scaleY=t?1:-1}};let W2=G2;W2.deprecatedWarning1=!1;let H2=class{constructor(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}findBone(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findBoneIndex(t){if(null==t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSlot(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findSlotIndex(t){if(null==t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSkin(t){if(null==t)throw new Error("skinName cannot be null.");const e=this.skins;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findEvent(t){if(null==t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findAnimation(t){if(null==t)throw new Error("animationName cannot be null.");const e=this.animations;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findIkConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findTransformConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraint(t){if(null==t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}},$2=class{constructor(t,e,n){if(this.color=new HQ(1,1,1,1),t<0)throw new Error("index must be >= 0.");if(null==e)throw new Error("name cannot be null.");if(null==n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n}},Y2=class{constructor(t){if(this.order=0,this.bones=new Array,this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1,null==t)throw new Error("name cannot be null.");this.name=t}},X2=class{constructor(t){if(this.attachments=new Array,null==t)throw new Error("name cannot be null.");this.name=t}addAttachment(t,e,n){if(null==n)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n}getAttachment(t,e){const n=this.attachments[t];return n?n[e]:null}attachAll(t,e){let n=0;for(let r=0;r<t.slots.length;r++){const i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){const t=e.attachments[n];for(const e in t){if(s==t[e]){const t=this.getAttachment(n,e);null!=t&&i.setAttachment(t);break}}}n++}}},q2=class t{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(e){const n=this.scale,r=new H2,i="string"==typeof e?JSON.parse(e):e,s=i.skeleton;if(null!=s&&(r.hash=s.hash,r.version=s.spine,r.width=s.width,r.height=s.height,r.fps=s.fps,r.imagesPath=s.images),i.bones)for(let o=0;o<i.bones.length;o++){const e=i.bones[o];let s=null;const a=this.getValue(e,"parent",null);if(null!=a&&(s=r.findBone(a),null==s))throw new Error(`Parent bone not found: ${a}`);const l=new O2(r.bones.length,e.name,s);l.length=this.getValue(e,"length",0)*n,l.x=this.getValue(e,"x",0)*n,l.y=this.getValue(e,"y",0)*n,l.rotation=this.getValue(e,"rotation",0),l.scaleX=this.getValue(e,"scaleX",1),l.scaleY=this.getValue(e,"scaleY",1),l.shearX=this.getValue(e,"shearX",0),l.shearY=this.getValue(e,"shearY",0),l.transformMode=t.transformModeFromString(this.getValue(e,"transform","normal")),r.bones.push(l)}if(i.slots)for(let o=0;o<i.slots.length;o++){const e=i.slots[o],n=e.name,s=e.bone,a=r.findBone(s);if(null==a)throw new Error(`Slot bone not found: ${s}`);const l=new $2(r.slots.length,n,a),c=this.getValue(e,"color",null);null!=c&&l.color.setFromString(c);const h=this.getValue(e,"dark",null);null!=h&&(l.darkColor=new HQ(1,1,1,1),l.darkColor.setFromString(h)),l.attachmentName=this.getValue(e,"attachment",null),l.blendMode=t.blendModeFromString(this.getValue(e,"blend","normal")),r.slots.push(l)}if(i.ik)for(let t=0;t<i.ik.length;t++){const e=i.ik[t],n=new N2(e.name);n.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const i=e.bones[t],s=r.findBone(i);if(null==s)throw new Error(`IK bone not found: ${i}`);n.bones.push(s)}const s=e.target;if(n.target=r.findBone(s),null==n.target)throw new Error(`IK target bone not found: ${s}`);n.bendDirection=this.getValue(e,"bendPositive",!0)?1:-1,n.mix=this.getValue(e,"mix",1),r.ikConstraints.push(n)}if(i.transform)for(let t=0;t<i.transform.length;t++){const e=i.transform[t],s=new Y2(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`Transform constraint bone not found: ${n}`);s.bones.push(i)}const o=e.target;if(s.target=r.findBone(o),null==s.target)throw new Error(`Transform constraint target bone not found: ${o}`);s.local=this.getValue(e,"local",!1),s.relative=this.getValue(e,"relative",!1),s.offsetRotation=this.getValue(e,"rotation",0),s.offsetX=this.getValue(e,"x",0)*n,s.offsetY=this.getValue(e,"y",0)*n,s.offsetScaleX=this.getValue(e,"scaleX",0),s.offsetScaleY=this.getValue(e,"scaleY",0),s.offsetShearY=this.getValue(e,"shearY",0),s.rotateMix=this.getValue(e,"rotateMix",1),s.translateMix=this.getValue(e,"translateMix",1),s.scaleMix=this.getValue(e,"scaleMix",1),s.shearMix=this.getValue(e,"shearMix",1),r.transformConstraints.push(s)}if(i.path)for(let o=0;o<i.path.length;o++){const e=i.path[o],s=new B2(e.name);s.order=this.getValue(e,"order",0);for(let t=0;t<e.bones.length;t++){const n=e.bones[t],i=r.findBone(n);if(null==i)throw new Error(`Transform constraint bone not found: ${n}`);s.bones.push(i)}const a=e.target;if(s.target=r.findSlot(a),null==s.target)throw new Error(`Path target slot not found: ${a}`);s.positionMode=t.positionModeFromString(this.getValue(e,"positionMode","percent")),s.spacingMode=t.spacingModeFromString(this.getValue(e,"spacingMode","length")),s.rotateMode=t.rotateModeFromString(this.getValue(e,"rotateMode","tangent")),s.offsetRotation=this.getValue(e,"rotation",0),s.position=this.getValue(e,"position",0),s.positionMode==MQ.Fixed&&(s.position*=n),s.spacing=this.getValue(e,"spacing",0),s.spacingMode!=U2.Length&&s.spacingMode!=U2.Fixed||(s.spacing*=n),s.rotateMix=this.getValue(e,"rotateMix",1),s.translateMix=this.getValue(e,"translateMix",1),r.pathConstraints.push(s)}if(i.skins)for(const t in i.skins){const e=i.skins[t],n=new X2(t);for(const t in e){const i=r.findSlotIndex(t);if(-1==i)throw new Error(`Slot not found: ${t}`);const s=e[t];for(const t in s){const e=this.readAttachment(s[t],n,i,t,r);null!=e&&n.addAttachment(i,t,e)}}r.skins.push(n),"default"==n.name&&(r.defaultSkin=n)}for(let t=0,o=this.linkedMeshes.length;t<o;t++){const e=this.linkedMeshes[t],n=null==e.skin?r.defaultSkin:r.findSkin(e.skin);if(null==n)throw new Error(`Skin not found: ${e.skin}`);const i=n.getAttachment(e.slotIndex,e.parent);if(null==i)throw new Error(`Parent mesh not found: ${e.parent}`);e.mesh.setParentMesh(i)}if(this.linkedMeshes.length=0,i.events)for(const t in i.events){const e=i.events[t],n=new L2(t);n.intValue=this.getValue(e,"int",0),n.floatValue=this.getValue(e,"float",0),n.stringValue=this.getValue(e,"string",""),n.audioPath=this.getValue(e,"audio",null),null!=n.audioPath&&(n.volume=this.getValue(e,"volume",1),n.balance=this.getValue(e,"balance",0)),r.events.push(n)}if(i.animations)for(const t in i.animations){const e=i.animations[t];this.readAnimation(e,t,r)}return r}readAttachment(t,e,n,r,i){const s=this.scale;r=this.getValue(t,"name",r);switch(this.getValue(t,"type","region")){case"region":{const n=this.getValue(t,"path",r),i=this.attachmentLoader.newRegionAttachment(e,r,n);if(null==i)return null;i.path=n,i.x=this.getValue(t,"x",0)*s,i.y=this.getValue(t,"y",0)*s,i.scaleX=this.getValue(t,"scaleX",1),i.scaleY=this.getValue(t,"scaleY",1),i.rotation=this.getValue(t,"rotation",0),i.width=t.width*s,i.height=t.height*s;const o=this.getValue(t,"color",null);return null!=o&&i.color.setFromString(o),i}case"boundingbox":{const n=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(null==n)return null;this.readVertices(t,n,t.vertexCount<<1);const i=this.getValue(t,"color",null);return null!=i&&n.color.setFromString(i),n}case"mesh":case"linkedmesh":{const i=this.getValue(t,"path",r),s=this.attachmentLoader.newMeshAttachment(e,r,i);if(null==s)return null;s.path=i;const o=this.getValue(t,"color",null);null!=o&&s.color.setFromString(o);const a=this.getValue(t,"parent",null);if(null!=a)return s.inheritDeform=this.getValue(t,"deform",!0),this.linkedMeshes.push(new K2(s,this.getValue(t,"skin",null),n,a)),s;const l=t.uvs;return this.readVertices(t,s,l.length),s.triangles=t.triangles,s.regionUVs=new Float32Array(l),s.hullLength=2*this.getValue(t,"hull",0),s}case"path":{const n=this.attachmentLoader.newPathAttachment(e,r);if(null==n)return null;n.closed=this.getValue(t,"closed",!1),n.constantSpeed=this.getValue(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,n,i<<1);const o=JQ.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*s;n.lengths=o;const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}case"point":{const n=this.attachmentLoader.newPointAttachment(e,r);if(null==n)return null;n.x=this.getValue(t,"x",0)*s,n.y=this.getValue(t,"y",0)*s,n.rotation=this.getValue(t,"rotation",0);const i=this.getValue(t,"color",null);return null!=i&&n.color.setFromString(i),n}case"clipping":{const n=this.attachmentLoader.newClippingAttachment(e,r);if(null==n)return null;const s=this.getValue(t,"end",null);if(null!=s){const t=i.findSlot(s);if(null==t)throw new Error(`Clipping end slot not found: ${s}`);n.endSlot=t}const o=t.vertexCount;this.readVertices(t,n,o<<1);const a=this.getValue(t,"color",null);return null!=a&&n.color.setFromString(a),n}}return null}readVertices(t,e,n){const r=this.scale;e.worldVerticesLength=n;const i=t.vertices;if(n==i.length){const t=JQ.toFloatArray(i);if(1!=r)for(let e=0,n=i.length;e<n;e++)t[e]*=r;return void(e.vertices=t)}const s=new Array,o=new Array;for(let a=0,l=i.length;a<l;){const t=i[a++];o.push(t);for(let e=a+4*t;a<e;a+=4)o.push(i[a]),s.push(i[a+1]*r),s.push(i[a+2]*r),s.push(i[a+3])}e.bones=o,e.vertices=JQ.toFloatArray(s)}readAnimation(t,e,n){const r=this.scale,i=new Array;let s=0;if(t.slots)for(const a in t.slots){const e=t.slots[a],r=n.findSlotIndex(a);if(-1==r)throw new Error(`Slot not found: ${a}`);for(const t in e){const n=e[t];if("attachment"==t){const t=new l2(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e++,i.time,i.name)}i.push(t),s=Math.max(s,t.frames[t.getFrameCount()-1])}else if("color"==t){const t=new s2(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r],s=new HQ;s.setFromString(i.color||"ffffffff"),t.setFrame(e,i.time,s.r,s.g,s.b,s.a),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*s2.ENTRIES])}else{if("twoColor"!=t)throw new Error(`Invalid timeline type for a slot: ${t} (${a})`);{const t=new a2(n.length);t.slotIndex=r;let e=0;for(let r=0;r<n.length;r++){const i=n[r],s=new HQ,o=new HQ;s.setFromString(i.light),o.setFromString(i.dark),t.setFrame(e,i.time,s.r,s.g,s.b,s.a,o.r,o.g,o.b),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*a2.ENTRIES])}}}}if(t.bones)for(const a in t.bones){const e=t.bones[a],o=n.findBoneIndex(a);if(-1==o)throw new Error(`Bone not found: ${a}`);for(const t in e){const n=e[t];if("rotate"===t){const t=new Q1(n.length);t.boneIndex=o;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e,i.time,i.angle),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*Q1.ENTRIES])}else{if("translate"!==t&&"scale"!==t&&"shear"!==t)throw new Error(`Invalid timeline type for a bone: ${t} (${a})`);{let e=null,a=1;"scale"===t?e=new n2(n.length):"shear"===t?e=new r2(n.length):(e=new e2(n.length),a=r),e.boneIndex=o;let l=0;for(let t=0;t<n.length;t++){const r=n[t],i=this.getValue(r,"x",0),s=this.getValue(r,"y",0);e.setFrame(l,r.time,i*a,s*a),this.readCurve(r,e,l),l++}i.push(e),s=Math.max(s,e.frames[(e.getFrameCount()-1)*e2.ENTRIES])}}}}if(t.ik)for(const a in t.ik){const e=t.ik[a],r=n.findIkConstraint(a),o=new p2(e.length);o.ikConstraintIndex=n.ikConstraints.indexOf(r);let l=0;for(let t=0;t<e.length;t++){const n=e[t];o.setFrame(l,n.time,this.getValue(n,"mix",1),this.getValue(n,"bendPositive",!0)?1:-1,this.getValue(n,"compress",!1),this.getValue(n,"stretch",!1)),this.readCurve(n,o,l),l++}i.push(o),s=Math.max(s,o.frames[(o.getFrameCount()-1)*p2.ENTRIES])}if(t.transform)for(const a in t.transform){const e=t.transform[a],r=n.findTransformConstraint(a),o=new g2(e.length);o.transformConstraintIndex=n.transformConstraints.indexOf(r);let l=0;for(let t=0;t<e.length;t++){const n=e[t];o.setFrame(l,n.time,this.getValue(n,"rotateMix",1),this.getValue(n,"translateMix",1),this.getValue(n,"scaleMix",1),this.getValue(n,"shearMix",1)),this.readCurve(n,o,l),l++}i.push(o),s=Math.max(s,o.frames[(o.getFrameCount()-1)*g2.ENTRIES])}if(t.paths)for(const a in t.paths){const e=t.paths[a],o=n.findPathConstraintIndex(a);if(-1==o)throw new Error(`Path constraint not found: ${a}`);const l=n.pathConstraints[o];for(const t in e){const n=e[t];if("position"===t||"spacing"===t){let e=null,a=1;"spacing"===t?(e=new b2(n.length),l.spacingMode!=U2.Length&&l.spacingMode!=U2.Fixed||(a=r)):(e=new y2(n.length),l.positionMode==MQ.Fixed&&(a=r)),e.pathConstraintIndex=o;let c=0;for(let r=0;r<n.length;r++){const i=n[r];e.setFrame(c,i.time,this.getValue(i,t,0)*a),this.readCurve(i,e,c),c++}i.push(e),s=Math.max(s,e.frames[(e.getFrameCount()-1)*y2.ENTRIES])}else if("mix"===t){const t=new w2(n.length);t.pathConstraintIndex=o;let e=0;for(let r=0;r<n.length;r++){const i=n[r];t.setFrame(e,i.time,this.getValue(i,"rotateMix",1),this.getValue(i,"translateMix",1)),this.readCurve(i,t,e),e++}i.push(t),s=Math.max(s,t.frames[(t.getFrameCount()-1)*w2.ENTRIES])}}}if(t.deform)for(const a in t.deform){const e=t.deform[a],o=n.findSkin(a);if(null!=o)for(const t in e){const a=e[t],l=n.findSlotIndex(t);if(-1==l)throw new Error(`Slot not found: ${a.name}`);for(const t in a){const e=a[t],n=o.getAttachment(l,t);if(null==n)throw new Error(`Deform attachment not found: ${e.name}`);const c=null!=n.bones,h=n.vertices,u=c?h.length/3*2:h.length,d=new h2(e.length);d.slotIndex=l,d.attachment=n;let f=0;for(let t=0;t<e.length;t++){const n=e[t];let i;const s=this.getValue(n,"vertices",null);if(null==s)i=c?JQ.newFloatArray(u):h;else{i=JQ.newFloatArray(u);const t=this.getValue(n,"offset",0);if(JQ.arrayCopy(s,0,i,t,s.length),1!=r)for(let e=t,n=e+s.length;e<n;e++)i[e]*=r;if(!c)for(let e=0;e<u;e++)i[e]+=h[e]}d.setFrame(f,n.time,i),this.readCurve(n,d,f),f++}i.push(d),s=Math.max(s,d.frames[d.getFrameCount()-1])}}}let o=t.drawOrder;if(null==o&&(o=t.draworder),null!=o){const t=new d2(o.length),e=n.slots.length;let r=0;for(let i=0;i<o.length;i++){const s=o[i];let a=null;const l=this.getValue(s,"offsets",null);if(null!=l){a=JQ.newArray(e,-1);const t=JQ.newArray(e-l.length,0);let r=0,i=0;for(let e=0;e<l.length;e++){const s=l[e],o=n.findSlotIndex(s.slot);if(-1==o)throw new Error(`Slot not found: ${s.slot}`);for(;r!=o;)t[i++]=r++;a[r+s.offset]=r++}for(;r<e;)t[i++]=r++;for(let n=e-1;n>=0;n--)-1==a[n]&&(a[n]=t[--i])}t.setFrame(r++,s.time,a)}i.push(t),s=Math.max(s,t.frames[t.getFrameCount()-1])}if(t.events){const e=new u2(t.events.length);let r=0;for(let i=0;i<t.events.length;i++){const s=t.events[i],o=n.findEvent(s.name);if(null==o)throw new Error(`Event not found: ${s.name}`);const a=new P2(JQ.toSinglePrecision(s.time),o);a.intValue=this.getValue(s,"int",o.intValue),a.floatValue=this.getValue(s,"float",o.floatValue),a.stringValue=this.getValue(s,"string",o.stringValue),null!=a.data.audioPath&&(a.volume=this.getValue(s,"volume",1),a.balance=this.getValue(s,"balance",0)),e.setFrame(r++,a)}i.push(e),s=Math.max(s,e.frames[e.getFrameCount()-1])}if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new X1(e,i,s))}readCurve(t,e,n){if(t.curve)if("stepped"===t.curve)e.setStepped(n);else if("[object Array]"===Object.prototype.toString.call(t.curve)){const r=t.curve;e.setCurve(n,r[0],r[1],r[2],r[3])}}getValue(t,e,n){return void 0!==t[e]?t[e]:n}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return CW.NORMAL;if("additive"==t)return CW.ADD;if("multiply"==t)return CW.MULTIPLY;if("screen"==t)return CW.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}static positionModeFromString(t){if("fixed"==(t=t.toLowerCase()))return MQ.Fixed;if("percent"==t)return MQ.Percent;throw new Error(`Unknown position mode: ${t}`)}static spacingModeFromString(t){if("length"==(t=t.toLowerCase()))return U2.Length;if("fixed"==t)return U2.Fixed;if("percent"==t)return U2.Percent;throw new Error(`Unknown position mode: ${t}`)}static rotateModeFromString(t){if("tangent"==(t=t.toLowerCase()))return IQ.Tangent;if("chain"==t)return IQ.Chain;if("chainscale"==t)return IQ.ChainScale;throw new Error(`Unknown rotate mode: ${t}`)}static transformModeFromString(t){if("normal"==(t=t.toLowerCase()))return DQ.Normal;if("onlytranslation"==t)return DQ.OnlyTranslation;if("norotationorreflection"==t)return DQ.NoRotationOrReflection;if("noscale"==t)return DQ.NoScale;if("noscaleorreflection"==t)return DQ.NoScaleOrReflection;throw new Error(`Unknown transform mode: ${t}`)}},K2=class{constructor(t,e,n,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r}};const Z2=Object.freeze(Object.defineProperty({__proto__:null,Animation:X1,AnimationState:_2,AnimationStateAdapter2:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:M2,AtlasAttachmentLoader:I2,Attachment:L1,AttachmentTimeline:l2,Bone:D2,BoneData:O2,BoundingBoxAttachment:B1,ClippingAttachment:U1,ColorTimeline:s2,CurveTimeline:Z1,DeformTimeline:h2,DrawOrderTimeline:d2,Event:P2,EventData:L2,EventQueue:A2,EventTimeline:u2,EventType:C2,IkConstraint:F2,IkConstraintData:N2,IkConstraintTimeline:p2,JitterEffect:class{constructor(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}begin(t){}transform(t,e,n,r){t.x+=YQ.randomTriangular(-this.jitterX,this.jitterY),t.y+=YQ.randomTriangular(-this.jitterX,this.jitterY)}end(){}},MeshAttachment:V1,PathAttachment:j1,PathConstraint:j2,PathConstraintData:B2,PathConstraintMixTimeline:w2,PathConstraintPositionTimeline:y2,PathConstraintSpacingTimeline:b2,PointAttachment:z1,RegionAttachment:H1,RotateTimeline:Q1,ScaleTimeline:n2,ShearTimeline:r2,Skeleton:W2,SkeletonBounds:class extends e0{},SkeletonData:H2,SkeletonJson:q2,Skin:X2,Slot:G1,SlotData:$2,SpacingMode:U2,Spine:class extends a0{createSkeleton(t){this.skeleton=new W2(t),this.skeleton.updateWorldTransform(),this.stateData=new M2(t),this.state=new _2(this.stateData)}},SwirlEffect:Y1,TimelineType:q1,TrackEntry:T2,TransformConstraint:z2,TransformConstraintData:Y2,TransformConstraintTimeline:g2,TranslateTimeline:e2,TwoColorTimeline:a2,VertexAttachment:N1},Symbol.toStringTag,{value:"Module"}));class J2{constructor(t){if(!t)throw new Error("name cannot be null.");this.name=t}}const Q2=class extends J2{constructor(t){super(t),this.id=Q2.nextID++,this.bones=null,this.vertices=[],this.worldVerticesLength=0,this.timelineAttachment=this}computeWorldVerticesOld(t,e){this.computeWorldVertices(t,0,this.worldVerticesLength,e,0,2)}computeWorldVertices(t,e,n,r,i,s){n=i+(n>>1)*s;const o=t.bone.skeleton,a=t.deform;let l=this.vertices;const c=this.bones;if(!c){a.length>0&&(l=a);const o=t.bone.matrix,c=o.tx,h=o.ty,u=o.a,d=o.c,f=o.b,p=o.d;for(let t=e,a=i;a<n;t+=2,a+=s){const e=l[t],n=l[t+1];r[a]=e*u+n*d+c,r[a+1]=e*f+n*p+h}return}let h=0,u=0;for(let f=0;f<e;f+=2){const t=c[h];h+=t+1,u+=t}const d=o.bones;if(0==a.length)for(let f=i,p=3*u;f<n;f+=s){let t=0,e=0,n=c[h++];for(n+=h;h<n;h++,p+=3){const n=d[c[h]].matrix,r=l[p],i=l[p+1],s=l[p+2];t+=(r*n.a+i*n.c+n.tx)*s,e+=(r*n.b+i*n.d+n.ty)*s}r[f]=t,r[f+1]=e}else{const t=a;for(let e=i,o=3*u,a=u<<1;e<n;e+=s){let n=0,i=0,s=c[h++];for(s+=h;h<s;h++,o+=3,a+=2){const e=d[c[h]].matrix,r=l[o]+t[a],s=l[o+1]+t[a+1],u=l[o+2];n+=(r*e.a+s*e.c+e.tx)*u,i+=(r*e.b+s*e.d+e.ty)*u}r[e]=n,r[e+1]=i}}}copyTo(t){this.bones?(t.bones=new Array(this.bones.length),JQ.arrayCopy(this.bones,0,t.bones,0,this.bones.length)):t.bones=null,this.vertices&&(t.vertices=JQ.newFloatArray(this.vertices.length),JQ.arrayCopy(this.vertices,0,t.vertices,0,this.vertices.length)),t.worldVerticesLength=this.worldVerticesLength,t.timelineAttachment=this.timelineAttachment}};let t3=Q2;t3.nextID=0;class e3 extends t3{constructor(t){super(t),this.type=kQ.BoundingBox,this.color=new HQ(1,1,1,1)}copy(){const t=new e3(this.name);return this.copyTo(t),t.color.setFromColor(this.color),t}}class n3 extends t3{constructor(t){super(t),this.type=kQ.Clipping,this.endSlot=null,this.color=new HQ(.2275,.2275,.8078,1)}copy(){const t=new n3(this.name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t}}class r3 extends t3{constructor(t,e){super(t),this.type=kQ.Mesh,this.region=null,this.triangles=[],this.color=new HQ(1,1,1,1),this.width=0,this.height=0,this.hullLength=0,this.edges=[],this.parentMesh=null,this.sequence=null,this.tempColor=new HQ(0,0,0,0),this.path=e}getParentMesh(){return this.parentMesh}setParentMesh(t){this.parentMesh=t,t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)}copy(){if(this.parentMesh)return this.newLinkedMesh();const t=new r3(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),this.copyTo(t),t.regionUVs=new Float32Array(this.regionUVs.length),JQ.arrayCopy(this.regionUVs,0,t.regionUVs,0,this.regionUVs.length),t.triangles=new Array(this.triangles.length),JQ.arrayCopy(this.triangles,0,t.triangles,0,this.triangles.length),t.hullLength=this.hullLength,t.sequence=null!=this.sequence?this.sequence.copy():null,this.edges&&(t.edges=new Array(this.edges.length),JQ.arrayCopy(this.edges,0,t.edges,0,this.edges.length)),t.width=this.width,t.height=this.height,t}computeWorldVertices(t,e,n,r,i,s){null!=this.sequence&&this.sequence.apply(t,this),super.computeWorldVertices(t,e,n,r,i,s)}newLinkedMesh(){const t=new r3(this.name,this.path);return t.region=this.region,t.color.setFromColor(this.color),t.timelineAttachment=this.timelineAttachment,t.setParentMesh(this.parentMesh?this.parentMesh:this),t}}class i3 extends t3{constructor(t){super(t),this.type=kQ.Path,this.lengths=[],this.closed=!1,this.constantSpeed=!1,this.color=new HQ(1,1,1,1)}copy(){const t=new i3(this.name);return this.copyTo(t),t.lengths=new Array(this.lengths.length),JQ.arrayCopy(this.lengths,0,t.lengths,0,this.lengths.length),t.closed=closed,t.constantSpeed=this.constantSpeed,t.color.setFromColor(this.color),t}}class s3 extends t3{constructor(t){super(t),this.type=kQ.Point,this.x=0,this.y=0,this.rotation=0,this.color=new HQ(.38,.94,0,1)}computeWorldPosition(t,e){const n=t.matrix;return e.x=this.x*n.a+this.y*n.c+t.worldX,e.y=this.x*n.b+this.y*n.d+t.worldY,e}computeWorldRotation(t){const e=t.matrix,n=YQ.cosDeg(this.rotation),r=YQ.sinDeg(this.rotation),i=n*e.a+r*e.c,s=n*e.b+r*e.d;return Math.atan2(s,i)*YQ.radDeg}copy(){const t=new s3(this.name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t}}const o3=class extends J2{constructor(t,e){super(t),this.type=kQ.Region,this.x=0,this.y=0,this.scaleX=1,this.scaleY=1,this.rotation=0,this.width=0,this.height=0,this.color=new HQ(1,1,1,1),this.rendererObject=null,this.region=null,this.sequence=null,this.offset=JQ.newFloatArray(8),this.uvs=JQ.newFloatArray(8),this.tempColor=new HQ(1,1,1,1),this.path=e}updateRegion(){if(!this.region)throw new Error("Region not set.");const t=this.region,e=this.width/this.region.originalWidth*this.scaleX,n=this.height/this.region.originalHeight*this.scaleY,r=-this.width/2*this.scaleX+this.region.offsetX*e,i=-this.height/2*this.scaleY+this.region.offsetY*n,s=r+this.region.width*e,o=i+this.region.height*n,a=this.rotation*Math.PI/180,l=Math.cos(a),c=Math.sin(a),h=this.x,u=this.y,d=r*l+h,f=r*c,p=i*l+u,m=i*c,g=s*l+h,v=s*c,y=o*l+u,b=o*c,x=this.offset;x[0]=d-m,x[1]=p+f,x[2]=d-b,x[3]=y+f,x[4]=g-b,x[5]=y+v,x[6]=g-m,x[7]=p+v;const w=this.uvs;90==t.degrees?(w[2]=t.u,w[3]=t.v2,w[4]=t.u,w[5]=t.v,w[6]=t.u2,w[7]=t.v,w[0]=t.u2,w[1]=t.v2):(w[0]=t.u,w[1]=t.v2,w[2]=t.u,w[3]=t.v,w[4]=t.u2,w[5]=t.v,w[6]=t.u2,w[7]=t.v2)}computeWorldVertices(t,e,n,r){null!=this.sequence&&this.sequence.apply(t,this);const i=t.bone,s=this.offset,o=i.matrix,a=o.tx,l=o.ty,c=o.a,h=o.c,u=o.b,d=o.d;let f=0,p=0;f=s[0],p=s[1],e[n]=f*c+p*h+a,e[n+1]=f*u+p*d+l,n+=r,f=s[2],p=s[3],e[n]=f*c+p*h+a,e[n+1]=f*u+p*d+l,n+=r,f=s[4],p=s[5],e[n]=f*c+p*h+a,e[n+1]=f*u+p*d+l,n+=r,f=s[6],p=s[7],e[n]=f*c+p*h+a,e[n+1]=f*u+p*d+l}copy(){const t=new o3(this.name,this.path);return t.region=this.region,t.rendererObject=this.rendererObject,t.x=this.x,t.y=this.y,t.scaleX=this.scaleX,t.scaleY=this.scaleY,t.rotation=this.rotation,t.width=this.width,t.height=this.height,JQ.arrayCopy(this.uvs,0,t.uvs,0,8),JQ.arrayCopy(this.offset,0,t.offset,0,8),t.color.setFromColor(this.color),t.sequence=null!=this.sequence?this.sequence.copy():null,t}};let a3=o3;a3.X1=0,a3.Y1=1,a3.C1R=2,a3.C1G=3,a3.C1B=4,a3.C1A=5,a3.U1=6,a3.V1=7,a3.X2=8,a3.Y2=9,a3.C2R=10,a3.C2G=11,a3.C2B=12,a3.C2A=13,a3.U2=14,a3.V2=15,a3.X3=16,a3.Y3=17,a3.C3R=18,a3.C3G=19,a3.C3B=20,a3.C3A=21,a3.U3=22,a3.V3=23,a3.X4=24,a3.Y4=25,a3.C4R=26,a3.C4G=27,a3.C4B=28,a3.C4A=29,a3.U4=30,a3.V4=31;const l3=class{constructor(t){this.id=l3.nextID(),this.start=0,this.digits=0,this.setupIndex=0,this.regions=new Array(t)}copy(){const t=new l3(this.regions.length);return JQ.arrayCopy(this.regions,0,t.regions,0,this.regions.length),t.start=this.start,t.digits=this.digits,t.setupIndex=this.setupIndex,t}apply(t,e){let n=t.sequenceIndex;-1==n&&(n=this.setupIndex),n>=this.regions.length&&(n=this.regions.length-1);const r=this.regions[n];e.region!=r&&(e.region=r)}getPath(t,e){let n=t;const r=(this.start+e).toString();for(let i=this.digits-r.length;i>0;i--)n+="0";return n+=r,n}static nextID(){return l3._nextID++}};let c3=l3;c3._nextID=0;var h3=(t=>(t[t.hold=0]="hold",t[t.once=1]="once",t[t.loop=2]="loop",t[t.pingpong=3]="pingpong",t[t.onceReverse=4]="onceReverse",t[t.loopReverse=5]="loopReverse",t[t.pingpongReverse=6]="pingpongReverse",t))(h3||{});const u3=[0,1,2,3,4,5,6];class d3{constructor(t,e,n){if(this.timelines=[],this.timelineIds=new GQ,!t)throw new Error("name cannot be null.");this.name=t,this.setTimelines(e),this.duration=n}setTimelines(t){if(!t)throw new Error("timelines cannot be null.");this.timelines=t,this.timelineIds.clear();for(let e=0;e<t.length;e++)this.timelineIds.addAll(t[e].getPropertyIds())}hasTimeline(t){for(let e=0;e<t.length;e++)if(this.timelineIds.contains(t[e]))return!0;return!1}apply(t,e,n,r,i,s,o,a){if(!t)throw new Error("skeleton cannot be null.");r&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));const l=this.timelines;for(let c=0,h=l.length;c<h;c++)l[c].apply(t,e,n,i,s,o,a)}}const f3=0,p3=1,m3=2,g3=3,v3=4,y3=5,b3=6,x3=7,w3=8,E3=9,_3=10,S3=11,T3=12,k3=13,A3=14,C3=15,R3=16,M3=17,I3=18,D3=19;class O3{constructor(t,e){this.propertyIds=e,this.frames=JQ.newFloatArray(t*this.getFrameEntries())}getPropertyIds(){return this.propertyIds}getFrameEntries(){return 1}getFrameCount(){return this.frames.length/this.getFrameEntries()}getDuration(){return this.frames[this.frames.length-this.getFrameEntries()]}static search1(t,e){const n=t.length;for(let r=1;r<n;r++)if(t[r]>e)return r-1;return n-1}static search(t,e,n){const r=t.length;for(let i=n;i<r;i+=n)if(t[i]>e)return i-n;return r-n}}class P3 extends O3{constructor(t,e,n){super(t,n),this.curves=JQ.newFloatArray(t+18*e),this.curves[t-1]=1}setLinear(t){this.curves[t]=0}setStepped(t){this.curves[t]=1}shrink(t){const e=this.getFrameCount()+18*t;if(this.curves.length>e){const t=JQ.newFloatArray(e);JQ.arrayCopy(this.curves,0,t,0,e),this.curves=t}}setBezier(t,e,n,r,i,s,o,a,l,c,h){const u=this.curves;let d=this.getFrameCount()+18*t;0==n&&(u[e]=2+d);const f=.03*(r-2*s+a),p=.03*(i-2*o+l),m=.006*(3*(s-a)-r+c),g=.006*(3*(o-l)-i+h);let v=2*f+m,y=2*p+g,b=.3*(s-r)+f+.16666667*m,x=.3*(o-i)+p+.16666667*g,w=r+b,E=i+x;for(let _=d+18;d<_;d+=2)u[d]=w,u[d+1]=E,b+=v,x+=y,v+=m,y+=g,w+=b,E+=x}getBezierValue(t,e,n,r){const i=this.curves;if(i[r]>t){const s=this.frames[e],o=this.frames[e+n];return o+(t-s)/(i[r]-s)*(i[r+1]-o)}const s=r+18;for(r+=2;r<s;r+=2)if(i[r]>=t){const e=i[r-2],n=i[r-1];return n+(t-e)/(i[r]-e)*(i[r+1]-n)}e+=this.getFrameEntries();const o=i[s-2],a=i[s-1];return a+(t-o)/(this.frames[e]-o)*(this.frames[e+n]-a)}}class L3 extends P3{constructor(t,e,n){super(t,e,[n])}getFrameEntries(){return 2}setFrame(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+1]=n}getCurveValue(t){const e=this.frames;let n=e.length-2;for(let i=2;i<=n;i+=2)if(e[i]>t){n=i-2;break}const r=this.curves[n>>1];switch(r){case 0:const r=e[n],i=e[n+1];return i+(t-r)/(e[n+2]-r)*(e[n+2+1]-i);case 1:return e[n+1]}return this.getBezierValue(t,n,1,r-2)}}class F3 extends P3{constructor(t,e,n,r){super(t,e,[n,r])}getFrameEntries(){return 3}setFrame(t,e,n,r){t*=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r}}class N3 extends L3{constructor(t,e,n){super(t,e,`${f3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.rotation=a.data.rotation);case CQ.first:a.rotation+=(a.data.rotation-a.rotation)*i}return}let l=this.getCurveValue(n);switch(s){case CQ.setup:a.rotation=a.data.rotation+l*i;break;case CQ.first:case CQ.replace:l+=a.data.rotation-a.rotation;case CQ.add:a.rotation+=l*i}}}class B3 extends F3{constructor(t,e,n){super(t,e,`${p3}|${n}`,`${m3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.x=a.data.x,void(a.y=a.data.y);case CQ.first:a.x+=(a.data.x-a.x)*i,a.y+=(a.data.y-a.y)*i}return}let c=0,h=0;const u=O3.search(l,n,3),d=this.curves[u/3];switch(d){case 0:const t=l[u];c=l[u+1],h=l[u+2];const e=(n-t)/(l[u+3]-t);c+=(l[u+3+1]-c)*e,h+=(l[u+3+2]-h)*e;break;case 1:c=l[u+1],h=l[u+2];break;default:c=this.getBezierValue(n,u,1,d-2),h=this.getBezierValue(n,u,2,d+18-2)}switch(s){case CQ.setup:a.x=a.data.x+c*i,a.y=a.data.y+h*i;break;case CQ.first:case CQ.replace:a.x+=(a.data.x+c-a.x)*i,a.y+=(a.data.y+h-a.y)*i;break;case CQ.add:a.x+=c*i,a.y+=h*i}}}class U3 extends L3{constructor(t,e,n){super(t,e,`${p3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.x=a.data.x);case CQ.first:a.x+=(a.data.x-a.x)*i}return}const l=this.getCurveValue(n);switch(s){case CQ.setup:a.x=a.data.x+l*i;break;case CQ.first:case CQ.replace:a.x+=(a.data.x+l-a.x)*i;break;case CQ.add:a.x+=l*i}}}class V3 extends L3{constructor(t,e,n){super(t,e,`${m3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.y=a.data.y);case CQ.first:a.y+=(a.data.y-a.y)*i}return}const l=this.getCurveValue(n);switch(s){case CQ.setup:a.y=a.data.y+l*i;break;case CQ.first:case CQ.replace:a.y+=(a.data.y+l-a.y)*i;break;case CQ.add:a.y+=l*i}}}class j3 extends F3{constructor(t,e,n){super(t,e,`${g3}|${n}`,`${v3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.scaleX=a.data.scaleX,void(a.scaleY=a.data.scaleY);case CQ.first:a.scaleX+=(a.data.scaleX-a.scaleX)*i,a.scaleY+=(a.data.scaleY-a.scaleY)*i}return}let c,h;const u=O3.search(l,n,3),d=this.curves[u/3];switch(d){case 0:const t=l[u];c=l[u+1],h=l[u+2];const e=(n-t)/(l[u+3]-t);c+=(l[u+3+1]-c)*e,h+=(l[u+3+2]-h)*e;break;case 1:c=l[u+1],h=l[u+2];break;default:c=this.getBezierValue(n,u,1,d-2),h=this.getBezierValue(n,u,2,d+18-2)}if(c*=a.data.scaleX,h*=a.data.scaleY,1==i)s==CQ.add?(a.scaleX+=c-a.data.scaleX,a.scaleY+=h-a.data.scaleY):(a.scaleX=c,a.scaleY=h);else{let t=0,e=0;if(o==RQ.mixOut)switch(s){case CQ.setup:t=a.data.scaleX,e=a.data.scaleY,a.scaleX=t+(Math.abs(c)*YQ.signum(t)-t)*i,a.scaleY=e+(Math.abs(h)*YQ.signum(e)-e)*i;break;case CQ.first:case CQ.replace:t=a.scaleX,e=a.scaleY,a.scaleX=t+(Math.abs(c)*YQ.signum(t)-t)*i,a.scaleY=e+(Math.abs(h)*YQ.signum(e)-e)*i;break;case CQ.add:a.scaleX+=(c-a.data.scaleX)*i,a.scaleY+=(h-a.data.scaleY)*i}else switch(s){case CQ.setup:t=Math.abs(a.data.scaleX)*YQ.signum(c),e=Math.abs(a.data.scaleY)*YQ.signum(h),a.scaleX=t+(c-t)*i,a.scaleY=e+(h-e)*i;break;case CQ.first:case CQ.replace:t=Math.abs(a.scaleX)*YQ.signum(c),e=Math.abs(a.scaleY)*YQ.signum(h),a.scaleX=t+(c-t)*i,a.scaleY=e+(h-e)*i;break;case CQ.add:a.scaleX+=(c-a.data.scaleX)*i,a.scaleY+=(h-a.data.scaleY)*i}}}}class z3 extends L3{constructor(t,e,n){super(t,e,`${g3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.scaleX=a.data.scaleX);case CQ.first:a.scaleX+=(a.data.scaleX-a.scaleX)*i}return}const l=this.getCurveValue(n)*a.data.scaleX;if(1==i)s==CQ.add?a.scaleX+=l-a.data.scaleX:a.scaleX=l;else{let t=0;if(o==RQ.mixOut)switch(s){case CQ.setup:t=a.data.scaleX,a.scaleX=t+(Math.abs(l)*YQ.signum(t)-t)*i;break;case CQ.first:case CQ.replace:t=a.scaleX,a.scaleX=t+(Math.abs(l)*YQ.signum(t)-t)*i;break;case CQ.add:a.scaleX+=(l-a.data.scaleX)*i}else switch(s){case CQ.setup:t=Math.abs(a.data.scaleX)*YQ.signum(l),a.scaleX=t+(l-t)*i;break;case CQ.first:case CQ.replace:t=Math.abs(a.scaleX)*YQ.signum(l),a.scaleX=t+(l-t)*i;break;case CQ.add:a.scaleX+=(l-a.data.scaleX)*i}}}}class G3 extends L3{constructor(t,e,n){super(t,e,`${v3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.scaleY=a.data.scaleY);case CQ.first:a.scaleY+=(a.data.scaleY-a.scaleY)*i}return}const l=this.getCurveValue(n)*a.data.scaleY;if(1==i)s==CQ.add?a.scaleY+=l-a.data.scaleY:a.scaleY=l;else{let t=0;if(o==RQ.mixOut)switch(s){case CQ.setup:t=a.data.scaleY,a.scaleY=t+(Math.abs(l)*YQ.signum(t)-t)*i;break;case CQ.first:case CQ.replace:t=a.scaleY,a.scaleY=t+(Math.abs(l)*YQ.signum(t)-t)*i;break;case CQ.add:a.scaleY+=(l-a.data.scaleY)*i}else switch(s){case CQ.setup:t=Math.abs(a.data.scaleY)*YQ.signum(l),a.scaleY=t+(l-t)*i;break;case CQ.first:case CQ.replace:t=Math.abs(a.scaleY)*YQ.signum(l),a.scaleY=t+(l-t)*i;break;case CQ.add:a.scaleY+=(l-a.data.scaleY)*i}}}}class W3 extends F3{constructor(t,e,n){super(t,e,`${y3}|${n}`,`${b3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.shearX=a.data.shearX,void(a.shearY=a.data.shearY);case CQ.first:a.shearX+=(a.data.shearX-a.shearX)*i,a.shearY+=(a.data.shearY-a.shearY)*i}return}let c=0,h=0;const u=O3.search(l,n,3),d=this.curves[u/3];switch(d){case 0:const t=l[u];c=l[u+1],h=l[u+2];const e=(n-t)/(l[u+3]-t);c+=(l[u+3+1]-c)*e,h+=(l[u+3+2]-h)*e;break;case 1:c=l[u+1],h=l[u+2];break;default:c=this.getBezierValue(n,u,1,d-2),h=this.getBezierValue(n,u,2,d+18-2)}switch(s){case CQ.setup:a.shearX=a.data.shearX+c*i,a.shearY=a.data.shearY+h*i;break;case CQ.first:case CQ.replace:a.shearX+=(a.data.shearX+c-a.shearX)*i,a.shearY+=(a.data.shearY+h-a.shearY)*i;break;case CQ.add:a.shearX+=c*i,a.shearY+=h*i}}}class H3 extends L3{constructor(t,e,n){super(t,e,`${y3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.shearX=a.data.shearX);case CQ.first:a.shearX+=(a.data.shearX-a.shearX)*i}return}const l=this.getCurveValue(n);switch(s){case CQ.setup:a.shearX=a.data.shearX+l*i;break;case CQ.first:case CQ.replace:a.shearX+=(a.data.shearX+l-a.shearX)*i;break;case CQ.add:a.shearX+=l*i}}}class $3 extends L3{constructor(t,e,n){super(t,e,`${b3}|${n}`),this.boneIndex=0,this.boneIndex=n}apply(t,e,n,r,i,s,o){const a=t.bones[this.boneIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.shearY=a.data.shearY);case CQ.first:a.shearY+=(a.data.shearY-a.shearY)*i}return}const l=this.getCurveValue(n);switch(s){case CQ.setup:a.shearY=a.data.shearY+l*i;break;case CQ.first:case CQ.replace:a.shearY+=(a.data.shearY+l-a.shearY)*i;break;case CQ.add:a.shearY+=l*i}}}class Y3 extends P3{constructor(t,e,n){super(t,e,[`${x3}|${n}`,`${w3}|${n}`]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 5}setFrame(t,e,n,r,i,s){t*=5,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames,c=a.color;if(n<l[0]){const t=a.data.color;switch(s){case CQ.setup:return void c.setFromColor(t);case CQ.first:c.add((t.r-c.r)*i,(t.g-c.g)*i,(t.b-c.b)*i,(t.a-c.a)*i)}return}let h=0,u=0,d=0,f=0;const p=O3.search(l,n,5),m=this.curves[p/5];switch(m){case 0:const t=l[p];h=l[p+1],u=l[p+2],d=l[p+3],f=l[p+4];const e=(n-t)/(l[p+5]-t);h+=(l[p+5+1]-h)*e,u+=(l[p+5+2]-u)*e,d+=(l[p+5+3]-d)*e,f+=(l[p+5+4]-f)*e;break;case 1:h=l[p+1],u=l[p+2],d=l[p+3],f=l[p+4];break;default:h=this.getBezierValue(n,p,1,m-2),u=this.getBezierValue(n,p,2,m+18-2),d=this.getBezierValue(n,p,3,m+36-2),f=this.getBezierValue(n,p,4,m+54-2)}1==i?c.set(h,u,d,f):(s==CQ.setup&&c.setFromColor(a.data.color),c.add((h-c.r)*i,(u-c.g)*i,(d-c.b)*i,(f-c.a)*i))}}class X3 extends P3{constructor(t,e,n){super(t,e,[`${x3}|${n}`]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 4}setFrame(t,e,n,r,i){t<<=2,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames,c=a.color;if(n<l[0]){const t=a.data.color;switch(s){case CQ.setup:return c.r=t.r,c.g=t.g,void(c.b=t.b);case CQ.first:c.r+=(t.r-c.r)*i,c.g+=(t.g-c.g)*i,c.b+=(t.b-c.b)*i}return}let h=0,u=0,d=0;const f=O3.search(l,n,4),p=this.curves[f>>2];switch(p){case 0:const t=l[f];h=l[f+1],u=l[f+2],d=l[f+3];const e=(n-t)/(l[f+4]-t);h+=(l[f+4+1]-h)*e,u+=(l[f+4+2]-u)*e,d+=(l[f+4+3]-d)*e;break;case 1:h=l[f+1],u=l[f+2],d=l[f+3];break;default:h=this.getBezierValue(n,f,1,p-2),u=this.getBezierValue(n,f,2,p+18-2),d=this.getBezierValue(n,f,3,p+36-2)}if(1==i)c.r=h,c.g=u,c.b=d;else{if(s==CQ.setup){const t=a.data.color;c.r=t.r,c.g=t.g,c.b=t.b}c.r+=(h-c.r)*i,c.g+=(u-c.g)*i,c.b+=(d-c.b)*i}}}class q3 extends L3{constructor(t,e,n){super(t,e,`${w3}|${n}`),this.slotIndex=0,this.slotIndex=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=a.color;if(n<this.frames[0]){const t=a.data.color;switch(s){case CQ.setup:return void(l.a=t.a);case CQ.first:l.a+=(t.a-l.a)*i}return}const c=this.getCurveValue(n);1==i?l.a=c:(s==CQ.setup&&(l.a=a.data.color.a),l.a+=(c-l.a)*i)}}class K3 extends P3{constructor(t,e,n){super(t,e,[`${x3}|${n}`,`${w3}|${n}`,`${E3}|${n}`]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 8}setFrame(t,e,n,r,i,s,o,a,l){t<<=3,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=o,this.frames[t+6]=a,this.frames[t+7]=l}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames,c=a.color,h=a.darkColor;if(n<l[0]){const t=a.data.color,e=a.data.darkColor;switch(s){case CQ.setup:return c.setFromColor(t),h.r=e.r,h.g=e.g,void(h.b=e.b);case CQ.first:c.add((t.r-c.r)*i,(t.g-c.g)*i,(t.b-c.b)*i,(t.a-c.a)*i),h.r+=(e.r-h.r)*i,h.g+=(e.g-h.g)*i,h.b+=(e.b-h.b)*i}return}let u=0,d=0,f=0,p=0,m=0,g=0,v=0;const y=O3.search(l,n,8),b=this.curves[y>>3];switch(b){case 0:const t=l[y];u=l[y+1],d=l[y+2],f=l[y+3],p=l[y+4],m=l[y+5],g=l[y+6],v=l[y+7];const e=(n-t)/(l[y+8]-t);u+=(l[y+8+1]-u)*e,d+=(l[y+8+2]-d)*e,f+=(l[y+8+3]-f)*e,p+=(l[y+8+4]-p)*e,m+=(l[y+8+5]-m)*e,g+=(l[y+8+6]-g)*e,v+=(l[y+8+7]-v)*e;break;case 1:u=l[y+1],d=l[y+2],f=l[y+3],p=l[y+4],m=l[y+5],g=l[y+6],v=l[y+7];break;default:u=this.getBezierValue(n,y,1,b-2),d=this.getBezierValue(n,y,2,b+18-2),f=this.getBezierValue(n,y,3,b+36-2),p=this.getBezierValue(n,y,4,b+54-2),m=this.getBezierValue(n,y,5,b+72-2),g=this.getBezierValue(n,y,6,b+90-2),v=this.getBezierValue(n,y,7,b+108-2)}if(1==i)c.set(u,d,f,p),h.r=m,h.g=g,h.b=v;else{if(s==CQ.setup){c.setFromColor(a.data.color);const t=a.data.darkColor;h.r=t.r,h.g=t.g,h.b=t.b}c.add((u-c.r)*i,(d-c.g)*i,(f-c.b)*i,(p-c.a)*i),h.r+=(m-h.r)*i,h.g+=(g-h.g)*i,h.b+=(v-h.b)*i}}}class Z3 extends P3{constructor(t,e,n){super(t,e,[`${x3}|${n}`,`${E3}|${n}`]),this.slotIndex=0,this.slotIndex=n}getFrameEntries(){return 7}setFrame(t,e,n,r,i,s,o,a){t*=7,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s,this.frames[t+5]=o,this.frames[t+6]=a}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=this.frames,c=a.color,h=a.darkColor;if(n<l[0]){const t=a.data.color,e=a.data.darkColor;switch(s){case CQ.setup:return c.r=t.r,c.g=t.g,c.b=t.b,h.r=e.r,h.g=e.g,void(h.b=e.b);case CQ.first:c.r+=(t.r-c.r)*i,c.g+=(t.g-c.g)*i,c.b+=(t.b-c.b)*i,h.r+=(e.r-h.r)*i,h.g+=(e.g-h.g)*i,h.b+=(e.b-h.b)*i}return}let u=0,d=0,f=0,p=0,m=0,g=0;const v=O3.search(l,n,7),y=this.curves[v/7];switch(y){case 0:const t=l[v];u=l[v+1],d=l[v+2],f=l[v+3],p=l[v+4],m=l[v+5],g=l[v+6];const e=(n-t)/(l[v+7]-t);u+=(l[v+7+1]-u)*e,d+=(l[v+7+2]-d)*e,f+=(l[v+7+3]-f)*e,p+=(l[v+7+4]-p)*e,m+=(l[v+7+5]-m)*e,g+=(l[v+7+6]-g)*e;break;case 1:u=l[v+1],d=l[v+2],f=l[v+3],p=l[v+4],m=l[v+5],g=l[v+6];break;default:u=this.getBezierValue(n,v,1,y-2),d=this.getBezierValue(n,v,2,y+18-2),f=this.getBezierValue(n,v,3,y+36-2),p=this.getBezierValue(n,v,4,y+54-2),m=this.getBezierValue(n,v,5,y+72-2),g=this.getBezierValue(n,v,6,y+90-2)}if(1==i)c.r=u,c.g=d,c.b=f,h.r=p,h.g=m,h.b=g;else{if(s==CQ.setup){const t=a.data.color,e=a.data.darkColor;c.r=t.r,c.g=t.g,c.b=t.b,h.r=e.r,h.g=e.g,h.b=e.b}c.r+=(u-c.r)*i,c.g+=(d-c.g)*i,c.b+=(f-c.b)*i,h.r+=(p-h.r)*i,h.g+=(m-h.g)*i,h.b+=(g-h.b)*i}}}class J3 extends O3{constructor(t,e){super(t,[`${_3}|${e}`]),this.slotIndex=0,this.slotIndex=e,this.attachmentNames=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];a.bone.active&&(o!=RQ.mixOut?n<this.frames[0]?s!=CQ.setup&&s!=CQ.first||this.setAttachment(t,a,a.data.attachmentName):this.setAttachment(t,a,this.attachmentNames[O3.search1(this.frames,n)]):s==CQ.setup&&this.setAttachment(t,a,a.data.attachmentName))}setAttachment(t,e,n){e.setAttachment(n?t.getAttachment(this.slotIndex,n):null)}}class Q3 extends P3{constructor(t,e,n,r){super(t,e,[`${S3}|${n}|${r.id}`]),this.slotIndex=0,this.slotIndex=n,this.attachment=r,this.vertices=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.vertices[t]=n}setBezier(t,e,n,r,i,s,o,a,l,c,h){const u=this.curves;let d=this.getFrameCount()+18*t;0==n&&(u[e]=2+d);const f=.03*(r-2*s+a),p=.03*l-.06*o,m=.006*(3*(s-a)-r+c),g=.018*(o-l+.33333333);let v=2*f+m,y=2*p+g,b=.3*(s-r)+f+.16666667*m,x=.3*o+p+.16666667*g,w=r+b,E=x;for(let _=d+18;d<_;d+=2)u[d]=w,u[d+1]=E,b+=v,x+=y,v+=m,y+=g,w+=b,E+=x}getCurvePercent(t,e){const n=this.curves;let r=n[e];switch(r){case 0:const n=this.frames[e];return(t-n)/(this.frames[e+this.getFrameEntries()]-n);case 1:return 0}if(r-=2,n[r]>t){const i=this.frames[e];return n[r+1]*(t-i)/(n[r]-i)}const i=r+18;for(r+=2;r<i;r+=2)if(n[r]>=t){const e=n[r-2],i=n[r-1];return i+(t-e)/(n[r]-e)*(n[r+1]-i)}const s=n[i-2],o=n[i-1];return o+(1-o)*(t-s)/(this.frames[e+this.getFrameEntries()]-s)}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=a.getAttachment();if(!l)return;if(!(l instanceof t3)||l.timelineAttachment!=this.attachment)return;const c=a.deform;0==c.length&&(s=CQ.setup);const h=this.vertices,u=h[0].length,d=this.frames;if(n<d[0]){switch(s){case CQ.setup:return void(c.length=0);case CQ.first:if(1==i)return void(c.length=0);c.length=u;const t=l;if(t.bones){i=1-i;for(let t=0;t<u;t++)c[t]*=i}else{const e=t.vertices;for(let t=0;t<u;t++)c[t]+=(e[t]-c[t])*i}}return}if(c.length=u,n>=d[d.length-1]){const t=h[d.length-1];if(1==i)if(s==CQ.add){const e=l;if(e.bones)for(let n=0;n<u;n++)c[n]+=t[n];else{const n=e.vertices;for(let e=0;e<u;e++)c[e]+=t[e]-n[e]}}else JQ.arrayCopy(t,0,c,0,u);else switch(s){case CQ.setup:{const e=l;if(e.bones)for(let n=0;n<u;n++)c[n]=t[n]*i;else{const n=e.vertices;for(let e=0;e<u;e++){const r=n[e];c[e]=r+(t[e]-r)*i}}break}case CQ.first:case CQ.replace:for(let n=0;n<u;n++)c[n]+=(t[n]-c[n])*i;break;case CQ.add:const e=l;if(e.bones)for(let n=0;n<u;n++)c[n]+=t[n]*i;else{const n=e.vertices;for(let e=0;e<u;e++)c[e]+=(t[e]-n[e])*i}}return}const f=O3.search1(d,n),p=this.getCurvePercent(n,f),m=h[f],g=h[f+1];if(1==i)if(s==CQ.add){const t=l;if(t.bones)for(let e=0;e<u;e++){const t=m[e];c[e]+=t+(g[e]-t)*p}else{const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];c[t]+=n+(g[t]-n)*p-e[t]}}}else for(let v=0;v<u;v++){const t=m[v];c[v]=t+(g[v]-t)*p}else switch(s){case CQ.setup:{const t=l;if(t.bones)for(let e=0;e<u;e++){const t=m[e];c[e]=(t+(g[e]-t)*p)*i}else{const e=t.vertices;for(let t=0;t<u;t++){const n=m[t],r=e[t];c[t]=r+(n+(g[t]-n)*p-r)*i}}break}case CQ.first:case CQ.replace:for(let e=0;e<u;e++){const t=m[e];c[e]+=(t+(g[e]-t)*p-c[e])*i}break;case CQ.add:const t=l;if(t.bones)for(let e=0;e<u;e++){const t=m[e];c[e]+=(t+(g[e]-t)*p)*i}else{const e=t.vertices;for(let t=0;t<u;t++){const n=m[t];c[t]+=(n+(g[t]-n)*p-e[t])*i}}}}}const t5=class extends O3{constructor(t){super(t,t5.propertyIds),this.events=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e){this.frames[t]=e.time,this.events[t]=e}apply(t,e,n,r,i,s,o){if(!r)return;const a=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,r,i,s,o),e=-1;else if(e>=a[l-1])return;if(n<a[0])return;let c=0;if(e<a[0])c=0;else{c=O3.search1(a,e)+1;const t=a[c];for(;c>0&&a[c-1]==t;)c--}for(;c<l&&n>=a[c];c++)r.push(this.events[c])}};let e5=t5;e5.propertyIds=[`${T3}`];const n5=class extends O3{constructor(t){super(t,n5.propertyIds),this.drawOrders=new Array(t)}getFrameCount(){return this.frames.length}setFrame(t,e,n){this.frames[t]=e,this.drawOrders[t]=n}apply(t,e,n,r,i,s,o){if(o==RQ.mixOut)return void(s==CQ.setup&&JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));if(n<this.frames[0])return void(s!=CQ.setup&&s!=CQ.first||JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length));const a=O3.search1(this.frames,n),l=this.drawOrders[a];if(l){const e=t.drawOrder,n=t.slots;for(let t=0,r=l.length;t<r;t++)e[t]=n[l[t]]}else JQ.arrayCopy(t.slots,0,t.drawOrder,0,t.slots.length)}};let r5=n5;r5.propertyIds=[`${k3}`];class i5 extends P3{constructor(t,e,n){super(t,e,[`${A3}|${n}`]),this.ikConstraintIndex=0,this.ikConstraintIndex=n}getFrameEntries(){return 6}setFrame(t,e,n,r,i,s,o){t*=6,this.frames[t]=e,this.frames[t+1]=n,this.frames[t+2]=r,this.frames[t+3]=i,this.frames[t+4]=s?1:0,this.frames[t+5]=o?1:0}apply(t,e,n,r,i,s,o){const a=t.ikConstraints[this.ikConstraintIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.mix=a.data.mix,a.softness=a.data.softness,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,void(a.stretch=a.data.stretch);case CQ.first:a.mix+=(a.data.mix-a.mix)*i,a.softness+=(a.data.softness-a.softness)*i,a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch}return}let c=0,h=0;const u=O3.search(l,n,6),d=this.curves[u/6];switch(d){case 0:const t=l[u];c=l[u+1],h=l[u+2];const e=(n-t)/(l[u+6]-t);c+=(l[u+6+1]-c)*e,h+=(l[u+6+2]-h)*e;break;case 1:c=l[u+1],h=l[u+2];break;default:c=this.getBezierValue(n,u,1,d-2),h=this.getBezierValue(n,u,2,d+18-2)}s==CQ.setup?(a.mix=a.data.mix+(c-a.data.mix)*i,a.softness=a.data.softness+(h-a.data.softness)*i,o==RQ.mixOut?(a.bendDirection=a.data.bendDirection,a.compress=a.data.compress,a.stretch=a.data.stretch):(a.bendDirection=l[u+3],a.compress=0!=l[u+4],a.stretch=0!=l[u+5])):(a.mix+=(c-a.mix)*i,a.softness+=(h-a.softness)*i,o==RQ.mixIn&&(a.bendDirection=l[u+3],a.compress=0!=l[u+4],a.stretch=0!=l[u+5]))}}class s5 extends P3{constructor(t,e,n){super(t,e,[`${C3}|${n}`]),this.transformConstraintIndex=0,this.transformConstraintIndex=n}getFrameEntries(){return 7}setFrame(t,e,n,r,i,s,o,a){const l=this.frames;l[t*=7]=e,l[t+1]=n,l[t+2]=r,l[t+3]=i,l[t+4]=s,l[t+5]=o,l[t+6]=a}apply(t,e,n,r,i,s,o){const a=t.transformConstraints[this.transformConstraintIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){const t=a.data;switch(s){case CQ.setup:return a.mixRotate=t.mixRotate,a.mixX=t.mixX,a.mixY=t.mixY,a.mixScaleX=t.mixScaleX,a.mixScaleY=t.mixScaleY,void(a.mixShearY=t.mixShearY);case CQ.first:a.mixRotate+=(t.mixRotate-a.mixRotate)*i,a.mixX+=(t.mixX-a.mixX)*i,a.mixY+=(t.mixY-a.mixY)*i,a.mixScaleX+=(t.mixScaleX-a.mixScaleX)*i,a.mixScaleY+=(t.mixScaleY-a.mixScaleY)*i,a.mixShearY+=(t.mixShearY-a.mixShearY)*i}return}let c,h,u,d,f,p;const m=O3.search(l,n,7),g=this.curves[m/7];switch(g){case 0:const t=l[m];c=l[m+1],h=l[m+2],u=l[m+3],d=l[m+4],f=l[m+5],p=l[m+6];const e=(n-t)/(l[m+7]-t);c+=(l[m+7+1]-c)*e,h+=(l[m+7+2]-h)*e,u+=(l[m+7+3]-u)*e,d+=(l[m+7+4]-d)*e,f+=(l[m+7+5]-f)*e,p+=(l[m+7+6]-p)*e;break;case 1:c=l[m+1],h=l[m+2],u=l[m+3],d=l[m+4],f=l[m+5],p=l[m+6];break;default:c=this.getBezierValue(n,m,1,g-2),h=this.getBezierValue(n,m,2,g+18-2),u=this.getBezierValue(n,m,3,g+36-2),d=this.getBezierValue(n,m,4,g+54-2),f=this.getBezierValue(n,m,5,g+72-2),p=this.getBezierValue(n,m,6,g+90-2)}if(s==CQ.setup){const t=a.data;a.mixRotate=t.mixRotate+(c-t.mixRotate)*i,a.mixX=t.mixX+(h-t.mixX)*i,a.mixY=t.mixY+(u-t.mixY)*i,a.mixScaleX=t.mixScaleX+(d-t.mixScaleX)*i,a.mixScaleY=t.mixScaleY+(f-t.mixScaleY)*i,a.mixShearY=t.mixShearY+(p-t.mixShearY)*i}else a.mixRotate+=(c-a.mixRotate)*i,a.mixX+=(h-a.mixX)*i,a.mixY+=(u-a.mixY)*i,a.mixScaleX+=(d-a.mixScaleX)*i,a.mixScaleY+=(f-a.mixScaleY)*i,a.mixShearY+=(p-a.mixShearY)*i}}class o5 extends L3{constructor(t,e,n){super(t,e,`${R3}|${n}`),this.pathConstraintIndex=0,this.pathConstraintIndex=n}apply(t,e,n,r,i,s,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.position=a.data.position);case CQ.first:a.position+=(a.data.position-a.position)*i}return}const l=this.getCurveValue(n);s==CQ.setup?a.position=a.data.position+(l-a.data.position)*i:a.position+=(l-a.position)*i}}class a5 extends L3{constructor(t,e,n){super(t,e,`${M3}|${n}`),this.pathConstraintIndex=0,this.pathConstraintIndex=n}apply(t,e,n,r,i,s,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;if(n<this.frames[0]){switch(s){case CQ.setup:return void(a.spacing=a.data.spacing);case CQ.first:a.spacing+=(a.data.spacing-a.spacing)*i}return}const l=this.getCurveValue(n);s==CQ.setup?a.spacing=a.data.spacing+(l-a.data.spacing)*i:a.spacing+=(l-a.spacing)*i}}class l5 extends P3{constructor(t,e,n){super(t,e,[`${I3}|${n}`]),this.pathConstraintIndex=0,this.pathConstraintIndex=n}getFrameEntries(){return 4}setFrame(t,e,n,r,i){const s=this.frames;s[t<<=2]=e,s[t+1]=n,s[t+2]=r,s[t+3]=i}apply(t,e,n,r,i,s,o){const a=t.pathConstraints[this.pathConstraintIndex];if(!a.active)return;const l=this.frames;if(n<l[0]){switch(s){case CQ.setup:return a.mixRotate=a.data.mixRotate,a.mixX=a.data.mixX,void(a.mixY=a.data.mixY);case CQ.first:a.mixRotate+=(a.data.mixRotate-a.mixRotate)*i,a.mixX+=(a.data.mixX-a.mixX)*i,a.mixY+=(a.data.mixY-a.mixY)*i}return}let c,h,u;const d=O3.search(l,n,4),f=this.curves[d>>2];switch(f){case 0:const t=l[d];c=l[d+1],h=l[d+2],u=l[d+3];const e=(n-t)/(l[d+4]-t);c+=(l[d+4+1]-c)*e,h+=(l[d+4+2]-h)*e,u+=(l[d+4+3]-u)*e;break;case 1:c=l[d+1],h=l[d+2],u=l[d+3];break;default:c=this.getBezierValue(n,d,1,f-2),h=this.getBezierValue(n,d,2,f+18-2),u=this.getBezierValue(n,d,3,f+36-2)}if(s==CQ.setup){const t=a.data;a.mixRotate=t.mixRotate+(c-t.mixRotate)*i,a.mixX=t.mixX+(h-t.mixX)*i,a.mixY=t.mixY+(u-t.mixY)*i}else a.mixRotate+=(c-a.mixRotate)*i,a.mixX+=(h-a.mixX)*i,a.mixY+=(u-a.mixY)*i}}const c5=class extends O3{constructor(t,e,n){super(t,[`${D3}|${e}|${n.sequence.id}`]),this.slotIndex=e,this.attachment=n}getFrameEntries(){return c5.ENTRIES}getSlotIndex(){return this.slotIndex}getAttachment(){return this.attachment}setFrame(t,e,n,r,i){const s=this.frames;s[t*=c5.ENTRIES]=e,s[t+c5.MODE]=n|r<<4,s[t+c5.DELAY]=i}apply(t,e,n,r,i,s,o){const a=t.slots[this.slotIndex];if(!a.bone.active)return;const l=a.attachment,c=this.attachment;if(!(l==c||l instanceof t3&&l.timelineAttachment==c))return;const h=this.frames;if(n<h[0])return void(s!=CQ.setup&&s!=CQ.first||(a.sequenceIndex=-1));const u=O3.search(h,n,c5.ENTRIES),d=h[u],f=h[u+c5.MODE],p=h[u+c5.DELAY];if(!this.attachment.sequence)return;let m=f>>4;const g=this.attachment.sequence.regions.length,v=u3[15&f];if(v!=h3.hold)switch(m+=(n-d)/p+1e-5|0,v){case h3.once:m=Math.min(g-1,m);break;case h3.loop:m%=g;break;case h3.pingpong:{const t=(g<<1)-2;m=0==t?0:m%t,m>=g&&(m=t-m);break}case h3.onceReverse:m=Math.max(g-1-m,0);break;case h3.loopReverse:m=g-1-m%g;break;case h3.pingpongReverse:{const t=(g<<1)-2;m=0==t?0:(m+g-1)%t,m>=g&&(m=t-m)}}a.sequenceIndex=m}};let h5=c5;h5.ENTRIES=3,h5.MODE=1,h5.DELAY=2;const u5=class{constructor(t){this.tracks=new Array,this.timeScale=1,this.unkeyedState=0,this.events=new Array,this.listeners=new Array,this.queue=new m5(this),this.propertyIDs=new GQ,this.animationsChanged=!1,this.trackEntryPool=new QQ((()=>new p5)),this.data=t}static emptyAnimation(){return u5._emptyAnimation}update(t){t*=this.timeScale;const e=this.tracks;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(!r)continue;r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;let i=t*r.timeScale;if(r.delay>0){if(r.delay-=i,r.delay>0)continue;i=-r.delay,r.delay=0}let s=r.next;if(s){const e=r.trackLast-s.delay;if(e>=0){for(s.delay=0,s.trackTime+=0==r.timeScale?0:(e/r.timeScale+t)*s.timeScale,r.trackTime+=i,this.setCurrent(n,s,!0);s.mixingFrom;)s.mixTime+=t,s=s.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&!r.mixingFrom){e[n]=null,this.queue.end(r),this.clearNext(r);continue}if(r.mixingFrom&&this.updateMixingFrom(r,t)){let t=r.mixingFrom;for(r.mixingFrom=null,t&&(t.mixingTo=null);t;)this.queue.end(t),t=t.mixingFrom}r.trackTime+=i}this.queue.drain()}updateMixingFrom(t,e){const n=t.mixingFrom;if(!n)return!0;const r=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),r):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)}apply(t){if(!t)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();const e=this.events,n=this.tracks;let r=!1;for(let o=0,a=n.length;o<a;o++){const i=n[o];if(!i||i.delay>0)continue;r=!0;const s=0==o?CQ.first:i.mixBlend;let a=i.alpha;i.mixingFrom?a*=this.applyMixingFrom(i,t,s):i.trackTime>=i.trackEnd&&!i.next&&(a=0);const l=i.animationLast,c=i.getAnimationTime();let h=c,u=e;i.reverse&&(h=i.animation.duration-h,u=null);const d=i.animation.timelines,f=d.length;if(0==o&&1==a||s==CQ.add)for(let e=0;e<f;e++){const n=d[e];n instanceof J3?this.applyAttachmentTimeline(n,t,h,s,!0):n.apply(t,l,h,u,a,s,RQ.mixIn)}else{const e=i.timelineMode,n=i.shortestRotation,r=!n&&i.timelinesRotation.length!=f<<1;r&&(i.timelinesRotation.length=f<<1);for(let o=0;o<f;o++){const c=d[o],f=e[o]==v5?s:CQ.setup;!n&&c instanceof N3?this.applyRotateTimeline(c,t,h,a,f,i.timelinesRotation,o<<1,r):c instanceof J3?this.applyAttachmentTimeline(c,t,h,s,!0):c.apply(t,l,h,u,a,f,RQ.mixIn)}}this.queueEvents(i,c),e.length=0,i.nextAnimationLast=c,i.nextTrackLast=i.trackTime}const i=this.unkeyedState+E5,s=t.slots;for(let o=0,a=t.slots.length;o<a;o++){const e=s[o];if(e.attachmentState==i){const n=e.data.attachmentName;e.setAttachment(n?t.getAttachment(e.data.index,n):null)}}return this.unkeyedState+=2,this.queue.drain(),r}applyMixingFrom(t,e,n){const r=t.mixingFrom;r.mixingFrom&&this.applyMixingFrom(r,e,n);let i=0;0==t.mixDuration?(i=1,n==CQ.first&&(n=CQ.setup)):(i=t.mixTime/t.mixDuration,i>1&&(i=1),n!=CQ.first&&(n=r.mixBlend));const s=i<r.attachmentThreshold,o=i<r.drawOrderThreshold,a=r.animation.timelines,l=a.length,c=r.alpha*t.interruptAlpha,h=c*(1-i),u=r.animationLast,d=r.getAnimationTime();let f=d,p=null;if(r.reverse?f=r.animation.duration-f:i<r.eventThreshold&&(p=this.events),n==CQ.add)for(let m=0;m<l;m++)a[m].apply(e,u,f,p,h,n,RQ.mixOut);else{const t=r.timelineMode,i=r.timelineHoldMix,d=r.shortestRotation,m=!d&&r.timelinesRotation.length!=l<<1;m&&(r.timelinesRotation.length=l<<1),r.totalAlpha=0;for(let g=0;g<l;g++){const l=a[g];let v,y=RQ.mixOut,b=0;switch(t[g]){case v5:if(!o&&l instanceof r5)continue;v=n,b=h;break;case y5:v=CQ.setup,b=h;break;case b5:v=n,b=c;break;case x5:v=CQ.setup,b=c;break;default:v=CQ.setup;const t=i[g];b=c*Math.max(0,1-t.mixTime/t.mixDuration)}r.totalAlpha+=b,!d&&l instanceof N3?this.applyRotateTimeline(l,e,f,b,v,r.timelinesRotation,g<<1,m):l instanceof J3?this.applyAttachmentTimeline(l,e,f,v,s):(o&&l instanceof r5&&v==CQ.setup&&(y=RQ.mixIn),l.apply(e,u,f,p,b,v,y))}}return t.mixDuration>0&&this.queueEvents(r,d),this.events.length=0,r.nextAnimationLast=d,r.nextTrackLast=r.trackTime,i}applyAttachmentTimeline(t,e,n,r,i){const s=e.slots[t.slotIndex];s.bone.active&&(n<t.frames[0]?r!=CQ.setup&&r!=CQ.first||this.setAttachment(e,s,s.data.attachmentName,i):this.setAttachment(e,s,t.attachmentNames[O3.search1(t.frames,n)],i),s.attachmentState<=this.unkeyedState&&(s.attachmentState=this.unkeyedState+E5))}setAttachment(t,e,n,r){e.setAttachment(n?t.getAttachment(e.data.index,n):null),r&&(e.attachmentState=this.unkeyedState+_5)}applyRotateTimeline(t,e,n,r,i,s,o,a){if(a&&(s[o]=0),1==r)return void t.apply(e,0,n,null,1,i,RQ.mixIn);const l=e.bones[t.boneIndex];if(!l.active)return;let c=0,h=0;if(n<t.frames[0])switch(i){case CQ.setup:l.rotation=l.data.rotation;default:return;case CQ.first:c=l.rotation,h=l.data.rotation}else c=i==CQ.setup?l.data.rotation:l.rotation,h=l.data.rotation+t.getCurveValue(n);let u=0,d=h-c;if(d-=360*(16384-(16384.499999999996-d/360|0)),0==d)u=s[o];else{let t=0,e=0;a?(t=0,e=d):(t=s[o],e=s[o+1]);const n=d>0;let r=t>=0;YQ.signum(e)!=YQ.signum(d)&&Math.abs(e)<=90&&(Math.abs(t)>180&&(t+=360*YQ.signum(t)),r=n),u=d+t-t%360,r!=n&&(u+=360*YQ.signum(t)),s[o]=u}s[o+1]=d,l.rotation=c+u*r}queueEvents(t,e){const n=t.animationStart,r=t.animationEnd,i=r-n,s=t.trackLast%i,o=this.events;let a=0;const l=o.length;for(;a<l;a++){const e=o[a];if(e.time<s)break;e.time>r||this.queue.event(t,e)}let c=!1;for(c=t.loop?0==i||s>t.trackTime%i:e>=r&&t.animationLast<r,c&&this.queue.complete(t);a<l;a++){const e=o[a];e.time<n||this.queue.event(t,e)}}clearTracks(){const t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()}clearTrack(t){if(t>=this.tracks.length)return;const e=this.tracks[t];if(!e)return;this.queue.end(e),this.clearNext(e);let n=e;for(;;){const t=n.mixingFrom;if(!t)break;this.queue.end(t),n.mixingFrom=null,n.mixingTo=null,n=t}this.tracks[e.trackIndex]=null,this.queue.drain()}setCurrent(t,e,n){const r=this.expandToIndex(t);this.tracks[t]=e,e.previous=null,r&&(n&&this.queue.interrupt(r),e.mixingFrom=r,r.mixingTo=e,e.mixTime=0,r.mixingFrom&&r.mixDuration>0&&(e.interruptAlpha*=Math.min(1,r.mixTime/r.mixDuration)),r.timelinesRotation.length=0),this.queue.start(e)}setAnimation(t,e,n=!1){const r=this.data.skeletonData.findAnimation(e);if(!r)throw new Error(`Animation not found: ${e}`);return this.setAnimationWith(t,r,n)}setAnimationWith(t,e,n=!1){if(!e)throw new Error("animation cannot be null.");let r=!0,i=this.expandToIndex(t);i&&(-1==i.nextTrackLast?(this.tracks[t]=i.mixingFrom,this.queue.interrupt(i),this.queue.end(i),this.clearNext(i),i=i.mixingFrom,r=!1):this.clearNext(i));const s=this.trackEntry(t,e,n,i);return this.setCurrent(t,s,r),this.queue.drain(),s}addAnimation(t,e,n=!1,r=0){const i=this.data.skeletonData.findAnimation(e);if(!i)throw new Error(`Animation not found: ${e}`);return this.addAnimationWith(t,i,n,r)}addAnimationWith(t,e,n=!1,r=0){if(!e)throw new Error("animation cannot be null.");let i=this.expandToIndex(t);if(i)for(;i.next;)i=i.next;const s=this.trackEntry(t,e,n,i);return i?(i.next=s,s.previous=i,r<=0&&(r+=i.getTrackComplete()-s.mixDuration)):(this.setCurrent(t,s,!0),this.queue.drain()),s.delay=r,s}setEmptyAnimation(t,e=0){const n=this.setAnimationWith(t,u5.emptyAnimation(),!1);return n.mixDuration=e,n.trackEnd=e,n}addEmptyAnimation(t,e=0,n=0){const r=this.addAnimationWith(t,u5.emptyAnimation(),!1,n);return n<=0&&(r.delay+=r.mixDuration-e),r.mixDuration=e,r.trackEnd=e,r}setEmptyAnimations(t=0){const e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(let n=0,r=this.tracks.length;n<r;n++){const e=this.tracks[n];e&&this.setEmptyAnimation(e.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()}expandToIndex(t){return t<this.tracks.length?this.tracks[t]:(JQ.ensureArrayCapacity(this.tracks,t+1,null),this.tracks.length=t+1,null)}trackEntry(t,e,n,r){const i=this.trackEntryPool.obtain();return i.reset(),i.trackIndex=t,i.animation=e,i.loop=n,i.holdPrevious=!1,i.reverse=!1,i.shortestRotation=!1,i.eventThreshold=0,i.attachmentThreshold=0,i.drawOrderThreshold=0,i.animationStart=0,i.animationEnd=e.duration,i.animationLast=-1,i.nextAnimationLast=-1,i.delay=0,i.trackTime=0,i.trackLast=-1,i.nextTrackLast=-1,i.trackEnd=Number.MAX_VALUE,i.timeScale=1,i.alpha=1,i.mixTime=0,i.mixDuration=r?this.data.getMix(r.animation,e):0,i.interruptAlpha=1,i.totalAlpha=0,i.mixBlend=CQ.replace,i}clearNext(t){let e=t.next;for(;e;)this.queue.dispose(e),e=e.next;t.next=null}_animationsChanged(){this.animationsChanged=!1,this.propertyIDs.clear();const t=this.tracks;for(let e=0,n=t.length;e<n;e++){let n=t[e];if(n){for(;n.mixingFrom;)n=n.mixingFrom;do{n.mixingTo&&n.mixBlend==CQ.add||this.computeHold(n),n=n.mixingTo}while(n)}}}computeHold(t){const e=t.mixingTo,n=t.animation.timelines,r=t.animation.timelines.length,i=t.timelineMode;i.length=r;const s=t.timelineHoldMix;s.length=0;const o=this.propertyIDs;if(e&&e.holdPrevious)for(let a=0;a<r;a++)i[a]=o.addAll(n[a].getPropertyIds())?x5:b5;else t:for(let a=0;a<r;a++){const r=n[a],l=r.getPropertyIds();if(o.addAll(l))if(!e||r instanceof J3||r instanceof r5||r instanceof e5||!e.animation.hasTimeline(l))i[a]=y5;else{for(let n=e.mixingTo;n;n=n.mixingTo)if(!n.animation.hasTimeline(l)){if(t.mixDuration>0){i[a]=w5,s[a]=n;continue t}break}i[a]=x5}else i[a]=v5}}getCurrent(t){return t>=this.tracks.length?null:this.tracks[t]}addListener(t){if(!t)throw new Error("listener cannot be null.");this.listeners.push(t)}removeListener(t){const e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)}clearListeners(){this.listeners.length=0}clearListenerNotifications(){this.queue.clear()}setAnimationByName(t,e,n){u5.deprecatedWarning1||(u5.deprecatedWarning1=!0),this.setAnimation(t,e,n)}addAnimationByName(t,e,n,r){u5.deprecatedWarning2||(u5.deprecatedWarning2=!0),this.addAnimation(t,e,n,r)}hasAnimation(t){return null!==this.data.skeletonData.findAnimation(t)}hasAnimationByName(t){return u5.deprecatedWarning3||(u5.deprecatedWarning3=!0),this.hasAnimation(t)}};let d5=u5;d5._emptyAnimation=new d3("<empty>",[],0),d5.deprecatedWarning1=!1,d5.deprecatedWarning2=!1,d5.deprecatedWarning3=!1;const f5=class{constructor(){this.animation=null,this.previous=null,this.next=null,this.mixingFrom=null,this.mixingTo=null,this.listener=null,this.trackIndex=0,this.loop=!1,this.holdPrevious=!1,this.reverse=!1,this.shortestRotation=!1,this.eventThreshold=0,this.attachmentThreshold=0,this.drawOrderThreshold=0,this.animationStart=0,this.animationEnd=0,this.animationLast=0,this.nextAnimationLast=0,this.delay=0,this.trackTime=0,this.trackLast=0,this.nextTrackLast=0,this.trackEnd=0,this.timeScale=0,this.alpha=0,this.mixTime=0,this.mixDuration=0,this.interruptAlpha=0,this.totalAlpha=0,this.mixBlend=CQ.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}reset(){this.next=null,this.previous=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0}getAnimationTime(){if(this.loop){const t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)}setAnimationLast(t){this.animationLast=t,this.nextAnimationLast=t}isComplete(){return this.trackTime>=this.animationEnd-this.animationStart}resetRotationDirections(){this.timelinesRotation.length=0}getTrackComplete(){const t=this.animationEnd-this.animationStart;if(0!=t){if(this.loop)return t*(1+(this.trackTime/t|0));if(this.trackTime<t)return t}return this.trackTime}get time(){return f5.deprecatedWarning1||(f5.deprecatedWarning1=!0),this.trackTime}set time(t){f5.deprecatedWarning1||(f5.deprecatedWarning1=!0),this.trackTime=t}get endTime(){return f5.deprecatedWarning2||(f5.deprecatedWarning2=!0),this.trackTime}set endTime(t){f5.deprecatedWarning2||(f5.deprecatedWarning2=!0),this.trackTime=t}loopsCount(){return Math.floor(this.trackTime/this.trackEnd)}};let p5=f5;p5.deprecatedWarning1=!1,p5.deprecatedWarning2=!1;class m5{constructor(t){this.objects=[],this.drainDisabled=!1,this.animState=t}start(t){this.objects.push(g5.start),this.objects.push(t),this.animState.animationsChanged=!0}interrupt(t){this.objects.push(g5.interrupt),this.objects.push(t)}end(t){this.objects.push(g5.end),this.objects.push(t),this.animState.animationsChanged=!0}dispose(t){this.objects.push(g5.dispose),this.objects.push(t)}complete(t){this.objects.push(g5.complete),this.objects.push(t)}event(t,e){this.objects.push(g5.event),this.objects.push(t),this.objects.push(e)}drain(){if(this.drainDisabled)return;this.drainDisabled=!0;const t=this.objects,e=this.animState.listeners;for(let n=0;n<t.length;n+=2){const r=t[n],i=t[n+1];switch(r){case g5.start:i.listener&&i.listener.start&&i.listener.start(i);for(let t=0;t<e.length;t++){const n=e[t];n.start&&n.start(i)}break;case g5.interrupt:i.listener&&i.listener.interrupt&&i.listener.interrupt(i);for(let t=0;t<e.length;t++){const n=e[t];n.interrupt&&n.interrupt(i)}break;case g5.end:i.listener&&i.listener.end&&i.listener.end(i);for(let t=0;t<e.length;t++){const n=e[t];n.end&&n.end(i)}case g5.dispose:i.listener&&i.listener.dispose&&i.listener.dispose(i);for(let t=0;t<e.length;t++){const n=e[t];n.dispose&&n.dispose(i)}this.animState.trackEntryPool.free(i);break;case g5.complete:i.listener&&i.listener.complete&&i.listener.complete(i);for(let t=0;t<e.length;t++){const n=e[t];n.complete&&n.complete(i)}break;case g5.event:const r=t[2+n++];i.listener&&i.listener.event&&i.listener.event(i,r);for(let t=0;t<e.length;t++){const n=e[t];n.event&&n.event(i,r)}}}this.clear(),this.drainDisabled=!1}clear(){this.objects.length=0}}var g5=(t=>(t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event",t))(g5||{});const v5=0,y5=1,b5=2,x5=3,w5=4,E5=1,_5=2;class S5{constructor(t){if(this.animationToMixTime={},this.defaultMix=0,!t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}setMix(t,e,n){const r=this.skeletonData.findAnimation(t);if(!r)throw new Error(`Animation not found: ${t}`);const i=this.skeletonData.findAnimation(e);if(!i)throw new Error(`Animation not found: ${e}`);this.setMixWith(r,i,n)}setMixWith(t,e,n){if(!t)throw new Error("from cannot be null.");if(!e)throw new Error("to cannot be null.");const r=`${t.name}.${e.name}`;this.animationToMixTime[r]=n}getMix(t,e){const n=`${t.name}.${e.name}`,r=this.animationToMixTime[n];return void 0===r?this.defaultMix:r}}class T5{constructor(t){this.atlas=t}loadSequence(t,e,n){const r=n.regions;for(let i=0,s=r.length;i<s;i++){const s=n.getPath(e,i),o=this.atlas.findRegion(s);if(null==o)throw new Error(`Region not found in atlas: ${s} (sequence: ${t})`);r[i]=o,r[i].renderObject=r[i]}}newRegionAttachment(t,e,n,r){const i=new a3(e,n);if(null!=r)this.loadSequence(e,n,r);else{const t=this.atlas.findRegion(n);if(!t)throw new Error(`Region not found in atlas: ${n} (region attachment: ${e})`);t.renderObject=t,i.region=t}return i}newMeshAttachment(t,e,n,r){const i=new r3(e,n);if(null!=r)this.loadSequence(e,n,r);else{const t=this.atlas.findRegion(n);if(!t)throw new Error(`Region not found in atlas: ${n} (mesh attachment: ${e})`);t.renderObject=t,i.region=t}return i}newBoundingBoxAttachment(t,e){return new e3(e)}newPathAttachment(t,e){return new i3(e)}newPointAttachment(t,e){return new s3(e)}newClippingAttachment(t,e){return new n3(e)}}class k5{constructor(t,e,n){if(this.matrix=new bY,this.parent=null,this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.sorted=!1,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}get worldX(){return this.matrix.tx}get worldY(){return this.matrix.ty}isActive(){return this.active}update(){this.updateWorldTransformWith(this.ax,this.ay,this.arotation,this.ascaleX,this.ascaleY,this.ashearX,this.ashearY)}updateWorldTransform(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)}updateWorldTransformWith(t,e,n,r,i,s,o){this.ax=t,this.ay=e,this.arotation=n,this.ascaleX=r,this.ascaleY=i,this.ashearX=s,this.ashearY=o;const a=this.parent,l=this.matrix,c=this.skeleton.scaleX,h=-this.skeleton.scaleY;if(!a){const a=this.skeleton,u=n+90+o;return l.a=YQ.cosDeg(n+s)*r*c,l.c=YQ.cosDeg(u)*i*c,l.b=YQ.sinDeg(n+s)*r*h,l.d=YQ.sinDeg(u)*i*h,l.tx=t*c+a.x,void(l.ty=e*h+a.y)}let u=a.matrix.a,d=a.matrix.c,f=a.matrix.b,p=a.matrix.d;switch(l.tx=u*t+d*e+a.matrix.tx,l.ty=f*t+p*e+a.matrix.ty,this.data.transformMode){case DQ.Normal:{const t=n+90+o,e=YQ.cosDeg(n+s)*r,a=YQ.cosDeg(t)*i,c=YQ.sinDeg(n+s)*r,h=YQ.sinDeg(t)*i;return l.a=u*e+d*c,l.c=u*a+d*h,l.b=f*e+p*c,void(l.d=f*a+p*h)}case DQ.OnlyTranslation:{const t=n+90+o;l.a=YQ.cosDeg(n+s)*r,l.c=YQ.cosDeg(t)*i,l.b=YQ.sinDeg(n+s)*r,l.d=YQ.sinDeg(t)*i;break}case DQ.NoRotationOrReflection:{let t=u*u+f*f,e=0;t>1e-4?(t=Math.abs(u*p-d*f)/t,u/=c,f/=h,d=f*t,p=u*t,e=Math.atan2(f,u)*YQ.radDeg):(u=0,f=0,e=90-Math.atan2(p,d)*YQ.radDeg);const a=n+s-e,m=n+o-e+90,g=YQ.cosDeg(a)*r,v=YQ.cosDeg(m)*i,y=YQ.sinDeg(a)*r,b=YQ.sinDeg(m)*i;l.a=u*g-d*y,l.c=u*v-d*b,l.b=f*g+p*y,l.d=f*v+p*b;break}case DQ.NoScale:case DQ.NoScaleOrReflection:{const t=YQ.cosDeg(n),e=YQ.sinDeg(n);let a=(u*t+d*e)/c,m=(f*t+p*e)/h,g=Math.sqrt(a*a+m*m);g>1e-5&&(g=1/g),a*=g,m*=g,g=Math.sqrt(a*a+m*m),this.data.transformMode==DQ.NoScale&&u*p-d*f<0!=(c<0!=h<0)&&(g=-g);const v=Math.PI/2+Math.atan2(m,a),y=Math.cos(v)*g,b=Math.sin(v)*g,x=YQ.cosDeg(s)*r,w=YQ.cosDeg(90+o)*i,E=YQ.sinDeg(s)*r,_=YQ.sinDeg(90+o)*i;l.a=a*x+y*E,l.c=a*w+y*_,l.b=m*x+b*E,l.d=m*w+b*_;break}}l.a*=c,l.c*=c,l.b*=h,l.d*=h}setToSetupPose(){const t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY}getWorldRotationX(){return Math.atan2(this.matrix.b,this.matrix.a)*YQ.radDeg}getWorldRotationY(){return Math.atan2(this.matrix.d,this.matrix.c)*YQ.radDeg}getWorldScaleX(){const t=this.matrix;return Math.sqrt(t.a*t.a+t.b*t.b)}getWorldScaleY(){const t=this.matrix;return Math.sqrt(t.c*t.c+t.d*t.d)}updateAppliedTransform(){const t=this.parent,e=this.matrix;if(!t)return this.ax=e.tx-this.skeleton.x,this.ay=e.ty-this.skeleton.y,this.arotation=Math.atan2(e.b,e.a)*YQ.radDeg,this.ascaleX=Math.sqrt(e.a*e.a+e.b*e.b),this.ascaleY=Math.sqrt(e.c*e.c+e.d*e.d),this.ashearX=0,void(this.ashearY=Math.atan2(e.a*e.c+e.b*e.d,e.a*e.d-e.b*e.c)*YQ.radDeg);const n=t.matrix,r=1/(n.a*n.d-n.b*n.c),i=e.tx-n.tx,s=e.ty-n.ty;this.ax=i*n.d*r-s*n.c*r,this.ay=s*n.a*r-i*n.b*r;const o=r*n.d,a=r*n.a,l=r*n.c,c=r*n.b,h=o*e.a-l*e.b,u=o*e.c-l*e.d,d=a*e.b-c*e.a,f=a*e.d-c*e.c;if(this.ashearX=0,this.ascaleX=Math.sqrt(h*h+d*d),this.ascaleX>1e-4){const t=h*f-u*d;this.ascaleY=t/this.ascaleX,this.ashearY=Math.atan2(h*u+d*f,t)*YQ.radDeg,this.arotation=Math.atan2(d,h)*YQ.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(u*u+f*f),this.ashearY=0,this.arotation=90-Math.atan2(f,u)*YQ.radDeg}worldToLocal(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=1/(n*s-r*i),a=t.x-e.tx,l=t.y-e.ty;return t.x=a*s*o-l*r*o,t.y=l*n*o-a*i*o,t}localToWorld(t){const e=this.matrix,n=t.x,r=t.y;return t.x=n*e.a+r*e.c+e.tx,t.y=n*e.b+r*e.d+e.ty,t}worldToLocalRotation(t){const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(r.a*e-r.b*n,r.d*n-r.c*e)*YQ.radDeg}localToWorldRotation(t){t-=this.rotation-this.shearX;const e=YQ.sinDeg(t),n=YQ.cosDeg(t),r=this.matrix;return Math.atan2(n*r.b+e*r.d,n*r.a+e*r.c)*YQ.radDeg}rotateWorld(t){const e=this.matrix,n=e.a,r=e.c,i=e.b,s=e.d,o=YQ.cosDeg(t),a=YQ.sinDeg(t);e.a=o*n-a*i,e.c=o*r-a*s,e.b=a*n+o*i,e.d=a*r+o*s}}class A5{constructor(t,e,n){if(this.index=0,this.parent=null,this.length=0,this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=DQ.Normal,this.skinRequired=!1,this.color=new HQ,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");this.index=t,this.name=e,this.parent=n}}class C5{constructor(t,e,n){this.name=t,this.order=e,this.skinRequired=n}}let R5=class{constructor(t,e){if(this.intValue=0,this.floatValue=0,this.stringValue=null,this.time=0,this.volume=0,this.balance=0,!e)throw new Error("data cannot be null.");this.time=t,this.data=e}};class M5{constructor(t){this.intValue=0,this.floatValue=0,this.stringValue=null,this.audioPath=null,this.volume=0,this.balance=0,this.name=t}}class I5{constructor(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}`);this.bones.push(n)}const n=e.findBone(t.target.name);if(!n)throw new Error(`Couldn't find bone ${t.target.name}`);this.target=n}isActive(){return this.active}update(){if(0==this.mix)return;const t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.data.uniform,this.softness,this.mix)}}apply1(t,e,n,r,i,s,o){const a=t.parent.matrix;if(!a)throw new Error("IK bone must have parent.");const l=a.a;let c=a.c;const h=a.b;let u=a.d,d=-t.ashearX-t.arotation,f=0,p=0;const m=t.skeleton.scaleX,g=-t.skeleton.scaleY;switch(t.data.transformMode){case DQ.OnlyTranslation:f=e-t.worldX,p=n-t.worldY,p=-p;break;case DQ.NoRotationOrReflection:const r=Math.abs(l*u-c*h)/(l*l+h*h),i=l/m,s=h/g;c=-s*r*m,u=i*r*g,d+=Math.atan2(s,i)*YQ.radDeg;default:const o=e-a.tx,v=n-a.ty,y=l*u-c*h;f=(o*u-v*c)/y-t.ax,p=(v*l-o*h)/y-t.ay}d+=Math.atan2(p,f)*YQ.radDeg,t.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);let v=t.ascaleX,y=t.ascaleY;if(r||i){switch(t.data.transformMode){case DQ.NoScale:case DQ.NoScaleOrReflection:f=e-t.worldX,p=n-t.worldY}const a=t.data.length*v,l=Math.sqrt(f*f+p*p);if(r&&l<a||i&&l>a&&a>1e-4){const t=(l/a-1)*o+1;v*=t,s&&(y*=t)}}t.updateWorldTransformWith(t.ax,t.ay,t.arotation+d*o,v,y,t.ashearX,t.ashearY)}apply2(t,e,n,r,i,s,o,a,l){const c=t.ax,h=t.ay;let u=t.ascaleX,d=t.ascaleY,f=u,p=d,m=e.ascaleX;const g=t.matrix;let v=0,y=0,b=0;u<0?(u=-u,v=180,b=-1):(v=0,b=1),d<0&&(d=-d,b=-b),m<0?(m=-m,y=180):y=0;const x=e.ax;let w=0,E=0,_=0,S=g.a,T=g.c,k=g.b,A=g.d;const C=Math.abs(u-d)<=1e-4;!C||s?(w=0,E=S*x+g.tx,_=k*x+g.ty):(w=e.ay,E=S*x+T*w+g.tx,_=k*x+A*w+g.ty);const R=t.parent.matrix;if(!R)throw new Error("IK parent must itself have a parent.");S=R.a,T=R.c,k=R.b,A=R.d;const M=1/(S*A-T*k);let I=E-R.tx,D=_-R.ty;const O=(I*A-D*T)*M-c,P=(D*S-I*k)*M-h,L=Math.sqrt(O*O+P*P);let F,N,B=e.data.length*m;if(L<1e-4)return this.apply1(t,n,r,!1,s,!1,l),void e.updateWorldTransformWith(x,w,0,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY);I=n-R.tx,D=r-R.ty;let U=(I*A-D*T)*M-c,V=(D*S-I*k)*M-h,j=U*U+V*V;if(0!=a){a*=u*(m+1)*.5;const t=Math.sqrt(j),e=t-L-B*u+a;if(e>0){let n=Math.min(1,e/(2*a))-1;n=(e-a*(1-n*n))/t,U-=n*U,V-=n*V,j=U*U+V*V}}t:if(C){B*=u;let t=(j-L*L-B*B)/(2*L*B);t<-1?(t=-1,N=Math.PI*i):t>1?(t=1,N=0,s&&(S=(Math.sqrt(j)/(L+B)-1)*l+1,f*=S,o&&(p*=S))):N=Math.acos(t)*i,S=L+B*t,T=B*Math.sin(N),F=Math.atan2(V*S-U*T,U*S+V*T)}else{S=u*B,T=d*B;const t=S*S,e=T*T,n=Math.atan2(V,U);k=e*L*L+t*j-t*e;const r=-2*e*L,s=e-t;if(A=r*r-4*s*k,A>=0){let t=Math.sqrt(A);r<0&&(t=-t),t=.5*-(r+t);const e=t/s,o=k/t,a=Math.abs(e)<Math.abs(o)?e:o;if(a*a<=j){D=Math.sqrt(j-a*a)*i,F=n-Math.atan2(D,a),N=Math.atan2(D/d,(a-L)/u);break t}}let o=YQ.PI,a=L-S,l=a*a,c=0,h=0,f=L+S,p=f*f,m=0;k=-S*L/(t-e),k>=-1&&k<=1&&(k=Math.acos(k),I=S*Math.cos(k)+L,D=T*Math.sin(k),A=I*I+D*D,A<l&&(o=k,l=A,a=I,c=D),A>p&&(h=k,p=A,f=I,m=D)),j<=.5*(l+p)?(F=n-Math.atan2(c*i,a),N=o*i):(F=n-Math.atan2(m*i,f),N=h*i)}const z=Math.atan2(w,x)*b;let G=t.arotation;F=(F-z)*YQ.radDeg+v-G,F>180?F-=360:F<-180&&(F+=360),t.updateWorldTransformWith(c,h,G+F*l,f,p,0,0),G=e.arotation,N=((N+z)*YQ.radDeg-e.ashearX)*b+y-G,N>180?N-=360:N<-180&&(N+=360),e.updateWorldTransformWith(x,w,G+N*l,e.ascaleX,e.ascaleY,e.ashearX,e.ashearY)}}class D5 extends C5{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.bendDirection=1,this.compress=!1,this.stretch=!1,this.uniform=!1,this.mix=1,this.softness=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class O5 extends C5{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.positionMode=MQ.Fixed,this.spacingMode=P5.Fixed,this.rotateMode=IQ.Chain,this.offsetRotation=0,this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("SlotData not set.")}}var P5=(t=>(t[t.Length=0]="Length",t[t.Fixed=1]="Fixed",t[t.Percent=2]="Percent",t[t.Proportional=3]="Proportional",t))(P5||{});const L5=class{constructor(t,e){if(this.position=0,this.spacing=0,this.mixRotate=0,this.mixX=0,this.mixY=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(let r=0,i=t.bones.length;r<i;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(n)}const n=e.findSlot(t.target.name);if(!n)throw new Error(`Couldn't find target bone ${t.target.name}`);this.target=n,this.position=t.position,this.spacing=t.spacing,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY}isActive(){return this.active}update(){const t=this.target.getAttachment();if(!(t instanceof i3))return;const e=this.mixRotate,n=this.mixX,r=this.mixY;if(0==e&&0==n&&0==r)return;const i=this.data,s=i.rotateMode==IQ.Tangent,o=i.rotateMode==IQ.ChainScale,a=this.bones,l=a.length,c=s?l:l+1,h=JQ.setArraySize(this.spaces,c),u=o?this.lengths=JQ.setArraySize(this.lengths,l):[],d=this.spacing;switch(i.spacingMode){case P5.Percent:if(o)for(let n=0,r=c-1;n<r;n++){const t=a[n],e=t.data.length;if(e<L5.epsilon)u[n]=0;else{const r=e*t.matrix.a,i=e*t.matrix.b;u[n]=Math.sqrt(r*r+i*i)}}JQ.arrayFill(h,1,c,d);break;case P5.Proportional:let t=0;for(let n=0,r=c-1;n<r;){const e=a[n],r=e.data.length;if(r<L5.epsilon)o&&(u[n]=0),h[++n]=d;else{const i=r*e.matrix.a,s=r*e.matrix.b,a=Math.sqrt(i*i+s*s);o&&(u[n]=a),h[++n]=a,t+=a}}if(t>0){t=c/t*d;for(let e=1;e<c;e++)h[e]*=t}break;default:const e=i.spacingMode==P5.Length;for(let n=0,r=c-1;n<r;){const t=a[n],r=t.data.length;if(r<L5.epsilon)o&&(u[n]=0),h[++n]=d;else{const i=r*t.matrix.a,s=r*t.matrix.b,a=Math.sqrt(i*i+s*s);o&&(u[n]=a),h[++n]=(e?r+d:d)*a/r}}}const f=this.computeWorldPositions(t,c,s);let p=f[0],m=f[1],g=i.offsetRotation,v=!1;if(0==g)v=i.rotateMode==IQ.Chain;else{v=!1;const t=this.target.bone.matrix;g*=t.a*t.d-t.b*t.c>0?YQ.degRad:-YQ.degRad}for(let y=0,b=3;y<l;y++,b+=3){const t=a[y],i=t.matrix;i.tx+=(p-i.tx)*n,i.ty+=(m-i.ty)*r;const l=f[b],c=f[b+1],d=l-p,x=c-m;if(o){const t=u[y];if(0!=t){const n=(Math.sqrt(d*d+x*x)/t-1)*e+1;i.a*=n,i.b*=n}}if(p=l,m=c,e>0){const n=i.a,r=i.c,o=i.b,a=i.d;let l=0,c=0,u=0;if(l=s?f[b-1]:0==h[y+1]?f[b+2]:Math.atan2(x,d),l-=Math.atan2(o,n),v){c=Math.cos(l),u=Math.sin(l);const r=t.data.length;p+=(r*(c*n-u*o)-d)*e,m+=(r*(u*n+c*o)-x)*e}else l+=g;l>YQ.PI?l-=YQ.PI2:l<-YQ.PI&&(l+=YQ.PI2),l*=e,c=Math.cos(l),u=Math.sin(l),i.a=c*n-u*o,i.c=c*r-u*a,i.b=u*n+c*o,i.d=u*r+c*a}t.updateAppliedTransform()}}computeWorldPositions(t,e,n){const r=this.target;let i=this.position;const s=this.spaces,o=JQ.setArraySize(this.positions,3*e+2);let a=this.world;const l=t.closed;let c=t.worldVerticesLength,h=c/6,u=L5.NONE;if(!t.constantSpeed){const d=t.lengths;h-=l?1:2;const f=d[h];let p;switch(this.data.positionMode==MQ.Percent&&(i*=f),this.data.spacingMode){case P5.Percent:p=f;break;case P5.Proportional:p=f/e;break;default:p=1}a=JQ.setArraySize(this.world,8);for(let m=0,g=0,v=0;m<e;m++,g+=3){const e=s[m]*p;i+=e;let y=i;if(l)y%=f,y<0&&(y+=f),v=0;else{if(y<0){u!=L5.BEFORE&&(u=L5.BEFORE,t.computeWorldVertices(r,2,4,a,0,2)),this.addBeforePosition(y,a,0,o,g);continue}if(y>f){u!=L5.AFTER&&(u=L5.AFTER,t.computeWorldVertices(r,c-6,4,a,0,2)),this.addAfterPosition(y-f,a,0,o,g);continue}}for(;;v++){const t=d[v];if(!(y>t)){if(0==v)y/=t;else{const e=d[v-1];y=(y-e)/(t-e)}break}}v!=u&&(u=v,l&&v==h?(t.computeWorldVertices(r,c-4,4,a,0,2),t.computeWorldVertices(r,0,4,a,4,2)):t.computeWorldVertices(r,6*v+2,8,a,0,2)),this.addCurvePosition(y,a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],o,g,n||m>0&&0==e)}return o}l?(c+=2,a=JQ.setArraySize(this.world,c),t.computeWorldVertices(r,2,c-4,a,0,2),t.computeWorldVertices(r,0,2,a,c-4,2),a[c-2]=a[0],a[c-1]=a[1]):(h--,c-=4,a=JQ.setArraySize(this.world,c),t.computeWorldVertices(r,2,c,a,0,2));const d=JQ.setArraySize(this.curves,h);let f,p=0,m=a[0],g=a[1],v=0,y=0,b=0,x=0,w=0,E=0,_=0,S=0,T=0,k=0,A=0,C=0,R=0,M=0;for(let O=0,P=2;O<h;O++,P+=6)v=a[P],y=a[P+1],b=a[P+2],x=a[P+3],w=a[P+4],E=a[P+5],_=.1875*(m-2*v+b),S=.1875*(g-2*y+x),T=.09375*(3*(v-b)-m+w),k=.09375*(3*(y-x)-g+E),A=2*_+T,C=2*S+k,R=.75*(v-m)+_+.16666667*T,M=.75*(y-g)+S+.16666667*k,p+=Math.sqrt(R*R+M*M),R+=A,M+=C,A+=T,C+=k,p+=Math.sqrt(R*R+M*M),R+=A,M+=C,p+=Math.sqrt(R*R+M*M),R+=A+T,M+=C+k,p+=Math.sqrt(R*R+M*M),d[O]=p,m=w,g=E;switch(this.data.positionMode==MQ.Percent&&(i*=p),this.data.spacingMode){case P5.Percent:f=p;break;case P5.Proportional:f=p/e;break;default:f=1}const I=this.segments;let D=0;for(let O=0,P=0,L=0,F=0;O<e;O++,P+=3){const t=s[O]*f;i+=t;let e=i;if(l)e%=p,e<0&&(e+=p),L=0;else{if(e<0){this.addBeforePosition(e,a,0,o,P);continue}if(e>p){this.addAfterPosition(e-p,a,c-4,o,P);continue}}for(;;L++){const t=d[L];if(!(e>t)){if(0==L)e/=t;else{const n=d[L-1];e=(e-n)/(t-n)}break}}if(L!=u){u=L;let t=6*L;for(m=a[t],g=a[t+1],v=a[t+2],y=a[t+3],b=a[t+4],x=a[t+5],w=a[t+6],E=a[t+7],_=.03*(m-2*v+b),S=.03*(g-2*y+x),T=.006*(3*(v-b)-m+w),k=.006*(3*(y-x)-g+E),A=2*_+T,C=2*S+k,R=.3*(v-m)+_+.16666667*T,M=.3*(y-g)+S+.16666667*k,D=Math.sqrt(R*R+M*M),I[0]=D,t=1;t<8;t++)R+=A,M+=C,A+=T,C+=k,D+=Math.sqrt(R*R+M*M),I[t]=D;R+=A,M+=C,D+=Math.sqrt(R*R+M*M),I[8]=D,R+=A+T,M+=C+k,D+=Math.sqrt(R*R+M*M),I[9]=D,F=0}for(e*=D;;F++){const t=I[F];if(!(e>t)){if(0==F)e/=t;else{const n=I[F-1];e=F+(e-n)/(t-n)}break}}this.addCurvePosition(.1*e,m,g,v,y,b,x,w,E,o,P,n||O>0&&0==t)}return o}addBeforePosition(t,e,n,r,i){const s=e[n],o=e[n+1],a=e[n+2]-s,l=e[n+3]-o,c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addAfterPosition(t,e,n,r,i){const s=e[n+2],o=e[n+3],a=s-e[n],l=o-e[n+1],c=Math.atan2(l,a);r[i]=s+t*Math.cos(c),r[i+1]=o+t*Math.sin(c),r[i+2]=c}addCurvePosition(t,e,n,r,i,s,o,a,l,c,h,u){if(0==t||isNaN(t))return c[h]=e,c[h+1]=n,void(c[h+2]=Math.atan2(i-n,r-e));const d=t*t,f=d*t,p=1-t,m=p*p,g=m*p,v=p*t,y=3*v,b=p*y,x=y*t,w=e*g+r*b+s*x+a*f,E=n*g+i*b+o*x+l*f;c[h]=w,c[h+1]=E,u&&(c[h+2]=t<.001?Math.atan2(i-n,r-e):Math.atan2(E-(n*m+i*v*2+o*d),w-(e*m+r*v*2+s*d)))}};let F5=L5;F5.NONE=-1,F5.BEFORE=-2,F5.AFTER=-3,F5.epsilon=1e-5;class N5{constructor(t,e){if(this.darkColor=null,this.attachment=null,this.attachmentState=0,this.sequenceIndex=-1,this.deform=new Array,!t)throw new Error("data cannot be null.");if(!e)throw new Error("bone cannot be null.");this.data=t,this.bone=e,this.color=new HQ,this.darkColor=t.darkColor?new HQ:null,this.setToSetupPose(),this.blendMode=this.data.blendMode}getSkeleton(){return this.bone.skeleton}getAttachment(){return this.attachment}setAttachment(t){this.attachment!=t&&(t instanceof t3&&this.attachment instanceof t3&&t.timelineAttachment==this.attachment.timelineAttachment||(this.deform.length=0),this.attachment=t,this.sequenceIndex=-1)}setToSetupPose(){this.color.setFromColor(this.data.color),this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),this.data.attachmentName?(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName))):this.attachment=null}}class B5{constructor(t,e){if(this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.temp=new t0,this.active=!1,!t)throw new Error("data cannot be null.");if(!e)throw new Error("skeleton cannot be null.");this.data=t,this.mixRotate=t.mixRotate,this.mixX=t.mixX,this.mixY=t.mixY,this.mixScaleX=t.mixScaleX,this.mixScaleY=t.mixScaleY,this.mixShearY=t.mixShearY,this.bones=new Array;for(let r=0;r<t.bones.length;r++){const n=e.findBone(t.bones[r].name);if(!n)throw new Error(`Couldn't find bone ${t.bones[r].name}.`);this.bones.push(n)}const n=e.findBone(t.target.name);if(!n)throw new Error(`Couldn't find target bone ${t.target.name}.`);this.target=n}isActive(){return this.active}update(){0==this.mixRotate&&0==this.mixX&&0==this.mixY&&0==this.mixScaleX&&0==this.mixScaleX&&0==this.mixShearY||(this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld())}applyAbsoluteWorld(){const t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=0!=e||0!=n,a=this.target,l=a.matrix,c=l.a,h=l.c,u=l.b,d=l.d,f=c*d-h*u>0?YQ.degRad:-YQ.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let v=0,y=g.length;v<y;v++){const l=g[v],f=l.matrix;if(0!=t){const e=f.a,n=f.c,r=f.b,i=f.d;let s=Math.atan2(u,c)-Math.atan2(r,e)+p;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const o=Math.cos(s),a=Math.sin(s);f.a=o*e-a*r,f.c=o*n-a*i,f.b=a*e+o*r,f.d=a*n+o*i}if(o){const t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=(t.x-f.tx)*e,f.ty+=(t.y-f.ty)*n}if(0!=r){let t=Math.sqrt(f.a*f.a+f.b*f.b);0!=t&&(t=(t+(Math.sqrt(c*c+u*u)-t+this.data.offsetScaleX)*r)/t),f.a*=t,f.b*=t}if(0!=i){let t=Math.sqrt(f.c*f.c+f.d*f.d);0!=t&&(t=(t+(Math.sqrt(h*h+d*d)-t+this.data.offsetScaleY)*i)/t),f.c*=t,f.d*=t}if(s>0){const t=f.c,e=f.d,n=Math.atan2(e,t);let r=Math.atan2(d,h)-Math.atan2(u,c)-(n-Math.atan2(f.b,f.a));r>YQ.PI?r-=YQ.PI2:r<-YQ.PI&&(r+=YQ.PI2),r=n+(r+m)*s;const i=Math.sqrt(t*t+e*e);f.c=Math.cos(r)*i,f.d=Math.sin(r)*i}l.updateAppliedTransform()}}applyRelativeWorld(){const t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=0!=e||0!=n,a=this.target,l=a.matrix,c=l.a,h=l.c,u=l.b,d=l.d,f=c*d-h*u>0?YQ.degRad:-YQ.degRad,p=this.data.offsetRotation*f,m=this.data.offsetShearY*f,g=this.bones;for(let v=0,y=g.length;v<y;v++){const l=g[v],f=l.matrix;if(0!=t){const e=f.a,n=f.c,r=f.b,i=f.d;let s=Math.atan2(u,c)+p;s>YQ.PI?s-=YQ.PI2:s<-YQ.PI&&(s+=YQ.PI2),s*=t;const o=Math.cos(s),a=Math.sin(s);f.a=o*e-a*r,f.c=o*n-a*i,f.b=a*e+o*r,f.d=a*n+o*i}if(o){const t=this.temp;a.localToWorld(t.set(this.data.offsetX,this.data.offsetY)),f.tx+=t.x*e,f.ty+=t.y*n}if(0!=r){const t=(Math.sqrt(c*c+u*u)-1+this.data.offsetScaleX)*r+1;f.a*=t,f.b*=t}if(0!=i){const t=(Math.sqrt(h*h+d*d)-1+this.data.offsetScaleY)*i+1;f.c*=t,f.d*=t}if(s>0){let t=Math.atan2(d,h)-Math.atan2(u,c);t>YQ.PI?t-=YQ.PI2:t<-YQ.PI&&(t+=YQ.PI2);const e=f.c,n=f.d;t=Math.atan2(n,e)+(t-YQ.PI/2+m)*s;const r=Math.sqrt(e*e+n*n);f.c=Math.cos(t)*r,f.d=Math.sin(t)*r}l.updateAppliedTransform()}}applyAbsoluteLocal(){const t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=this.target,a=this.bones;for(let l=0,c=a.length;l<c;l++){const c=a[l];let h=c.arotation;if(0!=t){let e=o.arotation-h+this.data.offsetRotation;e-=360*(16384-(16384.499999999996-e/360|0)),h+=e*t}let u=c.ax,d=c.ay;u+=(o.ax-u+this.data.offsetX)*e,d+=(o.ay-d+this.data.offsetY)*n;let f=c.ascaleX,p=c.ascaleY;0!=r&&0!=f&&(f=(f+(o.ascaleX-f+this.data.offsetScaleX)*r)/f),0!=i&&0!=p&&(p=(p+(o.ascaleY-p+this.data.offsetScaleY)*i)/p);let m=c.ashearY;if(0!=s){let t=o.ashearY-m+this.data.offsetShearY;t-=360*(16384-(16384.499999999996-t/360|0)),m+=t*s}c.updateWorldTransformWith(u,d,h,f,p,c.ashearX,m)}}applyRelativeLocal(){const t=this.mixRotate,e=this.mixX,n=this.mixY,r=this.mixScaleX,i=this.mixScaleY,s=this.mixShearY,o=this.target,a=this.bones;for(let l=0,c=a.length;l<c;l++){const c=a[l],h=c.arotation+(o.arotation+this.data.offsetRotation)*t,u=c.ax+(o.ax+this.data.offsetX)*e,d=c.ay+(o.ay+this.data.offsetY)*n,f=c.ascaleX*((o.ascaleX-1+this.data.offsetScaleX)*r+1),p=c.ascaleY*((o.ascaleY-1+this.data.offsetScaleY)*i+1),m=c.ashearY+(o.ashearY+this.data.offsetShearY)*s;c.updateWorldTransformWith(u,d,h,f,p,c.ashearX,m)}}}const U5=class{constructor(t){if(this._updateCache=new Array,this.skin=null,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,!t)throw new Error("data cannot be null.");this.data=t,this.bones=new Array;for(let e=0;e<t.bones.length;e++){const n=t.bones[e];let r;if(n.parent){const t=this.bones[n.parent.index];r=new k5(n,this,t),t.children.push(r)}else r=new k5(n,this,null);this.bones.push(r)}this.slots=new Array,this.drawOrder=new Array;for(let e=0;e<t.slots.length;e++){const n=t.slots[e],r=this.bones[n.boneData.index],i=new N5(n,r);this.slots.push(i),this.drawOrder.push(i)}this.ikConstraints=new Array;for(let e=0;e<t.ikConstraints.length;e++){const n=t.ikConstraints[e];this.ikConstraints.push(new I5(n,this))}this.transformConstraints=new Array;for(let e=0;e<t.transformConstraints.length;e++){const n=t.transformConstraints[e];this.transformConstraints.push(new B5(n,this))}this.pathConstraints=new Array;for(let e=0;e<t.pathConstraints.length;e++){const n=t.pathConstraints[e];this.pathConstraints.push(new F5(n,this))}this.color=new HQ(1,1,1,1),this.updateCache()}updateCache(){this._updateCache.length=0;const t=this.bones;for(let l=0,c=t.length;l<c;l++){const e=t[l];e.sorted=e.data.skinRequired,e.active=!e.sorted}if(this.skin){const t=this.skin.bones;for(let e=0,n=this.skin.bones.length;e<n;e++){let n=this.bones[t[e].index];do{n.sorted=!1,n.active=!0,n=n.parent}while(n)}}const e=this.ikConstraints,n=this.transformConstraints,r=this.pathConstraints,i=e.length,s=n.length,o=r.length,a=i+s+o;t:for(let l=0;l<a;l++){for(let t=0;t<i;t++){const n=e[t];if(n.data.order==l){this.sortIkConstraint(n);continue t}}for(let t=0;t<s;t++){const e=n[t];if(e.data.order==l){this.sortTransformConstraint(e);continue t}}for(let t=0;t<o;t++){const e=r[t];if(e.data.order==l){this.sortPathConstraint(e);continue t}}}for(let l=0,c=t.length;l<c;l++)this.sortBone(t[l])}sortIkConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target;this.sortBone(e);const n=t.bones,r=n[0];if(this.sortBone(r),1==n.length)this._updateCache.push(t),this.sortReset(r.children);else{const e=n[n.length-1];this.sortBone(e),this._updateCache.push(t),this.sortReset(r.children),e.sorted=!0}}sortPathConstraint(t){if(t.active=t.target.bone.isActive()&&(!t.data.skinRequired||this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;const e=t.target,n=e.data.index,r=e.bone;this.skin&&this.sortPathConstraintAttachment(this.skin,n,r),this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,n,r);for(let a=0,l=this.data.skins.length;a<l;a++)this.sortPathConstraintAttachment(this.data.skins[a],n,r);const i=e.getAttachment();i instanceof i3&&this.sortPathConstraintAttachmentWith(i,r);const s=t.bones,o=s.length;for(let a=0;a<o;a++)this.sortBone(s[a]);this._updateCache.push(t);for(let a=0;a<o;a++)this.sortReset(s[a].children);for(let a=0;a<o;a++)s[a].sorted=!0}sortTransformConstraint(t){if(t.active=t.target.isActive()&&(!t.data.skinRequired||this.skin&&JQ.contains(this.skin.constraints,t.data,!0)),!t.active)return;this.sortBone(t.target);const e=t.bones,n=e.length;if(t.data.local)for(let r=0;r<n;r++){const t=e[r];this.sortBone(t.parent),this.sortBone(t)}else for(let r=0;r<n;r++)this.sortBone(e[r]);this._updateCache.push(t);for(let r=0;r<n;r++)this.sortReset(e[r].children);for(let r=0;r<n;r++)e[r].sorted=!0}sortPathConstraintAttachment(t,e,n){const r=t.attachments[e];if(r)for(const i in r)this.sortPathConstraintAttachmentWith(r[i],n)}sortPathConstraintAttachmentWith(t,e){if(!(t instanceof i3))return;const n=t.bones;if(n){const t=this.bones;for(let e=0,r=n.length;e<r;){let r=n[e++];for(r+=e;e<r;)this.sortBone(t[n[e++]])}}else this.sortBone(e)}sortBone(t){if(!t)return;if(t.sorted)return;const e=t.parent;e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}sortReset(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];n.active&&(n.sorted&&this.sortReset(n.children),n.sorted=!1)}}updateWorldTransform(){const t=this.bones;for(let n=0,r=t.length;n<r;n++){const e=t[n];e.ax=e.x,e.ay=e.y,e.arotation=e.rotation,e.ascaleX=e.scaleX,e.ascaleY=e.scaleY,e.ashearX=e.shearX,e.ashearY=e.shearY}const e=this._updateCache;for(let n=0,r=e.length;n<r;n++)e[n].update()}updateWorldTransformWith(t){const e=this.getRootBone(),n=t.matrix.a,r=t.matrix.c,i=t.matrix.b,s=t.matrix.d;e.matrix.tx=n*this.x+r*this.y+t.worldX,e.matrix.ty=i*this.x+s*this.y+t.worldY;const o=e.rotation+90+e.shearY,a=YQ.cosDeg(e.rotation+e.shearX)*e.scaleX,l=YQ.cosDeg(o)*e.scaleY,c=YQ.sinDeg(e.rotation+e.shearX)*e.scaleX,h=YQ.sinDeg(o)*e.scaleY,u=this.scaleX,d=-this.scaleY;e.matrix.a=(n*a+r*c)*u,e.matrix.c=(n*l+r*h)*u,e.matrix.b=(i*a+s*c)*d,e.matrix.d=(i*l+s*h)*d;const f=this._updateCache;for(let p=0,m=f.length;p<m;p++){const t=f[p];t!=e&&t.update()}}setToSetupPose(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()}setBonesToSetupPose(){const t=this.bones;for(let i=0,s=t.length;i<s;i++)t[i].setToSetupPose();const e=this.ikConstraints;for(let i=0,s=e.length;i<s;i++){const t=e[i];t.mix=t.data.mix,t.softness=t.data.softness,t.bendDirection=t.data.bendDirection,t.compress=t.data.compress,t.stretch=t.data.stretch}const n=this.transformConstraints;for(let i=0,s=n.length;i<s;i++){const t=n[i],e=t.data;t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY,t.mixScaleX=e.mixScaleX,t.mixScaleY=e.mixScaleY,t.mixShearY=e.mixShearY}const r=this.pathConstraints;for(let i=0,s=r.length;i<s;i++){const t=r[i],e=t.data;t.position=e.position,t.spacing=e.spacing,t.mixRotate=e.mixRotate,t.mixX=e.mixX,t.mixY=e.mixY}}setSlotsToSetupPose(){const t=this.slots;JQ.arrayCopy(t,0,this.drawOrder,0,t.length);for(let e=0,n=t.length;e<n;e++)t[e].setToSetupPose()}getRootBone(){return 0==this.bones.length?null:this.bones[0]}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].data.name==t)return n;return-1}setSkinByName(t){const e=this.data.findSkin(t);if(!e)throw new Error(`Skin not found: ${t}`);this.setSkin(e)}setSkin(t){if(t!=this.skin){if(t)if(this.skin)t.attachAll(this,this.skin);else{const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n],i=r.data.attachmentName;if(i){const e=t.getAttachment(n,i);e&&r.setAttachment(e)}}}this.skin=t,this.updateCache()}}getAttachmentByName(t,e){const n=this.data.findSlot(t);if(!n)throw new Error(`Can't find slot with name ${t}`);return this.getAttachment(n.index,e)}getAttachment(t,e){if(!e)throw new Error("attachmentName cannot be null.");if(this.skin){const n=this.skin.getAttachment(t,e);if(n)return n}return this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null}setAttachment(t,e){if(!t)throw new Error("slotName cannot be null.");const n=this.slots;for(let r=0,i=n.length;r<i;r++){const i=n[r];if(i.data.name==t){let n=null;if(e&&(n=this.getAttachment(r,e),!n))throw new Error(`Attachment not found: ${e}, for slot: ${t}`);return void i.setAttachment(n)}}throw new Error(`Slot not found: ${t}`)}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.data.name==t)return r}return null}getBoundsRect(){const t=new t0,e=new t0;return this.getBounds(t,e),{x:t.x,y:t.y,width:e.x,height:e.y}}getBounds(t,e,n=new Array(2)){if(!t)throw new Error("offset cannot be null.");if(!e)throw new Error("size cannot be null.");const r=this.drawOrder;let i=Number.POSITIVE_INFINITY,s=Number.POSITIVE_INFINITY,o=Number.NEGATIVE_INFINITY,a=Number.NEGATIVE_INFINITY;for(let l=0,c=r.length;l<c;l++){const t=r[l];if(!t.bone.active)continue;let e=0,c=null;const h=t.getAttachment();if(h instanceof a3)e=8,c=JQ.setArraySize(n,e,0),h.computeWorldVertices(t,c,0,2);else if(h instanceof r3){const r=h;e=r.worldVerticesLength,c=JQ.setArraySize(n,e,0),r.computeWorldVertices(t,0,e,c,0,2)}if(c)for(let n=0,r=c.length;n<r;n+=2){const t=c[n],e=c[n+1];i=Math.min(i,t),s=Math.min(s,e),o=Math.max(o,t),a=Math.max(a,e)}}t.set(i,s),e.set(o-i,a-s)}get flipX(){return-1==this.scaleX}set flipX(t){U5.deprecatedWarning1||(U5.deprecatedWarning1=!0),this.scaleX=t?1:-1}get flipY(){return-1==this.scaleY}set flipY(t){U5.deprecatedWarning1||(U5.deprecatedWarning1=!0),this.scaleY=t?1:-1}};let V5=U5;V5.deprecatedWarning1=!1;class j5{constructor(){this.name=null,this.bones=new Array,this.slots=new Array,this.skins=new Array,this.defaultSkin=null,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.x=0,this.y=0,this.width=0,this.height=0,this.version=null,this.hash=null,this.fps=0,this.imagesPath=null,this.audioPath=null}findBone(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findBoneIndex(t){if(!t)throw new Error("boneName cannot be null.");const e=this.bones;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSlot(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findSlotIndex(t){if(!t)throw new Error("slotName cannot be null.");const e=this.slots;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}findSkin(t){if(!t)throw new Error("skinName cannot be null.");const e=this.skins;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findEvent(t){if(!t)throw new Error("eventDataName cannot be null.");const e=this.events;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findAnimation(t){if(!t)throw new Error("animationName cannot be null.");const e=this.animations;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findIkConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.ikConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findTransformConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.transformConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraint(t){if(!t)throw new Error("constraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++){const r=e[n];if(r.name==t)return r}return null}findPathConstraintIndex(t){if(null==t)throw new Error("pathConstraintName cannot be null.");const e=this.pathConstraints;for(let n=0,r=e.length;n<r;n++)if(e[n].name==t)return n;return-1}}class z5{constructor(t,e,n){if(this.index=0,this.color=new HQ(1,1,1,1),this.darkColor=null,this.attachmentName=null,this.blendMode=CW.NORMAL,t<0)throw new Error("index must be >= 0.");if(!e)throw new Error("name cannot be null.");if(!n)throw new Error("boneData cannot be null.");this.index=t,this.name=e,this.boneData=n}}class G5 extends C5{constructor(t){super(t,0,!1),this.bones=new Array,this._target=null,this.mixRotate=0,this.mixX=0,this.mixY=0,this.mixScaleX=0,this.mixScaleY=0,this.mixShearY=0,this.offsetRotation=0,this.offsetX=0,this.offsetY=0,this.offsetScaleX=0,this.offsetScaleY=0,this.offsetShearY=0,this.relative=!1,this.local=!1}set target(t){this._target=t}get target(){if(this._target)return this._target;throw new Error("BoneData not set.")}}class W5{constructor(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n}}class H5{constructor(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,!t)throw new Error("name cannot be null.");this.name=t}setAttachment(t,e,n){if(!n)throw new Error("attachment cannot be null.");const r=this.attachments;t>=r.length&&(r.length=t+1),r[t]||(r[t]={}),r[t][e]=n}addSkin(t){for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let n=0;n<t.constraints.length;n++){const e=t.constraints[n];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let n=0;n<e.length;n++){const t=e[n];this.setAttachment(t.slotIndex,t.name,t.attachment)}}copySkin(t){for(let n=0;n<t.bones.length;n++){const e=t.bones[n];let r=!1;for(let t=0;t<this.bones.length;t++)if(this.bones[t]==e){r=!0;break}r||this.bones.push(e)}for(let n=0;n<t.constraints.length;n++){const e=t.constraints[n];let r=!1;for(let t=0;t<this.constraints.length;t++)if(this.constraints[t]==e){r=!0;break}r||this.constraints.push(e)}const e=t.getAttachments();for(let n=0;n<e.length;n++){const t=e[n];t.attachment&&(t.attachment instanceof r3?(t.attachment=t.attachment.newLinkedMesh(),this.setAttachment(t.slotIndex,t.name,t.attachment)):(t.attachment=t.attachment.copy(),this.setAttachment(t.slotIndex,t.name,t.attachment)))}}getAttachment(t,e){const n=this.attachments[t];return n?n[e]:null}removeAttachment(t,e){const n=this.attachments[t];n&&delete n[e]}getAttachments(){const t=new Array;for(let e=0;e<this.attachments.length;e++){const n=this.attachments[e];if(n)for(const r in n){const i=n[r];i&&t.push(new W5(e,r,i))}}return t}getAttachmentsForSlot(t,e){const n=this.attachments[t];if(n)for(const r in n){const i=n[r];i&&e.push(new W5(t,r,i))}}clear(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0}attachAll(t,e){let n=0;for(let r=0;r<t.slots.length;r++){const i=t.slots[r],s=i.getAttachment();if(s&&n<e.attachments.length){const t=e.attachments[n];for(const e in t){if(s==t[e]){const t=this.getAttachment(n,e);t&&i.setAttachment(t);break}}}n++}}}class $5{constructor(t){this.ver40=!1,this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,n=new j5;n.name="";const r=new AQ(t),i=r.readInt32(),s=r.readInt32();n.hash=0==s&&0==i?null:s.toString(16)+i.toString(16),n.version=r.readString();const o=n.version.substr(0,3);if("4.0"!==o&&"4.1"!==o){n.version}this.ver40="4.0"===o,n.x=r.readFloat(),n.y=r.readFloat(),n.width=r.readFloat(),n.height=r.readFloat();const a=r.readBoolean();a&&(n.fps=r.readFloat(),n.imagesPath=r.readString(),n.audioPath=r.readString());let l=0;l=r.readInt(!0);for(let h=0;h<l;h++){const t=r.readString();if(!t)throw new Error("String in string table must not be null.");r.strings.push(t)}l=r.readInt(!0);for(let h=0;h<l;h++){const t=r.readString();if(!t)throw new Error("Bone name must not be null.");const i=0==h?null:n.bones[r.readInt(!0)],s=new A5(h,t,i);s.rotation=r.readFloat(),s.x=r.readFloat()*e,s.y=r.readFloat()*e,s.scaleX=r.readFloat(),s.scaleY=r.readFloat(),s.shearX=r.readFloat(),s.shearY=r.readFloat(),s.length=r.readFloat()*e,s.transformMode=r.readInt(!0),s.skinRequired=r.readBoolean(),a&&HQ.rgba8888ToColor(s.color,r.readInt32()),n.bones.push(s)}l=r.readInt(!0);for(let h=0;h<l;h++){const t=r.readString();if(!t)throw new Error("Slot name must not be null.");const e=n.bones[r.readInt(!0)],i=new z5(h,t,e);HQ.rgba8888ToColor(i.color,r.readInt32());const s=r.readInt32();-1!=s&&HQ.rgb888ToColor(i.darkColor=new HQ,s),i.attachmentName=r.readStringRef(),i.blendMode=r.readInt(!0),n.slots.push(i)}l=r.readInt(!0);for(let h,u=0;u<l;u++){const t=r.readString();if(!t)throw new Error("IK constraint data name must not be null.");const i=new D5(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),h=r.readInt(!0);for(let e=0;e<h;e++)i.bones.push(n.bones[r.readInt(!0)]);i.target=n.bones[r.readInt(!0)],i.mix=r.readFloat(),i.softness=r.readFloat()*e,i.bendDirection=r.readByte(),i.compress=r.readBoolean(),i.stretch=r.readBoolean(),i.uniform=r.readBoolean(),n.ikConstraints.push(i)}l=r.readInt(!0);for(let h,u=0;u<l;u++){const t=r.readString();if(!t)throw new Error("Transform constraint data name must not be null.");const i=new G5(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),h=r.readInt(!0);for(let e=0;e<h;e++)i.bones.push(n.bones[r.readInt(!0)]);i.target=n.bones[r.readInt(!0)],i.local=r.readBoolean(),i.relative=r.readBoolean(),i.offsetRotation=r.readFloat(),i.offsetX=r.readFloat()*e,i.offsetY=r.readFloat()*e,i.offsetScaleX=r.readFloat(),i.offsetScaleY=r.readFloat(),i.offsetShearY=r.readFloat(),i.mixRotate=r.readFloat(),i.mixX=r.readFloat(),i.mixY=r.readFloat(),i.mixScaleX=r.readFloat(),i.mixScaleY=r.readFloat(),i.mixShearY=r.readFloat(),n.transformConstraints.push(i)}l=r.readInt(!0);for(let h,u=0;u<l;u++){const t=r.readString();if(!t)throw new Error("Path constraint data name must not be null.");const i=new O5(t);i.order=r.readInt(!0),i.skinRequired=r.readBoolean(),h=r.readInt(!0);for(let e=0;e<h;e++)i.bones.push(n.bones[r.readInt(!0)]);i.target=n.slots[r.readInt(!0)],i.positionMode=r.readInt(!0),i.spacingMode=r.readInt(!0),i.rotateMode=r.readInt(!0),i.offsetRotation=r.readFloat(),i.position=r.readFloat(),i.positionMode==MQ.Fixed&&(i.position*=e),i.spacing=r.readFloat(),i.spacingMode!=P5.Length&&i.spacingMode!=P5.Fixed||(i.spacing*=e),i.mixRotate=r.readFloat(),i.mixX=r.readFloat(),i.mixY=r.readFloat(),n.pathConstraints.push(i)}const c=this.readSkin(r,n,!0,a);c&&(n.defaultSkin=c,n.skins.push(c));{let t=n.skins.length;for(JQ.setArraySize(n.skins,l=t+r.readInt(!0));t<l;t++){const e=this.readSkin(r,n,!1,a);if(!e)throw new Error("readSkin() should not have returned null.");n.skins[t]=e}}l=this.linkedMeshes.length;for(let h=0;h<l;h++){const t=this.linkedMeshes[h],e=t.skin?n.findSkin(t.skin):n.defaultSkin;if(!e)throw new Error("Not skin found for linked mesh.");if(!t.parent)throw new Error("Linked mesh parent must not be null");const r=e.getAttachment(t.slotIndex,t.parent);if(!r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?r:t.mesh,t.mesh.setParentMesh(r)}this.linkedMeshes.length=0,l=r.readInt(!0);for(let h=0;h<l;h++){const t=r.readStringRef();if(!t)throw new Error;const e=new M5(t);e.intValue=r.readInt(!1),e.floatValue=r.readFloat(),e.stringValue=r.readString(),e.audioPath=r.readString(),e.audioPath&&(e.volume=r.readFloat(),e.balance=r.readFloat()),n.events.push(e)}l=r.readInt(!0);for(let h=0;h<l;h++){const t=r.readString();if(!t)throw new Error("Animatio name must not be null.");n.animations.push(this.readAnimation(r,t,n))}return n}readSkin(t,e,n,r){let i=null,s=0;if(n){if(s=t.readInt(!0),0==s)return null;i=new H5("default")}else{const n=t.readStringRef();if(!n)throw new Error("Skin name must not be null.");i=new H5(n),i.bones.length=t.readInt(!0);for(let r=0,s=i.bones.length;r<s;r++)i.bones[r]=e.bones[t.readInt(!0)];for(let r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.ikConstraints[t.readInt(!0)]);for(let r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.transformConstraints[t.readInt(!0)]);for(let r=0,s=t.readInt(!0);r<s;r++)i.constraints.push(e.pathConstraints[t.readInt(!0)]);s=t.readInt(!0)}for(let o=0;o<s;o++){const n=t.readInt(!0);for(let s=0,o=t.readInt(!0);s<o;s++){const s=t.readStringRef();if(!s)throw new Error("Attachment name must not be null");const o=this.readAttachment(t,e,i,n,s,r);o&&i.setAttachment(n,s,o)}}return i}readAttachment(t,e,n,r,i,s){const o=this.scale;let a=t.readStringRef();switch(a||(a=i),t.readByte()){case kQ.Region:{let e=t.readStringRef();const r=t.readFloat(),i=t.readFloat(),s=t.readFloat(),l=t.readFloat(),c=t.readFloat(),h=t.readFloat(),u=t.readFloat(),d=t.readInt32(),f=this.readSequence(t);e||(e=a);const p=this.attachmentLoader.newRegionAttachment(n,a,e,f);return p?(p.path=e,p.x=i*o,p.y=s*o,p.scaleX=l,p.scaleY=c,p.rotation=r,p.width=h*o,p.height=u*o,HQ.rgba8888ToColor(p.color,d),p.sequence=f,null==f&&p.updateRegion(),p):null}case kQ.BoundingBox:{const e=t.readInt(!0),r=this.readVertices(t,e),i=s?t.readInt32():0,o=this.attachmentLoader.newBoundingBoxAttachment(n,a);return o?(o.worldVerticesLength=e<<1,o.vertices=r.vertices,o.bones=r.bones,s&&HQ.rgba8888ToColor(o.color,i),o):null}case kQ.Mesh:{let e=t.readStringRef();const r=t.readInt32(),i=t.readInt(!0),l=this.readFloatArray(t,i<<1,1),c=this.readShortArray(t),h=this.readVertices(t,i),u=t.readInt(!0),d=this.readSequence(t);let f=[],p=0,m=0;s&&(f=this.readShortArray(t),p=t.readFloat(),m=t.readFloat()),e||(e=a);const g=this.attachmentLoader.newMeshAttachment(n,a,e,d);return g?(g.path=e,HQ.rgba8888ToColor(g.color,r),g.bones=h.bones,g.vertices=h.vertices,g.worldVerticesLength=i<<1,g.triangles=c,g.regionUVs=new Float32Array(l),g.hullLength=u<<1,g.sequence=d,s&&(g.edges=f,g.width=p*o,g.height=m*o),g):null}case kQ.LinkedMesh:{let e=t.readStringRef();const i=t.readInt32(),l=t.readStringRef(),c=t.readStringRef(),h=t.readBoolean(),u=this.readSequence(t);let d=0,f=0;s&&(d=t.readFloat(),f=t.readFloat()),e||(e=a);const p=this.attachmentLoader.newMeshAttachment(n,a,e,u);return p?(p.path=e,HQ.rgba8888ToColor(p.color,i),p.sequence=u,s&&(p.width=d*o,p.height=f*o),this.linkedMeshes.push(new Y5(p,l,r,c,h)),p):null}case kQ.Path:{const e=t.readBoolean(),r=t.readBoolean(),i=t.readInt(!0),l=this.readVertices(t,i),c=JQ.newArray(i/3,0);for(let n=0,s=c.length;n<s;n++)c[n]=t.readFloat()*o;const h=s?t.readInt32():0,u=this.attachmentLoader.newPathAttachment(n,a);return u?(u.closed=e,u.constantSpeed=r,u.worldVerticesLength=i<<1,u.vertices=l.vertices,u.bones=l.bones,u.lengths=c,s&&HQ.rgba8888ToColor(u.color,h),u):null}case kQ.Point:{const e=t.readFloat(),r=t.readFloat(),i=t.readFloat(),l=s?t.readInt32():0,c=this.attachmentLoader.newPointAttachment(n,a);return c?(c.x=r*o,c.y=i*o,c.rotation=e,s&&HQ.rgba8888ToColor(c.color,l),c):null}case kQ.Clipping:{const r=t.readInt(!0),i=t.readInt(!0),o=this.readVertices(t,i),l=s?t.readInt32():0,c=this.attachmentLoader.newClippingAttachment(n,a);return c?(c.endSlot=e.slots[r],c.worldVerticesLength=i<<1,c.vertices=o.vertices,c.bones=o.bones,s&&HQ.rgba8888ToColor(c.color,l),c):null}}return null}readSequence(t){if(this.ver40||!t.readBoolean())return null;const e=new c3(t.readInt(!0));return e.start=t.readInt(!0),e.digits=t.readInt(!0),e.setupIndex=t.readInt(!0),e}readDeformTimelineType(t){return this.ver40?p4:t.readByte()}readVertices(t,e){const n=this.scale,r=e<<1,i=new X5;if(!t.readBoolean())return i.vertices=this.readFloatArray(t,r,n),i;const s=new Array,o=new Array;for(let a=0;a<e;a++){const e=t.readInt(!0);o.push(e);for(let r=0;r<e;r++)o.push(t.readInt(!0)),s.push(t.readFloat()*n),s.push(t.readFloat()*n),s.push(t.readFloat())}return i.vertices=JQ.toFloatArray(s),i.bones=o,i}readFloatArray(t,e,n){const r=new Array(e);if(1==n)for(let i=0;i<e;i++)r[i]=t.readFloat();else for(let i=0;i<e;i++)r[i]=t.readFloat()*n;return r}readShortArray(t){const e=t.readInt(!0),n=new Array(e);for(let r=0;r<e;r++)n[r]=t.readShort();return n}readAnimation(t,e,n){t.readInt(!0);const r=new Array,i=this.scale;for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0);for(let n=0,i=t.readInt(!0);n<i;n++){const n=t.readByte(),i=t.readInt(!0),s=i-1;switch(n){case l4:{const n=new J3(i,e);for(let e=0;e<i;e++)n.setFrame(e,t.readFloat(),t.readStringRef());r.push(n);break}case c4:{const n=t.readInt(!0),o=new Y3(i,n,e);let a=t.readFloat(),l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,l,c,h,u),e!=s;e++){const n=t.readFloat(),i=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;switch(t.readByte()){case b4:o.setStepped(e);break;case x4:Z5(t,o,r++,e,0,a,n,l,i,1),Z5(t,o,r++,e,1,a,n,c,s,1),Z5(t,o,r++,e,2,a,n,h,d,1),Z5(t,o,r++,e,3,a,n,u,f,1)}a=n,l=i,c=s,h=d,u=f}r.push(o);break}case h4:{const n=t.readInt(!0),o=new X3(i,n,e);let a=t.readFloat(),l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,l,c,h),e!=s;e++){const n=t.readFloat(),i=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255;switch(t.readByte()){case b4:o.setStepped(e);break;case x4:Z5(t,o,r++,e,0,a,n,l,i,1),Z5(t,o,r++,e,1,a,n,c,s,1),Z5(t,o,r++,e,2,a,n,h,u,1)}a=n,l=i,c=s,h=u}r.push(o);break}case u4:{const n=t.readInt(!0),o=new K3(i,n,e);let a=t.readFloat(),l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,l,c,h,u,d,f,p),e!=s;e++){const n=t.readFloat(),i=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255,y=t.readUnsignedByte()/255,b=t.readUnsignedByte()/255;switch(t.readByte()){case b4:o.setStepped(e);break;case x4:Z5(t,o,r++,e,0,a,n,l,i,1),Z5(t,o,r++,e,1,a,n,c,s,1),Z5(t,o,r++,e,2,a,n,h,m,1),Z5(t,o,r++,e,3,a,n,u,g,1),Z5(t,o,r++,e,4,a,n,d,v,1),Z5(t,o,r++,e,5,a,n,f,y,1),Z5(t,o,r++,e,6,a,n,p,b,1)}a=n,l=i,c=s,h=m,u=g,d=v,f=y,p=b}r.push(o);break}case d4:{const n=t.readInt(!0),o=new Z3(i,n,e);let a=t.readFloat(),l=t.readUnsignedByte()/255,c=t.readUnsignedByte()/255,h=t.readUnsignedByte()/255,u=t.readUnsignedByte()/255,d=t.readUnsignedByte()/255,f=t.readUnsignedByte()/255;for(let e=0,r=0;o.setFrame(e,a,l,c,h,u,d,f),e!=s;e++){const n=t.readFloat(),i=t.readUnsignedByte()/255,s=t.readUnsignedByte()/255,p=t.readUnsignedByte()/255,m=t.readUnsignedByte()/255,g=t.readUnsignedByte()/255,v=t.readUnsignedByte()/255;switch(t.readByte()){case b4:o.setStepped(e);break;case x4:Z5(t,o,r++,e,0,a,n,l,i,1),Z5(t,o,r++,e,1,a,n,c,s,1),Z5(t,o,r++,e,2,a,n,h,p,1),Z5(t,o,r++,e,3,a,n,u,m,1),Z5(t,o,r++,e,4,a,n,d,g,1),Z5(t,o,r++,e,5,a,n,f,v,1)}a=n,l=i,c=s,h=p,u=m,d=g,f=v}r.push(o);break}case f4:{const n=new q3(i,t.readInt(!0),e);let o=t.readFloat(),a=t.readUnsignedByte()/255;for(let e=0,r=0;n.setFrame(e,o,a),e!=s;e++){const i=t.readFloat(),s=t.readUnsignedByte()/255;switch(t.readByte()){case b4:n.setStepped(e);break;case x4:Z5(t,n,r++,e,0,o,i,a,s,1)}o=i,a=s}r.push(n)}}}}for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0);for(let n=0,s=t.readInt(!0);n<s;n++){const n=t.readByte(),s=t.readInt(!0),o=t.readInt(!0);switch(n){case J5:r.push(q5(t,new N3(s,o,e),1));break;case Q5:r.push(K5(t,new B3(s,o,e),i));break;case t4:r.push(q5(t,new U3(s,o,e),i));break;case e4:r.push(q5(t,new V3(s,o,e),i));break;case n4:r.push(K5(t,new j3(s,o,e),1));break;case r4:r.push(q5(t,new z3(s,o,e),1));break;case i4:r.push(q5(t,new G3(s,o,e),1));break;case s4:r.push(K5(t,new W3(s,o,e),1));break;case o4:r.push(q5(t,new H3(s,o,e),1));break;case a4:r.push(q5(t,new $3(s,o,e),1))}}}for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0),n=t.readInt(!0),s=n-1,o=new i5(n,t.readInt(!0),e);let a=t.readFloat(),l=t.readFloat(),c=t.readFloat()*i;for(let r=0,h=0;o.setFrame(r,a,l,c,t.readByte(),t.readBoolean(),t.readBoolean()),r!=s;r++){const e=t.readFloat(),n=t.readFloat(),s=t.readFloat()*i;switch(t.readByte()){case b4:o.setStepped(r);break;case x4:Z5(t,o,h++,r,0,a,e,l,n,1),Z5(t,o,h++,r,1,a,e,c,s,i)}a=e,l=n,c=s}r.push(o)}for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0),n=t.readInt(!0),i=n-1,s=new s5(n,t.readInt(!0),e);let o=t.readFloat(),a=t.readFloat(),l=t.readFloat(),c=t.readFloat(),h=t.readFloat(),u=t.readFloat(),d=t.readFloat();for(let r=0,f=0;s.setFrame(r,o,a,l,c,h,u,d),r!=i;r++){const e=t.readFloat(),n=t.readFloat(),i=t.readFloat(),p=t.readFloat(),m=t.readFloat(),g=t.readFloat(),v=t.readFloat();switch(t.readByte()){case b4:s.setStepped(r);break;case x4:Z5(t,s,f++,r,0,o,e,a,n,1),Z5(t,s,f++,r,1,o,e,l,i,1),Z5(t,s,f++,r,2,o,e,c,p,1),Z5(t,s,f++,r,3,o,e,h,m,1),Z5(t,s,f++,r,4,o,e,u,g,1),Z5(t,s,f++,r,5,o,e,d,v,1)}o=e,a=n,l=i,c=p,h=m,u=g,d=v}r.push(s)}for(let l=0,c=t.readInt(!0);l<c;l++){const e=t.readInt(!0),s=n.pathConstraints[e];for(let n=0,o=t.readInt(!0);n<o;n++)switch(t.readByte()){case g4:r.push(q5(t,new o5(t.readInt(!0),t.readInt(!0),e),s.positionMode==MQ.Fixed?i:1));break;case v4:r.push(q5(t,new a5(t.readInt(!0),t.readInt(!0),e),s.spacingMode==P5.Length||s.spacingMode==P5.Fixed?i:1));break;case y4:const n=new l5(t.readInt(!0),t.readInt(!0),e);let o=t.readFloat(),a=t.readFloat(),l=t.readFloat(),c=t.readFloat();for(let e=0,r=0,i=n.getFrameCount()-1;n.setFrame(e,o,a,l,c),e!=i;e++){const i=t.readFloat(),s=t.readFloat(),h=t.readFloat(),u=t.readFloat();switch(t.readByte()){case b4:n.setStepped(e);break;case x4:Z5(t,n,r++,e,0,o,i,a,s,1),Z5(t,n,r++,e,1,o,i,l,h,1),Z5(t,n,r++,e,2,o,i,c,u,1)}o=i,a=s,l=h,c=u}r.push(n)}}for(let l=0,c=t.readInt(!0);l<c;l++){const e=n.skins[t.readInt(!0)];for(let n=0,s=t.readInt(!0);n<s;n++){const n=t.readInt(!0);for(let s=0,o=t.readInt(!0);s<o;s++){const s=t.readStringRef();if(!s)throw new Error("attachmentName must not be null.");const o=e.getAttachment(n,s),a=this.readDeformTimelineType(t),l=t.readInt(!0),c=l-1;switch(a){case p4:{const e=o,s=e.bones,a=e.vertices,h=s?a.length/3*2:a.length,u=t.readInt(!0),d=new Q3(l,u,n,e);let f=t.readFloat();for(let n=0,r=0;;n++){let e,o=t.readInt(!0);if(0==o)e=s?JQ.newFloatArray(h):a;else{e=JQ.newFloatArray(h);const n=t.readInt(!0);if(o+=n,1==i)for(let r=n;r<o;r++)e[r]=t.readFloat();else for(let r=n;r<o;r++)e[r]=t.readFloat()*i;if(!s)for(let t=0,r=e.length;t<r;t++)e[t]+=a[t]}if(d.setFrame(n,f,e),n==c)break;const l=t.readFloat();switch(t.readByte()){case b4:d.setStepped(n);break;case x4:Z5(t,d,r++,n,0,f,l,0,1,1)}f=l}r.push(d);break}case m4:{const e=new h5(l,n,o);for(let n=0;n<l;n++){const r=t.readFloat(),i=t.readInt32();e.setFrame(n,r,u3[15&i],i>>4,t.readFloat())}r.push(e);break}}}}}const s=t.readInt(!0);if(s>0){const e=new r5(s),i=n.slots.length;for(let n=0;n<s;n++){const r=t.readFloat(),s=t.readInt(!0),o=JQ.newArray(i,0);for(let t=i-1;t>=0;t--)o[t]=-1;const a=JQ.newArray(i-s,0);let l=0,c=0;for(let e=0;e<s;e++){const e=t.readInt(!0);for(;l!=e;)a[c++]=l++;o[l+t.readInt(!0)]=l++}for(;l<i;)a[c++]=l++;for(let t=i-1;t>=0;t--)-1==o[t]&&(o[t]=a[--c]);e.setFrame(n,r,o)}r.push(e)}const o=t.readInt(!0);if(o>0){const e=new e5(o);for(let r=0;r<o;r++){const i=t.readFloat(),s=n.events[t.readInt(!0)],o=new R5(i,s);o.intValue=t.readInt(!1),o.floatValue=t.readFloat(),o.stringValue=t.readBoolean()?t.readString():s.stringValue,o.data.audioPath&&(o.volume=t.readFloat(),o.balance=t.readFloat()),e.setFrame(r,o)}r.push(e)}let a=0;for(let l=0,c=r.length;l<c;l++)a=Math.max(a,r[l].getDuration());return new d3(e,r,a)}}$5.BlendModeValues=[CW.NORMAL,CW.ADD,CW.MULTIPLY,CW.SCREEN];let Y5=class{constructor(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritTimeline=i}};class X5{constructor(t=null,e=null){this.bones=t,this.vertices=e}}function q5(t,e,n){let r=t.readFloat(),i=t.readFloat()*n;for(let s=0,o=0,a=e.getFrameCount()-1;e.setFrame(s,r,i),s!=a;s++){const a=t.readFloat(),l=t.readFloat()*n;switch(t.readByte()){case b4:e.setStepped(s);break;case x4:Z5(t,e,o++,s,0,r,a,i,l,n)}r=a,i=l}return e}function K5(t,e,n){let r=t.readFloat(),i=t.readFloat()*n,s=t.readFloat()*n;for(let o=0,a=0,l=e.getFrameCount()-1;e.setFrame(o,r,i,s),o!=l;o++){const l=t.readFloat(),c=t.readFloat()*n,h=t.readFloat()*n;switch(t.readByte()){case b4:e.setStepped(o);break;case x4:Z5(t,e,a++,o,0,r,l,i,c,n),Z5(t,e,a++,o,1,r,l,s,h,n)}r=l,i=c,s=h}return e}function Z5(t,e,n,r,i,s,o,a,l,c){e.setBezier(n,r,i,s,a,t.readFloat(),t.readFloat()*c,t.readFloat(),t.readFloat()*c,o,l)}const J5=0,Q5=1,t4=2,e4=3,n4=4,r4=5,i4=6,s4=7,o4=8,a4=9,l4=0,c4=1,h4=2,u4=3,d4=4,f4=5,p4=0,m4=1,g4=0,v4=1,y4=2,b4=1,x4=2;class w4{constructor(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}readSkeletonData(t){const e=this.scale,n=new j5,r="string"==typeof t?JSON.parse(t):t,i=r.skeleton;if(i){n.hash=i.hash,n.version=i.spine;const t=n.version.substr(0,3);if("4.0"!==t&&"4.1"!==t){i.spine}n.x=i.x,n.y=i.y,n.width=i.width,n.height=i.height,n.fps=i.fps,n.imagesPath=i.images}if(r.bones)for(let s=0;s<r.bones.length;s++){const t=r.bones[s];let i=null;const o=k4(t,"parent",null);if(null!=o&&(i=n.findBone(o),null==i))throw new Error(`Parent bone not found: ${o}`);const a=new A5(n.bones.length,t.name,i);a.length=k4(t,"length",0)*e,a.x=k4(t,"x",0)*e,a.y=k4(t,"y",0)*e,a.rotation=k4(t,"rotation",0),a.scaleX=k4(t,"scaleX",1),a.scaleY=k4(t,"scaleY",1),a.shearX=k4(t,"shearX",0),a.shearY=k4(t,"shearY",0),a.transformMode=JQ.enumValue(DQ,k4(t,"transform","Normal")),a.skinRequired=k4(t,"skin",!1);const l=k4(t,"color",null);l&&a.color.setFromString(l),n.bones.push(a)}if(r.slots)for(let s=0;s<r.slots.length;s++){const t=r.slots[s],e=n.findBone(t.bone);if(!e)throw new Error(`Couldn't find bone ${t.bone} for slot ${t.name}`);const i=new z5(n.slots.length,t.name,e),o=k4(t,"color",null);o&&i.color.setFromString(o);const a=k4(t,"dark",null);a&&(i.darkColor=HQ.fromString(a)),i.attachmentName=k4(t,"attachment",null),i.blendMode=w4.blendModeFromString(k4(t,"blend","normal")),n.slots.push(i)}if(r.ik)for(let s=0;s<r.ik.length;s++){const t=r.ik[s],i=new D5(t.name);i.order=k4(t,"order",0),i.skinRequired=k4(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],s=n.findBone(r);if(null==s)throw new Error(`IK bone not found: ${r}`);i.bones.push(s)}i.target=n.findBone(t.target),i.mix=k4(t,"mix",1),i.softness=k4(t,"softness",0)*e,i.bendDirection=k4(t,"bendPositive",!0)?1:-1,i.compress=k4(t,"compress",!1),i.stretch=k4(t,"stretch",!1),i.uniform=k4(t,"uniform",!1),n.ikConstraints.push(i)}if(r.transform)for(let s=0;s<r.transform.length;s++){const t=r.transform[s],i=new G5(t.name);i.order=k4(t,"order",0),i.skinRequired=k4(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],s=n.findBone(r);if(!s)throw new Error(`Couldn't find bone ${r} for transform constraint ${t.name}.`);i.bones.push(s)}const o=t.target,a=n.findBone(o);if(!a)throw new Error(`Couldn't find target bone ${o} for transform constraint ${t.name}.`);i.target=a,i.local=k4(t,"local",!1),i.relative=k4(t,"relative",!1),i.offsetRotation=k4(t,"rotation",0),i.offsetX=k4(t,"x",0)*e,i.offsetY=k4(t,"y",0)*e,i.offsetScaleX=k4(t,"scaleX",0),i.offsetScaleY=k4(t,"scaleY",0),i.offsetShearY=k4(t,"shearY",0),i.mixRotate=k4(t,"mixRotate",1),i.mixX=k4(t,"mixX",1),i.mixY=k4(t,"mixY",i.mixX),i.mixScaleX=k4(t,"mixScaleX",1),i.mixScaleY=k4(t,"mixScaleY",i.mixScaleX),i.mixShearY=k4(t,"mixShearY",1),n.transformConstraints.push(i)}if(r.path)for(let s=0;s<r.path.length;s++){const t=r.path[s],i=new O5(t.name);i.order=k4(t,"order",0),i.skinRequired=k4(t,"skin",!1);for(let e=0;e<t.bones.length;e++){const r=t.bones[e],s=n.findBone(r);if(!s)throw new Error(`Couldn't find bone ${r} for path constraint ${t.name}.`);i.bones.push(s)}const o=t.target,a=n.findSlot(o);if(!a)throw new Error(`Couldn't find target slot ${o} for path constraint ${t.name}.`);i.target=a,i.positionMode=JQ.enumValue(MQ,k4(t,"positionMode","Percent")),i.spacingMode=JQ.enumValue(P5,k4(t,"spacingMode","Length")),i.rotateMode=JQ.enumValue(IQ,k4(t,"rotateMode","Tangent")),i.offsetRotation=k4(t,"rotation",0),i.position=k4(t,"position",0),i.positionMode==MQ.Fixed&&(i.position*=e),i.spacing=k4(t,"spacing",0),i.spacingMode!=P5.Length&&i.spacingMode!=P5.Fixed||(i.spacing*=e),i.mixRotate=k4(t,"mixRotate",1),i.mixX=k4(t,"mixX",1),i.mixY=k4(t,"mixY",i.mixX),n.pathConstraints.push(i)}if(r.skins)for(let s=0;s<r.skins.length;s++){const t=r.skins[s],e=new H5(t.name);if(t.bones)for(let r=0;r<t.bones.length;r++){const i=t.bones[r],s=n.findBone(i);if(!s)throw new Error(`Couldn't find bone ${i} for skin ${t.name}.`);e.bones.push(s)}if(t.ik)for(let r=0;r<t.ik.length;r++){const i=t.ik[r],s=n.findIkConstraint(i);if(!s)throw new Error(`Couldn't find IK constraint ${i} for skin ${t.name}.`);e.constraints.push(s)}if(t.transform)for(let r=0;r<t.transform.length;r++){const i=t.transform[r],s=n.findTransformConstraint(i);if(!s)throw new Error(`Couldn't find transform constraint ${i} for skin ${t.name}.`);e.constraints.push(s)}if(t.path)for(let r=0;r<t.path.length;r++){const i=t.path[r],s=n.findPathConstraint(i);if(!s)throw new Error(`Couldn't find path constraint ${i} for skin ${t.name}.`);e.constraints.push(s)}for(const r in t.attachments){const i=n.findSlot(r);if(!i)throw new Error(`Couldn't find slot ${r} for skin ${t.name}.`);const s=t.attachments[r];for(const t in s){const r=this.readAttachment(s[t],e,i.index,t,n);r&&e.setAttachment(i.index,t,r)}}n.skins.push(e),"default"==e.name&&(n.defaultSkin=e)}for(let s=0,o=this.linkedMeshes.length;s<o;s++){const t=this.linkedMeshes[s],e=t.skin?n.findSkin(t.skin):n.defaultSkin;if(!e)throw new Error(`Skin not found: ${t.skin}`);const r=e.getAttachment(t.slotIndex,t.parent);if(!r)throw new Error(`Parent mesh not found: ${t.parent}`);t.mesh.timelineAttachment=t.inheritTimeline?r:t.mesh,t.mesh.setParentMesh(r)}if(this.linkedMeshes.length=0,r.events)for(const s in r.events){const t=r.events[s],e=new M5(s);e.intValue=k4(t,"int",0),e.floatValue=k4(t,"float",0),e.stringValue=k4(t,"string",""),e.audioPath=k4(t,"audio",null),e.audioPath&&(e.volume=k4(t,"volume",1),e.balance=k4(t,"balance",0)),n.events.push(e)}if(r.animations)for(const s in r.animations){const t=r.animations[s];this.readAnimation(t,s,n)}return n}readAttachment(t,e,n,r,i){const s=this.scale;switch(r=k4(t,"name",r),k4(t,"type","region")){case"region":{const n=k4(t,"path",r),i=this.readSequence(k4(t,"sequence",null)),o=this.attachmentLoader.newRegionAttachment(e,r,n,i);if(!o)return null;o.path=n,o.x=k4(t,"x",0)*s,o.y=k4(t,"y",0)*s,o.scaleX=k4(t,"scaleX",1),o.scaleY=k4(t,"scaleY",1),o.rotation=k4(t,"rotation",0),o.width=t.width*s,o.height=t.height*s,o.sequence=i;const a=k4(t,"color",null);return a&&o.color.setFromString(a),o}case"boundingbox":{const n=this.attachmentLoader.newBoundingBoxAttachment(e,r);if(!n)return null;this.readVertices(t,n,t.vertexCount<<1);const i=k4(t,"color",null);return i&&n.color.setFromString(i),n}case"mesh":case"linkedmesh":{const i=k4(t,"path",r),o=this.readSequence(k4(t,"sequence",null)),a=this.attachmentLoader.newMeshAttachment(e,r,i,o);if(!a)return null;a.path=i;const l=k4(t,"color",null);l&&a.color.setFromString(l),a.width=k4(t,"width",0)*s,a.height=k4(t,"height",0)*s,a.sequence=o;const c=k4(t,"parent",null);if(c)return this.linkedMeshes.push(new E4(a,k4(t,"skin",null),n,c,k4(t,"timelines",!0))),a;const h=t.uvs;return this.readVertices(t,a,h.length),a.triangles=t.triangles,a.regionUVs=new Float32Array(h),a.edges=k4(t,"edges",null),a.hullLength=2*k4(t,"hull",0),a}case"path":{const n=this.attachmentLoader.newPathAttachment(e,r);if(!n)return null;n.closed=k4(t,"closed",!1),n.constantSpeed=k4(t,"constantSpeed",!0);const i=t.vertexCount;this.readVertices(t,n,i<<1);const o=JQ.newArray(i/3,0);for(let e=0;e<t.lengths.length;e++)o[e]=t.lengths[e]*s;n.lengths=o;const a=k4(t,"color",null);return a&&n.color.setFromString(a),n}case"point":{const n=this.attachmentLoader.newPointAttachment(e,r);if(!n)return null;n.x=k4(t,"x",0)*s,n.y=k4(t,"y",0)*s,n.rotation=k4(t,"rotation",0);const i=k4(t,"color",null);return i&&n.color.setFromString(i),n}case"clipping":{const n=this.attachmentLoader.newClippingAttachment(e,r);if(!n)return null;const s=k4(t,"end",null);if(null!=s){const t=i.findSlot(s);if(null==t)throw new Error(`Clipping end slot not found: ${s}`);n.endSlot=t}const o=t.vertexCount;this.readVertices(t,n,o<<1);const a=k4(t,"color",null);return a&&n.color.setFromString(a),n}}return null}readSequence(t){if(null==t)return null;const e=new c3(k4(t,"count",0));return e.start=k4(t,"start",1),e.digits=k4(t,"digits",0),e.setupIndex=k4(t,"setup",0),e}readVertices(t,e,n){const r=this.scale;e.worldVerticesLength=n;const i=t.vertices;if(n==i.length){const t=JQ.toFloatArray(i);if(1!=r)for(let e=0,n=i.length;e<n;e++)t[e]*=r;return void(e.vertices=t)}const s=new Array,o=new Array;for(let a=0,l=i.length;a<l;){const t=i[a++];o.push(t);for(let e=a+4*t;a<e;a+=4)o.push(i[a]),s.push(i[a+1]*r),s.push(i[a+2]*r),s.push(i[a+3])}e.bones=o,e.vertices=JQ.toFloatArray(s)}readAnimation(t,e,n){const r=this.scale,i=new Array;if(t.slots)for(const o in t.slots){const e=t.slots[o],r=n.findSlot(o);if(!r)throw new Error(`Slot not found: ${o}`);const s=r.index;for(const t in e){const n=e[t];if(!n)continue;const r=n.length;if("attachment"==t){const t=new J3(r,s);for(let e=0;e<r;e++){const r=n[e];t.setFrame(e,k4(r,"time",0),k4(r,"name",null))}i.push(t)}else if("rgba"==t){const t=new Y3(r,r<<2,s);let e=n[0],o=k4(e,"time",0),a=HQ.fromString(e.color);for(let r=0,i=0;;r++){t.setFrame(r,o,a.r,a.g,a.b,a.a);const s=n[r+1];if(!s){t.shrink(i);break}const l=k4(s,"time",0),c=HQ.fromString(s.color),h=e.curve;h&&(i=T4(h,t,i,r,0,o,l,a.r,c.r,1),i=T4(h,t,i,r,1,o,l,a.g,c.g,1),i=T4(h,t,i,r,2,o,l,a.b,c.b,1),i=T4(h,t,i,r,3,o,l,a.a,c.a,1)),o=l,a=c,e=s}i.push(t)}else if("rgb"==t){const t=new X3(r,3*r,s);let e=n[0],o=k4(e,"time",0),a=HQ.fromString(e.color);for(let r=0,i=0;;r++){t.setFrame(r,o,a.r,a.g,a.b);const s=n[r+1];if(!s){t.shrink(i);break}const l=k4(s,"time",0),c=HQ.fromString(s.color),h=e.curve;h&&(i=T4(h,t,i,r,0,o,l,a.r,c.r,1),i=T4(h,t,i,r,1,o,l,a.g,c.g,1),i=T4(h,t,i,r,2,o,l,a.b,c.b,1)),o=l,a=c,e=s}i.push(t)}else if("alpha"==t)i.push(_4(n,new q3(r,r,s),0,1));else if("rgba2"==t){const t=new K3(r,7*r,s);let e=n[0],o=k4(e,"time",0),a=HQ.fromString(e.light),l=HQ.fromString(e.dark);for(let r=0,i=0;;r++){t.setFrame(r,o,a.r,a.g,a.b,a.a,l.r,l.g,l.b);const s=n[r+1];if(!s){t.shrink(i);break}const c=k4(s,"time",0),h=HQ.fromString(s.light),u=HQ.fromString(s.dark),d=e.curve;d&&(i=T4(d,t,i,r,0,o,c,a.r,h.r,1),i=T4(d,t,i,r,1,o,c,a.g,h.g,1),i=T4(d,t,i,r,2,o,c,a.b,h.b,1),i=T4(d,t,i,r,3,o,c,a.a,h.a,1),i=T4(d,t,i,r,4,o,c,l.r,u.r,1),i=T4(d,t,i,r,5,o,c,l.g,u.g,1),i=T4(d,t,i,r,6,o,c,l.b,u.b,1)),o=c,a=h,l=u,e=s}i.push(t)}else if("rgb2"==t){const t=new Z3(r,6*r,s);let e=n[0],o=k4(e,"time",0),a=HQ.fromString(e.light),l=HQ.fromString(e.dark);for(let r=0,i=0;;r++){t.setFrame(r,o,a.r,a.g,a.b,l.r,l.g,l.b);const s=n[r+1];if(!s){t.shrink(i);break}const c=k4(s,"time",0),h=HQ.fromString(s.light),u=HQ.fromString(s.dark),d=e.curve;d&&(i=T4(d,t,i,r,0,o,c,a.r,h.r,1),i=T4(d,t,i,r,1,o,c,a.g,h.g,1),i=T4(d,t,i,r,2,o,c,a.b,h.b,1),i=T4(d,t,i,r,3,o,c,l.r,u.r,1),i=T4(d,t,i,r,4,o,c,l.g,u.g,1),i=T4(d,t,i,r,5,o,c,l.b,u.b,1)),o=c,a=h,l=u,e=s}i.push(t)}}}if(t.bones)for(const o in t.bones){const e=t.bones[o],s=n.findBone(o);if(!s)throw new Error(`Bone not found: ${o}`);const a=s.index;for(const t in e){const n=e[t],s=n.length;if(0!=s)if("rotate"===t)i.push(_4(n,new N3(s,s,a),0,1));else if("translate"===t){const t=new B3(s,s<<1,a);i.push(S4(n,t,"x","y",0,r))}else if("translatex"===t){const t=new U3(s,s,a);i.push(_4(n,t,0,r))}else if("translatey"===t){const t=new V3(s,s,a);i.push(_4(n,t,0,r))}else if("scale"===t){const t=new j3(s,s<<1,a);i.push(S4(n,t,"x","y",1,1))}else if("scalex"===t){const t=new z3(s,s,a);i.push(_4(n,t,1,1))}else if("scaley"===t){const t=new G3(s,s,a);i.push(_4(n,t,1,1))}else if("shear"===t){const t=new W3(s,s<<1,a);i.push(S4(n,t,"x","y",0,1))}else if("shearx"===t){const t=new H3(s,s,a);i.push(_4(n,t,0,1))}else if("sheary"===t){const t=new $3(s,s,a);i.push(_4(n,t,0,1))}}}if(t.ik)for(const o in t.ik){const e=t.ik[o];let s=e[0];if(!s)continue;const a=n.findIkConstraint(o);if(!a)throw new Error(`IK Constraint not found: ${o}`);const l=n.ikConstraints.indexOf(a),c=new i5(e.length,e.length<<1,l);let h=k4(s,"time",0),u=k4(s,"mix",1),d=k4(s,"softness",0)*r;for(let t=0,n=0;;t++){c.setFrame(t,h,u,d,k4(s,"bendPositive",!0)?1:-1,k4(s,"compress",!1),k4(s,"stretch",!1));const i=e[t+1];if(!i){c.shrink(n);break}const o=k4(i,"time",0),a=k4(i,"mix",1),l=k4(i,"softness",0)*r,f=s.curve;f&&(n=T4(f,c,n,t,0,h,o,u,a,1),n=T4(f,c,n,t,1,h,o,d,l,r)),h=o,u=a,d=l,s=i}i.push(c)}if(t.transform)for(const o in t.transform){const e=t.transform[o];let r=e[0];if(!r)continue;const s=n.findTransformConstraint(o);if(!s)throw new Error(`Transform constraint not found: ${o}`);const a=n.transformConstraints.indexOf(s),l=new s5(e.length,6*e.length,a);let c=k4(r,"time",0),h=k4(r,"mixRotate",1),u=k4(r,"mixX",1),d=k4(r,"mixY",u),f=k4(r,"mixScaleX",1),p=k4(r,"mixScaleY",f);const m=k4(r,"mixShearY",1);for(let t=0,n=0;;t++){l.setFrame(t,c,h,u,d,f,p,m);const i=e[t+1];if(!i){l.shrink(n);break}const s=k4(i,"time",0),o=k4(i,"mixRotate",1),a=k4(i,"mixX",1),g=k4(i,"mixY",a),v=k4(i,"mixScaleX",1),y=k4(i,"mixScaleY",v),b=k4(i,"mixShearY",1),x=r.curve;x&&(n=T4(x,l,n,t,0,c,s,h,o,1),n=T4(x,l,n,t,1,c,s,u,a,1),n=T4(x,l,n,t,2,c,s,d,g,1),n=T4(x,l,n,t,3,c,s,f,v,1),n=T4(x,l,n,t,4,c,s,p,y,1),n=T4(x,l,n,t,5,c,s,m,b,1)),c=s,h=o,u=a,d=g,f=v,p=y,f=v,r=i}i.push(l)}if(t.path)for(const o in t.path){const e=t.path[o],s=n.findPathConstraint(o);if(!s)throw new Error(`Path constraint not found: ${o}`);const a=n.pathConstraints.indexOf(s);for(const t in e){const n=e[t];let o=n[0];if(!o)continue;const l=n.length;if("position"===t){const t=new o5(l,l,a);i.push(_4(n,t,0,s.positionMode==MQ.Fixed?r:1))}else if("spacing"===t){const t=new a5(l,l,a);i.push(_4(n,t,0,s.spacingMode==P5.Length||s.spacingMode==P5.Fixed?r:1))}else if("mix"===t){const t=new l5(l,3*l,a);let e=k4(o,"time",0),r=k4(o,"mixRotate",1),s=k4(o,"mixX",1),c=k4(o,"mixY",s);for(let i=0,a=0;;i++){t.setFrame(i,e,r,s,c);const l=n[i+1];if(!l){t.shrink(a);break}const h=k4(l,"time",0),u=k4(l,"mixRotate",1),d=k4(l,"mixX",1),f=k4(l,"mixY",d),p=o.curve;p&&(a=T4(p,t,a,i,0,e,h,r,u,1),a=T4(p,t,a,i,1,e,h,s,d,1),a=T4(p,t,a,i,2,e,h,c,f,1)),e=h,r=u,s=d,c=f,o=l}i.push(t)}}}if(t.deform){t.attachments={};for(const e in t.deform){const n=t.deform[e],r=t.attachments[e]={};for(const t in n){const e=n[t],i=r[t]={};for(const t in e)i[t]={deform:e[t]}}}}if(t.attachments)for(const o in t.attachments){const e=t.attachments[o],s=n.findSkin(o);if(null!=s)for(const t in e){const o=e[t],a=n.findSlot(t);if(!a)throw new Error(`Slot not found: ${t}`);const l=a.index;for(const t in o){const e=o[t],n=s.getAttachment(l,t);for(const t in e){const s=e[t];let o=s[0];if(o)if("deform"==t){const t=n.bones,e=n.vertices,a=t?e.length/3*2:e.length,c=new Q3(s.length,s.length,l,n);let h=k4(o,"time",0);for(let n=0,i=0;;n++){let l;const u=k4(o,"vertices",null);if(u){l=JQ.newFloatArray(a);const n=k4(o,"offset",0);if(JQ.arrayCopy(u,0,l,n,u.length),1!=r)for(let t=n,e=t+u.length;t<e;t++)l[t]*=r;if(!t)for(let t=0;t<a;t++)l[t]+=e[t]}else l=t?JQ.newFloatArray(a):e;c.setFrame(n,h,l);const d=s[n+1];if(!d){c.shrink(i);break}const f=k4(d,"time",0),p=o.curve;p&&(i=T4(p,c,i,n,0,h,f,0,1,1)),h=f,o=d}i.push(c)}else if("sequence"==t){const t=new h5(s.length,l,n);let e=0;for(let n=0;n<s.length;n++){const r=k4(o,"delay",e),i=k4(o,"time",0),a=h3[k4(o,"mode","hold")],l=k4(o,"index",0);t.setFrame(n,i,a,l,r),e=r,o=s[n+1]}i.push(t)}}}}}if(t.drawOrder){const e=new r5(t.drawOrder.length),r=n.slots.length;let s=0;for(let i=0;i<t.drawOrder.length;i++,s++){const o=t.drawOrder[i];let a=null;const l=k4(o,"offsets",null);if(l){a=JQ.newArray(r,-1);const t=JQ.newArray(r-l.length,0);let e=0,i=0;for(let r=0;r<l.length;r++){const s=l[r],o=n.findSlot(s.slot);if(!o)throw new Error(`Slot not found: ${o}`);const c=o.index;for(;e!=c;)t[i++]=e++;a[e+s.offset]=e++}for(;e<r;)t[i++]=e++;for(let n=r-1;n>=0;n--)-1==a[n]&&(a[n]=t[--i])}e.setFrame(s,k4(o,"time",0),a)}i.push(e)}if(t.events){const e=new e5(t.events.length);let r=0;for(let i=0;i<t.events.length;i++,r++){const s=t.events[i],o=n.findEvent(s.name);if(!o)throw new Error(`Event not found: ${s.name}`);const a=new R5(JQ.toSinglePrecision(k4(s,"time",0)),o);a.intValue=k4(s,"int",o.intValue),a.floatValue=k4(s,"float",o.floatValue),a.stringValue=k4(s,"string",o.stringValue),a.data.audioPath&&(a.volume=k4(s,"volume",1),a.balance=k4(s,"balance",0)),e.setFrame(r,a)}i.push(e)}let s=0;for(let o=0,a=i.length;o<a;o++)s=Math.max(s,i[o].getDuration());if(isNaN(s))throw new Error("Error while parsing animation, duration is NaN");n.animations.push(new d3(e,i,s))}static blendModeFromString(t){if("normal"==(t=t.toLowerCase()))return CW.NORMAL;if("additive"==t)return CW.ADD;if("multiply"==t)return CW.MULTIPLY;if("screen"==t)return CW.SCREEN;throw new Error(`Unknown blend mode: ${t}`)}}class E4{constructor(t,e,n,r,i){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=r,this.inheritTimeline=i}}function _4(t,e,n,r){let i=t[0],s=k4(i,"time",0),o=k4(i,"value",n)*r,a=0;for(let l=0;;l++){e.setFrame(l,s,o);const c=t[l+1];if(!c)return e.shrink(a),e;const h=k4(c,"time",0),u=k4(c,"value",n)*r;i.curve&&(a=T4(i.curve,e,a,l,0,s,h,o,u,r)),s=h,o=u,i=c}}function S4(t,e,n,r,i,s){let o=t[0],a=k4(o,"time",0),l=k4(o,n,i)*s,c=k4(o,r,i)*s,h=0;for(let u=0;;u++){e.setFrame(u,a,l,c);const d=t[u+1];if(!d)return e.shrink(h),e;const f=k4(d,"time",0),p=k4(d,n,i)*s,m=k4(d,r,i)*s,g=o.curve;g&&(h=T4(g,e,h,u,0,a,f,l,p,s),h=T4(g,e,h,u,1,a,f,c,m,s)),a=f,l=p,c=m,o=d}}function T4(t,e,n,r,i,s,o,a,l,c){if("stepped"==t)return e.setStepped(r),n;const h=i<<2,u=t[h],d=t[h+1]*c,f=t[h+2],p=t[h+3]*c;return e.setBezier(n,r,i,s,a,u,d,f,p,o,l),n+1}function k4(t,e,n){return void 0!==t[e]?t[e]:n}const A4=Object.freeze(Object.defineProperty({__proto__:null,AlphaTimeline:q3,Animation:d3,AnimationState:d5,AnimationStateAdapter:class{start(t){}interrupt(t){}end(t){}dispose(t){}complete(t){}event(t,e){}},AnimationStateData:S5,AtlasAttachmentLoader:T5,Attachment:J2,AttachmentTimeline:J3,Bone:k5,BoneData:A5,BoundingBoxAttachment:e3,ClippingAttachment:n3,ConstraintData:C5,CurveTimeline:P3,CurveTimeline1:L3,CurveTimeline2:F3,DeformTimeline:Q3,DrawOrderTimeline:r5,Event:R5,EventData:M5,EventQueue:m5,EventTimeline:e5,EventType:g5,IkConstraint:I5,IkConstraintData:D5,IkConstraintTimeline:i5,MeshAttachment:r3,PathAttachment:i3,PathConstraint:F5,PathConstraintData:O5,PathConstraintMixTimeline:l5,PathConstraintPositionTimeline:o5,PathConstraintSpacingTimeline:a5,PointAttachment:s3,RGB2Timeline:Z3,RGBA2Timeline:K3,RGBATimeline:Y3,RGBTimeline:X3,RegionAttachment:a3,RotateTimeline:N3,ScaleTimeline:j3,ScaleXTimeline:z3,ScaleYTimeline:G3,Sequence:c3,SequenceMode:h3,SequenceModeValues:u3,SequenceTimeline:h5,ShearTimeline:W3,ShearXTimeline:H3,ShearYTimeline:$3,Skeleton:V5,SkeletonBinary:$5,SkeletonBounds:class extends e0{},SkeletonData:j5,SkeletonJson:w4,Skin:H5,SkinEntry:W5,Slot:N5,SlotData:z5,SpacingMode:P5,Spine:class extends a0{createSkeleton(t){this.skeleton=new V5(t),this.skeleton.updateWorldTransform(),this.stateData=new S5(t),this.state=new d5(this.stateData)}},Timeline:O3,TrackEntry:p5,TransformConstraint:B5,TransformConstraintData:G5,TransformConstraintTimeline:s5,TranslateTimeline:B3,TranslateXTimeline:U3,TranslateYTimeline:V3,VertexAttachment:t3},Symbol.toStringTag,{value:"Module"}));var C4=(t=>(t[t.UNKNOWN=0]="UNKNOWN",t[t.VER37=37]="VER37",t[t.VER38=38]="VER38",t[t.VER40=40]="VER40",t[t.VER41=41]="VER41",t))(C4||{});function R4(t){const e=t.substr(0,3),n=Math.floor(10*Number(e)+.001);return"3.7"===e?37:"3.8"===e?38:"4.0"===e?40:"4.1"===e?41:n<37?37:0}class M4{constructor(){this.scale=1}readSkeletonData(t,e){let n=null,r=this.readVersionOldFormat(e),i=R4(r);if(i===C4.VER38&&(n=new R1(new l1(t))),r=this.readVersionNewFormat(e),i=R4(r),i!==C4.VER40&&i!==C4.VER41||(n=new $5(new T5(t))),!n){}return n.scale=this.scale,n.readSkeletonData(e)}readVersionOldFormat(t){const e=new AQ(t);let n;try{e.readString(),n=e.readString()}catch(Ni){n=""}return n||""}readVersionNewFormat(t){const e=new AQ(t);let n;e.readInt32(),e.readInt32();try{n=e.readString()}catch(Ni){n=""}return n||""}}class I4{constructor(){this.scale=1}readSkeletonData(t,e){const n=e.skeleton.spine,r=R4(n);let i=null;if(r===C4.VER37&&(i=new q2(new I2(t))),r===C4.VER38&&(i=new D1(new l1(t))),r!==C4.VER40&&r!==C4.VER41||(i=new w4(new T5(t))),!i){}return i.scale=this.scale,i.readSkeletonData(e)}}class D4 extends a0{createSkeleton(t){const e=R4(t.version);let n=null;if(e===C4.VER37&&(n=Z2),e===C4.VER38&&(n=P1),e!==C4.VER40&&e!==C4.VER41||(n=A4),!n){t.version}this.skeleton=new n.Skeleton(t),this.skeleton.updateWorldTransform(),this.stateData=new n.AnimationStateData(t),this.state=new n.AnimationState(this.stateData)}}(new class extends u0{createBinaryParser(){return new M4}createJsonParser(){return new I4}parseData(t,e,n){return{spineData:t.readSkeletonData(e,n),spineAtlas:e}}}).installLoader();var O4,P4={},L4={exports:{}};O4=function(){return function(){var t={686:function(t,e,n){n.d(e,{default:function(){return E}});var r=n(279),i=n.n(r),s=n(370),o=n.n(s),a=n(817),l=n.n(a);function c(t){try{return document.execCommand(t)}catch(e){return!1}}var h=function(t){var e=l()(t);return c("cut"),e},u=function(t,e){var n=function(t){var e="rtl"===document.documentElement.getAttribute("dir"),n=document.createElement("textarea");n.style.fontSize="12pt",n.style.border="0",n.style.padding="0",n.style.margin="0",n.style.position="absolute",n.style[e?"right":"left"]="-9999px";var r=window.pageYOffset||document.documentElement.scrollTop;return n.style.top="".concat(r,"px"),n.setAttribute("readonly",""),n.value=t,n}(t);e.container.appendChild(n);var r=l()(n);return c("copy"),n.remove(),r},d=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body},n="";return"string"==typeof t?n=u(t,e):t instanceof HTMLInputElement&&!["text","search","url","tel","password"].includes(null==t?void 0:t.type)?n=u(t.value,e):(n=l()(t),c("copy")),n};function f(t){return(f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var p=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.action,n=void 0===e?"copy":e,r=t.container,i=t.target,s=t.text;if("copy"!==n&&"cut"!==n)throw new Error('Invalid "action" value, use either "copy" or "cut"');if(void 0!==i){if(!i||"object"!==f(i)||1!==i.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===n&&i.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===n&&(i.hasAttribute("readonly")||i.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes')}return s?d(s,{container:r}):i?"cut"===n?h(i):d(i,{container:r}):void 0};function m(t){return(m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function g(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function v(t,e){return(v=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function y(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(Ni){return!1}}();return function(){var n,r,i,s=b(t);if(e){var o=b(this).constructor;n=Reflect.construct(s,arguments,o)}else n=s.apply(this,arguments);return r=this,!(i=n)||"object"!==m(i)&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r):i}}function b(t){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function x(t,e){var n="data-clipboard-".concat(t);if(e.hasAttribute(n))return e.getAttribute(n)}var w=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&v(t,e)}(s,t);var e,n,r,i=y(s);function s(t,e){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(n=i.call(this)).resolveOptions(e),n.listenClick(t),n}return e=s,n=[{key:"resolveOptions",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.action="function"==typeof t.action?t.action:this.defaultAction,this.target="function"==typeof t.target?t.target:this.defaultTarget,this.text="function"==typeof t.text?t.text:this.defaultText,this.container="object"===m(t.container)?t.container:document.body}},{key:"listenClick",value:function(t){var e=this;this.listener=o()(t,"click",(function(t){return e.onClick(t)}))}},{key:"onClick",value:function(t){var e=t.delegateTarget||t.currentTarget,n=this.action(e)||"copy",r=p({action:n,container:this.container,target:this.target(e),text:this.text(e)});this.emit(r?"success":"error",{action:n,text:r,trigger:e,clearSelection:function(){e&&e.focus(),window.getSelection().removeAllRanges()}})}},{key:"defaultAction",value:function(t){return x("action",t)}},{key:"defaultTarget",value:function(t){var e=x("target",t);if(e)return document.querySelector(e)}},{key:"defaultText",value:function(t){return x("text",t)}},{key:"destroy",value:function(){this.listener.destroy()}}],r=[{key:"copy",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{container:document.body};return d(t,e)}},{key:"cut",value:function(t){return h(t)}},{key:"isSupported",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["copy","cut"],e="string"==typeof t?[t]:t,n=!!document.queryCommandSupported;return e.forEach((function(t){n=n&&!!document.queryCommandSupported(t)})),n}}],n&&g(e.prototype,n),r&&g(e,r),s}(i()),E=w},828:function(t){if("undefined"!=typeof Element&&!Element.prototype.matches){var e=Element.prototype;e.matches=e.matchesSelector||e.mozMatchesSelector||e.msMatchesSelector||e.oMatchesSelector||e.webkitMatchesSelector}t.exports=function(t,e){for(;t&&9!==t.nodeType;){if("function"==typeof t.matches&&t.matches(e))return t;t=t.parentNode}}},438:function(t,e,n){var r=n(828);function i(t,e,n,r,i){var o=s.apply(this,arguments);return t.addEventListener(n,o,i),{destroy:function(){t.removeEventListener(n,o,i)}}}function s(t,e,n,i){return function(n){n.delegateTarget=r(n.target,e),n.delegateTarget&&i.call(t,n)}}t.exports=function(t,e,n,r,s){return"function"==typeof t.addEventListener?i.apply(null,arguments):"function"==typeof n?i.bind(null,document).apply(null,arguments):("string"==typeof t&&(t=document.querySelectorAll(t)),Array.prototype.map.call(t,(function(t){return i(t,e,n,r,s)})))}},879:function(t,e){e.node=function(t){return void 0!==t&&t instanceof HTMLElement&&1===t.nodeType},e.nodeList=function(t){var n=Object.prototype.toString.call(t);return void 0!==t&&("[object NodeList]"===n||"[object HTMLCollection]"===n)&&"length"in t&&(0===t.length||e.node(t[0]))},e.string=function(t){return"string"==typeof t||t instanceof String},e.fn=function(t){return"[object Function]"===Object.prototype.toString.call(t)}},370:function(t,e,n){var r=n(879),i=n(438);t.exports=function(t,e,n){if(!t&&!e&&!n)throw new Error("Missing required arguments");if(!r.string(e))throw new TypeError("Second argument must be a String");if(!r.fn(n))throw new TypeError("Third argument must be a Function");if(r.node(t))return function(t,e,n){return t.addEventListener(e,n),{destroy:function(){t.removeEventListener(e,n)}}}(t,e,n);if(r.nodeList(t))return function(t,e,n){return Array.prototype.forEach.call(t,(function(t){t.addEventListener(e,n)})),{destroy:function(){Array.prototype.forEach.call(t,(function(t){t.removeEventListener(e,n)}))}}}(t,e,n);if(r.string(t))return function(t,e,n){return i(document.body,t,e,n)}(t,e,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},817:function(t){t.exports=function(t){var e;if("SELECT"===t.nodeName)t.focus(),e=t.value;else if("INPUT"===t.nodeName||"TEXTAREA"===t.nodeName){var n=t.hasAttribute("readonly");n||t.setAttribute("readonly",""),t.select(),t.setSelectionRange(0,t.value.length),n||t.removeAttribute("readonly"),e=t.value}else{t.hasAttribute("contenteditable")&&t.focus();var r=window.getSelection(),i=document.createRange();i.selectNodeContents(t),r.removeAllRanges(),r.addRange(i),e=r.toString()}return e}},279:function(t){function e(){}e.prototype={on:function(t,e,n){var r=this.e||(this.e={});return(r[t]||(r[t]=[])).push({fn:e,ctx:n}),this},once:function(t,e,n){var r=this;function i(){r.off(t,i),e.apply(n,arguments)}return i._=e,this.on(t,i,n)},emit:function(t){for(var e=[].slice.call(arguments,1),n=((this.e||(this.e={}))[t]||[]).slice(),r=0,i=n.length;r<i;r++)n[r].fn.apply(n[r].ctx,e);return this},off:function(t,e){var n=this.e||(this.e={}),r=n[t],i=[];if(r&&e)for(var s=0,o=r.length;s<o;s++)r[s].fn!==e&&r[s].fn._!==e&&i.push(r[s]);return i.length?n[t]=i:delete n[t],this}},t.exports=e,t.exports.TinyEmitter=e}},e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}return n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,{a:e}),e},n.d=function(t,e){for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n(686)}().default};var F4=L4.exports=O4(),N4=ei&&ei.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(P4,"__esModule",{value:!0});var B4=N4(F4),U4=P4.default=function(t){var e=void 0===(null==t?void 0:t.appendToBody)||t.appendToBody;return{toClipboard:function(t,n){return new Promise((function(r,i){var s=document.createElement("button"),o=new B4.default(s,{text:function(){return t},action:function(){return"copy"},container:void 0!==n?n:document.body});o.on("success",(function(t){o.destroy(),r(t)})),o.on("error",(function(t){o.destroy(),i(t)})),e&&document.body.appendChild(s),s.click(),e&&document.body.removeChild(s)}))}}},V4=Object.defineProperty,j4=Object.defineProperties,z4=Object.getOwnPropertyDescriptors,G4=Object.getOwnPropertySymbols,W4=Object.prototype.hasOwnProperty,H4=Object.prototype.propertyIsEnumerable,$4=(t,e,n)=>e in t?V4(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Y4=(t,e)=>{for(var n in e||(e={}))W4.call(e,n)&&$4(t,n,e[n]);if(G4)for(var n of G4(e))H4.call(e,n)&&$4(t,n,e[n]);return t},X4=(t,e)=>j4(t,z4(e));function q4(t,e,n,r){var i,s=!1,o=0;function a(){i&&clearTimeout(i)}function l(){for(var l=arguments.length,c=new Array(l),h=0;h<l;h++)c[h]=arguments[h];var u=this,d=Date.now()-o;function f(){o=Date.now(),n.apply(u,c)}s||(r&&!i&&f(),a(),void 0===r&&d>t?f():!0!==e&&(i=setTimeout(r?function(){i=void 0}:f,void 0===r?t-d:t)))}return"boolean"!=typeof e&&(r=n,n=e,e=void 0),l.cancel=function(){a(),s=!0},l}function K4(t,e,n){return void 0===n?q4(t,e,!1):q4(t,n,!1!==e)}var Z4={exports:{}};"undefined"!=typeof window&&(Z4.exports=function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/dist/",n(n.s="./src/hls.ts")}({"./node_modules/eventemitter3/index.js":function(t,e,n){var r=Object.prototype.hasOwnProperty,i="~";function s(){}function o(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function a(t,e,n,r,s){if("function"!=typeof n)throw new TypeError("The listener must be a function");var a=new o(n,r||t,s),l=i?i+e:e;return t._events[l]?t._events[l].fn?t._events[l]=[t._events[l],a]:t._events[l].push(a):(t._events[l]=a,t._eventsCount++),t}function l(t,e){0==--t._eventsCount?t._events=new s:delete t._events[e]}function c(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),(new s).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,s=n.length,o=new Array(s);r<s;r++)o[r]=n[r].fn;return o},c.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,r,s,o){var a=i?i+t:t;if(!this._events[a])return!1;var l,c,h=this._events[a],u=arguments.length;if(h.fn){switch(h.once&&this.removeListener(t,h.fn,void 0,!0),u){case 1:return h.fn.call(h.context),!0;case 2:return h.fn.call(h.context,e),!0;case 3:return h.fn.call(h.context,e,n),!0;case 4:return h.fn.call(h.context,e,n,r),!0;case 5:return h.fn.call(h.context,e,n,r,s),!0;case 6:return h.fn.call(h.context,e,n,r,s,o),!0}for(c=1,l=new Array(u-1);c<u;c++)l[c-1]=arguments[c];h.fn.apply(h.context,l)}else{var d,f=h.length;for(c=0;c<f;c++)switch(h[c].once&&this.removeListener(t,h[c].fn,void 0,!0),u){case 1:h[c].fn.call(h[c].context);break;case 2:h[c].fn.call(h[c].context,e);break;case 3:h[c].fn.call(h[c].context,e,n);break;case 4:h[c].fn.call(h[c].context,e,n,r);break;default:if(!l)for(d=1,l=new Array(u-1);d<u;d++)l[d-1]=arguments[d];h[c].fn.apply(h[c].context,l)}}return!0},c.prototype.on=function(t,e,n){return a(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return a(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var s=i?i+t:t;if(!this._events[s])return this;if(!e)return l(this,s),this;var o=this._events[s];if(o.fn)o.fn!==e||r&&!o.once||n&&o.context!==n||l(this,s);else{for(var a=0,c=[],h=o.length;a<h;a++)(o[a].fn!==e||r&&!o[a].once||n&&o[a].context!==n)&&c.push(o[a]);c.length?this._events[s]=1===c.length?c[0]:c:l(this,s)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&l(this,e)):(this._events=new s,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},"./node_modules/url-toolkit/src/url-toolkit.js":function(t,e,n){var r,i,s,o,a;r=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/?#]*\/)*[^;?#]*)?(;[^?#]*)?(\?[^#]*)?(#[^]*)?$/,i=/^([^\/?#]*)([^]*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,a={buildAbsoluteURL:function(t,e,n){if(n=n||{},t=t.trim(),!(e=e.trim())){if(!n.alwaysNormalize)return t;var r=a.parseURL(t);if(!r)throw new Error("Error trying to parse base URL.");return r.path=a.normalizePath(r.path),a.buildURLFromParts(r)}var s=a.parseURL(e);if(!s)throw new Error("Error trying to parse relative URL.");if(s.scheme)return n.alwaysNormalize?(s.path=a.normalizePath(s.path),a.buildURLFromParts(s)):e;var o=a.parseURL(t);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=i.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var c={scheme:o.scheme,netLoc:s.netLoc,path:null,params:s.params,query:s.query,fragment:s.fragment};if(!s.netLoc&&(c.netLoc=o.netLoc,"/"!==s.path[0]))if(s.path){var h=o.path,u=h.substring(0,h.lastIndexOf("/")+1)+s.path;c.path=a.normalizePath(u)}else c.path=o.path,s.params||(c.params=o.params,s.query||(c.query=o.query));return null===c.path&&(c.path=n.alwaysNormalize?a.normalizePath(s.path):s.path),a.buildURLFromParts(c)},parseURL:function(t){var e=r.exec(t);return e?{scheme:e[1]||"",netLoc:e[2]||"",path:e[3]||"",params:e[4]||"",query:e[5]||"",fragment:e[6]||""}:null},normalizePath:function(t){for(t=t.split("").reverse().join("").replace(s,"");t.length!==(t=t.replace(o,"")).length;);return t.split("").reverse().join("")},buildURLFromParts:function(t){return t.scheme+t.netLoc+t.path+t.params+t.query+t.fragment}},t.exports=a},"./node_modules/webworkify-webpack/index.js":function(t,e,n){function r(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.i=function(t){return t},n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{configurable:!1,enumerable:!0,get:r})},n.r=function(t){Object.defineProperty(t,"__esModule",{value:!0})},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n.oe=function(t){throw t};var r=n(n.s=ENTRY_MODULE);return r.default||r}var i="\\(\\s*(/\\*.*?\\*/)?\\s*.*?([\\.|\\-|\\+|\\w|/|@]+).*?\\)";function s(t){return(t+"").replace(/[.?*+^$[\]\\(){}|-]/g,"\\$&")}function o(t,e,r){var o={};o[r]=[];var a=e.toString(),l=a.match(/^function\s?\w*\(\w+,\s*\w+,\s*(\w+)\)/);if(!l)return o;for(var c,h=l[1],u=new RegExp("(\\\\n|\\W)"+s(h)+i,"g");c=u.exec(a);)"dll-reference"!==c[3]&&o[r].push(c[3]);for(u=new RegExp("\\("+s(h)+'\\("(dll-reference\\s([\\.|\\-|\\+|\\w|/|@]+))"\\)\\)'+i,"g");c=u.exec(a);)t[c[2]]||(o[r].push(c[1]),t[c[2]]=n(c[1]).m),o[c[2]]=o[c[2]]||[],o[c[2]].push(c[4]);for(var d,f=Object.keys(o),p=0;p<f.length;p++)for(var m=0;m<o[f[p]].length;m++)d=o[f[p]][m],isNaN(1*d)||(o[f[p]][m]=1*o[f[p]][m]);return o}function a(t){return Object.keys(t).reduce((function(e,n){return e||t[n].length>0}),!1)}t.exports=function(t,e){e=e||{};var i={main:n.m},s=e.all?{main:Object.keys(i.main)}:function(t,e){for(var n={main:[e]},r={main:[]},i={main:{}};a(n);)for(var s=Object.keys(n),l=0;l<s.length;l++){var c=s[l],h=n[c].pop();if(i[c]=i[c]||{},!i[c][h]&&t[c][h]){i[c][h]=!0,r[c]=r[c]||[],r[c].push(h);for(var u=o(t,t[c][h],c),d=Object.keys(u),f=0;f<d.length;f++)n[d[f]]=n[d[f]]||[],n[d[f]]=n[d[f]].concat(u[d[f]])}}return r}(i,t),l="";Object.keys(s).filter((function(t){return"main"!==t})).forEach((function(t){for(var e=0;s[t][e];)e++;s[t].push(e),i[t][e]="(function(module, exports, __webpack_require__) { module.exports = __webpack_require__; })",l=l+"var "+t+" = ("+r.toString().replace("ENTRY_MODULE",JSON.stringify(e))+")({"+s[t].map((function(e){return JSON.stringify(e)+": "+i[t][e].toString()})).join(",")+"});\n"})),l=l+"new (("+r.toString().replace("ENTRY_MODULE",JSON.stringify(t))+")({"+s.main.map((function(t){return JSON.stringify(t)+": "+i.main[t].toString()})).join(",")+"}))(self);";var c=new window.Blob([l],{type:"text/javascript"});if(e.bare)return c;var h=(window.URL||window.webkitURL||window.mozURL||window.msURL).createObjectURL(c),u=new window.Worker(h);return u.objectURL=h,u}},"./src/config.ts":function(t,e,n){n.r(e),n.d(e,"hlsDefaultConfig",(function(){return E})),n.d(e,"mergeConfig",(function(){return _})),n.d(e,"enableStreamingMode",(function(){return S}));var r=n("./src/controller/abr-controller.ts"),i=n("./src/controller/audio-stream-controller.ts"),s=n("./src/controller/audio-track-controller.ts"),o=n("./src/controller/subtitle-stream-controller.ts"),a=n("./src/controller/subtitle-track-controller.ts"),l=n("./src/controller/buffer-controller.ts"),c=n("./src/controller/timeline-controller.ts"),h=n("./src/controller/cap-level-controller.ts"),u=n("./src/controller/fps-controller.ts"),d=n("./src/controller/eme-controller.ts"),f=n("./src/utils/xhr-loader.ts"),p=n("./src/utils/fetch-loader.ts"),m=n("./src/utils/cues.ts"),g=n("./src/utils/mediakeys-helper.ts"),v=n("./src/utils/logger.ts");function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function b(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function x(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?b(Object(n),!0).forEach((function(e){w(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):b(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function w(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var E=x(x({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:f.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:r.default,bufferController:l.default,capLevelController:h.default,fpsController:u.default,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystemOptions:{},requestMediaKeySystemAccessFunc:g.requestMediaKeySystemAccess,testBandwidth:!0,progressive:!1,lowLatencyMode:!0},{cueHandler:m.default,enableCEA708Captions:!0,enableWebVTT:!0,enableIMSC1:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}),{},{subtitleStreamController:o.SubtitleStreamController,subtitleTrackController:a.default,timelineController:c.TimelineController,audioStreamController:i.default,audioTrackController:s.default,emeController:d.default});function _(t,e){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==e.liveMaxLatencyDurationCount&&(void 0===e.liveSyncDurationCount||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==e.liveMaxLatencyDuration&&(void 0===e.liveSyncDuration||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');return y({},t,e)}function S(t){var e=t.loader;e!==p.default&&e!==f.default?(v.logger.log("[config]: Custom loader detected, cannot enable progressive streaming"),t.progressive=!1):Object(p.fetchSupported)()&&(t.loader=p.default,t.progressive=!0,t.enableSoftwareAES=!0,v.logger.log("[config]: Progressive streaming enabled, using FetchLoader"))}},"./src/controller/abr-controller.ts":function(t,e,n){n.r(e);var r=n("./src/polyfills/number.ts"),i=n("./src/utils/ewma-bandwidth-estimator.ts"),s=n("./src/events.ts"),o=n("./src/utils/buffer-helper.ts"),a=n("./src/errors.ts"),l=n("./src/types/loader.ts"),c=n("./src/utils/logger.ts");var h=function(){function t(t){this.hls=void 0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=void 0,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=t;var e=t.config;this.bwEstimator=new i.default(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate),this.registerListeners()}var e,n=t.prototype;return n.registerListeners=function(){var t=this.hls;t.on(s.Events.FRAG_LOADING,this.onFragLoading,this),t.on(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){var t=this.hls;t.off(s.Events.FRAG_LOADING,this.onFragLoading,this),t.off(s.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.ERROR,this.onError,this)},n.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},n.onFragLoading=function(t,e){var n,r=e.frag;r.type===l.PlaylistLevelType.MAIN&&(this.timer||(this.fragCurrent=r,this.partCurrent=null!=(n=e.part)?n:null,this.timer=self.setInterval(this.onCheck,100)))},n.onLevelLoaded=function(t,e){var n=this.hls.config;e.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD)},n._abandonRulesCheck=function(){var t=this.fragCurrent,e=this.partCurrent,n=this.hls,i=n.autoLevelEnabled,a=n.config,l=n.media;if(t&&l){var h=e?e.stats:t.stats,u=e?e.duration:t.duration;if(h.aborted)return c.logger.warn("frag loader destroy or aborted, disarm abandonRules"),this.clearTimer(),void(this._nextAutoLevel=-1);if(i&&!l.paused&&l.playbackRate&&l.readyState){var d=performance.now()-h.loading.start,f=Math.abs(l.playbackRate);if(!(d<=500*u/f)){var p=n.levels,m=n.minAutoLevel,g=p[t.level],v=h.total||Math.max(h.loaded,Math.round(u*g.maxBitrate/8)),y=Math.max(1,h.bwEstimate?h.bwEstimate/8:1e3*h.loaded/d),b=(v-h.loaded)/y,x=l.currentTime,w=(o.BufferHelper.bufferInfo(l,x,a.maxBufferHole).end-x)/f;if(!(w>=2*u/f||b<=w)){var E,_=Number.POSITIVE_INFINITY;for(E=t.level-1;E>m&&!((_=u*p[E].maxBitrate/(6.4*y))<w);E--);if(!(_>=b)){var S=this.bwEstimator.getEstimate();c.logger.warn("Fragment "+t.sn+(e?" part "+e.index:"")+" of level "+t.level+" is loading too slowly and will cause an underbuffer; aborting and switching to level "+E+"\n      Current BW estimate: "+(Object(r.isFiniteNumber)(S)?(S/1024).toFixed(3):"Unknown")+" Kb/s\n      Estimated load time for current fragment: "+b.toFixed(3)+" s\n      Estimated load time for the next fragment: "+_.toFixed(3)+" s\n      Time to underbuffer: "+w.toFixed(3)+" s"),n.nextLoadLevel=E,this.bwEstimator.sample(d,h.loaded),this.clearTimer(),t.loader&&(this.fragCurrent=this.partCurrent=null,t.loader.abort()),n.trigger(s.Events.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:e,stats:h})}}}}}},n.onFragLoaded=function(t,e){var n=e.frag,i=e.part;if(n.type===l.PlaylistLevelType.MAIN&&Object(r.isFiniteNumber)(n.sn)){var o=i?i.stats:n.stats,a=i?i.duration:n.duration;if(this.clearTimer(),this.lastLoadedFragLevel=n.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var c=this.hls.levels[n.level],h=(c.loaded?c.loaded.bytes:0)+o.loaded,u=(c.loaded?c.loaded.duration:0)+a;c.loaded={bytes:h,duration:u},c.realBitrate=Math.round(8*h/u)}if(n.bitrateTest){var d={stats:o,frag:n,part:i,id:n.type};this.onFragBuffered(s.Events.FRAG_BUFFERED,d),n.bitrateTest=!1}}},n.onFragBuffered=function(t,e){var n=e.frag,r=e.part,i=r?r.stats:n.stats;if(!i.aborted&&n.type===l.PlaylistLevelType.MAIN&&"initSegment"!==n.sn){var s=i.parsing.end-i.loading.start;this.bwEstimator.sample(s,i.loaded),i.bwEstimate=this.bwEstimator.getEstimate(),n.bitrateTest?this.bitrateTestDelay=s/1e3:this.bitrateTestDelay=0}},n.onError=function(t,e){switch(e.details){case a.ErrorDetails.FRAG_LOAD_ERROR:case a.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}},n.clearTimer=function(){self.clearInterval(this.timer),this.timer=void 0},n.getNextABRAutoLevel=function(){var t=this.fragCurrent,e=this.partCurrent,n=this.hls,r=n.maxAutoLevel,i=n.config,s=n.minAutoLevel,a=n.media,l=e?e.duration:t?t.duration:0,h=a?a.currentTime:0,u=a&&0!==a.playbackRate?Math.abs(a.playbackRate):1,d=this.bwEstimator?this.bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(o.BufferHelper.bufferInfo(a,h,i.maxBufferHole).end-h)/u,p=this.findBestLevel(d,s,r,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor);if(p>=0)return p;c.logger.trace((f?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var m=l?Math.min(l,i.maxStarvationDelay):i.maxStarvationDelay,g=i.abrBandWidthFactor,v=i.abrBandWidthUpFactor;if(!f){var y=this.bitrateTestDelay;y&&(m=(l?Math.min(l,i.maxLoadingDelay):i.maxLoadingDelay)-y,c.logger.trace("bitrate test took "+Math.round(1e3*y)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*m)+" ms"),g=v=1)}return p=this.findBestLevel(d,s,r,f+m,g,v),Math.max(p,0)},n.findBestLevel=function(t,e,n,r,i,s){for(var o,a=this.fragCurrent,l=this.partCurrent,h=this.lastLoadedFragLevel,u=this.hls.levels,d=u[h],f=!(null==d||null===(o=d.details)||void 0===o||!o.live),p=null==d?void 0:d.codecSet,m=l?l.duration:a?a.duration:0,g=n;g>=e;g--){var v=u[g];if(v&&(!p||v.codecSet===p)){var y,b=v.details,x=(l?null==b?void 0:b.partTarget:null==b?void 0:b.averagetargetduration)||m;y=g<=h?i*t:s*t;var w=u[g].maxBitrate,E=w*x/y;if(c.logger.trace("level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: "+g+"/"+Math.round(y)+"/"+w+"/"+x+"/"+r+"/"+E),y>w&&(!E||f&&!this.bitrateTestDelay||E<r))return g}}return-1},(e=[{key:"nextAutoLevel",get:function(){var t=this._nextAutoLevel,e=this.bwEstimator;if(!(-1===t||e&&e.canEstimate()))return t;var n=this.getNextABRAutoLevel();return-1!==t&&(n=Math.min(t,n)),n},set:function(t){this._nextAutoLevel=t}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}();e.default=h},"./src/controller/audio-stream-controller.ts":function(t,e,n){n.r(e);var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),s=n("./src/events.ts"),o=n("./src/utils/buffer-helper.ts"),a=n("./src/controller/fragment-tracker.ts"),l=n("./src/types/level.ts"),c=n("./src/types/loader.ts"),h=n("./src/loader/fragment.ts"),u=n("./src/demux/chunk-cache.ts"),d=n("./src/demux/transmuxer-interface.ts"),f=n("./src/types/transmuxer.ts"),p=n("./src/controller/fragment-finders.ts"),m=n("./src/utils/discontinuities.ts"),g=n("./src/errors.ts"),v=n("./src/utils/logger.ts");function y(){return(y=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x=function(t){var e,n;function x(e,n){var r;return(r=t.call(this,e,n,"[audio-stream-controller]")||this).videoBuffer=null,r.videoTrackCC=-1,r.waitingVideoCC=-1,r.audioSwitch=!1,r.trackId=-1,r.waitingData=null,r.mainDetails=null,r.bufferFlushed=!1,r._registerListeners(),r}n=t,(e=x).prototype=Object.create(n.prototype),e.prototype.constructor=e,b(e,n);var w=x.prototype;return w.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},w._registerListeners=function(){var t=this.hls;t.on(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.on(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(s.Events.ERROR,this.onError,this),t.on(s.Events.BUFFER_RESET,this.onBufferReset,this),t.on(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},w._unregisterListeners=function(){var t=this.hls;t.off(s.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(s.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(s.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(s.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(s.Events.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),t.off(s.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(s.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(s.Events.ERROR,this.onError,this),t.off(s.Events.BUFFER_RESET,this.onBufferReset,this),t.off(s.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(s.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(s.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this)},w.onInitPtsFound=function(t,e){var n=e.frag,r=e.id,s=e.initPTS;if("main"===r){var o=n.cc;this.initPTS[n.cc]=s,this.log("InitPTS for cc: "+o+" found from main: "+s),this.videoTrackCC=o,this.state===i.State.WAITING_INIT_PTS&&this.tick()}},w.startLoad=function(t){if(!this.levels)return this.startPosition=t,void(this.state=i.State.STOPPED);var e=this.lastCurrentTime;this.stopLoad(),this.setInterval(100),this.fragLoadError=0,e>0&&-1===t?(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),this.state=i.State.IDLE):(this.loadedmetadata=!1,this.state=i.State.WAITING_TRACK),this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()},w.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_TRACK:var e,n=this.levels,r=this.trackId,s=null==n||null===(e=n[r])||void 0===e?void 0:e.details;if(s){if(this.waitForCdnTuneIn(s))break;this.state=i.State.WAITING_INIT_PTS}break;case i.State.FRAG_LOADING_WAITING_RETRY:var a,l=performance.now(),c=this.retryDate;(!c||l>=c||null!==(a=this.media)&&void 0!==a&&a.seeking)&&(this.log("RetryDate reached, switch back to IDLE state"),this.state=i.State.IDLE);break;case i.State.WAITING_INIT_PTS:var h=this.waitingData;if(h){var u=h.frag,d=h.part,f=h.cache,m=h.complete;if(void 0!==this.initPTS[u.cc]){this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.FRAG_LOADING;var g={frag:u,part:d,payload:f.flush(),networkDetails:null};this._handleFragmentLoadProgress(g),m&&t.prototype._handleFragmentLoadComplete.call(this,g)}else if(this.videoTrackCC!==this.waitingVideoCC)v.logger.log("Waiting fragment cc ("+u.cc+") cancelled because video is at cc "+this.videoTrackCC),this.clearWaitingFragment();else{var y=this.getLoadPosition(),b=o.BufferHelper.bufferInfo(this.mediaBuffer,y,this.config.maxBufferHole);Object(p.fragmentWithinToleranceTest)(b.end,this.config.maxFragLookUpTolerance,u)<0&&(v.logger.log("Waiting fragment cc ("+u.cc+") @ "+u.start+" cancelled because another fragment at "+b.end+" is needed"),this.clearWaitingFragment())}}else this.state=i.State.IDLE}this.onTickEnd()},w.clearWaitingFragment=function(){var t=this.waitingData;t&&(this.fragmentTracker.removeFragment(t.frag),this.waitingData=null,this.waitingVideoCC=-1,this.state=i.State.IDLE)},w.onTickEnd=function(){var t=this.media;if(t&&t.readyState){var e=(this.mediaBuffer?this.mediaBuffer:t).buffered;!this.loadedmetadata&&e.length&&(this.loadedmetadata=!0),this.lastCurrentTime=t.currentTime}},w.doTickIdle=function(){var t,e,n=this.hls,r=this.levels,o=this.media,a=this.trackId,l=n.config;if(r&&r[a]&&(o||!this.startFragRequested&&l.startFragPrefetch)){var u=r[a].details;if(!u||u.live&&this.levelLastLoaded!==a||this.waitForCdnTuneIn(u))this.state=i.State.WAITING_TRACK;else{this.bufferFlushed&&(this.bufferFlushed=!1,this.afterBufferFlushed(this.mediaBuffer?this.mediaBuffer:this.media,h.ElementaryStreamTypes.AUDIO,c.PlaylistLevelType.AUDIO));var d=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,c.PlaylistLevelType.AUDIO);if(null!==d){var f=d.len,p=this.getMaxBufferLength(),m=this.audioSwitch;if(!(f>=p)||m){if(!m&&this._streamEnded(d,u))return n.trigger(s.Events.BUFFER_EOS,{type:"audio"}),void(this.state=i.State.ENDED);var g=u.fragments[0].start,v=d.end;if(m){var y=this.getLoadPosition();v=y,u.PTSKnown&&y<g&&(d.end>g||d.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),o.currentTime=g+.05)}var b=this.getNextFragment(v,u);b?"identity"!==(null===(t=b.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=b.decryptdata)&&void 0!==e&&e.key?this.loadFragment(b,u,v):this.loadKey(b,u):this.bufferFlushed=!0}}}}},w.getMaxBufferLength=function(){var e=t.prototype.getMaxBufferLength.call(this),n=this.getFwdBufferInfo(this.videoBuffer?this.videoBuffer:this.media,c.PlaylistLevelType.MAIN);return null===n?e:Math.max(e,n.len)},w.onMediaDetaching=function(){this.videoBuffer=null,t.prototype.onMediaDetaching.call(this)},w.onAudioTracksUpdated=function(t,e){var n=e.audioTracks;this.resetTransmuxer(),this.levels=n.map((function(t){return new l.Level(t)}))},w.onAudioTrackSwitching=function(t,e){var n=!!e.url;this.trackId=e.id;var r=this.fragCurrent;null!=r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.clearWaitingFragment(),n?this.setInterval(100):this.resetTransmuxer(),n?(this.audioSwitch=!0,this.state=i.State.IDLE):this.state=i.State.STOPPED,this.tick()},w.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments(),this.startPosition=this.lastCurrentTime=0,this.bufferFlushed=!1},w.onLevelLoaded=function(t,e){this.mainDetails=e.details},w.onAudioTrackLoaded=function(t,e){var n,r=this.levels,s=e.details,o=e.id;if(r){this.log("Track "+o+" loaded ["+s.startSN+","+s.endSN+"],duration:"+s.totalduration);var a=r[o],l=0;if(s.live||null!==(n=a.details)&&void 0!==n&&n.live){var c=this.mainDetails;if(s.fragments[0]||(s.deltaUpdateFailed=!0),s.deltaUpdateFailed||!c)return;!a.details&&s.hasProgramDateTime&&c.hasProgramDateTime?(Object(m.alignPDT)(s,c),l=s.fragments[0].start):l=this.alignPlaylists(s,a.details)}a.details=s,this.levelLastLoaded=o,this.startFragRequested||!this.mainDetails&&s.live||this.setStartPosition(a.details,l),this.state!==i.State.WAITING_TRACK||this.waitForCdnTuneIn(s)||(this.state=i.State.IDLE),this.tick()}else this.warn("Audio tracks were reset while loading level "+o)},w._handleFragmentLoadProgress=function(t){var e,n=t.frag,r=t.part,s=t.payload,o=this.config,a=this.trackId,l=this.levels;if(l){var h=l[a],p=h.details,m=o.defaultAudioCodec||h.audioCodec||"mp4a.40.2",g=this.transmuxer;g||(g=this.transmuxer=new d.default(this.hls,c.PlaylistLevelType.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));var y=this.initPTS[n.cc],b=null===(e=n.initSegment)||void 0===e?void 0:e.data;if(void 0!==y){var x=r?r.index:-1,w=-1!==x,E=new f.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,s.byteLength,x,w);g.push(s,b,m,"",n,r,p.totalduration,!1,E,y)}else v.logger.log("Unknown video PTS for cc "+n.cc+", waiting for video PTS before demuxing audio frag "+n.sn+" of ["+p.startSN+" ,"+p.endSN+"],track "+a),(this.waitingData=this.waitingData||{frag:n,part:r,cache:new u.default,complete:!1}).cache.push(new Uint8Array(s)),this.waitingVideoCC=this.videoTrackCC,this.state=i.State.WAITING_INIT_PTS}else this.warn("Audio tracks were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},w._handleFragmentLoadComplete=function(e){this.waitingData?this.waitingData.complete=!0:t.prototype._handleFragmentLoadComplete.call(this,e)},w.onBufferReset=function(){this.mediaBuffer=this.videoBuffer=null,this.loadedmetadata=!1},w.onBufferCreated=function(t,e){var n=e.tracks.audio;n&&(this.mediaBuffer=n.buffer),e.tracks.video&&(this.videoBuffer=e.tracks.video.buffer)},w.onFragBuffered=function(t,e){var n=e.frag,r=e.part;n.type===c.PlaylistLevelType.AUDIO&&(this.fragContextChanged(n)?this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state+", audioSwitch: "+this.audioSwitch):("initSegment"!==n.sn&&(this.fragPrevious=n,this.audioSwitch&&(this.audioSwitch=!1,this.hls.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:this.trackId}))),this.fragBufferedComplete(n,r)))},w.onError=function(e,n){switch(n.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:case g.ErrorDetails.KEY_LOAD_ERROR:case g.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.AUDIO,n);break;case g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:this.state!==i.State.ERROR&&this.state!==i.State.STOPPED&&(this.state=n.fatal?i.State.ERROR:i.State.IDLE,this.warn(n.details+" while loading frag, switching to "+this.state+" state"));break;case g.ErrorDetails.BUFFER_FULL_ERROR:if("audio"===n.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var r=!0,s=this.getFwdBufferInfo(this.mediaBuffer,c.PlaylistLevelType.AUDIO);s&&s.len>.5&&(r=!this.reduceMaxBufferLength(s.len)),r&&(this.warn("Buffer full error also media.currentTime is not buffered, flush audio buffer"),this.fragCurrent=null,t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.resetLoadingState()}}},w.onBufferFlushed=function(t,e){e.type===h.ElementaryStreamTypes.AUDIO&&(this.bufferFlushed=!0)},w._handleTransmuxComplete=function(t){var e,n="audio",r=this.hls,o=t.remuxResult,a=t.chunkMeta,l=this.getCurrentContext(a);if(!l)return this.warn("The loading context changed while buffering fragment "+a.sn+" of level "+a.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(a.level);var c=l.frag,u=l.part,d=o.audio,f=o.text,p=o.id3,m=o.initSegment;if(!this.fragContextChanged(c)){if(this.state=i.State.PARSING,this.audioSwitch&&d&&this.completeAudioSwitch(),null!=m&&m.tracks&&(this._bufferInitSegment(m.tracks,c,a),r.trigger(s.Events.FRAG_PARSING_INIT_SEGMENT,{frag:c,id:n,tracks:m.tracks})),d){var g=d.startPTS,v=d.endPTS,b=d.startDTS,x=d.endDTS;u&&(u.elementaryStreams[h.ElementaryStreamTypes.AUDIO]={startPTS:g,endPTS:v,startDTS:b,endDTS:x}),c.setElementaryStreamInfo(h.ElementaryStreamTypes.AUDIO,g,v,b,x),this.bufferFragmentData(d,c,u,a)}if(null!=p&&null!==(e=p.samples)&&void 0!==e&&e.length){var w=y({frag:c,id:n},p);r.trigger(s.Events.FRAG_PARSING_METADATA,w)}if(f){var E=y({frag:c,id:n},f);r.trigger(s.Events.FRAG_PARSING_USERDATA,E)}}},w._bufferInitSegment=function(t,e,n){if(this.state===i.State.PARSING){t.video&&delete t.video;var r=t.audio;if(r){r.levelCodec=r.codec,r.id="audio",this.log("Init audio buffer, container:"+r.container+", codecs[parsed]=["+r.codec+"]"),this.hls.trigger(s.Events.BUFFER_CODECS,t);var o=r.initSegment;if(null!=o&&o.byteLength){var a={type:"audio",frag:e,part:null,chunkMeta:n,parent:e.type,data:o};this.hls.trigger(s.Events.BUFFER_APPENDING,a)}this.tick()}}},w.loadFragment=function(e,n,s){var o=this.fragmentTracker.getState(e);this.fragCurrent=e,(this.audioSwitch||o===a.FragmentState.NOT_LOADED||o===a.FragmentState.PARTIAL)&&("initSegment"===e.sn?this._loadInitSegment(e):n.live&&!Object(r.isFiniteNumber)(this.initPTS[e.cc])?(this.log("Waiting for video PTS in continuity counter "+e.cc+" of live stream before loading audio fragment "+e.sn+" of level "+this.trackId),this.state=i.State.WAITING_INIT_PTS):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,n,s)))},w.completeAudioSwitch=function(){var e=this.hls,n=this.media,r=this.trackId;n&&(this.log("Switching audio track : flushing all audio"),t.prototype.flushMainBuffer.call(this,0,Number.POSITIVE_INFINITY,"audio")),this.audioSwitch=!1,e.trigger(s.Events.AUDIO_TRACK_SWITCHED,{id:r})},x}(i.default);e.default=x},"./src/controller/audio-track-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts"),i=n("./src/errors.ts"),s=n("./src/controller/base-playlist-controller.ts"),o=n("./src/types/loader.ts");function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,n;function s(e){var n;return(n=t.call(this,e,"[audio-track-controller]")||this).tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.trackName="",n.selectDefaultTrack=!0,n.registerListeners(),n}n=t,(e=s).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var l,c=s.prototype;return c.registerListeners=function(){var t=this.hls;t.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.on(r.Events.ERROR,this.onError,this)},c.unregisterListeners=function(){var t=this.hls;t.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(r.Events.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),t.off(r.Events.ERROR,this.onError,this)},c.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,t.prototype.destroy.call(this)},c.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.trackName="",this.selectDefaultTrack=!0},c.onManifestParsed=function(t,e){this.tracks=e.audioTracks||[]},c.onAudioTrackLoaded=function(t,e){var n=e.id,r=e.details,i=this.tracksInGroup[n];if(i){var s=i.details;i.details=e.details,this.log("audioTrack "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,e,s))}else this.warn("Invalid audio track id "+n)},c.onLevelLoading=function(t,e){this.switchLevel(e.level)},c.onLevelSwitching=function(t,e){this.switchLevel(e.level)},c.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.audioGroupIds){var n=e.audioGroupIds[e.urlId];if(this.groupId!==n){this.groupId=n;var i=this.tracks.filter((function(t){return!n||t.groupId===n}));this.selectDefaultTrack&&!i.some((function(t){return t.default}))&&(this.selectDefaultTrack=!1),this.tracksInGroup=i;var s={audioTracks:i};this.log("Updating audio tracks, "+i.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.AUDIO_TRACKS_UPDATED,s),this.selectInitialTrack()}}},c.onError=function(e,n){t.prototype.onError.call(this,e,n),!n.fatal&&n.context&&n.context.type===o.PlaylistContextType.AUDIO_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},c.setAudioTrack=function(t){var e=this.tracksInGroup;if(t<0||t>=e.length)this.warn("Invalid id passed to audio-track controller");else{this.clearTimer();var n=e[this.trackId];this.log("Now switching to audio-track index "+t);var i=e[t],s=i.id,o=i.groupId,a=void 0===o?"":o,l=i.name,c=i.type,h=i.url;if(this.trackId=t,this.trackName=l,this.selectDefaultTrack=!1,this.hls.trigger(r.Events.AUDIO_TRACK_SWITCHING,{id:s,groupId:a,name:l,type:c,url:h}),!i.details||i.details.live){var u=this.switchParams(i.url,null==n?void 0:n.details);this.loadPlaylist(u)}}},c.selectInitialTrack=function(){this.tracksInGroup;var t=this.trackName,e=this.findTrackId(t)||this.findTrackId();-1!==e?this.setAudioTrack(e):(this.warn("No track found for running audio group-ID: "+this.groupId),this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,fatal:!0}))},c.findTrackId=function(t){for(var e=this.tracksInGroup,n=0;n<e.length;n++){var r=e[n];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},c.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var n=e.id,i=e.groupId,s=e.url;if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("loading audio-track playlist for id: "+n),this.clearTimer(),this.hls.trigger(r.Events.AUDIO_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null})}},(l=[{key:"audioTracks",get:function(){return this.tracksInGroup}},{key:"audioTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1,this.setAudioTrack(t)}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(s.prototype,l),s}(s.default);e.default=l},"./src/controller/base-playlist-controller.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return l}));var r=n("./src/polyfills/number.ts"),i=n("./src/types/level.ts"),s=n("./src/controller/level-helper.ts"),o=n("./src/utils/logger.ts"),a=n("./src/errors.ts"),l=function(){function t(t,e){this.hls=void 0,this.timer=-1,this.canLoad=!1,this.retryCount=0,this.log=void 0,this.warn=void 0,this.log=o.logger.log.bind(o.logger,e+":"),this.warn=o.logger.warn.bind(o.logger,e+":"),this.hls=t}var e=t.prototype;return e.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},e.onError=function(t,e){e.fatal&&e.type===a.ErrorTypes.NETWORK_ERROR&&this.clearTimer()},e.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},e.startLoad=function(){this.canLoad=!0,this.retryCount=0,this.loadPlaylist()},e.stopLoad=function(){this.canLoad=!1,this.clearTimer()},e.switchParams=function(t,e){var n=null==e?void 0:e.renditionReports;if(n)for(var s=0;s<n.length;s++){var o=n[s],a=""+o.URI;if(a===t.substr(-a.length)){var l=parseInt(o["LAST-MSN"]),c=parseInt(o["LAST-PART"]);if(e&&this.hls.config.lowLatencyMode){var h=Math.min(e.age-e.partTarget,e.targetduration);void 0!==c&&h>e.partTarget&&(c+=1)}if(Object(r.isFiniteNumber)(l))return new i.HlsUrlParameters(l,Object(r.isFiniteNumber)(c)?c:void 0,i.HlsSkip.No)}}},e.loadPlaylist=function(t){},e.shouldLoadTrack=function(t){return this.canLoad&&t&&!!t.url&&(!t.details||t.details.live)},e.playlistLoaded=function(t,e,n){var r=this,i=e.details,o=e.stats,a=o.loading.end?Math.max(0,self.performance.now()-o.loading.end):0;if(i.advancedDateTime=Date.now()-a,i.live||null!=n&&n.live){if(i.reloaded(n),n&&this.log("live playlist "+t+" "+(i.advanced?"REFRESHED "+i.lastPartSn+"-"+i.lastPartIndex:"MISSED")),n&&i.fragments.length>0&&Object(s.mergeDetails)(n,i),!this.canLoad||!i.live)return;var l,c=void 0,h=void 0;if(i.canBlockReload&&i.endSN&&i.advanced){var u=this.hls.config.lowLatencyMode,d=i.lastPartSn,f=i.endSN,p=i.lastPartIndex,m=d===f;-1!==p?(c=m?f+1:d,h=m?u?0:p:p+1):c=f+1;var g=i.age,v=g+i.ageHeader,y=Math.min(v-i.partTarget,1.5*i.targetduration);if(y>0){if(n&&y>n.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+n.tuneInGoal+" to: "+y+" with playlist age: "+i.age),y=0;else{var b=Math.floor(y/i.targetduration);c+=b,void 0!==h&&(h+=Math.round(y%i.targetduration/i.partTarget)),this.log("CDN Tune-in age: "+i.ageHeader+"s last advanced "+g.toFixed(2)+"s goal: "+y+" skip sn "+b+" to part "+h)}i.tuneInGoal=y}if(l=this.getDeliveryDirectives(i,e.deliveryDirectives,c,h),u||!m)return void this.loadPlaylist(l)}else l=this.getDeliveryDirectives(i,e.deliveryDirectives,c,h);var x=Object(s.computeReloadInterval)(i,o);void 0!==c&&i.canBlockReload&&(x-=i.partTarget||1),this.log("reload live playlist "+t+" in "+Math.round(x)+" ms"),this.timer=self.setTimeout((function(){return r.loadPlaylist(l)}),x)}else this.clearTimer()},e.getDeliveryDirectives=function(t,e,n,r){var s=Object(i.getSkipValue)(t,n);return null!=e&&e.skip&&t.deltaUpdateFailed&&(n=e.msn,r=e.part,s=i.HlsSkip.No),new i.HlsUrlParameters(n,r,s)},e.retryLoadingOrFail=function(t){var e,n=this,r=this.hls.config,i=this.retryCount<r.levelLoadingMaxRetry;if(i)if(this.retryCount++,t.details.indexOf("LoadTimeOut")>-1&&null!==(e=t.context)&&void 0!==e&&e.deliveryDirectives)this.warn("retry playlist loading #"+this.retryCount+' after "'+t.details+'"'),this.loadPlaylist();else{var s=Math.min(Math.pow(2,this.retryCount)*r.levelLoadingRetryDelay,r.levelLoadingMaxRetryTimeout);this.timer=self.setTimeout((function(){return n.loadPlaylist()}),s),this.warn("retry playlist loading #"+this.retryCount+" in "+s+' ms after "'+t.details+'"')}else this.warn('cannot recover from error "'+t.details+'"'),this.clearTimer(),t.fatal=!0;return i},t}()},"./src/controller/base-stream-controller.ts":function(t,e,n){n.r(e),n.d(e,"State",(function(){return x})),n.d(e,"default",(function(){return w}));var r=n("./src/polyfills/number.ts"),i=n("./src/task-loop.ts"),s=n("./src/controller/fragment-tracker.ts"),o=n("./src/utils/buffer-helper.ts"),a=n("./src/utils/logger.ts"),l=n("./src/events.ts"),c=n("./src/errors.ts"),h=n("./src/types/transmuxer.ts"),u=n("./src/utils/mp4-tools.ts"),d=n("./src/utils/discontinuities.ts"),f=n("./src/controller/fragment-finders.ts"),p=n("./src/controller/level-helper.ts"),m=n("./src/loader/fragment-loader.ts"),g=n("./src/crypt/decrypter.ts"),v=n("./src/utils/time-ranges.ts"),y=n("./src/types/loader.ts");function b(t,e){return(b=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var x={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",BACKTRACKING:"BACKTRACKING",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},w=function(t){var e,n;function i(e,n,r){var i;return(i=t.call(this)||this).hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=x.STOPPED,i.media=void 0,i.mediaBuffer=void 0,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.loadedmetadata=!1,i.fragLoadError=0,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.logPrefix=r,i.log=a.logger.log.bind(a.logger,r+":"),i.warn=a.logger.warn.bind(a.logger,r+":"),i.hls=e,i.fragmentLoader=new m.default(e.config),i.fragmentTracker=n,i.config=e.config,i.decrypter=new g.default(e,e.config),e.on(l.Events.KEY_LOADED,i.onKeyLoaded,function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(i)),i}n=t,(e=i).prototype=Object.create(n.prototype),e.prototype.constructor=e,b(e,n);var w,E=i.prototype;return E.doTick=function(){this.onTickEnd()},E.onTickEnd=function(){},E.startLoad=function(t){},E.stopLoad=function(){this.fragmentLoader.abort();var t=this.fragCurrent;t&&this.fragmentTracker.removeFragment(t),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=x.STOPPED},E._streamEnded=function(t,e){var n=this.fragCurrent,r=this.fragmentTracker;if(!e.live&&n&&n.sn===e.endSN&&!t.nextStart){var i=r.getState(n);return i===s.FragmentState.PARTIAL||i===s.FragmentState.OK}return!1},E.onMediaAttached=function(t,e){var n=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),n.addEventListener("seeking",this.onvseeking),n.addEventListener("ended",this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.state===x.STOPPED&&this.startLoad(r.startPosition)},E.onMediaDetaching=function(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},E.onMediaSeeking=function(){var t=this.config,e=this.fragCurrent,n=this.media,i=this.mediaBuffer,s=this.state,a=n?n.currentTime:0,l=o.BufferHelper.bufferInfo(i||n,a,t.maxBufferHole);if(this.log("media seeking to "+(Object(r.isFiniteNumber)(a)?a.toFixed(3):a)+", state: "+s),s===x.ENDED)this.resetLoadingState();else if(e&&!l.len){var c=t.maxFragLookUpTolerance,h=e.start-c,u=a>e.start+e.duration+c;(a<h||u)&&(u&&e.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),e.loader.abort()),this.resetLoadingState())}n&&(this.lastCurrentTime=a),this.loadedmetadata||l.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},E.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},E.onKeyLoaded=function(t,e){if(this.state===x.KEY_LOADING&&e.frag===this.fragCurrent&&this.levels){this.state=x.IDLE;var n=this.levels[e.frag.level].details;n&&this.loadFragment(e.frag,n,e.frag.start)}},E.onHandlerDestroying=function(){this.stopLoad(),t.prototype.onHandlerDestroying.call(this)},E.onHandlerDestroyed=function(){this.state=x.STOPPED,this.hls.off(l.Events.KEY_LOADED,this.onKeyLoaded,this),this.fragmentLoader&&this.fragmentLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.fragmentLoader=this.fragmentTracker=null,t.prototype.onHandlerDestroyed.call(this)},E.loadKey=function(t,e){this.log("Loading key for "+t.sn+" of ["+e.startSN+"-"+e.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level),this.state=x.KEY_LOADING,this.fragCurrent=t,this.hls.trigger(l.Events.KEY_LOADING,{frag:t})},E.loadFragment=function(t,e,n){this._loadFragForPlayback(t,e,n)},E._loadFragForPlayback=function(t,e,n){var r=this;this._doFragLoad(t,e,n,(function(e){if(r.fragContextChanged(t))return r.warn("Fragment "+t.sn+(e.part?" p: "+e.part.index:"")+" of level "+t.level+" was dropped during download."),void r.fragmentTracker.removeFragment(t);t.stats.chunkCount++,r._handleFragmentLoadProgress(e)})).then((function(e){if(e){r.fragLoadError=0;var n=r.state;if(!r.fragContextChanged(t))return"payload"in e&&(r.log("Loaded fragment "+t.sn+" of level "+t.level),r.hls.trigger(l.Events.FRAG_LOADED,e),r.state===x.BACKTRACKING)?(r.fragmentTracker.backtrack(t,e),void r.resetFragmentLoading(t)):void r._handleFragmentLoadComplete(e);(n===x.FRAG_LOADING||n===x.BACKTRACKING||!r.fragCurrent&&n===x.PARSING)&&(r.fragmentTracker.removeFragment(t),r.state=x.IDLE)}})).catch((function(e){r.warn(e),r.resetFragmentLoading(t)}))},E.flushMainBuffer=function(t,e,n){if(void 0===n&&(n=null),t-e){var r={startOffset:t,endOffset:e,type:n};this.fragLoadError=0,this.hls.trigger(l.Events.BUFFER_FLUSHING,r)}},E._loadInitSegment=function(t){var e=this;this._doFragLoad(t).then((function(n){if(!n||e.fragContextChanged(t)||!e.levels)throw new Error("init load aborted");return n})).then((function(n){var r=e.hls,i=n.payload,s=t.decryptdata;if(i&&i.byteLength>0&&s&&s.key&&s.iv&&"AES-128"===s.method){var o=self.performance.now();return e.decrypter.webCryptoDecrypt(new Uint8Array(i),s.key.buffer,s.iv.buffer).then((function(e){var i=self.performance.now();return r.trigger(l.Events.FRAG_DECRYPTED,{frag:t,payload:e,stats:{tstart:o,tdecrypt:i}}),n.payload=e,n}))}return n})).then((function(n){var r=e.fragCurrent,i=e.hls,s=e.levels;if(!s)throw new Error("init load aborted, missing levels");s[t.level].details;var o=t.stats;e.state=x.IDLE,e.fragLoadError=0,t.data=new Uint8Array(n.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),n.frag===r&&i.trigger(l.Events.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:t.type}),e.tick()})).catch((function(n){e.warn(n),e.resetFragmentLoading(t)}))},E.fragContextChanged=function(t){var e=this.fragCurrent;return!t||!e||t.level!==e.level||t.sn!==e.sn||t.urlId!==e.urlId},E.fragBufferedComplete=function(t,e){var n=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+t.type+" sn: "+t.sn+(e?" part: "+e.index:"")+" of "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+t.level+" "+v.default.toString(o.BufferHelper.getBuffered(n))),this.state=x.IDLE,this.tick()},E._handleFragmentLoadComplete=function(t){var e=this.transmuxer;if(e){var n=t.frag,r=t.part,i=t.partsLoaded,s=!i||0===i.length||i.some((function(t){return!t})),o=new h.ChunkMetadata(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!s);e.flush(o)}},E._handleFragmentLoadProgress=function(t){},E._doFragLoad=function(t,e,n,i){var s=this;if(void 0===n&&(n=null),!this.levels)throw new Error("frag load aborted, missing levels");if(n=Math.max(t.start,n||0),this.config.lowLatencyMode&&e){var o=e.partList;if(o&&i){n>t.end&&e.fragmentHint&&(t=e.fragmentHint);var a=this.getNextPart(o,t,n);if(a>-1){var c=o[a];return this.log("Loading part sn: "+t.sn+" p: "+c.index+" cc: "+t.cc+" of playlist ["+e.startSN+"-"+e.endSN+"] parts [0-"+a+"-"+(o.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),this.nextLoadPosition=c.start+c.duration,this.state=x.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:t,part:o[a],targetBufferTime:n}),this.doFragPartsLoad(t,o,a,i).catch((function(t){return s.handleFragLoadError(t)}))}if(!t.url||this.loadedEndOfParts(o,n))return Promise.resolve(null)}}return this.log("Loading fragment "+t.sn+" cc: "+t.cc+" "+(e?"of ["+e.startSN+"-"+e.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+t.level+", target: "+parseFloat(n.toFixed(3))),Object(r.isFiniteNumber)(t.sn)&&!this.bitrateTest&&(this.nextLoadPosition=t.start+t.duration),this.state=x.FRAG_LOADING,this.hls.trigger(l.Events.FRAG_LOADING,{frag:t,targetBufferTime:n}),this.fragmentLoader.load(t,i).catch((function(t){return s.handleFragLoadError(t)}))},E.doFragPartsLoad=function(t,e,n,r){var i=this;return new Promise((function(s,o){var a=[];!function n(c){var h=e[c];i.fragmentLoader.loadPart(t,h,r).then((function(r){a[h.index]=r;var o=r.part;i.hls.trigger(l.Events.FRAG_LOADED,r);var u=e[c+1];if(!u||u.fragment!==t)return s({frag:t,part:o,partsLoaded:a});n(c+1)})).catch(o)}(n)}))},E.handleFragLoadError=function(t){var e=t.data;return e&&e.details===c.ErrorDetails.INTERNAL_ABORTED?this.handleFragLoadAborted(e.frag,e.part):this.hls.trigger(l.Events.ERROR,e),null},E._handleTransmuxerFlush=function(t){var e=this.getCurrentContext(t);if(e&&this.state===x.PARSING){var n=e.frag,r=e.part,i=e.level,s=self.performance.now();n.stats.parsing.end=s,r&&(r.stats.parsing.end=s),this.updateLevelTiming(n,r,i,t.partial)}else this.fragCurrent||(this.state=x.IDLE)},E.getCurrentContext=function(t){var e=this.levels,n=t.level,r=t.sn,i=t.part;if(!e||!e[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var s=e[n],o=i>-1?Object(p.getPartWith)(s,r,i):null,a=o?o.fragment:Object(p.getFragmentWithSN)(s,r,this.fragCurrent);return a?{frag:a,part:o,level:s}:null},E.bufferFragmentData=function(t,e,n,r){if(t&&this.state===x.PARSING){var i=t.data1,s=t.data2,o=i;if(i&&s&&(o=Object(u.appendUint8Array)(i,s)),o&&o.length){var a={type:t.type,frag:e,part:n,chunkMeta:r,parent:e.type,data:o};this.hls.trigger(l.Events.BUFFER_APPENDING,a),t.dropped&&t.independent&&!n&&this.flushBufferGap(e)}}},E.flushBufferGap=function(t){var e=this.media;if(e)if(o.BufferHelper.isBuffered(e,e.currentTime)){var n=e.currentTime,r=o.BufferHelper.bufferInfo(e,n,0),i=t.duration,s=Math.min(2*this.config.maxFragLookUpTolerance,.25*i),a=Math.max(Math.min(t.start-s,r.end-s),n+s);t.start-a>s&&this.flushMainBuffer(a,t.start)}else this.flushMainBuffer(0,t.start)},E.getFwdBufferInfo=function(t,e){var n=this.config,i=this.getLoadPosition();if(!Object(r.isFiniteNumber)(i))return null;var s=o.BufferHelper.bufferInfo(t,i,n.maxBufferHole);if(0===s.len&&void 0!==s.nextStart){var a=this.fragmentTracker.getBufferedFrag(i,e);if(a&&s.nextStart<a.end)return o.BufferHelper.bufferInfo(t,i,Math.max(s.nextStart,n.maxBufferHole))}return s},E.getMaxBufferLength=function(t){var e,n=this.config;return e=t?Math.max(8*n.maxBufferSize/t,n.maxBufferLength):n.maxBufferLength,Math.min(e,n.maxMaxBufferLength)},E.reduceMaxBufferLength=function(t){var e=this.config,n=t||e.maxBufferLength;return e.maxMaxBufferLength>=n&&(e.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+e.maxMaxBufferLength+"s"),!0)},E.getNextFragment=function(t,e){var n,r,i=e.fragments,s=i.length;if(!s)return null;var o,a=this.config,l=i[0].start;if(e.live){var c=a.initialLiveManifestSize;if(s<c)return this.warn("Not enough fragments to start playback (have: "+s+", need: "+c+")"),null;e.PTSKnown||this.startFragRequested||-1!==this.startPosition||(o=this.getInitialLiveFragment(e,i),this.startPosition=o?this.hls.liveSyncPosition||o.start:t)}else t<=l&&(o=i[0]);if(!o){var h=a.lowLatencyMode?e.partEnd:e.fragmentEnd;o=this.getFragmentAtPosition(t,h,e)}return null===(n=o)||void 0===n||!n.initSegment||null!==(r=o)&&void 0!==r&&r.initSegment.data||this.bitrateTest||(o=o.initSegment),o},E.getNextPart=function(t,e,n){for(var r=-1,i=!1,s=!0,o=0,a=t.length;o<a;o++){var l=t[o];if(s=s&&!l.independent,r>-1&&n<l.start)break;var c=l.loaded;!c&&(i||l.independent||s)&&l.fragment===e&&(r=o),i=c}return r},E.loadedEndOfParts=function(t,e){var n=t[t.length-1];return n&&e>n.start&&n.loaded},E.getInitialLiveFragment=function(t,e){var n=this.fragPrevious,r=null;if(n){if(t.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+n.programDateTime),r=Object(f.findFragmentByPDT)(e,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){var i=n.sn+1;if(i>=t.startSN&&i<=t.endSN){var s=e[i-t.startSN];n.cc===s.cc&&(r=s,this.log("Live playlist, switching playlist, load frag with next SN: "+r.sn))}r||(r=Object(f.findFragWithCC)(e,n.cc))&&this.log("Live playlist, switching playlist, load frag with same CC: "+r.sn)}}else{var o=this.hls.liveSyncPosition;null!==o&&(r=this.getFragmentAtPosition(o,this.bitrateTest?t.fragmentEnd:t.edge,t))}return r},E.getFragmentAtPosition=function(t,e,n){var r,i=this.config,o=this.fragPrevious,a=n.fragments,l=n.endSN,c=n.fragmentHint,h=i.maxFragLookUpTolerance,u=!!(i.lowLatencyMode&&n.partList&&c);if(u&&c&&!this.bitrateTest&&(a=a.concat(c),l=c.sn),t<e){var d=t>e-h?0:h;r=Object(f.findFragmentByPTS)(o,a,t,d)}else r=a[a.length-1];if(r){var p=r.sn-n.startSN,m=o&&r.level===o.level,g=a[p+1];if(this.fragmentTracker.getState(r)===s.FragmentState.BACKTRACKED){r=null;for(var v=p;a[v]&&this.fragmentTracker.getState(a[v])===s.FragmentState.BACKTRACKED;)r=o?a[v--]:a[--v];r||(r=g)}else o&&r.sn===o.sn&&!u&&m&&(r.sn<l&&this.fragmentTracker.getState(g)!==s.FragmentState.OK?(this.log("SN "+r.sn+" just loaded, load next one: "+g.sn),r=g):r=null)}return r},E.synchronizeToLiveEdge=function(t){var e=this.config,n=this.media;if(n){var r=this.hls.liveSyncPosition,i=n.currentTime,s=t.fragments[0].start,o=t.edge,a=i>=s-e.maxFragLookUpTolerance&&i<=o;if(null!==r&&n.duration>r&&(i<r||!a)){var l=void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:e.liveMaxLatencyDurationCount*t.targetduration;(!a&&n.readyState<4||i<o-l)&&(this.loadedmetadata||(this.nextLoadPosition=r),n.readyState&&(this.warn("Playback: "+i.toFixed(3)+" is located too far from the end of live sliding playlist: "+o+", reset currentTime to : "+r.toFixed(3)),n.currentTime=r))}}},E.alignPlaylists=function(t,e){var n=this.levels,i=this.levelLastLoaded,s=this.fragPrevious,o=null!==i?n[i]:null,a=t.fragments.length;if(!a)return this.warn("No fragments in live playlist"),0;var l=t.fragments[0].start,c=!e,h=t.alignedSliding&&Object(r.isFiniteNumber)(l);if(c||!h&&!l){Object(d.alignStream)(s,o,t);var u=t.fragments[0].start;return this.log("Live playlist sliding: "+u.toFixed(2)+" start-sn: "+(e?e.startSN:"na")+"->"+t.startSN+" prev-sn: "+(s?s.sn:"na")+" fragments: "+a),u}return l},E.waitForCdnTuneIn=function(t){return t.live&&t.canBlockReload&&t.tuneInGoal>Math.max(t.partHoldBack,3*t.partTarget)},E.setStartPosition=function(t,e){var n=this.startPosition;if(n<e&&(n=-1),-1===n||-1===this.lastCurrentTime){var i=t.startTimeOffset;Object(r.isFiniteNumber)(i)?(n=e+i,i<0&&(n+=t.totalduration),n=Math.min(Math.max(e,n),e+t.totalduration),this.log("Start time offset "+i+" found in playlist, adjust startPosition to "+n),this.startPosition=n):t.live?n=this.hls.liveSyncPosition||e:this.startPosition=n=0,this.lastCurrentTime=n}this.nextLoadPosition=n},E.getLoadPosition=function(){var t=this.media,e=0;return this.loadedmetadata&&t?e=t.currentTime:this.nextLoadPosition&&(e=this.nextLoadPosition),e},E.handleFragLoadAborted=function(t,e){this.transmuxer&&"initSegment"!==t.sn&&t.stats.aborted&&(this.warn("Fragment "+t.sn+(e?" part"+e.index:"")+" of level "+t.level+" was aborted"),this.resetFragmentLoading(t))},E.resetFragmentLoading=function(t){this.fragCurrent&&this.fragContextChanged(t)||(this.state=x.IDLE)},E.onFragmentOrKeyLoadError=function(t,e){if(!e.fatal){var n=e.frag;if(n&&n.type===t){this.fragCurrent;var r=this.config;if(this.fragLoadError+1<=r.fragLoadingMaxRetry){if(this.resetLiveStartWhenNotLoaded(n.level))return;var i=Math.min(Math.pow(2,this.fragLoadError)*r.fragLoadingRetryDelay,r.fragLoadingMaxRetryTimeout);this.warn("Fragment "+n.sn+" of "+t+" "+n.level+" failed to load, retrying in "+i+"ms"),this.retryDate=self.performance.now()+i,this.fragLoadError++,this.state=x.FRAG_LOADING_WAITING_RETRY}else e.levelRetry?(t===y.PlaylistLevelType.AUDIO&&(this.fragCurrent=null),this.fragLoadError=0,this.state=x.IDLE):(a.logger.error(e.details+" reaches max retry, redispatch as fatal ..."),e.fatal=!0,this.hls.stopLoad(),this.state=x.ERROR)}}},E.afterBufferFlushed=function(t,e,n){if(t){var r=o.BufferHelper.getBuffered(t);this.fragmentTracker.detectEvictedFragments(e,r,n),this.state===x.ENDED&&this.resetLoadingState()}},E.resetLoadingState=function(){this.fragCurrent=null,this.fragPrevious=null,this.state=x.IDLE},E.resetLiveStartWhenNotLoaded=function(t){if(!this.loadedmetadata){this.startFragRequested=!1;var e=this.levels?this.levels[t].details:null;if(null!=e&&e.live)return this.startPosition=-1,this.setStartPosition(e,0),this.resetLoadingState(),!0;this.nextLoadPosition=this.startPosition}return!1},E.updateLevelTiming=function(t,e,n,r){var i=this,s=n.details;Object.keys(t.elementaryStreams).reduce((function(e,o){var a=t.elementaryStreams[o];if(a){var c=a.endPTS-a.startPTS;if(c<=0)return i.warn("Could not parse fragment "+t.sn+" "+o+" duration reliably ("+c+") resetting transmuxer to fallback to playlist timing"),i.resetTransmuxer(),e||!1;var h=r?0:Object(p.updateFragPTSDTS)(s,t,a.startPTS,a.endPTS,a.startDTS,a.endDTS);return i.hls.trigger(l.Events.LEVEL_PTS_UPDATED,{details:s,level:n,drift:h,type:o,frag:t,start:a.startPTS,end:a.endPTS}),!0}return e}),!1)?(this.state=x.PARSED,this.hls.trigger(l.Events.FRAG_PARSED,{frag:t,part:e})):this.resetLoadingState()},E.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},(w=[{key:"state",get:function(){return this._state},set:function(t){var e=this._state;e!==t&&(this._state=t,this.log(e+"->"+t))}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(i.prototype,w),i}(i.default)},"./src/controller/buffer-controller.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return f}));var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),s=n("./src/utils/logger.ts"),o=n("./src/errors.ts"),a=n("./src/utils/buffer-helper.ts"),l=n("./src/utils/mediasource-helper.ts"),c=n("./src/loader/fragment.ts"),h=n("./src/controller/buffer-operation-queue.ts"),u=Object(l.getMediaSource)(),d=/([ha]vc.)(?:\.[^.,]+)+/,f=function(){function t(t){var e=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var t=e.hls,n=e.media,r=e.mediaSource;s.logger.log("[buffer-controller]: Media source opened"),n&&(e.updateMediaElementDuration(),t.trigger(i.Events.MEDIA_ATTACHED,{media:n})),r&&r.removeEventListener("sourceopen",e._onMediaSourceOpen),e.checkPendingTracks()},this._onMediaSourceClose=function(){s.logger.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){s.logger.log("[buffer-controller]: Media source ended")},this.hls=t,this._initSourceBuffer(),this.registerListeners()}var e=t.prototype;return e.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},e.destroy=function(){this.unregisterListeners(),this.details=null},e.registerListeners=function(){var t=this.hls;t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(i.Events.BUFFER_RESET,this.onBufferReset,this),t.on(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.on(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(i.Events.BUFFER_EOS,this.onBufferEos,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(i.Events.FRAG_PARSED,this.onFragParsed,this),t.on(i.Events.FRAG_CHANGED,this.onFragChanged,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(i.Events.BUFFER_RESET,this.onBufferReset,this),t.off(i.Events.BUFFER_APPENDING,this.onBufferAppending,this),t.off(i.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(i.Events.BUFFER_EOS,this.onBufferEos,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(i.Events.FRAG_PARSED,this.onFragParsed,this),t.off(i.Events.FRAG_CHANGED,this.onFragChanged,this)},e._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new h.default(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]}},e.onManifestParsed=function(t,e){var n=2;(e.audio&&!e.video||!e.altAudio)&&(n=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=n,this.details=null,s.logger.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},e.onMediaAttaching=function(t,e){var n=this.media=e.media;if(n&&u){var r=this.mediaSource=new u;r.addEventListener("sourceopen",this._onMediaSourceOpen),r.addEventListener("sourceended",this._onMediaSourceEnded),r.addEventListener("sourceclose",this._onMediaSourceClose),n.src=self.URL.createObjectURL(r),this._objectUrl=n.src}},e.onMediaDetaching=function(){var t=this.media,e=this.mediaSource,n=this._objectUrl;if(e){if(s.logger.log("[buffer-controller]: media source detaching"),"open"===e.readyState)try{e.endOfStream()}catch(r){s.logger.warn("[buffer-controller]: onMediaDetaching: "+r.message+" while calling endOfStream")}this.onBufferReset(),e.removeEventListener("sourceopen",this._onMediaSourceOpen),e.removeEventListener("sourceended",this._onMediaSourceEnded),e.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(n&&self.URL.revokeObjectURL(n),t.src===n?(t.removeAttribute("src"),t.load()):s.logger.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(i.Events.MEDIA_DETACHED,void 0)},e.onBufferReset=function(){var t=this;this.getSourceBufferTypes().forEach((function(e){var n=t.sourceBuffer[e];try{n&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(n),t.sourceBuffer[e]=void 0)}catch(r){s.logger.warn("[buffer-controller]: Failed to reset the "+e+" buffer",r)}})),this._initSourceBuffer()},e.onBufferCodecs=function(t,e){var n=this,r=this.getSourceBufferTypes().length;Object.keys(e).forEach((function(t){if(r){var i=n.tracks[t];if(i&&"function"==typeof i.buffer.changeType){var s=e[t],o=s.codec,a=s.levelCodec,l=s.container;if((i.levelCodec||i.codec).replace(d,"$1")!==(a||o).replace(d,"$1")){var c=l+";codecs="+(a||o);n.appendChangeType(t,c)}}}else n.pendingTracks[t]=e[t]})),r||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},e.appendChangeType=function(t,e){var n=this,r=this.operationQueue,i={execute:function(){var i=n.sourceBuffer[t];i&&(s.logger.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+e),i.changeType(e)),r.shiftAndExecuteNext(t)},onStart:function(){},onComplete:function(){},onError:function(e){s.logger.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",e)}};r.append(i,t)},e.onBufferAppending=function(t,e){var n=this,r=this.hls,l=this.operationQueue,c=this.tracks,h=e.data,u=e.type,d=e.frag,f=e.part,p=e.chunkMeta,m=p.buffering[u],g=self.performance.now();m.start=g;var v=d.stats.buffering,y=f?f.stats.buffering:null;0===v.start&&(v.start=g),y&&0===y.start&&(y.start=g);var b=c.audio,x="audio"===u&&1===p.id&&"audio/mpeg"===(null==b?void 0:b.container),w={execute:function(){if(m.executeStart=self.performance.now(),x){var t=n.sourceBuffer[u];if(t){var e=d.start-t.timestampOffset;Math.abs(e)>=.1&&(s.logger.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+d.start+" (delta: "+e+") sn: "+d.sn+")"),t.timestampOffset=d.start)}}n.appendExecutor(h,u)},onStart:function(){},onComplete:function(){var t=self.performance.now();m.executeEnd=m.end=t,0===v.first&&(v.first=t),y&&0===y.first&&(y.first=t);var e=n.sourceBuffer,r={};for(var s in e)r[s]=a.BufferHelper.getBuffered(e[s]);n.appendError=0,n.hls.trigger(i.Events.BUFFER_APPENDED,{type:u,frag:d,part:f,chunkMeta:p,parent:d.type,timeRanges:r})},onError:function(t){s.logger.error("[buffer-controller]: Error encountered while trying to append to the "+u+" SourceBuffer",t);var e={type:o.ErrorTypes.MEDIA_ERROR,parent:d.type,details:o.ErrorDetails.BUFFER_APPEND_ERROR,err:t,fatal:!1};t.code===DOMException.QUOTA_EXCEEDED_ERR?e.details=o.ErrorDetails.BUFFER_FULL_ERROR:(n.appendError++,e.details=o.ErrorDetails.BUFFER_APPEND_ERROR,n.appendError>r.config.appendErrorMaxRetry&&(s.logger.error("[buffer-controller]: Failed "+r.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),e.fatal=!0)),r.trigger(i.Events.ERROR,e)}};l.append(w,u)},e.onBufferFlushing=function(t,e){var n=this,r=this.operationQueue,o=function(t){return{execute:n.removeExecutor.bind(n,t,e.startOffset,e.endOffset),onStart:function(){},onComplete:function(){n.hls.trigger(i.Events.BUFFER_FLUSHED,{type:t})},onError:function(e){s.logger.warn("[buffer-controller]: Failed to remove from "+t+" SourceBuffer",e)}}};e.type?r.append(o(e.type),e.type):this.getSourceBufferTypes().forEach((function(t){r.append(o(t),t)}))},e.onFragParsed=function(t,e){var n=this,r=e.frag,o=e.part,a=[],l=o?o.elementaryStreams:r.elementaryStreams;l[c.ElementaryStreamTypes.AUDIOVIDEO]?a.push("audiovideo"):(l[c.ElementaryStreamTypes.AUDIO]&&a.push("audio"),l[c.ElementaryStreamTypes.VIDEO]&&a.push("video")),0===a.length&&s.logger.warn("Fragments must have at least one ElementaryStreamType set. type: "+r.type+" level: "+r.level+" sn: "+r.sn),this.blockBuffers((function(){var t=self.performance.now();r.stats.buffering.end=t,o&&(o.stats.buffering.end=t);var e=o?o.stats:r.stats;n.hls.trigger(i.Events.FRAG_BUFFERED,{frag:r,part:o,stats:e,id:r.type})}),a)},e.onFragChanged=function(t,e){this.flushBackBuffer()},e.onBufferEos=function(t,e){var n=this;this.getSourceBufferTypes().reduce((function(t,r){var i=n.sourceBuffer[r];return e.type&&e.type!==r||i&&!i.ended&&(i.ended=!0,s.logger.log("[buffer-controller]: "+r+" sourceBuffer now EOS")),t&&!(i&&!i.ended)}),!0)&&this.blockBuffers((function(){var t=n.mediaSource;t&&"open"===t.readyState&&t.endOfStream()}))},e.onLevelUpdated=function(t,e){var n=e.details;n.fragments.length&&(this.details=n,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},e.flushBackBuffer=function(){var t=this.hls,e=this.details,n=this.media,s=this.sourceBuffer;if(n&&null!==e){var o=this.getSourceBufferTypes();if(o.length){var l=e.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Object(r.isFiniteNumber)(l)&&!(l<0)){var c=n.currentTime,h=e.levelTargetDuration,u=Math.max(l,h),d=Math.floor(c/h)*h-u;o.forEach((function(n){var r=s[n];if(r){var o=a.BufferHelper.getBuffered(r);o.length>0&&d>o.start(0)&&(t.trigger(i.Events.BACK_BUFFER_REACHED,{bufferEnd:d}),e.live&&t.trigger(i.Events.LIVE_BACK_BUFFER_REACHED,{bufferEnd:d}),t.trigger(i.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:d,type:n}))}}))}}}},e.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,e=this.hls,n=this.media,i=this.mediaSource,o=t.fragments[0].start+t.totalduration,a=n.duration,l=Object(r.isFiniteNumber)(i.duration)?i.duration:0;t.live&&e.config.liveDurationInfinity?(s.logger.log("[buffer-controller]: Media Source duration is set to Infinity"),i.duration=1/0,this.updateSeekableRange(t)):(o>l&&o>a||!Object(r.isFiniteNumber)(a))&&(s.logger.log("[buffer-controller]: Updating Media Source duration to "+o.toFixed(3)),i.duration=o)}},e.updateSeekableRange=function(t){var e=this.mediaSource,n=t.fragments;if(n.length&&t.live&&null!=e&&e.setLiveSeekableRange){var r=Math.max(0,n[0].start),i=Math.max(r,r+t.totalduration);e.setLiveSeekableRange(r,i)}},e.checkPendingTracks=function(){var t=this.bufferCodecEventsExpected,e=this.operationQueue,n=this.pendingTracks,r=Object.keys(n).length;if(r&&!t||2===r){this.createSourceBuffers(n),this.pendingTracks={};var s=this.getSourceBufferTypes();if(0===s.length)return void this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,reason:"could not create source buffer for media codec(s)"});s.forEach((function(t){e.executeNext(t)}))}},e.createSourceBuffers=function(t){var e=this.sourceBuffer,n=this.mediaSource;if(!n)throw Error("createSourceBuffers called when mediaSource was null");var r=0;for(var a in t)if(!e[a]){var l=t[a];if(!l)throw Error("source buffer exists for track "+a+", however track does not");var c=l.levelCodec||l.codec,h=l.container+";codecs="+c;s.logger.log("[buffer-controller]: creating sourceBuffer("+h+")");try{var u=e[a]=n.addSourceBuffer(h),d=a;this.addBufferListener(d,"updatestart",this._onSBUpdateStart),this.addBufferListener(d,"updateend",this._onSBUpdateEnd),this.addBufferListener(d,"error",this._onSBUpdateError),this.tracks[a]={buffer:u,codec:c,container:l.container,levelCodec:l.levelCodec,id:l.id},r++}catch(f){s.logger.error("[buffer-controller]: error while trying to add sourceBuffer: "+f.message),this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:f,mimeType:h})}}r&&this.hls.trigger(i.Events.BUFFER_CREATED,{tracks:this.tracks})},e._onSBUpdateStart=function(t){this.operationQueue.current(t).onStart()},e._onSBUpdateEnd=function(t){var e=this.operationQueue;e.current(t).onComplete(),e.shiftAndExecuteNext(t)},e._onSBUpdateError=function(t,e){s.logger.error("[buffer-controller]: "+t+" SourceBuffer error",e),this.hls.trigger(i.Events.ERROR,{type:o.ErrorTypes.MEDIA_ERROR,details:o.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1});var n=this.operationQueue.current(t);n&&n.onError(e)},e.removeExecutor=function(t,e,n){var i=this.media,o=this.mediaSource,a=this.operationQueue,l=this.sourceBuffer[t];if(!i||!o||!l)return s.logger.warn("[buffer-controller]: Attempting to remove from the "+t+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(t);var c=Object(r.isFiniteNumber)(i.duration)?i.duration:1/0,h=Object(r.isFiniteNumber)(o.duration)?o.duration:1/0,u=Math.max(0,e),d=Math.min(n,c,h);d>u?(s.logger.log("[buffer-controller]: Removing ["+u+","+d+"] from the "+t+" SourceBuffer"),l.remove(u,d)):a.shiftAndExecuteNext(t)},e.appendExecutor=function(t,e){var n=this.operationQueue,r=this.sourceBuffer[e];if(!r)return s.logger.warn("[buffer-controller]: Attempting to append to the "+e+" SourceBuffer, but it does not exist"),void n.shiftAndExecuteNext(e);r.ended=!1,r.appendBuffer(t)},e.blockBuffers=function(t,e){var n=this;if(void 0===e&&(e=this.getSourceBufferTypes()),!e.length)return s.logger.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve(t);var r=this.operationQueue,i=e.map((function(t){return r.appendBlocker(t)}));Promise.all(i).then((function(){t(),e.forEach((function(t){var e=n.sourceBuffer[t];e&&e.updating||r.shiftAndExecuteNext(t)}))}))},e.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},e.addBufferListener=function(t,e,n){var r=this.sourceBuffer[t];if(r){var i=n.bind(this,t);this.listeners[t].push({event:e,listener:i}),r.addEventListener(e,i)}},e.removeBufferListeners=function(t){var e=this.sourceBuffer[t];e&&this.listeners[t].forEach((function(t){e.removeEventListener(t.event,t.listener)}))},t}()},"./src/controller/buffer-operation-queue.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return i}));var r=n("./src/utils/logger.ts"),i=function(){function t(t){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=t}var e=t.prototype;return e.append=function(t,e){var n=this.queues[e];n.push(t),1===n.length&&this.buffers[e]&&this.executeNext(e)},e.insertAbort=function(t,e){this.queues[e].unshift(t),this.executeNext(e)},e.appendBlocker=function(t){var e,n=new Promise((function(t){e=t})),r={execute:e,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(r,t),n},e.executeNext=function(t){var e=this.buffers,n=this.queues,i=e[t],s=n[t];if(s.length){var o=s[0];try{o.execute()}catch(a){r.logger.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(a),i&&i.updating||(s.shift(),this.executeNext(t))}}},e.shiftAndExecuteNext=function(t){this.queues[t].shift(),this.executeNext(t)},e.current=function(t){return this.queues[t][0]},t}()},"./src/controller/cap-level-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts");function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var s=function(){function t(t){this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.hls=void 0,this.streamController=void 0,this.clientRect=void 0,this.hls=t,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var e,n,s,o=t.prototype;return o.setStreamController=function(t){this.streamController=t},o.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},o.registerListeners=function(){var t=this.hls;t.on(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.unregisterListener=function(){var t=this.hls;t.off(r.Events.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(r.Events.BUFFER_CODECS,this.onBufferCodecs,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this)},o.onFpsDropLevelCapping=function(e,n){t.isLevelAllowed(n.droppedLevel,this.restrictedLevels)&&this.restrictedLevels.push(n.droppedLevel)},o.onMediaAttaching=function(t,e){this.media=e.media instanceof HTMLVideoElement?e.media:null},o.onManifestParsed=function(t,e){var n=this.hls;this.restrictedLevels=[],this.firstLevel=e.firstLevel,n.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onBufferCodecs=function(t,e){this.hls.config.capLevelToPlayerSize&&e.video&&this.startCapping()},o.onMediaDetaching=function(){this.stopCapping()},o.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var t=this.hls.levels;if(t.length){var e=this.hls;e.autoLevelCapping=this.getMaxLevel(t.length-1),e.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=e.autoLevelCapping}}},o.getMaxLevel=function(e){var n=this,r=this.hls.levels;if(!r.length)return-1;var i=r.filter((function(r,i){return t.isLevelAllowed(i,n.restrictedLevels)&&i<=e}));return this.clientRect=null,t.getMaxLevelByMediaSize(i,this.mediaWidth,this.mediaHeight)},o.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},o.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},o.getDimensions=function(){if(this.clientRect)return this.clientRect;var t=this.media,e={width:0,height:0};if(t){var n=t.getBoundingClientRect();e.width=n.width,e.height=n.height,e.width||e.height||(e.width=n.right-n.left||t.width||0,e.height=n.bottom-n.top||t.height||0)}return this.clientRect=e,e},t.isLevelAllowed=function(t,e){return void 0===e&&(e=[]),-1===e.indexOf(t)},t.getMaxLevelByMediaSize=function(t,e,n){if(!t||!t.length)return-1;for(var r,i,s=t.length-1,o=0;o<t.length;o+=1){var a=t[o];if((a.width>=e||a.height>=n)&&(r=a,!(i=t[o+1])||r.width!==i.width||r.height!==i.height)){s=o;break}}return s},e=t,s=[{key:"contentScaleFactor",get:function(){var t=1;try{t=self.devicePixelRatio}catch(e){}return t}}],(n=[{key:"mediaWidth",get:function(){return this.getDimensions().width*t.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*t.contentScaleFactor}}])&&i(e.prototype,n),s&&i(e,s),t}();e.default=s},"./src/controller/eme-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts"),i=n("./src/errors.ts"),s=n("./src/utils/logger.ts"),o=n("./src/utils/mediakeys-helper.ts");var a=function(){function t(t){this.hls=void 0,this._widevineLicenseUrl=void 0,this._licenseXhrSetup=void 0,this._licenseResponseCallback=void 0,this._emeEnabled=void 0,this._requestMediaKeySystemAccess=void 0,this._drmSystemOptions=void 0,this._config=void 0,this._mediaKeysList=[],this._media=null,this._hasSetMediaKeys=!1,this._requestLicenseFailureCount=0,this.mediaKeysPromise=null,this._onMediaEncrypted=this.onMediaEncrypted.bind(this),this.hls=t,this._config=t.config,this._widevineLicenseUrl=this._config.widevineLicenseUrl,this._licenseXhrSetup=this._config.licenseXhrSetup,this._licenseResponseCallback=this._config.licenseResponseCallback,this._emeEnabled=this._config.emeEnabled,this._requestMediaKeySystemAccess=this._config.requestMediaKeySystemAccessFunc,this._drmSystemOptions=this._config.drmSystemOptions,this._registerListeners()}var e,n=t.prototype;return n.destroy=function(){this._unregisterListeners(),this.hls=this._onMediaEncrypted=null,this._requestMediaKeySystemAccess=null},n._registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this)},n._unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(r.Events.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this)},n.getLicenseServerUrl=function(t){switch(t){case o.KeySystems.WIDEVINE:if(!this._widevineLicenseUrl)break;return this._widevineLicenseUrl}throw new Error('no license server URL configured for key-system "'+t+'"')},n._attemptKeySystemAccess=function(t,e,n){var r=this,i=function(t,e,n,r){if(t===o.KeySystems.WIDEVINE)return i=n,s=r,a={audioCapabilities:[],videoCapabilities:[]},e.forEach((function(t){a.audioCapabilities.push({contentType:'audio/mp4; codecs="'+t+'"',robustness:s.audioRobustness||""})})),i.forEach((function(t){a.videoCapabilities.push({contentType:'video/mp4; codecs="'+t+'"',robustness:s.videoRobustness||""})})),[a];throw new Error("Unknown key-system: "+t);var i,s,a}(t,e,n,this._drmSystemOptions);s.logger.log("Requesting encrypted media key-system access");var a=this.requestMediaKeySystemAccess(t,i);this.mediaKeysPromise=a.then((function(e){return r._onMediaKeySystemAccessObtained(t,e)})),a.catch((function(e){s.logger.error('Failed to obtain key-system "'+t+'" access:',e)}))},n._onMediaKeySystemAccessObtained=function(t,e){var n=this;s.logger.log('Access for key-system "'+t+'" obtained');var r={mediaKeysSessionInitialized:!1,mediaKeySystemAccess:e,mediaKeySystemDomain:t};this._mediaKeysList.push(r);var i=Promise.resolve().then((function(){return e.createMediaKeys()})).then((function(e){return r.mediaKeys=e,s.logger.log('Media-keys created for key-system "'+t+'"'),n._onMediaKeysCreated(),e}));return i.catch((function(t){s.logger.error("Failed to create media-keys:",t)})),i},n._onMediaKeysCreated=function(){var t=this;this._mediaKeysList.forEach((function(e){e.mediaKeysSession||(e.mediaKeysSession=e.mediaKeys.createSession(),t._onNewMediaKeySession(e.mediaKeysSession))}))},n._onNewMediaKeySession=function(t){var e=this;s.logger.log("New key-system session "+t.sessionId),t.addEventListener("message",(function(n){e._onKeySessionMessage(t,n.message)}),!1)},n._onKeySessionMessage=function(t,e){s.logger.log("Got EME message event, creating license request"),this._requestLicense(e,(function(e){s.logger.log("Received license data (length: "+(e?e.byteLength:e)+"), updating key-session"),t.update(e)}))},n.onMediaEncrypted=function(t){var e=this;if(s.logger.log('Media is encrypted using "'+t.initDataType+'" init data type'),!this.mediaKeysPromise)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been requested"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});var n=function(n){e._media&&(e._attemptSetMediaKeys(n),e._generateRequestWithPreferredKeySession(t.initDataType,t.initData))};this.mediaKeysPromise.then(n).catch(n)},n._attemptSetMediaKeys=function(t){if(!this._media)throw new Error("Attempted to set mediaKeys without first attaching a media element");if(!this._hasSetMediaKeys){var e=this._mediaKeysList[0];if(!e||!e.mediaKeys)return s.logger.error("Fatal: Media is encrypted but no CDM access or no keys have been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_KEYS,fatal:!0});s.logger.log("Setting keys for encrypted media"),this._media.setMediaKeys(e.mediaKeys),this._hasSetMediaKeys=!0}},n._generateRequestWithPreferredKeySession=function(t,e){var n=this,o=this._mediaKeysList[0];if(!o)return s.logger.error("Fatal: Media is encrypted but not any key-system access has been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});if(o.mediaKeysSessionInitialized)s.logger.warn("Key-Session already initialized but requested again");else{var a=o.mediaKeysSession;if(!a)return s.logger.error("Fatal: Media is encrypted but no key-session existing"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!0});if(!e)return s.logger.warn("Fatal: initData required for generating a key session is null"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_INIT_DATA,fatal:!0});s.logger.log('Generating key-session request for "'+t+'" init data type'),o.mediaKeysSessionInitialized=!0,a.generateRequest(t,e).then((function(){s.logger.debug("Key-session generation succeeded")})).catch((function(t){s.logger.error("Error generating key-session request:",t),n.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_SESSION,fatal:!1})}))}},n._createLicenseXhr=function(t,e,n){var r=new XMLHttpRequest;r.responseType="arraybuffer",r.onreadystatechange=this._onLicenseRequestReadyStageChange.bind(this,r,t,e,n);var i=this._licenseXhrSetup;if(i)try{i.call(this.hls,r,t),i=void 0}catch(o){s.logger.error(o)}try{r.readyState||r.open("POST",t,!0),i&&i.call(this.hls,r,t)}catch(o){throw new Error("issue setting up KeySystem license XHR "+o)}return r},n._onLicenseRequestReadyStageChange=function(t,e,n,o){if(4===t.readyState)if(200===t.status){this._requestLicenseFailureCount=0,s.logger.log("License request succeeded");var a=t.response,l=this._licenseResponseCallback;if(l)try{a=l.call(this.hls,t,e)}catch(h){s.logger.error(h)}o(a)}else{if(s.logger.error("License Request XHR failed ("+e+"). Status: "+t.status+" ("+t.statusText+")"),this._requestLicenseFailureCount++,this._requestLicenseFailureCount>3)return void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0});var c=3-this._requestLicenseFailureCount+1;s.logger.warn("Retrying license request, "+c+" attempts left"),this._requestLicense(n,o)}},n._generateLicenseRequestChallenge=function(t,e){if(t.mediaKeySystemDomain===o.KeySystems.WIDEVINE)return e;throw new Error("unsupported key-system: "+t.mediaKeySystemDomain)},n._requestLicense=function(t,e){s.logger.log("Requesting content license for key-system");var n=this._mediaKeysList[0];if(!n)return s.logger.error("Fatal error: Media is encrypted but no key-system access has been obtained yet"),void this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_NO_ACCESS,fatal:!0});try{var o=this.getLicenseServerUrl(n.mediaKeySystemDomain),a=this._createLicenseXhr(o,t,e);s.logger.log("Sending license request to URL: "+o);var l=this._generateLicenseRequestChallenge(n,t);a.send(l)}catch(c){s.logger.error("Failure requesting DRM license: "+c),this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.KEY_SYSTEM_ERROR,details:i.ErrorDetails.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0})}},n.onMediaAttached=function(t,e){if(this._emeEnabled){var n=e.media;this._media=n,n.addEventListener("encrypted",this._onMediaEncrypted)}},n.onMediaDetached=function(){var t=this._media,e=this._mediaKeysList;t&&(t.removeEventListener("encrypted",this._onMediaEncrypted),this._media=null,this._mediaKeysList=[],Promise.all(e.map((function(t){if(t.mediaKeysSession)return t.mediaKeysSession.close().catch((function(){}))}))).then((function(){return t.setMediaKeys(null)})).catch((function(){})))},n.onManifestParsed=function(t,e){if(this._emeEnabled){var n=e.levels.map((function(t){return t.audioCodec})).filter((function(t){return!!t})),r=e.levels.map((function(t){return t.videoCodec})).filter((function(t){return!!t}));this._attemptKeySystemAccess(o.KeySystems.WIDEVINE,n,r)}},(e=[{key:"requestMediaKeySystemAccess",get:function(){if(!this._requestMediaKeySystemAccess)throw new Error("No requestMediaKeySystemAccess function configured");return this._requestMediaKeySystemAccess}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}();e.default=a},"./src/controller/fps-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts"),i=n("./src/utils/logger.ts"),s=function(){function t(t){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=t,this.registerListeners()}var e=t.prototype;return e.setStreamController=function(t){this.streamController=t},e.registerListeners=function(){this.hls.on(r.Events.MEDIA_ATTACHING,this.onMediaAttaching,this)},e.unregisterListeners=function(){this.hls.off(r.Events.MEDIA_ATTACHING,this.onMediaAttaching)},e.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},e.onMediaAttaching=function(t,e){var n=this.hls.config;if(n.capLevelOnFPSDrop){var r=e.media instanceof self.HTMLVideoElement?e.media:null;this.media=r,r&&"function"==typeof r.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}},e.checkFPS=function(t,e,n){var s=performance.now();if(e){if(this.lastTime){var o=s-this.lastTime,a=n-this.lastDroppedFrames,l=e-this.lastDecodedFrames,c=1e3*a/o,h=this.hls;if(h.trigger(r.Events.FPS_DROP,{currentDropped:a,currentDecoded:l,totalDroppedFrames:n}),c>0&&a>h.config.fpsDroppedMonitoringThreshold*l){var u=h.currentLevel;i.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===h.autoLevelCapping||h.autoLevelCapping>=u)&&(u-=1,h.trigger(r.Events.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:h.currentLevel}),h.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=s,this.lastDroppedFrames=n,this.lastDecodedFrames=e}},e.checkFPSInterval=function(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var e=t.getVideoPlaybackQuality();this.checkFPS(t,e.totalVideoFrames,e.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},t}();e.default=s},"./src/controller/fragment-finders.ts":function(t,e,n){n.r(e),n.d(e,"findFragmentByPDT",(function(){return s})),n.d(e,"findFragmentByPTS",(function(){return o})),n.d(e,"fragmentWithinToleranceTest",(function(){return a})),n.d(e,"pdtWithinToleranceTest",(function(){return l})),n.d(e,"findFragWithCC",(function(){return c}));var r=n("./src/polyfills/number.ts"),i=n("./src/utils/binary-search.ts");function s(t,e,n){if(null===e||!Array.isArray(t)||!t.length||!Object(r.isFiniteNumber)(e))return null;if(e<(t[0].programDateTime||0))return null;if(e>=(t[t.length-1].endProgramDateTime||0))return null;n=n||0;for(var i=0;i<t.length;++i){var s=t[i];if(l(e,n,s))return s}return null}function o(t,e,n,r){void 0===n&&(n=0),void 0===r&&(r=0);var s=null;return t?s=e[t.sn-e[0].sn+1]||null:0===n&&0===e[0].start&&(s=e[0]),s&&0===a(n,r,s)?s:i.default.search(e,a.bind(null,n,r))||s}function a(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0);var r=Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return n.start+n.duration-r<=t?1:n.start-r>t&&n.start?-1:0}function l(t,e,n){var r=1e3*Math.min(e,n.duration+(n.deltaPTS?n.deltaPTS:0));return(n.endProgramDateTime||0)-r>t}function c(t,e){return i.default.search(t,(function(t){return t.cc<e?1:t.cc>e?-1:0}))}},"./src/controller/fragment-tracker.ts":function(t,e,n){n.r(e),n.d(e,"FragmentState",(function(){return r})),n.d(e,"FragmentTracker",(function(){return a}));var r,i,s=n("./src/events.ts"),o=n("./src/types/loader.ts");(i=r||(r={})).NOT_LOADED="NOT_LOADED",i.BACKTRACKED="BACKTRACKED",i.APPENDING="APPENDING",i.PARTIAL="PARTIAL",i.OK="OK";var a=function(){function t(t){this.activeFragment=null,this.activeParts=null,this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){var t=this.hls;t.on(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.on(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.on(s.Events.FRAG_LOADED,this.onFragLoaded,this)},e._unregisterListeners=function(){var t=this.hls;t.off(s.Events.BUFFER_APPENDED,this.onBufferAppended,this),t.off(s.Events.FRAG_BUFFERED,this.onFragBuffered,this),t.off(s.Events.FRAG_LOADED,this.onFragLoaded,this)},e.destroy=function(){this._unregisterListeners(),this.fragments=this.timeRanges=null},e.getAppendedFrag=function(t,e){if(e===o.PlaylistLevelType.MAIN){var n=this.activeFragment,r=this.activeParts;if(!n)return null;if(r)for(var i=r.length;i--;){var s=r[i],a=s?s.end:n.appendedPTS;if(s.start<=t&&void 0!==a&&t<=a)return i>9&&(this.activeParts=r.slice(i-9)),s}else if(n.start<=t&&void 0!==n.appendedPTS&&t<=n.appendedPTS)return n}return this.getBufferedFrag(t,e)},e.getBufferedFrag=function(t,e){for(var n=this.fragments,r=Object.keys(n),i=r.length;i--;){var s=n[r[i]];if((null==s?void 0:s.body.type)===e&&s.buffered){var o=s.body;if(o.start<=t&&t<=o.end)return o}}return null},e.detectEvictedFragments=function(t,e,n){var r=this;Object.keys(this.fragments).forEach((function(i){var s=r.fragments[i];if(s)if(s.buffered){var o=s.range[t];o&&o.time.some((function(t){var n=!r.isTimeBuffered(t.startPTS,t.endPTS,e);return n&&r.removeFragment(s.body),n}))}else s.body.type===n&&r.removeFragment(s.body)}))},e.detectPartialFragments=function(t){var e=this,n=this.timeRanges,r=t.frag,i=t.part;if(n&&"initSegment"!==r.sn){var s=c(r),o=this.fragments[s];o&&(Object.keys(n).forEach((function(t){var s=r.elementaryStreams[t];if(s){var a=n[t],l=null!==i||!0===s.partial;o.range[t]=e.getBufferedTimes(r,i,l,a)}})),o.backtrack=o.loaded=null,Object.keys(o.range).length?o.buffered=!0:this.removeFragment(o.body))}},e.fragBuffered=function(t){var e=c(t),n=this.fragments[e];n&&(n.backtrack=n.loaded=null,n.buffered=!0)},e.getBufferedTimes=function(t,e,n,r){for(var i={time:[],partial:n},s=e?e.start:t.start,o=e?e.end:t.end,a=t.minEndPTS||o,l=t.maxStartPTS||s,c=0;c<r.length;c++){var h=r.start(c)-this.bufferPadding,u=r.end(c)+this.bufferPadding;if(l>=h&&a<=u){i.time.push({startPTS:Math.max(s,r.start(c)),endPTS:Math.min(o,r.end(c))});break}if(s<u&&o>h)i.partial=!0,i.time.push({startPTS:Math.max(s,r.start(c)),endPTS:Math.min(o,r.end(c))});else if(o<=h)break}return i},e.getPartialFragment=function(t){var e,n,r,i=null,s=0,o=this.bufferPadding,a=this.fragments;return Object.keys(a).forEach((function(c){var h=a[c];h&&l(h)&&(n=h.body.start-o,r=h.body.end+o,t>=n&&t<=r&&(e=Math.min(t-n,r-t),s<=e&&(i=h.body,s=e)))})),i},e.getState=function(t){var e=c(t),n=this.fragments[e];return n?n.buffered?l(n)?r.PARTIAL:r.OK:n.backtrack?r.BACKTRACKED:r.APPENDING:r.NOT_LOADED},e.backtrack=function(t,e){var n=c(t),r=this.fragments[n];if(!r||r.backtrack)return null;var i=r.backtrack=e||r.loaded;return r.loaded=null,i},e.getBacktrackData=function(t){var e=c(t),n=this.fragments[e];if(n){var r,i=n.backtrack;if(null!=i&&null!==(r=i.payload)&&void 0!==r&&r.byteLength)return i;this.removeFragment(t)}return null},e.isTimeBuffered=function(t,e,n){for(var r,i,s=0;s<n.length;s++){if(r=n.start(s)-this.bufferPadding,i=n.end(s)+this.bufferPadding,t>=r&&e<=i)return!0;if(e<=r)return!1}return!1},e.onFragLoaded=function(t,e){var n=e.frag,r=e.part;if("initSegment"!==n.sn&&!n.bitrateTest&&!r){var i=c(n);this.fragments[i]={body:n,loaded:e,backtrack:null,buffered:!1,range:Object.create(null)}}},e.onBufferAppended=function(t,e){var n=this,r=e.frag,i=e.part,s=e.timeRanges;if(r.type===o.PlaylistLevelType.MAIN)if(this.activeFragment=r,i){var a=this.activeParts;a||(this.activeParts=a=[]),a.push(i)}else this.activeParts=null;this.timeRanges=s,Object.keys(s).forEach((function(t){var e=s[t];if(n.detectEvictedFragments(t,e),!i)for(var o=0;o<e.length;o++)r.appendedPTS=Math.max(e.end(o),r.appendedPTS||0)}))},e.onFragBuffered=function(t,e){this.detectPartialFragments(e)},e.hasFragment=function(t){var e=c(t);return!!this.fragments[e]},e.removeFragmentsInRange=function(t,e,n){var r=this;Object.keys(this.fragments).forEach((function(i){var s=r.fragments[i];if(s&&s.buffered){var o=s.body;o.type===n&&o.start<e&&o.end>t&&r.removeFragment(o)}}))},e.removeFragment=function(t){var e=c(t);t.stats.loaded=0,t.clearElementaryStreamInfo(),delete this.fragments[e]},e.removeAllFragments=function(){this.fragments=Object.create(null),this.activeFragment=null,this.activeParts=null},t}();function l(t){var e,n;return t.buffered&&((null===(e=t.range.video)||void 0===e?void 0:e.partial)||(null===(n=t.range.audio)||void 0===n?void 0:n.partial))}function c(t){return t.type+"_"+t.level+"_"+t.urlId+"_"+t.sn}},"./src/controller/gap-controller.ts":function(t,e,n){n.r(e),n.d(e,"STALL_MINIMUM_DURATION_MS",(function(){return a})),n.d(e,"MAX_START_GAP_JUMP",(function(){return l})),n.d(e,"SKIP_BUFFER_HOLE_STEP_SECONDS",(function(){return c})),n.d(e,"SKIP_BUFFER_RANGE_START",(function(){return h})),n.d(e,"default",(function(){return u}));var r=n("./src/utils/buffer-helper.ts"),i=n("./src/errors.ts"),s=n("./src/events.ts"),o=n("./src/utils/logger.ts"),a=250,l=2,c=.1,h=.05,u=function(){function t(t,e,n,r){this.config=void 0,this.media=void 0,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=t,this.media=e,this.fragmentTracker=n,this.hls=r}var e=t.prototype;return e.destroy=function(){this.hls=this.fragmentTracker=this.media=null},e.poll=function(t){var e=this.config,n=this.media,i=this.stalled,s=n.currentTime,c=n.seeking,h=this.seeking&&!c,u=!this.seeking&&c;if(this.seeking=c,s===t){if((u||h)&&(this.stalled=null),!n.paused&&!n.ended&&0!==n.playbackRate&&r.BufferHelper.getBuffered(n).length){var d=r.BufferHelper.bufferInfo(n,s,0),f=d.len>0,p=d.nextStart||0;if(f||p){if(c){var m=d.len>l,g=!p||p-s>l&&!this.fragmentTracker.getPartialFragment(s);if(m||g)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var v,y=Math.max(p,d.start||0)-s,b=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,x=(null==b||null===(v=b.details)||void 0===v?void 0:v.live)?2*b.details.targetduration:l;if(y>0&&y<=x)return void this._trySkipBufferHole(null)}var w=self.performance.now();if(null!==i){var E=w-i;!c&&E>=a&&this._reportStall(d.len);var _=r.BufferHelper.bufferInfo(n,s,e.maxBufferHole);this._tryFixBufferStall(_,E)}else this.stalled=w}}}else if(this.moved=!0,null!==i){if(this.stallReported){var S=self.performance.now()-i;o.logger.warn("playback not stuck anymore @"+s+", after "+Math.round(S)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}},e._tryFixBufferStall=function(t,e){var n=this.config,r=this.fragmentTracker,i=this.media.currentTime,s=r.getPartialFragment(i);s&&this._trySkipBufferHole(s)||t.len>n.maxBufferHole&&e>1e3*n.highBufferWatchdogPeriod&&(o.logger.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())},e._reportStall=function(t){var e=this.hls,n=this.media;this.stallReported||(this.stallReported=!0,o.logger.warn("Playback stalling at @"+n.currentTime+" due to low buffer (buffer="+t+")"),e.trigger(s.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:t}))},e._trySkipBufferHole=function(t){for(var e=this.config,n=this.hls,a=this.media,l=a.currentTime,u=0,d=r.BufferHelper.getBuffered(a),f=0;f<d.length;f++){var p=d.start(f);if(l+e.maxBufferHole>=u&&l<p){var m=Math.max(p+h,a.currentTime+c);return o.logger.warn("skipping hole, adjusting currentTime from "+l+" to "+m),this.moved=!0,this.stalled=null,a.currentTime=m,t&&n.trigger(s.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,reason:"fragment loaded with buffer holes, seeking from "+l+" to "+m,frag:t}),m}u=d.end(f)}return 0},e._tryNudgeBuffer=function(){var t=this.config,e=this.hls,n=this.media,r=n.currentTime,a=(this.nudgeRetry||0)+1;if(this.nudgeRetry=a,a<t.nudgeMaxRetry){var l=r+a*t.nudgeOffset;o.logger.warn("Nudging 'currentTime' from "+r+" to "+l),n.currentTime=l,e.trigger(s.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1})}else o.logger.error("Playhead still not moving while enough data buffered @"+r+" after "+t.nudgeMaxRetry+" nudges"),e.trigger(s.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0})},t}()},"./src/controller/id3-track-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts"),i=n("./src/utils/texttrack-utils.ts"),s=n("./src/demux/id3.ts"),o=function(){function t(t){this.hls=void 0,this.id3Track=null,this.media=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e.destroy=function(){this._unregisterListeners()},e._registerListeners=function(){var t=this.hls;t.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(r.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e._unregisterListeners=function(){var t=this.hls;t.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(r.Events.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},e.onMediaAttached=function(t,e){this.media=e.media},e.onMediaDetaching=function(){this.id3Track&&(Object(i.clearCurrentCues)(this.id3Track),this.id3Track=null,this.media=null)},e.getID3Track=function(t){if(this.media){for(var e=0;e<t.length;e++){var n=t[e];if("metadata"===n.kind&&"id3"===n.label)return Object(i.sendAddTrackEvent)(n,this.media),n}return this.media.addTextTrack("metadata","id3")}},e.onFragParsingMetadata=function(t,e){if(this.media){var n=e.frag,r=e.samples;this.id3Track||(this.id3Track=this.getID3Track(this.media.textTracks),this.id3Track.mode="hidden");for(var i=self.WebKitDataCue||self.VTTCue||self.TextTrackCue,o=0;o<r.length;o++){var a=s.getID3Frames(r[o].data);if(a){var l=r[o].pts,c=o<r.length-1?r[o+1].pts:n.end;c-l<=0&&(c=l+.25);for(var h=0;h<a.length;h++){var u=a[h];if(!s.isTimeStampFrame(u)){var d=new i(l,c,"");d.value=u,this.id3Track.addCue(d)}}}}}},e.onBufferFlushing=function(t,e){var n=e.startOffset,r=e.endOffset,s=e.type;if(!s||"audio"===s){var o=this.id3Track;o&&Object(i.removeCuesInRange)(o,n,r)}},t}();e.default=o},"./src/controller/latency-controller.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return o}));var r=n("./src/errors.ts"),i=n("./src/events.ts"),s=n("./src/utils/logger.ts");var o=function(){function t(t){var e=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return e.timeupdate()},this.hls=t,this.config=t.config,this.registerListeners()}var e,n=t.prototype;return n.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},n.registerListeners=function(){this.hls.on(i.Events.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(i.Events.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(i.Events.ERROR,this.onError,this)},n.unregisterListeners=function(){this.hls.off(i.Events.MEDIA_ATTACHED,this.onMediaAttached),this.hls.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching),this.hls.off(i.Events.MANIFEST_LOADING,this.onManifestLoading),this.hls.off(i.Events.LEVEL_UPDATED,this.onLevelUpdated),this.hls.off(i.Events.ERROR,this.onError)},n.onMediaAttached=function(t,e){this.media=e.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},n.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},n.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},n.onLevelUpdated=function(t,e){var n=e.details;this.levelDetails=n,n.advanced&&this.timeupdate(),!n.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},n.onError=function(t,e){e.details===r.ErrorDetails.BUFFER_STALLED_ERROR&&(this.stallCount++,s.logger.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},n.timeupdate=function(){var t=this.media,e=this.levelDetails;if(t&&e){this.currentTime=t.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var r=this.config,i=r.lowLatencyMode,s=r.maxLiveSyncPlaybackRate;if(i&&1!==s){var o=this.targetLatency;if(null!==o){var a=n-o,l=a<Math.min(this.maxLatency,o+e.targetduration);if(e.live&&l&&a>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,s)),h=Math.round(2/(1+Math.exp(-.75*a-this.edgeStalled))*20)/20;t.playbackRate=Math.min(c,Math.max(1,h))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},n.estimateLiveEdge=function(){var t=this.levelDetails;return null===t?null:t.edge+t.age},n.computeLatency=function(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},(e=[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var t=this.config,e=this.levelDetails;return void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:e?t.liveMaxLatencyDurationCount*e.targetduration:0}},{key:"targetLatency",get:function(){var t=this.levelDetails;if(null===t)return null;var e=t.holdBack,n=t.partHoldBack,r=t.targetduration,i=this.config,s=i.liveSyncDuration,o=i.liveSyncDurationCount,a=i.lowLatencyMode,l=this.hls.userConfig,c=a&&n||e;(l.liveSyncDuration||l.liveSyncDurationCount||0===c)&&(c=void 0!==s?s:o*r);var h=r;return c+Math.min(1*this.stallCount,h)}},{key:"liveSyncPosition",get:function(){var t=this.estimateLiveEdge(),e=this.targetLatency,n=this.levelDetails;if(null===t||null===e||null===n)return null;var r=n.edge,i=t-e-this.edgeStalled,s=r-n.totalduration,o=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(s,i),o)}},{key:"drift",get:function(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function(){var t=this.levelDetails;if(null===t)return 0;var e=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return Math.max(t.age-e,0)}},{key:"forwardBufferLength",get:function(){var t=this.media,e=this.levelDetails;if(!t||!e)return 0;var n=t.buffered.length;return n?t.buffered.end(n-1):e.edge-this.currentTime}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}()},"./src/controller/level-controller.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return f}));var r=n("./src/types/level.ts"),i=n("./src/events.ts"),s=n("./src/errors.ts"),o=n("./src/utils/codecs.ts"),a=n("./src/controller/level-helper.ts"),l=n("./src/controller/base-playlist-controller.ts"),c=n("./src/types/loader.ts");function h(){return(h=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var d=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),f=function(t){var e,n;function l(e){var n;return(n=t.call(this,e,"[level-controller]")||this)._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.onParsedComplete=void 0,n._registerListeners(),n}n=t,(e=l).prototype=Object.create(n.prototype),e.prototype.constructor=e,u(e,n);var f,p=l.prototype;return p._registerListeners=function(){var t=this.hls;t.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(i.Events.ERROR,this.onError,this)},p._unregisterListeners=function(){var t=this.hls;t.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(i.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(i.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(i.Events.ERROR,this.onError,this)},p.destroy=function(){this._unregisterListeners(),this.manualLevelIndex=-1,this._levels.length=0,t.prototype.destroy.call(this)},p.startLoad=function(){this._levels.forEach((function(t){t.loadError=0})),t.prototype.startLoad.call(this)},p.onManifestLoaded=function(t,e){var n,l,c=[],h=[],u=[],f={},p=!1,m=!1,g=!1;if(e.levels.forEach((function(t){var e=t.attrs;p=p||!(!t.width||!t.height),m=m||!!t.videoCodec,g=g||!!t.audioCodec,d&&t.audioCodec&&-1!==t.audioCodec.indexOf("mp4a.40.34")&&(t.audioCodec=void 0);var n=t.bitrate+"-"+t.attrs.RESOLUTION+"-"+t.attrs.CODECS;(l=f[n])?l.url.push(t.url):(l=new r.Level(t),f[n]=l,c.push(l)),e&&(e.AUDIO&&Object(a.addGroupId)(l,"audio",e.AUDIO),e.SUBTITLES&&Object(a.addGroupId)(l,"text",e.SUBTITLES))})),(p||m)&&g&&(c=c.filter((function(t){var e=t.videoCodec,n=t.width,r=t.height;return!!e||!(!n||!r)}))),c=c.filter((function(t){var e=t.audioCodec,n=t.videoCodec;return(!e||Object(o.isCodecSupportedInMp4)(e,"audio"))&&(!n||Object(o.isCodecSupportedInMp4)(n,"video"))})),e.audioTracks&&(h=e.audioTracks.filter((function(t){return!t.audioCodec||Object(o.isCodecSupportedInMp4)(t.audioCodec,"audio")})),Object(a.assignTrackIdsByGroup)(h)),e.subtitles&&(u=e.subtitles,Object(a.assignTrackIdsByGroup)(u)),c.length>0){n=c[0].bitrate,c.sort((function(t,e){return t.bitrate-e.bitrate})),this._levels=c;for(var v=0;v<c.length;v++)if(c[v].bitrate===n){this._firstLevel=v,this.log("manifest loaded, "+c.length+" level(s) found, first bitrate: "+n);break}var y=g&&!m,b={levels:c,audioTracks:h,subtitleTracks:u,firstLevel:this._firstLevel,stats:e.stats,audio:g,video:m,altAudio:!y&&h.some((function(t){return!!t.url}))};this.hls.trigger(i.Events.MANIFEST_PARSED,b),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:e.url,reason:"no level with compatible codecs found in manifest"})},p.onError=function(e,n){if(t.prototype.onError.call(this,e,n),!n.fatal){var r=n.context,i=this._levels[this.currentLevelIndex];if(r&&(r.type===c.PlaylistContextType.AUDIO_TRACK&&i.audioGroupIds&&r.groupId===i.audioGroupIds[i.urlId]||r.type===c.PlaylistContextType.SUBTITLE_TRACK&&i.textGroupIds&&r.groupId===i.textGroupIds[i.urlId]))this.redundantFailover(this.currentLevelIndex);else{var o,a=!1,l=!0;switch(n.details){case s.ErrorDetails.FRAG_LOAD_ERROR:case s.ErrorDetails.FRAG_LOAD_TIMEOUT:case s.ErrorDetails.KEY_LOAD_ERROR:case s.ErrorDetails.KEY_LOAD_TIMEOUT:if(n.frag){var h=this._levels[n.frag.level];h?(h.fragmentError++,h.fragmentError>this.hls.config.fragLoadingMaxRetry&&(o=n.frag.level)):o=n.frag.level}break;case s.ErrorDetails.LEVEL_LOAD_ERROR:case s.ErrorDetails.LEVEL_LOAD_TIMEOUT:r&&(r.deliveryDirectives&&(l=!1),o=r.level),a=!0;break;case s.ErrorDetails.REMUX_ALLOC_ERROR:o=n.level,a=!0}void 0!==o&&this.recoverLevel(n,o,a,l)}}},p.recoverLevel=function(t,e,n,r){var i=t.details,s=this._levels[e];if(s.loadError++,n){if(!this.retryLoadingOrFail(t))return void(this.currentLevelIndex=-1);t.levelRetry=!0}if(r){var o=s.url.length;if(o>1&&s.loadError<o)t.levelRetry=!0,this.redundantFailover(e);else if(-1===this.manualLevelIndex){var a=0===e?this._levels.length-1:e-1;this.currentLevelIndex!==a&&0===this._levels[a].loadError&&(this.warn(i+": switch to "+a),t.levelRetry=!0,this.hls.nextAutoLevel=a)}}},p.redundantFailover=function(t){var e=this._levels[t],n=e.url.length;if(n>1){var r=(e.urlId+1)%n;this.warn("Switching to redundant URL-id "+r),this._levels.forEach((function(t){t.urlId=r})),this.level=t}},p.onFragLoaded=function(t,e){var n=e.frag;if(void 0!==n&&n.type===c.PlaylistLevelType.MAIN){var r=this._levels[n.level];void 0!==r&&(r.fragmentError=0,r.loadError=0)}},p.onLevelLoaded=function(t,e){var n,r,i=e.level,s=e.details,o=this._levels[i];if(!o)return this.warn("Invalid level index "+i),void(null!==(r=e.deliveryDirectives)&&void 0!==r&&r.skip&&(s.deltaUpdateFailed=!0));i===this.currentLevelIndex?(0===o.fragmentError&&(o.loadError=0,this.retryCount=0),this.playlistLoaded(i,e,o.details)):null!==(n=e.deliveryDirectives)&&void 0!==n&&n.skip&&(s.deltaUpdateFailed=!0)},p.onAudioTrackSwitched=function(t,e){var n=this.hls.levels[this.currentLevelIndex];if(n&&n.audioGroupIds){for(var r=-1,i=this.hls.audioTracks[e.id].groupId,s=0;s<n.audioGroupIds.length;s++)if(n.audioGroupIds[s]===i){r=s;break}r!==n.urlId&&(n.urlId=r,this.startLoad())}},p.loadPlaylist=function(t){var e=this.currentLevelIndex,n=this._levels[e];if(this.canLoad&&n&&n.url.length>0){var r=n.urlId,s=n.url[r];if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Attempt loading level index "+e+(t?" at sn "+t.msn+" part "+t.part:"")+" with URL-id "+r+" "+s),this.clearTimer(),this.hls.trigger(i.Events.LEVEL_LOADING,{url:s,level:e,id:r,deliveryDirectives:t||null})}},p.removeLevel=function(t,e){var n=function(t,n){return n!==e},r=this._levels.filter((function(r,i){return i!==t||r.url.length>1&&void 0!==e&&(r.url=r.url.filter(n),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(n)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(n)),r.urlId=0,!0)})).map((function(t,e){var n=t.details;return null!=n&&n.fragments&&n.fragments.forEach((function(t){t.level=e})),t}));this._levels=r,this.hls.trigger(i.Events.LEVELS_UPDATED,{levels:r})},(f=[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(t){var e,n=this._levels;if(0!==n.length&&(this.currentLevelIndex!==t||null===(e=n[t])||void 0===e||!e.details)){if(t<0||t>=n.length){var r=t<0;if(this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.OTHER_ERROR,details:s.ErrorDetails.LEVEL_SWITCH_ERROR,level:t,fatal:r,reason:"invalid level idx"}),r)return;t=Math.min(t,n.length-1)}this.clearTimer();var o=this.currentLevelIndex,a=n[o],l=n[t];this.log("switching to level "+t+" from "+o),this.currentLevelIndex=t;var c=h({},l,{level:t,maxBitrate:l.maxBitrate,uri:l.uri,urlId:l.urlId});delete c._urlId,this.hls.trigger(i.Events.LEVEL_SWITCHING,c);var u=l.details;if(!u||u.live){var d=this.switchParams(l.uri,null==a?void 0:a.details);this.loadPlaylist(d)}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(t){this.manualLevelIndex=t,void 0===this._startLevel&&(this._startLevel=t),-1!==t&&(this.level=t)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(t){this._firstLevel=t}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0!==t?t:this._firstLevel}return this._startLevel},set:function(t){this._startLevel=t}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(t){this.level=t,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=t)}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(l.prototype,f),l}(l.default)},"./src/controller/level-helper.ts":function(t,e,n){n.r(e),n.d(e,"addGroupId",(function(){return s})),n.d(e,"assignTrackIdsByGroup",(function(){return o})),n.d(e,"updatePTS",(function(){return a})),n.d(e,"updateFragPTSDTS",(function(){return c})),n.d(e,"mergeDetails",(function(){return h})),n.d(e,"mapPartIntersection",(function(){return u})),n.d(e,"mapFragmentIntersection",(function(){return d})),n.d(e,"adjustSliding",(function(){return f})),n.d(e,"addSliding",(function(){return p})),n.d(e,"computeReloadInterval",(function(){return m})),n.d(e,"getFragmentWithSN",(function(){return g})),n.d(e,"getPartWith",(function(){return v}));var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts");function s(t,e,n){switch(e){case"audio":t.audioGroupIds||(t.audioGroupIds=[]),t.audioGroupIds.push(n);break;case"text":t.textGroupIds||(t.textGroupIds=[]),t.textGroupIds.push(n)}}function o(t){var e={};t.forEach((function(t){var n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++}))}function a(t,e,n){l(t[e],t[n])}function l(t,e){var n=e.startPTS;if(Object(r.isFiniteNumber)(n)){var i,s=0;e.sn>t.sn?(s=n-t.start,i=t):(s=t.start-n,i=e),i.duration!==s&&(i.duration=s)}else e.sn>t.sn?t.cc===e.cc&&t.minEndPTS?e.start=t.start+(t.minEndPTS-t.start):e.start=t.start+t.duration:e.start=Math.max(t.start-e.duration,0)}function c(t,e,n,s,o,a){s-n<=0&&(i.logger.warn("Fragment should have a positive duration",e),s=n+e.duration,a=o+e.duration);var c=n,h=s,u=e.startPTS,d=e.endPTS;if(Object(r.isFiniteNumber)(u)){var f=Math.abs(u-n);Object(r.isFiniteNumber)(e.deltaPTS)?e.deltaPTS=Math.max(f,e.deltaPTS):e.deltaPTS=f,c=Math.max(n,u),n=Math.min(n,u),o=Math.min(o,e.startDTS),h=Math.min(s,d),s=Math.max(s,d),a=Math.max(a,e.endDTS)}e.duration=s-n;var p=n-e.start;e.appendedPTS=s,e.start=e.startPTS=n,e.maxStartPTS=c,e.startDTS=o,e.endPTS=s,e.minEndPTS=h,e.endDTS=a;var m,g=e.sn;if(!t||g<t.startSN||g>t.endSN)return 0;var v=g-t.startSN,y=t.fragments;for(y[v]=e,m=v;m>0;m--)l(y[m],y[m-1]);for(m=v;m<y.length-1;m++)l(y[m],y[m+1]);return t.fragmentHint&&l(y[y.length-1],t.fragmentHint),t.PTSKnown=t.alignedSliding=!0,p}function h(t,e){for(var n=null,s=t.fragments,o=s.length-1;o>=0;o--){var a=s[o].initSegment;if(a){n=a;break}}t.fragmentHint&&delete t.fragmentHint.endPTS;var l,h=0;if(d(t,e,(function(t,i){var s;t.relurl&&(h=t.cc-i.cc),Object(r.isFiniteNumber)(t.startPTS)&&Object(r.isFiniteNumber)(t.endPTS)&&(i.start=i.startPTS=t.startPTS,i.startDTS=t.startDTS,i.appendedPTS=t.appendedPTS,i.maxStartPTS=t.maxStartPTS,i.endPTS=t.endPTS,i.endDTS=t.endDTS,i.minEndPTS=t.minEndPTS,i.duration=t.endPTS-t.startPTS,i.duration&&(l=i),e.PTSKnown=e.alignedSliding=!0),i.elementaryStreams=t.elementaryStreams,i.loader=t.loader,i.stats=t.stats,i.urlId=t.urlId,t.initSegment?(i.initSegment=t.initSegment,n=t.initSegment):i.initSegment&&i.initSegment.relurl!=(null===(s=n)||void 0===s?void 0:s.relurl)||(i.initSegment=n)})),e.skippedSegments&&(e.deltaUpdateFailed=e.fragments.some((function(t){return!t})),e.deltaUpdateFailed)){i.logger.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var p=e.skippedSegments;p--;)e.fragments.shift();e.startSN=e.fragments[0].sn,e.startCC=e.fragments[0].cc}var m=e.fragments;if(h){i.logger.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<m.length;g++)m[g].cc+=h}e.skippedSegments&&(e.startCC=e.fragments[0].cc),u(t.partList,e.partList,(function(t,e){e.elementaryStreams=t.elementaryStreams,e.stats=t.stats})),l?c(e,l,l.startPTS,l.endPTS,l.startDTS,l.endDTS):f(t,e),m.length&&(e.totalduration=e.edge-m[0].start),e.driftStartTime=t.driftStartTime,e.driftStart=t.driftStart;var v=e.advancedDateTime;if(e.advanced&&v){var y=e.edge;e.driftStart||(e.driftStartTime=v,e.driftStart=y),e.driftEndTime=v,e.driftEnd=y}else e.driftEndTime=t.driftEndTime,e.driftEnd=t.driftEnd,e.advancedDateTime=t.advancedDateTime}function u(t,e,n){if(t&&e)for(var r=0,i=0,s=t.length;i<=s;i++){var o=t[i],a=e[i+r];o&&a&&o.index===a.index&&o.fragment.sn===a.fragment.sn?n(o,a):r--}}function d(t,e,n){for(var r=e.skippedSegments,i=Math.max(t.startSN,e.startSN)-e.startSN,s=(t.fragmentHint?1:0)+(r?e.endSN:Math.min(t.endSN,e.endSN))-e.startSN,o=e.startSN-t.startSN,a=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,c=i;c<=s;c++){var h=l[o+c],u=a[c];r&&!u&&c<r&&(u=e.fragments[c]=h),h&&u&&n(h,u)}}function f(t,e){var n=e.startSN+e.skippedSegments-t.startSN,r=t.fragments;n<0||n>=r.length||p(e,r[n].start)}function p(t,e){if(e){for(var n=t.fragments,r=t.skippedSegments;r<n.length;r++)n[r].start+=e;t.fragmentHint&&(t.fragmentHint.start+=e)}}function m(t,e){var n,r=1e3*t.levelTargetDuration,i=r/2,s=t.age,o=s>0&&s<3*r,a=e.loading.end-e.loading.start,l=t.availabilityDelay;if(!1===t.updated)if(o){var c=333*t.misses;n=Math.max(Math.min(i,2*a),c),t.availabilityDelay=(t.availabilityDelay||0)+n}else n=i;else o?(l=Math.min(l||r/2,s),t.availabilityDelay=l,n=l+r-s):n=r-a;return Math.round(n)}function g(t,e,n){if(!t||!t.details)return null;var r=t.details,i=r.fragments[e-r.startSN];return i||((i=r.fragmentHint)&&i.sn===e?i:e<r.startSN&&n&&n.sn===e?n:null)}function v(t,e,n){if(!t||!t.details)return null;var r=t.details.partList;if(r)for(var i=r.length;i--;){var s=r[i];if(s.index===n&&s.fragment.sn===e)return s}return null}},"./src/controller/stream-controller.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return v}));var r=n("./src/polyfills/number.ts"),i=n("./src/controller/base-stream-controller.ts"),s=n("./src/is-supported.ts"),o=n("./src/events.ts"),a=n("./src/utils/buffer-helper.ts"),l=n("./src/controller/fragment-tracker.ts"),c=n("./src/types/loader.ts"),h=n("./src/loader/fragment.ts"),u=n("./src/demux/transmuxer-interface.ts"),d=n("./src/types/transmuxer.ts"),f=n("./src/controller/gap-controller.ts"),p=n("./src/errors.ts"),m=n("./src/utils/logger.ts");function g(t,e){return(g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var v=function(t){var e,n;function v(e,n){var r;return(r=t.call(this,e,n,"[stream-controller]")||this).audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.stalled=!1,r.couldBacktrack=!1,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}n=t,(e=v).prototype=Object.create(n.prototype),e.prototype.constructor=e,g(e,n);var y,b=v.prototype;return b._registerListeners=function(){var t=this.hls;t.on(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(o.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(o.Events.ERROR,this.onError,this),t.on(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.on(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b._unregisterListeners=function(){var t=this.hls;t.off(o.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(o.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(o.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(o.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(o.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(o.Events.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(o.Events.ERROR,this.onError,this),t.off(o.Events.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(o.Events.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(o.Events.BUFFER_CREATED,this.onBufferCreated,this),t.off(o.Events.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(o.Events.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(o.Events.FRAG_BUFFERED,this.onFragBuffered,this)},b.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},b.startLoad=function(t){if(this.levels){var e=this.lastCurrentTime,n=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var r=n.startLevel;-1===r&&(n.config.testBandwidth?(r=0,this.bitrateTest=!0):r=n.nextAutoLevel),this.level=n.nextLoadLevel=r,this.loadedmetadata=!1}e>0&&-1===t&&(this.log("Override startPosition with lastCurrentTime @"+e.toFixed(3)),t=e),this.state=i.State.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=t,this.tick()}else this._forceStartLoad=!0,this.state=i.State.STOPPED},b.stopLoad=function(){this._forceStartLoad=!1,t.prototype.stopLoad.call(this)},b.doTick=function(){switch(this.state){case i.State.IDLE:this.doTickIdle();break;case i.State.WAITING_LEVEL:var t,e=this.levels,n=this.level,r=null==e||null===(t=e[n])||void 0===t?void 0:t.details;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=i.State.IDLE;break}break;case i.State.FRAG_LOADING_WAITING_RETRY:var s,o=self.performance.now(),a=this.retryDate;(!a||o>=a||null!==(s=this.media)&&void 0!==s&&s.seeking)&&(this.log("retryDate reached, switch back to IDLE state"),this.state=i.State.IDLE)}this.onTickEnd()},b.onTickEnd=function(){t.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},b.doTickIdle=function(){var t,e,n=this.hls,r=this.levelLastLoaded,s=this.levels,a=this.media,u=n.config,d=n.nextLoadLevel;if(null!==r&&(a||!this.startFragRequested&&u.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&s&&s[d]){var f=s[d];this.level=n.nextLoadLevel=d;var p=f.details;if(!p||this.state===i.State.WAITING_LEVEL||p.live&&this.levelLastLoaded!==d)this.state=i.State.WAITING_LEVEL;else{var m=this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:a,c.PlaylistLevelType.MAIN);if(null!==m&&!(m.len>=this.getMaxBufferLength(f.maxBitrate))){if(this._streamEnded(m,p)){var g={};return this.altAudio&&(g.type="video"),this.hls.trigger(o.Events.BUFFER_EOS,g),void(this.state=i.State.ENDED)}var v=m.end,y=this.getNextFragment(v,p);if(this.couldBacktrack&&!this.fragPrevious&&y&&"initSegment"!==y.sn){var b=y.sn-p.startSN;b>1&&(y=p.fragments[b-1],this.fragmentTracker.removeFragment(y))}if(y&&this.fragmentTracker.getState(y)===l.FragmentState.OK&&this.nextLoadPosition>v){var x=this.audioOnly&&!this.altAudio?h.ElementaryStreamTypes.AUDIO:h.ElementaryStreamTypes.VIDEO;this.afterBufferFlushed(a,x,c.PlaylistLevelType.MAIN),y=this.getNextFragment(this.nextLoadPosition,p)}y&&(!y.initSegment||y.initSegment.data||this.bitrateTest||(y=y.initSegment),"identity"!==(null===(t=y.decryptdata)||void 0===t?void 0:t.keyFormat)||null!==(e=y.decryptdata)&&void 0!==e&&e.key?this.loadFragment(y,p,v):this.loadKey(y,p))}}}},b.loadFragment=function(e,n,r){var i,s=this.fragmentTracker.getState(e);if(this.fragCurrent=e,s===l.FragmentState.BACKTRACKED){var o=this.fragmentTracker.getBacktrackData(e);if(o)return this._handleFragmentLoadProgress(o),void this._handleFragmentLoadComplete(o);s=l.FragmentState.NOT_LOADED}s===l.FragmentState.NOT_LOADED||s===l.FragmentState.PARTIAL?"initSegment"===e.sn?this._loadInitSegment(e):this.bitrateTest?(e.bitrateTest=!0,this.log("Fragment "+e.sn+" of level "+e.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(e)):(this.startFragRequested=!0,t.prototype.loadFragment.call(this,e,n,r)):s===l.FragmentState.APPENDING?this.reduceMaxBufferLength(e.duration)&&this.fragmentTracker.removeFragment(e):0===(null===(i=this.media)||void 0===i?void 0:i.buffered.length)&&this.fragmentTracker.removeAllFragments()},b.getAppendedFrag=function(t){var e=this.fragmentTracker.getAppendedFrag(t,c.PlaylistLevelType.MAIN);return e&&"fragment"in e?e.fragment:e},b.getBufferedFrag=function(t){return this.fragmentTracker.getBufferedFrag(t,c.PlaylistLevelType.MAIN)},b.followingBufferedFrag=function(t){return t?this.getBufferedFrag(t.end+.5):null},b.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},b.nextLevelSwitch=function(){var t=this.levels,e=this.media;if(null!=e&&e.readyState){var n,r=this.getAppendedFrag(e.currentTime);if(r&&r.start>1&&this.flushMainBuffer(0,r.start-1),!e.paused&&t){var i=t[this.hls.nextLoadLevel],s=this.fragLastKbps;n=s&&this.fragCurrent?this.fragCurrent.duration*i.maxBitrate/(1e3*s)+1:0}else n=0;var o=this.getBufferedFrag(e.currentTime+n);if(o){var a=this.followingBufferedFrag(o);if(a){this.abortCurrentFrag();var l=a.maxStartPTS?a.maxStartPTS:a.start,c=a.duration,h=Math.max(o.end,l+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,.5*c),.75*c));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}},b.abortCurrentFrag=function(){var t=this.fragCurrent;this.fragCurrent=null,null!=t&&t.loader&&t.loader.abort(),this.state===i.State.KEY_LOADING&&(this.state=i.State.IDLE),this.nextLoadPosition=this.getLoadPosition()},b.flushMainBuffer=function(e,n){t.prototype.flushMainBuffer.call(this,e,n,this.altAudio?"video":null)},b.onMediaAttached=function(e,n){t.prototype.onMediaAttached.call(this,e,n);var r=n.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),r.addEventListener("playing",this.onvplaying),r.addEventListener("seeked",this.onvseeked),this.gapController=new f.default(this.config,r,this.fragmentTracker,this.hls)},b.onMediaDetaching=function(){var e=this.media;e&&(e.removeEventListener("playing",this.onvplaying),e.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),t.prototype.onMediaDetaching.call(this)},b.onMediaPlaying=function(){this.tick()},b.onMediaSeeked=function(){var t=this.media,e=t?t.currentTime:null;Object(r.isFiniteNumber)(e)&&this.log("Media seeked to "+e.toFixed(3)),this.tick()},b.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(o.Events.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=this.stalled=!1,this.startPosition=this.lastCurrentTime=0,this.fragPlaying=null},b.onManifestParsed=function(t,e){var n,r=!1,i=!1;e.levels.forEach((function(t){(n=t.audioCodec)&&(-1!==n.indexOf("mp4a.40.2")&&(r=!0),-1!==n.indexOf("mp4a.40.5")&&(i=!0))})),this.audioCodecSwitch=r&&i&&!Object(s.changeTypeSupported)(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=e.levels,this.startFragRequested=!1},b.onLevelLoading=function(t,e){var n=this.levels;if(n&&this.state===i.State.IDLE){var r=n[e.level];(!r.details||r.details.live&&this.levelLastLoaded!==e.level||this.waitForCdnTuneIn(r.details))&&(this.state=i.State.WAITING_LEVEL)}},b.onLevelLoaded=function(t,e){var n,r=this.levels,s=e.level,a=e.details,l=a.totalduration;if(r){this.log("Level "+s+" loaded ["+a.startSN+","+a.endSN+"], cc ["+a.startCC+", "+a.endCC+"] duration:"+l);var c=this.fragCurrent;!c||this.state!==i.State.FRAG_LOADING&&this.state!==i.State.FRAG_LOADING_WAITING_RETRY||c.level!==e.level&&c.loader&&(this.state=i.State.IDLE,c.loader.abort());var h=r[s],u=0;if(a.live||null!==(n=h.details)&&void 0!==n&&n.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,h.details)}if(h.details=a,this.levelLastLoaded=s,this.hls.trigger(o.Events.LEVEL_UPDATED,{details:a,level:s}),this.state===i.State.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=i.State.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}else this.warn("Levels were reset while loading level "+s)},b._handleFragmentLoadProgress=function(t){var e,n=t.frag,r=t.part,i=t.payload,s=this.levels;if(s){var o=s[n.level],a=o.details;if(a){var l=o.videoCodec,h=a.PTSKnown||!a.live,f=null===(e=n.initSegment)||void 0===e?void 0:e.data,p=this._getAudioCodec(o),m=this.transmuxer=this.transmuxer||new u.default(this.hls,c.PlaylistLevelType.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),g=r?r.index:-1,v=-1!==g,y=new d.ChunkMetadata(n.level,n.sn,n.stats.chunkCount,i.byteLength,g,v),b=this.initPTS[n.cc];m.push(i,f,p,l,n,r,a.totalduration,h,y,b)}else this.warn("Dropping fragment "+n.sn+" of level "+n.level+" after level details were reset")}else this.warn("Levels were reset while fragment load was in progress. Fragment "+n.sn+" of level "+n.level+" will not be buffered")},b.onAudioTrackSwitching=function(t,e){var n=this.altAudio,r=!!e.url,i=e.id;if(!r){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var s=this.fragCurrent;null!=s&&s.loader&&(this.log("Switching to main audio track, cancel main fragment load"),s.loader.abort()),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;n&&a.trigger(o.Events.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:"audio"}),a.trigger(o.Events.AUDIO_TRACK_SWITCHED,{id:i})}},b.onAudioTrackSwitched=function(t,e){var n=e.id,r=!!this.hls.audioTracks[n].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=i)}this.altAudio=r,this.tick()},b.onBufferCreated=function(t,e){var n,r,i=e.tracks,s=!1;for(var o in i){var a=i[o];if("main"===a.id){if(r=o,n=a,"video"===o){var l=i[o];l&&(this.videoBuffer=l.buffer)}}else s=!0}s&&n?(this.log("Alternate track found, use "+r+".buffered to schedule main fragment loading"),this.mediaBuffer=n.buffer):this.mediaBuffer=this.media},b.onFragBuffered=function(t,e){var n=e.frag,r=e.part;if(!n||n.type===c.PlaylistLevelType.MAIN){if(this.fragContextChanged(n))return this.warn("Fragment "+n.sn+(r?" p: "+r.index:"")+" of level "+n.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===i.State.PARSED&&(this.state=i.State.IDLE));var s=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*s.total/(s.buffering.end-s.loading.first)),"initSegment"!==n.sn&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}},b.onError=function(t,e){switch(e.details){case p.ErrorDetails.FRAG_LOAD_ERROR:case p.ErrorDetails.FRAG_LOAD_TIMEOUT:case p.ErrorDetails.KEY_LOAD_ERROR:case p.ErrorDetails.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(c.PlaylistLevelType.MAIN,e);break;case p.ErrorDetails.LEVEL_LOAD_ERROR:case p.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==i.State.ERROR&&(e.fatal?(this.warn(""+e.details),this.state=i.State.ERROR):e.levelRetry||this.state!==i.State.WAITING_LEVEL||(this.state=i.State.IDLE));break;case p.ErrorDetails.BUFFER_FULL_ERROR:if("main"===e.parent&&(this.state===i.State.PARSING||this.state===i.State.PARSED)){var n=!0,r=this.getFwdBufferInfo(this.media,c.PlaylistLevelType.MAIN);r&&r.len>.5&&(n=!this.reduceMaxBufferLength(r.len)),n&&(this.warn("buffer full error also media.currentTime is not buffered, flush main"),this.immediateLevelSwitch()),this.resetLoadingState()}}},b.checkBuffer=function(){var t=this.media,e=this.gapController;if(t&&e&&t.readyState){var n=a.BufferHelper.getBuffered(t);!this.loadedmetadata&&n.length?(this.loadedmetadata=!0,this.seekToStartPos()):e.poll(this.lastCurrentTime),this.lastCurrentTime=t.currentTime}},b.onFragLoadEmergencyAborted=function(){this.state=i.State.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},b.onBufferFlushed=function(t,e){var n=e.type;if(n!==h.ElementaryStreamTypes.AUDIO||this.audioOnly&&!this.altAudio){var r=(n===h.ElementaryStreamTypes.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(r,n,c.PlaylistLevelType.MAIN)}},b.onLevelsUpdated=function(t,e){this.levels=e.levels},b.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},b.seekToStartPos=function(){var t=this.media,e=t.currentTime,n=this.startPosition;if(n>=0&&e<n){if(t.seeking)return void m.logger.log("could not seek to "+n+", already seeking at "+e);var r=a.BufferHelper.getBuffered(t),i=(r.length?r.start(0):0)-n;i>0&&i<this.config.maxBufferHole&&(m.logger.log("adjusting start position by "+i+" to match buffer start"),n+=i,this.startPosition=n),this.log("seek to target start position "+n+" from current time "+e),t.currentTime=n}},b._getAudioCodec=function(t){var e=this.config.defaultAudioCodec||t.audioCodec;return this.audioCodecSwap&&e&&(this.log("Swapping audio codec"),e=-1!==e.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),e},b._loadBitrateTestFrag=function(t){var e=this;this._doFragLoad(t).then((function(n){var r=e.hls;if(n&&!r.nextLoadLevel&&!e.fragContextChanged(t)){e.fragLoadError=0,e.state=i.State.IDLE,e.startFragRequested=!1,e.bitrateTest=!1;var s=t.stats;s.parsing.start=s.parsing.end=s.buffering.start=s.buffering.end=self.performance.now(),r.trigger(o.Events.FRAG_LOADED,n)}}))},b._handleTransmuxComplete=function(t){var e,n="main",s=this.hls,a=t.remuxResult,l=t.chunkMeta,c=this.getCurrentContext(l);if(!c)return this.warn("The loading context changed while buffering fragment "+l.sn+" of level "+l.level+". This chunk will not be buffered."),void this.resetLiveStartWhenNotLoaded(l.level);var u=c.frag,d=c.part,f=c.level,p=a.video,m=a.text,g=a.id3,v=a.initSegment,y=this.altAudio?void 0:a.audio;if(!this.fragContextChanged(u)){if(this.state=i.State.PARSING,v){v.tracks&&(this._bufferInitSegment(f,v.tracks,u,l),s.trigger(o.Events.FRAG_PARSING_INIT_SEGMENT,{frag:u,id:n,tracks:v.tracks}));var b=v.initPTS,x=v.timescale;Object(r.isFiniteNumber)(b)&&(this.initPTS[u.cc]=b,s.trigger(o.Events.INIT_PTS_FOUND,{frag:u,id:n,initPTS:b,timescale:x}))}if(p&&!1!==a.independent){if(f.details){var w=p.startPTS,E=p.endPTS,_=p.startDTS,S=p.endDTS;if(d)d.elementaryStreams[p.type]={startPTS:w,endPTS:E,startDTS:_,endDTS:S};else if(p.firstKeyFrame&&p.independent&&(this.couldBacktrack=!0),p.dropped&&p.independent){if(this.getLoadPosition()+this.config.maxBufferHole<w)return void this.backtrack(u);u.setElementaryStreamInfo(p.type,u.start,E,u.start,S,!0)}u.setElementaryStreamInfo(p.type,w,E,_,S),this.bufferFragmentData(p,u,d,l)}}else if(!1===a.independent)return void this.backtrack(u);if(y){var T=y.startPTS,k=y.endPTS,A=y.startDTS,C=y.endDTS;d&&(d.elementaryStreams[h.ElementaryStreamTypes.AUDIO]={startPTS:T,endPTS:k,startDTS:A,endDTS:C}),u.setElementaryStreamInfo(h.ElementaryStreamTypes.AUDIO,T,k,A,C),this.bufferFragmentData(y,u,d,l)}if(null!=g&&null!==(e=g.samples)&&void 0!==e&&e.length){var R={frag:u,id:n,samples:g.samples};s.trigger(o.Events.FRAG_PARSING_METADATA,R)}if(m){var M={frag:u,id:n,samples:m.samples};s.trigger(o.Events.FRAG_PARSING_USERDATA,M)}}},b._bufferInitSegment=function(t,e,n,r){var s=this;if(this.state===i.State.PARSING){this.audioOnly=!!e.audio&&!e.video,this.altAudio&&!this.audioOnly&&delete e.audio;var a=e.audio,l=e.video,c=e.audiovideo;if(a){var h=t.audioCodec,u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(h&&(h=-1!==h.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===u.indexOf("firefox")&&(h="mp4a.40.5")),-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(h="mp4a.40.2",this.log("Android: force audio codec to "+h)),t.audioCodec&&t.audioCodec!==h&&this.log('Swapping manifest audio codec "'+t.audioCodec+'" for "'+h+'"'),a.levelCodec=h,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(h||"")+"/"+(t.audioCodec||"")+"/"+a.codec+"]")}l&&(l.levelCodec=t.videoCodec,l.id="main",this.log("Init video buffer, container:"+l.container+", codecs[level/parsed]=["+(t.videoCodec||"")+"/"+l.codec+"]")),c&&this.log("Init audiovideo buffer, container:"+c.container+", codecs[level/parsed]=["+(t.attrs.CODECS||"")+"/"+c.codec+"]"),this.hls.trigger(o.Events.BUFFER_CODECS,e),Object.keys(e).forEach((function(t){var i=e[t].initSegment;null!=i&&i.byteLength&&s.hls.trigger(o.Events.BUFFER_APPENDING,{type:t,data:i,frag:n,part:null,chunkMeta:r,parent:n.type})})),this.tick()}},b.backtrack=function(t){this.couldBacktrack=!0,this.resetTransmuxer(),this.flushBufferGap(t);var e=this.fragmentTracker.backtrack(t);this.fragPrevious=null,this.nextLoadPosition=t.start,e?this.resetFragmentLoading(t):this.state=i.State.BACKTRACKING},b.checkFragmentChanged=function(){var t=this.media,e=null;if(t&&t.readyState>1&&!1===t.seeking){var n=t.currentTime;if(a.BufferHelper.isBuffered(t,n)?e=this.getAppendedFrag(n):a.BufferHelper.isBuffered(t,n+.1)&&(e=this.getAppendedFrag(n+.1)),e){var r=this.fragPlaying,i=e.level;r&&e.sn===r.sn&&r.level===i&&e.urlId===r.urlId||(this.hls.trigger(o.Events.FRAG_CHANGED,{frag:e}),r&&r.level===i||this.hls.trigger(o.Events.LEVEL_SWITCHED,{level:i}),this.fragPlaying=e)}}},(y=[{key:"nextLevel",get:function(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentLevel",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);if(e)return e.level}return-1}},{key:"nextBufferedFrag",get:function(){var t=this.media;if(t){var e=this.getAppendedFrag(t.currentTime);return this.followingBufferedFrag(e)}return null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(v.prototype,y),v}(i.default)},"./src/controller/subtitle-stream-controller.ts":function(t,e,n){n.r(e),n.d(e,"SubtitleStreamController",(function(){return p}));var r=n("./src/events.ts"),i=n("./src/utils/logger.ts"),s=n("./src/utils/buffer-helper.ts"),o=n("./src/controller/fragment-finders.ts"),a=n("./src/utils/discontinuities.ts"),l=n("./src/controller/level-helper.ts"),c=n("./src/controller/fragment-tracker.ts"),h=n("./src/controller/base-stream-controller.ts"),u=n("./src/types/loader.ts"),d=n("./src/types/level.ts");function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var p=function(t){var e,n;function p(e,n){var r;return(r=t.call(this,e,n,"[subtitle-stream-controller]")||this).levels=[],r.currentTrackId=-1,r.tracksBuffered=[],r.mainDetails=null,r._registerListeners(),r}n=t,(e=p).prototype=Object.create(n.prototype),e.prototype.constructor=e,f(e,n);var m,g=p.prototype;return g.onHandlerDestroying=function(){this._unregisterListeners(),this.mainDetails=null},g._registerListeners=function(){var t=this.hls;t.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.on(r.Events.ERROR,this.onError,this),t.on(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.on(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g._unregisterListeners=function(){var t=this.hls;t.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(r.Events.LEVEL_LOADED,this.onLevelLoaded,this),t.off(r.Events.ERROR,this.onError,this),t.off(r.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(r.Events.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),t.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(r.Events.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),t.off(r.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)},g.startLoad=function(){this.stopLoad(),this.state=h.State.IDLE,this.setInterval(500),this.tick()},g.onManifestLoading=function(){this.mainDetails=null,this.fragmentTracker.removeAllFragments()},g.onLevelLoaded=function(t,e){this.mainDetails=e.details},g.onSubtitleFragProcessed=function(t,e){var n=e.frag,r=e.success;if(this.fragPrevious=n,this.state=h.State.IDLE,r){var i=this.tracksBuffered[this.currentTrackId];if(i){for(var s,o=n.start,a=0;a<i.length;a++)if(o>=i[a].start&&o<=i[a].end){s=i[a];break}var l=n.start+n.duration;s?s.end=l:(s={start:o,end:l},i.push(s)),this.fragmentTracker.fragBuffered(n)}}},g.onBufferFlushing=function(t,e){var n=e.startOffset,r=e.endOffset;if(0===n&&r!==Number.POSITIVE_INFINITY){var i=this.currentTrackId,s=this.levels;if(!s.length||!s[i]||!s[i].details)return;var o=r-s[i].details.targetduration;if(o<=0)return;e.endOffsetSubtitles=Math.max(0,o),this.tracksBuffered.forEach((function(t){for(var e=0;e<t.length;)if(t[e].end<=o)t.shift();else{if(!(t[e].start<o))break;t[e].start=o,e++}})),this.fragmentTracker.removeFragmentsInRange(n,o,u.PlaylistLevelType.SUBTITLE)}},g.onError=function(t,e){var n,r=e.frag;r&&r.type===u.PlaylistLevelType.SUBTITLE&&(null!==(n=this.fragCurrent)&&void 0!==n&&n.loader&&this.fragCurrent.loader.abort(),this.state=h.State.IDLE)},g.onSubtitleTracksUpdated=function(t,e){var n=this,r=e.subtitleTracks;this.tracksBuffered=[],this.levels=r.map((function(t){return new d.Level(t)})),this.fragmentTracker.removeAllFragments(),this.fragPrevious=null,this.levels.forEach((function(t){n.tracksBuffered[t.id]=[]})),this.mediaBuffer=null},g.onSubtitleTrackSwitch=function(t,e){if(this.currentTrackId=e.id,this.levels.length&&-1!==this.currentTrackId){var n=this.levels[this.currentTrackId];null!=n&&n.details?(this.mediaBuffer=this.mediaBufferTimeRanges,this.setInterval(500)):this.mediaBuffer=null}else this.clearInterval()},g.onSubtitleTrackLoaded=function(t,e){var n,r=e.details,i=e.id,s=this.currentTrackId,c=this.levels;if(c.length){var u=c[s];if(!(i>=c.length||i!==s)&&u){if(this.mediaBuffer=this.mediaBufferTimeRanges,r.live||null!==(n=u.details)&&void 0!==n&&n.live){var d=this.mainDetails;if(r.deltaUpdateFailed||!d)return;var f=d.fragments[0];u.details?0===this.alignPlaylists(r,u.details)&&f&&Object(l.addSliding)(r,f.start):r.hasProgramDateTime&&d.hasProgramDateTime?Object(a.alignPDT)(r,d):f&&Object(l.addSliding)(r,f.start)}u.details=r,this.levelLastLoaded=i,this.tick(),r.live&&!this.fragCurrent&&this.media&&this.state===h.State.IDLE&&(Object(o.findFragmentByPTS)(null,r.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),u.details=void 0))}}},g._handleFragmentLoadComplete=function(t){var e=t.frag,n=t.payload,i=e.decryptdata,s=this.hls;if(!this.fragContextChanged(e)&&n&&n.byteLength>0&&i&&i.key&&i.iv&&"AES-128"===i.method){var o=performance.now();this.decrypter.webCryptoDecrypt(new Uint8Array(n),i.key.buffer,i.iv.buffer).then((function(t){var n=performance.now();s.trigger(r.Events.FRAG_DECRYPTED,{frag:e,payload:t,stats:{tstart:o,tdecrypt:n}})}))}},g.doTick=function(){if(this.media){if(this.state===h.State.IDLE){var t,e=this.currentTrackId,n=this.levels;if(!n.length||!n[e]||!n[e].details)return;var a=n[e].details,l=a.targetduration,u=this.config,d=this.media,f=s.BufferHelper.bufferedInfo(this.mediaBufferTimeRanges,d.currentTime-l,u.maxBufferHole),p=f.end;if(f.len>this.getMaxBufferLength()+l)return;var m,g=a.fragments,v=g.length,y=a.edge,b=this.fragPrevious;if(p<y){var x=u.maxFragLookUpTolerance;b&&a.hasProgramDateTime&&(m=Object(o.findFragmentByPDT)(g,b.endProgramDateTime,x)),m||!(m=Object(o.findFragmentByPTS)(b,g,p,x))&&b&&b.start<g[0].start&&(m=g[0])}else m=g[v-1];null!==(t=m)&&void 0!==t&&t.encrypted?(i.logger.log("Loading key for "+m.sn),this.state=h.State.KEY_LOADING,this.hls.trigger(r.Events.KEY_LOADING,{frag:m})):m&&this.fragmentTracker.getState(m)===c.FragmentState.NOT_LOADED&&this.loadFragment(m,a,p)}}else this.state=h.State.IDLE},g.loadFragment=function(e,n,r){this.fragCurrent=e,t.prototype.loadFragment.call(this,e,n,r)},(m=[{key:"mediaBufferTimeRanges",get:function(){return this.tracksBuffered[this.currentTrackId]||[]}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(p.prototype,m),p}(h.default)},"./src/controller/subtitle-track-controller.ts":function(t,e,n){n.r(e);var r=n("./src/events.ts"),i=n("./src/utils/texttrack-utils.ts"),s=n("./src/controller/base-playlist-controller.ts"),o=n("./src/types/loader.ts");function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,n;function s(e){var n;return(n=t.call(this,e,"[subtitle-track-controller]")||this).media=null,n.tracks=[],n.groupId=null,n.tracksInGroup=[],n.trackId=-1,n.selectDefaultTrack=!0,n.queuedDefaultTrack=-1,n.trackChangeListener=function(){return n.onTextTracksChanged()},n.asyncPollTrackChange=function(){return n.pollTrackChange(0)},n.useTextTrackPolling=!1,n.subtitlePollingInterval=-1,n.subtitleDisplay=!0,n.registerListeners(),n}n=t,(e=s).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var l,h=s.prototype;return h.destroy=function(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.trackChangeListener=this.asyncPollTrackChange=null,t.prototype.destroy.call(this)},h.registerListeners=function(){var t=this.hls;t.on(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.on(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.on(r.Events.ERROR,this.onError,this)},h.unregisterListeners=function(){var t=this.hls;t.off(r.Events.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(r.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(r.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(r.Events.MANIFEST_PARSED,this.onManifestParsed,this),t.off(r.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(r.Events.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(r.Events.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),t.off(r.Events.ERROR,this.onError,this)},h.onMediaAttached=function(t,e){this.media=e.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))},h.pollTrackChange=function(t){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.trackChangeListener,t)},h.onMediaDetaching=function(){this.media&&(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||this.media.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),c(this.media.textTracks).forEach((function(t){Object(i.clearCurrentCues)(t)})),this.subtitleTrack=-1,this.media=null)},h.onManifestLoading=function(){this.tracks=[],this.groupId=null,this.tracksInGroup=[],this.trackId=-1,this.selectDefaultTrack=!0},h.onManifestParsed=function(t,e){this.tracks=e.subtitleTracks},h.onSubtitleTrackLoaded=function(t,e){var n=e.id,r=e.details,i=this.trackId,s=this.tracksInGroup[i];if(s){var o=s.details;s.details=e.details,this.log("subtitle track "+n+" loaded ["+r.startSN+"-"+r.endSN+"]"),n===this.trackId&&(this.retryCount=0,this.playlistLoaded(n,e,o))}else this.warn("Invalid subtitle track id "+n)},h.onLevelLoading=function(t,e){this.switchLevel(e.level)},h.onLevelSwitching=function(t,e){this.switchLevel(e.level)},h.switchLevel=function(t){var e=this.hls.levels[t];if(null!=e&&e.textGroupIds){var n=e.textGroupIds[e.urlId];if(this.groupId!==n){var i=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0,s=this.tracks.filter((function(t){return!n||t.groupId===n}));this.tracksInGroup=s;var o=this.findTrackId(null==i?void 0:i.name)||this.findTrackId();this.groupId=n;var a={subtitleTracks:s};this.log("Updating subtitle tracks, "+s.length+' track(s) found in "'+n+'" group-id'),this.hls.trigger(r.Events.SUBTITLE_TRACKS_UPDATED,a),-1!==o&&this.setSubtitleTrack(o,i)}}},h.findTrackId=function(t){for(var e=this.tracksInGroup,n=0;n<e.length;n++){var r=e[n];if((!this.selectDefaultTrack||r.default)&&(!t||t===r.name))return r.id}return-1},h.onError=function(e,n){t.prototype.onError.call(this,e,n),!n.fatal&&n.context&&n.context.type===o.PlaylistContextType.SUBTITLE_TRACK&&n.context.id===this.trackId&&n.context.groupId===this.groupId&&this.retryLoadingOrFail(n)},h.loadPlaylist=function(t){var e=this.tracksInGroup[this.trackId];if(this.shouldLoadTrack(e)){var n=e.id,i=e.groupId,s=e.url;if(t)try{s=t.addDirectives(s)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}this.log("Loading subtitle playlist for id "+n),this.hls.trigger(r.Events.SUBTITLE_TRACK_LOADING,{url:s,id:n,groupId:i,deliveryDirectives:t||null})}},h.toggleTrackModes=function(t){var e=this,n=this.media,r=this.subtitleDisplay,i=this.trackId;if(n){var s=c(n.textTracks),o=s.filter((function(t){return t.groupId===e.groupId}));if(-1===t)[].slice.call(s).forEach((function(t){t.mode="disabled"}));else{var a=o[i];a&&(a.mode="disabled")}var l=o[t];l&&(l.mode=r?"showing":"hidden")}},h.setSubtitleTrack=function(t,e){var n,i=this.tracksInGroup;if(this.media){if(this.trackId!==t&&this.toggleTrackModes(t),!(this.trackId===t&&(-1===t||null!==(n=i[t])&&void 0!==n&&n.details)||t<-1||t>=i.length)){this.clearTimer();var s=i[t];if(this.log("Switching to subtitle track "+t),this.trackId=t,s){var o=s.id,a=s.groupId,l=void 0===a?"":a,c=s.name,h=s.type,u=s.url;this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:o,groupId:l,name:c,type:h,url:u});var d=this.switchParams(s.url,null==e?void 0:e.details);this.loadPlaylist(d)}else this.hls.trigger(r.Events.SUBTITLE_TRACK_SWITCH,{id:t})}}else this.queuedDefaultTrack=t},h.onTextTracksChanged=function(){if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),this.media&&this.hls.config.renderTextTracksNatively){for(var t=-1,e=c(this.media.textTracks),n=0;n<e.length;n++)if("hidden"===e[n].mode)t=n;else if("showing"===e[n].mode){t=n;break}this.subtitleTrack!==t&&(this.subtitleTrack=t)}},(l=[{key:"subtitleTracks",get:function(){return this.tracksInGroup}},{key:"subtitleTrack",get:function(){return this.trackId},set:function(t){this.selectDefaultTrack=!1;var e=this.tracksInGroup?this.tracksInGroup[this.trackId]:void 0;this.setSubtitleTrack(t,e)}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(s.prototype,l),s}(s.default);function c(t){for(var e=[],n=0;n<t.length;n++){var r=t[n];"subtitles"===r.kind&&r.label&&e.push(t[n])}return e}e.default=l},"./src/controller/timeline-controller.ts":function(t,e,n){n.r(e),n.d(e,"TimelineController",(function(){return d}));var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),s=n("./src/utils/cea-608-parser.ts"),o=n("./src/utils/output-filter.ts"),a=n("./src/utils/webvtt-parser.ts"),l=n("./src/utils/texttrack-utils.ts"),c=n("./src/utils/imsc1-ttml-parser.ts"),h=n("./src/types/loader.ts"),u=n("./src/utils/logger.ts"),d=function(){function t(t){if(this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.timescale=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this.captionsProperties=void 0,this.hls=t,this.config=t.config,this.Cues=t.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},this.config.enableCEA708Captions){var e=new o.default(this,"textTrack1"),n=new o.default(this,"textTrack2"),r=new o.default(this,"textTrack3"),a=new o.default(this,"textTrack4");this.cea608Parser1=new s.default(1,e,n),this.cea608Parser2=new s.default(3,r,a)}t.on(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.on(i.Events.FRAG_LOADING,this.onFragLoading,this),t.on(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.on(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.on(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.on(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.on(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.on(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this)}var e=t.prototype;return e.destroy=function(){var t=this.hls;t.off(i.Events.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(i.Events.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(i.Events.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),t.off(i.Events.FRAG_LOADING,this.onFragLoading,this),t.off(i.Events.FRAG_LOADED,this.onFragLoaded,this),t.off(i.Events.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),t.off(i.Events.FRAG_DECRYPTED,this.onFragDecrypted,this),t.off(i.Events.INIT_PTS_FOUND,this.onInitPtsFound,this),t.off(i.Events.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),t.off(i.Events.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.cea608Parser1=this.cea608Parser2=null},e.addCues=function(t,e,n,r,s){for(var o,a,l,c,h=!1,u=s.length;u--;){var d=s[u],f=(o=d[0],a=d[1],l=e,c=n,Math.min(a,c)-Math.max(o,l));if(f>=0&&(d[0]=Math.min(d[0],e),d[1]=Math.max(d[1],n),h=!0,f/(n-e)>.5))return}if(h||s.push([e,n]),this.config.renderTextTracksNatively){var p=this.captionsTracks[t];this.Cues.newCue(p,e,n,r)}else{var m=this.Cues.newCue(null,e,n,r);this.hls.trigger(i.Events.CUES_PARSED,{type:"captions",cues:m,track:t})}},e.onInitPtsFound=function(t,e){var n=this,r=e.frag,s=e.id,o=e.initPTS,a=e.timescale,l=this.unparsedVttFrags;"main"===s&&(this.initPTS[r.cc]=o,this.timescale[r.cc]=a),l.length&&(this.unparsedVttFrags=[],l.forEach((function(t){n.onFragLoaded(i.Events.FRAG_LOADED,t)})))},e.getExistingTrack=function(t){var e=this.media;if(e)for(var n=0;n<e.textTracks.length;n++){var r=e.textTracks[n];if(r[t])return r}return null},e.createCaptionsTrack=function(t){this.config.renderTextTracksNatively?this.createNativeTrack(t):this.createNonNativeTrack(t)},e.createNativeTrack=function(t){if(!this.captionsTracks[t]){var e=this.captionsProperties,n=this.captionsTracks,r=this.media,i=e[t],s=i.label,o=i.languageCode,a=this.getExistingTrack(t);if(a)n[t]=a,Object(l.clearCurrentCues)(n[t]),Object(l.sendAddTrackEvent)(n[t],r);else{var c=this.createTextTrack("captions",s,o);c&&(c[t]=!0,n[t]=c)}}},e.createNonNativeTrack=function(t){if(!this.nonNativeCaptionsTracks[t]){var e=this.captionsProperties[t];if(e){var n={_id:t,label:e.label,kind:"captions",default:!!e.media&&!!e.media.default,closedCaptions:e.media};this.nonNativeCaptionsTracks[t]=n,this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[n]})}}},e.createTextTrack=function(t,e,n){var r=this.media;if(r)return r.addTextTrack(t,e,n)},e.onMediaAttaching=function(t,e){this.media=e.media,this._cleanTracks()},e.onMediaDetaching=function(){var t=this.captionsTracks;Object.keys(t).forEach((function(e){Object(l.clearCurrentCues)(t[e]),delete t[e]})),this.nonNativeCaptionsTracks={}},e.onManifestLoading=function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!1}},this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=[],this.timescale=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())},e._cleanTracks=function(){var t=this.media;if(t){var e=t.textTracks;if(e)for(var n=0;n<e.length;n++)Object(l.clearCurrentCues)(e[n])}},e.onSubtitleTracksUpdated=function(t,e){var n=this;this.textTracks=[];var r=e.subtitleTracks||[],s=r.some((function(t){return t.textCodec===c.IMSC1_CODEC}));if(this.config.enableWebVTT||s&&this.config.enableIMSC1){var o=this.tracks&&r&&this.tracks.length===r.length;if(this.tracks=r||[],this.config.renderTextTracksNatively){var a=this.media?this.media.textTracks:[];this.tracks.forEach((function(t,e){var r;if(e<a.length){for(var i=null,s=0;s<a.length;s++)if(f(a[s],t)){i=a[s];break}i&&(r=i)}r?Object(l.clearCurrentCues)(r):(r=n.createTextTrack("subtitles",t.name,t.lang))&&(r.mode="disabled"),r&&(r.groupId=t.groupId,n.textTracks.push(r))}))}else if(!o&&this.tracks&&this.tracks.length){var h=this.tracks.map((function(t){return{label:t.name,kind:t.type.toLowerCase(),default:t.default,subtitleTrack:t}}));this.hls.trigger(i.Events.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:h})}}},e.onManifestLoaded=function(t,e){var n=this;this.config.enableCEA708Captions&&e.captions&&e.captions.forEach((function(t){var e=/(?:CC|SERVICE)([1-4])/.exec(t.instreamId);if(e){var r="textTrack"+e[1],i=n.captionsProperties[r];i&&(i.label=t.name,t.lang&&(i.languageCode=t.lang),i.media=t)}}))},e.onFragLoading=function(t,e){var n=this.cea608Parser1,r=this.cea608Parser2,i=this.lastSn;if(this.enabled&&n&&r&&e.frag.type===h.PlaylistLevelType.MAIN){var s=e.frag.sn;s!==i+1&&(n.reset(),r.reset()),this.lastSn=s}},e.onFragLoaded=function(t,e){var n=e.frag,s=e.payload,o=this.initPTS,a=this.unparsedVttFrags;if(n.type===h.PlaylistLevelType.SUBTITLE)if(s.byteLength){if(!Object(r.isFiniteNumber)(o[n.cc]))return a.push(e),void(o.length&&this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Missing initial subtitle PTS")}));var l=n.decryptdata;if(null==l||null==l.key||"AES-128"!==l.method){var u=this.tracks[n.level],d=this.vttCCs;d[n.cc]||(d[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===c.IMSC1_CODEC?this._parseIMSC1(n,s):this._parseVTTs(n,s,d)}}else this.hls.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})},e._parseIMSC1=function(t,e){var n=this,r=this.hls;Object(c.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(e){n._appendCues(e,t.level),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(e){u.logger.log("Failed to parse IMSC1: "+e),r.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:e})}))},e._parseVTTs=function(t,e,n){var r=this,s=this.hls;Object(a.parseWebVTT)(e,this.initPTS[t.cc],this.timescale[t.cc],n,t.cc,t.start,(function(e){r._appendCues(e,t.level),s.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:t})}),(function(n){r._fallbackToIMSC1(t,e),u.logger.log("Failed to parse VTT cue: "+n),s.trigger(i.Events.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:t,error:n})}))},e._fallbackToIMSC1=function(t,e){var n=this,r=this.tracks[t.level];r.textCodec||Object(c.parseIMSC1)(e,this.initPTS[t.cc],this.timescale[t.cc],(function(){r.textCodec=c.IMSC1_CODEC,n._parseIMSC1(t,e)}),(function(){r.textCodec="wvtt"}))},e._appendCues=function(t,e){var n=this.hls;if(this.config.renderTextTracksNatively){var r=this.textTracks[e];if("disabled"===r.mode)return;t.forEach((function(t){return Object(l.addCueToTrack)(r,t)}))}else{var s=this.tracks[e].default?"default":"subtitles"+e;n.trigger(i.Events.CUES_PARSED,{type:"subtitles",cues:t,track:s})}},e.onFragDecrypted=function(t,e){var n=e.frag;if(n.type===h.PlaylistLevelType.SUBTITLE){if(!Object(r.isFiniteNumber)(this.initPTS[n.cc]))return void this.unparsedVttFrags.push(e);this.onFragLoaded(i.Events.FRAG_LOADED,e)}},e.onSubtitleTracksCleared=function(){this.tracks=[],this.captionsTracks={}},e.onFragParsingUserdata=function(t,e){var n=this.cea608Parser1,r=this.cea608Parser2;if(this.enabled&&n&&r)for(var i=0;i<e.samples.length;i++){var s=e.samples[i].bytes;if(s){var o=this.extractCea608Data(s);n.addData(e.samples[i].pts,o[0]),r.addData(e.samples[i].pts,o[1])}}},e.onBufferFlushing=function(t,e){var n=e.startOffset,r=e.endOffset,i=e.endOffsetSubtitles,s=e.type,o=this.media;if(o&&!(o.currentTime<r)){if(!s||"video"===s){var a=this.captionsTracks;Object.keys(a).forEach((function(t){return Object(l.removeCuesInRange)(a[t],n,r)}))}if(this.config.renderTextTracksNatively&&0===n&&void 0!==i){var c=this.textTracks;Object.keys(c).forEach((function(t){return Object(l.removeCuesInRange)(c[t],n,i)}))}}},e.extractCea608Data=function(t){for(var e=31&t[0],n=2,r=[[],[]],i=0;i<e;i++){var s=t[n++],o=127&t[n++],a=127&t[n++],l=3&s;0===o&&0===a||0!=(4&s)&&(0!==l&&1!==l||(r[l].push(o),r[l].push(a)))}return r},t}();function f(t,e){return t&&t.label===e.name&&!(t.textTrack1||t.textTrack2)}},"./src/crypt/aes-crypto.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(t,e){this.subtle=void 0,this.aesIV=void 0,this.subtle=t,this.aesIV=e}return t.prototype.decrypt=function(t,e){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},e,t)},t}()},"./src/crypt/aes-decryptor.ts":function(t,e,n){n.r(e),n.d(e,"removePadding",(function(){return i})),n.d(e,"default",(function(){return s}));var r=n("./src/utils/typed-array.ts");function i(t){var e=t.byteLength,n=e&&new DataView(t.buffer).getUint8(e-1);return n?Object(r.sliceUint8)(t,0,e-n):t}var s=function(){function t(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var e=t.prototype;return e.uint8ArrayToUint32Array_=function(t){for(var e=new DataView(t),n=new Uint32Array(4),r=0;r<4;r++)n[r]=e.getUint32(4*r);return n},e.initTable=function(){var t=this.sBox,e=this.invSBox,n=this.subMix,r=n[0],i=n[1],s=n[2],o=n[3],a=this.invSubMix,l=a[0],c=a[1],h=a[2],u=a[3],d=new Uint32Array(256),f=0,p=0,m=0;for(m=0;m<256;m++)d[m]=m<128?m<<1:m<<1^283;for(m=0;m<256;m++){var g=p^p<<1^p<<2^p<<3^p<<4;g=g>>>8^255&g^99,t[f]=g,e[g]=f;var v=d[f],y=d[v],b=d[y],x=257*d[g]^16843008*g;r[f]=x<<24|x>>>8,i[f]=x<<16|x>>>16,s[f]=x<<8|x>>>24,o[f]=x,x=16843009*b^65537*y^257*v^16843008*f,l[g]=x<<24|x>>>8,c[g]=x<<16|x>>>16,h[g]=x<<8|x>>>24,u[g]=x,f?(f=v^d[d[d[b^v]]],p^=d[d[p]]):f=p=1}},e.expandKey=function(t){for(var e=this.uint8ArrayToUint32Array_(t),n=!0,r=0;r<e.length&&n;)n=e[r]===this.key[r],r++;if(!n){this.key=e;var i=this.keySize=e.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var s,o,a,l,c=this.ksRows=4*(i+6+1),h=this.keySchedule=new Uint32Array(c),u=this.invKeySchedule=new Uint32Array(c),d=this.sBox,f=this.rcon,p=this.invSubMix,m=p[0],g=p[1],v=p[2],y=p[3];for(s=0;s<c;s++)s<i?a=h[s]=e[s]:(l=a,s%i==0?(l=d[(l=l<<8|l>>>24)>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l],l^=f[s/i|0]<<24):i>6&&s%i==4&&(l=d[l>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l]),h[s]=a=(h[s-i]^l)>>>0);for(o=0;o<c;o++)s=c-o,l=3&o?h[s]:h[s-4],u[o]=o<4||s<=4?l:m[d[l>>>24]]^g[d[l>>>16&255]]^v[d[l>>>8&255]]^y[d[255&l]],u[o]=u[o]>>>0}},e.networkToHostOrderSwap=function(t){return t<<24|(65280&t)<<8|(16711680&t)>>8|t>>>24},e.decrypt=function(t,e,n){for(var r,i,s,o,a,l,c,h,u,d,f,p,m,g,v=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,x=this.invSubMix,w=x[0],E=x[1],_=x[2],S=x[3],T=this.uint8ArrayToUint32Array_(n),k=T[0],A=T[1],C=T[2],R=T[3],M=new Int32Array(t),I=new Int32Array(M.length),D=this.networkToHostOrderSwap;e<M.length;){for(u=D(M[e]),d=D(M[e+1]),f=D(M[e+2]),p=D(M[e+3]),a=u^y[0],l=p^y[1],c=f^y[2],h=d^y[3],m=4,g=1;g<v;g++)r=w[a>>>24]^E[l>>16&255]^_[c>>8&255]^S[255&h]^y[m],i=w[l>>>24]^E[c>>16&255]^_[h>>8&255]^S[255&a]^y[m+1],s=w[c>>>24]^E[h>>16&255]^_[a>>8&255]^S[255&l]^y[m+2],o=w[h>>>24]^E[a>>16&255]^_[l>>8&255]^S[255&c]^y[m+3],a=r,l=i,c=s,h=o,m+=4;r=b[a>>>24]<<24^b[l>>16&255]<<16^b[c>>8&255]<<8^b[255&h]^y[m],i=b[l>>>24]<<24^b[c>>16&255]<<16^b[h>>8&255]<<8^b[255&a]^y[m+1],s=b[c>>>24]<<24^b[h>>16&255]<<16^b[a>>8&255]<<8^b[255&l]^y[m+2],o=b[h>>>24]<<24^b[a>>16&255]<<16^b[l>>8&255]<<8^b[255&c]^y[m+3],I[e]=D(r^k),I[e+1]=D(o^A),I[e+2]=D(s^C),I[e+3]=D(i^R),k=u,A=d,C=f,R=p,e+=4}return I.buffer},t}()},"./src/crypt/decrypter.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return c}));var r=n("./src/crypt/aes-crypto.ts"),i=n("./src/crypt/fast-aes-key.ts"),s=n("./src/crypt/aes-decryptor.ts"),o=n("./src/utils/logger.ts"),a=n("./src/utils/mp4-tools.ts"),l=n("./src/utils/typed-array.ts"),c=function(){function t(t,e,n){var r=(void 0===n?{}:n).removePKCS7Padding,i=void 0===r||r;if(this.logEnabled=!0,this.observer=void 0,this.config=void 0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.observer=t,this.config=e,this.removePKCS7Padding=i,i)try{var s=self.crypto;s&&(this.subtle=s.subtle||s.webkitSubtle)}catch(o){}null===this.subtle&&(this.config.enableSoftwareAES=!0)}var e=t.prototype;return e.destroy=function(){this.observer=null},e.isSync=function(){return this.config.enableSoftwareAES},e.flush=function(){var t=this.currentResult;if(t){var e=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?Object(s.removePadding)(e):e}this.reset()},e.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},e.decrypt=function(t,e,n,r){if(this.config.enableSoftwareAES){this.softwareDecrypt(new Uint8Array(t),e,n);var i=this.flush();i&&r(i.buffer)}else this.webCryptoDecrypt(new Uint8Array(t),e,n).then(r)},e.softwareDecrypt=function(t,e,n){var r=this.currentIV,i=this.currentResult,o=this.remainderData;this.logOnce("JS AES decrypt"),o&&(t=Object(a.appendUint8Array)(o,t),this.remainderData=null);var c=this.getValidChunk(t);if(!c.length)return null;r&&(n=r);var h=this.softwareDecrypter;h||(h=this.softwareDecrypter=new s.default),h.expandKey(e);var u=i;return this.currentResult=h.decrypt(c.buffer,0,n),this.currentIV=Object(l.sliceUint8)(c,-16).buffer,u||null},e.webCryptoDecrypt=function(t,e,n){var s=this,o=this.subtle;return this.key===e&&this.fastAesKey||(this.key=e,this.fastAesKey=new i.default(o,e)),this.fastAesKey.expandKey().then((function(e){return o?new r.default(o,n).decrypt(t.buffer,e):Promise.reject(new Error("web crypto not initialized"))})).catch((function(r){return s.onWebCryptoError(r,t,e,n)}))},e.onWebCryptoError=function(t,e,n,r){return o.logger.warn("[decrypter.ts]: WebCrypto Error, disable WebCrypto API:",t),this.config.enableSoftwareAES=!0,this.logEnabled=!0,this.softwareDecrypt(e,n,r)},e.getValidChunk=function(t){var e=t,n=t.length-t.length%16;return n!==t.length&&(e=Object(l.sliceUint8)(t,0,n),this.remainderData=Object(l.sliceUint8)(t,n)),e},e.logOnce=function(t){this.logEnabled&&(o.logger.log("[decrypter.ts]: "+t),this.logEnabled=!1)},t}()},"./src/crypt/fast-aes-key.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(t,e){this.subtle=void 0,this.key=void 0,this.subtle=t,this.key=e}return t.prototype.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},t}()},"./src/demux/aacdemuxer.ts":function(t,e,n){n.r(e);var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/adts.ts"),s=n("./src/utils/logger.ts"),o=n("./src/demux/id3.ts");function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,n;function r(e,n){var r;return(r=t.call(this)||this).observer=void 0,r.config=void 0,r.observer=e,r.config=n,r}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var l=r.prototype;return l.resetInitSegment=function(e,n,r){t.prototype.resetInitSegment.call(this,e,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!0,samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var e=(o.getID3Data(t,0)||[]).length,n=t.length;e<n;e++)if(i.probe(t,e))return s.logger.log("ADTS sync word found !"),!0;return!1},l.canParse=function(t,e){return i.canParse(t,e)},l.appendFrame=function(t,e,n){i.initTrackConfig(t,this.observer,e,n,t.manifestCodec);var r=i.appendFrame(t,e,n,this.initPTS,this.frameIndex);if(r&&0===r.missing)return r},r}(r.default);l.minProbeByteLength=9,e.default=l},"./src/demux/adts.ts":function(t,e,n){n.r(e),n.d(e,"getAudioConfig",(function(){return o})),n.d(e,"isHeaderPattern",(function(){return a})),n.d(e,"getHeaderLength",(function(){return l})),n.d(e,"getFullFrameLength",(function(){return c})),n.d(e,"canGetFrameLength",(function(){return h})),n.d(e,"isHeader",(function(){return u})),n.d(e,"canParse",(function(){return d})),n.d(e,"probe",(function(){return f})),n.d(e,"initTrackConfig",(function(){return p})),n.d(e,"getFrameDuration",(function(){return m})),n.d(e,"parseFrameHeader",(function(){return g})),n.d(e,"appendFrame",(function(){return v}));var r=n("./src/utils/logger.ts"),i=n("./src/errors.ts"),s=n("./src/events.ts");function o(t,e,n,o){var a,l,c,h,u=navigator.userAgent.toLowerCase(),d=o,f=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];a=1+((192&e[n+2])>>>6);var p=(60&e[n+2])>>>2;if(!(p>f.length-1))return c=(1&e[n+2])<<2,c|=(192&e[n+3])>>>6,r.logger.log("manifest codec:"+o+", ADTS type:"+a+", samplingIndex:"+p),/firefox/i.test(u)?p>=6?(a=5,h=new Array(4),l=p-3):(a=2,h=new Array(2),l=p):-1!==u.indexOf("android")?(a=2,h=new Array(2),l=p):(a=5,h=new Array(4),o&&(-1!==o.indexOf("mp4a.40.29")||-1!==o.indexOf("mp4a.40.5"))||!o&&p>=6?l=p-3:((o&&-1!==o.indexOf("mp4a.40.2")&&(p>=6&&1===c||/vivaldi/i.test(u))||!o&&1===c)&&(a=2,h=new Array(2)),l=p)),h[0]=a<<3,h[0]|=(14&p)>>1,h[1]|=(1&p)<<7,h[1]|=c<<3,5===a&&(h[1]|=(14&l)>>1,h[2]=(1&l)<<7,h[2]|=8,h[3]=0),{config:h,samplerate:f[p],channelCount:c,codec:"mp4a.40."+a,manifestCodec:d};t.trigger(s.Events.ERROR,{type:i.ErrorTypes.MEDIA_ERROR,details:i.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+p})}function a(t,e){return 255===t[e]&&240==(246&t[e+1])}function l(t,e){return 1&t[e+1]?7:9}function c(t,e){return(3&t[e+3])<<11|t[e+4]<<3|(224&t[e+5])>>>5}function h(t,e){return e+5<t.length}function u(t,e){return e+1<t.length&&a(t,e)}function d(t,e){return h(t,e)&&a(t,e)&&c(t,e)<=t.length-e}function f(t,e){if(u(t,e)){var n=l(t,e);if(e+n>=t.length)return!1;var r=c(t,e);if(r<=n)return!1;var i=e+r;return i===t.length||u(t,i)}return!1}function p(t,e,n,i,s){if(!t.samplerate){var a=o(e,n,i,s);if(!a)return;t.config=a.config,t.samplerate=a.samplerate,t.channelCount=a.channelCount,t.codec=a.codec,t.manifestCodec=a.manifestCodec,r.logger.log("parsed codec:"+t.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function m(t){return 9216e4/t}function g(t,e,n,r,i){var s=l(t,e),o=c(t,e);if((o-=s)>0)return{headerLength:s,frameLength:o,stamp:n+r*i}}function v(t,e,n,r,i){var s=g(e,n,r,i,m(t.samplerate));if(s){var o,a=s.frameLength,l=s.headerLength,c=s.stamp,h=l+a,u=Math.max(0,n+h-e.length);u?(o=new Uint8Array(h-l)).set(e.subarray(n+l,e.length),0):o=e.subarray(n+l,n+h);var d={unit:o,pts:c};return u||t.samples.push(d),{sample:d,length:h,missing:u}}}},"./src/demux/base-audio-demuxer.ts":function(t,e,n){n.r(e),n.d(e,"initPTSFn",(function(){return c}));var r=n("./src/polyfills/number.ts"),i=n("./src/demux/id3.ts"),s=n("./src/demux/dummy-demuxed-track.ts"),o=n("./src/utils/mp4-tools.ts"),a=n("./src/utils/typed-array.ts"),l=function(){function t(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.initPTS=null}var e=t.prototype;return e.resetInitSegment=function(t,e,n){this._id3Track={type:"id3",id:0,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},e.resetTimeStamp=function(){},e.resetContiguity=function(){},e.canParse=function(t,e){return!1},e.appendFrame=function(t,e,n){},e.demux=function(t,e){this.cachedData&&(t=Object(o.appendUint8Array)(this.cachedData,t),this.cachedData=null);var n,r,l=i.getID3Data(t,0),h=l?l.length:0,u=this._audioTrack,d=this._id3Track,f=l?i.getTimeStamp(l):void 0,p=t.length;for(0!==this.frameIndex&&null!==this.initPTS||(this.initPTS=c(f,e)),l&&l.length>0&&d.samples.push({pts:this.initPTS,dts:this.initPTS,data:l}),r=this.initPTS;h<p;){if(this.canParse(t,h)){var m=this.appendFrame(u,t,h);m?(this.frameIndex++,r=m.sample.pts,n=h+=m.length):h=p}else i.canParse(t,h)?(l=i.getID3Data(t,h),d.samples.push({pts:r,dts:r,data:l}),n=h+=l.length):h++;if(h===p&&n!==p){var g=Object(a.sliceUint8)(t,n);this.cachedData?this.cachedData=Object(o.appendUint8Array)(this.cachedData,g):this.cachedData=g}}return{audioTrack:u,avcTrack:Object(s.dummyTrack)(),id3Track:d,textTrack:Object(s.dummyTrack)()}},e.demuxSampleAes=function(t,e,n){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},e.flush=function(t){var e=this.cachedData;return e&&(this.cachedData=null,this.demux(e,0)),this.frameIndex=0,{audioTrack:this._audioTrack,avcTrack:Object(s.dummyTrack)(),id3Track:this._id3Track,textTrack:Object(s.dummyTrack)()}},e.destroy=function(){},t}(),c=function(t,e){return Object(r.isFiniteNumber)(t)?90*t:9e4*e};e.default=l},"./src/demux/chunk-cache.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(){this.chunks=[],this.dataLength=0}var e=t.prototype;return e.push=function(t){this.chunks.push(t),this.dataLength+=t.length},e.flush=function(){var t,e=this.chunks,n=this.dataLength;return e.length?(t=1===e.length?e[0]:function(t,e){for(var n=new Uint8Array(e),r=0,i=0;i<t.length;i++){var s=t[i];n.set(s,r),r+=s.length}return n}(e,n),this.reset(),t):new Uint8Array(0)},e.reset=function(){this.chunks.length=0,this.dataLength=0},t}()},"./src/demux/dummy-demuxed-track.ts":function(t,e,n){function r(){return{type:"",id:-1,pid:-1,inputTimeScale:9e4,sequenceNumber:-1,samples:[],dropped:0}}n.r(e),n.d(e,"dummyTrack",(function(){return r}))},"./src/demux/exp-golomb.ts":function(t,e,n){n.r(e);var r=n("./src/utils/logger.ts"),i=function(){function t(t){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}var e=t.prototype;return e.loadWord=function(){var t=this.data,e=this.bytesAvailable,n=t.byteLength-e,r=new Uint8Array(4),i=Math.min(4,e);if(0===i)throw new Error("no bytes available");r.set(t.subarray(n,n+i)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=8*i,this.bytesAvailable-=i},e.skipBits=function(t){var e;this.bitsAvailable>t?(this.word<<=t,this.bitsAvailable-=t):(t-=this.bitsAvailable,t-=(e=t>>3)>>3,this.bytesAvailable-=e,this.loadWord(),this.word<<=t,this.bitsAvailable-=t)},e.readBits=function(t){var e=Math.min(this.bitsAvailable,t),n=this.word>>>32-e;return t>32&&r.logger.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=e,this.bitsAvailable>0?this.word<<=e:this.bytesAvailable>0&&this.loadWord(),(e=t-e)>0&&this.bitsAvailable?n<<e|this.readBits(e):n},e.skipLZ=function(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},e.skipUEG=function(){this.skipBits(1+this.skipLZ())},e.skipEG=function(){this.skipBits(1+this.skipLZ())},e.readUEG=function(){var t=this.skipLZ();return this.readBits(t+1)-1},e.readEG=function(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},e.readBoolean=function(){return 1===this.readBits(1)},e.readUByte=function(){return this.readBits(8)},e.readUShort=function(){return this.readBits(16)},e.readUInt=function(){return this.readBits(32)},e.skipScalingList=function(t){for(var e=8,n=8,r=0;r<t;r++)0!==n&&(n=(e+this.readEG()+256)%256),e=0===n?e:n},e.readSPS=function(){var t,e,n,r=0,i=0,s=0,o=0,a=this.readUByte.bind(this),l=this.readBits.bind(this),c=this.readUEG.bind(this),h=this.readBoolean.bind(this),u=this.skipBits.bind(this),d=this.skipEG.bind(this),f=this.skipUEG.bind(this),p=this.skipScalingList.bind(this);a();var m=a();if(l(5),u(3),a(),f(),100===m||110===m||122===m||244===m||44===m||83===m||86===m||118===m||128===m){var g=c();if(3===g&&u(1),f(),f(),u(1),h())for(e=3!==g?8:12,n=0;n<e;n++)h()&&p(n<6?16:64)}f();var v=c();if(0===v)c();else if(1===v)for(u(1),d(),d(),t=c(),n=0;n<t;n++)d();f(),u(1);var y=c(),b=c(),x=l(1);0===x&&u(1),u(1),h()&&(r=c(),i=c(),s=c(),o=c());var w=[1,1];if(h()&&h())switch(a()){case 1:w=[1,1];break;case 2:w=[12,11];break;case 3:w=[10,11];break;case 4:w=[16,11];break;case 5:w=[40,33];break;case 6:w=[24,11];break;case 7:w=[20,11];break;case 8:w=[32,11];break;case 9:w=[80,33];break;case 10:w=[18,11];break;case 11:w=[15,11];break;case 12:w=[64,33];break;case 13:w=[160,99];break;case 14:w=[4,3];break;case 15:w=[3,2];break;case 16:w=[2,1];break;case 255:w=[a()<<8|a(),a()<<8|a()]}return{width:Math.ceil(16*(y+1)-2*r-2*i),height:(2-x)*(b+1)*16-(x?2:4)*(s+o),pixelRatio:w}},e.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},t}();e.default=i},"./src/demux/id3.ts":function(t,e,n){n.r(e),n.d(e,"isHeader",(function(){return i})),n.d(e,"isFooter",(function(){return s})),n.d(e,"getID3Data",(function(){return o})),n.d(e,"canParse",(function(){return l})),n.d(e,"getTimeStamp",(function(){return c})),n.d(e,"isTimeStampFrame",(function(){return h})),n.d(e,"getID3Frames",(function(){return d})),n.d(e,"decodeFrame",(function(){return f})),n.d(e,"utf8ArrayToStr",(function(){return y})),n.d(e,"testables",(function(){return b}));var r,i=function(t,e){return e+10<=t.length&&73===t[e]&&68===t[e+1]&&51===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},s=function(t,e){return e+10<=t.length&&51===t[e]&&68===t[e+1]&&73===t[e+2]&&t[e+3]<255&&t[e+4]<255&&t[e+6]<128&&t[e+7]<128&&t[e+8]<128&&t[e+9]<128},o=function(t,e){for(var n=e,r=0;i(t,e);)r+=10,r+=a(t,e+6),s(t,e+10)&&(r+=10),e+=r;if(r>0)return t.subarray(n,n+r)},a=function(t,e){var n=0;return n=(127&t[e])<<21,n|=(127&t[e+1])<<14,(n|=(127&t[e+2])<<7)|127&t[e+3]},l=function(t,e){return i(t,e)&&a(t,e+6)+10<=t.length-e},c=function(t){for(var e=d(t),n=0;n<e.length;n++){var r=e[n];if(h(r))return v(r)}},h=function(t){return t&&"PRIV"===t.key&&"com.apple.streaming.transportStreamTimestamp"===t.info},u=function(t){var e=String.fromCharCode(t[0],t[1],t[2],t[3]),n=a(t,4);return{type:e,size:n,data:t.subarray(10,10+n)}},d=function(t){for(var e=0,n=[];i(t,e);){for(var r=a(t,e+6),o=(e+=10)+r;e+8<o;){var l=u(t.subarray(e)),c=f(l);c&&n.push(c),e+=l.size+10}s(t,e)&&(e+=10)}return n},f=function(t){return"PRIV"===t.type?p(t):"W"===t.type[0]?g(t):m(t)},p=function(t){if(!(t.size<2)){var e=y(t.data,!0),n=new Uint8Array(t.data.subarray(e.length+1));return{key:t.type,info:e,data:n.buffer}}},m=function(t){if(!(t.size<2)){if("TXXX"===t.type){var e=1,n=y(t.data.subarray(e),!0);e+=n.length+1;var r=y(t.data.subarray(e));return{key:t.type,info:n,data:r}}var i=y(t.data.subarray(1));return{key:t.type,data:i}}},g=function(t){if("WXXX"===t.type){if(t.size<2)return;var e=1,n=y(t.data.subarray(e),!0);e+=n.length+1;var r=y(t.data.subarray(e));return{key:t.type,info:n,data:r}}var i=y(t.data);return{key:t.type,data:i}},v=function(t){if(8===t.data.byteLength){var e=new Uint8Array(t.data),n=1&e[3],r=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return r/=45,n&&(r+=47721858.84),Math.round(r)}},y=function(t,e){void 0===e&&(e=!1);var n=(r||void 0===self.TextDecoder||(r=new self.TextDecoder("utf-8")),r);if(n){var i=n.decode(t);if(e){var s=i.indexOf("\0");return-1!==s?i.substring(0,s):i}return i.replace(/\0/g,"")}for(var o,a,l,c=t.length,h="",u=0;u<c;){if(0===(o=t[u++])&&e)return h;if(0!==o&&3!==o)switch(o>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:h+=String.fromCharCode(o);break;case 12:case 13:a=t[u++],h+=String.fromCharCode((31&o)<<6|63&a);break;case 14:a=t[u++],l=t[u++],h+=String.fromCharCode((15&o)<<12|(63&a)<<6|(63&l)<<0)}}return h},b={decodeTextFrame:m}},"./src/demux/mp3demuxer.ts":function(t,e,n){n.r(e);var r=n("./src/demux/base-audio-demuxer.ts"),i=n("./src/demux/id3.ts"),s=n("./src/utils/logger.ts"),o=n("./src/demux/mpegaudio.ts");function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}var l=function(t){var e,n;function r(){return t.apply(this,arguments)||this}n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n);var l=r.prototype;return l.resetInitSegment=function(e,n,r){t.prototype.resetInitSegment.call(this,e,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:0,pid:-1,sequenceNumber:0,isAAC:!1,samples:[],manifestCodec:e,duration:r,inputTimeScale:9e4,dropped:0}},r.probe=function(t){if(!t)return!1;for(var e=(i.getID3Data(t,0)||[]).length,n=t.length;e<n;e++)if(o.probe(t,e))return s.logger.log("MPEG Audio sync word found !"),!0;return!1},l.canParse=function(t,e){return o.canParse(t,e)},l.appendFrame=function(t,e,n){if(null!==this.initPTS)return o.appendFrame(t,e,n,this.initPTS,this.frameIndex)},r}(r.default);l.minProbeByteLength=4,e.default=l},"./src/demux/mp4demuxer.ts":function(t,e,n){n.r(e);var r=n("./src/utils/mp4-tools.ts"),i=n("./src/demux/dummy-demuxed-track.ts"),s=function(){function t(t,e){this.remainderData=null,this.config=void 0,this.config=e}var e=t.prototype;return e.resetTimeStamp=function(){},e.resetInitSegment=function(){},e.resetContiguity=function(){},t.probe=function(t){return Object(r.findBox)({data:t,start:0,end:Math.min(t.length,16384)},["moof"]).length>0},e.demux=function(t){var e=t,n=Object(i.dummyTrack)();if(this.config.progressive){this.remainderData&&(e=Object(r.appendUint8Array)(this.remainderData,t));var s=Object(r.segmentValidRange)(e);this.remainderData=s.remainder,n.samples=s.valid||new Uint8Array}else n.samples=e;return{audioTrack:Object(i.dummyTrack)(),avcTrack:n,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},e.flush=function(){var t=Object(i.dummyTrack)();return t.samples=this.remainderData||new Uint8Array,this.remainderData=null,{audioTrack:Object(i.dummyTrack)(),avcTrack:t,id3Track:Object(i.dummyTrack)(),textTrack:Object(i.dummyTrack)()}},e.demuxSampleAes=function(t,e,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},e.destroy=function(){},t}();s.minProbeByteLength=1024,e.default=s},"./src/demux/mpegaudio.ts":function(t,e,n){n.r(e),n.d(e,"appendFrame",(function(){return l})),n.d(e,"parseHeader",(function(){return c})),n.d(e,"isHeaderPattern",(function(){return h})),n.d(e,"isHeader",(function(){return u})),n.d(e,"canParse",(function(){return d})),n.d(e,"probe",(function(){return f}));var r=null,i=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],s=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],o=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],a=[0,1,1,4];function l(t,e,n,r,i){if(!(n+24>e.length)){var s=c(e,n);if(s&&n+s.frameLength<=e.length){var o=r+i*(9e4*s.samplesPerFrame/s.sampleRate),a={unit:e.subarray(n,n+s.frameLength),pts:o,dts:o};return t.config=[],t.channelCount=s.channelCount,t.samplerate=s.sampleRate,t.samples.push(a),{sample:a,length:s.frameLength,missing:0}}}}function c(t,e){var n=t[e+1]>>3&3,l=t[e+1]>>1&3,c=t[e+2]>>4&15,h=t[e+2]>>2&3;if(1!==n&&0!==c&&15!==c&&3!==h){var u=t[e+2]>>1&1,d=t[e+3]>>6,f=1e3*i[14*(3===n?3-l:3===l?3:4)+c-1],p=s[3*(3===n?0:2===n?1:2)+h],m=3===d?1:2,g=o[n][l],v=a[l],y=8*g*v,b=Math.floor(g*f/p+u)*v;if(null===r){var x=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);r=x?parseInt(x[1]):0}return!!r&&r<=87&&2===l&&f>=224e3&&0===d&&(t[e+3]=128|t[e+3]),{sampleRate:p,channelCount:m,frameLength:b,samplesPerFrame:y}}}function h(t,e){return 255===t[e]&&224==(224&t[e+1])&&0!=(6&t[e+1])}function u(t,e){return e+1<t.length&&h(t,e)}function d(t,e){return h(t,e)&&4<=t.length-e}function f(t,e){if(e+1<t.length&&h(t,e)){var n=c(t,e),r=4;null!=n&&n.frameLength&&(r=n.frameLength);var i=e+r;return i===t.length||u(t,i)}return!1}},"./src/demux/sample-aes.ts":function(t,e,n){n.r(e);var r=n("./src/crypt/decrypter.ts"),i=n("./src/demux/tsdemuxer.ts"),s=function(){function t(t,e,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new r.default(t,e,{removePKCS7Padding:!1})}var e=t.prototype;return e.decryptBuffer=function(t,e){this.decrypter.decrypt(t,this.keyData.key.buffer,this.keyData.iv.buffer,e)},e.decryptAacSample=function(t,e,n,r){var i=t[e].unit,s=i.subarray(16,i.length-i.length%16),o=s.buffer.slice(s.byteOffset,s.byteOffset+s.length),a=this;this.decryptBuffer(o,(function(s){var o=new Uint8Array(s);i.set(o,16),r||a.decryptAacSamples(t,e+1,n)}))},e.decryptAacSamples=function(t,e,n){for(;;e++){if(e>=t.length)return void n();if(!(t[e].unit.length<32)){var r=this.decrypter.isSync();if(this.decryptAacSample(t,e,n,r),!r)return}}},e.getAvcEncryptedData=function(t){for(var e=16*Math.floor((t.length-48)/160)+16,n=new Int8Array(e),r=0,i=32;i<=t.length-16;i+=160,r+=16)n.set(t.subarray(i,i+16),r);return n},e.getAvcDecryptedUnit=function(t,e){for(var n=new Uint8Array(e),r=0,i=32;i<=t.length-16;i+=160,r+=16)t.set(n.subarray(r,r+16),i);return t},e.decryptAvcSample=function(t,e,n,r,s,o){var a=Object(i.discardEPB)(s.data),l=this.getAvcEncryptedData(a),c=this;this.decryptBuffer(l.buffer,(function(i){s.data=c.getAvcDecryptedUnit(a,i),o||c.decryptAvcSamples(t,e,n+1,r)}))},e.decryptAvcSamples=function(t,e,n,r){if(t instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;e++,n=0){if(e>=t.length)return void r();for(var i=t[e].units;!(n>=i.length);n++){var s=i[n];if(!(s.data.length<=48||1!==s.type&&5!==s.type)){var o=this.decrypter.isSync();if(this.decryptAvcSample(t,e,n,r,s,o),!o)return}}}},t}();e.default=s},"./src/demux/transmuxer-interface.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return u}));var r=n("./node_modules/webworkify-webpack/index.js"),i=n("./src/events.ts"),s=n("./src/demux/transmuxer.ts"),o=n("./src/utils/logger.ts"),a=n("./src/errors.ts"),l=n("./src/utils/mediasource-helper.ts"),c=n("./node_modules/eventemitter3/index.js"),h=Object(l.getMediaSource)()||{isTypeSupported:function(){return!1}},u=function(){function t(t,e,n,l){var u=this;this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.worker=void 0,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.hls=t,this.id=e,this.onTransmuxComplete=n,this.onFlush=l;var d=t.config,f=function(e,n){(n=n||{}).frag=u.frag,n.id=u.id,t.trigger(e,n)};this.observer=new c.EventEmitter,this.observer.on(i.Events.FRAG_DECRYPTED,f),this.observer.on(i.Events.ERROR,f);var p={mp4:h.isTypeSupported("video/mp4"),mpeg:h.isTypeSupported("audio/mpeg"),mp3:h.isTypeSupported('audio/mp4; codecs="mp3"')},m=navigator.vendor;if(d.enableWorker&&"undefined"!=typeof Worker){var g;o.logger.log("demuxing in webworker");try{g=this.worker=r("./src/demux/transmuxer-worker.ts"),this.onwmsg=this.onWorkerMessage.bind(this),g.addEventListener("message",this.onwmsg),g.onerror=function(e){t.trigger(i.Events.ERROR,{type:a.ErrorTypes.OTHER_ERROR,details:a.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:"demuxerWorker",error:new Error(e.message+"  ("+e.filename+":"+e.lineno+")")})},g.postMessage({cmd:"init",typeSupported:p,vendor:m,id:e,config:JSON.stringify(d)})}catch(v){o.logger.warn("Error in worker:",v),o.logger.error("Error while initializing DemuxerWorker, fallback to inline"),g&&self.URL.revokeObjectURL(g.objectURL),this.transmuxer=new s.default(this.observer,p,d,m,e),this.worker=null}}else this.transmuxer=new s.default(this.observer,p,d,m,e)}var e=t.prototype;return e.destroy=function(){var t=this.worker;if(t)t.removeEventListener("message",this.onwmsg),t.terminate(),this.worker=null;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var n=this.observer;n&&n.removeAllListeners(),this.observer=null},e.push=function(t,e,n,r,i,a,l,c,h,u){var d=this;h.transmuxing.start=self.performance.now();var f=this.transmuxer,p=this.worker,m=a?a.start:i.start,g=i.decryptdata,v=this.frag,y=!(v&&i.cc===v.cc),b=!(v&&h.level===v.level),x=v?h.sn-v.sn:-1,w=this.part?h.part-this.part.index:1,E=!b&&(1===x||0===x&&1===w),_=self.performance.now();(b||x||0===i.stats.parsing.start)&&(i.stats.parsing.start=_),!a||!w&&E||(a.stats.parsing.start=_);var S=new s.TransmuxState(y,E,c,b,m);if(!E||y){o.logger.log("[transmuxer-interface, "+i.type+"]: Starting new transmux session for sn: "+h.sn+" p: "+h.part+" level: "+h.level+" id: "+h.id+"\n        discontinuity: "+y+"\n        trackSwitch: "+b+"\n        contiguous: "+E+"\n        accurateTimeOffset: "+c+"\n        timeOffset: "+m);var T=new s.TransmuxConfig(n,r,e,l,u);this.configureTransmuxer(T)}if(this.frag=i,this.part=a,p)p.postMessage({cmd:"demux",data:t,decryptdata:g,chunkMeta:h,state:S},t instanceof ArrayBuffer?[t]:[]);else if(f){var k=f.push(t,g,h,S);Object(s.isPromise)(k)?k.then((function(t){d.handleTransmuxComplete(t)})):this.handleTransmuxComplete(k)}},e.flush=function(t){var e=this;t.transmuxing.start=self.performance.now();var n=this.transmuxer,r=this.worker;if(r)r.postMessage({cmd:"flush",chunkMeta:t});else if(n){var i=n.flush(t);Object(s.isPromise)(i)?i.then((function(n){e.handleFlushResult(n,t)})):this.handleFlushResult(i,t)}},e.handleFlushResult=function(t,e){var n=this;t.forEach((function(t){n.handleTransmuxComplete(t)})),this.onFlush(e)},e.onWorkerMessage=function(t){var e=t.data,n=this.hls;switch(e.event){case"init":self.URL.revokeObjectURL(this.worker.objectURL);break;case"transmuxComplete":this.handleTransmuxComplete(e.data);break;case"flush":this.onFlush(e.data);break;default:e.data=e.data||{},e.data.frag=this.frag,e.data.id=this.id,n.trigger(e.event,e.data)}},e.configureTransmuxer=function(t){var e=this.worker,n=this.transmuxer;e?e.postMessage({cmd:"configure",config:t}):n&&n.configure(t)},e.handleTransmuxComplete=function(t){t.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(t)},t}()},"./src/demux/transmuxer-worker.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return a}));var r=n("./src/demux/transmuxer.ts"),i=n("./src/events.ts"),s=n("./src/utils/logger.ts"),o=n("./node_modules/eventemitter3/index.js");function a(t){var e=new o.EventEmitter,n=function(e,n){t.postMessage({event:e,data:n})};e.on(i.Events.FRAG_DECRYPTED,n),e.on(i.Events.ERROR,n),t.addEventListener("message",(function(i){var o=i.data;switch(o.cmd){case"init":var a=JSON.parse(o.config);t.transmuxer=new r.default(e,o.typeSupported,a,o.vendor,o.id),Object(s.enableLogs)(a.debug),n("init",null);break;case"configure":t.transmuxer.configure(o.config);break;case"demux":var c=t.transmuxer.push(o.data,o.decryptdata,o.chunkMeta,o.state);Object(r.isPromise)(c)?c.then((function(e){l(t,e)})):l(t,c);break;case"flush":var u=o.chunkMeta,d=t.transmuxer.flush(u);Object(r.isPromise)(d)?d.then((function(e){h(t,e,u)})):h(t,d,u)}}))}function l(t,e){if((n=e.remuxResult).audio||n.video||n.text||n.id3||n.initSegment){var n,r=[],i=e.remuxResult,s=i.audio,o=i.video;s&&c(r,s),o&&c(r,o),t.postMessage({event:"transmuxComplete",data:e},r)}}function c(t,e){e.data1&&t.push(e.data1.buffer),e.data2&&t.push(e.data2.buffer)}function h(t,e,n){e.forEach((function(e){l(t,e)})),t.postMessage({event:"flush",data:n})}},"./src/demux/transmuxer.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return y})),n.d(e,"isPromise",(function(){return x})),n.d(e,"TransmuxConfig",(function(){return w})),n.d(e,"TransmuxState",(function(){return E}));var r,i=n("./src/events.ts"),s=n("./src/errors.ts"),o=n("./src/crypt/decrypter.ts"),a=n("./src/demux/aacdemuxer.ts"),l=n("./src/demux/mp4demuxer.ts"),c=n("./src/demux/tsdemuxer.ts"),h=n("./src/demux/mp3demuxer.ts"),u=n("./src/remux/mp4-remuxer.ts"),d=n("./src/remux/passthrough-remuxer.ts"),f=n("./src/demux/chunk-cache.ts"),p=n("./src/utils/mp4-tools.ts"),m=n("./src/utils/logger.ts");try{r=self.performance.now.bind(self.performance)}catch(_){m.logger.debug("Unable to use Performance API on this environment"),r=self.Date.now}var g=[{demux:c.default,remux:u.default},{demux:l.default,remux:d.default},{demux:a.default,remux:u.default},{demux:h.default,remux:u.default}],v=1024;g.forEach((function(t){var e=t.demux;v=Math.max(v,e.minProbeByteLength)}));var y=function(){function t(t,e,n,r,i){this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.cache=new f.default,this.observer=t,this.typeSupported=e,this.config=n,this.vendor=r,this.id=i}var e=t.prototype;return e.configure=function(t){this.transmuxConfig=t,this.decrypter&&this.decrypter.reset()},e.push=function(t,e,n,i){var s=this,o=n.transmuxing;o.executeStart=r();var a=new Uint8Array(t),l=this.cache,c=this.config,h=this.currentTransmuxState,u=this.transmuxConfig;i&&(this.currentTransmuxState=i);var d,f,m=(d=e,f=null,a.byteLength>0&&null!=d&&null!=d.key&&null!==d.iv&&null!=d.method&&(f=d),f);if(m&&"AES-128"===m.method){var g=this.getDecrypter();if(!c.enableSoftwareAES)return this.decryptionPromise=g.webCryptoDecrypt(a,m.key.buffer,m.iv.buffer).then((function(t){var e=s.push(t,null,n);return s.decryptionPromise=null,e})),this.decryptionPromise;var v=g.softwareDecrypt(a,m.key.buffer,m.iv.buffer);if(!v)return o.executeEnd=r(),b(n);a=new Uint8Array(v)}var y=i||h,x=y.contiguous,w=y.discontinuity,E=y.trackSwitch,_=y.accurateTimeOffset,S=y.timeOffset,T=u.audioCodec,k=u.videoCodec,A=u.defaultInitPts,C=u.duration,R=u.initSegmentData;if((w||E)&&this.resetInitSegment(R,T,k,C),w&&this.resetInitialTimestamp(A),x||this.resetContiguity(),this.needsProbing(a,w,E)){if(l.dataLength){var M=l.flush();a=Object(p.appendUint8Array)(M,a)}this.configureTransmuxer(a,u)}var I=this.transmux(a,m,S,_,n),D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,o.executeEnd=r(),I},e.flush=function(t){var e=this,n=t.transmuxing;n.executeStart=r();var o=this.decrypter,a=this.cache,l=this.currentTransmuxState,c=this.decryptionPromise;if(c)return c.then((function(){return e.flush(t)}));var h=[],u=l.timeOffset;if(o){var d=o.flush();d&&h.push(this.push(d,null,t))}var f=a.dataLength;a.reset();var p=this.demuxer,m=this.remuxer;if(!p||!m)return f>=v&&this.observer.emit(i.Events.ERROR,i.Events.ERROR,{type:s.ErrorTypes.MEDIA_ERROR,details:s.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:"no demux matching with content found"}),n.executeEnd=r(),[b(t)];var g=p.flush(u);return x(g)?g.then((function(n){return e.flushRemux(h,n,t),h})):(this.flushRemux(h,g,t),h)},e.flushRemux=function(t,e,n){var i=e.audioTrack,s=e.avcTrack,o=e.id3Track,a=e.textTrack,l=this.currentTransmuxState,c=l.accurateTimeOffset,h=l.timeOffset;m.logger.log("[transmuxer.ts]: Flushed fragment "+n.sn+(n.part>-1?" p: "+n.part:"")+" of level "+n.level);var u=this.remuxer.remux(i,s,o,a,h,c,!0,this.id);t.push({remuxResult:u,chunkMeta:n}),n.transmuxing.executeEnd=r()},e.resetInitialTimestamp=function(t){var e=this.demuxer,n=this.remuxer;e&&n&&(e.resetTimeStamp(t),n.resetTimeStamp(t))},e.resetContiguity=function(){var t=this.demuxer,e=this.remuxer;t&&e&&(t.resetContiguity(),e.resetNextTimestamp())},e.resetInitSegment=function(t,e,n,r){var i=this.demuxer,s=this.remuxer;i&&s&&(i.resetInitSegment(e,n,r),s.resetInitSegment(t,e,n))},e.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},e.transmux=function(t,e,n,r,i){return e&&"SAMPLE-AES"===e.method?this.transmuxSampleAes(t,e,n,r,i):this.transmuxUnencrypted(t,n,r,i)},e.transmuxUnencrypted=function(t,e,n,r){var i=this.demuxer.demux(t,e,!1,!this.config.progressive),s=i.audioTrack,o=i.avcTrack,a=i.id3Track,l=i.textTrack;return{remuxResult:this.remuxer.remux(s,o,a,l,e,n,!1,this.id),chunkMeta:r}},e.transmuxSampleAes=function(t,e,n,r,i){var s=this;return this.demuxer.demuxSampleAes(t,e,n).then((function(t){return{remuxResult:s.remuxer.remux(t.audioTrack,t.avcTrack,t.id3Track,t.textTrack,n,r,!1,s.id),chunkMeta:i}}))},e.configureTransmuxer=function(t,e){for(var n,r=this.config,i=this.observer,s=this.typeSupported,o=this.vendor,a=e.audioCodec,c=e.defaultInitPts,h=e.duration,u=e.initSegmentData,f=e.videoCodec,p=0,v=g.length;p<v;p++)if(g[p].demux.probe(t)){n=g[p];break}n||(m.logger.warn("Failed to find demuxer by probing frag, treating as mp4 passthrough"),n={demux:l.default,remux:d.default});var y=this.demuxer,b=this.remuxer,x=n.remux,w=n.demux;b&&b instanceof x||(this.remuxer=new x(i,r,s,o)),y&&y instanceof w||(this.demuxer=new w(i,r,s),this.probe=w.probe),this.resetInitSegment(u,a,f,h),this.resetInitialTimestamp(c)},e.needsProbing=function(t,e,n){return!this.demuxer||!this.remuxer||e||n},e.getDecrypter=function(){var t=this.decrypter;return t||(t=this.decrypter=new o.default(this.observer,this.config)),t},t}(),b=function(t){return{remuxResult:{},chunkMeta:t}};function x(t){return"then"in t&&t.then instanceof Function}var w=function(t,e,n,r,i){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=t,this.videoCodec=e,this.initSegmentData=n,this.duration=r,this.defaultInitPts=i},E=function(t,e,n,r,i){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.discontinuity=t,this.contiguous=e,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=i}},"./src/demux/tsdemuxer.ts":function(t,e,n){n.r(e),n.d(e,"discardEPB",(function(){return x}));var r=n("./src/demux/adts.ts"),i=n("./src/demux/mpegaudio.ts"),s=n("./src/demux/exp-golomb.ts"),o=n("./src/demux/id3.ts"),a=n("./src/demux/sample-aes.ts"),l=n("./src/events.ts"),c=n("./src/utils/mp4-tools.ts"),h=n("./src/utils/logger.ts"),u=n("./src/errors.ts"),d={video:1,audio:2,id3:3,text:4},f=function(){function t(t,e,n){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this.aacLastPTS=null,this._initPTS=null,this._initDTS=null,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=t,this.config=e,this.typeSupported=n}t.probe=function(e){var n=t.syncOffset(e);return!(n<0||(n&&h.logger.warn("MPEG2-TS detected but first sync word found @ offset "+n+", junk ahead ?"),0))},t.syncOffset=function(t){for(var e=Math.min(1e3,t.length-564),n=0;n<e;){if(71===t[n]&&71===t[n+188]&&71===t[n+376])return n;n++}return-1},t.createTrack=function(t,e){return{container:"video"===t||"audio"===t?"video/mp2t":void 0,type:t,id:d[t],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===t?e:void 0}};var e=t.prototype;return e.resetInitSegment=function(e,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=t.createTrack("video",r),this._audioTrack=t.createTrack("audio",r),this._id3Track=t.createTrack("id3",r),this._txtTrack=t.createTrack("text",r),this._audioTrack.isAAC=!0,this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=e,this.videoCodec=n,this._duration=r},e.resetTimeStamp=function(){},e.resetContiguity=function(){var t=this._audioTrack,e=this._avcTrack,n=this._id3Track;t&&(t.pesData=null),e&&(e.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.aacLastPTS=null},e.demux=function(e,n,r,i){var s;void 0===r&&(r=!1),void 0===i&&(i=!1),r||(this.sampleAes=null);var o=this._avcTrack,a=this._audioTrack,d=this._id3Track,f=o.pid,p=o.pesData,y=a.pid,b=d.pid,x=a.pesData,w=d.pesData,E=!1,_=this.pmtParsed,S=this._pmtId,T=e.length;if(this.remainderData&&(T=(e=Object(c.appendUint8Array)(this.remainderData,e)).length,this.remainderData=null),T<188&&!i)return this.remainderData=e,{audioTrack:a,avcTrack:o,id3Track:d,textTrack:this._txtTrack};var k=Math.max(0,t.syncOffset(e));(T-=(T+k)%188)<e.byteLength&&!i&&(this.remainderData=new Uint8Array(e.buffer,T,e.buffer.byteLength-T));for(var A=k;A<T;A+=188)if(71===e[A]){var C=!!(64&e[A+1]),R=((31&e[A+1])<<8)+e[A+2],M=void 0;if((48&e[A+3])>>4>1){if((M=A+5+e[A+4])===A+188)continue}else M=A+4;switch(R){case f:C&&(p&&(s=v(p))&&this.parseAVCPES(s,!1),p={data:[],size:0}),p&&(p.data.push(e.subarray(M,A+188)),p.size+=A+188-M);break;case y:C&&(x&&(s=v(x))&&(a.isAAC?this.parseAACPES(s):this.parseMPEGPES(s)),x={data:[],size:0}),x&&(x.data.push(e.subarray(M,A+188)),x.size+=A+188-M);break;case b:C&&(w&&(s=v(w))&&this.parseID3PES(s),w={data:[],size:0}),w&&(w.data.push(e.subarray(M,A+188)),w.size+=A+188-M);break;case 0:C&&(M+=e[M]+1),S=this._pmtId=m(e,M);break;case S:C&&(M+=e[M]+1);var I=g(e,M,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,r);(f=I.avc)>0&&(o.pid=f),(y=I.audio)>0&&(a.pid=y,a.isAAC=I.isAAC),(b=I.id3)>0&&(d.pid=b),E&&!_&&(h.logger.log("reparse from beginning"),E=!1,A=k-188),_=this.pmtParsed=!0;break;case 17:case 8191:break;default:E=!0}}else this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:"TS packet did not start with 0x47"});o.pesData=p,a.pesData=x,d.pesData=w;var D={audioTrack:a,avcTrack:o,id3Track:d,textTrack:this._txtTrack};return i&&this.extractRemainingSamples(D),D},e.flush=function(){var t,e=this.remainderData;return this.remainderData=null,t=e?this.demux(e,-1,!1,!0):{audioTrack:this._audioTrack,avcTrack:this._avcTrack,textTrack:this._txtTrack,id3Track:this._id3Track},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t},e.extractRemainingSamples=function(t){var e,n=t.audioTrack,r=t.avcTrack,i=t.id3Track,s=r.pesData,o=n.pesData,a=i.pesData;s&&(e=v(s))?(this.parseAVCPES(e,!0),r.pesData=null):r.pesData=s,o&&(e=v(o))?(n.isAAC?this.parseAACPES(e):this.parseMPEGPES(e),n.pesData=null):(null!=o&&o.size&&h.logger.log("last AAC PES packet truncated,might overlap between fragments"),n.pesData=o),a&&(e=v(a))?(this.parseID3PES(e),i.pesData=null):i.pesData=a},e.demuxSampleAes=function(t,e,n){var r=this.demux(t,n,!0,!this.config.progressive),i=this.sampleAes=new a.default(this.observer,this.config,e);return this.decrypt(r,i)},e.decrypt=function(t,e){return new Promise((function(n){var r=t.audioTrack,i=t.avcTrack;r.samples&&r.isAAC?e.decryptAacSamples(r.samples,0,(function(){i.samples?e.decryptAvcSamples(i.samples,0,0,(function(){n(t)})):n(t)})):i.samples&&e.decryptAvcSamples(i.samples,0,0,(function(){n(t)}))}))},e.destroy=function(){this._initPTS=this._initDTS=null,this._duration=0},e.parseAVCPES=function(t,e){var n,r=this,i=this._avcTrack,a=this.parseAVCNALu(t.data),l=this.avcSample,c=!1;t.data=null,l&&a.length&&!i.audFound&&(y(l,i),l=this.avcSample=p(!1,t.pts,t.dts,"")),a.forEach((function(e){switch(e.type){case 1:n=!0,l||(l=r.avcSample=p(!0,t.pts,t.dts,"")),l.frame=!0;var a=e.data;if(c&&a.length>4){var h=new s.default(a).readSliceType();2!==h&&4!==h&&7!==h&&9!==h||(l.key=!0)}break;case 5:n=!0,l||(l=r.avcSample=p(!0,t.pts,t.dts,"")),l.key=!0,l.frame=!0;break;case 6:n=!0;var u=new s.default(x(e.data));u.readUByte();for(var d=0,f=0,m=!1,g=0;!m&&u.bytesAvailable>1;){d=0;do{d+=g=u.readUByte()}while(255===g);f=0;do{f+=g=u.readUByte()}while(255===g);if(4===d&&0!==u.bytesAvailable){if(m=!0,181===u.readUByte()&&49===u.readUShort()&&1195456820===u.readUInt()&&3===u.readUByte()){for(var v=u.readUByte(),w=31&v,E=[v,u.readUByte()],_=0;_<w;_++)E.push(u.readUByte()),E.push(u.readUByte()),E.push(u.readUByte());b(r._txtTrack.samples,{type:3,pts:t.pts,bytes:E})}}else if(5===d&&0!==u.bytesAvailable){if(m=!0,f>16){for(var S=[],T=0;T<16;T++)S.push(u.readUByte().toString(16)),3!==T&&5!==T&&7!==T&&9!==T||S.push("-");for(var k=f-16,A=new Uint8Array(k),C=0;C<k;C++)A[C]=u.readUByte();b(r._txtTrack.samples,{pts:t.pts,payloadType:d,uuid:S.join(""),userData:Object(o.utf8ArrayToStr)(A),userDataBytes:A})}}else if(f<u.bytesAvailable)for(var R=0;R<f;R++)u.readUByte()}break;case 7:if(n=!0,c=!0,!i.sps){var M=new s.default(e.data).readSPS();i.width=M.width,i.height=M.height,i.pixelRatio=M.pixelRatio,i.sps=[e.data],i.duration=r._duration;for(var I=e.data.subarray(1,4),D="avc1.",O=0;O<3;O++){var P=I[O].toString(16);P.length<2&&(P="0"+P),D+=P}i.codec=D}break;case 8:n=!0,i.pps||(i.pps=[e.data]);break;case 9:n=!1,i.audFound=!0,l&&y(l,i),l=r.avcSample=p(!1,t.pts,t.dts,"");break;case 12:n=!1;break;default:n=!1,l&&(l.debug+="unknown NAL "+e.type+" ")}l&&n&&l.units.push(e)})),e&&l&&(y(l,i),this.avcSample=null)},e.getLastNalUnit=function(){var t,e,n=this.avcSample;if(!n||0===n.units.length){var r=this._avcTrack.samples;n=r[r.length-1]}if(null!==(t=n)&&void 0!==t&&t.units){var i=n.units;e=i[i.length-1]}return e},e.parseAVCNALu=function(t){var e,n,r=t.byteLength,i=this._avcTrack,s=i.naluState||0,o=s,a=[],l=0,c=-1,h=0;for(-1===s&&(c=0,h=31&t[0],s=0,l=1);l<r;)if(e=t[l++],s)if(1!==s)if(e)if(1===e){if(c>=0){var u={data:t.subarray(c,l-s-1),type:h};a.push(u)}else{var d=this.getLastNalUnit();if(d&&(o&&l<=4-o&&d.state&&(d.data=d.data.subarray(0,d.data.byteLength-o)),(n=l-s-1)>0)){var f=new Uint8Array(d.data.byteLength+n);f.set(d.data,0),f.set(t.subarray(0,n),d.data.byteLength),d.data=f}}l<r?(c=l,h=31&t[l],s=0):s=-1}else s=0;else s=3;else s=e?0:2;else s=e?0:1;if(c>=0&&s>=0){var p={data:t.subarray(c,r),type:h,state:s};a.push(p)}if(0===a.length){var m=this.getLastNalUnit();if(m){var g=new Uint8Array(m.data.byteLength+t.byteLength);g.set(m.data,0),g.set(t,m.data.byteLength),m.data=g}}return i.naluState=s,a},e.parseAACPES=function(t){var e,n,i,s,o,a=0,c=this._audioTrack,d=this.aacOverFlow,f=t.data;if(d){this.aacOverFlow=null;var p=d.sample.unit.byteLength,m=Math.min(d.missing,p),g=p-m;d.sample.unit.set(f.subarray(0,m),g),c.samples.push(d.sample),a=d.missing}for(e=a,n=f.length;e<n-1&&!r.isHeader(f,e);e++);if(e===a||(e<n-1?(i="AAC PES did not start with ADTS header,offset:"+e,s=!1):(i="no ADTS header found in AAC PES",s=!0),h.logger.warn("parsing error:"+i),this.observer.emit(l.Events.ERROR,l.Events.ERROR,{type:u.ErrorTypes.MEDIA_ERROR,details:u.ErrorDetails.FRAG_PARSING_ERROR,fatal:s,reason:i}),!s)){if(r.initTrackConfig(c,this.observer,f,e,this.audioCodec),void 0!==t.pts)o=t.pts;else{if(!d)return void h.logger.warn("[tsdemuxer]: AAC PES unknown PTS");var v=r.getFrameDuration(c.samplerate);o=d.sample.pts+v}for(var y=0;e<n;){if(r.isHeader(f,e)){if(e+5<n){var b=r.appendFrame(c,f,e,o,y);if(b){if(!b.missing){e+=b.length,y++;continue}this.aacOverFlow=b}}break}e++}}},e.parseMPEGPES=function(t){var e=t.data,n=e.length,r=0,s=0,o=t.pts;if(void 0!==o)for(;s<n;)if(i.isHeader(e,s)){var a=i.appendFrame(this._audioTrack,e,s,o,r);if(!a)break;s+=a.length,r++}else s++;else h.logger.warn("[tsdemuxer]: MPEG PES unknown PTS")},e.parseID3PES=function(t){void 0!==t.pts?this._id3Track.samples.push(t):h.logger.warn("[tsdemuxer]: ID3 PES unknown PTS")},t}();function p(t,e,n,r){return{key:t,frame:!1,pts:e,dts:n,units:[],debug:r,length:0}}function m(t,e){return(31&t[e+10])<<8|t[e+11]}function g(t,e,n,r){var i={audio:-1,avc:-1,id3:-1,isAAC:!0},s=e+3+((15&t[e+1])<<8|t[e+2])-4;for(e+=12+((15&t[e+10])<<8|t[e+11]);e<s;){var o=(31&t[e+1])<<8|t[e+2];switch(t[e]){case 207:if(!r){h.logger.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===i.audio&&(i.audio=o);break;case 21:-1===i.id3&&(i.id3=o);break;case 219:if(!r){h.logger.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===i.avc&&(i.avc=o);break;case 3:case 4:n?-1===i.audio&&(i.audio=o,i.isAAC=!1):h.logger.log("MPEG audio found, not supported in this browser");break;case 36:h.logger.warn("Unsupported HEVC stream type found")}e+=5+((15&t[e+3])<<8|t[e+4])}return i}function v(t){var e,n,r,i,s,o=0,a=t.data;if(!t||0===t.size)return null;for(;a[0].length<19&&a.length>1;){var l=new Uint8Array(a[0].length+a[1].length);l.set(a[0]),l.set(a[1],a[0].length),a[0]=l,a.splice(1,1)}if(1===((e=a[0])[0]<<16)+(e[1]<<8)+e[2]){if((n=(e[4]<<8)+e[5])&&n>t.size-6)return null;var c=e[7];192&c&&(i=536870912*(14&e[9])+4194304*(255&e[10])+16384*(254&e[11])+128*(255&e[12])+(254&e[13])/2,64&c?i-(s=536870912*(14&e[14])+4194304*(255&e[15])+16384*(254&e[16])+128*(255&e[17])+(254&e[18])/2)>54e5&&(h.logger.warn(Math.round((i-s)/9e4)+"s delta between PTS and DTS, align them"),i=s):s=i);var u=(r=e[8])+9;if(t.size<=u)return null;t.size-=u;for(var d=new Uint8Array(t.size),f=0,p=a.length;f<p;f++){var m=(e=a[f]).byteLength;if(u){if(u>m){u-=m;continue}e=e.subarray(u),m-=u,u=0}d.set(e,o),o+=m}return n&&(n-=r+3),{data:d,pts:i,dts:s,len:n}}return null}function y(t,e){if(t.units.length&&t.frame){if(void 0===t.pts){var n=e.samples,r=n.length;if(!r)return void e.dropped++;var i=n[r-1];t.pts=i.pts,t.dts=i.dts}e.samples.push(t)}t.debug.length&&h.logger.log(t.pts+"/"+t.dts+":"+t.debug)}function b(t,e){var n=t.length;if(n>0){if(e.pts>=t[n-1].pts)t.push(e);else for(var r=n-1;r>=0;r--)if(e.pts<t[r].pts){t.splice(r,0,e);break}}else t.push(e)}function x(t){for(var e=t.byteLength,n=[],r=1;r<e-2;)0===t[r]&&0===t[r+1]&&3===t[r+2]?(n.push(r+2),r+=2):r++;if(0===n.length)return t;var i=e-n.length,s=new Uint8Array(i),o=0;for(r=0;r<i;o++,r++)o===n[0]&&(o++,n.shift()),s[r]=t[o];return s}f.minProbeByteLength=188,e.default=f},"./src/errors.ts":function(t,e,n){var r,i,s,o;n.r(e),n.d(e,"ErrorTypes",(function(){return r})),n.d(e,"ErrorDetails",(function(){return s})),(i=r||(r={})).NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",(o=s||(s={})).KEY_SYSTEM_NO_KEYS="keySystemNoKeys",o.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",o.KEY_SYSTEM_NO_SESSION="keySystemNoSession",o.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",o.KEY_SYSTEM_NO_INIT_DATA="keySystemNoInitData",o.MANIFEST_LOAD_ERROR="manifestLoadError",o.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",o.MANIFEST_PARSING_ERROR="manifestParsingError",o.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",o.LEVEL_EMPTY_ERROR="levelEmptyError",o.LEVEL_LOAD_ERROR="levelLoadError",o.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",o.LEVEL_SWITCH_ERROR="levelSwitchError",o.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",o.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",o.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",o.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",o.FRAG_LOAD_ERROR="fragLoadError",o.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",o.FRAG_DECRYPT_ERROR="fragDecryptError",o.FRAG_PARSING_ERROR="fragParsingError",o.REMUX_ALLOC_ERROR="remuxAllocError",o.KEY_LOAD_ERROR="keyLoadError",o.KEY_LOAD_TIMEOUT="keyLoadTimeOut",o.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",o.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",o.BUFFER_APPEND_ERROR="bufferAppendError",o.BUFFER_APPENDING_ERROR="bufferAppendingError",o.BUFFER_STALLED_ERROR="bufferStalledError",o.BUFFER_FULL_ERROR="bufferFullError",o.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",o.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",o.INTERNAL_EXCEPTION="internalException",o.INTERNAL_ABORTED="aborted",o.UNKNOWN="unknown"},"./src/events.ts":function(t,e,n){var r,i;n.r(e),n.d(e,"Events",(function(){return r})),(i=r||(r={})).MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached"},"./src/hls.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return y}));var r=n("./node_modules/url-toolkit/src/url-toolkit.js"),i=n("./src/loader/playlist-loader.ts"),s=n("./src/loader/key-loader.ts"),o=n("./src/controller/id3-track-controller.ts"),a=n("./src/controller/latency-controller.ts"),l=n("./src/controller/level-controller.ts"),c=n("./src/controller/fragment-tracker.ts"),h=n("./src/controller/stream-controller.ts"),u=n("./src/is-supported.ts"),d=n("./src/utils/logger.ts"),f=n("./src/config.ts"),p=n("./node_modules/eventemitter3/index.js"),m=n("./src/events.ts"),g=n("./src/errors.ts");function v(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var y=function(){function t(e){void 0===e&&(e={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new p.EventEmitter,this._autoLevelCapping=void 0,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this._media=null,this.url=null;var n=this.config=Object(f.mergeConfig)(t.DefaultConfig,e);this.userConfig=e,Object(d.enableLogs)(n.debug),this._autoLevelCapping=-1,n.progressive&&Object(f.enableStreamingMode)(n);var r=n.abrController,u=n.bufferController,m=n.capLevelController,g=n.fpsController,v=this.abrController=new r(this),y=this.bufferController=new u(this),b=this.capLevelController=new m(this),x=new g(this),w=new i.default(this),E=new s.default(this),_=new o.default(this),S=this.levelController=new l.default(this),T=new c.FragmentTracker(this),k=this.streamController=new h.default(this,T);b.setStreamController(k),x.setStreamController(k);var A=[S,k];this.networkControllers=A;var C=[w,E,v,y,b,x,_,T];this.audioTrackController=this.createController(n.audioTrackController,null,A),this.createController(n.audioStreamController,T,A),this.subtitleTrackController=this.createController(n.subtitleTrackController,null,A),this.createController(n.subtitleStreamController,T,A),this.createController(n.timelineController,null,C),this.emeController=this.createController(n.emeController,null,C),this.latencyController=this.createController(a.default,null,C),this.coreComponents=C}t.isSupported=function(){return Object(u.isSupported)()};var e,n,y,b=t.prototype;return b.createController=function(t,e,n){if(t){var r=e?new t(this,e):new t(this);return n&&n.push(r),r}return null},b.on=function(t,e,n){void 0===n&&(n=this),this._emitter.on(t,e,n)},b.once=function(t,e,n){void 0===n&&(n=this),this._emitter.once(t,e,n)},b.removeAllListeners=function(t){this._emitter.removeAllListeners(t)},b.off=function(t,e,n,r){void 0===n&&(n=this),this._emitter.off(t,e,n,r)},b.listeners=function(t){return this._emitter.listeners(t)},b.emit=function(t,e,n){return this._emitter.emit(t,e,n)},b.trigger=function(t,e){if(this.config.debug)return this.emit(t,t,e);try{return this.emit(t,t,e)}catch(n){d.logger.error("An internal error happened while handling event "+t+'. Error message: "'+n.message+'". Here is a stacktrace:',n),this.trigger(m.Events.ERROR,{type:g.ErrorTypes.OTHER_ERROR,details:g.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:t,error:n})}return!1},b.listenerCount=function(t){return this._emitter.listenerCount(t)},b.destroy=function(){d.logger.log("destroy"),this.trigger(m.Events.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(t){return t.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(t){return t.destroy()})),this.coreComponents.length=0},b.attachMedia=function(t){d.logger.log("attachMedia"),this._media=t,this.trigger(m.Events.MEDIA_ATTACHING,{media:t})},b.detachMedia=function(){d.logger.log("detachMedia"),this.trigger(m.Events.MEDIA_DETACHING,void 0),this._media=null},b.loadSource=function(t){this.stopLoad();var e=this.media,n=this.url,i=this.url=r.buildAbsoluteURL(self.location.href,t,{alwaysNormalize:!0});d.logger.log("loadSource:"+i),e&&n&&n!==i&&this.bufferController.hasSourceTypes()&&(this.detachMedia(),this.attachMedia(e)),this.trigger(m.Events.MANIFEST_LOADING,{url:t})},b.startLoad=function(t){void 0===t&&(t=-1),d.logger.log("startLoad("+t+")"),this.networkControllers.forEach((function(e){e.startLoad(t)}))},b.stopLoad=function(){d.logger.log("stopLoad"),this.networkControllers.forEach((function(t){t.stopLoad()}))},b.swapAudioCodec=function(){d.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()},b.recoverMediaError=function(){d.logger.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},b.removeLevel=function(t,e){void 0===e&&(e=0),this.levelController.removeLevel(t,e)},e=t,y=[{key:"version",get:function(){return"1.0.10"}},{key:"Events",get:function(){return m.Events}},{key:"ErrorTypes",get:function(){return g.ErrorTypes}},{key:"ErrorDetails",get:function(){return g.ErrorDetails}},{key:"DefaultConfig",get:function(){return t.defaultConfig?t.defaultConfig:f.hlsDefaultConfig},set:function(e){t.defaultConfig=e}}],(n=[{key:"levels",get:function(){return this.levelController.levels||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(t){d.logger.log("set currentLevel:"+t),this.loadLevel=t,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(t){d.logger.log("set nextLevel:"+t),this.levelController.manualLevel=t,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(t){d.logger.log("set loadLevel:"+t),this.levelController.manualLevel=t}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(t){this.levelController.nextLoadLevel=t}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(t){d.logger.log("set firstLevel:"+t),this.levelController.firstLevel=t}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(t){d.logger.log("set startLevel:"+t),-1!==t&&(t=Math.max(t,this.minAutoLevel)),this.levelController.startLevel=t}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(t){var e=!!t;e!==this.config.capLevelToPlayerSize&&(e?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=e)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(t){this._autoLevelCapping!==t&&(d.logger.log("set autoLevelCapping:"+t),this._autoLevelCapping=t)}},{key:"bandwidthEstimate",get:function(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var t=this.levels,e=this.config.minAutoBitrate;if(!t)return 0;for(var n=t.length,r=0;r<n;r++)if(t[r].maxBitrate>e)return r;return 0}},{key:"maxAutoLevel",get:function(){var t=this.levels,e=this.autoLevelCapping;return-1===e&&t&&t.length?t.length-1:e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(t){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,t)}},{key:"audioTracks",get:function(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function(t){var e=this.audioTrackController;e&&(e.audioTrack=t)}},{key:"subtitleTracks",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleTrack=t)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function(t){var e=this.subtitleTrackController;e&&(e.subtitleDisplay=t)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(t){this.config.lowLatencyMode=t}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}])&&v(e.prototype,n),y&&v(e,y),t}();y.defaultConfig=void 0},"./src/is-supported.ts":function(t,e,n){n.r(e),n.d(e,"isSupported",(function(){return s})),n.d(e,"changeTypeSupported",(function(){return o}));var r=n("./src/utils/mediasource-helper.ts");function i(){return self.SourceBuffer||self.WebKitSourceBuffer}function s(){var t=Object(r.getMediaSource)();if(!t)return!1;var e=i(),n=t&&"function"==typeof t.isTypeSupported&&t.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),s=!e||e.prototype&&"function"==typeof e.prototype.appendBuffer&&"function"==typeof e.prototype.remove;return!!n&&!!s}function o(){var t,e=i();return"function"==typeof(null==e||null===(t=e.prototype)||void 0===t?void 0:t.changeType)}},"./src/loader/fragment-loader.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return h})),n.d(e,"LoadError",(function(){return d}));var r=n("./src/polyfills/number.ts"),i=n("./src/errors.ts");function s(t){var e="function"==typeof Map?new Map:void 0;return(s=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return o(t,arguments,l(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,t)})(t)}function o(t,e,n){return(o=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function l(t){return(l=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var c=Math.pow(2,17),h=function(){function t(t){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=t}var e=t.prototype;return e.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},e.abort=function(){this.loader&&this.loader.abort()},e.load=function(t,e){var n=this,r=t.url;if(!r)return Promise.reject(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,networkDetails:null},"Fragment does not have a "+(r?"part list":"url")));this.abort();var s=this.config,o=s.fLoader,a=s.loader;return new Promise((function(r,l){n.loader&&n.loader.destroy();var h=n.loader=t.loader=o?new o(s):new a(s),f=u(t),p={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:c};t.stats=h.stats,h.load(f,p,{onSuccess:function(e,i,s,o){n.resetLoader(t,h),r({frag:t,part:null,payload:e.data,networkDetails:o})},onError:function(e,r,s){n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,response:e,networkDetails:s}))},onAbort:function(e,r,s){n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,networkDetails:s}))},onTimeout:function(e,r,s){n.resetLoader(t,h),l(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,networkDetails:s}))},onProgress:function(n,r,i,s){e&&e({frag:t,part:null,payload:i,networkDetails:s})}})}))},e.loadPart=function(t,e,n){var r=this;this.abort();var s=this.config,o=s.fLoader,a=s.loader;return new Promise((function(l,h){r.loader&&r.loader.destroy();var f=r.loader=t.loader=o?new o(s):new a(s),p=u(t,e),m={timeout:s.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:s.fragLoadingMaxRetryTimeout,highWaterMark:c};e.stats=f.stats,f.load(p,m,{onSuccess:function(i,s,o,a){r.resetLoader(t,f),r.updateStatsFromPart(t,e);var c={frag:t,part:e,payload:i.data,networkDetails:a};n(c),l(c)},onError:function(n,s,o){r.resetLoader(t,f),h(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t,part:e,response:n,networkDetails:o}))},onAbort:function(n,s,o){t.stats.aborted=e.stats.aborted,r.resetLoader(t,f),h(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.INTERNAL_ABORTED,fatal:!1,frag:t,part:e,networkDetails:o}))},onTimeout:function(n,s,o){r.resetLoader(t,f),h(new d({type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t,part:e,networkDetails:o}))}})}))},e.updateStatsFromPart=function(t,e){var n=t.stats,r=e.stats,i=r.total;if(n.loaded+=r.loaded,i){var s=Math.round(t.duration/e.duration),o=Math.min(Math.round(n.loaded/i),s),a=(s-o)*Math.round(n.loaded/o);n.total=n.loaded+a}else n.total=Math.max(n.loaded,n.total);var l=n.loading,c=r.loading;l.start?l.first+=c.first-c.start:(l.start=c.start,l.first=c.first),l.end=c.end},e.resetLoader=function(t,e){t.loader=null,this.loader===e&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),e.destroy()},t}();function u(t,e){void 0===e&&(e=null);var n=e||t,i={frag:t,part:e,responseType:"arraybuffer",url:n.url,rangeStart:0,rangeEnd:0},s=n.byteRangeStartOffset,o=n.byteRangeEndOffset;return Object(r.isFiniteNumber)(s)&&Object(r.isFiniteNumber)(o)&&(i.rangeStart=s,i.rangeEnd=o),i}var d=function(t){var e,n;function r(e){for(var n,r=arguments.length,i=new Array(r>1?r-1:0),s=1;s<r;s++)i[s-1]=arguments[s];return(n=t.call.apply(t,[this].concat(i))||this).data=void 0,n.data=e,n}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,a(e,n),r}(s(Error))},"./src/loader/fragment.ts":function(t,e,n){n.r(e),n.d(e,"ElementaryStreamTypes",(function(){return r})),n.d(e,"BaseSegment",(function(){return p})),n.d(e,"Fragment",(function(){return m})),n.d(e,"Part",(function(){return g}));var r,i,s=n("./src/polyfills/number.ts"),o=n("./node_modules/url-toolkit/src/url-toolkit.js"),a=n("./src/utils/logger.ts"),l=n("./src/loader/level-key.ts"),c=n("./src/loader/load-stats.ts");function h(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,u(t,e)}function u(t,e){return(u=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function d(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function f(t,e,n){return e&&d(t.prototype,e),n&&d(t,n),t}(i=r||(r={})).AUDIO="audio",i.VIDEO="video",i.AUDIOVIDEO="audiovideo";var p=function(){function t(t){var e;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=((e={})[r.AUDIO]=null,e[r.VIDEO]=null,e[r.AUDIOVIDEO]=null,e),this.baseurl=t}return t.prototype.setByteRange=function(t,e){var n=t.split("@",2),r=[];1===n.length?r[0]=e?e.byteRangeEndOffset:0:r[0]=parseInt(n[1]),r[1]=parseInt(n[0])+r[0],this._byteRange=r},f(t,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=Object(o.buildAbsoluteURL)(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(t){this._url=t}}]),t}(),m=function(t){function e(e,n){var r;return(r=t.call(this,n)||this)._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkey=void 0,r.type=void 0,r.loader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.appendedPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new c.LoadStats,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.type=e,r}h(e,t);var n=e.prototype;return n.createInitializationVector=function(t){for(var e=new Uint8Array(16),n=12;n<16;n++)e[n]=t>>8*(15-n)&255;return e},n.setDecryptDataFromLevelKey=function(t,e){var n=t;return"AES-128"===(null==t?void 0:t.method)&&t.uri&&!t.iv&&((n=l.LevelKey.fromURI(t.uri)).method=t.method,n.iv=this.createInitializationVector(e),n.keyFormat="identity"),n},n.setElementaryStreamInfo=function(t,e,n,r,i,s){void 0===s&&(s=!1);var o=this.elementaryStreams,a=o[t];a?(a.startPTS=Math.min(a.startPTS,e),a.endPTS=Math.max(a.endPTS,n),a.startDTS=Math.min(a.startDTS,r),a.endDTS=Math.max(a.endDTS,i)):o[t]={startPTS:e,endPTS:n,startDTS:r,endDTS:i,partial:s}},n.clearElementaryStreamInfo=function(){var t=this.elementaryStreams;t[r.AUDIO]=null,t[r.VIDEO]=null,t[r.AUDIOVIDEO]=null},f(e,[{key:"decryptdata",get:function(){if(!this.levelkey&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkey){var t=this.sn;"number"!=typeof t&&(this.levelkey&&"AES-128"===this.levelkey.method&&!this.levelkey.iv&&a.logger.warn('missing IV for initialization segment with method="'+this.levelkey.method+'" - compliance issue'),t=0),this._decryptdata=this.setDecryptDataFromLevelKey(this.levelkey,t)}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!Object(s.isFiniteNumber)(this.programDateTime))return null;var t=Object(s.isFiniteNumber)(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function(){var t;return!(null===(t=this.decryptdata)||void 0===t||!t.keyFormat||!this.decryptdata.uri)}}]),e}(p),g=function(t){function e(e,n,r,i,s){var o;(o=t.call(this,r)||this).fragOffset=0,o.duration=0,o.gap=!1,o.independent=!1,o.relurl=void 0,o.fragment=void 0,o.index=void 0,o.stats=new c.LoadStats,o.duration=e.decimalFloatingPoint("DURATION"),o.gap=e.bool("GAP"),o.independent=e.bool("INDEPENDENT"),o.relurl=e.enumeratedString("URI"),o.fragment=n,o.index=i;var a=e.enumeratedString("BYTERANGE");return a&&o.setByteRange(a,s),s&&(o.fragOffset=s.fragOffset+s.duration),o}return h(e,t),f(e,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),e}(p)},"./src/loader/key-loader.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return o}));var r=n("./src/events.ts"),i=n("./src/errors.ts"),s=n("./src/utils/logger.ts"),o=function(){function t(t){this.hls=void 0,this.loaders={},this.decryptkey=null,this.decrypturl=null,this.hls=t,this._registerListeners()}var e=t.prototype;return e._registerListeners=function(){this.hls.on(r.Events.KEY_LOADING,this.onKeyLoading,this)},e._unregisterListeners=function(){this.hls.off(r.Events.KEY_LOADING,this.onKeyLoading)},e.destroy=function(){for(var t in this._unregisterListeners(),this.loaders){var e=this.loaders[t];e&&e.destroy()}this.loaders={}},e.onKeyLoading=function(t,e){var n=e.frag,i=n.type,o=this.loaders[i];if(n.decryptdata){var a=n.decryptdata.uri;if(a!==this.decrypturl||null===this.decryptkey){var l=this.hls.config;if(o&&(s.logger.warn("abort previous key loader for type:"+i),o.abort()),!a)return void s.logger.warn("key uri is falsy");var c=l.loader,h=n.loader=this.loaders[i]=new c(l);this.decrypturl=a,this.decryptkey=null;var u={url:a,frag:n,responseType:"arraybuffer"},d={timeout:l.fragLoadingTimeOut,maxRetry:0,retryDelay:l.fragLoadingRetryDelay,maxRetryDelay:l.fragLoadingMaxRetryTimeout,highWaterMark:0},f={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(u,d,f)}else this.decryptkey&&(n.decryptdata.key=this.decryptkey,this.hls.trigger(r.Events.KEY_LOADED,{frag:n}))}else s.logger.warn("Missing decryption data on fragment in onKeyLoading")},e.loadsuccess=function(t,e,n){var i=n.frag;i.decryptdata?(this.decryptkey=i.decryptdata.key=new Uint8Array(t.data),i.loader=null,delete this.loaders[i.type],this.hls.trigger(r.Events.KEY_LOADED,{frag:i})):s.logger.error("after key load, decryptdata unset")},e.loaderror=function(t,e){var n=e.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:n,response:t})},e.loadtimeout=function(t,e){var n=e.frag,s=n.loader;s&&s.abort(),delete this.loaders[n.type],this.hls.trigger(r.Events.ERROR,{type:i.ErrorTypes.NETWORK_ERROR,details:i.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:n})},t}()},"./src/loader/level-details.ts":function(t,e,n){n.r(e),n.d(e,"LevelDetails",(function(){return i}));var r=n("./src/polyfills/number.ts");var i=function(){function t(t){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.needSidxRanges=!1,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.fragments=[],this.url=t}var e;return t.prototype.reloaded=function(t){if(!t)return this.advanced=!0,void(this.updated=!0);var e=this.lastPartSn-t.lastPartSn,n=this.lastPartIndex-t.lastPartIndex;this.updated=this.endSN!==t.endSN||!!n||!!e,this.advanced=this.endSN>t.endSN||e>0||0===e&&n>0,this.updated||this.advanced?this.misses=Math.floor(.6*t.misses):this.misses=t.misses+1,this.availabilityDelay=t.availabilityDelay},(e=[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&Object(r.isFiniteNumber)(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function(){var t=this.driftEndTime-this.driftStartTime;return t>0?1e3*(this.driftEnd-this.driftStart)/t:1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var t;return null!==(t=this.fragments)&&void 0!==t&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var t;return null!==(t=this.partList)&&void 0!==t&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}()},"./src/loader/level-key.ts":function(t,e,n){n.r(e),n.d(e,"LevelKey",(function(){return i}));var r=n("./node_modules/url-toolkit/src/url-toolkit.js");var i=function(){function t(t,e){this._uri=null,this.method=null,this.keyFormat=null,this.keyFormatVersions=null,this.keyID=null,this.key=null,this.iv=null,this._uri=e?Object(r.buildAbsoluteURL)(t,e,{alwaysNormalize:!0}):t}var e;return t.fromURL=function(e,n){return new t(e,n)},t.fromURI=function(e){return new t(e)},(e=[{key:"uri",get:function(){return this._uri}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}()},"./src/loader/load-stats.ts":function(t,e,n){n.r(e),n.d(e,"LoadStats",(function(){return r}));var r=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}},"./src/loader/m3u8-parser.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return g}));var r=n("./src/polyfills/number.ts"),i=n("./node_modules/url-toolkit/src/url-toolkit.js"),s=n("./src/loader/fragment.ts"),o=n("./src/loader/level-details.ts"),a=n("./src/loader/level-key.ts"),l=n("./src/utils/attr-list.ts"),c=n("./src/utils/logger.ts"),h=n("./src/utils/codecs.ts"),u=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-SESSION-DATA:([^\r\n]*)[\r\n]+/g,d=/#EXT-X-MEDIA:(.*)/g,f=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),p=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(PLAYLIST-TYPE):(.+)/.source,/#EXT-X-(MEDIA-SEQUENCE): *(\d+)/.source,/#EXT-X-(SKIP):(.+)/.source,/#EXT-X-(TARGETDURATION): *(\d+)/.source,/#EXT-X-(KEY):(.+)/.source,/#EXT-X-(START):(.+)/.source,/#EXT-X-(ENDLIST)/.source,/#EXT-X-(DISCONTINUITY-SEQ)UENCE: *(\d+)/.source,/#EXT-X-(DIS)CONTINUITY/.source,/#EXT-X-(VERSION):(\d+)/.source,/#EXT-X-(MAP):(.+)/.source,/#EXT-X-(SERVER-CONTROL):(.+)/.source,/#EXT-X-(PART-INF):(.+)/.source,/#EXT-X-(GAP)/.source,/#EXT-X-(BITRATE):\s*(\d+)/.source,/#EXT-X-(PART):(.+)/.source,/#EXT-X-(PRELOAD-HINT):(.+)/.source,/#EXT-X-(RENDITION-REPORT):(.+)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),m=/\.(mp4|m4s|m4v|m4a)$/i,g=function(){function t(){}return t.findGroup=function(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.id===e)return r}},t.convertAVC1ToAVCOTI=function(t){var e=t.split(".");if(e.length>2){var n=e.shift()+".";return(n+=parseInt(e.shift()).toString(16))+("000"+parseInt(e.shift()).toString(16)).substr(-4)}return t},t.resolve=function(t,e){return i.buildAbsoluteURL(e,t,{alwaysNormalize:!0})},t.parseMasterPlaylist=function(e,n){var r,i=[],s={},o=!1;for(u.lastIndex=0;null!=(r=u.exec(e));)if(r[1]){var a=new l.AttrList(r[1]),c={attrs:a,bitrate:a.decimalInteger("AVERAGE-BANDWIDTH")||a.decimalInteger("BANDWIDTH"),name:a.NAME,url:t.resolve(r[2],n)},h=a.decimalResolution("RESOLUTION");h&&(c.width=h.width,c.height=h.height),v((a.CODECS||"").split(/[ ,]+/).filter((function(t){return t})),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=t.convertAVC1ToAVCOTI(c.videoCodec)),i.push(c)}else if(r[3]){var d=new l.AttrList(r[3]);d["DATA-ID"]&&(o=!0,s[d["DATA-ID"]]=d)}return{levels:i,sessionData:o?s:null}},t.parseMasterPlaylistMedia=function(e,n,r,i){var s;void 0===i&&(i=[]);var o=[],a=0;for(d.lastIndex=0;null!==(s=d.exec(e));){var c=new l.AttrList(s[1]);if(c.TYPE===r){var h={attrs:c,bitrate:0,id:a++,groupId:c["GROUP-ID"],instreamId:c["INSTREAM-ID"],name:c.NAME||c.LANGUAGE||"",type:r,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:c.LANGUAGE,url:c.URI?t.resolve(c.URI,n):""};if(i.length){var u=t.findGroup(i,h.groupId)||i[0];y(h,u,"audioCodec"),y(h,u,"textCodec")}o.push(h)}}return o},t.parseLevelPlaylist=function(t,e,n,h,u){var d,g,v,y=new o.LevelDetails(e),x=y.fragments,w=null,E=0,_=0,S=0,T=0,k=null,A=new s.Fragment(h,e),C=-1,R=!1;for(f.lastIndex=0,y.m3u8=t;null!==(d=f.exec(t));){R&&(R=!1,(A=new s.Fragment(h,e)).start=S,A.sn=E,A.cc=T,A.level=n,w&&(A.initSegment=w,A.rawProgramDateTime=w.rawProgramDateTime));var M=d[1];if(M){A.duration=parseFloat(M);var I=(" "+d[2]).slice(1);A.title=I||null,A.tagList.push(I?["INF",M,I]:["INF",M])}else if(d[3])Object(r.isFiniteNumber)(A.duration)&&(A.start=S,v&&(A.levelkey=v),A.sn=E,A.level=n,A.cc=T,A.urlId=u,x.push(A),A.relurl=(" "+d[3]).slice(1),b(A,k),k=A,S+=A.duration,E++,_=0,R=!0);else if(d[4]){var D=(" "+d[4]).slice(1);k?A.setByteRange(D,k):A.setByteRange(D)}else if(d[5])A.rawProgramDateTime=(" "+d[5]).slice(1),A.tagList.push(["PROGRAM-DATE-TIME",A.rawProgramDateTime]),-1===C&&(C=x.length);else{if(!(d=d[0].match(p))){c.logger.warn("No matches on slow regex match for level playlist!");continue}for(g=1;g<d.length&&void 0===d[g];g++);var O=(" "+d[g]).slice(1),P=(" "+d[g+1]).slice(1),L=d[g+2]?(" "+d[g+2]).slice(1):"";switch(O){case"PLAYLIST-TYPE":y.type=P.toUpperCase();break;case"MEDIA-SEQUENCE":E=y.startSN=parseInt(P);break;case"SKIP":var F=new l.AttrList(P),N=F.decimalInteger("SKIPPED-SEGMENTS");if(Object(r.isFiniteNumber)(N)){y.skippedSegments=N;for(var B=N;B--;)x.unshift(null);E+=N}var U=F.enumeratedString("RECENTLY-REMOVED-DATERANGES");U&&(y.recentlyRemovedDateranges=U.split("\t"));break;case"TARGETDURATION":y.targetduration=parseFloat(P);break;case"VERSION":y.version=parseInt(P);break;case"EXTM3U":break;case"ENDLIST":y.live=!1;break;case"#":(P||L)&&A.tagList.push(L?[P,L]:[P]);break;case"DIS":T++;case"GAP":A.tagList.push([O]);break;case"BITRATE":A.tagList.push([O,P]);break;case"DISCONTINUITY-SEQ":T=parseInt(P);break;case"KEY":var V,j=new l.AttrList(P),z=j.enumeratedString("METHOD"),G=j.URI,W=j.hexadecimalInteger("IV"),H=j.enumeratedString("KEYFORMATVERSIONS"),$=j.enumeratedString("KEYID"),Y=null!=(V=j.enumeratedString("KEYFORMAT"))?V:"identity";if(["com.apple.streamingkeydelivery","com.microsoft.playready","urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed","com.widevine"].indexOf(Y)>-1){c.logger.warn("Keyformat "+Y+" is not supported from the manifest");continue}if("identity"!==Y)continue;z&&(v=a.LevelKey.fromURL(e,G),G&&["AES-128","SAMPLE-AES","SAMPLE-AES-CENC"].indexOf(z)>=0&&(v.method=z,v.keyFormat=Y,$&&(v.keyID=$),H&&(v.keyFormatVersions=H),v.iv=W));break;case"START":var X=new l.AttrList(P).decimalFloatingPoint("TIME-OFFSET");Object(r.isFiniteNumber)(X)&&(y.startTimeOffset=X);break;case"MAP":var q=new l.AttrList(P);A.relurl=q.URI,q.BYTERANGE&&A.setByteRange(q.BYTERANGE),A.level=n,A.sn="initSegment",v&&(A.levelkey=v),A.initSegment=null,w=A,R=!0;break;case"SERVER-CONTROL":var K=new l.AttrList(P);y.canBlockReload=K.bool("CAN-BLOCK-RELOAD"),y.canSkipUntil=K.optionalFloat("CAN-SKIP-UNTIL",0),y.canSkipDateRanges=y.canSkipUntil>0&&K.bool("CAN-SKIP-DATERANGES"),y.partHoldBack=K.optionalFloat("PART-HOLD-BACK",0),y.holdBack=K.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var Z=new l.AttrList(P);y.partTarget=Z.decimalFloatingPoint("PART-TARGET");break;case"PART":var J=y.partList;J||(J=y.partList=[]);var Q=_>0?J[J.length-1]:void 0,tt=_++,et=new s.Part(new l.AttrList(P),A,e,tt,Q);J.push(et),A.duration+=et.duration;break;case"PRELOAD-HINT":var nt=new l.AttrList(P);y.preloadHint=nt;break;case"RENDITION-REPORT":var rt=new l.AttrList(P);y.renditionReports=y.renditionReports||[],y.renditionReports.push(rt);break;default:c.logger.warn("line parsed but not handled: "+d)}}}k&&!k.relurl?(x.pop(),S-=k.duration,y.partList&&(y.fragmentHint=k)):y.partList&&(b(A,k),A.cc=T,y.fragmentHint=A);var it=x.length,st=x[0],ot=x[it-1];if((S+=y.skippedSegments*y.targetduration)>0&&it&&ot){y.averagetargetduration=S/it;var at=ot.sn;y.endSN="initSegment"!==at?at:0,st&&(y.startCC=st.cc,st.initSegment||y.fragments.every((function(t){return t.relurl&&(e=t.relurl,m.test(null!=(n=null===(r=i.parseURL(e))||void 0===r?void 0:r.path)?n:""));var e,n,r}))&&(c.logger.warn("MP4 fragments found but no init segment (probably no MAP, incomplete M3U8), trying to fetch SIDX"),(A=new s.Fragment(h,e)).relurl=ot.relurl,A.level=n,A.sn="initSegment",st.initSegment=A,y.needSidxRanges=!0))}else y.endSN=0,y.startCC=0;return y.fragmentHint&&(S+=y.fragmentHint.duration),y.totalduration=S,y.endCC=T,C>0&&function(t,e){for(var n=t[e],r=e;r--;){var i=t[r];if(!i)return;i.programDateTime=n.programDateTime-1e3*i.duration,n=i}}(x,C),y},t}();function v(t,e){["video","audio","text"].forEach((function(n){var r=t.filter((function(t){return Object(h.isCodecType)(t,n)}));if(r.length){var i=r.filter((function(t){return 0===t.lastIndexOf("avc1",0)||0===t.lastIndexOf("mp4a",0)}));e[n+"Codec"]=i.length>0?i[0]:r[0],t=t.filter((function(t){return-1===r.indexOf(t)}))}})),e.unknownCodecs=t}function y(t,e,n){var r=e[n];r&&(t[n]=r)}function b(t,e){t.rawProgramDateTime?t.programDateTime=Date.parse(t.rawProgramDateTime):null!=e&&e.programDateTime&&(t.programDateTime=e.endProgramDateTime),Object(r.isFiniteNumber)(t.programDateTime)||(t.programDateTime=null,t.rawProgramDateTime=null)}},"./src/loader/playlist-loader.ts":function(t,e,n){n.r(e);var r=n("./src/polyfills/number.ts"),i=n("./src/events.ts"),s=n("./src/errors.ts"),o=n("./src/utils/logger.ts"),a=n("./src/utils/mp4-tools.ts"),l=n("./src/loader/m3u8-parser.ts"),c=n("./src/types/loader.ts"),h=n("./src/utils/attr-list.ts");function u(t,e){var n=t.url;return void 0!==n&&0!==n.indexOf("data:")||(n=e.url),n}var d=function(){function t(t){this.hls=void 0,this.loaders=Object.create(null),this.hls=t,this.registerListeners()}var e=t.prototype;return e.registerListeners=function(){var t=this.hls;t.on(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.on(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.on(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.unregisterListeners=function(){var t=this.hls;t.off(i.Events.MANIFEST_LOADING,this.onManifestLoading,this),t.off(i.Events.LEVEL_LOADING,this.onLevelLoading,this),t.off(i.Events.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(i.Events.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},e.createInternalLoader=function(t){var e=this.hls.config,n=e.pLoader,r=e.loader,i=new(n||r)(e);return t.loader=i,this.loaders[t.type]=i,i},e.getInternalLoader=function(t){return this.loaders[t.type]},e.resetInternalLoader=function(t){this.loaders[t]&&delete this.loaders[t]},e.destroyInternalLoaders=function(){for(var t in this.loaders){var e=this.loaders[t];e&&e.destroy(),this.resetInternalLoader(t)}},e.destroy=function(){this.unregisterListeners(),this.destroyInternalLoaders()},e.onManifestLoading=function(t,e){var n=e.url;this.load({id:null,groupId:null,level:0,responseType:"text",type:c.PlaylistContextType.MANIFEST,url:n,deliveryDirectives:null})},e.onLevelLoading=function(t,e){var n=e.id,r=e.level,i=e.url,s=e.deliveryDirectives;this.load({id:n,groupId:null,level:r,responseType:"text",type:c.PlaylistContextType.LEVEL,url:i,deliveryDirectives:s})},e.onAudioTrackLoading=function(t,e){var n=e.id,r=e.groupId,i=e.url,s=e.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:c.PlaylistContextType.AUDIO_TRACK,url:i,deliveryDirectives:s})},e.onSubtitleTrackLoading=function(t,e){var n=e.id,r=e.groupId,i=e.url,s=e.deliveryDirectives;this.load({id:n,groupId:r,level:null,responseType:"text",type:c.PlaylistContextType.SUBTITLE_TRACK,url:i,deliveryDirectives:s})},e.load=function(t){var e,n,r,i,s,a,l=this.hls.config,h=this.getInternalLoader(t);if(h){var u=h.context;if(u&&u.url===t.url)return void o.logger.trace("[playlist-loader]: playlist request ongoing");o.logger.log("[playlist-loader]: aborting previous loader for type: "+t.type),h.abort()}switch(t.type){case c.PlaylistContextType.MANIFEST:n=l.manifestLoadingMaxRetry,r=l.manifestLoadingTimeOut,i=l.manifestLoadingRetryDelay,s=l.manifestLoadingMaxRetryTimeout;break;case c.PlaylistContextType.LEVEL:case c.PlaylistContextType.AUDIO_TRACK:case c.PlaylistContextType.SUBTITLE_TRACK:n=0,r=l.levelLoadingTimeOut;break;default:n=l.levelLoadingMaxRetry,r=l.levelLoadingTimeOut,i=l.levelLoadingRetryDelay,s=l.levelLoadingMaxRetryTimeout}if(h=this.createInternalLoader(t),null!==(e=t.deliveryDirectives)&&void 0!==e&&e.part&&(t.type===c.PlaylistContextType.LEVEL&&null!==t.level?a=this.hls.levels[t.level].details:t.type===c.PlaylistContextType.AUDIO_TRACK&&null!==t.id?a=this.hls.audioTracks[t.id].details:t.type===c.PlaylistContextType.SUBTITLE_TRACK&&null!==t.id&&(a=this.hls.subtitleTracks[t.id].details),a)){var d=a.partTarget,f=a.targetduration;d&&f&&(r=Math.min(1e3*Math.max(3*d,.8*f),r))}var p={timeout:r,maxRetry:n,retryDelay:i,maxRetryDelay:s,highWaterMark:0},m={onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this)};h.load(t,p,m)},e.loadsuccess=function(t,e,n,r){if(void 0===r&&(r=null),n.isSidxRequest)return this.handleSidxRequest(t,n),void this.handlePlaylistLoaded(t,e,n,r);this.resetInternalLoader(n.type);var i=t.data;0===i.indexOf("#EXTM3U")?(e.parsing.start=performance.now(),i.indexOf("#EXTINF:")>0||i.indexOf("#EXT-X-TARGETDURATION:")>0?this.handleTrackOrLevelPlaylist(t,e,n,r):this.handleMasterPlaylist(t,e,n,r)):this.handleManifestParsingError(t,n,"no EXTM3U delimiter",r)},e.loaderror=function(t,e,n){void 0===n&&(n=null),this.handleNetworkError(e,n,!1,t)},e.loadtimeout=function(t,e,n){void 0===n&&(n=null),this.handleNetworkError(e,n,!0)},e.handleMasterPlaylist=function(t,e,n,r){var s=this.hls,a=t.data,c=u(t,n),d=l.default.parseMasterPlaylist(a,c),f=d.levels,p=d.sessionData;if(f.length){var m=f.map((function(t){return{id:t.attrs.AUDIO,audioCodec:t.audioCodec}})),g=f.map((function(t){return{id:t.attrs.SUBTITLES,textCodec:t.textCodec}})),v=l.default.parseMasterPlaylistMedia(a,c,"AUDIO",m),y=l.default.parseMasterPlaylistMedia(a,c,"SUBTITLES",g),b=l.default.parseMasterPlaylistMedia(a,c,"CLOSED-CAPTIONS");v.length&&(v.some((function(t){return!t.url}))||!f[0].audioCodec||f[0].attrs.AUDIO||(o.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),v.unshift({type:"main",name:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new h.AttrList({}),bitrate:0,url:""}))),s.trigger(i.Events.MANIFEST_LOADED,{levels:f,audioTracks:v,subtitles:y,captions:b,url:c,stats:e,networkDetails:r,sessionData:p})}else this.handleManifestParsingError(t,n,"no level found in manifest",r)},e.handleTrackOrLevelPlaylist=function(t,e,n,o){var a=this.hls,d=n.id,f=n.level,p=n.type,m=u(t,n),g=Object(r.isFiniteNumber)(d)?d:0,v=Object(r.isFiniteNumber)(f)?f:g,y=function(t){switch(t.type){case c.PlaylistContextType.AUDIO_TRACK:return c.PlaylistLevelType.AUDIO;case c.PlaylistContextType.SUBTITLE_TRACK:return c.PlaylistLevelType.SUBTITLE;default:return c.PlaylistLevelType.MAIN}}(n),b=l.default.parseLevelPlaylist(t.data,m,v,y,g);if(b.fragments.length){if(p===c.PlaylistContextType.MANIFEST){var x={attrs:new h.AttrList({}),bitrate:0,details:b,name:"",url:m};a.trigger(i.Events.MANIFEST_LOADED,{levels:[x],audioTracks:[],url:m,stats:e,networkDetails:o,sessionData:null})}if(e.parsing.end=performance.now(),b.needSidxRanges){var w,E=null===(w=b.fragments[0].initSegment)||void 0===w?void 0:w.url;this.load({url:E,isSidxRequest:!0,type:p,level:f,levelDetails:b,id:d,groupId:null,rangeStart:0,rangeEnd:2048,responseType:"arraybuffer",deliveryDirectives:null})}else n.levelDetails=b,this.handlePlaylistLoaded(t,e,n,o)}else a.trigger(i.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.LEVEL_EMPTY_ERROR,fatal:!1,url:m,reason:"no fragments found in level",level:"number"==typeof n.level?n.level:void 0})},e.handleSidxRequest=function(t,e){var n=Object(a.parseSegmentIndex)(new Uint8Array(t.data));if(n){var r=n.references,i=e.levelDetails;r.forEach((function(t,e){var r=t.info,s=i.fragments[e];0===s.byteRange.length&&s.setByteRange(String(1+r.end-r.start)+"@"+String(r.start)),s.initSegment&&s.initSegment.setByteRange(String(n.moovEndOffset)+"@0")}))}},e.handleManifestParsingError=function(t,e,n,r){this.hls.trigger(i.Events.ERROR,{type:s.ErrorTypes.NETWORK_ERROR,details:s.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:e.type===c.PlaylistContextType.MANIFEST,url:t.url,reason:n,response:t,context:e,networkDetails:r})},e.handleNetworkError=function(t,e,n,r){void 0===n&&(n=!1),o.logger.warn("[playlist-loader]: A network "+(n?"timeout":"error")+" occurred while loading "+t.type+" level: "+t.level+" id: "+t.id+' group-id: "'+t.groupId+'"');var a=s.ErrorDetails.UNKNOWN,l=!1,h=this.getInternalLoader(t);switch(t.type){case c.PlaylistContextType.MANIFEST:a=n?s.ErrorDetails.MANIFEST_LOAD_TIMEOUT:s.ErrorDetails.MANIFEST_LOAD_ERROR,l=!0;break;case c.PlaylistContextType.LEVEL:a=n?s.ErrorDetails.LEVEL_LOAD_TIMEOUT:s.ErrorDetails.LEVEL_LOAD_ERROR,l=!1;break;case c.PlaylistContextType.AUDIO_TRACK:a=n?s.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:s.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case c.PlaylistContextType.SUBTITLE_TRACK:a=n?s.ErrorDetails.SUBTITLE_TRACK_LOAD_TIMEOUT:s.ErrorDetails.SUBTITLE_LOAD_ERROR,l=!1}h&&this.resetInternalLoader(t.type);var u={type:s.ErrorTypes.NETWORK_ERROR,details:a,fatal:l,url:t.url,loader:h,context:t,networkDetails:e};r&&(u.response=r),this.hls.trigger(i.Events.ERROR,u)},e.handlePlaylistLoaded=function(t,e,n,r){var s=n.type,o=n.level,a=n.id,l=n.groupId,h=n.loader,u=n.levelDetails,d=n.deliveryDirectives;if(null!=u&&u.targetduration){if(h)switch(u.live&&(h.getCacheAge&&(u.ageHeader=h.getCacheAge()||0),h.getCacheAge&&!isNaN(u.ageHeader)||(u.ageHeader=0)),s){case c.PlaylistContextType.MANIFEST:case c.PlaylistContextType.LEVEL:this.hls.trigger(i.Events.LEVEL_LOADED,{details:u,level:o||0,id:a||0,stats:e,networkDetails:r,deliveryDirectives:d});break;case c.PlaylistContextType.AUDIO_TRACK:this.hls.trigger(i.Events.AUDIO_TRACK_LOADED,{details:u,id:a||0,groupId:l||"",stats:e,networkDetails:r,deliveryDirectives:d});break;case c.PlaylistContextType.SUBTITLE_TRACK:this.hls.trigger(i.Events.SUBTITLE_TRACK_LOADED,{details:u,id:a||0,groupId:l||"",stats:e,networkDetails:r,deliveryDirectives:d})}}else this.handleManifestParsingError(t,n,"invalid target duration",r)},t}();e.default=d},"./src/polyfills/number.ts":function(t,e,n){n.r(e),n.d(e,"isFiniteNumber",(function(){return r})),n.d(e,"MAX_SAFE_INTEGER",(function(){return i}));var r=Number.isFinite||function(t){return"number"==typeof t&&isFinite(t)},i=Number.MAX_SAFE_INTEGER||9007199254740991},"./src/remux/aac-helper.ts":function(t,e,n){n.r(e);var r=function(){function t(){}return t.getSilentFrame=function(t,e){if("mp4a.40.2"===t){if(1===e)return new Uint8Array([0,200,0,128,35,128]);if(2===e)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===e)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224])}else{if(1===e)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===e)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},t}();e.default=r},"./src/remux/mp4-generator.ts":function(t,e,n){n.r(e);var r=Math.pow(2,32)-1,i=function(){function t(){}return t.init=function(){var e;for(e in t.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},t.types)t.types.hasOwnProperty(e)&&(t.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);var n=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),r=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);t.HDLR_TYPES={video:n,audio:r};var i=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),s=new Uint8Array([0,0,0,0,0,0,0,0]);t.STTS=t.STSC=t.STCO=s,t.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),t.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),t.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),t.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var o=new Uint8Array([105,115,111,109]),a=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);t.FTYP=t.box(t.types.ftyp,o,l,o,a),t.DINF=t.box(t.types.dinf,t.box(t.types.dref,i))},t.box=function(t){for(var e=8,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];for(var s=r.length,o=s;s--;)e+=r[s].byteLength;var a=new Uint8Array(e);for(a[0]=e>>24&255,a[1]=e>>16&255,a[2]=e>>8&255,a[3]=255&e,a.set(t,4),s=0,e=8;s<o;s++)a.set(r[s],e),e+=r[s].byteLength;return a},t.hdlr=function(e){return t.box(t.types.hdlr,t.HDLR_TYPES[e])},t.mdat=function(e){return t.box(t.types.mdat,e)},t.mdhd=function(e,n){n*=e;var i=Math.floor(n/(r+1)),s=Math.floor(n%(r+1));return t.box(t.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,85,196,0,0]))},t.mdia=function(e){return t.box(t.types.mdia,t.mdhd(e.timescale,e.duration),t.hdlr(e.type),t.minf(e))},t.mfhd=function(e){return t.box(t.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,255&e]))},t.minf=function(e){return"audio"===e.type?t.box(t.types.minf,t.box(t.types.smhd,t.SMHD),t.DINF,t.stbl(e)):t.box(t.types.minf,t.box(t.types.vmhd,t.VMHD),t.DINF,t.stbl(e))},t.moof=function(e,n,r){return t.box(t.types.moof,t.mfhd(e),t.traf(r,n))},t.moov=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trak(e[n]);return t.box.apply(null,[t.types.moov,t.mvhd(e[0].timescale,e[0].duration)].concat(r).concat(t.mvex(e)))},t.mvex=function(e){for(var n=e.length,r=[];n--;)r[n]=t.trex(e[n]);return t.box.apply(null,[t.types.mvex].concat(r))},t.mvhd=function(e,n){n*=e;var i=Math.floor(n/(r+1)),s=Math.floor(n%(r+1)),o=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,255&e,i>>24,i>>16&255,i>>8&255,255&i,s>>24,s>>16&255,s>>8&255,255&s,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return t.box(t.types.mvhd,o)},t.sdtp=function(e){var n,r,i=e.samples||[],s=new Uint8Array(4+i.length);for(n=0;n<i.length;n++)r=i[n].flags,s[n+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return t.box(t.types.sdtp,s)},t.stbl=function(e){return t.box(t.types.stbl,t.stsd(e),t.box(t.types.stts,t.STTS),t.box(t.types.stsc,t.STSC),t.box(t.types.stsz,t.STSZ),t.box(t.types.stco,t.STCO))},t.avc1=function(e){var n,r,i,s=[],o=[];for(n=0;n<e.sps.length;n++)i=(r=e.sps[n]).byteLength,s.push(i>>>8&255),s.push(255&i),s=s.concat(Array.prototype.slice.call(r));for(n=0;n<e.pps.length;n++)i=(r=e.pps[n]).byteLength,o.push(i>>>8&255),o.push(255&i),o=o.concat(Array.prototype.slice.call(r));var a=t.box(t.types.avcC,new Uint8Array([1,s[3],s[4],s[5],255,224|e.sps.length].concat(s).concat([e.pps.length]).concat(o))),l=e.width,c=e.height,h=e.pixelRatio[0],u=e.pixelRatio[1];return t.box(t.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,c>>8&255,255&c,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),a,t.box(t.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),t.box(t.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,255&h,u>>24,u>>16&255,u>>8&255,255&u])))},t.esds=function(t){var e=t.config.length;return new Uint8Array([0,0,0,0,3,23+e,0,1,0,4,15+e,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([e]).concat(t.config).concat([6,1,2]))},t.mp4a=function(e){var n=e.samplerate;return t.box(t.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]),t.box(t.types.esds,t.esds(e)))},t.mp3=function(e){var n=e.samplerate;return t.box(t.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount,0,16,0,0,0,0,n>>8&255,255&n,0,0]))},t.stsd=function(e){return"audio"===e.type?e.isAAC||"mp3"!==e.codec?t.box(t.types.stsd,t.STSD,t.mp4a(e)):t.box(t.types.stsd,t.STSD,t.mp3(e)):t.box(t.types.stsd,t.STSD,t.avc1(e))},t.tkhd=function(e){var n=e.id,i=e.duration*e.timescale,s=e.width,o=e.height,a=Math.floor(i/(r+1)),l=Math.floor(i%(r+1));return t.box(t.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,n>>24&255,n>>16&255,n>>8&255,255&n,0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,s>>8&255,255&s,0,0,o>>8&255,255&o,0,0]))},t.traf=function(e,n){var i=t.sdtp(e),s=e.id,o=Math.floor(n/(r+1)),a=Math.floor(n%(r+1));return t.box(t.types.traf,t.box(t.types.tfhd,new Uint8Array([0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s])),t.box(t.types.tfdt,new Uint8Array([1,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,a>>24,a>>16&255,a>>8&255,255&a])),t.trun(e,i.length+16+20+8+16+8+8),i)},t.trak=function(e){return e.duration=e.duration||4294967295,t.box(t.types.trak,t.tkhd(e),t.mdia(e))},t.trex=function(e){var n=e.id;return t.box(t.types.trex,new Uint8Array([0,0,0,0,n>>24,n>>16&255,n>>8&255,255&n,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},t.trun=function(e,n){var r,i,s,o,a,l,c=e.samples||[],h=c.length,u=12+16*h,d=new Uint8Array(u);for(n+=8+u,d.set([0,0,15,1,h>>>24&255,h>>>16&255,h>>>8&255,255&h,n>>>24&255,n>>>16&255,n>>>8&255,255&n],0),r=0;r<h;r++)s=(i=c[r]).duration,o=i.size,a=i.flags,l=i.cts,d.set([s>>>24&255,s>>>16&255,s>>>8&255,255&s,o>>>24&255,o>>>16&255,o>>>8&255,255&o,a.isLeading<<2|a.dependsOn,a.isDependedOn<<6|a.hasRedundancy<<4|a.paddingValue<<1|a.isNonSync,61440&a.degradPrio,15&a.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*r);return t.box(t.types.trun,d)},t.initSegment=function(e){t.types||t.init();var n=t.moov(e),r=new Uint8Array(t.FTYP.byteLength+n.byteLength);return r.set(t.FTYP),r.set(n,t.FTYP.byteLength),r},t}();i.types=void 0,i.HDLR_TYPES=void 0,i.STTS=void 0,i.STSC=void 0,i.STCO=void 0,i.STSZ=void 0,i.VMHD=void 0,i.SMHD=void 0,i.STSD=void 0,i.FTYP=void 0,i.DINF=void 0,e.default=i},"./src/remux/mp4-remuxer.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return m})),n.d(e,"normalizePts",(function(){return g}));var r=n("./src/polyfills/number.ts"),i=n("./src/remux/aac-helper.ts"),s=n("./src/remux/mp4-generator.ts"),o=n("./src/events.ts"),a=n("./src/errors.ts"),l=n("./src/utils/logger.ts"),c=n("./src/types/loader.ts"),h=n("./src/utils/timescale-conversion.ts");function u(){return(u=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var d=null,f=null,p=!1,m=function(){function t(t,e,n,r){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=void 0,this._initDTS=void 0,this.nextAvcDts=null,this.nextAudioPts=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=t,this.config=e,this.typeSupported=n,this.ISGenerated=!1,null===d){var i=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);d=i?parseInt(i[1]):0}if(null===f){var s=navigator.userAgent.match(/Safari\/(\d+)/i);f=s?parseInt(s[1]):0}p=!!d&&d<75||!!f&&f<600}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){l.logger.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=t},e.resetNextTimestamp=function(){l.logger.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},e.resetInitSegment=function(){l.logger.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},e.getVideoStartPts=function(t){var e=!1,n=t.reduce((function(t,n){var r=n.pts-t;return r<-4294967296?(e=!0,g(t,n.pts)):r>0?t:n.pts}),t[0].pts);return e&&l.logger.debug("PTS rollover detected"),n},e.remux=function(t,e,n,r,i,s,o,a){var h,u,d,f,p,m,v=i,y=i,b=t.pid>-1,x=e.pid>-1,w=e.samples.length,E=t.samples.length>0,_=w>1;if((!b||E)&&(!x||_)||this.ISGenerated||o){this.ISGenerated||(d=this.generateIS(t,e,i));var S=this.isVideoContiguous,T=-1;if(_&&(T=function(t){for(var e=0;e<t.length;e++)if(t[e].key)return e;return-1}(e.samples),!S&&this.config.forceKeyFrameOnDiscontinuity))if(m=!0,T>0){l.logger.warn("[mp4-remuxer]: Dropped "+T+" out of "+w+" video samples due to a missing keyframe");var k=this.getVideoStartPts(e.samples);e.samples=e.samples.slice(T),e.dropped+=T,y+=(e.samples[0].pts-k)/(e.timescale||9e4)}else-1===T&&(l.logger.warn("[mp4-remuxer]: No keyframe found out of "+w+" video samples"),m=!1);if(this.ISGenerated){if(E&&_){var A=this.getVideoStartPts(e.samples),C=(g(t.samples[0].pts,A)-A)/e.inputTimeScale;v+=Math.max(0,C),y+=Math.max(0,-C)}if(E){if(t.samplerate||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),d=this.generateIS(t,e,i)),u=this.remuxAudio(t,v,this.isAudioContiguous,s,x||_||a===c.PlaylistLevelType.AUDIO?y:void 0),_){var R=u?u.endPTS-u.startPTS:0;e.inputTimeScale||(l.logger.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),d=this.generateIS(t,e,i)),h=this.remuxVideo(e,y,S,R)}}else _&&(h=this.remuxVideo(e,y,S,0));h&&(h.firstKeyFrame=T,h.independent=-1!==T)}}return this.ISGenerated&&(n.samples.length&&(p=this.remuxID3(n,i)),r.samples.length&&(f=this.remuxText(r,i))),{audio:u,video:h,initSegment:d,independent:m,text:f,id3:p}},e.generateIS=function(t,e,n){var i,o,a,l=t.samples,c=e.samples,h=this.typeSupported,u={},d=!Object(r.isFiniteNumber)(this._initPTS),f="audio/mp4";if(d&&(i=o=1/0),t.config&&l.length&&(t.timescale=t.samplerate,t.isAAC||(h.mpeg?(f="audio/mpeg",t.codec=""):h.mp3&&(t.codec="mp3")),u.audio={id:"audio",container:f,codec:t.codec,initSegment:!t.isAAC&&h.mpeg?new Uint8Array(0):s.default.initSegment([t]),metadata:{channelCount:t.channelCount}},d&&(a=t.inputTimeScale,i=o=l[0].pts-Math.round(a*n))),e.sps&&e.pps&&c.length&&(e.timescale=e.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:e.codec,initSegment:s.default.initSegment([e]),metadata:{width:e.width,height:e.height}},d)){a=e.inputTimeScale;var p=this.getVideoStartPts(c),m=Math.round(a*n);o=Math.min(o,g(c[0].dts,p)-m),i=Math.min(i,p-m)}if(Object.keys(u).length)return this.ISGenerated=!0,d&&(this._initPTS=i,this._initDTS=o),{tracks:u,initPTS:i,timescale:a}},e.remuxVideo=function(t,e,n,r){var i,c,f,m=t.inputTimeScale,y=t.samples,b=[],x=y.length,w=this._initPTS,E=this.nextAvcDts,_=8,S=Number.POSITIVE_INFINITY,T=Number.NEGATIVE_INFINITY,k=0,A=!1;n&&null!==E||(E=e*m-(y[0].pts-g(y[0].dts,y[0].pts)));for(var C=0;C<x;C++){var R=y[C];R.pts=g(R.pts-w,E),R.dts=g(R.dts-w,E),R.dts>R.pts&&(k=Math.max(Math.min(k,R.pts-R.dts),-18e3)),R.dts<y[C>0?C-1:C].dts&&(A=!0)}A&&y.sort((function(t,e){var n=t.dts-e.dts,r=t.pts-e.pts;return n||r})),c=y[0].dts,f=y[y.length-1].dts;var M=Math.round((f-c)/(x-1));if(k<0){if(k<-2*M){l.logger.warn("PTS < DTS detected in video samples, offsetting DTS from PTS by "+Object(h.toMsFromMpegTsClock)(-M,!0)+" ms");for(var I=k,D=0;D<x;D++)y[D].dts=I=Math.max(I,y[D].pts-M),y[D].pts=Math.max(I,y[D].pts)}else{l.logger.warn("PTS < DTS detected in video samples, shifting DTS by "+Object(h.toMsFromMpegTsClock)(k,!0)+" ms to overcome this issue");for(var O=0;O<x;O++)y[O].dts=y[O].dts+k}c=y[0].dts}if(n){var P=c-E,L=P>M;if(L||P<-1){L?l.logger.warn("AVC: "+Object(h.toMsFromMpegTsClock)(P,!0)+" ms ("+P+"dts) hole between fragments detected, filling it"):l.logger.warn("AVC: "+Object(h.toMsFromMpegTsClock)(-P,!0)+" ms ("+P+"dts) overlapping between fragments detected"),c=E;var F=y[0].pts-P;y[0].dts=c,y[0].pts=F,l.logger.log("Video: First PTS/DTS adjusted: "+Object(h.toMsFromMpegTsClock)(F,!0)+"/"+Object(h.toMsFromMpegTsClock)(c,!0)+", delta: "+Object(h.toMsFromMpegTsClock)(P,!0)+" ms")}}p&&(c=Math.max(0,c));for(var N=0,B=0,U=0;U<x;U++){for(var V=y[U],j=V.units,z=j.length,G=0,W=0;W<z;W++)G+=j[W].data.length;B+=G,N+=z,V.length=G,V.dts=Math.max(V.dts,c),V.pts=Math.max(V.pts,V.dts,0),S=Math.min(V.pts,S),T=Math.max(V.pts,T)}f=y[x-1].dts;var H,$=B+4*N+8;try{H=new Uint8Array($)}catch(ht){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:$,reason:"fail allocating video mdat "+$})}var Y=new DataView(H.buffer);Y.setUint32(0,$),H.set(s.default.types.mdat,4);for(var X=0;X<x;X++){for(var q=y[X],K=q.units,Z=0,J=0,Q=K.length;J<Q;J++){var tt=K[J],et=tt.data,nt=tt.data.byteLength;Y.setUint32(_,nt),_+=4,H.set(et,_),_+=nt,Z+=4+nt}if(X<x-1)i=y[X+1].dts-q.dts;else{var rt=this.config,it=q.dts-y[X>0?X-1:X].dts;if(rt.stretchShortVideoTrack&&null!==this.nextAudioPts){var st=Math.floor(rt.maxBufferHole*m),ot=(r?S+r*m:this.nextAudioPts)-q.pts;ot>st?((i=ot-it)<0&&(i=it),l.logger.log("[mp4-remuxer]: It is approximately "+ot/90+" ms to the next segment; using duration "+i/90+" ms for the last video frame.")):i=it}else i=it}var at=Math.round(q.pts-q.dts);b.push(new v(q.key,i,Z,at))}if(b.length&&d&&d<70){var lt=b[0].flags;lt.dependsOn=2,lt.isNonSync=0}this.nextAvcDts=E=f+i,this.isVideoContiguous=!0;var ct={data1:s.default.moof(t.sequenceNumber++,c,u({},t,{samples:b})),data2:H,startPTS:S/m,endPTS:(T+i)/m,startDTS:c/m,endDTS:E/m,type:"video",hasAudio:!1,hasVideo:!0,nb:b.length,dropped:t.dropped};return t.samples=[],t.dropped=0,ct},e.remuxAudio=function(t,e,n,r,c){var h=t.inputTimeScale,d=h/(t.samplerate?t.samplerate:h),f=t.isAAC?1024:1152,p=f*d,m=this._initPTS,y=!t.isAAC&&this.typeSupported.mpeg,b=[],x=t.samples,w=y?0:8,E=this.nextAudioPts||-1,_=e*h;if(this.isAudioContiguous=n=n||x.length&&E>0&&(r&&Math.abs(_-E)<9e3||Math.abs(g(x[0].pts-m,_)-E)<20*p),x.forEach((function(t){t.pts=g(t.pts-m,_)})),!n||E<0){if(!(x=x.filter((function(t){return t.pts>=0}))).length)return;E=0===c?0:r?Math.max(0,_):x[0].pts}if(t.isAAC)for(var S=void 0!==c,T=this.config.maxAudioFramesDrift,k=0,A=E;k<x.length;k++){var C=x[k],R=C.pts,M=R-A,I=Math.abs(1e3*M/h);if(M<=-T*p&&S)0===k&&(l.logger.warn("Audio frame @ "+(R/h).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*M/h)+" ms."),this.nextAudioPts=E=A=R);else if(M>=T*p&&I<1e4&&S){var D=Math.round(M/p);(A=R-D*p)<0&&(D--,A+=p),0===k&&(this.nextAudioPts=E=A),l.logger.warn("[mp4-remuxer]: Injecting "+D+" audio frame @ "+(A/h).toFixed(3)+"s due to "+Math.round(1e3*M/h)+" ms gap.");for(var O=0;O<D;O++){var P=Math.max(A,0),L=i.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);L||(l.logger.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),L=C.unit.subarray()),x.splice(k,0,{unit:L,pts:P}),A+=p,k++}}C.pts=A,A+=p}for(var F,N=null,B=null,U=0,V=x.length;V--;)U+=x[V].unit.byteLength;for(var j=0,z=x.length;j<z;j++){var G=x[j],W=G.unit,H=G.pts;if(null!==B)b[j-1].duration=Math.round((H-B)/d);else{if(n&&t.isAAC&&(H=E),N=H,!(U>0))return;U+=w;try{F=new Uint8Array(U)}catch(Q){return void this.observer.emit(o.Events.ERROR,o.Events.ERROR,{type:a.ErrorTypes.MUX_ERROR,details:a.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:U,reason:"fail allocating audio mdat "+U})}y||(new DataView(F.buffer).setUint32(0,U),F.set(s.default.types.mdat,4))}F.set(W,w);var $=W.byteLength;w+=$,b.push(new v(!0,f,$,0)),B=H}var Y=b.length;if(Y){var X=b[b.length-1];this.nextAudioPts=E=B+d*X.duration;var q=y?new Uint8Array(0):s.default.moof(t.sequenceNumber++,N/d,u({},t,{samples:b}));t.samples=[];var K=N/h,Z=E/h,J={data1:q,data2:F,startPTS:K,endPTS:Z,startDTS:K,endDTS:Z,type:"audio",hasAudio:!0,hasVideo:!1,nb:Y};return this.isAudioContiguous=!0,J}},e.remuxEmptyAudio=function(t,e,n,r){var s=t.inputTimeScale,o=s/(t.samplerate?t.samplerate:s),a=this.nextAudioPts,c=(null!==a?a:r.startDTS*s)+this._initDTS,h=r.endDTS*s+this._initDTS,u=1024*o,d=Math.ceil((h-c)/u),f=i.default.getSilentFrame(t.manifestCodec||t.codec,t.channelCount);if(l.logger.warn("[mp4-remuxer]: remux empty Audio"),f){for(var p=[],m=0;m<d;m++){var g=c+m*u;p.push({unit:f,pts:g,dts:g})}return t.samples=p,this.remuxAudio(t,e,n,!1)}l.logger.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e.remuxID3=function(t,e){var n=t.samples.length;if(n){for(var r=t.inputTimeScale,i=this._initPTS,s=this._initDTS,o=0;o<n;o++){var a=t.samples[o];a.pts=g(a.pts-i,e*r)/r,a.dts=g(a.dts-s,e*r)/r}var l=t.samples;return t.samples=[],{samples:l}}},e.remuxText=function(t,e){var n=t.samples.length;if(n){for(var r=t.inputTimeScale,i=this._initPTS,s=0;s<n;s++){var o=t.samples[s];o.pts=g(o.pts-i,e*r)/r}t.samples.sort((function(t,e){return t.pts-e.pts}));var a=t.samples;return t.samples=[],{samples:a}}},t}();function g(t,e){var n;if(null===e)return t;for(n=e<t?-8589934592:8589934592;Math.abs(t-e)>4294967296;)t+=n;return t}var v=function(t,e,n,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=e,this.size=n,this.cts=r,this.flags=new y(t)},y=function(t){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=t?2:1,this.isNonSync=t?0:1}},"./src/remux/passthrough-remuxer.ts":function(t,e,n){n.r(e);var r=n("./src/polyfills/number.ts"),i=n("./src/utils/mp4-tools.ts"),s=n("./src/loader/fragment.ts"),o=n("./src/utils/logger.ts"),a=function(){function t(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=void 0,this.initTracks=void 0,this.lastEndDTS=null}var e=t.prototype;return e.destroy=function(){},e.resetTimeStamp=function(t){this.initPTS=t,this.lastEndDTS=null},e.resetNextTimestamp=function(){this.lastEndDTS=null},e.resetInitSegment=function(t,e,n){this.audioCodec=e,this.videoCodec=n,this.generateInitSegment(t),this.emitInitSegment=!0},e.generateInitSegment=function(t){var e=this.audioCodec,n=this.videoCodec;if(!t||!t.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var r=this.initData=Object(i.parseInitSegment)(t);e||(e=c(r.audio,s.ElementaryStreamTypes.AUDIO)),n||(n=c(r.video,s.ElementaryStreamTypes.VIDEO));var a={};r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:e+","+n,initSegment:t,id:"main"}:r.audio?a.audio={container:"audio/mp4",codec:e,initSegment:t,id:"audio"}:r.video?a.video={container:"video/mp4",codec:n,initSegment:t,id:"main"}:o.logger.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=a},e.remux=function(t,e,n,s,a){var c=this.initPTS,h=this.lastEndDTS,u={audio:void 0,video:void 0,text:s,id3:n,initSegment:void 0};Object(r.isFiniteNumber)(h)||(h=this.lastEndDTS=a||0);var d=e.samples;if(!d||!d.length)return u;var f={initPTS:void 0,timescale:1},p=this.initData;if(p&&p.length||(this.generateInitSegment(d),p=this.initData),!p||!p.length)return o.logger.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),u;this.emitInitSegment&&(f.tracks=this.initTracks,this.emitInitSegment=!1),Object(r.isFiniteNumber)(c)||(this.initPTS=f.initPTS=c=l(p,d,h));var m=Object(i.getDuration)(d,p),g=h,v=m+g;Object(i.offsetStartDTS)(p,d,c),m>0?this.lastEndDTS=v:(o.logger.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var y=!!p.audio,b=!!p.video,x="";y&&(x+="audio"),b&&(x+="video");var w={data1:d,startPTS:g,startDTS:g,endPTS:v,endDTS:v,type:x,hasAudio:y,hasVideo:b,nb:1,dropped:0};return u.audio="audio"===w.type?w:void 0,u.video="audio"!==w.type?w:void 0,u.text=s,u.id3=n,u.initSegment=f,u},t}(),l=function(t,e,n){return Object(i.getStartDTS)(t,e)-n};function c(t,e){var n=null==t?void 0:t.codec;return n&&n.length>4?n:"hvc1"===n?"hvc1.1.c.L120.90":"av01"===n?"av01.0.04M.08":"avc1"===n||e===s.ElementaryStreamTypes.VIDEO?"avc1.42e01e":"mp4a.40.5"}e.default=a},"./src/task-loop.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var e=t.prototype;return e.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},e.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},e.onHandlerDestroyed=function(){},e.hasInterval=function(){return!!this._tickInterval},e.hasNextTick=function(){return!!this._tickTimer},e.setInterval=function(t){return!this._tickInterval&&(this._tickInterval=self.setInterval(this._boundTick,t),!0)},e.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},e.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},e.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},e.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},e.doTick=function(){},t}()},"./src/types/level.ts":function(t,e,n){var r,i;function s(t,e){var n=t.canSkipUntil,i=t.canSkipDateRanges,s=t.endSN;return n&&(void 0!==e?e-s:0)<n?i?r.v2:r.Yes:r.No}n.r(e),n.d(e,"HlsSkip",(function(){return r})),n.d(e,"getSkipValue",(function(){return s})),n.d(e,"HlsUrlParameters",(function(){return o})),n.d(e,"Level",(function(){return a})),(i=r||(r={})).No="",i.Yes="YES",i.v2="v2";var o=function(){function t(t,e,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=t,this.part=e,this.skip=n}return t.prototype.addDirectives=function(t){var e=new self.URL(t);return void 0!==this.msn&&e.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&e.searchParams.set("_HLS_part",this.part.toString()),this.skip&&e.searchParams.set("_HLS_skip",this.skip),e.toString()},t}(),a=function(){function t(t){this.attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[t.url],this.attrs=t.attrs,this.bitrate=t.bitrate,t.details&&(this.details=t.details),this.id=t.id||0,this.name=t.name,this.width=t.width||0,this.height=t.height||0,this.audioCodec=t.audioCodec,this.videoCodec=t.videoCodec,this.unknownCodecs=t.unknownCodecs,this.codecSet=[t.videoCodec,t.audioCodec].filter((function(t){return t})).join(",").replace(/\.[^.,]+/g,"")}var e;return(e=[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(t){var e=t%this.url.length;this._urlId!==e&&(this.details=void 0,this._urlId=e)}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(t.prototype,e),t}()},"./src/types/loader.ts":function(t,e,n){var r,i,s,o;n.r(e),n.d(e,"PlaylistContextType",(function(){return r})),n.d(e,"PlaylistLevelType",(function(){return s})),(i=r||(r={})).MANIFEST="manifest",i.LEVEL="level",i.AUDIO_TRACK="audioTrack",i.SUBTITLE_TRACK="subtitleTrack",(o=s||(s={})).MAIN="main",o.AUDIO="audio",o.SUBTITLE="subtitle"},"./src/types/transmuxer.ts":function(t,e,n){n.r(e),n.d(e,"ChunkMetadata",(function(){return r}));var r=function(t,e,n,r,i,s){void 0===r&&(r=0),void 0===i&&(i=-1),void 0===s&&(s=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing={start:0,executeStart:0,executeEnd:0,end:0},this.buffering={audio:{start:0,executeStart:0,executeEnd:0,end:0},video:{start:0,executeStart:0,executeEnd:0,end:0},audiovideo:{start:0,executeStart:0,executeEnd:0,end:0}},this.level=t,this.sn=e,this.id=n,this.size=r,this.part=i,this.partial=s}},"./src/utils/attr-list.ts":function(t,e,n){n.r(e),n.d(e,"AttrList",(function(){return s}));var r=/^(\d+)x(\d+)$/,i=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,s=function(){function t(e){for(var n in"string"==typeof e&&(e=t.parseAttrList(e)),e)e.hasOwnProperty(n)&&(this[n]=e[n])}var e=t.prototype;return e.decimalInteger=function(t){var e=parseInt(this[t],10);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.hexadecimalInteger=function(t){if(this[t]){var e=(this[t]||"0x").slice(2);e=(1&e.length?"0":"")+e;for(var n=new Uint8Array(e.length/2),r=0;r<e.length/2;r++)n[r]=parseInt(e.slice(2*r,2*r+2),16);return n}return null},e.hexadecimalIntegerAsNumber=function(t){var e=parseInt(this[t],16);return e>Number.MAX_SAFE_INTEGER?1/0:e},e.decimalFloatingPoint=function(t){return parseFloat(this[t])},e.optionalFloat=function(t,e){var n=this[t];return n?parseFloat(n):e},e.enumeratedString=function(t){return this[t]},e.bool=function(t){return"YES"===this[t]},e.decimalResolution=function(t){var e=r.exec(this[t]);if(null!==e)return{width:parseInt(e[1],10),height:parseInt(e[2],10)}},t.parseAttrList=function(t){var e,n={};for(i.lastIndex=0;null!==(e=i.exec(t));){var r=e[2];0===r.indexOf('"')&&r.lastIndexOf('"')===r.length-1&&(r=r.slice(1,-1)),n[e[1]]=r}return n},t}()},"./src/utils/binary-search.ts":function(t,e,n){n.r(e),e.default={search:function(t,e){for(var n=0,r=t.length-1,i=null,s=null;n<=r;){var o=e(s=t[i=(n+r)/2|0]);if(o>0)n=i+1;else{if(!(o<0))return s;r=i-1}}return null}}},"./src/utils/buffer-helper.ts":function(t,e,n){n.r(e),n.d(e,"BufferHelper",(function(){return s}));var r=n("./src/utils/logger.ts"),i={length:0,start:function(){return 0},end:function(){return 0}},s=function(){function t(){}return t.isBuffered=function(e,n){try{if(e)for(var r=t.getBuffered(e),i=0;i<r.length;i++)if(n>=r.start(i)&&n<=r.end(i))return!0}catch(s){}return!1},t.bufferInfo=function(e,n,r){try{if(e){var i,s=t.getBuffered(e),o=[];for(i=0;i<s.length;i++)o.push({start:s.start(i),end:s.end(i)});return this.bufferedInfo(o,n,r)}}catch(a){}return{len:0,start:n,end:n,nextStart:void 0}},t.bufferedInfo=function(t,e,n){e=Math.max(0,e),t.sort((function(t,e){return t.start-e.start||e.end-t.end}));var r=[];if(n)for(var i=0;i<t.length;i++){var s=r.length;if(s){var o=r[s-1].end;t[i].start-o<n?t[i].end>o&&(r[s-1].end=t[i].end):r.push(t[i])}else r.push(t[i])}else r=t;for(var a,l=0,c=e,h=e,u=0;u<r.length;u++){var d=r[u].start,f=r[u].end;if(e+n>=d&&e<f)c=d,l=(h=f)-e;else if(e+n<d){a=d;break}}return{len:l,start:c||0,end:h||0,nextStart:a}},t.getBuffered=function(t){try{return t.buffered}catch(e){return r.logger.log("failed to get media.buffered",e),i}},t}()},"./src/utils/cea-608-parser.ts":function(t,e,n){n.r(e),n.d(e,"Row",(function(){return b})),n.d(e,"CaptionScreen",(function(){return x}));var r,i,s=n("./src/utils/logger.ts"),o={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},a=function(t){var e=t;return o.hasOwnProperty(t)&&(e=o[t]),String.fromCharCode(e)},l=15,c=100,h={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},u={17:2,18:4,21:6,22:8,23:10,19:13,20:15},d={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},f={25:2,26:4,29:6,30:8,31:10,27:13,28:15},p=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];(i=r||(r={}))[i.ERROR=0]="ERROR",i[i.TEXT=1]="TEXT",i[i.WARNING=2]="WARNING",i[i.INFO=2]="INFO",i[i.DEBUG=3]="DEBUG",i[i.DATA=3]="DATA";var m=function(){function t(){this.time=null,this.verboseLevel=r.ERROR}return t.prototype.log=function(t,e){this.verboseLevel>=t&&s.logger.log(this.time+" ["+t+"] "+e)},t}(),g=function(t){for(var e=[],n=0;n<t.length;n++)e.push(t[n].toString(16));return e},v=function(){function t(t,e,n,r,i){this.foreground=void 0,this.underline=void 0,this.italics=void 0,this.background=void 0,this.flash=void 0,this.foreground=t||"white",this.underline=e||!1,this.italics=n||!1,this.background=r||"black",this.flash=i||!1}var e=t.prototype;return e.reset=function(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1},e.setStyles=function(t){for(var e=["foreground","underline","italics","background","flash"],n=0;n<e.length;n++){var r=e[n];t.hasOwnProperty(r)&&(this[r]=t[r])}},e.isDefault=function(){return"white"===this.foreground&&!this.underline&&!this.italics&&"black"===this.background&&!this.flash},e.equals=function(t){return this.foreground===t.foreground&&this.underline===t.underline&&this.italics===t.italics&&this.background===t.background&&this.flash===t.flash},e.copy=function(t){this.foreground=t.foreground,this.underline=t.underline,this.italics=t.italics,this.background=t.background,this.flash=t.flash},e.toString=function(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash},t}(),y=function(){function t(t,e,n,r,i,s){this.uchar=void 0,this.penState=void 0,this.uchar=t||" ",this.penState=new v(e,n,r,i,s)}var e=t.prototype;return e.reset=function(){this.uchar=" ",this.penState.reset()},e.setChar=function(t,e){this.uchar=t,this.penState.copy(e)},e.setPenState=function(t){this.penState.copy(t)},e.equals=function(t){return this.uchar===t.uchar&&this.penState.equals(t.penState)},e.copy=function(t){this.uchar=t.uchar,this.penState.copy(t.penState)},e.isEmpty=function(){return" "===this.uchar&&this.penState.isDefault()},t}(),b=function(){function t(t){this.chars=void 0,this.pos=void 0,this.currPenState=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chars=[];for(var e=0;e<c;e++)this.chars.push(new y);this.logger=t,this.pos=0,this.currPenState=new v}var e=t.prototype;return e.equals=function(t){for(var e=!0,n=0;n<c;n++)if(!this.chars[n].equals(t.chars[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<c;e++)this.chars[e].copy(t.chars[e])},e.isEmpty=function(){for(var t=!0,e=0;e<c;e++)if(!this.chars[e].isEmpty()){t=!1;break}return t},e.setCursor=function(t){this.pos!==t&&(this.pos=t),this.pos<0?(this.logger.log(r.DEBUG,"Negative cursor position "+this.pos),this.pos=0):this.pos>c&&(this.logger.log(r.DEBUG,"Too large cursor position "+this.pos),this.pos=c)},e.moveCursor=function(t){var e=this.pos+t;if(t>1)for(var n=this.pos+1;n<e+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(e)},e.backSpace=function(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)},e.insertChar=function(t){t>=144&&this.backSpace();var e=a(t);this.pos>=c?this.logger.log(r.ERROR,"Cannot insert "+t.toString(16)+" ("+e+") at position "+this.pos+". Skipping it!"):(this.chars[this.pos].setChar(e,this.currPenState),this.moveCursor(1))},e.clearFromPos=function(t){var e;for(e=t;e<c;e++)this.chars[e].reset()},e.clear=function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()},e.clearToEndOfRow=function(){this.clearFromPos(this.pos)},e.getTextString=function(){for(var t=[],e=!0,n=0;n<c;n++){var r=this.chars[n].uchar;" "!==r&&(e=!1),t.push(r)}return e?"":t.join("")},e.setPenStyles=function(t){this.currPenState.setStyles(t),this.chars[this.pos].setPenState(this.currPenState)},t}(),x=function(){function t(t){this.rows=void 0,this.currRow=void 0,this.nrRollUpRows=void 0,this.lastOutputScreen=void 0,this.logger=void 0,this.rows=[];for(var e=0;e<l;e++)this.rows.push(new b(t));this.logger=t,this.currRow=14,this.nrRollUpRows=null,this.lastOutputScreen=null,this.reset()}var e=t.prototype;return e.reset=function(){for(var t=0;t<l;t++)this.rows[t].clear();this.currRow=14},e.equals=function(t){for(var e=!0,n=0;n<l;n++)if(!this.rows[n].equals(t.rows[n])){e=!1;break}return e},e.copy=function(t){for(var e=0;e<l;e++)this.rows[e].copy(t.rows[e])},e.isEmpty=function(){for(var t=!0,e=0;e<l;e++)if(!this.rows[e].isEmpty()){t=!1;break}return t},e.backSpace=function(){this.rows[this.currRow].backSpace()},e.clearToEndOfRow=function(){this.rows[this.currRow].clearToEndOfRow()},e.insertChar=function(t){this.rows[this.currRow].insertChar(t)},e.setPen=function(t){this.rows[this.currRow].setPenStyles(t)},e.moveCursor=function(t){this.rows[this.currRow].moveCursor(t)},e.setCursor=function(t){this.logger.log(r.INFO,"setCursor: "+t),this.rows[this.currRow].setCursor(t)},e.setPAC=function(t){this.logger.log(r.INFO,"pacData = "+JSON.stringify(t));var e=t.row-1;if(this.nrRollUpRows&&e<this.nrRollUpRows-1&&(e=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==e){for(var n=0;n<l;n++)this.rows[n].clear();var i=this.currRow+1-this.nrRollUpRows,s=this.lastOutputScreen;if(s){var o=s.rows[i].cueStartTime,a=this.logger.time;if(o&&null!==a&&o<a)for(var c=0;c<this.nrRollUpRows;c++)this.rows[e-this.nrRollUpRows+c+1].copy(s.rows[i+c])}}this.currRow=e;var h=this.rows[this.currRow];if(null!==t.indent){var u=t.indent,d=Math.max(u-1,0);h.setCursor(t.indent),t.color=h.chars[d].penState.foreground}var f={foreground:t.color,underline:t.underline,italics:t.italics,background:"black",flash:!1};this.setPen(f)},e.setBkgData=function(t){this.logger.log(r.INFO,"bkgData = "+JSON.stringify(t)),this.backSpace(),this.setPen(t),this.insertChar(32)},e.setRollUpRows=function(t){this.nrRollUpRows=t},e.rollUp=function(){if(null!==this.nrRollUpRows){this.logger.log(r.TEXT,this.getDisplayText());var t=this.currRow+1-this.nrRollUpRows,e=this.rows.splice(t,1)[0];e.clear(),this.rows.splice(this.currRow,0,e),this.logger.log(r.INFO,"Rolling up")}else this.logger.log(r.DEBUG,"roll_up but nrRollUpRows not set yet")},e.getDisplayText=function(t){t=t||!1;for(var e=[],n="",r=-1,i=0;i<l;i++){var s=this.rows[i].getTextString();s&&(r=i+1,t?e.push("Row "+r+": '"+s+"'"):e.push(s.trim()))}return e.length>0&&(n=t?"["+e.join(" | ")+"]":e.join("\n")),n},e.getTextAndFormat=function(){return this.rows},t}(),w=function(){function t(t,e,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=t,this.outputFilter=e,this.mode=null,this.verbose=0,this.displayedMemory=new x(n),this.nonDisplayedMemory=new x(n),this.lastOutputScreen=new x(n),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}var e=t.prototype;return e.reset=function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[14],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null},e.getHandler=function(){return this.outputFilter},e.setHandler=function(t){this.outputFilter=t},e.setPAC=function(t){this.writeScreen.setPAC(t)},e.setBkgData=function(t){this.writeScreen.setBkgData(t)},e.setMode=function(t){t!==this.mode&&(this.mode=t,this.logger.log(r.INFO,"MODE="+t),"MODE_POP-ON"===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),"MODE_ROLL-UP"!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=t)},e.insertChars=function(t){for(var e=0;e<t.length;e++)this.writeScreen.insertChar(t[e]);var n=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(r.INFO,n+": "+this.writeScreen.getDisplayText(!0)),"MODE_PAINT-ON"!==this.mode&&"MODE_ROLL-UP"!==this.mode||(this.logger.log(r.TEXT,"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())},e.ccRCL=function(){this.logger.log(r.INFO,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")},e.ccBS=function(){this.logger.log(r.INFO,"BS - BackSpace"),"MODE_TEXT"!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())},e.ccAOF=function(){},e.ccAON=function(){},e.ccDER=function(){this.logger.log(r.INFO,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()},e.ccRU=function(t){this.logger.log(r.INFO,"RU("+t+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(t)},e.ccFON=function(){this.logger.log(r.INFO,"FON - Flash On"),this.writeScreen.setPen({flash:!0})},e.ccRDC=function(){this.logger.log(r.INFO,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")},e.ccTR=function(){this.logger.log(r.INFO,"TR"),this.setMode("MODE_TEXT")},e.ccRTD=function(){this.logger.log(r.INFO,"RTD"),this.setMode("MODE_TEXT")},e.ccEDM=function(){this.logger.log(r.INFO,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)},e.ccCR=function(){this.logger.log(r.INFO,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)},e.ccENM=function(){this.logger.log(r.INFO,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()},e.ccEOC=function(){if(this.logger.log(r.INFO,"EOC - End Of Caption"),"MODE_POP-ON"===this.mode){var t=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=t,this.writeScreen=this.nonDisplayedMemory,this.logger.log(r.TEXT,"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)},e.ccTO=function(t){this.logger.log(r.INFO,"TO("+t+") - Tab Offset"),this.writeScreen.moveCursor(t)},e.ccMIDROW=function(t){var e={flash:!1};if(e.underline=t%2==1,e.italics=t>=46,e.italics)e.foreground="white";else{var n=Math.floor(t/2)-16;e.foreground=["white","green","blue","cyan","red","yellow","magenta"][n]}this.logger.log(r.INFO,"MIDROW: "+JSON.stringify(e)),this.writeScreen.setPen(e)},e.outputDataUpdate=function(t){void 0===t&&(t=!1);var e=this.logger.time;null!==e&&this.outputFilter&&(null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),t&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))},e.cueSplitAtTime=function(t){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,t,this.displayedMemory),this.cueStartTime=t))},t}(),E=function(){function t(t,e,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=void 0,this.logger=void 0;var r=new m;this.channels=[null,new w(t,e,r),new w(t+1,n,r)],this.cmdHistory={a:null,b:null},this.logger=r}var e=t.prototype;return e.getHandler=function(t){return this.channels[t].getHandler()},e.setHandler=function(t,e){this.channels[t].setHandler(e)},e.addData=function(t,e){var n,i,s,o=!1;this.logger.time=t;for(var a=0;a<e.length;a+=2)if(i=127&e[a],s=127&e[a+1],0!==i||0!==s){if(this.logger.log(r.DATA,"["+g([e[a],e[a+1]])+"] -> ("+g([i,s])+")"),(n=this.parseCmd(i,s))||(n=this.parseMidrow(i,s)),n||(n=this.parsePAC(i,s)),n||(n=this.parseBackgroundAttributes(i,s)),!n&&(o=this.parseChars(i,s))){var l=this.currentChannel;l&&l>0?this.channels[l].insertChars(o):this.logger.log(r.WARNING,"No channel found yet. TEXT-MODE?")}n||o||this.logger.log(r.WARNING,"Couldn't parse cleaned data "+g([i,s])+" orig: "+g([e[a],e[a+1]]))}},e.parseCmd=function(t,e){var n=this.cmdHistory;if(!((20===t||28===t||21===t||29===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=33&&e<=35))return!1;if(S(t,e,n))return _(null,null,n),this.logger.log(r.DEBUG,"Repeated command ("+g([t,e])+") is dropped"),!0;var i=20===t||21===t||23===t?1:2,s=this.channels[i];return 20===t||21===t||28===t||29===t?32===e?s.ccRCL():33===e?s.ccBS():34===e?s.ccAOF():35===e?s.ccAON():36===e?s.ccDER():37===e?s.ccRU(2):38===e?s.ccRU(3):39===e?s.ccRU(4):40===e?s.ccFON():41===e?s.ccRDC():42===e?s.ccTR():43===e?s.ccRTD():44===e?s.ccEDM():45===e?s.ccCR():46===e?s.ccENM():47===e&&s.ccEOC():s.ccTO(e-32),_(t,e,n),this.currentChannel=i,!0},e.parseMidrow=function(t,e){var n=0;if((17===t||25===t)&&e>=32&&e<=47){if((n=17===t?1:2)!==this.currentChannel)return this.logger.log(r.ERROR,"Mismatch channel in midrow parsing"),!1;var i=this.channels[n];return!!i&&(i.ccMIDROW(e),this.logger.log(r.DEBUG,"MIDROW ("+g([t,e])+")"),!0)}return!1},e.parsePAC=function(t,e){var n,r=this.cmdHistory;if(!((t>=17&&t<=23||t>=25&&t<=31)&&e>=64&&e<=127||(16===t||24===t)&&e>=64&&e<=95))return!1;if(S(t,e,r))return _(null,null,r),!0;var i=t<=23?1:2;n=e>=64&&e<=95?1===i?h[t]:d[t]:1===i?u[t]:f[t];var s=this.channels[i];return!!s&&(s.setPAC(this.interpretPAC(n,e)),_(t,e,r),this.currentChannel=i,!0)},e.interpretPAC=function(t,e){var n,r={color:null,italics:!1,indent:null,underline:!1,row:t};return n=e>95?e-96:e-64,r.underline=1==(1&n),n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=4*Math.floor((n-16)/2),r},e.parseChars=function(t,e){var n,i,s=null,o=null;if(t>=25?(n=2,o=t-8):(n=1,o=t),o>=17&&o<=19?(i=17===o?e+80:18===o?e+112:e+144,this.logger.log(r.INFO,"Special char '"+a(i)+"' in channel "+n),s=[i]):t>=32&&t<=127&&(s=0===e?[t]:[t,e]),s){var l=g(s);this.logger.log(r.DEBUG,"Char codes =  "+l.join(",")),_(t,e,this.cmdHistory)}return s},e.parseBackgroundAttributes=function(t,e){var n;if(!((16===t||24===t)&&e>=32&&e<=47||(23===t||31===t)&&e>=45&&e<=47))return!1;var r={};16===t||24===t?(n=Math.floor((e-32)/2),r.background=p[n],e%2==1&&(r.background=r.background+"_semi")):45===e?r.background="transparent":(r.foreground="black",47===e&&(r.underline=!0));var i=t<=23?1:2;return this.channels[i].setBkgData(r),_(t,e,this.cmdHistory),!0},e.reset=function(){for(var t=0;t<Object.keys(this.channels).length;t++){var e=this.channels[t];e&&e.reset()}this.cmdHistory={a:null,b:null}},e.cueSplitAtTime=function(t){for(var e=0;e<this.channels.length;e++){var n=this.channels[e];n&&n.cueSplitAtTime(t)}},t}();function _(t,e,n){n.a=t,n.b=e}function S(t,e,n){return n.a===t&&n.b===e}e.default=E},"./src/utils/codecs.ts":function(t,e,n){n.r(e),n.d(e,"isCodecType",(function(){return i})),n.d(e,"isCodecSupportedInMp4",(function(){return s}));var r={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dvav:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}};function i(t,e){var n=r[e];return!!n&&!0===n[t.slice(0,4)]}function s(t,e){return MediaSource.isTypeSupported((e||"video")+'/mp4;codecs="'+t+'"')}},"./src/utils/cues.ts":function(t,e,n){n.r(e);var r=n("./src/utils/vttparser.ts"),i=n("./src/utils/webvtt-parser.ts"),s=n("./src/utils/texttrack-utils.ts"),o=/\s/,a={newCue:function(t,e,n,a){for(var l,c,h,u,d,f=[],p=self.VTTCue||self.TextTrackCue,m=0;m<a.rows.length;m++)if(h=!0,u=0,d="",!(l=a.rows[m]).isEmpty()){for(var g=0;g<l.chars.length;g++)o.test(l.chars[g].uchar)&&h?u++:(d+=l.chars[g].uchar,h=!1);l.cueStartTime=e,e===n&&(n+=1e-4),u>=16?u--:u++;var v=Object(r.fixLineBreaks)(d.trim()),y=Object(i.generateCueId)(e,n,v);t&&t.cues&&t.cues.getCueById(y)||((c=new p(e,n,v)).id=y,c.line=m+1,c.align="left",c.position=10+Math.min(80,10*Math.floor(8*u/32)),f.push(c))}return t&&f.length&&(f.sort((function(t,e){return"auto"===t.line||"auto"===e.line?0:t.line>8&&e.line>8?e.line-t.line:t.line-e.line})),f.forEach((function(e){return Object(s.addCueToTrack)(t,e)}))),f}};e.default=a},"./src/utils/discontinuities.ts":function(t,e,n){n.r(e),n.d(e,"findFirstFragWithCC",(function(){return o})),n.d(e,"shouldAlignOnDiscontinuities",(function(){return a})),n.d(e,"findDiscontinuousReferenceFrag",(function(){return l})),n.d(e,"adjustSlidingStart",(function(){return h})),n.d(e,"alignStream",(function(){return u})),n.d(e,"alignPDT",(function(){return d}));var r=n("./src/polyfills/number.ts"),i=n("./src/utils/logger.ts"),s=n("./src/controller/level-helper.ts");function o(t,e){for(var n=null,r=0,i=t.length;r<i;r++){var s=t[r];if(s&&s.cc===e){n=s;break}}return n}function a(t,e,n){return!(!e.details||!(n.endCC>n.startCC||t&&t.cc<n.startCC))}function l(t,e){var n=t.fragments,r=e.fragments;if(r.length&&n.length){var s=o(n,r[0].cc);if(s&&(!s||s.startPTS))return s;i.logger.log("No frag in previous level to align on")}else i.logger.log("No fragments to align")}function c(t,e){if(t){var n=t.start+e;t.start=t.startPTS=n,t.endPTS=n+t.duration}}function h(t,e){for(var n=e.fragments,r=0,i=n.length;r<i;r++)c(n[r],t);e.fragmentHint&&c(e.fragmentHint,t),e.alignedSliding=!0}function u(t,e,n){e&&(function(t,e,n){if(a(t,n,e)){var s=l(n.details,e);s&&Object(r.isFiniteNumber)(s.start)&&(i.logger.log("Adjusting PTS using last level due to CC increase within current level "+e.url),h(s.start,e))}}(t,n,e),!n.alignedSliding&&e.details&&d(n,e.details),n.alignedSliding||!e.details||n.skippedSegments||Object(s.adjustSliding)(e.details,n))}function d(t,e){if(e.fragments.length&&t.hasProgramDateTime&&e.hasProgramDateTime){var n=e.fragments[0].programDateTime,s=t.fragments[0].programDateTime,o=(s-n)/1e3+e.fragments[0].start;o&&Object(r.isFiniteNumber)(o)&&(i.logger.log("Adjusting PTS using programDateTime delta "+(s-n)+"ms, sliding:"+o.toFixed(3)+" "+t.url+" "),h(o,t))}}},"./src/utils/ewma-bandwidth-estimator.ts":function(t,e,n){n.r(e);var r=n("./src/utils/ewma.ts"),i=function(){function t(t,e,n){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new r.default(t),this.fast_=new r.default(e)}var e=t.prototype;return e.update=function(t,e){var n=this.slow_,i=this.fast_;this.slow_.halfLife!==t&&(this.slow_=new r.default(t,n.getEstimate(),n.getTotalWeight())),this.fast_.halfLife!==e&&(this.fast_=new r.default(e,i.getEstimate(),i.getTotalWeight()))},e.sample=function(t,e){var n=(t=Math.max(t,this.minDelayMs_))/1e3,r=8*e/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},e.canEstimate=function(){var t=this.fast_;return t&&t.getTotalWeight()>=this.minWeight_},e.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},e.destroy=function(){},t}();e.default=i},"./src/utils/ewma.ts":function(t,e,n){n.r(e);var r=function(){function t(t,e,n){void 0===e&&(e=0),void 0===n&&(n=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=t,this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=e,this.totalWeight_=n}var e=t.prototype;return e.sample=function(t,e){var n=Math.pow(this.alpha_,t);this.estimate_=e*(1-n)+n*this.estimate_,this.totalWeight_+=t},e.getTotalWeight=function(){return this.totalWeight_},e.getEstimate=function(){if(this.alpha_){var t=1-Math.pow(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},t}();e.default=r},"./src/utils/fetch-loader.ts":function(t,e,n){n.r(e),n.d(e,"fetchSupported",(function(){return h}));var r=n("./src/polyfills/number.ts"),i=n("./src/loader/load-stats.ts"),s=n("./src/demux/chunk-cache.ts");function o(t){var e="function"==typeof Map?new Map:void 0;return(o=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,r)}function r(){return a(t,arguments,c(this).constructor)}return r.prototype=Object.create(t.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),l(r,t)})(t)}function a(t,e,n){return(a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=new(Function.bind.apply(t,r));return n&&l(i,n.prototype),i}).apply(null,arguments)}function l(t,e){return(l=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function h(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}var u=function(){function t(t){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=t.fetchSetup||d,this.controller=new self.AbortController,this.stats=new i.LoadStats}var e=t.prototype;return e.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},e.abortInternal=function(){var t=this.response;t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},e.load=function(t,e,n){var i=this,s=this.stats;if(s.loading.start)throw new Error("Loader can only be used once.");s.loading.start=self.performance.now();var o,a,l,c=(o=t,a=this.controller.signal,l={method:"GET",mode:"cors",credentials:"same-origin",signal:a},o.rangeEnd&&(l.headers=new self.Headers({Range:"bytes="+o.rangeStart+"-"+String(o.rangeEnd-1)})),l),h=n.onProgress,u="arraybuffer"===t.responseType,d=u?"byteLength":"length";this.context=t,this.config=e,this.callbacks=n,this.request=this.fetchSetup(t,c),self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout((function(){i.abortInternal(),n.onTimeout(s,t,i.response)}),e.timeout),self.fetch(this.request).then((function(n){if(i.response=i.loader=n,!n.ok){var o=n.status,a=n.statusText;throw new f(a||"fetch, bad network response",o,n)}return s.loading.first=Math.max(self.performance.now(),s.loading.start),s.total=parseInt(n.headers.get("Content-Length")||"0"),h&&Object(r.isFiniteNumber)(e.highWaterMark)?i.loadProgressively(n,s,t,e.highWaterMark,h):u?n.arrayBuffer():n.text()})).then((function(o){var a=i.response;self.clearTimeout(i.requestTimeout),s.loading.end=Math.max(self.performance.now(),s.loading.first),s.loaded=s.total=o[d];var l={url:a.url,data:o};h&&!Object(r.isFiniteNumber)(e.highWaterMark)&&h(s,t,o,a),n.onSuccess(l,s,t,a)})).catch((function(e){if(self.clearTimeout(i.requestTimeout),!s.aborted){var r=e.code||0;n.onError({code:r,text:e.message},t,e.details)}}))},e.getCacheAge=function(){var t=null;if(this.response){var e=this.response.headers.get("age");t=e?parseFloat(e):null}return t},e.loadProgressively=function(t,e,n,r,i){void 0===r&&(r=0);var o=new s.default,a=t.body.getReader();return function s(){return a.read().then((function(a){if(a.done)return o.dataLength&&i(e,n,o.flush(),t),Promise.resolve(new ArrayBuffer(0));var l=a.value,c=l.length;return e.loaded+=c,c<r||o.dataLength?(o.push(l),o.dataLength>=r&&i(e,n,o.flush(),t)):i(e,n,l,t),s()})).catch((function(){return Promise.reject()}))}()},t}();function d(t,e){return new self.Request(t.url,e)}var f=function(t){var e,n;function r(e,n,r){var i;return(i=t.call(this,e)||this).code=void 0,i.details=void 0,i.code=n,i.details=r,i}return n=t,(e=r).prototype=Object.create(n.prototype),e.prototype.constructor=e,l(e,n),r}(o(Error));e.default=u},"./src/utils/imsc1-ttml-parser.ts":function(t,e,n){n.r(e),n.d(e,"IMSC1_CODEC",(function(){return h})),n.d(e,"parseIMSC1",(function(){return p}));var r=n("./src/utils/mp4-tools.ts"),i=n("./src/utils/vttparser.ts"),s=n("./src/utils/vttcue.ts"),o=n("./src/demux/id3.ts"),a=n("./src/utils/timescale-conversion.ts"),l=n("./src/utils/webvtt-parser.ts");function c(){return(c=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var h="stpp.ttml.im1t",u=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,d=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,f={left:"start",center:"center",right:"end",start:"start",end:"end"};function p(t,e,n,i,h){var u=Object(r.findBox)(new Uint8Array(t),["mdat"]);if(0!==u.length){var d=u[0],p=Object(o.utf8ArrayToStr)(new Uint8Array(t,d.start,d.end-d.start)),w=Object(a.toTimescaleFromScale)(e,1,n);try{i(function(t,e){var n=(new DOMParser).parseFromString(t,"text/xml").getElementsByTagName("tt")[0];if(!n)throw new Error("Invalid ttml");var r={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},i=Object.keys(r).reduce((function(t,e){return t[e]=n.getAttribute("ttp:"+e)||r[e],t}),{}),o="preserve"!==n.getAttribute("xml:space"),a=g(m(n,"styling","style")),h=g(m(n,"layout","region")),u=m(n,"body","[begin]");return[].map.call(u,(function(t){var n=v(t,o);if(!n||!t.hasAttribute("begin"))return null;var r=x(t.getAttribute("begin"),i),u=x(t.getAttribute("dur"),i),d=x(t.getAttribute("end"),i);if(null===r)throw b(t);if(null===d){if(null===u)throw b(t);d=r+u}var p=new s.default(r-e,d-e,n);p.id=Object(l.generateCueId)(p.startTime,p.endTime,p.text);var m=h[t.getAttribute("region")],g=a[t.getAttribute("style")];p.position=10,p.size=80;var w,E,_,S=(w=m,E=g,_="http://www.w3.org/ns/ttml#styling",["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"].reduce((function(t,e){var n=y(E,_,e)||y(w,_,e);return n&&(t[e]=n),t}),{})),T=S.textAlign;if(T){var k=f[T];k&&(p.lineAlign=k),p.align=T}return c(p,S),p})).filter((function(t){return null!==t}))}(p,w))}catch(E){h(E)}}else h(new Error("Could not parse IMSC1 mdat"))}function m(t,e,n){var r=t.getElementsByTagName(e)[0];return r?[].slice.call(r.querySelectorAll(n)):[]}function g(t){return t.reduce((function(t,e){var n=e.getAttribute("xml:id");return n&&(t[n]=e),t}),{})}function v(t,e){return[].slice.call(t.childNodes).reduce((function(t,n,r){var i;return"br"===n.nodeName&&r?t+"\n":null!==(i=n.childNodes)&&void 0!==i&&i.length?v(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent}),"")}function y(t,e,n){return t.hasAttributeNS(e,n)?t.getAttributeNS(e,n):null}function b(t){return new Error("Could not parse ttml timestamp "+t)}function x(t,e){if(!t)return null;var n,r,s,o,a=Object(i.parseTimeStamp)(t);return null===a&&(u.test(t)?(n=t,r=e,s=u.exec(n),o=(0|s[4])+(0|s[5])/r.subFrameRate,a=3600*(0|s[1])+60*(0|s[2])+(0|s[3])+o/r.frameRate):d.test(t)&&(a=function(t,e){var n=d.exec(t),r=Number(n[1]);switch(n[2]){case"h":return 3600*r;case"m":return 60*r;case"ms":return 1e3*r;case"f":return r/e.frameRate;case"t":return r/e.tickRate}return r}(t,e))),a}},"./src/utils/logger.ts":function(t,e,n){n.r(e),n.d(e,"enableLogs",(function(){return o})),n.d(e,"logger",(function(){return a}));var r=function(){},i={trace:r,debug:r,log:r,warn:r,info:r,error:r},s=i;function o(t){if(self.console&&!0===t||"object"==typeof t){!function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];n.forEach((function(e){s[e]=t[e]?t[e].bind(t):function(t){var e=self.console[t];return e?e.bind(self.console,"["+t+"] >"):r}(e)}))}(t,"debug","log","info","warn","error");try{s.log()}catch(e){s=i}}else s=i}var a=i},"./src/utils/mediakeys-helper.ts":function(t,e,n){var r,i;n.r(e),n.d(e,"KeySystems",(function(){return r})),n.d(e,"requestMediaKeySystemAccess",(function(){return s})),(i=r||(r={})).WIDEVINE="com.widevine.alpha",i.PLAYREADY="com.microsoft.playready";var s="undefined"!=typeof self&&self.navigator&&self.navigator.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null},"./src/utils/mediasource-helper.ts":function(t,e,n){function r(){return self.MediaSource||self.WebKitMediaSource}n.r(e),n.d(e,"getMediaSource",(function(){return r}))},"./src/utils/mp4-tools.ts":function(t,e,n){n.r(e),n.d(e,"bin2str",(function(){return a})),n.d(e,"readUint16",(function(){return l})),n.d(e,"readUint32",(function(){return c})),n.d(e,"writeUint32",(function(){return h})),n.d(e,"findBox",(function(){return u})),n.d(e,"parseSegmentIndex",(function(){return d})),n.d(e,"parseInitSegment",(function(){return f})),n.d(e,"getStartDTS",(function(){return p})),n.d(e,"getDuration",(function(){return m})),n.d(e,"computeRawDurationFromSamples",(function(){return g})),n.d(e,"offsetStartDTS",(function(){return v})),n.d(e,"segmentValidRange",(function(){return y})),n.d(e,"appendUint8Array",(function(){return b}));var r=n("./src/utils/typed-array.ts"),i=n("./src/loader/fragment.ts"),s=Math.pow(2,32)-1,o=[].push;function a(t){return String.fromCharCode.apply(null,t)}function l(t,e){"data"in t&&(e+=t.start,t=t.data);var n=t[e]<<8|t[e+1];return n<0?65536+n:n}function c(t,e){"data"in t&&(e+=t.start,t=t.data);var n=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3];return n<0?4294967296+n:n}function h(t,e,n){"data"in t&&(e+=t.start,t=t.data),t[e]=n>>24,t[e+1]=n>>16&255,t[e+2]=n>>8&255,t[e+3]=255&n}function u(t,e){var n,r,i,s=[];if(!e.length)return s;"data"in t?(n=t.data,r=t.start,i=t.end):(r=0,i=(n=t).byteLength);for(var l=r;l<i;){var h=c(n,l),d=h>1?l+h:i;if(a(n.subarray(l+4,l+8))===e[0])if(1===e.length)s.push({data:n,start:l+8,end:d});else{var f=u({data:n,start:l+8,end:d},e.slice(1));f.length&&o.apply(s,f)}l=d}return s}function d(t){var e=u(t,["moov"])[0],n=e?e.end:null,r=u(t,["sidx"]);if(!r||!r[0])return null;var i=[],s=r[0],o=s.data[0],a=0===o?8:16,h=c(s,a);a+=4,a+=0===o?8:16,a+=2;var d=s.end+0,f=l(s,a);a+=2;for(var p=0;p<f;p++){var m=a,g=c(s,m),v=2147483647&g;if(1==(2147483648&g)>>>31)return null;var y=c(s,m+=4);m+=4,i.push({referenceSize:v,subsegmentDuration:y,info:{duration:y/h,start:d,end:d+v-1}}),d+=v,a=m+=4}return{earliestPresentationTime:0,timescale:h,version:o,referencesCount:f,references:i,moovEndOffset:n}}function f(t){for(var e=[],n=u(t,["moov","trak"]),r=0;r<n.length;r++){var s=n[r],o=u(s,["tkhd"])[0];if(o){var l=o.data[o.start],h=0===l?12:20,d=c(o,h),f=u(s,["mdia","mdhd"])[0];if(f){var p=c(f,h=0===(l=f.data[f.start])?12:20),m=u(s,["mdia","hdlr"])[0];if(m){var g=a(m.data.subarray(m.start+8,m.start+12)),v={soun:i.ElementaryStreamTypes.AUDIO,vide:i.ElementaryStreamTypes.VIDEO}[g];if(v){var y=u(s,["mdia","minf","stbl","stsd"])[0],b=void 0;y&&(b=a(y.data.subarray(y.start+12,y.start+16))),e[d]={timescale:p,type:v},e[v]={timescale:p,id:d,codec:b}}}}}}return u(t,["moov","mvex","trex"]).forEach((function(t){var n=c(t,4),r=e[n];r&&(r.default={duration:c(t,12),flags:c(t,20)})})),e}function p(t,e){return u(e,["moof","traf"]).reduce((function(e,n){var r=u(n,["tfdt"])[0],i=r.data[r.start],s=u(n,["tfhd"]).reduce((function(e,n){var s=c(n,4),o=t[s];if(o){var a=c(r,4);1===i&&(a*=Math.pow(2,32),a+=c(r,8));var l=a/(o.timescale||9e4);if(isFinite(l)&&(null===e||l<e))return l}return e}),null);return null!==s&&isFinite(s)&&(null===e||s<e)?s:e}),null)||0}function m(t,e){for(var n=0,r=0,s=0,o=u(t,["moof","traf"]),a=0;a<o.length;a++){var l=o[a],h=u(l,["tfhd"])[0],f=e[c(h,4)];if(f){var p=f.default,m=c(h,0)|(null==p?void 0:p.flags),v=null==p?void 0:p.duration;8&m&&(v=c(h,2&m?12:8));for(var y=f.timescale||9e4,b=u(l,["trun"]),x=0;x<b.length;x++)n=v?v*c(b[x],4):g(b[x]),f.type===i.ElementaryStreamTypes.VIDEO?r+=n/y:f.type===i.ElementaryStreamTypes.AUDIO&&(s+=n/y)}}if(0===r&&0===s){var w=d(t);if(null!=w&&w.references)return w.references.reduce((function(t,e){return t+e.info.duration||0}),0)}return r||s}function g(t){var e=c(t,0),n=8;1&e&&(n+=4),4&e&&(n+=4);for(var r=0,i=c(t,4),s=0;s<i;s++)256&e&&(r+=c(t,n),n+=4),512&e&&(n+=4),1024&e&&(n+=4),2048&e&&(n+=4);return r}function v(t,e,n){u(e,["moof","traf"]).forEach((function(e){u(e,["tfhd"]).forEach((function(r){var i=c(r,4),o=t[i];if(o){var a=o.timescale||9e4;u(e,["tfdt"]).forEach((function(t){var e=t.data[t.start],r=c(t,4);if(0===e)h(t,4,r-n*a);else{r*=Math.pow(2,32),r+=c(t,8),r-=n*a,r=Math.max(r,0);var i=Math.floor(r/(s+1)),o=Math.floor(r%(s+1));h(t,4,i),h(t,8,o)}}))}}))}))}function y(t){var e={valid:null,remainder:null},n=u(t,["moof"]);if(!n)return e;if(n.length<2)return e.remainder=t,e;var i=n[n.length-1];return e.valid=Object(r.sliceUint8)(t,0,i.start-8),e.remainder=Object(r.sliceUint8)(t,i.start-8),e}function b(t,e){var n=new Uint8Array(t.length+e.length);return n.set(t),n.set(e,t.length),n}},"./src/utils/output-filter.ts":function(t,e,n){n.r(e),n.d(e,"default",(function(){return r}));var r=function(){function t(t,e){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=t,this.trackName=e}var e=t.prototype;return e.dispatchCue=function(){null!==this.startTime&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)},e.newCue=function(t,e,n){(null===this.startTime||this.startTime>t)&&(this.startTime=t),this.endTime=e,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)},e.reset=function(){this.cueRanges=[]},t}()},"./src/utils/texttrack-utils.ts":function(t,e,n){n.r(e),n.d(e,"sendAddTrackEvent",(function(){return i})),n.d(e,"addCueToTrack",(function(){return s})),n.d(e,"clearCurrentCues",(function(){return o})),n.d(e,"removeCuesInRange",(function(){return a})),n.d(e,"getCuesInRange",(function(){return l}));var r=n("./src/utils/logger.ts");function i(t,e){var n;try{n=new Event("addtrack")}catch(r){(n=document.createEvent("Event")).initEvent("addtrack",!1,!1)}n.track=t,e.dispatchEvent(n)}function s(t,e){var n=t.mode;if("disabled"===n&&(t.mode="hidden"),t.cues&&!t.cues.getCueById(e.id))try{if(t.addCue(e),!t.cues.getCueById(e.id))throw new Error("addCue is failed for: "+e)}catch(s){r.logger.debug("[texttrack-utils]: "+s);var i=new self.TextTrackCue(e.startTime,e.endTime,e.text);i.id=e.id,t.addCue(i)}"disabled"===n&&(t.mode=n)}function o(t){var e=t.mode;if("disabled"===e&&(t.mode="hidden"),t.cues)for(var n=t.cues.length;n--;)t.removeCue(t.cues[n]);"disabled"===e&&(t.mode=e)}function a(t,e,n){var r=t.mode;if("disabled"===r&&(t.mode="hidden"),t.cues&&t.cues.length>0)for(var i=l(t.cues,e,n),s=0;s<i.length;s++)t.removeCue(i[s]);"disabled"===r&&(t.mode=r)}function l(t,e,n){var r=[],i=function(t,e){if(e<t[0].startTime)return 0;var n=t.length-1;if(e>t[n].endTime)return-1;for(var r=0,i=n;r<=i;){var s=Math.floor((i+r)/2);if(e<t[s].startTime)i=s-1;else{if(!(e>t[s].startTime&&r<n))return s;r=s+1}}return t[r].startTime-e<e-t[i].startTime?r:i}(t,e);if(i>-1)for(var s=i,o=t.length;s<o;s++){var a=t[s];if(a.startTime>=e&&a.endTime<=n)r.push(a);else if(a.startTime>n)return r}return r}},"./src/utils/time-ranges.ts":function(t,e,n){n.r(e),e.default={toString:function(t){for(var e="",n=t.length,r=0;r<n;r++)e+="["+t.start(r).toFixed(3)+","+t.end(r).toFixed(3)+"]";return e}}},"./src/utils/timescale-conversion.ts":function(t,e,n){function r(t,e,n,r){void 0===n&&(n=1),void 0===r&&(r=!1);var i=t*e*n;return r?Math.round(i):i}function i(t,e,n,i){return void 0===n&&(n=1),void 0===i&&(i=!1),r(t,e,1/n,i)}function s(t,e){return void 0===e&&(e=!1),r(t,1e3,1/9e4,e)}function o(t,e){return void 0===e&&(e=1),r(t,9e4,1/e)}n.r(e),n.d(e,"toTimescaleFromBase",(function(){return r})),n.d(e,"toTimescaleFromScale",(function(){return i})),n.d(e,"toMsFromMpegTsClock",(function(){return s})),n.d(e,"toMpegTsClockFromTimescale",(function(){return o}))},"./src/utils/typed-array.ts":function(t,e,n){function r(t,e,n){return Uint8Array.prototype.slice?t.slice(e,n):new Uint8Array(Array.prototype.slice.call(t,e,n))}n.r(e),n.d(e,"sliceUint8",(function(){return r}))},"./src/utils/vttcue.ts":function(t,e,n){n.r(e),e.default=function(){if("undefined"!=typeof self&&self.VTTCue)return self.VTTCue;var t=["","lr","rl"],e=["start","middle","end","left","right"];function n(t,e){if("string"!=typeof e)return!1;if(!Array.isArray(t))return!1;var n=e.toLowerCase();return!!~t.indexOf(n)&&n}function r(t){return n(e,t)}function i(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=1;i<arguments.length;i++){var s=arguments[i];for(var o in s)t[o]=s[o]}return t}function s(e,s,o){var a=this,l={enumerable:!0};a.hasBeenReset=!1;var c="",h=!1,u=e,d=s,f=o,p=null,m="",g=!0,v="auto",y="start",b=50,x="middle",w=50,E="middle";Object.defineProperty(a,"id",i({},l,{get:function(){return c},set:function(t){c=""+t}})),Object.defineProperty(a,"pauseOnExit",i({},l,{get:function(){return h},set:function(t){h=!!t}})),Object.defineProperty(a,"startTime",i({},l,{get:function(){return u},set:function(t){if("number"!=typeof t)throw new TypeError("Start time must be set to a number.");u=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"endTime",i({},l,{get:function(){return d},set:function(t){if("number"!=typeof t)throw new TypeError("End time must be set to a number.");d=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"text",i({},l,{get:function(){return f},set:function(t){f=""+t,this.hasBeenReset=!0}})),Object.defineProperty(a,"region",i({},l,{get:function(){return p},set:function(t){p=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"vertical",i({},l,{get:function(){return m},set:function(e){var r=n(t,e);if(!1===r)throw new SyntaxError("An invalid or illegal string was specified.");m=r,this.hasBeenReset=!0}})),Object.defineProperty(a,"snapToLines",i({},l,{get:function(){return g},set:function(t){g=!!t,this.hasBeenReset=!0}})),Object.defineProperty(a,"line",i({},l,{get:function(){return v},set:function(t){if("number"!=typeof t&&"auto"!==t)throw new SyntaxError("An invalid number or illegal string was specified.");v=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"lineAlign",i({},l,{get:function(){return y},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");y=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"position",i({},l,{get:function(){return b},set:function(t){if(t<0||t>100)throw new Error("Position must be between 0 and 100.");b=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"positionAlign",i({},l,{get:function(){return x},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");x=e,this.hasBeenReset=!0}})),Object.defineProperty(a,"size",i({},l,{get:function(){return w},set:function(t){if(t<0||t>100)throw new Error("Size must be between 0 and 100.");w=t,this.hasBeenReset=!0}})),Object.defineProperty(a,"align",i({},l,{get:function(){return E},set:function(t){var e=r(t);if(!e)throw new SyntaxError("An invalid or illegal string was specified.");E=e,this.hasBeenReset=!0}})),a.displayState=void 0}return s.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},s}()},"./src/utils/vttparser.ts":function(t,e,n){n.r(e),n.d(e,"parseTimeStamp",(function(){return s})),n.d(e,"fixLineBreaks",(function(){return u})),n.d(e,"VTTParser",(function(){return d}));var r=n("./src/utils/vttcue.ts"),i=function(){function t(){}return t.prototype.decode=function(t,e){if(!t)return"";if("string"!=typeof t)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(t))},t}();function s(t){function e(t,e,n,r){return 3600*(0|t)+60*(0|e)+(0|n)+parseFloat(r||0)}var n=t.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return n?parseFloat(n[2])>59?e(n[2],n[3],0,n[4]):e(n[1],n[2],n[3],n[4]):null}var o=function(){function t(){this.values=Object.create(null)}var e=t.prototype;return e.set=function(t,e){this.get(t)||""===e||(this.values[t]=e)},e.get=function(t,e,n){return n?this.has(t)?this.values[t]:e[n]:this.has(t)?this.values[t]:e},e.has=function(t){return t in this.values},e.alt=function(t,e,n){for(var r=0;r<n.length;++r)if(e===n[r]){this.set(t,e);break}},e.integer=function(t,e){/^-?\d+$/.test(e)&&this.set(t,parseInt(e,10))},e.percent=function(t,e){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(e)){var n=parseFloat(e);if(n>=0&&n<=100)return this.set(t,n),!0}return!1},t}();function a(t,e,n,r){var i=r?t.split(r):[t];for(var s in i)if("string"==typeof i[s]){var o=i[s].split(n);2===o.length&&e(o[0],o[1])}}var l=new r.default(0,0,""),c="middle"===l.align?"middle":"center";function h(t,e,n){var r=t;function i(){var e=s(t);if(null===e)throw new Error("Malformed timestamp: "+r);return t=t.replace(/^[^\sa-zA-Z-]+/,""),e}function h(){t=t.replace(/^\s+/,"")}if(h(),e.startTime=i(),h(),"--\x3e"!==t.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);t=t.substr(3),h(),e.endTime=i(),h(),function(t,e){var r=new o;a(t,(function(t,e){var i;switch(t){case"region":for(var s=n.length-1;s>=0;s--)if(n[s].id===e){r.set(t,n[s].region);break}break;case"vertical":r.alt(t,e,["rl","lr"]);break;case"line":i=e.split(","),r.integer(t,i[0]),r.percent(t,i[0])&&r.set("snapToLines",!1),r.alt(t,i[0],["auto"]),2===i.length&&r.alt("lineAlign",i[1],["start",c,"end"]);break;case"position":i=e.split(","),r.percent(t,i[0]),2===i.length&&r.alt("positionAlign",i[1],["start",c,"end","line-left","line-right","auto"]);break;case"size":r.percent(t,e);break;case"align":r.alt(t,e,["start",c,"end","left","right"])}}),/:/,/\s/),e.region=r.get("region",null),e.vertical=r.get("vertical","");var i=r.get("line","auto");"auto"===i&&-1===l.line&&(i=-1),e.line=i,e.lineAlign=r.get("lineAlign","start"),e.snapToLines=r.get("snapToLines",!0),e.size=r.get("size",100),e.align=r.get("align",c);var s=r.get("position","auto");"auto"===s&&50===l.position&&(s="start"===e.align||"left"===e.align?0:"end"===e.align||"right"===e.align?100:50),e.position=s}(t,e)}function u(t){return t.replace(/<br(?: \/)?>/gi,"\n")}var d=function(){function t(){this.state="INITIAL",this.buffer="",this.decoder=new i,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}var e=t.prototype;return e.parse=function(t){var e=this;function n(){var t=e.buffer,n=0;for(t=u(t);n<t.length&&"\r"!==t[n]&&"\n"!==t[n];)++n;var r=t.substr(0,n);return"\r"===t[n]&&++n,"\n"===t[n]&&++n,e.buffer=t.substr(n),r}t&&(e.buffer+=e.decoder.decode(t,{stream:!0}));try{var i="";if("INITIAL"===e.state){if(!/\r\n|\n/.test(e.buffer))return this;var s=(i=n()).match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new Error("Malformed WebVTT signature.");e.state="HEADER"}for(var o=!1;e.buffer;){if(!/\r\n|\n/.test(e.buffer))return this;switch(o?o=!1:i=n(),e.state){case"HEADER":/:/.test(i)?a(i,(function(t,e){}),/:/):i||(e.state="ID");continue;case"NOTE":i||(e.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){e.state="NOTE";break}if(!i)continue;if(e.cue=new r.default(0,0,""),e.state="CUE",-1===i.indexOf("--\x3e")){e.cue.id=i;continue}case"CUE":if(!e.cue){e.state="BADCUE";continue}try{h(i,e.cue,e.regionList)}catch(c){e.cue=null,e.state="BADCUE";continue}e.state="CUETEXT";continue;case"CUETEXT":var l=-1!==i.indexOf("--\x3e");if(!i||l&&(o=!0)){e.oncue&&e.cue&&e.oncue(e.cue),e.cue=null,e.state="ID";continue}if(null===e.cue)continue;e.cue.text&&(e.cue.text+="\n"),e.cue.text+=i;continue;case"BADCUE":i||(e.state="ID")}}}catch(c){"CUETEXT"===e.state&&e.cue&&e.oncue&&e.oncue(e.cue),e.cue=null,e.state="INITIAL"===e.state?"BADWEBVTT":"BADCUE"}return this},e.flush=function(){var t=this;try{if((t.cue||"HEADER"===t.state)&&(t.buffer+="\n\n",t.parse()),"INITIAL"===t.state||"BADWEBVTT"===t.state)throw new Error("Malformed WebVTT signature.")}catch(e){t.onparsingerror&&t.onparsingerror(e)}return t.onflush&&t.onflush(),this},t}()},"./src/utils/webvtt-parser.ts":function(t,e,n){n.r(e),n.d(e,"generateCueId",(function(){return u})),n.d(e,"parseWebVTT",(function(){return d}));var r=n("./src/polyfills/number.ts"),i=n("./src/utils/vttparser.ts"),s=n("./src/demux/id3.ts"),o=n("./src/utils/timescale-conversion.ts"),a=n("./src/remux/mp4-remuxer.ts"),l=/\r\n|\n\r|\n|\r/g,c=function(t,e,n){return void 0===n&&(n=0),t.substr(n,e.length)===e},h=function(t){for(var e=5381,n=t.length;n;)e=33*e^t.charCodeAt(--n);return(e>>>0).toString()};function u(t,e,n){return h(t.toString())+h(e.toString())+h(n)}function d(t,e,n,h,d,f,p,m){var g,v=new i.VTTParser,y=Object(s.utf8ArrayToStr)(new Uint8Array(t)).trim().replace(l,"\n").split("\n"),b=[],x=Object(o.toMpegTsClockFromTimescale)(e,n),w="00:00.000",E=0,_=0,S=!0,T=!1;v.oncue=function(t){var e=h[d],n=h.ccOffset,r=(E-x)/9e4;if(null!=e&&e.new&&(void 0!==_?n=h.ccOffset=e.start:function(t,e,n){var r=t[e],i=t[r.prevCC];if(!i||!i.new&&r.new)return t.ccOffset=t.presentationOffset=r.start,void(r.new=!1);for(;null!==(s=i)&&void 0!==s&&s.new;){var s;t.ccOffset+=r.start-i.start,r.new=!1,i=t[(r=i).prevCC]}t.presentationOffset=n}(h,d,r)),r&&(n=r-h.presentationOffset),T){var i=t.endTime-t.startTime,s=Object(a.normalizePts)(9e4*(t.startTime+n-_),9e4*f)/9e4;t.startTime=s,t.endTime=s+i}var o=t.text.trim();t.text=decodeURIComponent(encodeURIComponent(o)),t.id||(t.id=u(t.startTime,t.endTime,o)),t.endTime>0&&b.push(t)},v.onparsingerror=function(t){g=t},v.onflush=function(){g?m(g):p(b)},y.forEach((function(t){if(S){if(c(t,"X-TIMESTAMP-MAP=")){S=!1,T=!0,t.substr(16).split(",").forEach((function(t){c(t,"LOCAL:")?w=t.substr(6):c(t,"MPEGTS:")&&(E=parseInt(t.substr(7)))}));try{_=function(t){var e=parseInt(t.substr(-3)),n=parseInt(t.substr(-6,2)),i=parseInt(t.substr(-9,2)),s=t.length>9?parseInt(t.substr(0,t.indexOf(":"))):0;if(!(Object(r.isFiniteNumber)(e)&&Object(r.isFiniteNumber)(n)&&Object(r.isFiniteNumber)(i)&&Object(r.isFiniteNumber)(s)))throw Error("Malformed X-TIMESTAMP-MAP: Local:"+t);return e+=1e3*n,(e+=6e4*i)+36e5*s}(w)/1e3}catch(e){T=!1,g=e}return}""===t&&(S=!1)}v.parse(t+"\n")})),v.flush()}},"./src/utils/xhr-loader.ts":function(t,e,n){n.r(e);var r=n("./src/utils/logger.ts"),i=n("./src/loader/load-stats.ts"),s=/^age:\s*[\d.]+\s*$/m,o=function(){function t(t){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=t?t.xhrSetup:null,this.stats=new i.LoadStats,this.retryDelay=0}var e=t.prototype;return e.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},e.abortInternal=function(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},e.abort=function(){var t;this.abortInternal(),null!==(t=this.callbacks)&&void 0!==t&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},e.load=function(t,e,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=t,this.config=e,this.callbacks=n,this.retryDelay=e.retryDelay,this.loadInternal()},e.loadInternal=function(){var t=this.config,e=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(n,e.url)}catch(s){n.open("GET",e.url,!0),i(n,e.url)}n.readyState||n.open("GET",e.url,!0)}catch(s){return void this.callbacks.onError({code:n.status,text:s.message},e,n)}e.rangeEnd&&n.setRequestHeader("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1)),n.onreadystatechange=this.readystatechange.bind(this),n.onprogress=this.loadprogress.bind(this),n.responseType=e.responseType,self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),t.timeout),n.send()}},e.readystatechange=function(){var t=this.context,e=this.loader,n=this.stats;if(t&&e){var i=e.readyState,s=this.config;if(!n.aborted&&i>=2)if(self.clearTimeout(this.requestTimeout),0===n.loading.first&&(n.loading.first=Math.max(self.performance.now(),n.loading.start)),4===i){e.onreadystatechange=null,e.onprogress=null;var o=e.status;if(o>=200&&o<300){var a,l;if(n.loading.end=Math.max(self.performance.now(),n.loading.first),l="arraybuffer"===t.responseType?(a=e.response).byteLength:(a=e.responseText).length,n.loaded=n.total=l,!this.callbacks)return;var c=this.callbacks.onProgress;if(c&&c(n,t,a,e),!this.callbacks)return;var h={url:e.responseURL,data:a};this.callbacks.onSuccess(h,n,t,e)}else n.retry>=s.maxRetry||o>=400&&o<499?(r.logger.error(o+" while loading "+t.url),this.callbacks.onError({code:o,text:e.statusText},t,e)):(r.logger.warn(o+" while loading "+t.url+", retrying in "+this.retryDelay+"..."),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),n.retry++)}else self.clearTimeout(this.requestTimeout),this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),s.timeout)}},e.loadtimeout=function(){r.logger.warn("timeout while loading "+this.context.url);var t=this.callbacks;t&&(this.abortInternal(),t.onTimeout(this.stats,this.context,this.loader))},e.loadprogress=function(t){var e=this.stats;e.loaded=t.loaded,t.lengthComputable&&(e.total=t.total)},e.getCacheAge=function(){var t=null;if(this.loader&&s.test(this.loader.getAllResponseHeaders())){var e=this.loader.getResponseHeader("age");t=e?parseFloat(e):null}return t},t}();e.default=o}}).default);var J4=function(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}(Z4.exports);const Q4=Object.assign({name:"d-icon"},{props:{icon:String,size:[Number,String]},setup:function(t){const e=t,n=u((()=>({fontSize:/^\d+$/.test(e.size)?e.size+"px":e.size})));return(e,r)=>(D(),O("i",{class:P(["d-icon iconfont",t.icon]),style:L(s(n))},null,6))}});Q4.__scopeId="data-v-0c690e66",F("data-v-4cb76d59");const t6={class:"d-player-top"},e6={class:"top-title"},n6={class:"top-title"};N();const r6={props:{title:{default:""}},setup(t){Date.prototype.format=function(t){let e={"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds()};for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t};let e=o("00:00:00");e.value=(new Date).format("hh:mm:ss");let n=null;return n=setInterval((()=>{e.value=(new Date).format("hh:mm:ss")}),1e3),T((()=>{clearInterval(n)})),(n,r)=>(D(),O("div",t6,[U("p",e6,z(t.title||""),1),U("p",n6,z(s(e)),1)]))},__scopeId:"data-v-4cb76d59"};F("data-v-ac2469ec");const i6={class:"d-status"},s6={class:"d-flex-center"},o6={class:"d-flex-center"},a6=B("5X速播放中 ");N();var l6=E({props:["state"],setup:t=>(e,n)=>V((D(),O("div",i6,[V(U("li",s6,[C(Q4,{size:"18",class:"d-status-icon",icon:"icon-volume-"+(0==t.state.volume?"mute":t.state.volume>.5?"up":"down")},null,8,["icon"]),B(" "+z(~~(100*t.state.volume))+"% ",1)],512),[[j,"volume"==t.state.handleType]]),V(U("li",o6,[C(Q4,{size:"12",icon:"icon-play"}),C(Q4,{size:"12",icon:"icon-play",style:{"margin-right":"5px"}}),a6],512),[[j,"playbackRate"==t.state.handleType||t.state.isMultiplesPlay]])],512)),[[j,t.state.handleType||t.state.isMultiplesPlay]])});l6.__scopeId="data-v-ac2469ec",F("data-v-385f7870");const c6=["checked","true-value","false-value"],h6=U("span",{class:"d-switch_action"},null,-1);N();var u6=E({props:{modelValue:{type:[Number,String,Boolean]},width:{type:String,default:"40px"},trueValue:{type:[Number,String,Boolean],default:!0},falseValue:{type:[Number,String,Boolean],default:!0},activeColor:{type:[String],default:"#409EFF"}},emits:["update:modelValue","change"],setup(t,{emit:e}){const n=t;G((e=>({"014e5dc0":t.width,e4e32852:t.activeColor})));const r=o(null),i=u((()=>n.modelValue===n.trueValue)),a=()=>{h((()=>{const t=r.value.checked;e("update:modelValue",t),e("change",t)}))};return(e,n)=>(D(),O("div",{class:P(["d-switch",{"is-checked":s(i)}])},[U("input",{class:"d-switch__input",ref:r,type:"checkbox",checked:s(i),onChange:a,"true-value":t.trueValue,"false-value":t.falseValue},null,40,c6),h6],2))}});u6.__scopeId="data-v-385f7870",F("data-v-b2384226");const d6={key:0},f6=U("i",{class:"rotating iconfont icon-loading f50"},null,-1),p6=[U("i",{class:"rotating iconfont icon-loading f50"},null,-1),U("p",null,"正在缓冲...",-1)],m6=[U("i",{class:"iconfont icon-replay f24 mr5"},null,-1),B("重新播放 ")],g6=[U("i",{class:"iconfont icon-replay f24 mr5"},null,-1),B("请求错误 ")];N();var v6=E({props:{loadType:String,text:{type:String,default:""}},setup(t){const e=t,{proxy:n}=l(),r=["loadstart","waiting","ended","error","stalled"],i=()=>{n.$parent.play()},o=u((()=>{let t="background: rgba(0, 0, 0, .1);z-index:1";return"loadstart"==e.loadType&&(t="background: rgba(0, 0, 0, 1);;z-index:3"),t}));return(e,n)=>V((D(),O("div",{class:"d-loading",style:L(s(o))},[U("div",null,["loadstart"==t.loadType?(D(),O("span",d6,[f6,U("p",null,z(t.text),1)])):W("",!0),V(U("span",null,p6,512),[[j,"waiting"==t.loadType]]),V(U("span",null,[U("p",{onClick:i,class:"d-flex-x d-pointer"},m6)],512),[[j,"ended"==t.loadType]]),V(U("span",null,[U("p",{onClick:i,class:"d-flex-x d-pointer"},g6)],512),[[j,"error"==t.loadType||"stalled"==t.loadType]])])],4)),[[j,r.includes(t.loadType)]])}});v6.__scopeId="data-v-b2384226";const y6=function(t,e,n,r=!1){t&&e&&n&&t.addEventListener(e,n,r)},b6=function(t,e,n,r=!1){t&&e&&n&&t.removeEventListener(e,n,r)};F("data-v-cf23e7ba");const x6=["onMousedown"];N();var w6=E(X4(Y4({},{name:"DSlider"}),{props:{modelValue:{required:!0,type:Number,default:0},disabled:{type:Boolean,default:!1},vertical:{type:Boolean,default:!1},hover:{type:Boolean,default:!0},hoverText:{type:String,default:""},preload:{type:Number,default:0},size:{type:String,default:"10px"}},emits:["update:modelValue","change","onMousemove"],setup:function(t,{emit:e}){const n=t;G((e=>({"5bf7d08c":t.size})));const r=o(null),i=o(null),a=x({dragging:!1,hoverPosition:0,hoverTipsLeft:"50%"}),l=u((()=>{let t=n.modelValue<0?0:n.modelValue>1?1:n.modelValue;return n.vertical?`height:${100*t}%`:`width:${100*t}%`})),c=u((()=>{let t=n.preload<0?0:n.preload>1?1:n.preload;return n.vertical?`height:${100*t}%`:`width:${100*t}%`})),h=u((()=>{let t=a.hoverPosition<0?0:a.hoverPosition>1?1:a.hoverPosition;return n.vertical?`bottom:${100*t}%`:`left:${100*t}%`})),d=t=>{t.preventDefault()},f=t=>{n.disabled||(t.preventDefault(),a.dragging=!0,m(t),y6(window,"mousemove",v),y6(window,"touchmove",v),y6(window,"mouseup",y),y6(window,"touchend",y))},p=t=>{if(!n.hover)return;let s=g(t);if(e("onMousemove",t,s),a.hoverPosition=s,n.vertical)return;let o=r.value,l=i.value.clientWidth/2,c=t.clientX-o.getBoundingClientRect().left;c<l?a.hoverTipsLeft=l-c+"px":o.clientWidth-c<l?a.hoverTipsLeft=o.clientWidth-c-l+"px":a.hoverTipsLeft="50%"},m=t=>{let n=g(t);e("update:modelValue",n),e("change",t,n)},g=t=>{let e=r.value,i=0;if(n.vertical){let n=e.clientHeight;i=(e.getBoundingClientRect().bottom-t.clientY)/n}else i=(t.clientX-e.getBoundingClientRect().left)/e.clientWidth;return i<0?0:i>1?1:i},v=t=>{m(t)},y=t=>{a.dragging&&(b6(window,"mousemove",v),b6(window,"touchmove",v),b6(window,"mouseup",y),b6(window,"touchend",y),b6(window,"contextmenu",y),setTimeout((()=>{a.dragging=!1}),0))};return(t,e)=>(D(),O("div",{ref:r,class:P(["d-slider",{"is-vertical":n.vertical}]),onMousedown:H(f,["stop"]),onContextmenu:d},[U("div",{class:"d-slider__runway",onMousemove:p},[V(U("div",{class:"d-slider__cursor",style:L(s(h))},[V(U("div",{class:"d-slider__tips",ref:i,style:L({left:s(a).hoverTipsLeft})},z(n.hoverText),5),[[j,n.hoverText]])],4),[[j,n.hover]]),U("div",{class:"d-slider__preload",style:L(s(c))},null,4),U("div",{class:"d-slider__bar",style:L(s(l))},null,4)],32)],42,x6))}}));w6.__scopeId="data-v-cf23e7ba",F("data-v-28994c4f");const E6={key:0,class:"d-player-dialog"},_6={class:"d-player-dialog-body"},S6={class:"d-player-dialog-title"},T6={class:"d-player-hotkey-panel"},k6={class:"d-player-filter-panel"},A6={class:"d-player-filter-panel-item"},C6=U("span",null,"饱和度",-1),R6={class:"d-player-filter-panel-item"},M6=U("span",null,"亮度",-1),I6={class:"d-player-filter-panel-item"},D6=U("span",null,"对比度",-1),O6={key:0,class:"d-player-contextmenu"},P6=["dplayerKeyCode"],L6=U("input",{class:"d-player-copyText"},null,-1);N();var F6=E({setup(t){const e=x({show:!1,dialogType:"",dialogTitle:"",version:"1.3.1-beta.2",mouseX:0,mouseY:0}),n=[{label:"视频色彩调整",key:"filter"},{label:"快捷键说明",key:"hotkey"},{label:"复制视频网址",key:"copy"},{label:"版本：1.3.1-beta.2",key:"version"}],r=[{key:"Space",label:"播放/暂停"},{key:"→",label:"单次快进10s，长按5倍速播放"},{key:"←",label:"快退5s"},{key:"↑",label:"音量增加10%"},{key:"↓",label:"音量增加降低10%"},{key:"Esc",label:"退出全屏/退出网页全屏"},{key:"F",label:"全屏/退出全屏"}],i=x({saturate:.392,brightness:.392,contrast:.392}),o=u((()=>({left:e.mouseX+"px",top:e.mouseY+"px"})));a(i,(t=>{let e=document.querySelector("#dPlayerVideo"),n=(2.55*t.saturate).toFixed(2),r=(2.55*t.brightness).toFixed(2),i=(2.55*t.contrast).toFixed(2);e.style.filter=`saturate(${n}) brightness(${r}) contrast(${i})`}));const l=()=>{i.saturate=.392,i.brightness=.392,i.contrast=.392},h=t=>{"Escape"==t.key&&f(0)},d=t=>{t.preventDefault(),y6(window,"keydown",h),y6(window,"click",f);let n=document.querySelector("#refPlayerWrap"),r=n.clientWidth;n.clientHeight,e.mouseX=t.clientX-n.getBoundingClientRect().left,r-e.mouseX<130&&(e.mouseX=e.mouseX+(r-e.mouseX-130)),e.mouseY=t.clientY-n.getBoundingClientRect().top,e.show=!0},f=t=>{let r="LI"==t.path[0].tagName,i=t.path[0].attributes.dplayerKeyCode&&t.path[0].attributes.dplayerKeyCode.value,s=n.map((t=>t.key));if(r&&s.includes(i))if(e.dialogTitle=t.path[0].innerText,e.dialogType=i,"copy"==i){let t=document.querySelector(".d-player-copyText");t.value=window.location.href,t.select(),document.execCommand("copy"),e.dialogType=""}else"version"==i&&(e.dialogType="");e.show=!1,b6(window,"keydown",h),b6(window,"click",f)};return c((()=>{let t=document.querySelector("#refPlayerWrap");b6(window,"keydown",h),b6(window,"click",f),b6(t,"contextmenu",d),y6(t,"contextmenu",d)})),T((()=>{let t=document.querySelector("#refPlayerWrap");b6(window,"keydown",h),b6(window,"click",f),b6(t,"contextmenu",d)})),(t,a)=>(D(),O("div",null,[C(Y,{name:"d-fade-in"},{default:$((()=>[s(e).dialogType?(D(),O("div",E6,[U("div",_6,[U("h5",S6,[B(z(s(e).dialogTitle)+" ",1),U("i",{onClick:a[0]||(a[0]=t=>s(e).dialogType=!1),class:"icon icon-close"},"X")]),V(U("ul",T6,[(D(),O(X,null,q(r,(t=>U("li",{class:"d-player-hotkey-panel-item",key:t.key},[U("span",null,z(t.key),1),U("span",null,z(t.label),1)]))),64))],512),[[j,"hotkey"==s(e).dialogType]]),V(U("ul",k6,[U("li",A6,[C6,C(w6,{class:"filter-panel-slider",size:"5px",modelValue:s(i).saturate,"onUpdate:modelValue":a[1]||(a[1]=t=>s(i).saturate=t)},null,8,["modelValue"]),U("span",null,z(Math.round(255*s(i).saturate)),1)]),U("li",R6,[M6,C(w6,{class:"filter-panel-slider",size:"5px",modelValue:s(i).brightness,"onUpdate:modelValue":a[2]||(a[2]=t=>s(i).brightness=t)},null,8,["modelValue"]),U("span",null,z(Math.round(255*s(i).brightness)),1)]),U("li",I6,[D6,C(w6,{class:"filter-panel-slider",size:"5px",modelValue:s(i).contrast,"onUpdate:modelValue":a[3]||(a[3]=t=>s(i).contrast=t)},null,8,["modelValue"]),U("span",null,z(Math.round(255*s(i).contrast)),1)]),U("span",{onClick:l,title:"重置","aria-label":"重置",class:"d-player-filter-reset"},"重置")],512),[[j,"filter"==s(e).dialogType]])])])):W("",!0)])),_:1}),s(e).show?(D(),O("div",O6,[U("ul",{class:"d-player-contextmenu-body",style:L(s(o))},[(D(),O(X,null,q(n,(t=>U("li",{dplayerKeyCode:t.key,key:t.key},z(t.label),9,P6))),64))],4),L6])):W("",!0)]))}});F6.__scopeId="data-v-28994c4f";const N6=t=>{let e=~~(t/3600),n=~~(t%3600/60),r=~~(t%60);return e=e<10?"0"+e:e,n=n<10?"0"+n:n,r=r<10?"0"+r:r,`${e}:${n}:${r}`},B6=!!("ontouchstart"in window),U6=["loadstart","play","pause","playing","seeking","seeked","waiting","durationchange","progress","canplay","timeupdate","ended","error","stalled"],V6={width:{type:String,default:"800px"},height:{type:String,default:"450px"},color:{type:String,default:"#409eff"},src:{required:!0,type:String,default:""},title:{type:String,default:""},type:{type:String,default:"video/mp4"},poster:{type:String,default:""},webFullScreen:{type:Boolean,default:!1},speed:{type:Boolean,default:!0},currentTime:{type:Number,default:0},playsinline:{type:Boolean,default:!1},muted:{type:Boolean,default:!1},speedRate:{type:Array,default:()=>["2.0","1.5","1.25","1.0","0.75","0.5"]},autoPlay:{type:Boolean,default:!1},loop:{type:Boolean,default:!1},mirror:{type:Boolean,default:!1},ligthOff:{type:Boolean,default:!1},volume:{type:[String,Number],default:.3},control:{type:Boolean,default:!0},controlBtns:{type:Array,default:["audioTrack","quality","speedRate","volume","setting","pip","pageFullScreen","fullScreen"]},preload:{type:String,default:"auto"}};F("data-v-38736a38");const j6={class:"d-player-video",id:"dPlayerVideo"},z6=["controls","webkit-playsinline","playsinline","volume","muted","loop","preload","src","poster"],G6={class:"d-player-lightoff"},W6={key:1,class:"d-player-state"},H6={class:"d-play-btn"},$6=["onKeyup","onKeydown"],Y6={class:"d-control-progress"},X6={class:"d-tool-bar"},q6={key:0,class:"d-tool-item d-tool-time audioTrack-btn"},K6=U("span",{style:{margin:"0 3px"}},"/",-1),Z6={class:"total-time"},J6={class:"d-tool-bar"},Q6={key:0,class:"d-tool-item quality-btn"},t8={class:"d-tool-item-main"},e8={class:"speed-main",style:{"text-align":"center"}},n8=["onClick"],r8={key:1,class:"d-tool-item speedRate-btn"},i8={class:"d-tool-item-main"},s8={class:"speed-main"},o8=["onClick"],a8={key:2,class:"d-tool-item volume-btn"},l8={class:"d-tool-item-main volume-box",style:{width:"52px"}},c8={class:"volume-text-size"},h8={key:3,class:"d-tool-item setting-btn"},u8={class:"d-tool-item-main"},d8={class:"speed-main"},f8=B(" 镜像画面 "),p8=B(" 循环播放 "),m8=B(" 关灯模式 "),g8=U("div",{class:"d-tool-item-main"},"画中画",-1),v8=U("div",{class:"d-tool-item-main"},"网页全屏",-1),y8=U("div",{class:"d-tool-item-main"},"全屏",-1);N();var b8=E(X4(Y4({},{name:"vue3VideoPlay",inheritAttrs:!1}),{props:V6,emits:[...U6,"mirrorChange","loopChange","lightOffChange"],setup:function(t,{expose:e,emit:n}){const r=t;G((t=>({"700c8c00":s(v),"714b73c2":t.width,"0a1f83ee":t.height})));const i=o(null),l=o(null),u=o(null),d=o(null),f=x(X4(Y4({dVideo:null},r),{muted:r.muted,playBtnState:r.autoPlay?"pause":"play",loadStateType:"loadstart",fullScreen:!1,handleType:"",currentTime:"00:00:00",preloadBar:0,totalTime:"00:00:00",isVideoHovering:!0,speedActive:"1.0",playProgress:0,isMultiplesPlay:!1,longPressTimeout:null,progressCursorTime:"00:00:00",qualityLevels:[],currentLevel:0})),p=(...t)=>e=>t.reverse().reduce(((t,e)=>e(t)),e),m=U6.reduce(((t,e)=>{var r;return t[`on${r=e,r.charAt(0).toUpperCase()+r.slice(1)}`]=t=>{f.loadStateType=e,n(e,t)},t}),{});m.onCanplay=p(m.onCanplay,(()=>{"play"!=f.playBtnState&&f.dVideo.play(),f.autoPlay&&(f.dVideo.play(),f.playBtnState="pause")})),m.onEnded=p(m.onEnded,(()=>{f.playBtnState="replay"})),m.onDurationchange=t=>{n("durationchange",t),0!=r.currentTime&&(f.dVideo.currentTime=r.currentTime),m.onTimeupdate(t)},m.onProgress=t=>{n("progress",t);let e=t.target.duration,r=t.target.buffered,i=t.target.buffered.length&&t.target.buffered.end(r-1);f.preloadBar=i/e},m.onTimeupdate=t=>{n("timeupdate",t);let e=t.duration||t.target.duration||0,r=t.currentTime||t.target.currentTime;f.playProgress=r/e,f.currentTime=N6(r),f.totalTime=N6(e)},m.onError=p(m.onError,(()=>{f.playBtnState="replay"}));let g=K();for(let s in g)m[s]=g[s];const v=(y=f.color,`${parseInt("0x"+y.slice(1,3))},${parseInt("0x"+y.slice(3,5))},${parseInt("0x"+y.slice(5,7))}`);var y;const b=K4(500,(()=>{f.handleType=""})),w=t=>{t.preventDefault(),"ArrowUp"==t.code?f.volume=f.volume+.1>1?1:f.volume+.1:f.volume=f.volume-.1<0?0:f.volume-.1,f.muted=!1,f.handleType="volume",b()},E=t=>{r.speed&&(f.dVideo.currentTime=f.dVideo.currentTime<10?.1:f.dVideo.currentTime-10,m.onTimeupdate(f.dVideo),T())},_=t=>{t.preventDefault();let e=t.type;if("ArrowRight"==t.key)if(T(),"keyup"==e){if(clearTimeout(f.longPressTimeout),!r.speed&&!f.longPressTimeout)return;f.isMultiplesPlay?(f.dVideo.playbackRate=f.speedActive,f.isMultiplesPlay=!1):(f.dVideo.currentTime=f.dVideo.currentTime+10,m.onTimeupdate(f.dVideo))}else if("keydown"==e){if(!r.speed)return;f.isMultiplesPlay&&clearTimeout(f.longPressTimeout),f.longPressTimeout=setTimeout((()=>{f.isMultiplesPlay=!0,f.dVideo.playbackRate=5,f.handleType="playbackRate",b()}),500)}},S=()=>{B6||d.value.focus()},T=()=>{f.loadStateType="play",f.dVideo.play().catch((()=>{setTimeout((()=>{f.playBtnState="replay",f.loadStateType="error"}),500)})),f.playBtnState="pause"},k=()=>{f.dVideo.pause(),f.playBtnState="play"},A=t=>{t&&t.preventDefault(),"play"==f.playBtnState||"replay"==f.playBtnState?T():"pause"==f.playBtnState&&k()},R=()=>{f.muted=!f.muted,0==f.volume&&(f.volume=.05)},M=(t,e)=>{let n=f.dVideo.duration||f.dVideo.target.duration;f.dVideo.currentTime=n*e,"play"==f.playBtnState&&(f.dVideo.play(),f.playBtnState="pause")},I=(t,e)=>{f.progressCursorTime=N6(f.dVideo.duration*e)},L=K4(2500,(()=>{f.isVideoHovering=!1})),F=t=>{f.isVideoHovering=!0,L()},N=t=>{n("mirrorChange",t,f.dVideo)},H=t=>{n("loopChange",t,f.dVideo)},tt=t=>{n("lightOffChange",t,f.dVideo)},et=()=>{var t;t=f.dVideo,document.pictureInPictureElement?document.exitPictureInPicture().catch((t=>{})):t.requestPictureInPicture().catch((t=>{}))},nt=()=>{f.fullScreen=(t=>{let e=document,n=e.webkitIsFullScreen||e.fullscreen;return n?(document.exitFullscreen||e.webkitExitFullScreen).call(e):(t.requestFullscreen||t.webkitRequestFullScreen).call(t),!n})(i.value)};return a((()=>r.src),(()=>{h((()=>{(()=>{if(f.dVideo.canPlayType(r.type)||f.dVideo.canPlayType("application/vnd.apple.mpegurl"))f.muted=r.autoPlay;else if(J4.isSupported()){const t=new J4({fragLoadingTimeOut:2e3});t.detachMedia(),t.attachMedia(f.dVideo),t.on(J4.Events.MEDIA_ATTACHED,(()=>{t.loadSource(r.src),t.on("hlsManifestParsed",((t,e)=>{f.currentLevel=e.level,f.qualityLevels=e.levels||[]}))})),t.on("hlsLevelSwitching",((t,e)=>{})),t.on("hlsLevelSwitched",((t,e)=>{f.currentLevel=e.level}))}})()}))}),{immediate:!0}),c((()=>{f.dVideo=l,S()})),e({play:T,pause:k,togglePlay:A}),(t,e)=>(D(),O("div",{ref:i,id:"refPlayerWrap",class:P(["d-player-wrap",{"web-full-screen":s(f).webFullScreen,"is-lightoff":s(f).lightOff,"d-player-wrap-hover":"play"==s(f).playBtnState||s(f).isVideoHovering}]),onMousemove:F},[U("div",j6,[U("video",Z({ref:l,class:["d-player-video-main",{"video-mirror":s(f).mirror}],id:"dPlayerVideoMain",controls:!(!s(B6)||!s(f).speed),"webkit-playsinline":r.playsinline,playsinline:r.playsinline},s(m),{volume:s(f).volume,muted:s(f).muted,loop:s(f).loop,preload:t.preload,width:"100%",height:"100%",src:r.src,poster:r.poster}),"您的浏览器不支持Video标签。",16,z6)]),C(Y,{name:"d-fade-in"},{default:$((()=>[V(U("div",G6,null,512),[[j,s(f).lightOff]])])),_:1}),s(f).fullScreen?(D(),J(r6,{key:0,title:r.title},null,8,["title"])):W("",!0),s(B6)?W("",!0):(D(),O("div",W6,[C(Y,{name:"d-scale-out"},{default:$((()=>[V(U("div",H6,[C(Q4,{icon:"icon-play",size:40})],512),[[j,"play"==s(f).playBtnState]])])),_:1}),C(l6,{state:s(f)},null,8,["state"])])),s(B6)?W("",!0):(D(),O("input",{key:2,type:"input",readonly:"readonly",ref:d,onDblclick:nt,onKeyup:[Q(nt,["f"]),e[0]||(e[0]=Q((t=>s(f).webFullScreen=!1),["esc"])),_],onClick:A,onKeydown:[Q(A,["space"]),Q(E,["arrow-left"]),Q(w,["arrow-up","arrow-down"]),_],class:"d-player-input",maxlength:"0"},null,40,$6)),C(v6,{loadType:s(f).loadStateType},null,8,["loadType"]),C(F6),!s(B6)&&s(f).control?(D(),O("div",{key:3,class:"d-player-control",ref:u},[U("div",Y6,[C(w6,{class:"d-progress-bar",onOnMousemove:I,onChange:M,disabled:!s(f).speed,hoverText:s(f).progressCursorTime,modelValue:s(f).playProgress,"onUpdate:modelValue":e[1]||(e[1]=t=>s(f).playProgress=t),preload:s(f).preloadBar},null,8,["disabled","hoverText","modelValue","preload"])]),U("div",{class:"d-control-tool",onClick:S},[U("div",X6,[U("div",{class:"d-tool-item",onClick:A},[C(Q4,{size:"24",icon:`icon-${s(f).playBtnState}`},null,8,["icon"])]),r.controlBtns.includes("audioTrack")?(D(),O("div",q6,[U("span",null,z(s(f).currentTime),1),K6,U("span",Z6,z(s(f).totalTime),1)])):W("",!0)]),U("div",J6,[s(f).qualityLevels.length&&r.controlBtns.includes("quality")?(D(),O("div",Q6,[B(z(s(f).qualityLevels.length&&(s(f).qualityLevels[s(f).currentLevel]||{}).height)+"P ",1),U("div",t8,[U("ul",e8,[(D(!0),O(X,null,q(s(f).qualityLevels,((t,e)=>(D(),O("li",{class:P({"speed-active":s(f).currentLevel==e}),onClick:t=>{return n=e,Hls.currentLevel=n,void(f.currentLevel=n);var n},key:t},z(t.height)+"P",11,n8)))),128))])])])):W("",!0),r.controlBtns.includes("speedRate")?(D(),O("div",r8,[B(z("1.0"==s(f).speedActive?"倍速":s(f).speedActive+"x")+" ",1),U("div",i8,[U("ul",s8,[(D(!0),O(X,null,q(s(f).speedRate,(t=>(D(),O("li",{class:P({"speed-active":s(f).speedActive==t}),onClick:e=>{return n=t,f.speedActive=n,void(f.dVideo.playbackRate=n);var n},key:t},z(t)+"x",11,o8)))),128))])])])):W("",!0),r.controlBtns.includes("volume")?(D(),O("div",a8,[U("div",l8,[U("div",{class:P(["volume-main",{"is-muted":s(f).muted}])},[U("span",c8,z(s(f).muted?0:~~(100*s(f).volume))+"%",1),C(w6,{onChange:e[2]||(e[2]=t=>s(f).muted=!1),hover:!1,size:"5px",vertical:!0,modelValue:s(f).volume,"onUpdate:modelValue":e[3]||(e[3]=t=>s(f).volume=t)},null,8,["modelValue"])],2)]),U("span",{onClick:R,style:{display:"flex"}},[C(Q4,{size:"20",icon:"icon-volume-"+(0==s(f).volume||s(f).muted?"mute":s(f).volume>.5?"up":"down")},null,8,["icon"])])])):W("",!0),r.controlBtns.includes("setting")?(D(),O("div",h8,[C(Q4,{size:"20",class:"rotateHover",icon:"icon-settings"}),U("div",u8,[U("ul",d8,[U("li",null,[f8,C(u6,{onChange:N,modelValue:s(f).mirror,"onUpdate:modelValue":e[4]||(e[4]=t=>s(f).mirror=t)},null,8,["modelValue"])]),U("li",null,[p8,C(u6,{onChange:H,modelValue:s(f).loop,"onUpdate:modelValue":e[5]||(e[5]=t=>s(f).loop=t)},null,8,["modelValue"])]),U("li",null,[m8,C(u6,{onChange:tt,modelValue:s(f).lightOff,"onUpdate:modelValue":e[6]||(e[6]=t=>s(f).lightOff=t)},null,8,["modelValue"])])])])])):W("",!0),r.controlBtns.includes("pip")?(D(),O("div",{key:4,class:"d-tool-item pip-btn",onClick:et},[C(Q4,{size:"20",icon:"icon-pip"}),g8])):W("",!0),r.controlBtns.includes("pageFullScreen")?(D(),O("div",{key:5,class:"d-tool-item pip-btn",onClick:e[7]||(e[7]=t=>s(f).webFullScreen=!s(f).webFullScreen)},[C(Q4,{size:"20",icon:"icon-web-screen"}),v8])):W("",!0),r.controlBtns.includes("fullScreen")?(D(),O("div",{key:6,class:"d-tool-item fullScreen-btn",onClick:nt},[y8,C(Q4,{size:"20",icon:"icon-screen"})])):W("",!0)])])],512)):W("",!0)],34))}}));b8.__scopeId="data-v-38736a38",b8.install=function(t){t.component(b8.name,b8)};export{Yv as $,xh as A,fc as B,eh as C,Kg as D,hg as E,nv as F,sv as G,Cv as H,Iv as I,mg as J,Lv as K,xd as L,Vv as M,Gv as N,Zg as O,tg as P,gu as Q,Sv as R,wv as S,tp as T,Wv as U,Ep as V,ty as W,$v as X,Jv as Y,ag as Z,au as _,kc as a,mh as a$,Ig as a0,Wc as a1,hc as a2,cc as a3,gc as a4,zc as a5,Nh as a6,Tc as a7,Oc as a8,wc as a9,Xb as aA,id as aB,nd as aC,Nd as aD,Vc as aE,Bc as aF,nu as aG,Ec as aH,Yh as aI,$h as aJ,qb as aK,vx as aL,gx as aM,Qp as aN,Qh as aO,Zh as aP,ah as aQ,uc as aR,lm as aS,eu as aT,ru as aU,Fd as aV,Vd as aW,Od as aX,Bd as aY,Ud as aZ,lh as a_,Sc as aa,$c as ab,Jc as ac,nh as ad,cp as ae,ry as af,Xl as ag,Ay as ah,kh as ai,kp as aj,Lu as ak,Ap as al,jc as am,lp as an,Nc as ao,Iy as ap,wh as aq,Eh as ar,ip as as,vh as at,bh as au,fd as av,ad as aw,Om as ax,Bm as ay,zb as az,Ic as b,qa as b$,ph as b0,oh as b1,dh as b2,fh as b3,ch as b4,uh as b5,dd as b6,cd as b7,yh as b8,Dm as b9,vt as bA,Lr as bB,ue as bC,kt as bD,yt as bE,ti as bF,si as bG,Di as bH,ai as bI,Pi as bJ,Mt as bK,Fi as bL,Vi as bM,zi as bN,Wi as bO,$i as bP,Xi as bQ,xt as bR,dt as bS,Zi as bT,Qi as bU,It as bV,Kt as bW,lt as bX,In as bY,qt as bZ,Gt as b_,su as ba,hd as bb,Pm as bc,Fm as bd,Jf as be,df as bf,Pc as bg,Hh as bh,Wh as bi,Dh as bj,Fc as bk,Nx as bl,Gx as bm,Yx as bn,Xx as bo,Qg as bp,ct as bq,vn as br,mt as bs,Mn as bt,wt as bu,lr as bv,St as bw,Zt as bx,Nt as by,Ft as bz,Zc as c,$K as c$,Pa as c0,Qa as c1,gl as c2,ml as c3,vl as c4,_l as c5,wl as c6,Bl as c7,LP as c8,o_ as c9,iw as cA,ow as cB,iP as cC,CL as cD,mL as cE,BO as cF,YP as cG,i_ as cH,GO as cI,sw as cJ,BD as cK,LD as cL,mN as cM,_F as cN,aU as cO,jO as cP,_U as cQ,EU as cR,$L as cS,aL as cT,zU as cU,TW as cV,TU as cW,CU as cX,BU as cY,WU as cZ,pK as c_,b_ as ca,v_ as cb,a_ as cc,m_ as cd,g_ as ce,s_ as cf,c_ as cg,l_ as ch,bF as ci,dF as cj,x_ as ck,Tk as cl,tN as cm,EF as cn,kL as co,Ek as cp,AL as cq,bL as cr,JO as cs,hF as ct,uF as cu,ak as cv,rP as cw,nN as cx,rN as cy,vL as cz,Gc as d,D4 as d0,U4 as d1,b8 as d2,ol as d3,yc as e,Mc as f,Rc as g,pc as h,Cc as i,jl as j,mc as k,dc as l,bc as m,Ac as n,vc as o,_c as p,Ld as q,xc as r,Lc as s,Uc as t,Jg as u,cg as v,ug as w,Jh as x,tu as y,iu as z};
